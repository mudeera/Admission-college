"use strict";(self.webpackChunkskype4life=self.webpackChunkskype4life||[]).push([[523],{934339:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnimatedEmoticon=t.Styles=t.getStyles=t.FallbackType=t.RenderMode=t.Size=void 0;const i=s(785893),o=s(496486),n=s(159423),r=s(516778),a=s(72374),l=s(889391),d=s(236974),c=s(82433),h=s(732183),u=s(746096),p=s(139597),g=s(436237),m=s(861253),S=s(915877),f=s(526424);Object.defineProperty(t,"Size",{enumerable:!0,get:function(){return f.EmoticonSize}});const y=s(617707),v=s(758962),C=s(581760),_=s(680837),b=s(619675),T=s(24576);var M,I;!function(e){e[e.StaticOnly=0]="StaticOnly",e[e.FallbackTextOnly=1]="FallbackTextOnly"}(M=t.RenderMode||(t.RenderMode={})),function(e){e[e.Placeholder=0]="Placeholder",e[e.FallbackText=1]="FallbackText"}(I=t.FallbackType||(t.FallbackType={}));const w={};function P(e){const t=v.getFrameHeight(e);return w[t]||(w[t]={image:r.Styles.createViewStyle({height:t,width:t},!1),placeholder:r.Styles.createViewStyle({height:t,width:t,borderRadius:t/2},!1),fallbackTextContainer:r.Styles.createTextStyle({lineHeight:t,height:t},!1)}),w[t]}var k,A;t.getStyles=P,t.Styles=(0,S.lazyProperties)({placeholderBackground:()=>r.Styles.createViewStyle({backgroundColor:C.Color.gray100}),innerTextTransparent:()=>r.Styles.createTextStyle({color:C.Color.transparent,position:"absolute",backgroundColor:C.Color.transparent}),animatedTransform:()=>r.Styles.createViewStyle({transform:[{rotateZ:"0"}]})}),function(e){e[e.AnimatedIcon=0]="AnimatedIcon",e[e.StaticIcon=1]="StaticIcon",e[e.Fallback=2]="Fallback"}(k||(k={})),function(e){e[e.Empty=0]="Empty",e[e.Animated=1]="Animated",e[e.Image=2]="Image",e[e.FallbackImage=3]="FallbackImage",e[e.Placeholder=4]="Placeholder"}(A||(A={}));class x extends T.default{constructor(){super(...arguments),this._telemetry=new d.default(l.default.getS4LMessagingFeaturesNoSubscription().nativeEmoticonCacheTelemetrySampleRate,(()=>this._getDesiredEmoticonInfo())),this._onMouseEnter=()=>{this.state.forceAnimateOnHover&&this.setState({forceAnimate:!0})},this._onMouseLeave=()=>{this.state.forceAnimateOnHover&&this.setState({forceAnimate:!1})}}_getDesiredEmoticonInfo(){return this.state.desiredComponentType===k.AnimatedIcon||this.state.forceAnimate?this.state.desiredAnimatedIcon||this.state.desiredStaticIcon:this.state.desiredComponentType===k.StaticIcon?this.state.desiredStaticIcon:void 0}_getResultToRender(e){return(e.desiredComponentType===k.AnimatedIcon||e.forceAnimate)&&e.animatedIcon?e.animatedIcon:e.desiredComponentType!==k.Fallback&&e.staticIcon?e.staticIcon:void 0}UNSAFE_componentWillMount(){this._componentId=--x._emoticonRefCount;const e=this._buildNonDefaultRenderModeState(this.props);o.isUndefined(e)&&a.default.register(this._componentId),super.UNSAFE_componentWillMount()}componentWillUnmount(){this._telemetry.finishAndResetTelemetry(),super.componentWillUnmount(),o.isUndefined(this.state.nonDefaultRenderMode)&&a.default.unregister(this._componentId)}UNSAFE_componentWillReceiveProps(e,t){const s=this._buildNonDefaultRenderModeState(e);this.state&&!o.isUndefined(this.state.nonDefaultRenderMode)&&o.isUndefined(s)?a.default.register(this._componentId):this.state&&o.isUndefined(this.state.nonDefaultRenderMode)&&!o.isUndefined(s)&&a.default.unregister(this._componentId),super.UNSAFE_componentWillReceiveProps(e,t)}componentDidMount(){super.componentDidMount(),this._telemetry.updateTelemetry(this._getResultToRender(this.state))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=this._getResultToRender(t),o=this._getResultToRender(this.state);e.emoticonName!==this.props.emoticonName||e.size!==this.props.size||t.nonDefaultRenderMode!==this.state.nonDefaultRenderMode||t.forceAnimate!==this.state.forceAnimate?(this._telemetry.finishAndResetTelemetry(),this._telemetry.updateTelemetry(o)):(0,m.default)(i,o)||this._telemetry.updateTelemetry(o)}_getEmoticonInfo(e,t,s){return{id:e.emoticonName,size:v.getPixelSize(e.size),type:t,etag:s?s.etag:void 0,tone:e.tone}}_getMissingConfigState(e,t,s){return{desiredComponentType:s?k.StaticIcon:k.Fallback,animatedIcon:void 0,staticIcon:s,isConfigMissing:!0,frameCount:0,firstFrame:0,forceAnimateOnHover:!1,nonDefaultRenderMode:e,fallback:t}}_getState(e,t,s,i,o,n,r,a){return{desiredComponentType:e,animatedIcon:o,staticIcon:n,isConfigMissing:!1,frameCount:r||0,firstFrame:a||0,forceAnimateOnHover:t,nonDefaultRenderMode:s,fallback:i}}_buildState(e,t){const s=this._buildNonDefaultRenderModeState(e),i=this._buildFallbackState(e),n=c.default.getEmoticonByName(e.emoticonName),r=!o.isUndefined(n)&&n.frameCount>1;if(s===M.FallbackTextOnly)return this._getState(k.Fallback,r,s,i);if(!n)return y.default.triggerEmoticonInfoFetch(e.emoticonName),this._getMissingConfigState(s,i);const l=this._getEmoticonInfo(e,f.EmoticonType.Animated,n),d=this._getEmoticonInfo(e,f.EmoticonType.Static,n);let u=p.default.requestEmoticon((0,h.getUrl)(l),l).result;(null==u?void 0:u.type)!==f.ResultIconType.Final&&(u=void 0);const g=p.default.requestEmoticon((0,h.getUrl)(d),d).result;let m;const S=n.frameCount,v=(n.firstFrame||0)%S;if(s===M.StaticOnly)m=this._getState(k.StaticIcon,r,s,i,u,g,S,v);else{m=n.frameCount>1&&a.default.canAnimate(this._componentId)?this._getState(k.AnimatedIcon,r,s,i,u,g,S,v):this._getState(k.StaticIcon,r,s,i,u,g)}return Object.assign({desiredAnimatedIcon:l,desiredStaticIcon:d},m)}_buildNonDefaultRenderModeState(e){let t;return e.onlyRenderFallbackText?t=M.FallbackTextOnly:e.isStatic&&(t=M.StaticOnly),t}_buildFallbackState(e){let t;return e.showPlaceHolder?t={type:I.Placeholder,placeholderStyle:e.placeholderBackgroundColor?r.Styles.createViewStyle({backgroundColor:e.placeholderBackgroundColor},!1):void 0}:e.allowTextFallback&&(t={type:I.FallbackText,fallbackTextStyle:e.fallbackTextStyle}),t}render(){const e=P(this.props.renderSize?this.props.renderSize:this.props.size);let s,o,a;if(this.state.isConfigMissing&&g.log(u.LogTraceArea.AnimatedEmoticon,`EmoticonInfo not present for ${this.props.innerText}`),(this.state.desiredComponentType===k.AnimatedIcon||this.state.forceAnimate)&&this.state.animatedIcon){const t=(0,h.getUrl)(this.state.animatedIcon.icon),r=this.state.staticIcon?(0,h.getUrl)(this.state.staticIcon.icon):(0,h.getEmoticonUrl)(this.props.emoticonName,this.props.size,!0,this.props.tone),l=v.getPixelSize(this.props.size);o=A.Animated,a=t,s=(0,i.jsx)(n.default,{style:e.image,originalWidth:l,originalHeight:l,url:t,staticUrl:r,name:this.props.emoticonName,firstFrame:this.state.firstFrame,sourceFramesCount:this.state.frameCount,synchronized:!this.props.standaloneAnimation,zoomHint:this.props.zoomHint,tooltip:this.props.innerText})}else if(this.state.desiredComponentType!==k.Fallback&&this.state.staticIcon){const t=(0,h.getUrl)(this.state.staticIcon.icon);o=this.state.nonDefaultRenderMode!==M.StaticOnly||this.state.forceAnimate?A.FallbackImage:A.Image,a=t,s=(0,i.jsx)(r.Image,{style:e.image,title:this.props.innerText,source:t,resizeMode:"cover"})}else{if(this.state.nonDefaultRenderMode===M.FallbackTextOnly||this.state.fallback&&this.state.fallback.type===I.FallbackText)return this.state.desiredComponentType!==k.Fallback?g.log(u.LogTraceArea.AnimatedEmoticon,`Rendering text fallback as image is not prefetched: ${this.props.emoticonName} (size: ${this.props.size})`):this.state.nonDefaultRenderMode===M.FallbackTextOnly&&g.log(u.LogTraceArea.AnimatedEmoticon,`Permanent Rendering fallback text for emoticon as required by renderMode prop - ${this.props.innerText}`),this._renderFallbackText(e);this.state.fallback&&this.state.fallback.type===I.Placeholder?(o=A.Placeholder,a="N/A",s=this._renderPlaceholder(e)):(o=A.Empty,a="N/A",s=null)}g.log(u.LogTraceArea.AnimatedEmoticon,A[o]+` emoticon - emoticon: ${this.props.emoticonName} - url ${a}`);const l=[e.image];return this.props.style&&l.push(this.props.style),o===A.Animated&&l.push(t.Styles.animatedTransform),this.state.forceAnimate&&this.props.onHoverAfterBodyEmoticonStyle&&l.push(this.props.onHoverAfterBodyEmoticonStyle),(0,i.jsxs)(r.View,Object.assign({style:l,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,importantForAccessibility:this.props.importantForAccessibility},{children:[(0,i.jsx)(r.Text,Object.assign({style:t.Styles.innerTextTransparent,selectable:!this.props.preventSelectable,importantForAccessibility:this.props.preventSelectable?r.Types.ImportantForAccessibility.NoHideDescendants:void 0},{children:this.props.description||this.props.innerText})),s,this.props.children]}))}_renderPlaceholder(e){g.log(u.LogTraceArea.AnimatedEmoticon,`Rendering placeholder view ${this.props.emoticonName}`);const s=[t.Styles.placeholderBackground,e.placeholder];return this.state.fallback&&this.state.fallback.placeholderStyle&&s.push(this.state.fallback.placeholderStyle),(0,i.jsx)(r.View,{style:s,title:this.props.innerText,importantForAccessibility:r.Types.ImportantForAccessibility.No})}_renderFallbackText(e){const t=[_.default.transparentBackground,e.fallbackTextContainer,this._useDarkTheme()?this._themeStyles.secondaryTextColorStyle:this._themeStyles.primaryTextColorStyle];return this.state.fallback&&this.state.fallback.fallbackTextStyle&&t.push(this.state.fallback.fallbackTextStyle),(0,i.jsx)(b.BodyText,Object.assign({style:t,selectable:!this.props.preventSelectable},{children:this.props.emoticonName}))}}x._emoticonRefCount=0,t.AnimatedEmoticon=x},870675:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(667294),r=s(475760),a=s(915877),l=s(330124),d=s(711828),c=s(360305),h=s(24576),u=s(31894),p=(0,a.lazyProperties)({container:()=>o.Styles.createViewStyle({right:5,bottom:10}),containerDesktop:()=>o.Styles.createViewStyle({bottom:0,right:13,width:d.IconSize.default,height:d.IconSize.default,alignItems:"center"})});class g extends h.default{constructor(){super(...arguments),this._buttonRef=n.createRef()}_buildState(e){const t=e.conversationId?r.default.getMessageCountsForConversation(e.conversationId):void 0;return{unreadCount:null==t?void 0:t.unreadCount,unreadCountOverflowed:null==t?void 0:t.unreadCountOverflowed,useColorBadge:!!(null==t?void 0:t.highPriorityUnreadCount),useDesktopStyles:!l.default.isUsingStackNavigationContext()&&!c.default.isTabletUI()}}render(){const e=[p.container];return this.props.horizontalPadding&&this.props.horizontalPadding.right&&e.push(o.Styles.createViewStyle({right:this.props.horizontalPadding.right+5},!1)),this.state.useDesktopStyles&&e.push(p.containerDesktop),(0,i.jsx)(u.default,{ref:this._buttonRef,style:e,onPressCallback:this.props.onPressCallback,optionalNumber:this.state.unreadCount,optionalNumberOverflowed:this.state.unreadCountOverflowed,useColorBadge:this.state.useColorBadge})}setVisible(e){var t,s;null===(s=null===(t=this._buttonRef)||void 0===t?void 0:t.current)||void 0===s||s.setVisible(e)}}t.default=g},903573:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(667294),n=s(496486),r=s(516778),a=s(898278),l=s(667121),d=s(125793),c=s(746096),h=s(436237),u=s(915877),p=s(733754),g=s(106658),m=s(330124),S=s(886045),f=s(404057),y=s(22222),v=s(581760),C=s(640363),_=s(619675),b=s(24576),T=(s(912770),s(172758));var M;!function(e){e[e.None=0]="None",e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary"}(M||(M={}));const I=(0,u.lazyProperties)({container:()=>r.Styles.createViewStyle({maxWidth:g.maxStreamContentWidth,alignItems:"center",justifyContent:"center",marginHorizontal:10,flex:1,marginVertical:10,minHeight:100}),containerComposite:()=>r.Styles.createViewStyle({marginLeft:50,marginRight:50}),button:()=>r.Styles.createButtonStyle({marginTop:10}),secondaryButton:()=>r.Styles.createButtonStyle({marginRight:10}),text:()=>r.Styles.createTextStyle({marginHorizontal:60,textAlign:"center"}),buddyName:()=>r.Styles.createTextStyle({fontWeight:"bold"}),row:()=>r.Styles.createViewStyle({flexDirection:"row"})}),w={dark:{backgroundColor:v.Color.gray400,textColor:v.Color.white,borderColor:v.Color.white},light:{backgroundColor:v.Color.white,textColor:v.Color.gray400,borderColor:v.Color.gray400}};class P extends b.default{constructor(){super(...arguments),this._renderers={},this._failureRenderers={},this._renderConversationEnded=()=>[this._renderTextLine("E2eeHandshakeControl.PrivateConversationEndedTitle",!0),this._renderTextLine("E2eeHandshakeControl.PrivateConversationEndedCaption",!1),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"inviteButton",ref:this._onInitialButtonRef,onPress:this._invite,title:p.getString("E2eeHandshakeControl.SendNewInviteButton"),buttonSize:a.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===M.Primary}))],this._renderExpiredState=()=>[this._renderTextLine("E2eeHandshakeControl.InvitationExpiredTitle",!0),this._renderTextLine("E2eeHandshakeControl.InvitationExpiredCaption",!1),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"inviteButton",ref:this._onInitialButtonRef,onPress:this._invite,title:p.getString("E2eeHandshakeControl.SendNewInviteButton"),buttonSize:a.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===M.Primary}))],this._renderSwitch=()=>[this._renderTextLine("E2eeHandshakeControl.SwitchDeviceTitle",!0),this._renderTextLine("E2eeHandshakeControl.SwitchDeviceCaption",!1),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"inviteButton",onPress:this._sendInviteFromSwitch,ref:this._onInitialButtonRef,title:p.getString("E2eeHandshakeControl.SwitchDeviceButton"),buttonSize:a.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===M.Primary}))],this._renderAcceptInvite=()=>[this._renderTextLine("E2eeHandshakeControl.IncomingInvitationTitle",!0),this._renderTextLine("E2eeHandshakeControl.IncomingInvitationCaption",!1),(0,i.jsxs)(r.View,Object.assign({style:I.row},{children:[(0,o.createElement)(y.default,Object.assign({},this._getSecondaryButtonConfig(),{key:"rejectButton",ref:this._onInitialButtonRef,onPress:this._declineInvitation,title:p.getString("E2eeHandshakeControl.DeclineButton"),buttonSize:a.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===M.Secondary})),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"acceptButton",onPress:this._acceptInvite,title:p.getString("E2eeHandshakeControl.IncomingInvitationButton"),buttonSize:a.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===M.Primary}))]}),"acceptButtonsRow")],this._renderConfirmAcceptance=()=>[this._renderTextLine("E2eeHandshakeControl.GotAcceptTitle",!0),this._renderTextLine("E2eeHandshakeControl.GotAcceptCaption",!1),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"confirmButton",ref:this._onInitialButtonRef,onPress:this._confirm,title:p.getString("E2eeHandshakeControl.ConfirmButton"),buttonSize:a.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===M.Primary}))],this._renderAcceptSwitch=()=>[this._renderTextLine("E2eeHandshakeControl.OtherPartySwitchedTitle",!0),this._renderTextLine("E2eeHandshakeControl.OtherPartySwitchedCaption",!1),(0,i.jsxs)(r.View,Object.assign({style:I.row},{children:[(0,o.createElement)(y.default,Object.assign({},this._getSecondaryButtonConfig(),{key:"rejectButton",ref:this._onInitialButtonRef,onPress:this._declineSwitch,title:p.getString("E2eeHandshakeControl.DeclineButton"),buttonSize:a.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===M.Secondary})),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"acceptButton",onPress:this._acceptSwitch,title:p.getString("E2eeHandshakeControl.IncomingInvitationButton"),buttonSize:a.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===M.Primary}))]}),"acceptButtonsRow")],this._renderInviteSent=()=>{const e="E2eeHandshakeControl.OutgoingInvitationTitle",t="E2eeHandshakeControl.OutgoingInvitationCaption";if(C.default.isElectronOsx()){const s=n.join([p.getString(e),n.join(p.getParts(t,{buddy:this.state.buddyName}),"")],".");return[this._renderFocusableTextLine(e,!0,!1,e,s),this._renderTextLine(t,!1)]}return[this._renderTextLine(e,!0,!1),this._renderTextLine(t,!1)]},this._renderRejectAcceptance=()=>{const e="E2eeHandshakeControl.SentAcceptTitle",t="E2eeHandshakeControl.SentAcceptCaption";if(C.default.isElectronOsx()){const s=n.join([p.getString(e),n.join(p.getParts(t,{buddy:this.state.buddyName}),"")],".");return[this._renderFocusableTextLine(e,!0,!1,e,s),this._renderTextLine(t,!1)]}return[this._renderTextLine(e,!0,!1),this._renderTextLine(t,!1)]},this._renderDeviceSwitched=()=>{const e="E2eeHandshakeControl.DeviceSwitchedTitle",t="E2eeHandshakeControl.DeviceSwitchedCaption";if(C.default.isElectronOsx()){const s=n.join([p.getString(e),n.join(p.getParts(t,{buddy:this.state.buddyName}),"")],".");return[this._renderFocusableTextLine(e,!0,!1,e,s),this._renderTextLine(t,!1)]}return[this._renderTextLine(e,!0,!1),this._renderTextLine(t,!1)]},this._renderBuddyName=()=>(0,i.jsx)(r.Text,Object.assign({style:I.buddyName},{children:this.state.buddyName}),"buddyName"),this._renderOutgoingInvitationFailed=()=>this._renderStateWithTryAgainButton("E2eeHandshakeControl.OutgoingInvitationFailedTitle",this._invite),this._renderSwitchDeviceFailed=()=>this._renderStateWithTryAgainButton("E2eeHandshakeControl.SwitchDeviceFailedTitle",this._sendInviteFromSwitch),this._renderAcceptanceFailed=()=>this.state.lastFailingAction===M.Primary?this._renderStateWithTryAgainButton("E2eeHandshakeControl.AcceptanceFailedTitle",this._acceptInvite):this._renderStateWithTryAgainButton("E2eeHandshakeControl.InviteDeclinationFailedTitle",this._declineInvitation),this._renderConfirmationFailed=()=>this._renderStateWithTryAgainButton("E2eeHandshakeControl.ConfirmationFailedTitle",this._confirm),this._renderSwitchAcceptanceFailed=()=>this.state.lastFailingAction===M.Primary?this._renderStateWithTryAgainButton("E2eeHandshakeControl.SwitchAcceptanceFailedTitle",this._acceptSwitch):this._renderStateWithTryAgainButton("E2eeHandshakeControl.SwitchDeclinationFailedTitle",this._declineSwitch),this._onInitialButtonRef=e=>{this._initialComponent=e||void 0},this._onInitialTitleRef=e=>{this._initialComponent=e||void 0},this._onInitialFocusedTitleRef=e=>{this._initialComponent=e||void 0},this._invite=()=>{const e=this._isExpired()?c.E2EEInviteOrigin.InvitationExpire:c.E2EEInviteOrigin.ConversationEnd;this._sendInvite(e,"invite")},this._sendInviteFromSwitch=()=>{this._sendInvite(c.E2EEInviteOrigin.DeviceSwitch,"switch")},this._acceptInvite=()=>{this._performAction(l.default.sendAccept(this.props.conversationId,c.E2EEAcceptOrigin.Invitation),"acceptInvite")},this._acceptSwitch=()=>{this._performAction(l.default.sendAccept(this.props.conversationId,c.E2EEAcceptOrigin.DeviceSwitch),"acceptSwitch")},this._confirm=()=>{this._performAction(l.default.sendConfirm(this.props.conversationId),"confirm")},this._declineInvitation=()=>{this._performAction(l.default.sendReject(this.props.conversationId,c.E2EERejectionReason.InvitationDeclining),"declineInvitation",M.Secondary)},this._declineSwitch=()=>{this._performAction(l.default.sendReject(this.props.conversationId,c.E2EERejectionReason.DeviceSwitchDeclining),"declineSwitch",M.Secondary)}}_buildState(e,t){const s=this.props,i=T.default.getFullUserProfileByMri(d.default.getBuddyAddress(e.e2eeHandshake).mri),o={isUsingStackNavigationContext:m.default.isUsingStackNavigationContext(),buddyName:i.firstName||i.getDisplayName()};return t?(this._renderers[d.SecureHandshakeState.None]=this._renderConversationEnded,this._renderers[d.SecureHandshakeState.OtherEndpointInUse]=this._renderSwitch,this._renderers[d.SecureHandshakeState.SentInvite]=this._renderInviteSent,this._renderers[d.SecureHandshakeState.GotInvite]=this._renderAcceptInvite,this._renderers[d.SecureHandshakeState.SentAccept]=this._renderRejectAcceptance,this._renderers[d.SecureHandshakeState.GotAccept]=this._renderConfirmAcceptance,this._renderers[d.SecureHandshakeState.SentSwitch]=this._renderDeviceSwitched,this._renderers[d.SecureHandshakeState.GotSwitch]=this._renderAcceptSwitch,this._failureRenderers[d.SecureHandshakeState.None]=this._renderOutgoingInvitationFailed,this._failureRenderers[d.SecureHandshakeState.OtherEndpointInUse]=this._renderSwitchDeviceFailed,this._failureRenderers[d.SecureHandshakeState.GotInvite]=this._renderAcceptanceFailed,this._failureRenderers[d.SecureHandshakeState.GotAccept]=this._renderConfirmationFailed,this._failureRenderers[d.SecureHandshakeState.GotSwitch]=this._renderSwitchAcceptanceFailed,o.lastFailingAction=M.None,o.busyButton=M.None):s.e2eeHandshakeState!==e.e2eeHandshakeState&&(o.lastFailingAction=M.None,o.busyButton=M.None),o}componentDidMount(){super.componentDidMount();(()=>{this.isComponentMounted()&&this._initialComponent&&this._initialComponent.requestFocus()})()}render(){const e=[I.container];let t;return t=this._isExpired()?this.state.lastFailingAction===M.None?this._renderExpiredState:this._renderOutgoingInvitationFailed:this.state.lastFailingAction===M.None?this._renderers[this.props.e2eeHandshakeState]:this._failureRenderers[this.props.e2eeHandshakeState],this.state.isUsingStackNavigationContext||this._getContext().isPresentedInDesktopSubview||e.push(I.containerComposite),(0,i.jsx)(r.View,Object.assign({style:e},{children:t()}),"E2eeHandshakeControl")}_isExpired(){return this.props.e2eeHandshakeState!==d.SecureHandshakeState.None&&this.props.e2eeHandshakeState!==d.SecureHandshakeState.OtherEndpointInUse&&this.props.e2eeHandshakeState!==d.SecureHandshakeState.Completed&&Date.now()>Date.parse(this.props.e2eeHandshake.ValidTill)+6e4}_renderTextLine(e,t,s=!1){const o=t?_.RowTitle:_.Caption;return(0,i.jsx)(o,Object.assign({ref:s?this._onInitialTitleRef:void 0,style:I.text,textThemeColor:_.TextThemeColor.Primary},{children:p.getParts(e,{buddy:this._renderBuddyName()})}),e)}_renderFocusableTextLine(e,t,s,o,n){return(0,i.jsx)(r.View,Object.assign({ref:this._onInitialFocusedTitleRef,tabIndex:0,importantForAccessibility:r.Types.ImportantForAccessibility.Auto,accessibilityLabel:n||p.getString(o)},{children:this._renderTextLine(e,t,s)}),"focused_"+e)}_renderStateWithTryAgainButton(e,t){return[this._renderTextLine(e,!0),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"tryAgainButton",ref:this._onInitialButtonRef,onPress:t,title:p.getString("E2eeHandshakeControl.TryAgainButton"),buttonSize:a.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===M.Primary}))]}_getPrimaryButtonConfig(){return{buttonStyle:this._useDarkTheme()?a.SXButtonStyle.LightFill:a.SXButtonStyle.DarkFill,style:I.button}}_getSecondaryButtonConfig(){return{buttonStyle:a.SXButtonStyle.Custom,buttonConfig:this._useDarkTheme()?w.dark:w.light,style:[I.button,I.secondaryButton]}}_sendInvite(e,t){const s=d.default.getBuddyAddress(this.props.e2eeHandshake).mri;S.default.maybeAnnounceForAccessibility(p.getString("ContentToDisplayTransformerBase.E2eeInvitationSent",{BParty:this.state.buddyName})),this._performAction(l.default.sendInvite(s,e),t)}_performAction(e,t,s=M.Primary){this.setState({busyButton:s});let i=this.state.lastFailingAction;e.catch((e=>{h.warn(c.LogTraceArea.E2EEncryption,'Failed to perform "'+t+'". Error: '+f.default.errorAsString(e)),i=s})).finally((()=>{this.isComponentMounted()&&this.setState({busyButton:M.None,lastFailingAction:i})}))}}t.default=P},974822:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(671830),r=s(898278),a=s(731761),l=s(746096),d=s(791771),c=s(436237),h=s(733754),u=s(451072),p=s(371639),g=s(106658),m=s(795691),S=s(210541),f=s(22222),y=s(24576);class v extends y.default{constructor(){super(...arguments),this._onPress=()=>{c.track(new d.InviteMorePeopleButtonClickedEvent(this.props.origin));new a.default({convId:n.asSkypeThreadIdMaybe(this.props.conversationId),navigationOrigin:l.NavigationConversationOrigin.InviteMorePeopleAfterJoinButton,peopleType:S.PeopleType.AllExcludingBots,filterPeopleType:S.FilterType.GroupCapable,wizardSteps:[m.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}}render(){let e=r.SXButtonSize.Medium;this.props.messageStreamFontSize!==g.MessageStreamFontSize.Normal&&(p.isFontLarge(this.props.messageStreamFontSize)?e=r.SXButtonSize.Large:p.isFontSmall(this.props.messageStreamFontSize)&&(e=r.SXButtonSize.Small));const t=(0,i.jsx)(f.default,{buttonSize:e,title:h.getString("MessageStream.InviteMorePeople"),onPress:void 0,importantForAccessibility:o.Types.ImportantForAccessibility.NoHideDescendants,tabIndex:-1,style:this.props.style});return(0,i.jsx)(u.default.View,Object.assign({onPress:this._onPress,keepOriginalProps:!0,accessibilityLabel:h.getString("MessageStream.InviteMorePeople"),accessibilityTraits:o.Types.AccessibilityTrait.Button},{children:t}))}}t.default=v},31894:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(77605),r=s(913944),a=s(915877),l=s(733754),d=s(89808),c=s(711828),h=s(24576),u=(0,a.lazyProperties)({button:()=>o.Styles.createViewStyle({width:c.IconSize.size40,height:c.IconSize.size40,borderWidth:1,borderRadius:c.IconSize.size30,justifyContent:"center",alignItems:"center",opacity:.9,overflow:"visible"}),hovered:()=>o.Styles.createViewStyle({opacity:1}),container:()=>o.Styles.createViewStyle({position:"absolute",width:c.IconSize.default,height:c.IconSize.default,overflow:"visible"}),badgeStyle:()=>o.Styles.createViewStyle({flex:0,position:"absolute",top:-6,bottom:-6,overflow:"visible",alignItems:"center",alignSelf:"flex-start"})});class p extends h.default{constructor(){super(...arguments),this._onPress=()=>{this.props.onPressCallback(this.props.optionalNumber||0)}}_buildState(e,t){return{visible:!t&&this.state.visible,gradientColors:d.default.getSubtleGradientColors()}}render(){if(!this.state.visible)return null;let e,t="0";if(this.props.optionalNumber&&this.props.optionalNumber>0){t=this.props.optionalNumber.toString(),this.props.optionalNumberOverflowed&&(t=l.getString("Global.CountOverflow",{count:t}));const s=!this._useAccessibleTheme()&&this.props.useColorBadge?this.state.gradientColors:void 0;e=(0,i.jsx)(n.default,{count:t,rawCount:this.props.optionalNumber,badgeSize:n.BadgeSize.Desktop,style:u.badgeStyle,gradientColors:s,fixedSize:!0})}const s=o.Styles.createViewStyle({borderColor:this._themeColors.pillBorderColor},!1),a=[u.button,this._themeStyles.buttonBackgroundColorStyle,s],d=(0,i.jsx)(r.default,{style:a,hoverStyle:u.hovered,size:c.IconSize.size20,onPress:this._onPress,color:this._themeColors.headerIconColor,hoverColor:this._themeColors.headerIconColor,icon:c.SkypeIcon.DownChevron,title:l.getString("MessageStream.JumpToLast",{count:t})}),h=[u.container,this.props.style];return(0,i.jsxs)(o.View,Object.assign({style:h},{children:[d,e]}))}setVisible(e){this.isComponentMounted()&&this.state.visible!==e&&this.setState({visible:e})}}t.default=p},678824:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(281878),n=s(667294),r=s(290123),a=s(796107),l=s(600750);t.default=(0,n.memo)((({isBottomSheetOpen:e,onBottomSheetClose:t,message:s,menuItems:d,onItemSelected:c,commands:h,onMoreButtonPressed:u})=>{const p=h.includes(l.CommandTypes.AddReaction),g=(0,n.useCallback)((()=>{t()}),[t]);return(0,i.jsx)(o.BottomSheet,Object.assign({isOpen:e,onClose:t},{children:(0,i.jsx)(o.Column,Object.assign({width:"100%",paddingX:"2"},{children:(0,i.jsxs)(o.ScrollView,Object.assign({maxHeight:"100%"},{children:[p?(0,i.jsx)(a.default,{message:s,onMoreButtonPressed:u,onReactionPressed:g}):null,(0,i.jsx)(r.default,{menuItems:d,onItemSelected:c})]}))}))}))}))},401340:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(281878),n=s(667294),r=s(705465),a=s(516778),l=s(746096),d=s(600212),c=s(812056),h=s(110117),u=s(711828),p=s(915877),g=s(311010),m=(0,p.lazyProperties)({icon:()=>a.Styles.createViewStyle({paddingRight:10})});t.default=(0,n.memo)((({menuItems:e,onItemSelected:t})=>{const{themeColors:{surfaceSecondary:s,surfacePrimary:n,textPrimary:a,iconDanger:p,textDanger:S}}=(0,d.useSkypeTheme)();return(0,i.jsx)(o.Column,Object.assign({width:"100%"},{children:e.map((e=>{const d=e.icon?(0,i.jsx)(o.Box,{children:(0,i.jsx)(h.default,{color:e.category===l.ItemCommandActionCategory.Destructive?p:a,style:m.icon,size:u.IconSize.size24,icon:e.icon})}):void 0;return(0,i.jsx)(r.Pressable,Object.assign({onPress:()=>t(e.command,c.MessageActionOrigin.StreamItem)},{children:(0,i.jsxs)(o.Row,Object.assign({paddingX:"16px",paddingY:"12px",borderBottomWidth:"1",borderBottomColor:n,backgroundColor:s,alignItems:"center"},{children:[d,(0,i.jsx)(r.Text,Object.assign({style:[e.category===l.ItemCommandActionCategory.Destructive?{color:S}:{color:a},{fontSize:g.default.fontSize.size15}]},{children:e.text}))]}))}),"command"+e.text)}))}))}))},290123:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(281878),r=s(667294),a=s(401340);t.default=(0,r.memo)((({menuItems:e,onItemSelected:t})=>{const s=(0,o.groupBy)(e,(e=>e.category));return(0,i.jsx)(n.Column,Object.assign({width:"100%"},{children:Object.entries(s).map((([e,s])=>(0,i.jsx)(n.Box,Object.assign({borderRadius:"10",marginTop:"10px",overflow:"hidden"},{children:(0,i.jsx)(a.default,{menuItems:s,onItemSelected:t})}),e)))}))}))},667806:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItem=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(396265),a=s(889391),l=s(351077),d=s(671830),c=s(887399),h=s(539549),u=s(899686),p=s(986374),g=s(229206),m=s(563032),S=s(475043),f=s(850513),y=s(46929),v=s(18078),C=s(932226),_=s(29130),b=s(536150),T=s(473970),M=s(24576),I=s(418037),w=s(912770),P=s(177878),k=s(853374),A=s(436237),x=s(746096),R=s(757139),O=s(966905),L=s(733754),F=s(805581),B=s(458666),D=s(293194),E=s(244570),V=s(330124),N=s(114161),U=s(342197),j=s(260021);class H extends M.default{constructor(){super(...arguments),this._onToggleTranslation=()=>{this.setState((e=>({showTranslatedMessage:!e.showTranslatedMessage})))},this._onToggleTranslateOne=()=>{if(this.state.showTranslatedMessage)S.default.setHidden(this.props.message.conversationId,this.props.message.cuid,!0),A.track(new N.ShowOriginalMessage(U.TranslateOneMessageToggleOrigin.ContextMenu,j.getCorrelationIdForMessage(this.props.message)));else{const e=!S.default.hasTranslatedMessage(this.props.message.conversationId,this.props.message.cuid);e&&f.default.requestTranslation(this.props.message.conversationId,this.props.message.cuid,this.props.message),S.default.setHidden(this.props.message.conversationId,this.props.message.cuid,!1),A.track(new N.TranslateOneMessage(U.TranslateOneMessageToggleOrigin.ContextMenu,j.getCorrelationIdForMessage(this.props.message),e))}},this._onShowOriginalMessage=()=>{S.default.setHidden(this.props.message.conversationId,this.props.message.cuid,!0);const e=k.default.newCauseId(),t=this._getRootViewId();R.default.close(t,e),A.track(new N.ShowOriginalMessage(U.TranslateOneMessageToggleOrigin.MessageMenu,j.getCorrelationIdForMessage(this.props.message)))},this._onChangeTranslateLanguage=()=>{const e=k.default.newCauseId(),t=this._getRootViewId(),s=a.default.getS4LCMCFeaturesNoSubscription().callTranslatorBotConfig.languageSupport.speech,i={anchor:()=>{},buttons:(0,E.getMenuButtons)([...s]),title:L.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLanguageTitle")};D.default.showWithActionMenuConfig({options:i,callback:s=>{y.default.setCallTranslatorBotSubtitleLanguageLocale(s),f.default.requestTranslation(this.props.message.conversationId,this.props.message.cuid,this.props.message),A.track(new N.ChangeLanguageAndTranslateOneMessage(U.TranslateOneMessageToggleOrigin.MessageMenu,j.getCorrelationIdForMessage(this.props.message),s)),R.default.close(t,e)},maintainAnchor:!1,rootViewId:t,useAlertForMobile:!0,useAlertForDesktop:(0,E.useAlertForDesktop)(),invokingEvent:void 0,allowScrolling:(0,E.useAlertForDesktop)()})},this._onToggleTranslateOptions=(e,t,s)=>{const o=k.default.newCauseId(),n=this._getRootViewId();A.log(x.LogTraceArea.MessageContent,`onToggleTranslateOptions causeId: ${o}`),A.track(new N.OpenTranslateMenu(U.TranslateOneMessageToggleOrigin.MessageMenu,j.getCorrelationIdForMessage(this.props.message)));const r=F.default.getLocalCallTranslatorBotSubtitleLanguageLocale(),a=r?B.getShortLanguageTitle(r):void 0,l=t?B.getLanguageOnlyTitle(t):void 0,d={langString:(s?B.getLanguageOnlyTitle(s):void 0)||a,sourceLangString:l,onShowOriginalMessage:this._onShowOriginalMessage,onChangeLang:this._onChangeTranslateLanguage},c=(0,i.jsx)(O.default,Object.assign({},d)),h=O.default.getMenuHeight();R.default.showWithContent({menuId:R.default.menuId(),anchor:()=>e,rootViewId:n,menuHeight:h,content:c,onCloseMenu:()=>R.default.close(n,o),getTitle:()=>this.state.isUsingStackNavigationContext?L.getString("Translator.TranslationOptions"):void 0,hideSubtitleDivider:!1},o)},this._onStreamItemViewRef=e=>this._streamItemViewRef=e||void 0}_buildState(e,t){const{sendingLieMaxDuration:s,enableParsingHtmlMessages:i,enableNoNetworkInfoOnSendingMessage:o,enableReportMessage:n}=a.default.getS4LMessagingFeatures(),r=this.props;let T;(t||r.message!==e.message||this.state.parseHtmlMessages!==i)&&(this._decodedNode=p.decode(e.message),this._decodedNode=(0,P.transformUnicodeEmojis)(this._decodedNode));const M=e.message.isBookmark();if(M){const t=l.getBookmarkMetadata(e.message.properties);t&&(T=t.bookmarkSourceCreatorId)}const k=M&&T?v.default.isMyMri(T):!e.message.isEphemeral()&&v.default.isMyMri(e.message.creator),A=b.default.isMobileScreenReaderEnabled(),x=(0,h.default)().getConversation(e.message.conversationId),R=!!x&&x.isModerated()&&x.isAdmin(v.default.getSkypeMri()),O=this._getRootViewId(),L=a.default.getS4LCMCFeatures().enableOneMessageTranslation,F=(e.isTranslatedConversation||L)&&S.default.hasTranslatedMessage(e.message.conversationId,e.message.cuid),B={skypeMessage:e.message,decodedNode:this._decodedNode,isReadOnly:e.isReadOnly,hasUnderlay:!1,containerMaxDimensions:e.containerInitialDimensions,layoutWidth:_.default.getWidth(O),isConversationAccepted:e.isConversationAccepted,isConversationBlocked:c.isConversationBlocked(e.message.conversationId),isConversationWithBot:d.isAgent(e.message.conversationId),isConversationTranslated:!!e.isTranslatedConversation,postedByBot:d.isAgent(e.message.creator),postedByCurrentUser:k,isCurrentUserActive:u.default.isCurrentUserActive(),renderOrigin:e.renderOrigin,messageFirstInGroup:e.isFirstInGroup,messageLastInGroup:e.isLastInGroup,isLastMessage:e.isLastMessage,isLastPhotoByCurrentUser:e.isLastPhotoByCurrentUser,disableReactions:e.disableReactions,disableForward:e.disableForward,disableMarkUnread:e.disableMarkUnread,isReportEnabled:n&&!e.disableReportMessage,isSelectMultipleMessagesEnabled:!e.disableSelectMultipleMessages,screenReaderEnabled:A,isModerator:R,isDisplayUrlPreviewsEnabled:y.default.getDisplayUrlPreviews(),themeStyles:this._themeStyles,themeColors:this._themeColors,colorTheme:this._currentTheme,flipBubbleColors:I.default.flipBubbleColors(),hasTranslation:F,isNewsChannel:!!e.isNewsChannel,isNewsBot:!!e.isNewsBot},D=g.getMessageRenderingOptions(B);let E,N;if(e.searchStore){const t=e.searchStore.getSearchQuery();t&&(N=t.messageId,E=t.query)}const U={renderingOptions:D,isMobileScreenReaderEnabled:A,postedByCurrentUser:k,rawSearchQuery:E,enableNoNetworkInfoOnSendingMessage:o,isSelectedMessage:N===e.message.cuid,hasTranslation:!!B.hasTranslation,showTranslatedMessage:e.isTranslatedConversation?!v.default.isMyMri(e.message.creator):!S.default.hasHiddenTranslation(e.message.conversationId,e.message.cuid),hasConnectivity:C.default.getConnectionStatus()!==C.ConnectionStatus.DisconnectedNoNetworkingReported,parseHtmlMessages:i,isUsingStackNavigationContext:V.default.isUsingStackNavigationContext()},j=D.messageViewRenderingOptions,H=e.message.isEditLie(),z=j.sendingStatus===m.MessageRenderSendingStatus.Sending;if(t||H){U.focusMessageViewForMobileScreenReader=!1,U.sendingLieTimerIsRunning=!1;const t=H?s:s-(Date.now()-e.message.createdTime);e.canPretendBeingSent&&z&&t>0&&(U.sendingLieTimerIsRunning=!0,this._sendingLieTimer=w.default.setTimeout((()=>{this._sendingLieTimer=void 0,this.isComponentMounted()&&this.setState({sendingLieTimerIsRunning:!1})}),t))}else!z&&this._sendingLieTimer&&(w.default.clearTimeout(this._sendingLieTimer),this._sendingLieTimer=void 0,U.sendingLieTimerIsRunning=!1);if(a.default.getS4LCMCFeatures().enableMessageTranslation&&U.hasTranslation&&l.hasQuote(e.message.content)){p.decode(e.message).getQuoteNodes().forEach((t=>{t&&t.cuid&&!S.default.hasTranslatedMessage(e.message.conversationId,t.cuid)&&f.default.maybeRequestTranslation(e.message.conversationId,t.cuid,void 0,t.children)}))}return U}componentDidMount(){super.componentDidMount(),this.props.onMountItem&&this.props.onMountItem(this,this.props.focusStreamItemForMobileScreenReader)}componentWillUnmount(){super.componentWillUnmount(),this._sendingLieTimer&&(w.default.clearTimeout(this._sendingLieTimer),this._sendingLieTimer=void 0)}focusItemForScreenReader(){this.isComponentMounted()&&this.setState({focusMessageViewForMobileScreenReader:!0})}render(){let e=this.state.renderingOptions.messageViewRenderingOptions;e.sendingStatus===m.MessageRenderSendingStatus.Sending&&(!this.state.hasConnectivity&&this.state.enableNoNetworkInfoOnSendingMessage?e=o.assign({},e,{sendingStatus:m.MessageRenderSendingStatus.NoNetwork}):this.state.sendingLieTimerIsRunning&&(e=o.assign({},e,{sendingStatus:m.MessageRenderSendingStatus.None})));let t=null;if(this.state.renderingOptions.renderOnlyUrlPreview||(t=(0,i.jsx)(r.Types.VirtualListCellContext.Consumer,{children:t=>(0,i.jsx)(T.StreamItemView,{ref:this._onStreamItemViewRef,message:this.props.message,rawSearchQuery:this.state.rawSearchQuery,isSelectedMessage:this.state.isSelectedMessage,decodedNode:this._decodedNode,postedByCurrentUser:this.state.postedByCurrentUser,renderOrigin:this.props.renderOrigin,ignoreProcessing:!1,screenReaderEnabled:this.state.isMobileScreenReaderEnabled,viewRenderingOptions:e,messageActions:this.state.renderingOptions.messageActions,suggestedTextHighlights:this.state.suggestedTextHighlights,onQuote:this.props.onQuote,onEdit:this.props.onEdit,onItemPress:this.props.onItemPress,onLayout:this.props.onLayout,onMarkAsUnread:this.props.onMarkAsUnread,onDisableScroll:this.props.onDisableScroll,onMountContent:this.props.onMountContent,onCopyContextMenu:this.props.onCopyContextMenu,onQuoteSelectionContextMenu:this.props.onQuoteSelectionContextMenu,onRevealInConvPress:this.props.onRevealInConvPress,isSelectMessagesModeActive:this.props.isSelectMessagesModeActive,shouldScreenReaderFocusItem:this.state.focusMessageViewForMobileScreenReader,getRootWindowComponent:this.props.getRootWindowComponent,messageStreamFontSize:this.props.messageStreamFontSize,linkedMessages:this.props.linkedMessages,hasTranslation:this.state.hasTranslation,conversationTranslated:this.props.isTranslatedConversation,onToggleTranslation:this._onToggleTranslation,onToggleTranslateOne:this._onToggleTranslateOne,onToggleTranslateOptions:this._onToggleTranslateOptions,showTranslatedMessage:this.state.showTranslatedMessage,searchStore:this.props.searchStore,onListItemDetails:t.onListItemDetails,hint:this.props.hint,isNewsChannel:this.props.isNewsChannel,isNewsBot:this.props.isNewsBot},"message-view"+this.props.message.cuid)})),!o.isEmpty(this.state.renderingOptions.urlPreviewRenderInformation)&&!this.props.isNewsChannel){const e=o.map(this.state.renderingOptions.urlPreviewRenderInformation,((e,t)=>{const s=e.urlPreviewData.url+t;return(0,i.jsx)(r.Types.VirtualListCellContext.Consumer,{children:t=>(0,i.jsx)(T.StreamItemView,{urlPreviewId:s,message:this.props.message,rawSearchQuery:this.state.rawSearchQuery,isSelectedMessage:this.state.isSelectedMessage,decodedNode:this._decodedNode,postedByCurrentUser:this.state.postedByCurrentUser,renderOrigin:this.props.renderOrigin,ignoreProcessing:!0,urlPreviewOnly:this.state.renderingOptions.renderOnlyUrlPreview,urlPreviewData:e.urlPreviewData,viewRenderingOptions:e.viewRenderOptions,messageActions:e.urlPreviewActions,suggestedTextHighlights:this.state.suggestedTextHighlights,screenReaderEnabled:this.state.isMobileScreenReaderEnabled,onQuote:this.props.onQuote,onEdit:this.props.onEdit,onItemPress:this.props.onItemPress,onLayout:this.props.onLayout,onMarkAsUnread:this.props.onMarkAsUnread,onDisableScroll:this.props.onDisableScroll,onMountContent:this.props.onMountContent,isSelectMessagesModeActive:this.props.isSelectMessagesModeActive,getRootWindowComponent:this.props.getRootWindowComponent,messageStreamFontSize:this.props.messageStreamFontSize,searchStore:this.props.searchStore,onListItemDetails:t.onListItemDetails,isNewsChannel:this.props.isNewsChannel},s)},"context-"+s)}));t=(0,i.jsxs)(n.View,{children:[t,e]})}return t}copySelection(e){if(this._streamItemViewRef)return this._streamItemViewRef.copySelection(e)}quoteSelection(){if(this._streamItemViewRef)return this._streamItemViewRef.quoteSelection()}}t.StreamItem=H},676214:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemAccessory=t.getAccessoryWidth=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(244770),a=s(889391),l=s(719061),d=s(351077),c=s(671830),h=s(662602),u=s(139285),p=s(913944),g=s(110117),m=s(915877),S=s(647662),f=s(733754),y=s(563032),v=s(18078),C=s(104735),_=s(638693),b=s(600750),T=s(581760),M=s(711828),I=s(24576),w=s(172758),P=s(758962),k=s(934339),A=s(473970),x=s(680837),R=s(29130);t.getAccessoryWidth=e=>e?24:44;const O=e=>e?0:20,L=(0,m.lazyProperties)({sendingIndicator:()=>n.Styles.createViewStyle({height:20,width:20}),sendingIndicatorDark:()=>n.Styles.createViewStyle({opacity:.5}),statusItemContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"center",alignItems:"center",justifyContent:"flex-start",paddingHorizontal:8}),statusItemContainerSender:()=>n.Styles.createViewStyle({justifyContent:"flex-end"}),outerButtonReceiver:()=>n.Styles.createViewStyle({paddingLeft:8,paddingBottom:4,paddingTop:2}),outerButtonSender:()=>n.Styles.createViewStyle({paddingRight:8}),outerButtonHeightSingle:()=>n.Styles.createViewStyle({height:39}),outerButtonContainer:()=>n.Styles.createViewStyle({alignItems:"flex-end"}),forwardButtonPaddingTopCorrection:()=>n.Styles.createViewStyle({paddingTop:8,marginTop:2}),forwardButtonAlignment:()=>n.Styles.createViewStyle({justifyContent:"flex-start"}),goToOriginalMessageButton:()=>n.Styles.createViewStyle({flexGrow:1,flexDirection:"column",minWidth:48}),goToOriginalMessageIcon:()=>n.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"flex-end",alignSelf:"flex-end"}),flexGrow:()=>n.Styles.createViewStyle({flexGrow:1,alignItems:"stretch"}),accessoryIconsContainer:()=>n.Styles.createViewStyle({flexGrow:1,justifyContent:"space-between",overflow:"visible"}),footerStreamItemAccessory:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between",flex:1,overflow:"visible"}),justifyEnd:()=>n.Styles.createViewStyle({justifyContent:"flex-end"}),accessoryIcon:()=>n.Styles.createViewStyle({padding:5,flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:T.Color.white,marginTop:6,marginLeft:5,marginBottom:2})});class F extends I.default{constructor(){super(...arguments),this._onForwardKeyPress=e=>h.default.maybeHandleKeyPress(e,this._onForward),this._onForward=()=>{!this.props.disableActions&&this.props.onCommandSelected&&this.props.onCommandSelected(b.CommandTypes[b.CommandTypes.Forward])},this._onNavigateToBookmarkSource=()=>{C.default.navigateToBookmarkSource(this.props.message().properties)}}_buildState(e,t){return{isMinDesktop:R.default.isMinDesktopWidth(this._getRootViewId())&&!e.isUsingStackNavigationContext}}render(){const e=this._getMessageStatusView(),t=this.props.showOuterButtons?this._getOuterButtons(!!e):void 0;if(!e&&o.isUndefined(t))return null;const s=[(this.props.isNewsBot||this.props.isNewsChannel)&&this.props.accessoryOrigin===A.AccessoryOrigin.StreamItemFooter?L.accessoryIconsContainer:L.outerButtonContainer,this.props.message().isBookmark()?L.flexGrow:void 0];return this.props.paddingStyle&&s.push(this.props.paddingStyle),(0,i.jsxs)(n.Animated.View,Object.assign({style:[s,this.props.containerAnimationStyle]},{children:[t,e]}),"accessoryContainer")}_getOuterButtons(e){const s=this._themeColors.secondaryTextColor,o=T.Color.gray500,r=this.props.commands&&this.props.commands.indexOf(b.CommandTypes.AddReaction)>=0,d=v.default.isMyMri(this.props.creator);let c;const h=(this.props.isNewsBot||this.props.isNewsChannel)&&this.props.accessoryOrigin===A.AccessoryOrigin.StreamItemFooter,u=this.props.isNewsChannel&&this.props.accessoryOrigin===A.AccessoryOrigin.StreamItemFooter,g=[L.accessoryIcon,x.default.shadowLightStyle],m=n.Styles.createViewStyle({width:(0,t.getAccessoryWidth)(this.state.isMinDesktop),paddingRight:O(this.state.isMinDesktop)}),S=n.Styles.createViewStyle({paddingLeft:O(this.state.isMinDesktop)});if(!this.props.disableActions&&this.props.commands&&this.props.commands.indexOf(b.CommandTypes.Forward)>=0&&l.default.canForwardMessage()){const e=[L.outerButtonReceiver,m,L.outerButtonHeightSingle,L.forwardButtonAlignment,d?L.outerButtonSender:void 0,d?S:void 0];r&&e.push(L.forwardButtonPaddingTopCorrection);const t=(e=>{const{enableForwardItemIconForStreamItems:t}=a.default.getS4LMessagingFeaturesNoSubscription();let s=e?M.SkypeIcon.ShareiOS:M.SkypeIcon.Send;return t&&(s=M.SkypeIcon.ForwardItem),s})(h),l=P.getFrameHeight(k.Size.Small)+10,u=n.Styles.createViewStyle({height:l,borderRadius:l/2},!1);g.push(u),c=(0,i.jsx)(p.default,{color:h?o:s,hoverColor:h?o:s,icon:t,title:f.getString("StreamItem.ActionForward"),onPress:this._onForward,onKeyPress:this._onForwardKeyPress,size:M.IconSize.size20,style:h?void 0:e,flipIcon:this._getContext().isRTL,showHoverEffect:!0},"forward-button")}let y;if(r){const t=[L.outerButtonReceiver,d?L.outerButtonSender:void 0,m,d?S:void 0];c||e||t.push(L.outerButtonHeightSingle),y=(0,i.jsx)(_.default,{message:this.props.message,isMessageKnownByServer:this.props.isMessageKnownByServer,colorOverride:h?o:s,sizeOverride:u?M.IconSize.size20:M.IconSize.size16,style:u?g:t,disableAction:this.props.disableActions,anchorOffset:(C=this.state.isMinDesktop,(8-O(C))/2),isNewsChannel:this.props.isNewsChannel},"reaction-icon-button")}var C;let I;if(this.props.message().isBookmark()&&(I=(0,i.jsx)(p.default,{color:s,hoverColor:s,icon:M.SkypeIcon.RightChevron,title:f.getString("BookmarksConversation.GoToOriginalMessageButtonTitle"),onPress:this._onNavigateToBookmarkSource,size:u?M.IconSize.size20:M.IconSize.size16,style:L.goToOriginalMessageButton,flipIcon:this._getContext().isRTL,showHoverEffect:!0,iconTextStyle:L.goToOriginalMessageIcon},"chevron-button")),y&&!u)return y;if(c||I){const e=h?(0,i.jsx)(n.View,Object.assign({style:g},{children:c})):c,t=h?[L.footerStreamItemAccessory]:[L.flexGrow];return h&&this.props.isNewsBot&&t.push(L.justifyEnd),(0,i.jsxs)(n.View,Object.assign({style:t},{children:[y,e,I]}))}}_getMessageStatusView(){let e;const s=d.isMessageSms(this.props.messagetype),o=v.default.isMyMri(this.props.creator),{enableNewSendingStateStrategy:l}=a.default.getS4LMessagingFeaturesNoSubscription();if(this.props.showEditIcon||this.props.sendingStatus!==y.MessageRenderSendingStatus.None||s){let a,h;if(this.props.sendingStatus===y.MessageRenderSendingStatus.Failed)h=f.getString("StreamItem.MessageError"),this.props.isConversationAccepted||c.isPhoneMri(this.props.conversationId)||this.props.messagetype!==d.MessageTypes.Media_GenericFile||w.default.getFullUserProfileByMriAsync(this.props.conversationId).then((e=>{if(e){const t=S.getLocalizeParamForGender(e.gender);h=f.getString("StreamItem.FileMessageErrorBeforeFriendshipInvitation",{user:e.getShortName(),gender:t})}})),a=(0,i.jsx)(g.default,{icon:M.SkypeIcon.Error,size:M.IconSize.size16,color:T.Color.pink});else if(this.props.showEditIcon)a=(0,i.jsx)(g.default,{icon:M.SkypeIcon.Topic,size:M.IconSize.size16,color:T.Color.gray200}),h=f.getString("StreamItem.MessageEdited");else if(s&&o){let e=M.SkypeIcon.MobileSending,t=f.getString("SMSMessaging.SmsSendingStatus"),s=!1;this.props.smsDeliveryStatus&&(d.isSmsDeliveredSuccessfully(this.props.smsDeliveryStatus)?(e=M.SkypeIcon.MobileOk,t=f.getString("SMSMessaging.SmsOkStatus")):(e=M.SkypeIcon.MobileError,t=f.getString("SMSMessaging.SmsErrorStatus"),s=!0)),a=(0,i.jsx)(g.default,{icon:e,size:M.IconSize.size16,color:s?T.Color.red:T.Color.gray200}),h=t}else this.props.sendingStatus!==y.MessageRenderSendingStatus.Sending||l?this.props.sendingStatus!==y.MessageRenderSendingStatus.NoNetwork||l||(a=(0,i.jsx)(g.default,{icon:M.SkypeIcon.Recent,size:M.IconSize.size16,color:T.Color.gray200}),h=f.getString("StreamItem.SendingNoNetwork")):(a=(0,i.jsx)(n.Image,{style:[L.sendingIndicator,this._useDarkTheme()?L.sendingIndicatorDark:void 0],source:this._useDarkTheme()?r.Collection.SENDING_INDICATOR_DARK:r.Collection.SENDING_INDICATOR_LIGHT,resizeMode:"contain"}),h=f.getString("StreamItem.Sending"));const p=n.Styles.createViewStyle({width:(0,t.getAccessoryWidth)(this.state.isMinDesktop)}),m=[L.statusItemContainer,p,o?L.statusItemContainerSender:void 0];e=(0,i.jsx)(u.default,Object.assign({style:m,title:h},{children:a}),"statusIcon")}return e}}t.StreamItemAccessory=F},546529:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemCommandManager=void 0;const i=s(496486),o=s(481169),n=s(147204),r=s(733754),a=s(812056),l=s(403709),d=s(600750),c=s(293194),h=c.default.menuId();t.StreamItemCommandManager=class{_getAllCommands(e){return i.keyBy(i.compact([l.addReaction(e),l.saveMedia(e),l.saveFileAs(e),l.saveMediaAs(e),l.viewInChat(e),l.editMessage(e),l.quoteMessage(e),l.quoteSelection(e),l.searchSelection(e),l.removeMessage(e),l.cancelSendMessage(e),l.cancelEditMessage(e),l.cancelFailedSend(e),l.retryFailedSend(e),l.copyLinkMessage(e),l.copyMessage(e),l.copyImage(e),l.copyLocationMessage(e),l.openFileLocation(e),l.openMediaLocation(e),l.markReadToHere(e),l.forwardMessage(e),l.translateMessage(e),l.translateOneMessage(e),l.bookmarkMessage(e),l.reportMessage(e),l.selectMessages(e),l.viewLink(e),l.cancelScheduledCall(e),l.editScheduledCall(e),l.showReportedMessage(e),l.cancelPoll(e),l.debugDumpMessage(e),l.debugDumpMessagePretty(e)]),(e=>e.command))}_getSimpleCommands(e){return i.keyBy(i.compact([l.quoteSelection(e),l.searchSelection(e),l.copyMessage(e)]),(e=>e.command))}constructor(e){this._onCommandSelected=e}onActionMenuOptionSelected(e,t,s){const i=this._getAllCommands(e)[d.CommandTypes[t]];i&&i.onCommandSelected(s)}showActionMenu(e,t,s,n,l,u,p,g){const m=this._getAllCommands(e),S=(0,o.chain)(u,(0,o.sortBy)(i.identity),(0,o.map)((e=>m[e])),(0,o.filter)((e=>!!e&&(!e.isVisible||!!e.isVisible&&e.isVisible())))),f=(0,o.chain)(S,(0,o.map)((e=>e.command)),(0,o.findLastIndex)((e=>d.CommandTypes.Remove===e||d.CommandTypes.CancelFailedSend===e||d.CommandTypes.CancelSend===e||d.CommandTypes.Report===e||d.CommandTypes.CancelScheduledCall===e||d.CommandTypes.CancelPoll===e))),y=i.map(S,(e=>({text:r.getString(e.localizationKey),command:d.CommandTypes[e.command]})));if(!i.isEmpty(y)){const e={anchor:t,useTheme:!0};c.default.showWithOptions({id:h,config:e,getMenuItems:()=>y,handleMenuCommand:e=>this._onCommandSelected(e,{rootViewId:s},a.MessageActionOrigin.StreamItemActionMenu),menuTitle:l,onDismiss:g,destructiveButtonIndex:f,rootViewId:s,invokingEvent:p})}}getSXMenuItems(e,t,s){const n=s?this._getSimpleCommands(e):this._getAllCommands(e);return(0,o.chain)(t,(0,o.sortBy)(i.identity),(0,o.map)((e=>n[e])),(0,o.filter)((e=>!!e&&(!e.isVisible||!!e.isVisible&&e.isVisible()))),(0,o.map)((e=>({text:r.getString(e.localizationKey,e.localizationKeyParameters?e.localizationKeyParameters:void 0),command:d.CommandTypes[e.command],category:e.category,icon:e.icon,disabled:e.disabled}))))}showSXPopup(e,t,s,i,o,n,r){const l=this.getSXMenuItems(e,t);if(0===l.length||!i())return!1;const d={anchor:i,useTheme:!0,positionPriorities:["bottom","right","left","top"],popupBeakSize:{width:0,height:0}};return c.default.showWithOptions({id:s,config:d,getMenuItems:()=>l,handleMenuCommand:e=>this._onCommandSelected(e,{rootViewId:o},a.MessageActionOrigin.StreamItemPopup),onDismiss:r,rootViewId:o,invokingEvent:n})}dismissSXPopup(e,t){n.default.dismissPopup(e,t)}}},464975:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemContent=void 0;const i=s(785893),o=s(496486),n=s(78339),r=s(516778),a=s(47447),l=s(770891),d=s(786994),c=s(915877),h=s(183503),u=s(723752),p=s(563032),g=s(422929),m=s(371639),S=s(106658),f=s(538165),y=s(178735),v=s(29130),C=s(600750),_=s(581760),b=s(311010),T=s(711828),M=s(680837),I=s(24576),w=(0,c.lazyProperties)({lightTextStyle:()=>r.Styles.createTextStyle({color:_.Color.white}),atMentionStyle:()=>r.Styles.createTextStyle({font:b.default.font.uiDisplayBold}),quoteSymbolDarkThemeStyle:()=>r.Styles.createTextStyle({color:_.Color.whiteOverlay50}),quoteSeparatorStyle:()=>r.Styles.createViewStyle({borderColor:_.Color.white,borderBottomWidth:1}),quoteAttributeStyle:()=>r.Styles.createTextStyle({fontSize:b.default.controlFontSize.messageStreamQuoteAttributeDesktop}),textStyle:()=>r.Styles.createTextStyle({font:b.default.font.uiDisplayRegular,overflow:"visible"}),textAlignCenter:()=>r.Styles.createTextStyle({textAlign:"center"}),translateLinkStyle:()=>r.Styles.createTextStyle({marginTop:6,opacity:.6})});class P extends I.default{constructor(){super(...arguments),this._onCopy=(e,t,s)=>{g.default.add(this.props.skypeMessage.conversationId,this.props.skypeMessage.mergePartialUpdate({content:s}),t,e)},this._onCopySelectionContainerRef=e=>{this._selectionContainerRef=e||void 0}}_buildState(e,t){return{isSmallOrTinyScreenSize:v.default.isSmallOrTinyScreenSize(this._getRootViewId()),enableMultiMessageQuoteOnKeyboard:d.copyAllowed(y.default.getUserPreferencesLocal().pasteAsQuotesEnabled,e.skypeMessage.messagetype)}}render(){const{messageTextOverrideColorStyle:e,quoteAttributeOverrideColorStyle:t,quoteColor:s}=this.props.viewRenderingOptions.viewColorProperties,d=o.compact([w.textStyle,e]),c=[w.textStyle,w.quoteAttributeStyle,t,r.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1)];let g;const y={size:T.IconSize.size24,color:null!=s?s:_.Color.gray400},v=[],I=[w.translateLinkStyle,e],{themeColors:P}=this._getContext(),k=[r.Styles.createViewStyle({backgroundColor:P.messageStreamBackgroundColor},!1)];let A;if(this.props.useLightText&&(g=w.quoteSeparatorStyle,y.color=_.Color.whiteOverlay50,d.push(w.lightTextStyle),I.push(w.lightTextStyle)),this.props.viewRenderingOptions.messageContentCentered&&d.push([b.default.fontStyle.caption,w.textAlignCenter,this._themeStyles.secondaryTextColorStyle]),this.props.messageStreamFontSize&&this.props.messageStreamFontSize!==S.MessageStreamFontSize.Normal){const e=b.default.controlFontSize.messageStreamItemDesktop,t=m.getStyle(e,this.props.messageStreamFontSize),s=m.getStyle(b.default.controlFontSize.messageStreamQuoteAttributeDesktop,this.props.messageStreamFontSize);d.push(t),v.push(t),c.push(s),A=m.getSize(e,this.props.messageStreamFontSize)}const x=this.props.viewRenderingOptions.sendingStatus,R={allowLargeEmoticons:!0,emoticonsOnlyEmoticonSize:this.props.emoticonsOnlyEmoticonSize,singleEmoticonSize:this.props.singleEmoticonSize,allowHugeEmoticons:this.props.allowHugeEmoticons,allowTextSelection:!this.props.disableTextSelection,disableActions:this.props.disableActions,isDraggingEnabled:this.props.viewRenderingOptions.isDraggingEnabled,onPressInterceptionCallback:this.props.onSelectMessageCallback,activeOpacityOverride:this.props.activeOpacityOverride,renderOrigin:this.props.renderOrigin,allowTextFallbackEmoticons:!0,mojiProps:{metadataAlign:this.props.postedByCurrentUser?l.MojiMetadataAlign.Left:l.MojiMetadataAlign.Right,size:this.state.isSmallOrTinyScreenSize||this._getContext().isPresentedInDesktopSubview?l.MojiSize.Medium:l.MojiSize.ExtraLarge,hideMetadata:!1},hideSendingIndicators:x!==p.MessageRenderSendingStatus.Sending,forceStaticAnimatedEmoticons:!this.props.viewRenderingOptions.shouldAnimateEmoticons,mojiBackgroundColor:this._themeColors.messageStreamBackgroundColor,renderLocation:this.props.viewRenderingOptions.showLocationCard,leftPaddingSwiftCarousel:this.props.leftPaddingForUserIcon,supportsCopy:a.UICapabilities.copyTextToClipboardSupported(),messageActions:this.props.messageActions,isRetryCommandSupported:h.isCommandSupported(this.props.messageActions,C.CommandTypes.RetryFailedSend),availableSpace:this.props.availableSpace,constrainedDimensions:this.props.constrainedDimensions,mediaPlaceholderIconColor:this._useDarkTheme()?this._themeColors.secondaryTextColor:this.props.postedByCurrentUser?void 0:this._themeColors.bubbleReactionColorOther,suggestedTextHighlights:this.props.suggestedTextHighlights,fontSize:A,textOverrideStyle:d,atMentionStyle:w.atMentionStyle,atMentionMeOverrideStyle:[w.atMentionStyle,M.default.defaultCursor],quoteAttributeStyle:c,quoteSeparatorStyle:g,quoteSymbolStyle:y,callMarkerStyle:v,translationLinkStyle:I,translationIconStyle:k,urlPreviewThumbnailRadiusStyle:this.props.viewRenderingOptions.urlPreviewThumbnailRadiusStyle,containerRadiusStyle:this.props.viewRenderingOptions.messageContainerRadiusStyle,linkStyle:this._themeStyles.linkTextColorStyle,urlPreviewData:this.props.urlPreviewData,urlPreviewOnly:this.props.urlPreviewOnly,obfuscateUrlPreview:this.props.viewRenderingOptions.obfuscateUrlPreview,overrideLongPressForLinks:this.props.viewRenderingOptions.overrideLongPressForLinks,onMountContent:this.props.onMountContent,onDisableScroll:this.props.onDisableScroll,onPress:this.props.onPress,onLongPressContent:this.props.onLongPressContent,onContextMenu:this.props.onContextMenu,onContentHorizontalScroll:this.props.onContentHorizontalScroll,onThumbnailLoaded:this.props.onThumbnailLoaded,onQuote:this.props.onQuote,onEdit:this.props.onEdit,isMessageInSendingState:f.isMessageInSendingState(this.props.skypeMessage,this.props.renderOrigin),onSelectableText:this.props.onSelectableText,maxContentSizeMultiplier:5,messagePadding:this.props.messagePadding,linkedMessages:this.props.linkedMessages,hasTranslation:this.props.hasTranslation,showTranslatedMessage:this.props.showTranslatedMessage,conversationTranslated:this.props.conversationTranslated,onToggleTranslation:this.props.onToggleTranslation,onToggleTranslateOptions:this.props.onToggleTranslateOptions},O=(0,i.jsx)(u.default,{message:this.props.skypeMessage,rawSearchQuery:this.props.rawSearchQuery,isSelectedMessage:this.props.isSelectedMessage,preDecodedMessage:this.props.decodedNode,options:R,atMentionSymbolStyle:d,disableActions:this.props.disableActions,searchStore:this.props.searchStore});return this.state.enableMultiMessageQuoteOnKeyboard?(0,i.jsx)(n.default,Object.assign({ref:this._onCopySelectionContainerRef,onCopy:this._onCopy},{children:O})):O}copySelection(e){if(this._selectionContainerRef)return this._selectionContainerRef.copySelection(e)}quoteSelection(){if(this._selectionContainerRef)return this._selectionContainerRef.quoteSelection()}}t.StreamItemContent=P},204354:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemFooter=void 0;const i=s(785893),o=s(516778),n=s(217041),r=s(934339),a=s(915877),l=s(502989),d=s(581760),c=s(115888),h=(0,a.lazyProperties)({reactionCountItem:()=>o.Styles.createViewStyle({marginTop:6}),reactionCountItemForOutsideFooter:()=>o.Styles.createViewStyle({borderColor:d.Color.gray100,borderWidth:1,borderStyle:"solid"}),reactionContainer:()=>o.Styles.createViewStyle({marginRight:5,flexDirection:"row",flexWrap:"wrap",alignSelf:"flex-start",overflow:"visible"}),reactionContainerNoMargin:()=>o.Styles.createViewStyle({marginRight:0,flexShrink:1}),reactionContainerOutside:()=>o.Styles.createViewStyle({marginTop:6,marginBottom:10}),streamItemFooter:()=>o.Styles.createViewStyle({overflow:"visible",alignSelf:"flex-start"}),streamItemAccessoryFooter:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",flex:1,overflow:"visible",paddingLeft:5,paddingRight:10})});class u extends n.ComponentBase{render(){const e=[h.reactionContainer,this.props.streamItemAccessory?h.reactionContainerNoMargin:void 0];let t;return this.props.showReactionsOverlay?t=h.reactionCountItem:(t=h.reactionCountItemForOutsideFooter,e.push(h.reactionContainerOutside)),this.props.style&&e.push(this.props.style),this.props.overlayStyle&&void 0===this.props.streamItemAccessory&&e.push(this.props.overlayStyle),(0,i.jsxs)(o.View,Object.assign({style:this.props.streamItemAccessory?[h.streamItemAccessoryFooter,this.props.overlayStyle]:h.streamItemFooter},{children:[(0,i.jsx)(l.default,{style:e,message:this.props.message,reactionSize:r.Size.Small,itemStyle:t,anchorPositionAnywhere:!0,disableAction:this.props.disableAction,suppressSingleCounts:this.props.suppressSingleCounts,showShadows:this.props.showShadows,constrainedWidth:this.props.constrainedWidth,isNewsChannel:this.props.isNewsChannel}),this.props.streamItemAccessory?this.props.streamItemAccessory:void 0,this.props.hint&&!this.props.streamItemAccessory?(0,i.jsx)(c.default,{icon:this.props.hint.icon,hintMessage:this.props.hint.hintMessage}):void 0]}))}}t.StreamItemFooter=u},575068:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemHeader=void 0;const i=s(785893),o=s(809206),n=s(516778),r=s(719061),a=s(671830),l=s(952262),d=s(101889),c=s(139285),h=s(110117),u=s(915877),p=s(733754),g=s(563032),m=s(371639),S=s(106658),f=s(18078),y=s(201118),v=s(404057),C=s(581760),_=s(311010),b=s(711828),T=s(680837),M=s(24576),I=s(702301),w=s(567977),P=s(889391),k=(0,u.lazyProperties)({text:()=>n.Styles.createTextStyle({backgroundColor:C.Color.transparent,flex:1,paddingBottom:2}),textMe:()=>n.Styles.createTextStyle({textAlign:"right",paddingBottom:2}),containerSpacingCarouselMe:()=>n.Styles.createViewStyle({paddingRight:10}),containerBottomPadding:()=>n.Styles.createViewStyle({paddingBottom:2}),userIconContainerSmallDevice:()=>n.Styles.createViewStyle({marginRight:8,overflow:"visible",position:"absolute"}),userIconContainer:()=>n.Styles.createViewStyle({marginRight:10,overflow:"visible",position:"absolute"}),headerContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",overflow:"visible"}),headerContainerMe:()=>n.Styles.createViewStyle({justifyContent:"flex-end"}),headerContainerRevealInConv:()=>n.Styles.createViewStyle({justifyContent:"space-between"}),headerTextContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),marginLeft:()=>n.Styles.createViewStyle({marginLeft:5}),groupIconStyles:()=>n.Styles.createViewStyle({marginLeft:3,alignSelf:"flex-start"}),bookmarkIconStyles:()=>n.Styles.createTextStyle({marginLeft:5,paddingBottom:2}),bookmarkOverrideHeaderStyles:()=>n.Styles.createTextStyle({alignSelf:"flex-start"}),bookmarkHeaderContainerStyles:()=>n.Styles.createTextStyle({flexDirection:"row",flexShrink:1}),revealInConvButton:()=>n.Styles.createTextStyle({color:C.Color.blue,flexDirection:"row",justifyContent:"flex-end"}),iconStyle:()=>n.Styles.createTextStyle({marginRight:3,justifyContent:"center"})});class A extends M.default{constructor(){super(...arguments),this._userIconAnimatedOpacityValue=new n.Animated.Value(1),this._userIconAnimatedOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._userIconAnimatedOpacityValue}),this._handleRevealButtonPress=e=>{var t,s;null===(s=(t=this.props).onRevealInConvPress)||void 0===s||s.call(t,e,this.props.message)}}static getUserIconWidth(e){return e?w.UserIconSize.Size30+8:w.UserIconSize.Size40+10}_buildState(e,t){let s="";e.showSenderName&&(e.postedByCurrentUser?e.postedByCurrentUser&&(s=p.getString("DisplayInfoStore.ListMyName")):s=this._computeRemoteSenderShortName(e.conversationId,e.creatorMri));let i="";e.showMessageTimestamp&&e.sendingStatus!==g.MessageRenderSendingStatus.NoNetwork&&(i=e.sendingStatus!==g.MessageRenderSendingStatus.Sending||P.default.getS4LMessagingFeatures().enableNewSendingStateStrategy?e.displayDateTime||"":p.getString("StreamItem.Sending"));const o=a.isBookmarkConversation(e.conversationId);let n="";return n=s?p.getString("StreamItem.MessageHeader",{senderName:s,timestamp:i}).trim():i,{headerText:n,displayName:s,userIconSize:w.UserIconSize.Size30,myUserSkypeMri:f.default.getSkypeMri(),isBookmarksThread:o}}_computeRemoteSenderShortName(e,t){return l.default.getMemberShortNameForConversation(e,t)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.props.isContentScrolledOverHeader!==e.isContentScrolledOverHeader&&this._animateUserIcon(this.props.isContentScrolledOverHeader)}render(){const e=[k.headerContainer];!this.props.postedByCurrentUser||this.props.alignLeft||this.state.isBookmarksThread||e.push(k.headerContainerMe),this.props.style&&e.push(this.props.style);const t=void 0!==this.props.onRevealInConvPress,s=this._getUserIconElement(),o=this._getHeaderTextElement(t);if(!s&&!o)return null;const r=o&&this._getOptionalHeaderTextWrapped(o,t),a=(0,i.jsx)(h.default,{icon:b.SkypeIcon.Eye,size:b.IconSize.size12,color:this._themeColors.iconInteractive,style:k.iconStyle}),l=n.Styles.combine(_.default.fontStyle.caption,[k.revealInConvButton,n.Styles.createTextStyle({color:this._themeColors.textInteractive},!1)]),d=t?(0,i.jsxs)(n.Button,Object.assign({onPress:this._handleRevealButtonPress,style:l},{children:[a,(0,i.jsx)(n.Text,{children:p.getString("RevealMedia.GalleryRevealButton")})]})):void 0;return d&&e.push(k.headerContainerRevealInConv),(0,i.jsxs)(n.View,Object.assign({style:e,importantForAccessibility:this.props.importantForAccessibility,accessibilityLabel:this.props.accessibilityLabel,accessibilityTraits:this.props.accessibilityTraits,accessibilityActions:this.props.accessibilityActions,onAccessibilityAction:this.props.onAccessibilityAction},{children:[s,r,d]}))}_getOptionalHeaderTextWrapped(e,t){const s=this._getBookmarkIconElement();if(!s)return e;const o=n.Styles.combine(k.headerTextContainer);return(0,i.jsxs)(n.View,Object.assign({style:o},{children:[e,s]}))}_getBookmarkIconElement(){if(r.default.canBookmarkMessage()&&this.props.isBookmarkedMessage)return(0,i.jsx)(c.default,Object.assign({title:p.getString("StreamItem.MessageBookmarked")},{children:(0,i.jsx)(h.default,{icon:b.SkypeIcon.Bookmarked,size:b.IconSize.size12,color:this._themeColors.secondaryTextColor,style:k.bookmarkIconStyles})}))}_getUserIconElement(){if(this.props.showUserIcon){let e,t;this.props.isSmallDevice?(t=k.userIconContainerSmallDevice,e=w.UserIconSize.Size30):(t=k.userIconContainer,e=w.UserIconSize.Size40),this.setState({userIconSize:e});const s=void 0;return this.props.contentScrollEnabled?(0,i.jsx)(n.Animated.View,Object.assign({style:[t,this._userIconAnimatedOpacityStyle],importantForAccessibility:s},{children:(0,i.jsx)(I.UserIcon,{size:e,userMri:this.props.creatorMri,enableNavigation:!this.props.disableActions&&!this.props.postedByCurrentUser,conversationId:this.props.conversationId,showHoverEffect:!1,hideBlockedOverlay:r.default.allowGroupInteractionBetweenBlockedParticipants(this.state.myUserSkypeMri,this.props.creatorMri),message:this.props.message})})):(0,i.jsx)(I.UserIcon,{size:e,style:t,userMri:this.props.creatorMri,enableNavigation:!this.props.disableActions&&!this.props.postedByCurrentUser,importantForAccessibility:s,conversationId:this.props.conversationId,showHoverEffect:!1,hideBlockedOverlay:r.default.allowGroupInteractionBetweenBlockedParticipants(this.state.myUserSkypeMri,this.props.creatorMri),message:this.props.message})}}_getTextToHighlight(){const e=v.default.deburrLowerCase(this.props.rawSearchQuery||"");return e&&y.nameContainsSearchQuery(this.state.displayName,e)?e:""}_animateUserIcon(e){n.Animated.timing(this._userIconAnimatedOpacityValue,{toValue:e?0:1,easing:e?n.Animated.Easing.Out():n.Animated.Easing.In(),duration:300,isInteraction:!1}).start()}_getHeaderTextElement(e){if(this.state.headerText){const e=[k.text,_.default.fontStyle.caption,n.Styles.createTextStyle({color:this._themeColors.textSecondary},!1)];this.props.showUserIcon&&e.push(n.Styles.createTextStyle({marginLeft:this._getHeaderTextContainerMarginLeft()},!1));const t=this.props.postedByCurrentUser&&!this.props.alignLeft;if(t&&e.push(k.textMe),(this.props.isBookmarkedMessage||this.state.isBookmarksThread)&&e.push(k.bookmarkOverrideHeaderStyles,k.containerBottomPadding),this.props.messageStreamFontSize&&this.props.messageStreamFontSize!==S.MessageStreamFontSize.Normal){const t=m.getStyleFromStyle(e,this.props.messageStreamFontSize);e.push(t)}const s=this._getTextToHighlight();return this._isCarouselOnNative(t)&&e.push(k.containerSpacingCarouselMe),s&&!this.props.isUsingStackNavigationContext?(0,i.jsx)(d.default,{selectable:!(o.default.isMobile()||this.props.disableActions),containerStyles:e,inlineTextStyle:[],displayText:this.state.headerText,textToHighlight:s,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants}):this.state.isBookmarksThread&&this.props.bookmarkSourceConversationName?this._getBookmarkStreamItemHeader():(0,i.jsx)(n.Text,Object.assign({selectable:!(o.default.isMobile()||this.props.disableActions),ellipsizeMode:"middle",style:e,numberOfLines:1,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants},{children:this.state.headerText}))}}_getBookmarkStreamItemHeader(){let e;this.props.bookmarkSourceConversationName&&this.props.bookmarkSourceConversationId&&(e=a.isGroupConversation(this.props.bookmarkSourceConversationId)?(0,i.jsx)(h.default,{color:this._themeColors.secondaryTextColor,size:b.IconSize.size14,icon:b.SkypeIcon.ContactGroup,style:k.groupIconStyles}):void 0);const t=[_.default.fontStyle.caption,this._themeStyles.secondaryTextColorStyle],s=(0,i.jsx)(n.Text,Object.assign({style:[k.marginLeft,T.default.flexOne,t],numberOfLines:1},{children:this.props.bookmarkSourceConversationName})),o=[k.bookmarkHeaderContainerStyles,k.containerBottomPadding,n.Styles.createViewStyle({marginLeft:this._getHeaderTextContainerMarginLeft()},!1)];return(0,i.jsxs)(n.View,Object.assign({style:o,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants},{children:[(0,i.jsx)(n.Text,Object.assign({style:t},{children:this.state.displayName+" >"})),e,s,(0,i.jsx)(n.Text,Object.assign({style:t},{children:", "+this.props.displayDateTime}))]}))}_isCarouselOnNative(e){return!!(e&&this.props.isUsingStackNavigationContext&&this.props.isCarousel)}_getHeaderTextContainerMarginLeft(){return this.state.userIconSize+(this.props.isSmallDevice?8:10)}}t.StreamItemHeader=A},115888:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(915877),r=s(535772),a=(0,n.lazyProperties)({hintContainer:()=>o.Styles.createViewStyle({paddingVertical:6})});t.default=({hintMessage:e,icon:t})=>(0,i.jsx)(o.View,Object.assign({style:a.hintContainer},{children:(0,i.jsx)(r.default,{icon:t,hintMessage:e})}))},498812:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemOptionsMenu=void 0;const i=s(785893),o=s(516778),n=(s(889391),s(662602)),r=s(913944),a=s(110117),l=s(648638),d=s(915877),c=s(733754),h=s(106658),u=s(581760),p=s(711828),g=s(680837),m=s(24576),S=s(912770),f=(0,d.lazyProperties)({container:()=>o.Styles.createViewStyle({width:h.streamItemOptionsMenuWidth,paddingRight:22,alignItems:"flex-end",overflow:"visible"}),containerHeight:()=>o.Styles.createViewStyle({height:h.streamItemOptionsMenuHeight}),containerInDesktopSubview:()=>o.Styles.createViewStyle({width:h.streamItemOptionsMenuWidthInDesktopSubview,paddingRight:4}),buttonCentering:()=>o.Styles.createViewStyle({paddingLeft:h.streamItemOptionsMenuWidth}),buttonCenteringInDesktopSubview:()=>o.Styles.createViewStyle({paddingLeft:h.streamItemOptionsMenuWidthInDesktopSubview}),buttonStyle:()=>o.Styles.createButtonStyle({alignSelf:"flex-end",justifyContent:"center",alignItems:"center",width:24,height:24,borderRadius:12}),goToOriginalMessageButton:()=>o.Styles.createViewStyle({flexGrow:1,alignItems:"flex-end",marginTop:h.headerTextHeight}),bookmarkUIoverrides:()=>(0,d.lazyProperties)({container:()=>o.Styles.createViewStyle({width:2*h.streamItemOptionsMenuWidth,flexDirection:"row",justifyContent:"space-between",flexGrow:1,flexShrink:0,alignItems:"stretch"}),buttonStyle:()=>o.Styles.createButtonStyle({alignSelf:"flex-start",marginTop:15,marginLeft:5})})});class y extends m.default{constructor(){super(...arguments),this._onMoreButtonRef=e=>{this._moreButton=e||void 0},this._onMouseEnter=e=>{this._isMouseOver=!0,this.state.canShowButton||this._optionsButtonTimer||(this._optionsButtonTimer=S.default.setTimeout((()=>{this._optionsButtonTimer=void 0,this.isComponentMounted()&&this.setState({canShowButton:!0})}),200))},this._onMouseLeave=e=>{this._isMouseOver=!1,this._optionsButtonTimer&&(S.default.clearTimeout(this._optionsButtonTimer),this._optionsButtonTimer=void 0),this.state.canShowButton&&!o.UserInterface.isNavigatingWithKeyboard()&&this.setState({canShowButton:!1})},this._onPopupDismiss=()=>{this.isComponentMounted()&&this.setState({isShowingMenu:!1})},this._onOptionsButtonKeyPress=e=>n.default.maybeHandleKeyPress(e,(()=>{this._onOptionsButtonPress(e)})),this._onOptionsButtonPress=e=>{if(e.stopPropagation(),this.state.isShowingMenu)this.props.onButtonPress(e,!1,(()=>this._moreButton)),this.setState({isShowingMenu:!1});else{const t=!1,s=this.props.onButtonPress(e,!0,(()=>this._moreButton),t?void 0:this._onPopupDismiss);s&&!t&&this.setState({isShowingMenu:s})}}}_buildState(e,t){const s=l.default.isNavigatingWithKeyboard(),i={};return t?(i.canShowButton=s,i.isShowingMenu=!1):this.state&&(!this.state.canShowButton&&s?i.canShowButton=!0:!this.state.canShowButton||s||this._isMouseOver||(i.canShowButton=!1)),i}componentWillUnmount(){super.componentWillUnmount(),this._optionsButtonTimer&&(S.default.clearTimeout(this._optionsButtonTimer),this._optionsButtonTimer=void 0)}render(){const e=[this.props.style];return this.props.onSelect&&e.push(g.default.pointerCursor),this.props.messageContentCentered&&e.push(this._getContext().isPresentedInDesktopSubview?f.buttonCenteringInDesktopSubview:f.buttonCentering),(0,i.jsxs)(o.View,Object.assign({style:e,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,onPress:this.props.onSelect,onLayout:this.props.onLayout},{children:[this.props.children,this._renderOptionsButton()]}),"options-menu"+this.props.id)}_renderOptionsButton(){let e,t;const s=[f.container,this.props.useBookmarkUI?void 0:f.containerHeight];if(this._getContext().isPresentedInDesktopSubview&&s.push(f.containerInDesktopSubview),this.props.useBookmarkUI&&s.push(f.bookmarkUIoverrides.container),(this.state.isShowingMenu||this.state.canShowButton)&&this.props.renderOptionsButton){const s=[f.buttonStyle];let n=u.Color.white;this.props.useBookmarkUI&&s.push(f.bookmarkUIoverrides.buttonStyle),this.state.isShowingMenu?s.push(this._useAccessibleTheme()?this._themeStyles.primaryViewColorStyle:this._themeStyles.buttonBackgroundHoverColorStyle):n=this._themeColors.secondaryTextColor;const r=c.getString("Global.MoreOptions");e=(0,i.jsx)(o.Button,Object.assign({ref:this._onMoreButtonRef,style:s,onPress:this._onOptionsButtonPress,onKeyPress:this._onOptionsButtonKeyPress,title:r,accessibilityTraits:[o.Types.AccessibilityTrait.Button,o.Types.AccessibilityTrait.HasPopup]},{children:(0,i.jsx)(a.default,{icon:this.props.useBookmarkUI?p.SkypeIcon.More:p.SkypeIcon.MoreVertical,color:n,size:this.props.useBookmarkUI?p.IconSize.size16:p.IconSize.size12})})),t=this._getOptionalGoToOriginalMessageButton()}return(0,i.jsxs)(o.View,Object.assign({style:s},{children:[e,t]}))}_getOptionalGoToOriginalMessageButton(){return this.props.useBookmarkUI?(0,i.jsx)(r.default,{icon:p.SkypeIcon.RightChevron,color:this._themeColors.secondaryTextColor,size:p.IconSize.size16,style:f.goToOriginalMessageButton,hoverColor:this._themeColors.iconHoverColor,onPress:this.props.onSecondaryButtonPress,title:c.getString("BookmarksConversation.GoToOriginalMessageButtonTitle")}):void 0}}t.StreamItemOptionsMenu=y},917795:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(147204),n=s(581760),r=s(79669),a=s(418037);t.default=class{constructor(e,t,s,i){this.dismissPopup=this._createDismissPopup(),this._onClose=this._createOnClose(t),this._anchor=e,this._rootViewId=s,this._rootViewType=i}show(){if(!this._anchor||!this._anchor())return!1;const e=a.default.isDarkThemeNoSubscription()?a.default.themeColorsNoSubscription().dividerColor:n.Color.black,t={getAnchor:()=>this._anchor&&this._anchor(),renderPopup:(t,s,o,a)=>(0,i.jsx)(r.default,Object.assign({anchorPosition:t,anchorOffset:this._overrideAnchorOffset(s),offset:this._getOffset(),popupWidth:this._getPopupWidth(o),popupHeight:a,strokeColor:e,fillColor:n.Color.black,paddingInPopupCanvas:this._getPaddingInPopupCanvas(),popupAccessibilityTitle:this._getAccessibilityTitle(),borderRadius:10,containerStyle:this._getContainerStyle(),onOrientationChanged:this.dismissPopup},{children:this._getPopupContent(t,s,o,a)})),positionPriorities:["top","bottom"],onDismiss:()=>{this._onClose&&this._onClose()},dismissIfShown:!0,cacheable:this._isCacheable(),rootViewId:this._rootViewId,rootViewType:this._rootViewType,useScopedPopupId:!0};return o.default.showPopup(t,this._getPopupId())}_createOnClose(e){return()=>{e&&e(),this._anchor=void 0,this._onClose=void 0}}_createDismissPopup(){return()=>o.default.dismissPopup(this._getPopupId(),this._rootViewId,!0)}_getOffset(){}_overrideAnchorOffset(e){return e}_getPaddingInPopupCanvas(){}_isCacheable(){return!1}_getContainerStyle(){}_getPopupWidth(e){return e}}},235108:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(905531),r=s(816402),a=s(915877),l=s(733754),d=s(451072),c=s(18078),h=s(581760),u=s(311010),p=s(680837),g=s(619675),m=s(24576),S=s(418037),f=s(702301),y=s(567977),v=(0,a.lazyProperties)({itemContainer:()=>o.Styles.createViewStyle({flexDirection:"row",flex:1,backgroundColor:h.Color.transparent,alignItems:"center"}),textContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row"}),mainText:()=>o.Styles.createTextStyle({flex:-1,fontSize:u.default.fontSize.size17,fontFamily:u.default.fontFamily.uidDisplayRegular,color:h.Color.white,paddingLeft:10,paddingRight:10,alignSelf:"center"}),meText:()=>o.Styles.createTextStyle({color:h.Color.gray100,alignSelf:"center",paddingLeft:5}),timeStampStyle:()=>o.Styles.createTextStyle({alignSelf:"flex-end",paddingBottom:1}),accessibleTimeStampColor:()=>o.Styles.createTextStyle({color:h.Color.white})});class C extends m.default{constructor(){super(...arguments),this._onPress=()=>{this.props.onItemPress(this.props.userMri)}}_buildState(e,t){return{isMe:c.default.isMyMri(e.userMri),accessibleTheme:S.default.isAccessibleTheme(),canAccessUserDetails:n.default.navigation().canAccessUserDetails}}render(){const e=[v.itemContainer,this.props.style],t=this.state.canAccessUserDetails&&!this.state.isMe;e.push(t?p.default.pointerCursor:p.default.defaultCursor);let s=this.props.buttonTitle;return this.props.timestamp&&(s+=", "+r.default.getDisplayDateTimeMixedString(this.props.timestamp)),(0,i.jsxs)(d.default.View,Object.assign({style:e,onPress:t?this._onPress:void 0,accessibilityTraits:t?o.Types.AccessibilityTrait.Button:o.Types.AccessibilityTrait.Summary,importantForAccessibility:t?o.Types.ImportantForAccessibility.Yes:o.Types.ImportantForAccessibility.No,accessibilityLabel:s,activeOpacity:t?.8:void 0},{children:[(0,i.jsx)(f.UserIcon,{userMri:this.props.userMri,size:y.UserIconSize.Size32,style:t?p.default.pointerCursor:p.default.defaultCursor}),this._getUserNameElement()]}),"item"+this.props.userMri)}_getUserNameElement(){const e=(0,i.jsx)(o.Text,Object.assign({style:v.mainText,numberOfLines:1},{children:this.props.displayName}));let t,s;if(this.props.timestamp){const e=[u.default.fontStyle.caption,v.timeStampStyle];this.state.accessibleTheme&&e.push(v.accessibleTimeStampColor),t=(0,i.jsx)(o.Text,Object.assign({style:e,numberOfLines:1},{children:r.default.getDisplayDateTimeMixedString(this.props.timestamp)}))}return this.props.showMeLabel&&this.state.isMe&&(s=(0,i.jsx)(g.BodyText,Object.assign({size:g.BodyTextSize.SmallDeprecated,style:v.meText,numberOfLines:1},{children:l.getString("ReactionSummaryListViewItem.MeLabel")}))),(0,i.jsxs)(o.View,Object.assign({style:v.textContainer},{children:[e,s,t]}))}}t.default=C},851972:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemQuotesGestureWrapper=void 0;const i=s(785893),o=s(665768),n=s(516778),r=s(812854),a=s(913944),l=s(915877),d=s(733754),c=s(711828),h=s(24576),u=(0,l.lazyProperties)({quickQuotesStyleContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",overflow:"visible"}),gestureContainerStyle:()=>n.Styles.createViewStyle({overflow:"visible",flex:1}),quoteMessageIconContainer:()=>n.Styles.createViewStyle({position:"absolute",width:150,flexDirection:"row",alignItems:"center"}),quoteIconPadding:()=>n.Styles.createTextStyle({paddingHorizontal:4})});class p extends h.default{constructor(){super(...arguments),this._quotesButtonOpacityValue=new n.Animated.Value(0),this._quotesButtonOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._quotesButtonOpacityValue}),this._didDisableScrolling=!1,this._hapticFeedbackSent=!1,this._onPanViewQuickQuote=e=>{const t=e.pageX-e.initialPageX,s=Math.abs(t),i=t>=0;if(r.default.prepareFeedback(),!i)return void this._resetMessageContainerPosition();this.state.showQuickQuotesIcon||this.setState({showQuickQuotesIcon:!0}),this._disableScrolling(!0),this.props.onGestureStartStopCallback&&this.props.onGestureStartStopCallback(!0),t>20&&!this.state.showIconText?this.setState({showIconText:!0}):t<20&&this.state.showIconText&&this.setState({showIconText:!1}),this.props.positionToAnimateOnSwipe.setValue(this.props.initialPositionValue+t),s>50?this._quotesButtonOpacityValue.setValue(1):this._quotesButtonOpacityValue.setValue(s/50);const o=s>50;!this._hapticFeedbackSent&&o&&(this._hapticFeedbackSent=!0,r.default.triggerFeedback().then((()=>{r.default.unprepareFeedback()}))),e.isComplete&&(o&&(this.props.onQuotesCommandTrigger(),this._hapticFeedbackSent=!1),this._resetMessageContainerPosition())}}_buildState(e,t){const s={};return t&&(s.showQuickQuotesIcon=!1),s}render(){const e=this.state.showIconText?d.getString("StreamItem.ActionReply"):"",t=this.state.showQuickQuotesIcon?(0,i.jsxs)(n.Animated.View,Object.assign({style:[u.quoteMessageIconContainer,this._quotesButtonOpacityStyle]},{children:[(0,i.jsx)(a.default,{icon:c.SkypeIcon.Reply,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.secondaryTextColor,size:c.IconSize.size20,style:u.quoteIconPadding}),(0,i.jsx)(n.Text,Object.assign({style:[this._themeStyles.secondaryTextColorStyle,u.quoteIconPadding]},{children:e}))]})):void 0;return(0,i.jsxs)(n.View,Object.assign({style:u.quickQuotesStyleContainer},{children:[t,(0,i.jsx)(n.GestureView,Object.assign({onPanHorizontal:this._onPanViewQuickQuote,panPixelThreshold:20,preferredPan:n.Types.PreferredPanGesture.Horizontal,releaseOnRequest:!1,importantForAccessibility:n.Types.ImportantForAccessibility.No,style:u.gestureContainerStyle},{children:this.props.children}),"streamViewGesture")]}))}_resetMessageContainerPosition(){n.Animated.parallel([n.Animated.timing(this.props.positionToAnimateOnSwipe,{toValue:this.props.initialPositionValue,duration:o.Common.Duration.Default,easing:o.Easing.SkypeExpoInOut5,useNativeDriver:!0}),n.Animated.timing(this._quotesButtonOpacityValue,{toValue:0,duration:o.Common.Duration.Default,easing:o.Easing.SkypeExpoInOut5,useNativeDriver:!0})]).start((()=>{this._disableScrolling(!1),this.props.onGestureStartStopCallback&&this.props.onGestureStartStopCallback(!1),this.isComponentMounted()&&this.state.showQuickQuotesIcon&&this.setState({showQuickQuotesIcon:!1,showIconText:!1})}))}_disableScrolling(e){this.props.onDisableScroll&&(e?this._didDisableScrolling||(this.props.onDisableScroll(!0),this._didDisableScrolling=!0):this._didDisableScrolling&&(this.props.onDisableScroll(!1),this._didDisableScrolling=!1))}}t.StreamItemQuotesGestureWrapper=p},858774:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemReadReceipts=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(436237),a=s(915877),l=s(733754),d=s(106658),c=s(812056),h=s(70665),u=s(123281),p=s(144487),g=s(311010),m=s(619675),S=s(24576),f=s(702301),y=s(567977),v=s(889391),C=(s(536150),s(952262),s(816402),(0,a.lazyProperties)({container:()=>n.Styles.createButtonStyle({flexDirection:"row",justifyContent:"flex-end",maxWidth:d.maxStreamContentWidth,marginHorizontal:10,alignItems:"center",alignSelf:"flex-end"}),containerComposite:()=>n.Styles.createButtonStyle({marginLeft:50,marginRight:50}),containerCompositeMobile:()=>n.Styles.createButtonStyle({marginRight:16}),avatarStyle:()=>n.Styles.createViewStyle({marginLeft:4}),textView:()=>n.Styles.createTextStyle({marginLeft:4,lineHeight:g.default.controlFontSize.bodyBigDeprecated})})),_={};class b extends S.default{constructor(){super(...arguments),this._onContainerRef=e=>{e&&(this._containerButton=e)},this._getContainerButton=()=>this._containerButton,this._showPopup=()=>{this._readReceiptsPopup||(this._navDismissalRegistrationHandle=h.register({dismiss:this._onClosePopup}),this._readReceiptsPopup=new u.ReadReceiptsPopup(this.props.conversationId,this.props.readReceiptsSum,this._getContainerButton,this._onClosePopup,this._getRootViewId(),this._getRootViewType()),this._readReceiptsPopup.show(),r.track(new c.ReadReceiptsViewed(this.props.readReceiptsHeads.length,this.props.readReceiptsSum.length,this.props.conversationId)))},this._onClosePopup=()=>{this._readReceiptsPopup=void 0,this.isComponentMounted()&&this._containerButton&&this._containerButton.requestFocus&&this._containerButton.requestFocus(),this._navDismissalRegistrationHandle&&(h.unregister(this._navDismissalRegistrationHandle),this._navDismissalRegistrationHandle=void 0)}}_buildState(e,t){const s=this._getRootViewId(),{enableNewSendingStateStrategy:i}=v.default.getS4LMessagingFeatures();return{hideReadReceipts:p.default.isSelectMessagesModeActive(s),enableNewSendingStateStrategy:i,readReceiptAccessibilitySummary:undefined}}render(){const e=o.map(o.slice(this.props.readReceiptsHeads,0,3),(e=>(0,i.jsx)(f.UserIcon,{size:y.UserIconSize.Size16,userMri:e.mri,style:C.avatarStyle,showTitleOnHover:!this.state.hideReadReceipts},e.mri)));if(this.props.readReceiptsHeads.length>3){const t=this.state.hideReadReceipts?"":l.getString("StreamItem.ClickToSeeMoreReadReceiptsTitle");e.push((0,i.jsx)(n.View,Object.assign({title:t},{children:(0,i.jsx)(m.Caption,Object.assign({style:C.textView},{children:"+"+(this.props.readReceiptsHeads.length-3)}))}),"additionalCounter"))}if(!this.state.hideReadReceipts&&this.state.readReceiptAccessibilitySummary){const t=l.getString("StreamItem.ReadBySummaryAccessibilityLabel",{count:this.props.readReceiptsSum.length,summary:this.state.readReceiptAccessibilitySummary});return(0,i.jsx)(n.View,Object.assign({style:this._getContainerStyles(),ref:this._onContainerRef,accessibilityLabel:t,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityTraits:n.Types.AccessibilityTrait.Summary},{children:e}))}return(0,i.jsx)(n.Button,Object.assign({},this._getCommonContainerProps(),{children:e}))}componentWillUnmount(){super.componentWillUnmount(),this._readReceiptsPopup&&(this._readReceiptsPopup.dismissPopup(),this._readReceiptsPopup=void 0)}_getCommonContainerProps(){return{style:this._getContainerStyles(),onPress:this._showPopup,ref:this._onContainerRef,accessibilityLabel:l.getString("StreamItem.ReadByMarkerAccessibilityLabel",{count:this.props.readReceiptsSum.length}),importantForAccessibility:this.state.hideReadReceipts?n.Types.ImportantForAccessibility.NoHideDescendants:n.Types.ImportantForAccessibility.Yes,accessibilityTraits:this.state.hideReadReceipts?n.Types.AccessibilityTrait.None:void 0,disableTouchOpacityAnimation:this.state.hideReadReceipts,tabIndex:this.state.hideReadReceipts?-1:void 0,disabledOpacity:0,disabled:this.state.hideReadReceipts}}_getHeightStyle(e){return _[e]||(_[e]=n.Styles.createButtonStyle({height:e},!1)),_[e]}_getContainerStyles(){const e=[C.container,this._getHeightStyle(this.props.availableHeight)];return this._getContext().isPresentedInDesktopSubview?this.state.enableNewSendingStateStrategy&&e.push(C.containerCompositeMobile):e.push(C.containerComposite),e}}t.StreamItemReadReceipts=b},393327:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemTailAccessoryWrapper=void 0;const i=s(785893),o=s(516778),n=s(217041),r=s(351077),a=s(915877),l=s(733754),d=s(680837),c=s(619675),h=(0,a.lazyProperties)({accessory:()=>(0,a.lazyProperties)({smsFailedText:()=>o.Styles.createTextStyle({flex:1,textAlign:"right",paddingBottom:4,paddingTop:1})})});class u extends n.ComponentBase{_shouldWrapWithSmsFailed(){return!!this.props.smsDeliveryStatus&&!r.isSmsDeliveredSuccessfully(this.props.smsDeliveryStatus)}_wrapWithSmsFailed(){return(0,i.jsxs)(o.View,Object.assign({style:d.default.flexOne},{children:[this.props.children,(0,i.jsx)(c.Caption,Object.assign({style:h.accessory.smsFailedText,textThemeColor:c.TextThemeColor.Destructive},{children:l.getString("SMSMessaging.SmsDeliveryFailed")}))]}))}render(){return this._shouldWrapWithSmsFailed()?this._wrapWithSmsFailed():this.props.children?o.Children.only(this.props.children):null}}t.StreamItemTailAccessoryWrapper=u},473970:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemView=t.shouldShowExternalShareButton=t.AccessoryOrigin=void 0;const i=s(570655),o=s(785893),n=s(496486),r=s(583367),a=s(809206),l=s(705465),d=s(516778),c=s(665768),h=s(273145),u=s(587134),p=s(110117),g=s(374606),m=s(293194),S=s(451072),f=s(680837),y=s(24576),v=(s(711930),s(18078)),C=s(640363),_=s(317873),b=s(812056),T=s(346200),M=s(451096),I=s(445026),w=s(886045),P=s(889391),k=s(360305),A=s(104735),x=s(178735),R=s(46929),O=s(330124),L=s(827357),F=s(29130),B=(s(536150),s(418037)),D=s(816402),E=s(436237),V=s(733754),N=s(10909),U=s(404057),j=s(746096),H=s(581760),z=s(711828),W=s(911698),G=s(478262),K=s(788952),q=s(106658),Q=s(45227),X=s(988523),$=s(400984),J=s(957122),Y=s(172758),Z=s(400451),ee=s(915877),te=s(912770),se=s(853374),ie=s(861253),oe=s(798406),ne=s(647738),re=s(986374),ae=s(351077),le=s(671830),de=(s(183503),s(382677)),ce=s(584876),he=s(795133),ue=s(82433),pe=s(518606),ge=s(144487),me=s(106658),Se=s(600750),fe=s(770891),ye=s(676214),ve=s(546529),Ce=s(464975),_e=s(204354),be=s(575068),Te=s(498812),Me=s(851972),Ie=s(393327),we=s(429791),Pe=s(563032),ke=s(678824),Ae=s(437490),xe=s(383290),Re=s(539549);var Oe;!function(e){e[e.StreamItemFooter=1]="StreamItemFooter"}(Oe=t.AccessoryOrigin||(t.AccessoryOrigin={}));const Le="stream-item-sx-popup",Fe=Se.CommandTypes.SelectMessages,Be=C.default.isRTL()?35:-35,De=z.IconSize.size12,Ee=(0,ee.lazyProperties)({innerStreamItemView:()=>(0,ee.lazyProperties)({containerStyle:()=>d.Styles.createViewStyle({flex:-1,alignItems:"stretch"}),containerStyleNews:()=>d.Styles.createViewStyle({flex:1,maxWidth:q.newsChannelMediaCardMaxWidth,alignItems:"stretch"}),desktopContainerStyle:()=>d.Styles.createViewStyle({minHeight:me.streamItemOptionsMenuHeight}),desktopContainerShrinkStyle:()=>d.Styles.createViewStyle({flexGrow:0}),containerSpacing:()=>(0,ee.lazyProperties)({paddingBottomRegular:()=>d.Styles.createViewStyle({paddingBottom:14}),paddingBottomSmall:()=>d.Styles.createViewStyle({paddingBottom:10}),paddingBottomComposite:()=>d.Styles.createViewStyle({paddingBottom:14}),paddingBottomCompositeSmall:()=>d.Styles.createViewStyle({paddingBottom:8}),paddingBottomWithReactions:()=>d.Styles.createViewStyle({paddingBottom:0}),paddingBottomWithReactionsOverlay:()=>d.Styles.createViewStyle({paddingBottom:24})}),footerSpacing:()=>(0,ee.lazyProperties)({paddingLeftRegular:()=>d.Styles.createViewStyle({paddingLeft:14}),paddingLeftSmall:()=>d.Styles.createViewStyle({paddingLeft:10}),paddingLeftComposite:()=>d.Styles.createViewStyle({paddingLeft:15}),noPaddingLeft:()=>d.Styles.createViewStyle({paddingLeft:0}),marginTop:()=>d.Styles.createViewStyle({top:-22,marginBottom:-22,paddingBottom:4}),marginTopRecorderVideos:()=>d.Styles.createViewStyle({top:-3,marginBottom:-3}),paddingBottomWithReactions:()=>d.Styles.createViewStyle({paddingBottom:25})}),messageContentSpacing:()=>(0,ee.lazyProperties)({regular:()=>(0,ee.lazyProperties)({WithBubble:()=>d.Styles.createViewStyle({paddingLeft:14,paddingRight:14,paddingTop:14})}),compact:()=>(0,ee.lazyProperties)({WithBubble:()=>d.Styles.createViewStyle({paddingLeft:9,paddingRight:12,paddingTop:8})}),compositeRegular:()=>(0,ee.lazyProperties)({WithBubble:()=>d.Styles.createViewStyle({paddingLeft:15,paddingRight:15,paddingTop:14})}),compositeCompact:()=>(0,ee.lazyProperties)({WithBubble:()=>d.Styles.createViewStyle({paddingLeft:11,paddingRight:12,paddingTop:9})})})}),streamItemViewWithButtons:()=>(0,ee.lazyProperties)({wrapper:()=>d.Styles.createViewStyle({flex:1,justifyContent:"flex-start",flexDirection:"row"}),wrapperCenter:()=>d.Styles.createViewStyle({justifyContent:"center"}),wrapperMe:()=>d.Styles.createViewStyle({justifyContent:"flex-end"})}),messageContainer:()=>d.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch"}),messageContainerPadding:()=>d.Styles.createViewStyle({paddingHorizontal:10}),headerLeftPadding:()=>(0,ee.lazyProperties)({smallDevice:()=>d.Styles.createViewStyle({paddingLeft:8}),regularDevice:()=>d.Styles.createViewStyle({paddingLeft:10}),desktop:()=>d.Styles.createViewStyle({paddingLeft:40})}),accessoryTopPadding:()=>d.Styles.createViewStyle({paddingTop:me.headerTextHeight}),accessoryNoPadding:()=>d.Styles.createViewStyle({paddingTop:0,paddingBottom:0}),messageSelection:()=>(0,ee.lazyProperties)({messageSelectionContainer:()=>d.Styles.createViewStyle({flexDirection:"row",alignContent:"center",overflow:"visible"}),messageWithTimeStampContainer:()=>d.Styles.createViewStyle({marginTop:20}),selectionContainerPosition:()=>d.Styles.createViewStyle({position:"absolute",paddingLeft:10,alignSelf:"center"})}),icon:()=>d.Styles.createViewStyle({marginRight:-De-2,paddingLeft:2,alignSelf:"flex-end"}),mobileSideDistance:()=>d.Styles.createViewStyle({paddingRight:16})});let Ve=800;r.default.getMaxViewSizeForTexture().then((e=>{Ve=e}),(e=>{E.warn(j.LogTraceArea.StreamItem,"DeviceUtilities getMaxViewSizeForTexture failed: "+U.default.errorAsString(e))}));const Ne={};t.shouldShowExternalShareButton=(e,t,s,i)=>(t||s)&&e===ae.MessageTypeGroups.SwiftCard&&!i||!1;class Ue extends y.default{constructor(){super(...arguments),this._innerMovingContainerXOffsetValue=new d.Animated.Value(0),this._innerMovingContainerXOffsetStyle=d.Styles.createAnimatedViewStyle({transform:[{translateX:this._innerMovingContainerXOffsetValue}]}),this._selectContainerOpacityValue=new d.Animated.Value(1),this._selectContainerXOffsetValue=new d.Animated.Value(0),this._selectionContainerXOffsetStyle=d.Styles.createAnimatedViewStyle({transform:[{translateX:this._selectContainerXOffsetValue}]}),this._selectionContainerOpacityStyle=d.Styles.createAnimatedViewStyle({opacity:this._selectContainerOpacityValue}),this._dimIconsOpacityValue=new d.Animated.Value(1),this._dimIconsOpacityStyle=d.Styles.createAnimatedViewStyle({opacity:this._dimIconsOpacityValue}),this._xBase=0,this._onExternalShareMobile=e=>i.__awaiter(this,void 0,void 0,(function*(){const t=this.props.isNewsChannel?j.LogTraceArea.NewsChannel:j.LogTraceArea.NewsBot,s=this.props.isNewsChannel?ne.ArticleReaderOrigin.NewsChannel:ne.ArticleReaderOrigin.NewsBot;if(E.log(t,"External share action"),!e)return;const i=yield Y.default.getFullUserProfileByMriAsync(v.default.getSkypeMri()),o=null==i?void 0:i.getDisplayName(),n=new Promise((e=>{setTimeout((()=>{e(void 0)}),2e3)})),r=J.default.fetchLinkAsPromise(o);Promise.race([r,n]).then((i=>{l.Share.share({message:(0,oe.getExternalShareMessage)(e,o,i),url:e},{dialogTitle:V.getString("Browser.Share")}).then((e=>{e.action===l.Share.sharedAction&&(E.log(t,"External share action was executed"),E.track(new M.TodayShareTelemetry(ne.TodayShareActionTelemetry.SharedExternallyAction,s)))})),E.track(new M.TodayShareTelemetry(ne.TodayShareActionTelemetry.OpenedExternalShare,s))}))})),this._toggleReactionBottomSheet=()=>{this.setState({isBottomSheetOpened:!this.state.isBottomSheetOpened}),this.state.isBottomSheetOpened&&Ae.dismissAll()},this._onExternalShareDesktop=(e,t)=>{const s=this.props.isNewsChannel?j.LogTraceArea.NewsChannel:j.LogTraceArea.NewsBot;if(E.log(s,"External share action"),!e)return;const i={anchor:()=>t,useTheme:!0,popupDisableContextMenu:!0,positionPriorities:["bottom","top"]},o=[{text:V.getString("Today.CopyLink"),command:"copyLink"}];m.default.showWithOptions({id:m.default.menuId(),config:i,getMenuItems:()=>o,handleMenuCommand:t=>{"copyLink"===t&&(Z.default.writeText(e),N.default.scheduleTextMessage(V.getString("Today.CopiedToClipboard"),void 0,this._getContext().rootViewId),E.log(s,"External share action was executed"),E.track(new M.TodayShareTelemetry(ne.TodayShareActionTelemetry.SharedExternallyAction,this.props.isNewsChannel?ne.ArticleReaderOrigin.NewsChannel:ne.ArticleReaderOrigin.NewsBot)))},rootViewId:this._getContext().rootViewId,destructiveButtonIndex:void 0,invokingEvent:void 0})},this._onExternalShare=(e,t)=>{if(e)return this.state.isUsingStackNavigationContext?this._onExternalShareMobile(e):this._onExternalShareDesktop(e,t)},this._onTap=e=>{const t=new T.ReactionPickerTelemetry(this.props.message,T.ReactionOriginType.DoubleTap),s="yes";if(this._isDoubleTap(e)){this._cancelDoubleTapTimer(),this._lastTapEvent=void 0;const e=this.props.message.getReactions(),i=ue.default.getEmoticonTone(s),o=e.some((e=>e.key===de.updateReactionNameWithTone(s,i))),n={message:this.props.message,reactionAction:{reaction:s,reactionTone:i,reactionLevel:0,reactionAdded:!o,isCustomReaction:!1}};de.addRemoveReactionFromMessage(n,t,(e=>{if(R.default.doesMessageHaveHint(this.props.message.cuid)){he.default.hintShownAndUsed();const e=ce.default.getDefaultMessageHintObject();e.wasFeatureUsedByUser=!0,R.default.setMessagesHintData(K.MessageHintsTypes.DoubleTapMessageToLike,e)}this._onAddingReactionDone(e,s,!o)}))}else this._startDoubleTapTimer(e)},this._navigateToBookmarkSource=e=>{e&&e.stopPropagation(),A.default.navigateToBookmarkSource(this.props.message.properties)},this._addOrRemoveMessageCallback=e=>{e&&e.stopPropagation(),this._onSelectMessage()},this._onSelectMessagesStreamItemCommandCallback=e=>{ge.default.activateSelectMessagesMode(this._getRootViewId()),this._onSelectMessage()},this._onSelectMessage=e=>{let t;const s=[];let i;this.props.message.isAlbum()&&(i=se.default.newGuid(),t=pe.default.getAllMediaMessagesForAlbum(this.props.message.getAlbumId()),n.each(t,(e=>{s.push({message:e,node:re.decode(e),actionMenuCommands:this.props.messageActions&&this.props.messageActions.actionMenuCommands,forwardAlbumId:i})})));const o={message:this.props.message,node:this.props.decodedNode,actionMenuCommands:this.props.messageActions&&this.props.messageActions.actionMenuCommands,urlPreviewId:this.props.urlPreviewId,forwardAlbumId:i};e||!this.state.isMessageSelected?(ge.default.addOrUpdateSelectedMessage(o),n.each(s,(e=>ge.default.addOrUpdateSelectedMessage(e)))):(ge.default.removeSelectedMessage(o),n.each(s,(e=>ge.default.removeSelectedMessage(e)))),e||this.setState({isMessageSelected:!this.state.isMessageSelected})},this._onLayout=e=>{if(this.isComponentMounted()){if(void 0!==this.state.availableSpace&&(E.debug((()=>["DIM_CALC - _onLayout: e: ",e," _availableSpace: ",this.state.availableSpace," renderOrigin: "+this.props.renderOrigin])),this.state.availableSpace&&this.state.availableSpace.width&&Math.abs(this.state.availableSpace.width-e.width)>25)){E.debug((()=>["DIM_CALC - _onLayout set state "]));const t=this.props.viewRenderingOptions.showMessageTimestamp||!1,s={width:e.width,height:t?e.height:e.height+20-2};this.props.viewRenderingOptions.calcRenderDim?this.setState({availableSpace:s,dimensions:this.props.viewRenderingOptions.calcRenderDim(s,this.props.renderOrigin)}):this.setState({availableSpace:s})}this.props.onLayout&&this.props.onLayout(e)}},this._onHandleContextMenu=e=>{this.state.showReactionsInBottomSheet?this._toggleReactionBottomSheet():!this.state.isSelectMessagesModeActive&&this._hasActionMenuCommands()&&(m.default._menuTargetComponent=this._menuTargetComponent||this._streamItem||void 0,h.default.showContextMenu(e,this._getRootViewId(),{getMenuItems:this._getMenuItems,onItemSelected:this._onCommandSelectedInContextMenu,onDismiss:this._onContextMenuDismissed},!1))},this._onSelectText=e=>{var t;this.state.enableMiniContextMenu&&0!==(null===(t=this.getSelection())||void 0===t?void 0:t.trim().length)&&!this.state.isSelectMessagesModeActive&&this._hasActionMenuCommands()&&(m.default._menuTargetComponent=this._menuTargetComponent||this._streamItem||void 0,h.default.showContextMenu(e,this._getRootViewId(),{getMenuItems:this._getNewMenuItems,onItemSelected:this._onCommandSelectedInContextMenu,onDismiss:this._onContextMenuDismissed},!0))},this._streamItemViewRef=e=>{this._streamItem=e||void 0},this._menuTargetComponentRef=e=>{this._menuTargetComponent=e||void 0},this._onQuotesCommandTriggerFromSwipe=()=>{this.props.onQuote&&this.props.onQuote([this.props.message],W.QuotesTriggerType.Swipe)},this._onHideStreamAccessories=e=>{this._dimIconsOpacityValue.setValue(e?0:1)},this._getMenuItems=()=>{const e=this._getCommandManagerOptions();return this.props.messageActions?this._commandManager.getSXMenuItems(e,this.props.messageActions.actionMenuCommands):[]},this._getNewMenuItems=()=>{const e=this._getCommandManagerOptions();return this.props.messageActions?this._commandManager.getSXMenuItems(e,this.props.messageActions.actionMenuCommands,!0):[]},this._onAccessibilityAction=e=>{const t=e.nativeEvent;if(t&&!n.isEmpty(t.actionName)){const e=n.filter(this._getMenuItems(),(e=>(0,ie.default)(e.text,t.actionName)));this._commandManager.onActionMenuOptionSelected(this._getCommandManagerOptions(),e[0].command,b.MessageActionOrigin.StreamItemDesktopContextMenu)}},this._onContentContainerRef=e=>{this._contentContainer=e},this._onStreamItemCommandSelected=(e,t,s)=>{this._onCommandSelected(e,s),e!==m.SXActionMenuCancel&&(this._contextMenuItemSelected=!0)},this._onCommandSelectedInStreamItemAccessory=e=>{this._onCommandSelected(e,b.MessageActionOrigin.StreamItemAccesory)},this._onCommandSelectedInContextMenu=e=>{this._onCommandSelected(e,b.MessageActionOrigin.StreamItemDesktopContextMenu),this._contextMenuItemSelected=!0},this._onCommandSelected=(e,t)=>{const s=this._getCommandManagerOptions();this._commandManager.onActionMenuOptionSelected(s,e,t),this.state.showReactionsInBottomSheet&&this.state.isBottomSheetOpened&&this._toggleReactionBottomSheet()},this._onContextMenuDismissed=()=>{this._trackDismissActionMenuTelemetry()},this._onStreamItemContentRef=e=>{this._streamItemContentRef=e||void 0},this._onMountContent=(e,t,s)=>{this.props.onMountContent&&this.props.onMountContent(e,t,s,this.props.message)},this._onLongPress=(e,t)=>{},this._onActionMenuDismissed=()=>{this._focusContentContainer(),this._trackDismissActionMenuTelemetry()},this._focusContentContainer=()=>{this.isComponentMounted()&&this._contentContainer&&this._contentContainer.requestFocus()},this._onPress=e=>{_.default.potentiallyMarkItemViewed(this.props.message,this.props.renderOrigin),this.state.isSelectMessagesModeActive?this._addOrRemoveMessageCallback(e):this.props.onItemPress&&this.props.onItemPress(e,this.props.message)},this._onDesktopOptionsButtonPress=(e,t,s,i)=>{const o=this._getRootViewId();return t&&this._hasActionMenuCommands()?(this._trackSearchSuccessTelemetry(),this._commandManager.showSXPopup(this._getCommandManagerOptions(),this.props.messageActions.actionMenuCommands,Le,s,o,e,(()=>{i&&i(),this._onContextMenuDismissed()}))):(this._commandManager.dismissSXPopup(Le,o),!1)},this._onContentHorizontalScroll=e=>{this.isComponentMounted()&&this.setState({isContentScrolled:!!e})},this._getCurrentMessage=()=>this.props.message,this._getReactionMenuAnchor=()=>this._streamItem}_buildState(e,t){const s=P.default.getS4LMessagingFeatures(),i=this._getRootViewId(),o={};t&&(o.disableStylingForTallBubbleAndroid=!1,o.availableSpace=e.viewRenderingOptions.availableSpace,e.viewRenderingOptions.calcRenderDim&&(o.dimensions=e.viewRenderingOptions.calcRenderDim(o.availableSpace,e.renderOrigin),E.debug((()=>["DIM_CALC - dimensions set from viewRenderingOptions in initial build state"])))),o.useAccessibleTheme=B.default.isAccessibleTheme(),o.isSmallDevice=F.default.isSmallDevice(i)||!!this._getContext().isPresentedInDesktopSubview,o.isMinDesktopWidth=F.default.isMinDesktopWidth(i),o.useCompactLayout=o.isSmallDevice||B.default.isCompactLayout(),o.isUsingStackNavigationContext=O.default.isUsingStackNavigationContext(),o.userIconWidth=be.StreamItemHeader.getUserIconWidth(o.isSmallDevice),o.isContentScrolled=!1,o.singleEmoticonSize=s.singleEmoticonSize,o.emoticonsOnlyEmoticonSize=s.emoticonsOnlyEmoticonSize,o.allowHugeEmoticons=x.default.getUserPreferencesLocal().allowHugeEmoticons;const n=this._shouldShowSelectionOption(e)&&e.isSelectMessagesModeActive;if(o.isSelectMessagesModeActive=n,o.showSelectCheckbox=!!this.state&&!!this.state.isSelectMessagesModeActive&&!n,o.showReactionsOverlay=s.enableReactionOverlays&&e.viewRenderingOptions.showReactionsOnMessage&&e.viewRenderingOptions.overlayReactionsOnMessage,o.showReactionsInBottomSheet=s.enableReactionsInBottomSheet,o.suppressSingleReactionCounts=s.enableReactionOverlays,o.isConversationAccepted=$.default.isConversationAccepted(e.message.conversationId),o.isBookmarkThread=le.isBookmarkConversation(e.message.conversationId),o.doubleTapReactionEnabled=s.enableDoubleTapReaction,o.enableMiniContextMenu=s.enableMiniContextMenu&&R.default.getMiniContextMenuEnabled(),this._commandManager||(this._commandManager=new ve.StreamItemCommandManager(this._onStreamItemCommandSelected)),n||(o.isMessageSelected=!1),o.accessibilityTraits=we.toAccessibilityTraits(e.viewRenderingOptions.accessibilityLabelType),e.viewRenderingOptions.skipAccessibilityLabelForMessageView)o.importantForAccessibility=d.Types.ImportantForAccessibility.No;else{let t=we.toAccessibilityLabel(e.decodedNode,{message:e.message,messageAccessibilityType:e.viewRenderingOptions.accessibilityLabelType,includeReactionInformationInAccessibilityLabel:!0});0,o.accessibilityLabel=t,o.importantForAccessibility=d.Types.ImportantForAccessibility.Yes}return o.isTablet=k.default.isTabletNoSubscription(),o.isLandscape=F.default.getDeviceOrientation(i)===r.DeviceOrientation.Landscape,o.responsiveWidth=F.default.getResponsiveWidth(i),o.enableNewSendingStrategy=s.enableNewSendingStateStrategy,o.accessibilityLiveRegion=(0,xe.isMagicBotContainingConversation)((0,Re.default)().getConversation(e.message.conversationId))?d.Types.AccessibilityLiveRegion.Polite:d.Types.AccessibilityLiveRegion.None,o}_getCommandManagerOptions(){const e=L.default.getActiveCallConversationIdNoSubscription(),s=ae.getMessageTypeGroup(this.props.message);return{message:this.props.message,decodedNode:this.props.decodedNode,urlPreviewData:this.props.urlPreviewData,url:this.props.urlPreviewData?this.props.urlPreviewData.url:"",getReactionMenuPopupAnchor:this._getReactionMenuAnchor,getRootWindowComponent:this.props.getRootWindowComponent,onEditCallback:this.props.onEdit,onQuoteCallback:this.props.onQuote,onTranslateCallback:this.props.onToggleTranslation,onTranslateOneCallback:this.props.onToggleTranslateOne,onSelectMessagesCommandCallback:this._onSelectMessagesStreamItemCommandCallback,screenReaderEnabled:this.props.screenReaderEnabled,onMarkAsUnread:this.props.onMarkAsUnread,renderOrigin:this.props.renderOrigin,contextConversationId:e,componentContext:this._getContext(),selectedText:"",showTranslatedMessage:this.props.showTranslatedMessage,hasTranslation:this.props.hasTranslation,isConversationTranslated:this.props.conversationTranslated,onCopy:this.props.onCopyContextMenu,onQuoteSelection:this.props.onQuoteSelectionContextMenu,onExternalShare:(0,t.shouldShowExternalShareButton)(s,this.props.isNewsChannel,this.props.isNewsBot,this.props.viewRenderingOptions.messageContentExpandedToAvailableArea)?this._onExternalShare:void 0}}componentDidMount(){if(super.componentDidMount(),this.state.isSelectMessagesModeActive&&(this._selectContainerXOffsetValue.setValue(Be),this._onHideStreamAccessories(!0),!this.state.isMessageSelected)){const e=ge.default.isMessageSelected(this.props.message.cuid);e&&this.setState({isMessageSelected:e})}}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),this.props.shouldScreenReaderFocusItem&&!e.shouldScreenReaderFocusItem&&this._focusContentContainer(),this.state.isMessageSelected&&!(0,ie.default)(e.message.content,this.props.message.content)&&this._onSelectMessage(!0),t.isSelectMessagesModeActive!==this.state.isSelectMessagesModeActive){let e=Be;const t=c.Common.Duration.Default;let s=1;this.state.isSelectMessagesModeActive||(e=0,s=0);const i=[I.default.timing(this._selectContainerXOffsetValue,{toValue:e,duration:t,easing:c.Easing.SkypeExpoOut5,useNativeDriver:!0}),I.default.timing(this._selectContainerOpacityValue,{toValue:s,duration:t,easing:c.Easing.SkypeExpoOut5,useNativeDriver:!0})];d.Animated.parallel(i).start((()=>{!this.state.isSelectMessagesModeActive&&this.isComponentMounted()&&this.setState({showSelectCheckbox:!1})})),this._onHideStreamAccessories(!!this.state.isSelectMessagesModeActive)}if(e.isSelectMessagesModeActive!==this.props.isSelectMessagesModeActive&&this.props.onListItemDetails){const e={};e.onKeyPress=this.props.isSelectMessagesModeActive?this._addOrRemoveMessageCallback:void 0,this.props.onListItemDetails(e)}}render(){const e=this._getMessageContentWithBackground(),t=this._addOuterContentToMessageView(e),s=[Ee.messageContainer,this.props.viewRenderingOptions.messageContainerStyle,void 0];(!this.props.viewRenderingOptions.messageContentExpandedToAvailableArea||this.props.isNewsChannel||this.props.isNewsBot)&&(this.state.isUsingStackNavigationContext||this.props.renderOrigin!==fe.MessageRenderOrigin.ChatCanvas&&this.props.renderOrigin!==fe.MessageRenderOrigin.CallCanvas)&&s.push(Ee.messageContainerPadding);const i=this._renderSendingIndicator(),r=(0,o.jsx)(ke.default,{isBottomSheetOpen:this.state.isBottomSheetOpened,onBottomSheetClose:this._toggleReactionBottomSheet,message:this.props.message,onItemSelected:this._onCommandSelected,onMoreButtonPressed:this._toggleReactionBottomSheet,menuItems:this._getMenuItems(),commands:this.props.messageActions?this.props.messageActions.outerButtonCommands:[]});let a;const l=this.state.isSelectMessagesModeActive||this.state.showSelectCheckbox;if(l){const e=this.props.viewRenderingOptions.viewColorProperties.disableGradient?H.Color.gray300:this.props.viewRenderingOptions.viewColorProperties.userPrimaryColor,t=V.getString("MessageStream.SelectionToggleOff"),s=V.getString("MessageStream.SelectionToggleOn"),i=!!this.state.isMessageSelected,n=i?s:t,r=Q.getToggleSwitchItemLabel(n,i),l=[Ee.messageSelection.selectionContainerPosition,this._selectionContainerXOffsetStyle,this._selectionContainerOpacityStyle],c=void 0;a=(0,o.jsx)(d.View,Object.assign({style:[Ee.messageSelection.messageSelectionContainer,this.props.viewRenderingOptions.showMessageTimestamp?Ee.messageSelection.messageWithTimeStampContainer:void 0]},{children:(0,o.jsx)(d.Animated.View,Object.assign({style:l,importantForAccessibility:c,accessibilityTraits:d.Types.AccessibilityTrait.Button,accessibilityLabel:r},{children:(0,o.jsx)(g.default,{isOn:i,selectionColor:e,disableSelectionAnimation:!0})}))}))}const c=this._isDesktopOrDesktopSubView();let h;if(c||this._isPresentedInDesktopSidebar()){const e=!!this.props.messageActions&&!n.isEmpty(this.props.messageActions.actionMenuCommands)&&!this.state.isSelectMessagesModeActive;h=(0,o.jsxs)(Te.StreamItemOptionsMenu,Object.assign({id:this.props.message.cuid,ref:this._menuTargetComponentRef,style:s,renderOptionsButton:e,onButtonPress:this._onDesktopOptionsButtonPress,messageContentCentered:!!this.props.viewRenderingOptions.messageContentCentered,onSelect:this.state.isSelectMessagesModeActive?this._addOrRemoveMessageCallback:void 0,onLayout:this._onLayout,useBookmarkUI:this.props.message.isBookmark(),onSecondaryButtonPress:this.props.message.isBookmark()?this._navigateToBookmarkSource:void 0},{children:[t,a,i]}))}else{if(this.state.isSelectMessagesModeActive)return(0,o.jsxs)(S.default.View,Object.assign({style:s,onLayout:this._onLayout,onPress:l?this._addOrRemoveMessageCallback:void 0,activeOpacity:l?.8:void 0},{children:[t,a,i]}));{const e=this.state.isSelectMessagesModeActive&&!c?this._getAccessibilityProps():void 0;this.state.enableNewSendingStrategy&&s.push(Ee.mobileSideDistance),h=(0,o.jsxs)(d.View,Object.assign({style:s,onLayout:this._onLayout,onPress:l?this._addOrRemoveMessageCallback:void 0,activeOpacity:l?.8:void 0,ref:this._streamItemViewRef},e,{children:[r,t,a,i]}))}}return this.props.viewRenderingOptions.showDivider&&(h=(0,o.jsxs)(d.View,{children:[h,(0,o.jsx)(u.default,{marginTop:15,marginBottom:5,marginLeft:this._getBookmarkDividerLeftSpacing()})]})),h}copySelection(e){if(this._streamItemContentRef)return this._streamItemContentRef.copySelection(e)}quoteSelection(){if(this._streamItemContentRef)return this._streamItemContentRef.quoteSelection()}getSelection(){var e;return null===(e=window.getSelection())||void 0===e?void 0:e.toString()}_onAddingReactionDone(e,t,s){let i="ReactionsMenu.YouReactedError";i=e?s?"ReactionsMenu.YouReacted":"ReactionsMenu.YouRemovedReaction":s?"ReactionsMenu.YouReactedError":"ReactionsMenu.YouRemovedReactionError",w.default.maybeAnnounceForAccessibility(V.getString(i,{reaction:t}))}_isDoubleTap(e){if(!this._lastTapEvent)return!1;return this._getEventTimestamp(e)-this._getEventTimestamp(this._lastTapEvent)<=200}_startDoubleTapTimer(e){this._lastTapEvent=e,this._doubleTapTimer=te.default.setTimeout((()=>{this.isComponentMounted()&&(this._doubleTapTimer=void 0)}),200)}_cancelDoubleTapTimer(){this._doubleTapTimer&&(te.default.clearTimeout(this._doubleTapTimer),this._doubleTapTimer=void 0)}_getEventTimestamp(e){return e.timeStamp?e.timeStamp.valueOf():0}_getBookmarkDividerLeftSpacing(){return this.state.isUsingStackNavigationContext&&!this.state.isTablet?10:void 0}_renderSendingIndicator(){return!this.state.enableNewSendingStrategy||this.props.viewRenderingOptions.sendingStatus!==Pe.MessageRenderSendingStatus.Sending&&this.props.viewRenderingOptions.sendingStatus!==Pe.MessageRenderSendingStatus.NoNetwork?null:(0,o.jsx)(p.default,{color:this._getContext().themeColors.textSecondary,size:De,style:Ee.icon,icon:z.SkypeIcon.Recent})}_isPresentedInDesktopSidebar(){return!(!this._getContext().isPresentedInDesktopLeftNav&&!this._getContext().isPresentedInDesktopRightNav)}_isDesktopOrDesktopSubView(){return this.props.viewRenderingOptions.showDesktopButton&&!this.state.isUsingStackNavigationContext&&!this._getContext().isPresentedInDesktopSubview}_shouldShowSelectionOption(e){return!!e.messageActions&&n.some(e.messageActions.actionMenuCommands,(e=>e===Fe))}_trackDismissActionMenuTelemetry(){if(!this._contextMenuItemSelected){const e=new b.MessageActionTelemetry(this.props.message.conversationId,this.props.message,this.props.message.createdTime,b.MessageActionOrigin.StreamItem,b.MessageActionType.DismissActionMenu);E.track(e)}this._contextMenuItemSelected=!1}_trackSearchSuccessTelemetry(){X.messageActionDone(this.props.message.conversationId)}_getMessageContentWithBackground(){const e=this.props.viewRenderingOptions;let t;const s=e.messageContainerRadiusStyle,i=[Ee.innerStreamItemView.containerStyle,void 0,this._innerMovingContainerXOffsetStyle];s&&i.push(...s);const n=[],r=this._footerSpacingStyle(),a=[f.default.flexOne];if(this._shouldRenderBackground()){if(t=this._getGradientView(),!t){const{surfaceSecondary:e,dividerPrimary:t}=this._getContext().themeColors;this._getContext().mode.isAccessible&&i.push(d.Styles.createWebViewStyle({borderWidth:1,borderColor:t},!1)),i.push(d.Styles.createViewStyle({backgroundColor:e},!1))}const e=(this.props.isNewsChannel||this.props.isNewsBot)&&this.props.message.messagetype===ae.MessageTypes.Media_Card;this.state.isUsingStackNavigationContext?this.state.useCompactLayout?(e||n.push(Ee.innerStreamItemView.messageContentSpacing.compact.WithBubble),a.push(Ee.innerStreamItemView.containerSpacing.paddingBottomSmall)):(e||n.push(Ee.innerStreamItemView.messageContentSpacing.regular.WithBubble),a.push(Ee.innerStreamItemView.containerSpacing.paddingBottomRegular)):this.state.useCompactLayout?(e||n.push(Ee.innerStreamItemView.messageContentSpacing.compositeCompact.WithBubble),a.push(Ee.innerStreamItemView.containerSpacing.paddingBottomCompositeSmall)):(e||n.push(Ee.innerStreamItemView.messageContentSpacing.compositeRegular.WithBubble),a.push(Ee.innerStreamItemView.containerSpacing.paddingBottomComposite)),(this.props.message.hasReactions()||this.props.isNewsChannel)&&this.props.viewRenderingOptions.showReactionsOnMessage&&(this.state.showReactionsOverlay?a.push(Ee.innerStreamItemView.containerSpacing.paddingBottomWithReactionsOverlay):a.push(Ee.innerStreamItemView.containerSpacing.paddingBottomWithReactions)),this.props.isNewsBot&&a.push(Ee.innerStreamItemView.containerSpacing.paddingBottomWithReactionsOverlay)}e.includeCursor&&a.push(f.default.pointerCursor),e.messageContentSpacingStyle&&n.push(e.messageContentSpacingStyle);const l=this._contextMenuHandler(),c=[t,(0,o.jsxs)(d.View,Object.assign({style:a,activeOpacity:e.showTouchFeedbackOnPress?.8:1,importantForAccessibility:d.Types.ImportantForAccessibility.No,onLongPress:this.state.isSelectMessagesModeActive?void 0:l,onPress:this.state.doubleTapReactionEnabled?this._onTap:this._onSelectText,onContextMenu:this.state.isSelectMessagesModeActive?void 0:l},{children:[(0,o.jsx)(d.View,Object.assign({style:n},{children:this._getStreamItemContent()})),this.state.showReactionsOverlay||this.props.isNewsBot?void 0:this._getStreamItemFooter(r)]}),"bubblecontent")];let h=(0,o.jsx)(d.Animated.View,Object.assign({style:i},{children:c}),"contentContainer");return this._isQuickQuoteSupported()&&(h=(0,o.jsx)(Me.StreamItemQuotesGestureWrapper,Object.assign({onDisableScroll:this.props.onDisableScroll,onQuotesCommandTrigger:this._onQuotesCommandTriggerFromSwipe,positionToAnimateOnSwipe:this._innerMovingContainerXOffsetValue,initialPositionValue:this._xBase,onGestureStartStopCallback:this._onHideStreamAccessories},{children:h}))),h}_footerSpacingStyle(){const e=[];return(this._shouldRenderBackground()||this.state.showReactionsOverlay)&&(this.state.isUsingStackNavigationContext?this.state.useCompactLayout?e.push(Ee.innerStreamItemView.footerSpacing.paddingLeftSmall):e.push(Ee.innerStreamItemView.footerSpacing.paddingLeftRegular):this.state.useCompactLayout?e.push(Ee.innerStreamItemView.footerSpacing.paddingLeftSmall):e.push(Ee.innerStreamItemView.footerSpacing.paddingLeftComposite),(this.props.isNewsChannel||this.props.isNewsBot)&&e.push(Ee.innerStreamItemView.footerSpacing.noPaddingLeft)),e}_isQuickQuoteSupported(){return!1}_addOuterContentToMessageView(e){const t=[Ee.streamItemViewWithButtons.wrapper],s=this._isQuickQuoteSupported()?f.default.overflowVisible:void 0,i=[s],n=[f.default.noncollapsibleView,this.props.isNewsBot||this.props.isNewsChannel?Ee.innerStreamItemView.containerStyleNews:Ee.innerStreamItemView.containerStyle,this.props.viewRenderingOptions.outerWrapperOverideStyle,s];let r,a;if((this._isDesktopOrDesktopSubView()||this._isPresentedInDesktopSidebar())&&n.push(Ee.innerStreamItemView.desktopContainerStyle),!this.props.viewRenderingOptions.showStreamItemAccessory||this.props.isNewsChannel||this.props.isNewsBot||(this.props.postedByCurrentUser&&!this.props.message.isBookmark()?(r=this._getStreamItemAccessory(),t.push(Ee.streamItemViewWithButtons.wrapperMe)):a=this._getStreamItemAccessory()),this.props.viewRenderingOptions.messageContentCentered)t.push(Ee.streamItemViewWithButtons.wrapperCenter);else if(this.props.viewRenderingOptions.messageContentExpandedToAvailableArea||this.props.isNewsChannel||this.props.isNewsBot)this.props.viewRenderingOptions.messageContentExpandedToAvailableArea&&n.push(f.default.flexOne);else{const e=d.Styles.createViewStyle({marginLeft:this.state.userIconWidth},!1);this.props.viewRenderingOptions.showMessageSenderIcon?i.push(e):this.props.viewRenderingOptions.allowMarginForSenderIcon&&n.push(e)}const l=this._getSpacerStyle();let c;l&&t.push(l),c=this.state.isSelectMessagesModeActive&&!this._isDesktopOrDesktopSubView?{importantForAccessibility:d.Types.ImportantForAccessibility.NoHideDescendants}:this.props.viewRenderingOptions.includeAccessibilityPropertiesOnMessageHeader?void 0:this._getAccessibilityProps(),this.props.postedByCurrentUser&&t.push(this._selectionContainerXOffsetStyle);const h={ref:this._onContentContainerRef,style:n};let u;u=this.props.message.messagetype===ae.MessageTypes.CastRecording?Ee.innerStreamItemView.footerSpacing.marginTopRecorderVideos:Ee.innerStreamItemView.footerSpacing.marginTop;const p=this.state.showReactionsOverlay||this.props.isNewsBot?this._getStreamItemFooter([...this._footerSpacingStyle()],u):void 0;!this.props.message.isBookmark()||this.props.isNewsBot||this.props.isNewsChannel||t.push(Ee.innerStreamItemView.desktopContainerShrinkStyle);let g=(0,o.jsxs)(d.Animated.View,Object.assign({style:t},{children:[r,(0,o.jsxs)(S.default.View,Object.assign({},c,h,{children:[this._getStreamItemHeader(),(0,o.jsxs)(d.View,Object.assign({style:i,accessibilityLiveRegion:this.state.accessibilityLiveRegion},{children:[e,p]}))]})),a]}));return this.props.viewRenderingOptions.smsDeliveryStatus&&(g=(0,o.jsx)(Ie.StreamItemTailAccessoryWrapper,Object.assign({smsDeliveryStatus:this.props.viewRenderingOptions.smsDeliveryStatus},{children:g}))),g}_getSpacerWidth(){const e=this.props.viewRenderingOptions;if(e.removeMessageSpacer||e.messageContentCentered)return null;let t=0;return this._isDesktopSize()&&!this.state.isTablet?t=this._getDesktopSpacerWidth(t):this.state.isTablet?t=this._getTabletSpacerWidth():this.state.isUsingStackNavigationContext&&(t=40),this.props.postedByCurrentUser&&(t+=this.state.userIconWidth),(e.showOuterButtons||e.showEditIndicator||e.sendingStatus!==Pe.MessageRenderSendingStatus.None)&&(t-=(0,ye.getAccessoryWidth)(this.state.isMinDesktopWidth&&!this.state.isUsingStackNavigationContext)),this.props.message.isBookmark()&&(t=10),t}_getDesktopSpacerWidth(e){let t=0;return t=this.state.responsiveWidth>=G.ResponsiveWidth.Large?200:this.state.responsiveWidth>G.ResponsiveWidth.Small?120:this.state.responsiveWidth>G.ResponsiveWidth.MinDesktop?80:24,t}_getTabletSpacerWidth(){return this.state.isLandscape&&this.props.renderOrigin!==fe.MessageRenderOrigin.CallCanvas?120:40}_getSpacerStyle(){if(this.props.message.isBookmark())return;const e=this._getSpacerWidth();if(!e)return;const t=(this.props.postedByCurrentUser&&!this.props.message.isBookmark()?"left":"right")+e;return Ne[t]||(Ne[t]=this.props.postedByCurrentUser&&!this.props.message.isBookmark()?d.Styles.createViewStyle({paddingLeft:e}):d.Styles.createViewStyle({paddingRight:e})),Ne[t]}_shouldRenderBackground(){return!!this.props.viewRenderingOptions.renderMessageBackground&&!this.state.disableStylingForTallBubbleAndroid}_getGradientView(){const{disableGradient:e,bubbleColor:t}=this.props.viewRenderingOptions.viewColorProperties;if(e||!this._shouldRenderBackground())return;const s=[f.default.absoluteFill,this.props.viewRenderingOptions.messageContainerRadiusStyle,d.Styles.createViewStyle({backgroundColor:t},!1)];return(0,o.jsx)(d.View,{style:s},"bubble_background")}_contextMenuHandler(){return this._onHandleContextMenu}_getStreamItemContent(){const e=this.props.viewRenderingOptions;let t=0;e.messageContentExpandedToAvailableArea&&e.showMessageSenderIcon&&!this.props.isNewsChannel&&(t=this._isDesktopSize()?40:this.state.isSmallDevice?8:10);const s=!!this.state.disableStylingForTallBubbleAndroid&&this._useDarkTheme();let i=this._getSpacerWidth();return i&&(i+=20),E.debug((()=>["DIM_CALC - StreamItemContent dimensions: ",this.state.dimensions," messagetype: ",this.props.message.messagetype," cuid: ",this.props.message.cuid])),(0,o.jsx)(Ce.StreamItemContent,{ref:this._onStreamItemContentRef,skypeMessage:this.props.message,viewRenderingOptions:e,rawSearchQuery:this.props.rawSearchQuery,isSelectedMessage:this.props.isSelectedMessage,decodedNode:this.props.decodedNode,useLightText:s,leftPaddingForUserIcon:this.state.userIconWidth+t,urlPreviewData:this.props.urlPreviewData,urlPreviewOnly:this.props.urlPreviewOnly,postedByCurrentUser:this.props.postedByCurrentUser,messageActions:this.props.messageActions,messagePadding:i||void 0,suggestedTextHighlights:this.props.suggestedTextHighlights,constrainedDimensions:this.state.dimensions,availableSpace:this.state.availableSpace,messageStreamFontSize:this.props.messageStreamFontSize,onContentHorizontalScroll:this._onContentHorizontalScroll,onPress:this._onPress,onLongPressContent:(this.state.isSelectMessagesModeActive,void 0),onContextMenu:this._onHandleContextMenu,onDisableScroll:this.props.onDisableScroll,onMountContent:this._onMountContent,onQuote:this.props.onQuote,onEdit:this.props.onEdit,renderOrigin:this.props.renderOrigin,emoticonsOnlyEmoticonSize:this.state.emoticonsOnlyEmoticonSize,singleEmoticonSize:this.state.singleEmoticonSize,allowHugeEmoticons:this.state.allowHugeEmoticons,disableTextSelection:a.default.isMobile()||this.state.isSelectMessagesModeActive,disableActions:this.state.isSelectMessagesModeActive,onSelectMessageCallback:this.state.isSelectMessagesModeActive?this._addOrRemoveMessageCallback:void 0,activeOpacityOverride:this.state.isSelectMessagesModeActive?.8:void 0,linkedMessages:this.props.linkedMessages,hasTranslation:this.props.hasTranslation,conversationTranslated:this.props.conversationTranslated,onToggleTranslation:this.props.onToggleTranslation,onToggleTranslateOptions:this.props.onToggleTranslateOptions,showTranslatedMessage:this.props.showTranslatedMessage,searchStore:this.props.searchStore},"streamitemcontent")}_hasActionMenuCommands(){return!!this.props.messageActions&&!n.isEmpty(this.props.messageActions.actionMenuCommands)}_getStreamItemAccessory(e){const t=this.props.viewRenderingOptions,s=[t.showMessageSender||t.showMessageTimestamp&&t.sendingStatus!==Pe.MessageRenderSendingStatus.NoNetwork?Ee.accessoryTopPadding:void 0];return this.state.showReactionsOverlay&&this.props.message.hasReactions()&&s.push(Ee.innerStreamItemView.footerSpacing.paddingBottomWithReactions),(t.showReactionsOnMessage&&this.props.isNewsChannel||this.props.isNewsBot)&&s.push(Ee.accessoryNoPadding),(0,o.jsx)(ye.StreamItemAccessory,{paddingStyle:s,message:this._getCurrentMessage,isMessageKnownByServer:this.props.message.isAnyVersionKnownByServer(),messagetype:this.props.message.messagetype,creator:this.props.message.creator,conversationId:this.props.message.conversationId,isConversationAccepted:this.state.isConversationAccepted,showEditIcon:t.showEditIndicator,sendingStatus:t.sendingStatus,smsDeliveryStatus:t.smsDeliveryStatus,showOuterButtons:t.showOuterButtons,commands:this.props.messageActions?this.props.messageActions.outerButtonCommands:[],onCommandSelected:this._onCommandSelectedInStreamItemAccessory,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,containerAnimationStyle:this._dimIconsOpacityStyle,disableActions:this.state.isSelectMessagesModeActive,isNewsChannel:this.props.isNewsChannel,isNewsBot:this.props.isNewsBot,accessoryOrigin:e||void 0})}_isDesktopSize(){return!this.state.isUsingStackNavigationContext&&!this._getContext().isPresentedInDesktopSubview}_getAccessibilityProps(){let e=this.state.accessibilityLabel,t=this.state.accessibilityTraits,s=d.Types.ImportantForAccessibility.Yes;if(this.state.isSelectMessagesModeActive){const t=!!this.state.isMessageSelected,s=V.getString("MessageStream.SelectionToggleOff"),i=V.getString("MessageStream.SelectionToggleOn"),o=e||(t?i:s);e=Q.getToggleSwitchItemLabel(o,t)}let i;return this.props.hint&&(e=`${e} ${this.props.hint.hintMessage}`),{accessibilityLabel:e,importantForAccessibility:s,accessibilityTraits:t,accessibilityActions:i,onAccessibilityAction:void 0}}_getStreamItemHeader(){const e=this.props.viewRenderingOptions;let t;!e.messageContentExpandedToAvailableArea||this.props.isNewsChannel||this.props.isNewsBot||(t=this._isDesktopSize()?Ee.headerLeftPadding.desktop:this.state.isSmallDevice?Ee.headerLeftPadding.smallDevice:Ee.headerLeftPadding.regularDevice);const s=this.state.isSelectMessagesModeActive&&!this._isDesktopOrDesktopSubView()||!e.includeAccessibilityPropertiesOnMessageHeader?void 0:this._getAccessibilityProps();let i;if(this.props.message.isBookmark()){const e=ae.getBookmarkMetadata(this.props.message.properties);e&&(i=e.bookmarkSourceCreatorId)}const n=i||this.props.message.creator;let r,a,l;if(e.showMessageTimestamp&&(r=D.default.getDisplayTimeString(this.props.message.createdTime),this.state.isBookmarkThread)){const e=ae.getBookmarkMetadata(this.props.message.properties);e&&e.bookmarkSourceComposeTime&&(r=D.default.getDisplayDateStringDayMonthYearFormat(e.bookmarkSourceComposeTime)),l=e&&e.bookmarkSourceConversationId,l&&(a=e&&e.bookmarkSourceConversationName)}const d=e.showMessageSenderIcon&&!this.props.isNewsChannel&&!this.props.isNewsBot,c=e.showMessageSender&&!this.props.isNewsChannel&&!this.props.isNewsBot;return(0,o.jsx)(be.StreamItemHeader,Object.assign({},s,{creatorMri:n,style:t,message:this.props.message,messageStreamFontSize:this.props.messageStreamFontSize,conversationId:this.props.message.conversationId,postedByCurrentUser:this.props.postedByCurrentUser,displayDateTime:r,showMessageTimestamp:!!e.showMessageTimestamp,showUserIcon:d,showSenderName:c,onRevealInConvPress:this.props.onRevealInConvPress,sendingStatus:e.sendingStatus,alignLeft:e.alignHeaderLeft,isSmallDevice:this.state.isSmallDevice,contentScrollEnabled:!!e.contentScrollEnabled,isContentScrolledOverHeader:!!e.contentScrollEnabled&&this.state.isContentScrolled,userIconBackgroundColor:e.viewColorProperties.userIconBackgroundColor,rawSearchQuery:this.props.rawSearchQuery,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,disableActions:this.state.isSelectMessagesModeActive,isCarousel:e.messageContentExpandedToAvailableArea,isBookmarkedMessage:this.props.message.isBookmarkSourceForCurrentUser(),bookmarkSourceConversationName:a,bookmarkSourceConversationId:l,isNewsChannel:this.props.isNewsChannel}))}_getStreamItemFooter(e,t){if(this.props.viewRenderingOptions.showReactionsOnMessage||this.props.isNewsBot){E.debug((()=>["DIM_CALC - StreamItemFooter dimensions: ",this.state.dimensions," messagetype: ",this.props.message.messagetype," cuid: ",this.props.message.cuid]));const s=this.props.decodedNode.hasHtmlContent()?void 0:this.state.dimensions&&this.state.dimensions.width;return(0,o.jsx)(_e.StreamItemFooter,{hint:this.props.hint,style:e,overlayStyle:t,message:n.isEmpty(this.props.message.getReactions())?void 0:this.props.message,showReactionsOverlay:this.state.showReactionsOverlay,constrainedWidth:s,disableAction:this.state.isSelectMessagesModeActive,suppressSingleCounts:this.state.suppressSingleReactionCounts,showShadows:this.state.showReactionsOverlay,isNewsChannel:this.props.isNewsChannel,streamItemAccessory:this.props.isNewsChannel||this.props.isNewsBot?this._getStreamItemAccessory(Oe.StreamItemFooter):void 0},"streamitemfooter")}}}t.StreamItemView=Ue},966905:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(144228),o=s(153211),n=s(711828),r=s(733754);class a extends i.default{_buildRows(e){return[{props:{key:"translateOriginalMessage",icon:n.SkypeIcon.SkypeTranslatorNew,onRowPress:e.onShowOriginalMessage,accessibilityLabel:r.getString("Translator.SettingsMessageShowOriginal"),titleText:r.getString("Translator.SettingsMessageShowOriginal"),subtitleText:e.sourceLangString,hideBorder:!1},builder:o.default.buildRow},{props:{key:"translateSettings",icon:n.SkypeIcon.Settings,onRowPress:e.onChangeLang,accessibilityLabel:r.getString("Translator.SettingsShowSettings"),titleText:r.getString("Translator.SettingsShowSettings"),subtitleText:e.langString,hideBorder:!0},builder:o.default.buildRow}]}static getMenuHeight(){return 2*o.default.getMenuItemHeight()}}t.default=a},663328:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(583367),r=s(516778),a=s(809206),l=s(705465),d=s(379707),c=(s(4736),s(690247)),h=s(1706),u=s(219784),p=s(300060),g=s(889391),m=s(441639),S=s(246549),f=s(249758),y=s(468734),v=s(47447),C=s(905531),_=s(422801),b=s(351077),T=s(671830),M=(s(297775),s(911009),s(484994)),I=s(898278),w=s(738386),P=s(400984),k=s(481627),A=s(625728),x=s(820770),R=s(539549),O=s(185641),L=s(882261),F=s(788660),B=s(952262),D=s(587134),E=s(332808),V=s(403782),N=s(103291),U=s(903573),j=s(341706),H=s(125793),z=s(770891),W=s(746096),G=s(480469),K=s(497174),q=s(923944),Q=s(436237),X=s(993924),$=s(452374),J=s(710400),Y=s(915877),Z=s(733754),ee=s(518606),te=s(318743),se=s(265822),ie=s(268080),oe=s(764387),ne=s(854757),re=s(961428),ae=s(748443),le=s(422929),de=s(51470),ce=s(529308),he=s(106658),ue=s(812056),pe=s(812056),ge=s(609413),me=s(540897),Se=s(46929),fe=s(18078),ye=s(104735),ve=s(330124),Ce=s(827357),_e=s(3415),be=s(833348),Te=s(192210),Me=s(874636),Ie=s(581736),we=s(510756),Pe=s(758962),ke=s(785207),Ae=s(29130),xe=s(914976),Re=s(681115),Oe=s(857946),Le=s(876817),Fe=s(583181),Be=s(308420),De=s(404057),Ee=s(640363),Ve=s(711828),Ne=s(478262),Ue=s(680837),je=s(360305),He=s(735370),ze=s(911698),We=s(619675),Ge=s(24576),Ke=s(988523),qe=s(853374),Qe=s(519089),Xe=s(593486),$e=s(741660),Je=s(22222),Ye=s(581760),Ze=s(901246),et=s(366355),tt=s(311010),st=s(994224),it=s(715598),ot=s(675881),nt=s(947193),rt=s(952065),at=10,lt=[],dt=(0,Y.lazyProperties)({contentOuterContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),messageComposerOuterContainerVertical:()=>r.Styles.createViewStyle({flexDirection:"row",justifyContent:"center"}),messageComposerOuterContainerHorizontal:()=>r.Styles.createViewStyle({flex:-1,flexDirection:"row",justifyContent:"center"}),messageComposerContainerDesktop:()=>r.Styles.createViewStyle({marginTop:8,width:he.maxStreamContentWidth,alignSelf:"center"}),messageComposerContainerWithSuggestionsDesktop:()=>r.Styles.createViewStyle({marginTop:3}),messageComposerInner:()=>r.Styles.createViewStyle({flex:-1,flexDirection:"row",maxWidth:he.maxStreamContentWidth,width:he.maxStreamContentWidth}),messageComposerHorizontalSpacer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"flex-end",alignItems:"center"}),messageComposerHorizontalSpacerDesktop:()=>r.Styles.createViewStyle({height:60}),messageComposerHorizontalSpacerWithSuggestionsDesktop:()=>r.Styles.createViewStyle({height:55}),messageComposerHorizontalTinySpacer:()=>r.Styles.createViewStyle({minWidth:5}),messageComposerHorizontalSmallSpacer:()=>r.Styles.createViewStyle({minWidth:at}),messageComposerHorizontalBigSpacer:()=>r.Styles.createViewStyle({minWidth:80}),defaultRightSpacerStyle:()=>r.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end",alignItems:"center",paddingRight:13,minWidth:70}),defaultRightSpacerStyleForComposerWithPopup:()=>r.Styles.createViewStyle({minWidth:at}),toggleLeftPanelButtonContainer:()=>r.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",alignItems:"center",paddingLeft:15,minWidth:80}),toggleLeftPanelButtonContainerSmallView:()=>r.Styles.createViewStyle({minWidth:60}),messagingUnavailableContainer:()=>r.Styles.createViewStyle({flex:-1,flexDirection:"row",width:he.maxStreamContentWidth,maxWidth:he.maxStreamContentWidth,paddingRight:10,height:60,alignItems:"center"}),messagingUnavailablePlaceholder:()=>r.Styles.createTextStyle({flex:-1,paddingHorizontal:16}),dividerShadow:()=>r.Styles.createViewStyle({left:0,right:0,height:1,marginTop:-1}),sidebarButton:()=>r.Styles.createViewStyle({height:Ve.IconSize.default,width:Ve.IconSize.default}),tabletMessageComposer:()=>r.Styles.createViewStyle({minHeight:M.default.tabBarHeight(I.TabBarHeight.Tablet),paddingBottom:1,alignItems:"flex-end"}),messageTextCompletion:()=>r.Styles.createViewStyle({marginBottom:-1}),hideComposer:()=>r.Styles.createViewStyle({height:0}),paddingMobileBrowser:()=>r.Styles.createViewStyle({paddingBottom:20}),notificationsButtonWrapper:()=>r.Styles.createViewStyle({alignItems:"center",justifyContent:"center",paddingTop:4,paddingBottom:4,overflow:"hidden"})});class ct extends Ge.default{constructor(){super(...arguments),this._shouldSendGreetingEvent=!1,this._mountedContentNodes={},this._botMessageTimerLimit=Date.now(),this._shouldFocusMessageComposer=!1,this._scrolledToTheBottom=!0,this._dividerOpacityValue=new r.Animated.Value(0),this._dividerOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._dividerOpacityValue}),this._messageComposerOpacityValue=new r.Animated.Value(1),this._messageComposerOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._messageComposerOpacityValue}),this._leftMessageStreamSpacerWidth=0,this._rightMessageStreamSpacerWidth=0,this._spacerWidthUpdated=!1,this._trackAddContactOnce=!1,this._trackSendMessageOnce=!1,this._canSendSearchFirstSuccessAction=!1,this._lastDeletedTimestamp=0,this._focusJoinCallButtonOnce=!1,this._showDirectShareConfirmationDialog=e=>{const t=B.default.getDisplayName(this.props.conversationId)||"",s=Z.getString("DirectShare.ConfirmationDialogTitle",{displayName:t}),i=[{text:Z.getString("Global.CancelLabel"),isCancel:!0},{text:Z.getString("Global.ConfirmLabel"),isSubmit:!0,onPress:()=>F.default.sendSharedFiles(e,this.props.conversationId)}];u.default.showWithOptions({title:"",dialogAccessibilityTitle:s,message:s,buttons:i,rootViewId:this._getRootViewId()})},this._storeConversationStyles=()=>{O.default.storeSpacerWidths({left:this._leftMessageStreamSpacerWidth,right:this._rightMessageStreamSpacerWidth})},this._onMessageStreamScreenReaderFocusUpdated=e=>{this._shouldFocusMessageComposer=!e&&!r.Modal.isDisplayed()&&!this._focusJoinCallButtonOnce,this._shouldFocusMessageComposer&&!this.state.isAnimationPending&&this._setComposerAccessibilityFocus(),this._focusJoinCallButtonOnce=!1},this._onShowOverflow=(e,t,s)=>{this._shouldFocusMessageComposer=!1,this.props.onShowOverflow&&this.props.onShowOverflow(e,t,s)},this._onConversationsStoreUpdate=()=>{if(this.isComponentMounted()){this._postCallerIdMessage();const e=(0,R.default)().getConversation(this.props.conversationId);this._considerNavigationAfterDeleteConversation(e),this._considerRefreshingContactsStore(e),this._considerInviteMessageCountReached(e)}},this._onSuggestionsToggled=e=>{this.setState({suggestionsShown:e})},this._toggleDesktopFindPanel=()=>{this.props.onToggleFindPanel&&this.props.onToggleFindPanel(this._messageComposer?this._messageComposer.getOverflowConfig():void 0)},this._onComposerContainerRef=e=>{this._composerContainerRef=e||void 0,this._composerContainerRef&&this._composerContainerRef.setFocusLimited(!!this.props.isSelectMessagesModeActive)},this._onMessageComposerRef=e=>{this._messageComposer=e||void 0},this._onTextCompletionRef=e=>{this._textCompletion=e||void 0},this._divider=()=>this.props.showBottomDivider?(0,i.jsx)(r.Animated.View,{style:[dt.dividerShadow,this._themeStyles.headerShadowColorStyle,this._dividerOpacityStyle]}):(0,i.jsx)(D.default,{marginLeft:0,marginRight:0,useLightTheme:!0}),this._onMessageStreamRef=e=>{this._messageStream=e},this._onMessageStreamLayout=e=>{const t=e.height,s=e.width,i=this.state.isBookmark?760:560,o=e.width<i;this.state.contentAreaHeight===t&&this.state.contentAreaWidth===s&&this.state.isRenderedIn4ColumnWidth===o||this.setState({contentAreaHeight:t,contentAreaWidth:s,isRenderedIn4ColumnWidth:o}),Qe.default.isPiPEnabled()&&ae.default.updateDimensions(e)},this._onInputTextChanged=(e,t)=>{this._textCompletion&&this._textCompletion.setInputText(e,t)},this._onNativeComposerMessageEmptyStateChanged=()=>{this._sendSearchFirstSuccessfulAction()},this._onKeyPress=e=>(this._sendSearchFirstSuccessfulAction(),!!this._textCompletion&&this._textCompletion.handleKeyDown(e)),this._onRecording=()=>{if(this.props.hasConnectedCalls)u.default.showOKAlert(Z.getString("MessageStream.AudioMessageNotAllowedTitle"),Z.getString("MessageStream.AudioMessageNotAllowedMessage"),this._getRootViewId());else switch(c.default.getRecordingStateNoSubscription()){case c.RecordingState.StartingMic:case c.RecordingState.Recording:u.default.showOKAlert(Z.getString("MessageStream.MultipleAudioMessagesNotAllowedTitle"),Z.getString("MessageStream.MultipleAudioMessagesNotAllowedMessage"),this._getRootViewId());break;default:this._toggleRecording(!0)}},this._onDoneRecording=()=>{this._toggleRecording(!1)},this._insertSearchResultsToComposer=(e,t,s)=>{this._messageComposer&&this._messageComposer.insertSearchResult(e,t,s)},this._onReplaceText=(e,t,s,i)=>{const o=i instanceof K.AtMentionEntity;o&&(t+=" "),this._messageComposer&&(this._messageComposer.replaceText(e,t,s,i),o&&r.Accessibility.announceForAccessibility(Z.getString("MessageComposer.MentionSuggestionConfirmed",{name:t})))},this._onTextReplacementCandidatesShown=e=>{this._messageComposer&&0===e&&this._messageComposer.abortTextAutoCompletion()},this._onPress=(e,t)=>{e.stopPropagation(),e.preventDefault();const s=qe.default.newCauseId();Q.log(W.LogTraceArea.Navigation,"MessagePanel: onItemPress,  causeId: "+s),this._openGallery(t,s)},this._onInitialRenderComplete=()=>{this._maybeOpenGallery(),this.props.onInitialRenderComplete&&this.props.onInitialRenderComplete()},this._maybeOpenGallery=()=>{if(this._messageStream){const e=this._messageStream.getSkypeMessages(),{focusedMessageCuid:t,scrollToTimestamp:s,conversationId:i}=this.props;let n=o.find(e,(({cuid:e,createdTime:i})=>e===t||i===s));if(!n&&t&&(n=ee.default.getAlbumMessageByConversation(i,t)),n){const e=qe.default.newCauseId();Q.log(W.LogTraceArea.Navigation,"MessagePanel: _maybeOpenGallery, causeId: "+e),this._openGallery(n,e)}}},this._openGallery=(e,t)=>{if(oe.default.isMediaItem(e)||e.isAlbum()){this.state.useMobileUI||ye.default.closeGalleryPanel(t,this._getContext()),Q.track(new ue.MessageContentClicked(e)),Me.pictureViewerWillOpen();const s=new Te.default(Te.ScenarioName.ViewMediaIntent);s.start();let i=e;const o=i.getAlbumId();if(i.isAlbum()){const t=ee.default.getNotFailedMediaMessagesForAlbum(e.getAlbumId());i=t&&t[0]}if(o){const t=ee.default.getSelectedMediaForAlbum(o);if(e.hasBingImageTrackingMetadata()){const s=(0,it.decodeAdditionalDataToURL)(t,e.getBingImageTrackingMetadata());s&&(0,ot.trackImageOpen)(s)}t&&(i=t,ee.default.removeSelectedMediaForAlbum(o))}i&&ie.default.showWithMessageConfig({initialMessage:i,animateOpenClose:!0,reverseOrder:!1,rootViewId:this._getRootViewId(),viewMediaIntentScenario:s,getContentNode:e=>this._mountedContentNodes[e],origin:W.NavigationMediaViewerOrigin.MessageStream}),this._dismissKeyboard()}},this._onMountContent=(e,t,s,i)=>{s?this._mountedContentNodes[i.cuid]={type:e,component:t}:delete this._mountedContentNodes[i.cuid]},this._onKeyboardPaste=e=>{const t=le.default.get(e.nativeEvent);this._onQuoteMessage(t,ze.QuotesTriggerType.KeyboardCopyPaste),t.length>0&&Q.track(new ue.KeyboardMessagesTelemetry(this.props.conversationId,{messagesCount:t.length,actionType:pe.KeyboardActionType.KeyboardPaste}))},this._onQuoteMessage=(e,t)=>{this._sendSearchFirstSuccessfulAction(),this.isComponentMounted()&&this.setState({quotedMessages:e,showTranslatedMessage:o.every(e,(e=>!fe.default.isMyMri(e.creator))),editedMessage:void 0,quotesTriggerType:t})},this._onQuoteSelectionContextMenu=e=>{this._onQuoteMessage(e,ze.QuotesTriggerType.ActionMenu)},this._onSuggestedCardAction=(e,t)=>{this.isComponentMounted()&&(e.type=z.SwiftMessageTypes.carousel,this.state.suggestedCards&&this.state.suggestedCards===e||this.isComponentMounted()&&this.setState({suggestedCards:e,suggestedAction:t}))},this._onSuggestionClicked=()=>{this._messageComposer&&(r.Accessibility.announceForAccessibility(Z.getString("MessageComposer.MessageSentLabel")),this._messageComposer.setTextInputAccessibilityFocus())},this._onScrolledToTheBottom=e=>{this.props.showBottomDivider&&this._scrolledToTheBottom!==e&&(this._scrolledToTheBottom=e,this._showOrHideDivider(this.props,this.state))},this._onScrolledToTheTop=()=>{Ee.default.getPlatformType()===W.PlatformType.Android&&this._dismissKeyboard()},this._onClearQuote=(e=!1)=>{const{quotesTriggerType:t}=this.state;e&&this.state.quotedMessages&&!o.isUndefined(t)&&this.state.quotedMessages.map((e=>Q.track(new ue.QuotesEventTelemetry(this.props.conversationId,e,e.createdTime,ue.MessageActionOrigin.MessageComposer,ue.MessageActionType.ClearQuote,t,He.getMessageTypeName(e))))),this.isComponentMounted()&&this.setState({quotedMessages:void 0})},this._onClearEdit=()=>{this.isComponentMounted()&&this.setState({editedMessage:void 0})},this._onMessageEdit=e=>{this._sendSearchFirstSuccessfulAction(),this.isComponentMounted()&&this.setState({editedMessage:e,quotedMessages:void 0})},this._onEditLastMessage=()=>{let e;if(!T.isAgent(this.props.conversationId)&&!T.isS4BBridgeMri(this.props.conversationId)&&!this.state.e2eeHandshake){const t=this._messageStream&&this._messageStream.getSkypeMessages();e=o.findLast(t,(e=>fe.default.isMyMri(e.creator)&&b.getMessageTypeGroup(e)===b.MessageTypeGroups.Text))}e&&e.isMessageLie()&&(e=void 0),this.state.editedMessage!==e&&this.isComponentMounted()&&this.setState({editedMessage:e,quotedMessages:void 0})},this._postEphemeralMessage=e=>{this.isComponentMounted()&&this._messageStream&&this._messageStream.feedEphemeralMessage(e)},this._onCardsSent=()=>{this.isComponentMounted()&&this.setState({suggestedCards:void 0})},this._onGreet=()=>{this.props.isNewConversation&&this._shouldSendGreetingEvent&&this._sendGreetingEvent(k.GreetActionType.Greet),ke.default.postMessageFromInput(this.props.conversationId,W.PostSource.StartChattingCard,q.convertRawTextToInputEntities("(wave)"),b.MessageTypes.RichText,{name:Te.ScenarioName.SayHi},void 0,this._getRootViewType()),this._sendAddContactTelemetry(k.AddContactOrigin.ChatWave),this._sendFirstMessageTelemetry()},this._onMessageSent=(e,t)=>{if(this.state.enableOldFriendBack&&rt.default.setShouldShowOldFriendBackQuickReply(this.props.conversationId,!1),this.props.isNewConversation&&T.isAgent(this.props.conversationId)&&this._botMessageTimerLimit&&Date.now()-this._botMessageTimerLimit<=6e4){const e=h.default.getAgentDescriptionForMri(this.props.conversationId);this._botMessageTimerLimit=void 0,Q.track(new f.BotMessageInteraction(e.agentId,e.displayName))}if(this._sendFirstMessageTelemetry(),C.default.identity().canUseSlashCommands){const t=this._processSlashCommand(e);if(!o.isUndefined(t))return t}if(this.state.sendLegacyInvite&&!this.state.isConversationAccepted&&!this.state.isIncomingContactInvitePending){const t=q.getRawText(e);P.default.addContact(this.props.conversationId,k.AddContactOrigin.NewConversation,t)}if(this.state.editedMessage)return ke.default.editMessageFromInput(this.state.editedMessage,W.PostSource.MessagePanel,e),this.isComponentMounted()&&this.setState({editedMessage:void 0}),!0;const s=1===e.length&&e[0]instanceof K.SmsEntity?b.MessageTypes.Sms:b.MessageTypes.RichText;this.props.isNewConversation&&this._shouldSendGreetingEvent&&this._sendGreetingEvent(k.GreetActionType.Message);const i={name:Te.ScenarioName.SendTextMessage,secondaryScenariosToSpawnAtCreation:[{name:Te.ScenarioName.SendTextMessageUI},{name:Te.ScenarioName.SendTextMessageTimeToAppearInChat,timeout:2500}]},n={messageComposerAction:t,contentType:o.some(e,(e=>e instanceof K.LinkEntity))?ue.MessageComposerSentContentType.Link:(0,re.getTextMessageTypeFromContent)(this._getPlainTextFromInputEntities(e))};let r;const a=o.first(e);if(a instanceof K.QuoteEntity){const e=a;e.quotedMessage&&e.quotedMessage.properties&&b.isHtmlMessageType(e.quotedMessage.messagetype)&&(r=b.getForwardedTeamsProperties(e.quotedMessage.properties))}const l=L.createMessageInfo(this.props.conversationId,W.PostSource.MessagePanel,e,s,r);de.default.notifyMessageSubmittedToPostingService(l.messageForPosting.clientmessageid),ke.default.postMessage(l,void 0,i,this._getRootViewType(),n);const d=(0,R.default)().getConversation(this.props.conversationId),c=T.ConversationProps.NewConnectionMessageId;if(!T.isAgent(this.props.conversationId)&&this.state.isOneOnOneConversation&&this.state.enableNewConnectionMessage&&!this.state.isContact&&!d.getConversationProperty(c)){const e=l.messageForPosting.clientmessageid;_.default.setConversationProperty(this.props.conversationId,c,e)}return this._sendAddContactTelemetry(k.AddContactOrigin.NewConversation),this._reportUnacknowledgedMessageReadLie(d,l.messageForPosting),this.props.onMessageSent&&this.props.onMessageSent(),!0},this._reportUnacknowledgedMessageReadLie=(e,t)=>{const s=o.find(e.memberConsumptionHorizonsSorted,(e=>e.id===fe.default.getSkypeMri()));if(s&&!this.state.hasReadReceiptsEnabled&&this.state.allowedMessageReadLieMs){new Date(t.composetime).getTime()-s.consumptionHorizonUpdateTime<this.state.allowedMessageReadLieMs&&this._trackMessageReadLieDebounced(t)}},this._trackMessageReadLieDebounced=o.debounce((e=>{Q.track(new ue.MessageReadLie(e,this.props.conversationId))}),6e4,{leading:!0}),this._setShowDragAndDropOverlayStateFalse=()=>{this.isComponentMounted()&&this.setState({showDragAndDropOverlay:!1})},this._setShowDragAndDropOverlayStateTrue=()=>{this.isComponentMounted()&&this.setState({showDragAndDropOverlay:!0})},this._onContactInviteAccepted=()=>{this.isComponentMounted()&&this.setState({isConversationAccepted:!0,isContactInviteJustAccepted:!0,isIncomingContactInvitePending:!1,isSkypeInviteAccepted:!0}),this.state.isOneOnOneConversation&&this.state.enableNewConnectionMessage&&!this.state.isContact&&_.default.setConversationProperty(this.props.conversationId,T.ConversationProps.NewConnectionMessageId,T.newConnectionAcceptedPropValue),this.state.isOneOnOneConversation&&k.ContactsTelemetryHelper.addContactSuccess(this.props.conversationId,k.AddContactOrigin.AcceptButton)},this._onJumpToEndPress=()=>{this._setComposerAccessibilityFocus()},this._resetOngoingDownloads=()=>{S.default.hasDownloadsOnQueue(this.props.conversationId)&&S.default.cancelDownloadsByTag(this.props.conversationId)},this._getInputEntities=()=>this._messageComposer?this._messageComposer.getInputEntities().toEs6Promise():Promise.resolve([]),this._onDragDropText=e=>{var t;null===(t=this._messageComposer)||void 0===t||t.onDragDropText(e)}}componentDidMount(){super.componentDidMount(),this._appStateSubscription=p.default.subscribeForChanges("MessagePanel",(e=>{e===r.Types.AppActivationState.Background&&this.state.isRecording&&this._onDoneRecording()})),this._newConversationSetup(this.props,this.state)}_newConversationSetup(e,t){const s=(0,R.default)(),i=s.getConversation(e.conversationId);i&&(this._lastDeletedTimestamp=i.getDeletedTimestamp()),this._storeConversationStyles(),this._showOrHideDivider(e,t),e.isNewConversation&&!t.isIncomingContactInvitePending&&(this._shouldSendGreetingEvent=!0,this._trackSendMessageOnce=!1),this._conversationUpdatedSubscription=s.subscribe(this._onConversationsStoreUpdate,e.conversationId),this._considerInviteMessageCountReached(i),this._composerContainerRef&&!t.useMobileUI&&this._composerContainerRef.setFocusLimited(!!e.isSelectMessagesModeActive);const o=this._showContactInviteHeader(e,t)&&this._showWave(t);Q.log(W.LogTraceArea.MessageStream,"Show wave:"+o+" isNewContactConversation: "+t.isNewContactConversation+" enableGreetingCard:"+t.enableGreetingCard+" isContactInviteJustAccepted:"+t.isContactInviteJustAccepted+" e2eeHandshake:"+t.e2eeHandshake+" isAnyMessageInTheStream:"+t.isAnyMessageInTheStream+" isPSTNOrSMSConversation: "+t.isPSTNOrSMSConversation),this._focusJoinCallButtonOnce=!!e.focusJoinCallButton}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._directShareFilesToken&&(this._directShareFilesToken.unsubscribe(),this._directShareFilesToken=void 0),this._oldConversationCleanup(),x.default.commit(this.props.conversationId)}_oldConversationCleanup(){this.props.isNewConversation&&this._shouldSendGreetingEvent&&this._sendGreetingEvent(k.GreetActionType.None),this._conversationUpdatedSubscription&&((0,R.default)().unsubscribe(this._conversationUpdatedSubscription),this._conversationUpdatedSubscription=void 0),me.default.deactivatePicker(),this._toggleRecording(!1),this.state.enableAutoDownloadFiles&&this._resetOngoingDownloads()}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.conversationId!==this.props.conversationId&&this.setState({isContactInviteJustAccepted:!1})}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),t.isInCall&&!t.enableAutoDownloadFilesInCall&&this._resetOngoingDownloads(),this.props.enableConversationSwitchWithoutRemount&&this.props.conversationId!==e.conversationId&&(this._oldConversationCleanup(),this._newConversationSetup(e,t))}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),t.isRecording&&!this.state.isRecording&&this._messageComposer&&this._messageComposer.focusSendButton(),t.isAnimationPending&&!this.state.isAnimationPending&&this._shouldFocusMessageComposer&&this._setComposerAccessibilityFocus(),t.e2eeHandshakeState!==this.state.e2eeHandshakeState&&this._showOrHideDivider(this.props,this.state),this._spacerWidthUpdated&&this._storeConversationStyles(),this.props.conversationId!==e.conversationId&&x.default.commit(e.conversationId),t.isSearchingPes&&!this.state.isSearchingPes&&t.deviceOrientation===n.DeviceOrientation.Portrait&&this.state.deviceOrientation===n.DeviceOrientation.Landscape){const e=qe.default.newCauseId();Q.log(W.LogTraceArea.Navigation,"MessagePanel: componentDidUpdate,  causeId: "+e),t.pesTabType!==Pe.TabType.Gif&&ye.default.navigateToPesSearch({searchType:t.pesTabType||Pe.TabType.Emoticon,conversationId:this.props.conversationId,onMessageSent:this._onMessageSent,clearEditInChatsComposer:this._onClearEdit,causeId:e},this._getContext())}this.props.isSelectMessagesModeActive!==e.isSelectMessagesModeActive&&(this._composerContainerRef&&!this.state.useMobileUI&&this._composerContainerRef.setFocusLimited(!!this.props.isSelectMessagesModeActive),!this.props.isSelectMessagesModeActive&&this._messageComposer&&this._setComposerAccessibilityFocus())}onNavigateAway(){this.blur(),se.default.stopActivePlayer()}_buildState(e,t){const s=(0,R.default)().getConversation(e.conversationId),i=this._getRootViewId(),{enableInviteFree:r,sendLegacyInvite:a,sendLegacyInviteSfB:l,maxContactInviteMessageCount:d,enableGroupInviteFree:c,overrideWithAddressBookName:h,enableNewConnectionMessage:u}=g.default.getS4LContactsFeatures(),{enableGreetingCard:p,readReceiptsAllowedLieTime:m,enableAutoDownloadFiles:S,enableAutoDownloadFilesInCall:f,setOverflowMenuButtonToPlainColor:v,enableHandlingHTMLonPaste:_,audioMessageMaxRecordingTimeMs:b}=g.default.getS4LMessagingFeatures(),{conciergeBotSettings:M}=g.default.getEngagementFeatures(),{sendCredit:I}=g.default.getS4LCommerceFeatures(),{enableDesktop:w}=g.default.getS4LIntegrationsFeatures(),k=!!s&&P.default.isConversationAccepted(s.id),O=!!s&&A.default.isSendImCapable(s),L=M.enableVisibility&&T.isConciergeBotMri(e.conversationId),F=T.isReadOnlyConversation(e.conversationId)||L,D=je.default.isTabletUI(),E=T.isPhoneMri(e.conversationId),V=ve.default.isUsingStackNavigationContext(),N=!!s&&void 0!==s.lastMessage,U=I.enabled&&!!s&&Le.isSupportedConversation(s,k),H=!ve.default.isUsingStackNavigationContext()&&Ce.default.isCallChatShowing(),z=y.default.messageToShowInChat(e.conversationId),G=g.default.getEngagementFeatures().oldFriendBack.enable,K={isUsingStackNavigationContext:V,readOnlyConversation:F,useTabletUI:D,useMobileUI:V||D,responsiveWidth:Ae.default.getResponsiveWidth(i),deviceOrientation:Ae.default.getDeviceOrientation(i),isSendImCapable:O,enableInviteFree:r,sendLegacyInvite:a||l&&T.isS4BBridgeMri(e.conversationId),isAnyMessageInTheStream:N,showSendCredit:U,showAddinLauncher:O&&!F&&w&&!V&&!T.isEncryptedThread(e.conversationId)&&!e.selectedNumberForSMS&&!E&&C.default.addins().canUseAddins&&!e.isSelectMessagesModeActive,maximumContactInviteMessageCount:d,isAnimationPending:be.default.isAnimationPending(),keyboardHeight:J.default.getUpdateInfo().height,isPSTNOrSMSConversation:E,e2eeHandshakeState:s&&s.isEncryptedThread()?j.default.getHandshakeState(e.conversationId):void 0,e2eeHandshake:s&&s.isEncryptedThread()?s.getEncryptionHandshake():void 0,enableGreetingCard:p,isBlockedPSTNMri:T.isBlockedPSTNMri(e.conversationId),isBookmark:T.isBookmarkConversation(e.conversationId),isSearchingPes:me.default.isInlineSearchActive(),pesTabType:me.default.getActiveTabType(),hasReadReceiptsEnabled:Se.default.getReadReceiptsEnabled(),allowedMessageReadLieMs:1e3*m,enableAutoDownloadFiles:S,enableAutoDownloadFilesInCall:f,isInCall:Fe.default.isInCall(),setOverflowMenuButtonToPlainColor:v,canUseSlashCommands:C.default.identity().canUseSlashCommands,showCallerIDMessageType:z,enableHandlingHTMLonPaste:_,hideInviteHeader:Ae.default.getDeviceOrientation(i)===n.DeviceOrientation.Landscape&&je.default.isTablet()&&J.default.isKeyboardSeen(),postSource:H?W.PostSource.CallStage:W.PostSource.MessagePanel,isChild:Xe.default.isChild(),maxRecordingTimeMs:b,isConciergeBot:L,isNewsChannel:(0,$e.isContentChannel)(s),isNewsBot:(0,$e.isTodayBot)(e.conversationId),isOneOnOneConversation:null==s?void 0:s.isOneOnOne(),enableNewConnectionMessage:u,isMuted:null==s?void 0:s.isMuted(),enableOldFriendBack:G};t&&(K.contentAreaHeight=0,K.isContactInviteJustAccepted=!1);const q=this.props;if((t||e.conversationId!==q.conversationId||q.scrollToTimestamp!==e.scrollToTimestamp||q.focusedMessageCuid!==e.focusedMessageCuid||q.forceRefreshFocus!==e.forceRefreshFocus)&&(K.isMaximumContactInviteMessageCountReached=!1,K.isRecording=!1,K.isSkypeInviteAccepted=!1,K.showDragAndDropOverlay=!1,t||e.conversationId===q.conversationId||(K.editedMessage=void 0,K.quotedMessages=void 0)),(t||e.conversationId!==q.conversationId||e.isFromSearch!==q.isFromSearch)&&(this._canSendSearchFirstSuccessAction=!!e.isFromSearch),K.isConversationAccepted=!0,s&&(!s.isOneOnOne()&&c||s.isOneOnOne()&&!T.isAgent(e.conversationId))){K.isConversationAccepted=k,K.isIncomingContactInvitePending=!s.isEncryptedThread()&&(P.default.isIncomingContactInvitePending(s.id)||!!e.inviteToken&&(t||!this.state.isSkypeInviteAccepted)&&e.otherPartyMri&&!P.default.isContact(e.otherPartyMri)),t||(!this.state.isConversationAccepted&&K.isConversationAccepted&&(K.isContactInviteJustAccepted=!0),K.isConversationAccepted||(K.isContactInviteJustAccepted=!1)),Q.log(W.LogTraceArea.MessageStream,`Conversation: [id: ${xe.mriOrId(s.id)}, isConversationAccepted: ${K.isConversationAccepted}, isIncomingContactInvitePending: ${K.isIncomingContactInvitePending}, isContactInviteJustAccepted: ${K.isContactInviteJustAccepted}]`);const i=s.isOneOnOne()?s.getOtherPartyMri():void 0;if(h&&i)K.recipientDisplayName=B.default.getShortDisplayName(i);else{const t=B.default.getDisplayableProfile(e.conversationId);K.recipientDisplayName=t.getShortName()}K.isConversationAccepted&&(K.isMaximumContactInviteMessageCountReached=!1)}s&&K.isOneOnOneConversation&&!s.isEncryptedThread()&&e.otherPartyMri?K.isContact=P.default.isManuallyAddedContact(e.otherPartyMri):K.isContact=!1;const X=x.default.getSavedMessageInput(e.conversationId),$=X?X.messages:null;if(K.pastedTextType=null==X?void 0:X.pastedTextType,$&&$.length>0&&X)switch(X.type){case Oe.SavedMessageType.Edited:K.editedMessage=o.first($);break;case Oe.SavedMessageType.Quoted:K.quotedMessages=$}K.e2eeHandshakeState?(t||e.conversationId!==q.conversationId)&&(K.showInviteHeaderForEncryptedThread=!!s&&!s.getThreadProperty(T.ThreadProps.SecureHandshakeOnceEstablished)):K.showInviteHeaderForEncryptedThread=!1,K.isNewContactConversation=K.isSendImCapable&&!K.isIncomingContactInvitePending&&!K.readOnlyConversation&&!K.isConversationAccepted;const Y=K.isConversationAccepted&&!K.e2eeHandshake&&!e.selectedNumberForSMS;return K.showPesCategorySwitcher=K.isSearchingPes?Y:Y&&je.default.isTablet()&&me.default.isPickerActive(),K.initialInputEntities=X?X.inputEntities:lt,K.initialInputEntitiesDataVersion=X?X.inputEntitiesDataVersion:0,K}requestFocus(){this._messageComposer&&this._messageComposer.requestFocus()}blur(){this._messageComposer&&this._messageComposer.blur()}focusTextInputForAccessibility(){this._setComposerAccessibilityFocus()}_dismissKeyboard(){this._messageComposer&&this._messageComposer.blurIfFocused()}_setComposerAccessibilityFocus(){this._messageComposer&&this._messageComposer.setTextInputAccessibilityFocus()}_allowsUpload(){return!this.state.e2eeHandshake&&this.props.allowUploads}render(){return this.state.isBookmark?this._updateBookmarkStreamSpacers():this._updateMessageStreamSpacers(),(0,i.jsxs)(r.View,Object.assign({style:Ue.default.flexOne},{children:[this._getContactInviteHeader(),this._getMessageStream()]}))}_updateMessageStreamSpacers(){this._leftMessageStreamSpacerWidth=0,this._rightMessageStreamSpacerWidth=0,this._spacerWidthUpdated=!1,this._getContext().isPresentedInDesktopSubview||this.state.useMobileUI?this._getContext().isPresentedInDesktopSubview?(this._leftMessageStreamSpacerWidth=5,this._rightMessageStreamSpacerWidth=15,this._spacerWidthUpdated=!0):this.state.useTabletUI&&(this._leftMessageStreamSpacerWidth=at,this._rightMessageStreamSpacerWidth=at,this._spacerWidthUpdated=!0):(this.state.isRenderedIn4ColumnWidth?this._leftMessageStreamSpacerWidth=at:(this._rightMessageStreamSpacerWidth=80-he.messageStreamOverflowWidth,this._leftMessageStreamSpacerWidth=80-he.messageStreamOverflowWidth),this._spacerWidthUpdated=!0)}_updateBookmarkStreamSpacers(){{const e=this.state.isRenderedIn4ColumnWidth?30:100;this._leftMessageStreamSpacerWidth=e,this._rightMessageStreamSpacerWidth=e}this._spacerWidthUpdated=!0}_getContactInviteHeader(){if(this.state.hideInviteHeader)return;let e;return this._hasPendingIncomingContactRequest()?this.state.isUsingStackNavigationContext||(e=(0,i.jsx)(w.default,{conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isIncomingContactInvitePending:this.state.isIncomingContactInvitePending,onIncomingContactInviteAccepted:this._onContactInviteAccepted,inviteToken:this.props.inviteToken},this.props.conversationId)):this._showContactInviteHeader(this.props,this.state)&&(e=(0,i.jsx)(w.default,{conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isIncomingContactInvitePending:!1,isContactInviteJustAccepted:this.state.isContactInviteJustAccepted,isEncryptedConversationEstablished:this._isEncryptedConversationEstablished(),isAnyMessageInTheStream:this.state.isAnyMessageInTheStream,showWave:this._showWave(this.state),onGreet:this._onGreet},this.props.conversationId)),e}_getMessageStream(){let e;const t=this._getContext().isPresentedByMobileStackNavigator;e=this.props.hasUnderlay?[Ue.default.flexOne,Ue.default.transparentBackground]:[Ue.default.flexOne,r.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1)],this.props.containerStyleOverride&&e.push(this.props.containerStyleOverride);let s=(0,i.jsxs)(r.View,Object.assign({style:[e,t?dt.paddingMobileBrowser:void 0]},{children:[this._getNetworkConnectionAlert(),(0,i.jsxs)(r.View,Object.assign({style:dt.contentOuterContainer},{children:[this._getContentArea(),this._getOptionalAutoSuggestionCompletion()]})),this._getMessageComposerArea(),this._getNotificationsButton(),this._getDragAndDropOverlay()]}));return v.UICapabilities.dragAndDropSupported()&&this._allowsUpload()&&(s=(0,i.jsx)(V.default,Object.assign({origin:te.FilePickerOrigin.DragAndDropToMessagePanel,style:e,conversationId:this.props.conversationId,onDragEnter:this._setShowDragAndDropOverlayStateTrue,onDragLeave:this._setShowDragAndDropOverlayStateFalse,onDropCompleted:this._setShowDragAndDropOverlayStateFalse,dropTargetSource:N.DropTargetOrigin.MessagePanel,onDragDropText:this._onDragDropText},{children:s}))),s}_getMessageComposerArea(){if(this.state.isNewsChannel||this.state.isNewsBot||this.state.isBookmark||this._hasPendingIncomingContactRequest()||this.props.isMessageSearchPanelVisible&&(this.state.useMobileUI||this.state.useTabletUI))return;const e=a.BrowserEnvironment.isMobile(),t=[dt.messageComposerOuterContainerHorizontal,r.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1)];this.state.useMobileUI&&!e||t.push(dt.messageComposerContainerDesktop);const s=[dt.messageComposerHorizontalSpacer],o=[dt.messageComposerHorizontalSpacer],n=dt.messageComposerHorizontalSpacerDesktop;this.state.useMobileUI||(s.push(n),o.push(n)),!this.state.useMobileUI&&this.state.suggestionsShown&&(t.push(dt.messageComposerContainerWithSuggestionsDesktop),s.push(dt.messageComposerHorizontalSpacerWithSuggestionsDesktop),o.push(dt.messageComposerHorizontalSpacerWithSuggestionsDesktop));const l=this.state.responsiveWidth<=Ne.ResponsiveWidth.Tiny,d=this.state.responsiveWidth<=Ne.ResponsiveWidth.Small;this._getContext().isPresentedInDesktopSubview||this.state.useMobileUI?this._getContext().isPresentedInDesktopSubview?(s.push(dt.messageComposerHorizontalTinySpacer),o.push(dt.messageComposerHorizontalTinySpacer)):(this.state.useTabletUI||e)&&(s.push(dt.messageComposerHorizontalSmallSpacer),o.push(dt.messageComposerHorizontalSmallSpacer)):(s.push(dt.defaultRightSpacerStyle),s.push(dt.defaultRightSpacerStyleForComposerWithPopup),this.state.isRenderedIn4ColumnWidth?(this.state.showAddinLauncher||s.push(dt.messageComposerHorizontalSmallSpacer),o.push(dt.messageComposerHorizontalSmallSpacer)):(s.push(dt.messageComposerHorizontalBigSpacer),o.push(dt.messageComposerHorizontalBigSpacer))),l||this._getContext().isPresentedInDesktopSubview||this.state.useMobileUI||this.state.isRenderedIn4ColumnWidth||(o.push(dt.toggleLeftPanelButtonContainer),d&&o.push(dt.toggleLeftPanelButtonContainerSmallView));const c=[dt.messageComposerOuterContainerVertical,this.state.useMobileUI?void 0:this._messageComposerOpacityStyle];let h;return this.state.isSearchingPes&&this.state.useMobileUI&&(c.push(dt.hideComposer),h=r.Types.ImportantForAccessibility.NoHideDescendants),(0,i.jsxs)(r.Animated.View,Object.assign({ref:this._onComposerContainerRef,style:c,limitFocusWithin:r.Types.LimitFocusType.Limited,importantForAccessibility:h},{children:[(0,i.jsx)(r.View,{style:o}),(0,i.jsx)(r.View,Object.assign({style:t},{children:this._getMessageComposerInner()})),(0,i.jsx)(r.View,Object.assign({style:s},{children:this._getToggleSideBarButton()}))]}),"composer")}_getNotificationsButton(){if(!this.state.isNewsChannel&&!this.state.isNewsBot)return;const e=r.Styles.createViewStyle({borderTopWidth:l.StyleSheet.hairlineWidth,borderColor:this._themeColors.dividerPrimary},!1),t=this.state.isMuted?Z.getString("ConversationsListItem.UnmuteLabel"):Z.getString("ConversationsListItem.MuteLabel"),s=()=>{const e=this.state.isMuted?"":T.SubscriptionTypes.Muted,t=He.getConversationTypeForTelemetry(this.props.conversationId);_.default.setConversationSubscription(this.props.conversationId,e).then((()=>{Q.track(new Ze.ChatNotificationsToggleSetting(this.state.isMuted,void 0,this.props.conversationId,e,et.NotificationsSource.MessagePanelNotifications,t))}))};return(0,i.jsx)(d.BottomTabBarHeightContext.Consumer,{children:o=>(0,i.jsx)(r.View,Object.assign({style:[dt.notificationsButtonWrapper,e,r.Styles.createViewStyle({height:o},!1)]},{children:(0,i.jsx)(Je.default,{buttonStyle:I.SXButtonStyle.Custom,title:t,hoverText:t,accessibilityLabel:t,onPress:s,buttonSize:I.SXButtonSize.Medium,textStyleOverride:[tt.default.fontStyle.semibold15],buttonConfig:{textColor:this._useAccessibleTheme()?this._themeColors.primaryTextColor:this._themeColors.textInteractive,backgroundColor:Ye.Color.transparent}},"notifications-button")}))})}_getToggleSideBarButton(){}_getMessageComposerInner(){let e;return e=this._shouldShowHandshakeControl(this.state)?this._getE2eeHandshakeControl():this.state.isRecording?this._getAudioComposer():!this.state.isSendImCapable||this.state.readOnlyConversation||this.state.isMaximumContactInviteMessageCountReached||this.state.isBlockedPSTNMri?this._getDisabledComposer():this.state.isBookmark?void 0:this._getMessageComposer(),e}_getDisabledComposer(){if(this.state.isConciergeBot)return;const e=this.state.isMaximumContactInviteMessageCountReached?Z.getString("MessageStream.MaximumContactInviteMessagesWarning",{recipientDisplayName:this.state.recipientDisplayName}):Z.getString("MessageStream.MessagingUnavailable");return(0,i.jsx)(r.View,Object.assign({style:dt.messagingUnavailableContainer},{children:(0,i.jsx)(We.BodyText,Object.assign({size:We.BodyTextSize.SmallDeprecated,style:dt.messagingUnavailablePlaceholder,textThemeColor:We.TextThemeColor.Disabled},{children:e}))}))}_getMessageComposer(){const e=[dt.messageComposerInner];this.props.safeAreaHorizontalInsets&&Re.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&e.push(Re.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets)),this.state.useTabletUI&&e.push(dt.tabletMessageComposer);const t=!!this.state.e2eeHandshake,s=!this._allowsUpload(),o=T.isMyBotConversation(this.props.conversationId);return(0,i.jsx)(r.View,Object.assign({style:e},{children:(0,i.jsx)(ne.default,{ref:this._onMessageComposerRef,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,disableCopyPasteMedia:s,initialInputEntities:this.state.initialInputEntities,initialInputEntitiesDataVersion:this.state.initialInputEntitiesDataVersion,maxLength:(0,nt.getConversationMaxMessageLength)(this.state.isConversationAccepted),shouldAutoFocus:this.props.shouldAutoFocusInput,preventAccessibilityFocus:this.props.preventAccessibilityFocus||this.props.isSelectMessagesModeActive,availableWidth:this.props.availableWidth,hideMediaBar:this.props.hideMediaBar||this.props.isSelectMessagesModeActive,hideMojiPickerIcon:!this.state.isConversationAccepted||t,hideStickerPickerIcon:!this.state.isConversationAccepted||t,hideSendCreditIcon:!this.state.showSendCredit||t,hideFilePicker:!this.state.isConversationAccepted&&!t||t,hideScheduleCallIcon:T.isAgent(this.props.conversationId)||t,hidePollIcon:t||o,hideMediaPickerIcon:!0,hideLocationPickerIcon:this.state.isChild||t,hideContactPickerIcon:t,hideVideoMessageIcon:this._getContext().isPresentedByMobileStackNavigator,hideAudioMessage:t,headerHeightAndroid:this.props.headerHeightAndroid,quotedMessages:this.state.quotedMessages,quotesTriggerType:this.state.quotesTriggerType,editedMessage:this.state.editedMessage,suggestedCards:this.state.suggestedCards,suggestedAction:this.state.suggestedAction,showTranslatedMessage:this.state.showTranslatedMessage,onClearQuotedMessage:this._onClearQuote,onClearEdit:this._onClearEdit,onMessageSent:this._onMessageSent,onEditLastMessage:this._onEditLastMessage,onInputTextChanged:this._onInputTextChanged,onKeyPress:this._onKeyPress,onRecording:this._onRecording,onLaunchCamera:this.props.onLaunchCamera,onCardsSent:this._onCardsSent,onShowOverflow:this._onShowOverflow,onShowGestureHint:this.props.onShowGestureHint,onHandleOverflow:this.props.onHandleOverflow,onNativeComposerMessageEmptyStateChanged:this._onNativeComposerMessageEmptyStateChanged,onKeyboardPaste:this._onKeyboardPaste,hideContentInMessageComposer:this.props.isSelectMessagesModeActive,inlineSearchModeActive:this.state.isSearchingPes,explicitAccessibilityAnnoucement:!1,preventFocusOnMount:!!this.props.focusedMessageCuid,phoneNumberForSendingSms:this.props.selectedNumberForSMS,isInCall:this.state.isInCall,pastedTextType:this.state.pastedTextType},this.props.conversationId)}))}_getAudioComposer(){return(0,i.jsx)(r.View,Object.assign({style:dt.messageComposerInner},{children:(0,i.jsx)(m.default,{conversationId:this.props.conversationId,onDone:this._onDoneRecording,maxRecordingTimeMs:this.state.maxRecordingTimeMs},this.props.conversationId)}))}_getE2eeHandshakeControl(){return(0,i.jsx)(r.View,Object.assign({style:dt.messageComposerInner},{children:(0,i.jsx)(U.default,{conversationId:this.props.conversationId,e2eeHandshakeState:this.state.e2eeHandshakeState,e2eeHandshake:this.state.e2eeHandshake},this.props.conversationId)}))}_getContentArea(){const e={width:this.state.contentAreaWidth,height:this.state.contentAreaHeight};Q.debug((()=>["DIM_CALC - message panel - contentAreaWidth: ",this.state.contentAreaWidth," contentAreaHeight: ",this.state.contentAreaHeight]));const t=this._hasPendingIncomingContactRequest(),s=this._isComposingIndicatorDisabled(),o=this._isEncryptedConversationEstablished();return(0,i.jsx)(ce.default,{ref:this._onMessageStreamRef,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,focusedMessageCuid:this.props.focusedMessageCuid,forceRefreshFocus:this.props.forceRefreshFocus,hasUnderlay:!!this.props.hasUnderlay,topInset:this.props.topInset,disableComposingIndicator:s,isConversationAccepted:this.state.isConversationAccepted,isIncomingContactInvitePending:this.state.isIncomingContactInvitePending,isContactInviteJustAccepted:this.state.isContactInviteJustAccepted,recipientDisplayName:this.state.recipientDisplayName,renderOrigin:this.props.renderOrigin,onItemPress:this._onPress,containerInitialDimensions:e,onUserScrolledToTheTop:this._onScrolledToTheTop,onScrolledToTheBottom:this._onScrolledToTheBottom,onGreet:this._onGreet,onQuoteMessage:this._onQuoteMessage,onQuoteSelectionContextMenu:this._onQuoteSelectionContextMenu,onMessageEdit:this._onMessageEdit,onCardSuggestionAction:this._onSuggestedCardAction,onSuggestionClicked:this._onSuggestionClicked,onSuggestionsToggled:this._onSuggestionsToggled,onMountContent:this._onMountContent,onMessageStreamLayout:this._onMessageStreamLayout,onMessageStreamScreenReaderFocusUpdated:this._onMessageStreamScreenReaderFocusUpdated,onMessageSent:this._onMessageSent,onContactInviteAccepted:this._onContactInviteAccepted,onJumpToEndPress:this._onJumpToEndPress,inviteToken:this.props.inviteToken,safeAreaHorizontalInsets:this.props.safeAreaHorizontalInsets,leftSpacerWidth:this._leftMessageStreamSpacerWidth,rightSpacerWidth:this._rightMessageStreamSpacerWidth,onInitialRenderComplete:this._onInitialRenderComplete,isInvisible:this.props.isInvisible,renderDivider:this._shouldRenderDivider()?this._divider:void 0,showInviteHeaderForEncryptedThread:this.state.showInviteHeaderForEncryptedThread,isEncryptedConversationEstablished:o,isSelectMessagesModeActive:this.props.isSelectMessagesModeActive,disableSelectMultipleMessages:this._getContext().isPresentedInDesktopSubview,disableReportMessage:this.props.disableReportMessage,disablePlugins:this.props.disablePlugins,hideSuggestions:t,isMessageSearchPanelVisible:this.props.isMessageSearchPanelVisible,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isTranslatedConversation:this.props.isTranslatedConversation,searchStore:this.props.searchStore,isRenderedIn4ColumnWidth:this.state.isRenderedIn4ColumnWidth,getInputEntities:this._getInputEntities},this.props.conversationId)}_isComposingIndicatorDisabled(){return!!this.state.e2eeHandshake&&this.state.e2eeHandshakeState!==H.SecureHandshakeState.Completed||this.state.isBookmark}_getOptionalAutoSuggestionCompletion(){if(this.state.isBookmark)return;let e;if(this.state.isSearchingPes&&this.state.useMobileUI)e=(0,i.jsx)(we.PesInlineSearchContainer,{conversationId:this.props.conversationId,insertSearchResultToComposer:this._insertSearchResultsToComposer,pesTabType:this.state.pesTabType,showPesCategorySwitcher:this.state.showPesCategorySwitcher,showInLandscape:this.state.useTabletUI,containerWidth:this.state.contentAreaWidth});else{const t=this._getAvailableHeight();if(t>0){const s=Math.max((this.state.contentAreaWidth-he.maxStreamContentWidth)/2,0),o=this.state.canUseSlashCommands&&!this.state.quotedMessages;e=(0,i.jsx)(ge.MessageTextCompletion,{ref:this._onTextCompletionRef,style:this.state.useMobileUI?dt.messageTextCompletion:void 0,conversationId:this.props.conversationId,showSlashCommands:o,onReplaceText:this._onReplaceText,onTextReplacementCandidatesShown:this._onTextReplacementCandidatesShown,maxMenuHeight:t,leftOffset:s})}}return e}_getNetworkConnectionAlert(){let e;return this.state.isUsingStackNavigationContext&&(e=(0,i.jsx)(_e.default,{})),e}_getDragAndDropOverlay(){if(this.state.isBookmark)return;let e;return this.state.showDragAndDropOverlay&&this._allowsUpload()&&(e=(0,i.jsx)(E.default,{})),e}_isEncryptedConversationEstablished(){return this.state.e2eeHandshakeState?this.state.e2eeHandshakeState===H.SecureHandshakeState.Completed:void 0}_hasPendingIncomingContactRequest(){return this.state.isSendImCapable&&this.state.isIncomingContactInvitePending&&!this.state.readOnlyConversation}_shouldRenderDivider(){return this.state.useMobileUI}_getAvailableHeight(){const e=(0,ce.shouldUseAltMsgView)()?this.state.contentAreaHeight:this.state.contentAreaHeight-this.state.keyboardHeight;return Math.max(0,e)}_considerNavigationAfterDeleteConversation(e){if(e&&this._lastDeletedTimestamp<e.getDeletedTimestamp()){const e=qe.default.newCauseId();Q.log(W.LogTraceArea.Navigation,"MessagePanel._onConversationsStoreUpdate causeId: "+e),ye.default.navigateAfterDeleteConversation(this.props.conversationId,e,this._getContext())}}_considerRefreshingContactsStore(e){e&&e.isOneOnOne()&&!T.isAgent(this.props.conversationId)&&e.getConversationStatus()===W.ConversationStatus.AcceptPendingSender&&P.default.isConversationAccepted(e.id)&&P.default.triggerContactsRefresh()}_considerInviteMessageCountReached(e){const t=this.state&&this.state.isConversationAccepted;if(t)return;const s=e&&e.getAcceptPendingMessageCount(),i=!o.isUndefined(s)&&s>=this.state.maximumContactInviteMessageCount,n=!t&&!T.isReadOnlyConversation(this.props.conversationId)&&!this.state.isPSTNOrSMSConversation&&i;this.isComponentMounted()&&this.setState({isMaximumContactInviteMessageCountReached:n,isConversationAccepted:t})}_toggleRecording(e){if(e&&!this.state.isRecording){if(this.isComponentMounted()){let e=Ne.PermissionPromptOptions.SkipPrePrompt;0,st.default.AugmentedPermissionsPromptHelper.subscribeToAugmentedPermissionEvents(),Ie.default.requestPermission(Ne.PermissionType.Microphone,e).then((e=>{st.default.AugmentedPermissionsPromptHelper.unsubscribeFromAugmentedPermissionEvents(),e===X.PermissionStatus.Granted&&this.setState({isRecording:!0})}))}n.default.blockScreenLock().catch((e=>{Q.warn(W.LogTraceArea.MessageStream,"blockScreenLock failed: "+De.default.errorAsString(e))}))}else!e&&this.state.isRecording&&(this.isComponentMounted()&&this.setState({isRecording:!1}),n.default.allowScreenLock().catch((e=>{Q.warn(W.LogTraceArea.MessageStream,"allowScreenLock failed: "+De.default.errorAsString(e))})))}_shouldShowHandshakeControl(e){return e.e2eeHandshake&&e.e2eeHandshakeState&&e.e2eeHandshakeState!==H.SecureHandshakeState.Completed}_showOrHideDivider(e,t){if(!e.showBottomDivider)return;const s=this._shouldShowHandshakeControl(t)||!this._scrolledToTheBottom;this._dividerOpacityValue.setValue(s?1:0)}_postCallerIdMessage(){if(this.state.showCallerIDMessageType){const e=L.createCallerIdMessage(this.props.conversationId,this.state.showCallerIDMessageType);y.default.notifyMessageShown(this.props.conversationId),this._postEphemeralMessage(e),this.isComponentMounted()&&this.setState({showCallerIDMessageType:void 0})}}_processSlashCommand(e){const t=Be.findSlashCommand(this.props.conversationId,e);switch(t.result){case Be.FindResult.InvalidLooksLikeCommand:const s=Z.getString("MessageComposer.InvalidSlashCommand"),i=L.createMessageInfoFromEscapedText(this.props.conversationId,W.PostSource.SlashCommand,s);return this._postEphemeralMessage(i),!1;case Be.FindResult.FoundCommand:Q.log(W.LogTraceArea.MessagePanel,`Running slashCommand ${t.command}`);const o=(0,G.get)(t,["command","action"]),n=(0,G.get)(t,["params"])||"";if(o){const t=o(n,this.props.conversationId,e,this._postEphemeralMessage);switch(t){case $.ActionResult.None:return!0;case $.ActionResult.InvalidParameters:const e=Z.getString("MessageComposer.InvalidSlashCommandParameters",{parameters:n}),s=L.createMessageInfoFromEscapedText(this.props.conversationId,W.PostSource.SlashCommand,e);return this._postEphemeralMessage(s),!1;default:qe.default.switchStatementExhaustiveChecking(t,"Missing case for SlashCommand.ActionResult")}}return!1;case Be.FindResult.None:return;default:qe.default.switchStatementExhaustiveChecking(t.result,"Missing case for SlashCommand.FindResult")}}_sendAddContactTelemetry(e){this.state.isContact||T.isAgent(this.props.conversationId)||!this.state.isOneOnOneConversation||this._trackAddContactOnce||(this._trackAddContactOnce=!0,k.ContactsTelemetryHelper.addContactSuccess(this.props.conversationId,e))}_sendFirstMessageTelemetry(){this.props.isFromPeopleRecommendations&&!this._trackSendMessageOnce&&(this._trackSendMessageOnce=!0,Ke.messageSent(this.props.conversationId))}_sendGreetingEvent(e){k.ContactsTelemetryHelper.greetContact(this.props.conversationId,e),this._shouldSendGreetingEvent=!1}_showWave(e){return e.enableGreetingCard&&!e.isContactInviteJustAccepted&&!e.e2eeHandshake&&!e.isAnyMessageInTheStream&&!e.isPSTNOrSMSConversation}_showContactInviteHeader(e,t){return!t.isUsingStackNavigationContext&&(t.isNewContactConversation||t.showInviteHeaderForEncryptedThread||t.isContactInviteJustAccepted)&&!T.isPhoneMri(e.conversationId)}_sendSearchFirstSuccessfulAction(){this.props.isFromSearch&&this._canSendSearchFirstSuccessAction&&(Ke.messageTypingStarted(this.props.conversationId),this._canSendSearchFirstSuccessAction=!1)}_getPlainTextFromInputEntities(e){return o.reduce(e,((e,t)=>(t instanceof K.UnhandledEntity&&(e+=t.text()),e)),"")}}t.default=ct},529308:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shouldUseAltMsgView=void 0;const i=s(570655),o=s(667294),n=s(785893),r=s(174958),a=s(496486),l=s(823274),d=s(516778),c=s(269399),h=(s(23095),s(889391)),u=s(220490),p=s(127878),g=s(138438),m=s(905531),S=s(481169),f=s(422801),y=s(260021),v=s(871908),C=s(351077),_=s(581697),b=s(671830),T=s(898278),M=s(63060),I=s(700842),w=s(738386),P=s(475760),k=s(539549),A=s(882261),x=s(899686),R=s(816402),O=s(706217),L=s(77388),F=s(770891),B=s(746096),D=s(791771),E=s(649770),V=s(436237),N=s(974822),U=s(861253),j=s(915877),H=s(647662),z=s(733754),W=s(518606),G=s(917589),K=s(795133),q=s(788952),Q=s(314572),X=s(51470),$=s(106658),J=s(50353),Y=s(812056),Z=s(812056),ee=s(10909),te=s(257538),se=s(844972),ie=s(593486),oe=s(89808),ne=s(178735),re=s(46929),ae=s(18078),le=s(104735),de=s(330124),ce=s(996285),he=s(213847),ue=s(864674),pe=s(785207),ge=s(843898),me=s(903404),Se=s(29130),fe=s(914976),ye=s(415963),ve=s(144487),Ce=s(55585),_e=s(115761),be=s(965988),Te=s(699948),Me=s(344352),Ie=s(980760),we=s(252333),Pe=s(667806),ke=s(307698),Ae=s(867241),xe=s(858774),Re=s(930428),Oe=s(223802),Le=s(915415),Fe=s(640363),Be=(s(680837),s(619675)),De=s(24576),Ee=s(912770),Ve=s(702301),Ne=s(567977),Ue=s(172758),je=s(853374),He=s(169015),ze=s(110996),We=s(269399),Ge=s(721956),Ke=s(360305),qe=s(870675),Qe=s(741660),Xe=s(730452),$e=s(62658),Je=s(818882),Ye=s(952065),Ze=s(952262);class et{constructor(e,t,s,i=24){this.key=e,this.readReceiptsHeads=t,this.readReceiptsSum=s,this.height=i,this.focusable=!0}}class tt{constructor(e,t,s=36){this.key=e,this.dateOfMarker=t,this.height=s,this.focusable=!1}}class st{constructor(e,t,s=Ae.ItemListKey.Composing,i=45){this.composingMris=e,this.conversationId=t,this.key=s,this.height=i,this.focusable=!1}}class it{constructor(e=Ae.ItemListKey.UnreadMarker,t=36,s=!1){this.key=e,this.height=t,this.focusItemOnMountOnMobile=s,this.focusable=!0}}class ot{constructor(e=Ae.ItemListKey.OldFriendBack,t=36,s=!1,i){this.key=e,this.height=t,this.focusItemOnMountOnMobile=s,this.userMri=i,this.focusable=!0}}class nt{constructor(e=Ae.ItemListKey.NewConnection,t=32,s=!1){this.key=e,this.height=t,this.focusItemOnMount=s,this.focusable=!0}}class rt{constructor(e,t=Ae.ItemListKey.ReadOnlyChatHeader,s=300){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}class at{constructor(e=Ae.ItemListKey.ContactInviteHeaderItem,t,s,i,o,n,r){this.key=e,this.height=t,this.showWave=s,this.isContactInviteJustAccepted=i,this.isContactInvitePending=o,this.isEncryptedConversationEstablished=n,this.isAnyMessageInTheStream=r,this.focusable=!0}}class lt{constructor(e,t=Ae.ItemListKey.InviteMorePeople,s=60){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}class dt{constructor(e,t=Ae.ItemListKey.InviteMorePeople,s=480){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}class ct{constructor(e,t=Ae.ItemListKey.InviteMorePeople,s=480){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}class ht{constructor(e,t=Ae.ItemListKey.SpeechConsent,s=480){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}const ut=3e5,pt=Number.MAX_VALUE,gt=(0,j.lazyProperties)({contentOuterContainer:()=>d.Styles.createViewStyle({flex:1,alignSelf:"stretch",backgroundColor:"transparent"}),spinnerContainer:()=>d.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center"}),contactInviteUserIcon:()=>d.Styles.createViewStyle({alignSelf:"center",marginVertical:4}),composingIndicatorContainerMobile:()=>d.Styles.createViewStyle({marginHorizontal:10}),composingIndicatorContainerDesktop:()=>d.Styles.createViewStyle({marginHorizontal:0}),actionsDesktopContainer:()=>d.Styles.createViewStyle({flex:-1,flexDirection:"row",overflow:"visible"}),noMessagesContainer:()=>d.Styles.createViewStyle({position:"absolute",top:0,left:20,right:20,bottom:0,justifyContent:"center"}),contentAreaContainer:()=>d.Styles.createViewStyle({flex:1,height:200}),tabletMargin:()=>d.Styles.createViewStyle({marginHorizontal:20}),groupEngagementButtons:()=>d.Styles.createViewStyle({flex:0,flexDirection:"row",paddingHorizontal:25,alignSelf:"stretch",justifyContent:"center",flexWrap:"wrap",alignItems:"stretch"}),groupEngageButtonStyle:()=>d.Styles.createButtonStyle({marginHorizontal:5,marginVertical:10,minWidth:200}),newConnectionContainer:()=>d.Styles.createViewStyle({flex:1,alignItems:"center",height:32,paddingTop:5})}),mt={};function St(){return!1}var ft;t.shouldUseAltMsgView=St,function(e){e[e.SkipProcessingDueToRaceCondition=0]="SkipProcessingDueToRaceCondition",e[e.Optimize=1]="Optimize",e[e.StandardFlow=2]="StandardFlow"}(ft||(ft={}));class yt extends De.default{constructor(){super(...arguments),this._lockUpdatesToConsumptionHorizon=!1,this._scrollingStartTime=-1,this._scrollingStartTimeReenable=-1,this._showSearchOptionsDelay=3,this._showSearchOptionsReenableDelay=3,this._topPartialViewIndex=-1,this._topWholeViewIndex=-1,this._bottomWholeViewIndex=-1,this._bottomPartialViewIndex=-1,this._lastViewIndex=0,this._lastReceivedMessageTimestamp=0,this._lastSentMessageTimestamp=0,this._lastMessageTimestamp=0,this._lastSentMessageTimestampInitial=0,this._skypeMessages=[],this._unreadMarkerShown=!1,this._unreadMarkerTimestamp=0,this._unreadMarkerMessageIndex=-1,this._unreadMarkerViewIndex=-1,this._oldUnreadCount=0,this._isUserPresentInApp=!0,this._isUserScrolling=!1,this._readOnlyConversation=!1,this._oldConsumptionHorizonTimestamp=pt,this._currentConsumptionHorizonTimestamp=pt,this._composingMris=[],this._contentRendered=!1,this._disallowFetchingMoreMessagesFromStore=!1,this._isFocusInsideMessageStreamOnMount=!1,this._isMessageStreamFocusStatusNotified=!1,this._virtualMessageViewRefCount=0,this._openAnimationCompleted=!1,this._readReceiptsKeysCounter=0,this._firstUpdateCompleteForMutliSelect=!1,this._readReceiptsThrottleTimeout=h.default.getS4LMessagingFeaturesNoSubscription().messageReadEventTimeout,this._sendMessageReadEventThrottled=V.throttleTrack(this._readReceiptsThrottleTimeout),this._statusPillInstance=new Me.default,this._lastMessageFullyVisible=!1,this._shouldFocusLastMessage=!1,this._streamItemRefs={},this._speechConsentSuggestionSeenAt=-1,this._instrumentationCallback=(e,t,s)=>{t&&t!==B.LogTraceArea.MessageStream&&t!==B.LogTraceArea.MessageStreamDebug&&t!==B.LogTraceArea.MessageStreamStore&&t!==B.LogTraceArea.MessageStreamStoreDebug&&t!==B.LogTraceArea.VirtualMessageView&&t!==B.LogTraceArea.VirtualMessageViewDebug&&t!==B.LogTraceArea.ConsumptionHorizon&&a.defer((()=>{if(this.isComponentMounted()){const i=e===r.LogLevel.Error?"Error":e===r.LogLevel.Warning?"Warning":e===r.LogLevel.Trace?B.LogTraceArea[t]:e===r.LogLevel.Debug1?"Info":e===r.LogLevel.Debug3?"Log":e===r.LogLevel.Debug4?"Debug":"Unknown",o=A.createMessageInfoFromEscapedText(b.SkonsoleMri,B.PostSource.EphemeralMessage,"["+i+"] "+a.map(s,(e=>e+"")).join(""));this._checkMessageStreamStoreAndUpdate(this.props,this.state.scrollRequest,"in defer call of _instrumentationCallback"),this.feedEphemeralMessage(o)}}))},this._onMessageStreamStoreTrigger=e=>{if(this.isComponentMounted()&&!this.props.isInvisible){if(e&&2===e.length&&"messageSentSuccessNotification"===e[0]&&void 0!==e[1]){const t=e[1];return this._updateStreamItemsAndReturnNewState(this.props,void 0,t)}return this._updateStreamItemsAndReturnNewState(this.props)}return{}},this._applyModificationsDebounced=a.debounce(((e,t,s=this.props,i)=>{this.isComponentMounted()&&!this.props.isInvisible&&(this._checkMessageStreamStoreAndUpdate(s,i?{id:je.default.newGuid(),messageTimestamp:i}:void 0,"in debounced call of _applyModificationsDebounced"),this._applyModifications(e,t,s,i))}),100),this._equalsItemInfo=(e,t)=>e instanceof q.MessageViewItemInfo&&t instanceof q.MessageViewItemInfo?e.key===t.key&&e.skypeMessage===t.skypeMessage:M.default.comparator(e,t),this._onMountItem=(e,t)=>{t&&(this._mountedItemToFocus=e)},this._onVisibleRangeChanged=(e,t,s,i)=>{if(!this.isComponentMounted()||this.props.isInvisible)return;const o=this._dataItemsInfo.getItemList();this._lastViewIndex=o.length-1;const n=this._topWholeViewIndex!==s,r=o[i>=0?i:t];r instanceof q.MessageViewItemInfo&&this._reportRenderItemQoS(r.skypeMessage,!0),this._topPartialViewIndex=e,this._bottomPartialViewIndex=t,this._bottomWholeViewIndex=i,this._topWholeViewIndex=s,this._checkForConsumptionHorizonChange(),this._checkForReactionConsumptionHorizonChange();const l=this.state.scrollToItemViewIndex;if((this._scrollToMessage||this._scrollToUnreadMarker||this.props.isIncomingContactInvitePending)&&a.isNumber(l)){l<=t&&l>=e&&(this._scrollToMessage=!1,this._scrollToUnreadMarker=!1)}const d=0===s,c=i===this._lastViewIndex,h=!this._messageStreamStore.isLatestMessageTheEnd()||i<=this._lastViewIndex-5;if(this._lastMessageFullyVisible!==c&&this.state.canShowSuggestions&&(this._lastMessageFullyVisible=c,this._suggestionsListView&&this._suggestionsListView.animateSuggestions(c)),!this._isMessageStreamFocusStatusNotified){let e=!1;this._isFocusInsideMessageStreamOnMount&&(e=!0),this.props.onMessageStreamScreenReaderFocusUpdated&&this.props.onMessageStreamScreenReaderFocusUpdated(e),this._isMessageStreamFocusStatusNotified=!0}a.defer((()=>{if(this.isComponentMounted()&&!this.props.isInvisible){this._checkMessageStreamStoreAndUpdate(this.props,this.state.scrollRequest,"in defer call of _onVisibleRangeChanged");const s=this._convertViewIndexToMessage(this._topPartialViewIndex,!0);this._topVisibleItemInfo!==s&&(this._topVisibleItemInfo=s,this._topVisibleItemInfo&&this._topVisibleItemInfo.skypeMessage&&(this._statusPillInstance.setTopPartiallyVisibleMessage(this._topVisibleItemInfo.skypeMessage),this._statusPillInstance.setUnread(this._unreadMarkerShown&&this._topVisibleItemInfo.metadata.viewIndex>this._unreadMarkerViewIndex)));!d&&!(-1!==e&&e<21)||this._messageStreamStore.isEarliestMessageTheBeginning()||this._messageStreamStore.cannotGetEarlierMessages()||this._disallowFetchingMoreMessagesFromStore?this.props.onUserScrolledToTheTop&&!a.isUndefined(this._currentScrollTop)&&d&&n&&(this._messageStreamStore.isEarliestMessageTheBeginning()||this._messageStreamStore.cannotGetEarlierMessages())&&this.props.onUserScrolledToTheTop():this._messageStreamStore.fetchEarlierMessages();const i=this._lastViewIndex-21,r=-1!==t&&t>i;let l=h;V.log(B.LogTraceArea.MessageStream,'Should show "jump to end" button',l),!c&&!r||this._messageStreamStore.isLatestMessageTheEnd()||this._disallowFetchingMoreMessagesFromStore?c&&this._messageStreamStore.isLatestMessageTheEnd()&&(V.log(B.LogTraceArea.MessageStream,'Do not show "jump to end" button because we are at the end of the stream'),this._onScrolledToTheBottom(!0),l=!1):this._messageStreamStore.fetchLaterMessages(),!l&&this._shouldFocusLastMessage&&this._listView&&this.state.lastMessage&&(this._listView.focusMessage(this.state.lastMessage.cuid),this._shouldFocusLastMessage=!1),this._jumpToEndButton&&this._jumpToEndButton.setVisible(l),this._maybeTrackMessageSearchPerformance(o)}}))},this._updateConsumptionHorizonToLastVisibleItem=()=>{this._lastVisibleItemForConsumptionHorizon&&(V.log(B.LogTraceArea.ConsumptionHorizon,"Actually updating consumption horizon to: "+this._lastVisibleItemForConsumptionHorizon.getConsumptionHorizonString()),this._consumptionHorizonUpdateDebounceTimer&&(Ee.default.clearTimeout(this._consumptionHorizonUpdateDebounceTimer),this._consumptionHorizonUpdateDebounceTimer=void 0),f.default.setConsumptionHorizonToMessage(this.props.conversationId,this._lastVisibleItemForConsumptionHorizon),this._lastVisibleItemForConsumptionHorizon=void 0)},this._checkForReactionConsumptionHorizonChange=()=>{this._reactionConsumptionHorizonUpdateDebounceTimer&&Ee.default.clearTimeout(this._reactionConsumptionHorizonUpdateDebounceTimer),this._reactionConsumptionHorizonUpdateDebounceTimer=Ee.default.setTimeout(this._updateReactionConsumptionHorizon,1500)},this._updateReactionConsumptionHorizon=()=>{let e=0;const t=this._dataItemsInfo.getItemList();for(let s=this._topWholeViewIndex;s<=this._bottomWholeViewIndex;s++){const i=t[s];let o;i instanceof q.MessageViewItemInfo&&(o=i.skypeMessage),o&&(0,he.isLastMessageUpdateReaction)(o)&&(v.markReactionsAsRead(o),e++)}V.log(B.LogTraceArea.ConsumptionHorizon,"MessageStream - Updating of reaction consumption horizon for messages in viewport. Updated "+e),this._reactionConsumptionHorizonUpdateDebounceTimer&&(Ee.default.clearTimeout(this._reactionConsumptionHorizonUpdateDebounceTimer),this._reactionConsumptionHorizonUpdateDebounceTimer=void 0)},this._handleSearchPillAutoHide=()=>{this._statusPillInstance.enableSearchPill(!1),this._scrollingStartTimeReenable=Date.now()+1e3*this._showSearchOptionsReenableDelay},this._onCopyContextMenu=()=>!!this._copyListenerRef&&this._copyListenerRef.triggerCopy(),this._onQuoteSelectionContextMenu=()=>{this.props.onQuoteSelectionContextMenu((0,S.chain)(a.map(this._streamItemRefs,(({ref:e,message:t})=>{const s=e.quoteSelection();return s?t.mergePartialUpdate({content:s}):void 0})),a.flatten,a.compact))},this._onCopy=e=>{const t=(0,S.chain)(a.map(this._streamItemRefs,(({ref:t})=>t.copySelection(e))),a.flatten,a.compact,a.size);t>0&&(ee.default.scheduleTextMessage(z.getString("MessageStream.MessageCopied"),void 0,this._getRootViewId()),V.track(new Y.KeyboardMessagesTelemetry(this.props.conversationId,{messagesCount:t,actionType:Z.KeyboardActionType.KeyboardCopy})))},this._onSuggestionsListViewRef=e=>{this._suggestionsListView=e||void 0,this._suggestionsListView&&this.state.canShowSuggestions&&this._suggestionsListView.animateSuggestions(this._lastMessageFullyVisible)},this._onInitialRenderComplete=()=>{this.props.onInitialRenderComplete&&this.props.onInitialRenderComplete(),this._markHub2StreamScenarioStepCompleted("InitialRenderComplete"),this.isComponentMounted()&&this.setState({initialRenderCompleted:!0}),this._openAnimationCompleted&&le.default.finishScenario(this.props.conversationId),Te.default.messageStreamRendered()},this._openAnimationComplete=()=>{this._openAnimationCompleted=!0,this.state.initialRenderCompleted&&(this._markHub2StreamScenarioStepCompleted("WaitingForAnimationEnd"),le.default.finishScenario(this.props.conversationId))},this._updateStatusPill=a.throttle((()=>{this._statusPill&&this._statusPill.setEnabledForInfo(!0).touch()}),1e3),this._showSearchOptions=a.throttle((()=>{this._statusPill&&(this._statusPillInstance.enableSearchPill(!0),this._statusPill.touch())}),1e3),this._onScroll=(e,t)=>{if(this._lockUpdatesToConsumptionHorizon=!1,this._onScrollTimer&&(Ee.default.clearTimeout(this._onScrollTimer),this._onScrollTimer=void 0),this._onScrollTimer=Ee.default.setTimeout(this._onScrollStoppedDebounced,1500),this._isUserScrolling=!0,this.state.enableRevealInHistory){-1===this._scrollingStartTime&&(this._scrollingStartTime=Date.now()),-1===this._scrollingStartTimeReenable&&(this._scrollingStartTimeReenable=Date.now());const e=Math.floor(Date.now()-this._scrollingStartTimeReenable)/1e3;Math.floor(Date.now()-this._scrollingStartTime)/1e3>this._showSearchOptionsDelay&&e>this._showSearchOptionsReenableDelay&&this._showSearchOptions()}this._updateStatusPill();const s=this._bottomWholeViewIndex===this._lastViewIndex&&this._messageStreamStore.isLatestMessageTheEnd();this._onScrolledToTheBottom(s),this._currentScrollTop=e},this._onScrollStoppedDebounced=()=>{this._isUserScrolling=!1,this._onScrollTimer=void 0,this._scrollingStartTime=-1},this._onOverrideConsumptionHorizon=e=>{this._consumptionHorizonTimestampOverride=e},this._shouldUpdateItem=(e,t)=>e instanceof q.MessageViewItemInfo&&t instanceof q.MessageViewItemInfo?e.key!==t.key||e.skypeMessage!==t.skypeMessage||t.metadata.shouldUpdate:!(0,U.default)(e,t),this._renderItem=(e,t)=>{if(e instanceof rt)return(0,n.jsx)(Ve.UserIcon,{style:gt.contactInviteUserIcon,userMri:e.conversationId,size:Ne.UserIconSize.Size120,conversationId:this.props.conversationId},e.key);if(e instanceof at)return(0,n.jsx)(w.default,{conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isIncomingContactInvitePending:this.props.isIncomingContactInvitePending,isContactInviteJustAccepted:this.props.isContactInviteJustAccepted,onIncomingContactInviteAccepted:this.props.onContactInviteAccepted,inviteToken:this.props.inviteToken,isEncryptedConversationEstablished:this.props.isEncryptedConversationEstablished,isAnyMessageInTheStream:e.isAnyMessageInTheStream,showWave:e.showWave,onGreet:this.props.onGreet},e.key);if(e instanceof st){const t=[];return this.state.isUsingStackNavigationContext?t.push(gt.composingIndicatorContainerMobile):t.push(gt.composingIndicatorContainerDesktop),(0,n.jsx)(d.View,Object.assign({style:t},{children:(0,n.jsx)(ke.default,{typingMris:e.composingMris,conversationId:e.conversationId,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext})}),"-composingIndicator")}if(e instanceof it){const t=b.isPhoneMri(this.props.conversationId)?z.getString("MessageStream.UnreadSmsMarkerDivider"):z.getString("MessageStream.UnreadMarkerDivider");return(0,n.jsx)(we.default,{text:t,dividerTypeIsLastRead:!0,messageStreamFontSize:this.state.messageStreamFontSize,focusStreamItemTextForMobileScreenReader:e.focusItemOnMountOnMobile,onMountItem:this._onMountItem})}if(e instanceof ot){const t=Ze.default.getShortDisplayName(e.userMri)||"",s=z.getString("MessageStream.OldFriendBackHintDivider",{firstName:t});return(0,n.jsx)(we.default,{text:s,dividerTypeIsLastRead:!0,messageStreamFontSize:this.state.messageStreamFontSize,focusStreamItemTextForMobileScreenReader:e.focusItemOnMountOnMobile,onMountItem:this._onMountItem})}if(e instanceof tt){const t=()=>O.default.getDisplayDateString(e.dateOfMarker);return(0,n.jsx)(we.default,{textGetter:t,dividerTypeIsLastRead:!1,messageStreamFontSize:this.state.messageStreamFontSize})}if(e instanceof et)return(0,n.jsx)(xe.StreamItemReadReceipts,{conversationId:this.props.conversationId,readReceiptsHeads:e.readReceiptsHeads,readReceiptsSum:e.readReceiptsSum,availableHeight:e.height},e.key);if(e instanceof q.MessageViewItemInfo)return X.default.notifyMessageRendered(e.skypeMessage.getOriginalClientMessageId(),de.default.isUsingStackNavigationContext()),V.debug((()=>["DIM_CALC - message stream containerInitialDimensions",this.props.containerInitialDimensions])),this._reportRenderItemQoS(e.skypeMessage,!1),(0,o.createElement)(Pe.StreamItem,Object.assign({ref:this._onStreamItemRef(e.skypeMessage)},e.metadata.itemRenderInfo,{hint:this._getItemHint(e.skypeMessage.cuid),key:"stream-item-"+e.skypeMessage.cuid,message:e.skypeMessage,renderOrigin:this.props.renderOrigin||F.MessageRenderOrigin.ChatCanvas,isConversationAccepted:this.props.isConversationAccepted,isLastMessage:this.state.lastMessage===e.skypeMessage,containerInitialDimensions:this.props.containerInitialDimensions,disableForward:this.props.disableForward,disableSelectMultipleMessages:this.props.disableSelectMultipleMessages,disableReportMessage:this.props.disableReportMessage,disablePlugins:this.props.disablePlugins,onDisableScroll:this._onDisableScroll,onMarkAsUnread:this._onOverrideConsumptionHorizon,onItemPress:this.props.onItemPress,onMountContent:this.props.onMountContent,onMountItem:this._onMountItem,onQuote:this.props.onQuoteMessage,onEdit:this.props.onMessageEdit,onCopyContextMenu:this.state.enableMultiMessageQuoteOnKeyboard?this._onCopyContextMenu:void 0,onQuoteSelectionContextMenu:this.state.enableMultiMessageQuoteOnKeyboard?this._onQuoteSelectionContextMenu:void 0,focusStreamItemForMobileScreenReader:e.shouldItemFocusOnMobile,isSelectMessagesModeActive:this.props.isSelectMessagesModeActive,getRootWindowComponent:this._getListView,messageStreamFontSize:this.state.messageStreamFontSize,linkedMessages:this._getLinkedMessages(e.skypeMessage),isTranslatedConversation:this.props.isTranslatedConversation,searchStore:this.props.searchStore,isNewsChannel:this.state.isNewsChannel,isNewsBot:this.state.isNewsBot}));if(e instanceof lt){const t=(0,n.jsx)(N.default,{conversationId:e.conversationId,style:gt.groupEngageButtonStyle,origin:D.InviteMorePeopleButtonOrigin.MessageStream,messageStreamFontSize:this.state.messageStreamFontSize}),s=this.state.enableGroupShareButton?(0,n.jsx)(E.default,{conversationId:e.conversationId,useSXButton:!0,style:gt.groupEngageButtonStyle,origin:D.ShareGroupButtonOrigin.MessageStream}):void 0;return(0,n.jsxs)(d.View,Object.assign({style:gt.groupEngagementButtons},{children:[t,s]}))}return e instanceof nt?(0,n.jsx)(d.View,Object.assign({style:gt.newConnectionContainer},{children:(0,n.jsx)(Be.Caption,{children:this._getNewConnectionString()})})):e instanceof dt?(0,n.jsx)(ce.default,{conversationId:e.conversationId,memberCount:this._conversation.getMemberCount()}):e instanceof ct?(0,n.jsx)(G.default,{threadId:e.conversationId,origin:te.MeetNowOrigin.MessageStream}):e instanceof ht?(0,n.jsx)(_e.default,{}):void 0},this._onStreamItemRef=e=>t=>{const s=e.cuid;t?this._streamItemRefs[e.cuid]={ref:t,message:e}:delete this._streamItemRefs[s]},this._onCopyListenerRef=e=>this._copyListenerRef=e||void 0,this._getListView=()=>this._listView,this._getLinkedMessages=e=>e.isAlbum()?W.default.getNotFailedMediaMessagesForAlbum(e.getAlbumId()):[],this._getReadReceiptsSummary=e=>{const t=[];return a.eachRight(this._readReceiptsMarks,((s,i)=>(t.push(...s.readReceipts),i!==e.toString()))),t},this._onJumpToEndButtonRef=e=>{this._jumpToEndButton=e||void 0},this._onJumpToEndButtonPress=e=>{let t;this._shouldFocusLastMessage=!0,this._messageStreamStore.isLatestMessageTheEnd()?(t=this._lastViewIndex-this._bottomWholeViewIndex,this._scrollToBottom()):(this._scrollToBottomOfRefreshedStream(),V.log(B.LogTraceArea.MessageStreamDebug,"Refresh store reason: User jumped to end from a position where last messages were not loaded in view")),this.props.onJumpToEndPress&&this.props.onJumpToEndPress(),V.track(new Y.JumpToEnd(this.props.conversationId,t,e))},this._onDisableScroll=e=>{this.setState({isScrollDisabled:e})},this._statusPillRef=e=>{this._statusPill=e||void 0},this._onListViewRef=e=>{this._listView=e||void 0}}componentDidMount(){super.componentDidMount(),this._postCreatedSubscriptionToken=pe.default.postCreated.subscribe((e=>{this.isComponentMounted()&&this._contentRendered&&!e.editedMessageCuid&&a.includes(e.conversationIds,this.props.conversationId)&&this._messageStreamStore&&(this._checkMessageStreamStoreAndUpdate(this.props,this.state.scrollRequest,"in async call of PostingService.postCreated"),this._messageStreamStore.isLatestMessageTheEnd()?this._scrollToBottom():this._scrollToBottomOfRefreshedStream())})),this.fetchFreHeaderBuildVersion()}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),e.isSelectMessagesModeActive!==this.props.isSelectMessagesModeActive&&(this._firstUpdateCompleteForMutliSelect=!0,this._viewItemsListDirty=!0,this._regenerateItemListIfDirty(this.props,this.state)),e.isTranslatedConversation!==this.props.isTranslatedConversation&&(this._viewItemsListDirty=!0,this._shouldUpdateForTranslationChange=!0,this._regenerateItemListIfDirty(this.props,this.state)),this._maybeAnimateScrollToPosition(t.scrollRequest,this.state.scrollRequest),t.messageHintsData!==this.state.messageHintsData&&(this._viewItemsListDirty=!0,this._shouldUpdateForHintChange=!0,this._regenerateItemListIfDirty(this.props,this.state)),this.state.messageHintsData&&this._conversation){const t=K.default.getMessageToShowHint(this._dataItemsInfo,this.state.messageHintsData);t?(this._messageCuidToShowHint=t.skypeMessage.cuid,K.default.updateHintData(this.props.conversationId,this.state.messageHintsData,t)):e.conversationId!==this.props.conversationId&&(this._messageCuidToShowHint=void 0,this.setState({messageHintsData:K.default.getNextPriorityHint()}))}}componentWillUnmount(){super.componentWillUnmount(),Ge.default.removeConversation(this.props.conversationId),this._instrumentationSubscription&&(this._instrumentationSubscription.unsubscribe(),this._instrumentationSubscription=void 0),this._consumptionHorizonUpdateDebounceTimer&&(Ee.default.clearTimeout(this._consumptionHorizonUpdateDebounceTimer),this._consumptionHorizonUpdateDebounceTimer=void 0),this._lastVisibleItemForConsumptionHorizon&&this._updateConsumptionHorizonToLastVisibleItem(),this._onScrollTimer&&(Ee.default.clearTimeout(this._onScrollTimer),this._onScrollTimer=void 0),this._postCreatedSubscriptionToken&&this._postCreatedSubscriptionToken.unsubscribe(),this._statusPillInstance&&this._statusPillInstance.destroy(),this._sendMessageReadEventThrottled.flush(),this.state.showSpeechConsentSuggestion&&this.props.renderOrigin!==F.MessageRenderOrigin.CallCanvas&&Ce.default.hideSpeechConsentSuggestion(),this._markInterruptionInQoSTracking()}_markInterruptionInQoSTracking(){this._skypeMessages.forEach((e=>{const t=ge.default.getTelemetryScenarioForMessage(e.conversationId,e.cuid);if(!t)return;const s=t.getSecondaryScenario(ye.ScenarioName.SendTextMessageUI);!s||s.isResolved()||s.isInterrupted()||s.markInterrupted(Date.now()-e.createdTime)}))}_buildState(e,t){var s,i,o,n,r;const l=h.default.getS4LMessagingFeatures(),d=h.default.getS4LContactsFeatures(),c=ne.default.getUserPreferencesLocal(),u=this.props;this._conversation=(0,k.default)().getConversation(e.conversationId);const p=P.default.getMessageCountsForConversation(e.conversationId),g=null===(s=this._conversation)||void 0===s?void 0:s.memberConsumptionHorizonsSorted,m=this._getRootViewId(),S=Re.default.canShowSuggestions(),f=de.default.isUsingStackNavigationContext(),y=!!(0,Qe.isContentChannel)(this._conversation),v=h.default.getEngagementFeatures().oldFriendBack.enable,C=v&&Ye.default.shouldShowOldFriendBackQuickReply(e.conversationId);let _={useCompactLayout:Se.default.isSmallDevice(m)||!!this._getContext().isPresentedInDesktopSubview,isUsingStackNavigationContext:f,readReceiptsEnabled:l.enableReadReceipts&&!b.isAgent(e.conversationId)&&re.default.getReadReceiptsEnabled()&&e.isConversationAccepted&&!y,memberConsumptionHorizonsSorted:g,isOneOnOne:null===(i=this._conversation)||void 0===i?void 0:i.isOneOnOne(),enableGreetingCard:l.enableGreetingCard,enableGroupShareButton:d.enableGroupShareButtonInChat,enableMultiMessageQuoteOnKeyboard:c.pasteAsQuotesEnabled,newConnectionMessageId:null===(o=this._conversation)||void 0===o?void 0:o.getConversationProperty(b.ConversationProps.NewConnectionMessageId),isNewConnectionMessageEnabled:d.enableNewConnectionMessage,canShowSuggestions:S,messageStreamFontSize:ne.default.getMessageStreamFontSize(),scrollRequest:e.searchStore?e.searchStore.getTimestamp():void 0,enableRevealInHistory:l.enableRevealHistoryInConversation,enableNewConversationCreation:l.enableNewConversationCreation,isJoinEnabled:null===(n=this._conversation)||void 0===n?void 0:n.isJoinEnabled(),isRegularMemberInModeratedGroup:this._conversation&&(0,se.isRegularMemberInModeratedGroup)(this._conversation),showSpeechConsentSuggestion:Ce.default.showSpeechConsentSuggestingInConversation(),isClearLeaveV2EnabledAndKeepInRecents:this._conversation&&(0,k.default)().isClearApplicableAndKeepInRecents(this._conversation.id),isConvCleared:this._conversation&&this._conversation.isDeleted(),isChild:ie.default.isChild(),messageSearchLimit:l.inConversationMessageSearch.initialPageSize,isNewsChannel:y,isNewsBot:(0,Qe.isTodayBot)(this._conversation.id),enableOldFriendBack:v,isShowOldFriendBackHintDivider:C};t&&(this._messageCuidToShowHint=void 0),t||this.state.messageStreamFontSize===_.messageStreamFontSize||this._virtualMessageViewRefCount++,e.isSelectMessagesModeActive!==u.isSelectMessagesModeActive&&(this._firstUpdateCompleteForMutliSelect=!1),this._isUserPresentInApp=x.default.isCurrentUserActive(),this._oldConsumptionHorizonTimestamp=this._currentConsumptionHorizonTimestamp,this._currentConsumptionHorizonTimestamp=a.isNumber(p.consumptionHorizonTimestamp)?p.consumptionHorizonTimestamp:pt;const T=!(!b.isReadOnlyConversation(e.conversationId)&&!(null===(r=this._conversation)||void 0===r?void 0:r.isEncryptedThread()))&&!e.isEncryptedConversationEstablished;T!==this._readOnlyConversation&&(V.log(B.LogTraceArea.MessageStreamDebug,"Conversation readonly state changed - need to regenerate list of items"),this._viewItemsListDirty=!0),this._readOnlyConversation=T;const M=I.default.getComposingUsers(e.conversationId);(0,U.default)(M,this._composingMris)||(V.log(B.LogTraceArea.MessageStreamDebug,"Composing MRIs changed - need to regenerate list of items"),this._viewItemsListDirty=!0),this._composingMris=M,this.state&&!(0,U.default)(g,this.state.memberConsumptionHorizonsSorted)&&(V.log(B.LogTraceArea.MessageStreamDebug,"Member consumption horizons changed - need to regenerate list of items"),this._viewItemsListDirty=!0),t||(0,U.default)(u.isContactInviteJustAccepted,e.isContactInviteJustAccepted)||(V.log(B.LogTraceArea.MessageStreamDebug,"isContactInviteJustAccepted changed - need to regenerate list of items"),this._viewItemsListDirty=!0),t||(0,U.default)(u.isEncryptedConversationEstablished,e.isEncryptedConversationEstablished)||(V.log(B.LogTraceArea.MessageStreamDebug,"isEncryptedConversationEstablished changed - need to regenerate list of items"),this._viewItemsListDirty=!0),(0,U.default)(u.isSelectMessagesModeActive,e.isSelectMessagesModeActive)||(V.log(B.LogTraceArea.MessageStreamDebug,"showCheckboxUiChange - need to regenerate list of items"),this._viewItemsListDirty=!0),t||!this.state||(0,U.default)(_.showSpeechConsentSuggestion,this.state.showSpeechConsentSuggestion)||(this._viewItemsListDirty=!0),this._messageReadDelay=l.messageReadDelay,V.log(B.LogTraceArea.MessageStreamDebug,"UnreadMessageDetails: CurrentConsumptionHorizonTimestamp:"+p.consumptionHorizonTimestamp+" UnreadCount:"+p.unreadCount),t&&(_.isScrollDisabled=!1);let w=!1;const A=this.state&&!a.isUndefined(_.scrollRequest)&&!(0,U.default)(this.state.scrollRequest,_.scrollRequest);let R=!1,O=-1;t||!A||a.isUndefined(_.scrollRequest)||(O=a.findIndex(this._dataItemsInfo.getItemList(),(e=>e instanceof q.MessageViewItemInfo&&void 0!==_.scrollRequest&&e.skypeMessage.createdTime===_.scrollRequest.messageTimestamp)),R=O>-1);const L=this.state&&this.state.isClearLeaveV2EnabledAndKeepInRecents&&!this.state.isConvCleared&&_.isConvCleared,F=this._messageStreamStore&&this._messageStreamStore.isDestroyed();return(t||e.conversationId!==u.conversationId||A&&!R||u.focusedMessageCuid!==e.focusedMessageCuid||this.state&&_.readReceiptsEnabled!==this.state.readReceiptsEnabled||this.state&&_.canShowSuggestions!==this.state.canShowSuggestions||L||F)&&(w=!0,V.log(B.LogTraceArea.MessageStreamDebug,"Refresh store reason:  initialBuild:"+t+" ConversationId differs:"+(e.conversationId!==u.conversationId)+" ScrollToTimestamp differs:"+A+" NewTargetMessageIndex:"+O+" FocusMessageId differs:"+(e.focusedMessageCuid!==u.focusedMessageCuid)+" ReadReceipts settings differs:"+(this.state&&_.readReceiptsEnabled!==this.state.readReceiptsEnabled)+" ConversationCleared V2:"+L+" StoreWasDestroyed:"+F)),_=this._refreshConversationProperties(e,_,w,!1,p.unreadCount),!t&&this.state&&_.readReceiptsEnabled!==this.state.readReceiptsEnabled&&(this._lockUpdatesToConsumptionHorizon=!0),t||this._checkForConsumptionHorizonChange(),e.conversationId===b.SkonsoleMri?this._instrumentationSubscription||(this._instrumentationSubscription=V.output.subscribe(this._instrumentationCallback),a.defer((()=>{const e=V.getLogHistory();a.each(e,(e=>this._instrumentationCallback(e.level,e.traceArea,e.args)))}))):this._instrumentationSubscription&&(this._instrumentationSubscription.unsubscribe(),this._instrumentationSubscription=void 0),_.messageHintsData=K.default.getHint(this._conversation,t),t||(0,U.default)(_.messageHintsData,this.state.messageHintsData)||(this._viewItemsListDirty=!0),_}_refreshConversationProperties(e,t,s,i,o){let n=t||{};const r=o||P.default.getMessageCountsForConversation(e.conversationId).unreadCount;if(this._oldUnreadCount!==r&&this._skypeMessages.length>0){if(this._oldUnreadCount>r){const t=new Y.MessageReceivedRead(this._skypeMessages[this._skypeMessages.length-1],e.conversationId,this._oldUnreadCount-r);V.track(t)}this._oldUnreadCount=r}return s?(V.log(B.LogTraceArea.MessageStreamDebug,"Resetting properties for the conversationId:"+fe.mriOrId(e.conversationId)),this._hideUnreadMarker(),r>0&&!i&&this._showUnreadMarker(this._currentConsumptionHorizonTimestamp),n.isReactionDetailsOn=!1,this._scrollToMessage=!!n.scrollRequest&&!i,this._scrollToUnreadMarker=r>0&&!this._scrollToMessage&&!!this._currentConsumptionHorizonTimestamp&&!e.isIncomingContactInvitePending&&!i,this._highlightScrollToTarget=this._scrollToMessage,this._topPartialViewIndex=-1,this._bottomWholeViewIndex=-1,this._topWholeViewIndex=-1,this._bottomPartialViewIndex=-1,this._consumptionHorizonTimestampOverride=void 0,this._lockUpdatesToConsumptionHorizon=!1,this._lastReceivedMessageTimestamp=0,this._lastMessageTimestamp=0,this._lastViewIndex=0,this._skypeMessages=[],this._readReceiptsMarks={},this._virtualMessageViewRefCount++,this._contentRendered=!1,this._disallowFetchingMoreMessagesFromStore=!1,this._dataItemsInfo=new ue.default,this._updateMessageStreamStore(e,n.scrollRequest&&n.scrollRequest.messageTimestamp,i),t.isUsingStackNavigationContext?le.default.setStackNavigationCompleteCallback(this._openAnimationComplete):this._openAnimationCompleted=!0,this._markHub2StreamScenarioStepCompleted("InitialBuild"),this._updateStreamItemsAndReturnNewState(e,n)):(this._updateStreamIndexes(n,!0),n=this._regenerateItemListIfDirty(e,n),n)}_updateMessageStreamStore(e,t,s=!1){let i;this._messageStreamStore&&this._removeSubscription(this._messageStreamStoreSubscription),s?i=void 0:this._scrollToMessage?i=t:this._scrollToUnreadMarker&&(i=this._currentConsumptionHorizonTimestamp),this._messageStreamStore=J.default.cachedStoreFor(e.conversationId,i),this._messageStreamStoreSubscription={store:this._messageStreamStore,callbackBuildState:this._onMessageStreamStoreTrigger},this._addSubscription(this._messageStreamStoreSubscription)}_hideUnreadMarker(){this._unreadMarkerShown=!1,this._unreadMarkerTimestamp=-1,this._unreadMarkerMessageIndex=-1,this._unreadMarkerViewIndex=-1,this._viewItemsListDirty=!0}_showUnreadMarker(e){this._unreadMarkerShown=!0,this._unreadMarkerTimestamp=e,this._unreadMarkerMessageIndex=-1,this._unreadMarkerViewIndex=-1,this._viewItemsListDirty=!0}_updateStreamIndexes(e,t=!1){if(!(e.isInitialMessagesLoaded||this.state&&this.state.isInitialMessagesLoaded))return;const s=this._lastReceivedMessageTimestamp,i=this._lastMessageTimestamp,o=this._lastSentMessageTimestamp,n=this._skypeMessages.length-1;let r=!1,l=!1;this._lastSentMessageTimestamp=0,a.eachRight(this._skypeMessages,((e,t)=>(t===n&&(this._lastMessageTimestamp=e.createdTime),ae.default.isMyMri(e.creator)||C.isThreadActivityType(e.messagetype)||l||(this._lastReceivedMessageTimestamp=e.createdTime,l=!0),!ae.default.isMyMri(e.creator)||C.isThreadActivityType(e.messagetype)||r||(this._lastSentMessageTimestamp=e.createdTime,r=!0),!(l&&r))));const d=this._unreadMarkerViewIndex>0&&this._topPartialViewIndex>this._unreadMarkerViewIndex,c=this._unreadMarkerViewIndex>0&&this._bottomPartialViewIndex<this._unreadMarkerViewIndex,h=d||c,u=a.isUndefined(e.isLatestMessageTheEnd)?this.state.isLatestMessageTheEnd:e.isLatestMessageTheEnd,p=a.isUndefined(e.isEarliestMessageTheBeginning)?this.state.isEarliestMessageTheBeginning:e.isEarliestMessageTheBeginning,g=this._currentConsumptionHorizonTimestamp>=this._lastReceivedMessageTimestamp&&u,m=this._currentConsumptionHorizonTimestamp>=s&&u,S=i>0&&this._lastMessageTimestamp>i&&u,f=s>0&&this._lastReceivedMessageTimestamp>s&&u;0===this._lastSentMessageTimestampInitial&&this._lastSentMessageTimestamp&&u&&(this._lastSentMessageTimestampInitial=this._lastSentMessageTimestamp);const y=0===this._lastViewIndex||this._lastViewIndex===this._bottomPartialViewIndex,v=f&&!y,_=this._oldConsumptionHorizonTimestamp!==pt&&this._currentConsumptionHorizonTimestamp<this._oldConsumptionHorizonTimestamp,b=this._consumptionHorizonTimestampOverride===this._currentConsumptionHorizonTimestamp;if(V.log(B.LogTraceArea.MessageStreamDebug,"_checkStreamIndexes:isUnreadMarkerOutsideViewport:"+h+";allMessagesRead:"+g+";allOldMessagesRead:"+m+";newMessagesInStream:"+S+";newReceivedMessagesInStream:"+f+";isUserActive:"+this._isUserActive()+";oldLastItemVisible:"+y+";consumptionHorizonMovedBackInTime:"+_+";consumptionHorizonSetManually:"+b),this._isUserActive()){if(this._unreadMarkerShown){g&&this._hideUnreadMarker();this._unreadMarkerTimestamp>0&&this._lastReceivedMessageTimestamp>0&&this._lastReceivedMessageTimestamp<=this._unreadMarkerTimestamp&&u&&this._hideUnreadMarker();const e=o>0&&this._lastSentMessageTimestamp>this._lastSentMessageTimestampInitial&&this._lastSentMessageTimestamp>o&&this._lastSentMessageTimestamp>this._lastReceivedMessageTimestamp&&u;V.log(B.LogTraceArea.MessageStreamDebug,"hideUnreadMarkernewSentMessagesInStream:"+e),e&&this._hideUnreadMarker(),h&&m&&(v?this._showUnreadMarker(this._currentConsumptionHorizonTimestamp):S&&this._hideUnreadMarker())}else v&&this._showUnreadMarker(this._currentConsumptionHorizonTimestamp);(_||b)&&(this._consumptionHorizonTimestampOverride=void 0,this._lockUpdatesToConsumptionHorizon=!0,this._showUnreadMarker(this._currentConsumptionHorizonTimestamp))}else f&&!this._unreadMarkerShown&&this._showUnreadMarker(this._currentConsumptionHorizonTimestamp);let T=!this._unreadMarkerShown,M=!1;this._unreadMarkerMessageIndex=-1,this._currentConsumptionHorizonItemIndex=-1,a.each(this._skypeMessages,((e,t)=>{0===t&&e.createdTime>this._unreadMarkerTimestamp&&!p&&(T=!0),this._unreadMarkerShown&&!T&&e.createdTime>this._unreadMarkerTimestamp&&e.countsForUnreadCounts()&&(this._unreadMarkerMessageIndex=t,this._viewItemsListDirty=!0,T=!0),!M&&e.isAnyVersionKnownByServer()&&(e.createdTime<=this._currentConsumptionHorizonTimestamp?this._currentConsumptionHorizonItemIndex=t:M=!0)})),this._updateReadReceipts(e,t)}_updateReadReceipts(e,t){if(a.isUndefined(e.readReceiptsEnabled)?!!this.state&&this.state.readReceiptsEnabled:e.readReceiptsEnabled){const s=e.isOneOnOne||!!this.state&&this.state.isOneOnOne,i=(e.memberConsumptionHorizonsSorted?e.memberConsumptionHorizonsSorted:this.state?this.state.memberConsumptionHorizonsSorted:void 0)||[],o=me.computeMarks(this._skypeMessages,i),n=a.map(this._readReceiptsMarks,(e=>a.pick(e,["mris"]))),r=a.map(o,(e=>a.pick(e,["mris"]))),l=a.keys(o);if(!(0,U.default)(a.keys(this._readReceiptsMarks),l)||!(0,U.default)(n,r)){a.each(this._readReceiptsMarks,((e,t)=>{if(o[t]&&!o[t].key)o[t].key=e.key;else{const t=a.find(o,(t=>(0,U.default)(t.readReceipts,e.readReceipts)));t&&(t.key=e.key)}})),a.each(o,(e=>{e.key||(e.key=Ae.ItemListKey.ReadReceiptPrefix+this._readReceiptsKeysCounter++)}));const e=l.length&&t&&s?this._skypeMessages[Number(l[0])]:void 0;if(e){const t=new Y.MessageRead(e,this.props.conversationId);this._sendMessageReadEventThrottled(t)}this._readReceiptsMarks=o,V.log(B.LogTraceArea.ReadReceipts,"member CH: "+JSON.stringify(a.map(this._readReceiptsMarks,(e=>({mris:e.readReceipts.map((e=>fe.mriOrId(e.mri))),key:e.key})))))}}}_updateStreamItemsAndReturnNewState(e,t,s){const i=t||{};let o=g.default.updateCallEventMessages(this._messageStreamStore.getMessages());if(o=a.filter(o,(e=>{if(e.hasAlbumId()){const t=W.default.getNotFailedMediaMessagesForAlbum(e.getAlbumId());return e.isAlbum()?t.length>1:!!e.isSendRejected()||t.length<2}return!0})),void 0===i.enableGreetingCard&&(i.enableGreetingCard=this.state?this.state.enableGreetingCard:void 0),i.isLatestMessageTheEnd=this._messageStreamStore.isLatestMessageTheEnd(),i.lastMessage=a.last(o),a.isUndefined(this._wasLatestMessageTheEndPreviously)&&(this._wasLatestMessageTheEndPreviously=i.isLatestMessageTheEnd),i.isEarliestMessageTheBeginning=this._messageStreamStore.isEarliestMessageTheBeginning(),i.cannotGetEarlierMessages=this._messageStreamStore.cannotGetEarlierMessages(),i.lastMessage&&X.default.notifyMessagePickedFromMessageViewStoreIntoView(i.lastMessage.getOriginalClientMessageId()),this._scrollToUnreadMarker&&!i.isLatestMessageTheEnd){const e=a.findLast(o,(e=>e.countsForUnreadCounts())),t=e&&e.createdTime>this._currentConsumptionHorizonTimestamp;t||this._messageStreamStore.fetchLaterMessages(),i.isInitialMessagesLoaded=this._messageStreamStore.isInitialMessagesLoaded()&&t}else i.isInitialMessagesLoaded=this._messageStreamStore.isInitialMessagesLoaded();return this._skypeMessages=o,h.default.getS4LMessagingFeaturesNoSubscription().enableAutoPlayVoiceMessagesInRow&&Ge.default.addConversation(e.conversationId,this._skypeMessages),V.log(B.LogTraceArea.MessageStream,"Updated items from the store: isInitialMessagesLoaded: "+i.isInitialMessagesLoaded+", isLatestMessageTheEnd: "+i.isLatestMessageTheEnd+", skypeMessages.length: "+this._skypeMessages.length),e.onSkypeMessagesUpdated&&e.onSkypeMessagesUpdated(o),this._viewItemsListDirty=!0,this._updateStreamIndexes(i),this._regenerateItemListIfDirty(e,i,s)}_isInitialMessagesLoaded(e){return a.isUndefined(e.isInitialMessagesLoaded)?this.state&&this.state.isInitialMessagesLoaded:e.isInitialMessagesLoaded}_regenerateItemListIfDirty(e,t,s){var i,o,n;if(!this._viewItemsListDirty)return t;const r=this._skypeMessages.length,l=b.isGroupConversation(e.conversationId),d=[];t.scrollToItemViewIndex=-1;let c=!1,h=!1;this._unreadMarkerViewIndex=-1;const u=this._unreadMarkerShown&&this._unreadMarkerMessageIndex>=0,p=a.isUndefined(t.isLatestMessageTheEnd)?!(!this.state||!this.state.isLatestMessageTheEnd):t.isLatestMessageTheEnd,g=a.isUndefined(t.isEarliestMessageTheBeginning)?this.state&&this.state.isEarliestMessageTheBeginning:t.isEarliestMessageTheBeginning,S=a.isUndefined(t.cannotGetEarlierMessages)?this.state&&this.state.cannotGetEarlierMessages:t.cannotGetEarlierMessages;this._isInitialMessagesLoaded(t)&&(e.isConversationAccepted&&!e.isContactInviteJustAccepted||!this._readOnlyConversation||e.showInviteHeaderForEncryptedThread||d.push(new rt(e.conversationId)));let f=!1,y=!1;const v=this._shouldDisplayContactInviteViewItemInfo(e,t);let _=v?0:-1,T=-1,M=!1;const I=a.isUndefined(t.isNewConnectionMessageEnabled)?this.state&&this.state.isNewConnectionMessageEnabled:t.isNewConnectionMessageEnabled,w=a.isUndefined(t.newConnectionMessageId)?this.state&&this.state.newConnectionMessageId:t.newConnectionMessageId;I&&w===b.newConnectionAcceptedPropValue&&d.push(new nt(Ae.ItemListKey.NewConnection,32));const P=a.isUndefined(t.scrollRequest)?this.state&&this.state.scrollRequest:t.scrollRequest;for(let s=0;s<r;s++){const o=this._skypeMessages[s],n=s>0?this._skypeMessages[s-1]:void 0;if(C.shouldServerMessageBeFilteredOut(o,this._conversation))continue;if((null===(i=this.state)||void 0===i?void 0:i.isNewsChannel)&&!(0,Qe.isTodayBot)(o.creator))continue;if(u&&!c&&this._unreadMarkerMessageIndex<=s&&!ae.default.isMyMri(o.creator)&&(this._unreadMarkerViewIndex=d.length,this._scrollToUnreadMarker&&t.scrollToItemViewIndex<0&&(V.log(B.LogTraceArea.MessageStreamDebug,"Scroll to unread indicator:"+s),t.scrollToItemViewIndex=d.length),d.push(new it(Ae.ItemListKey.UnreadMarker,36,y)),c=!0),!b.isBookmarkConversation(e.conversationId)){if(0===s&&(g||S||h||v)||n&&!R.default.isSameDay(o.createdTime,n.createdTime)){const e=R.default.getMidnight(o.createdTime);d.push(new tt(Ae.ItemListKey.DateMarkerPrefix+e,e))}}l&&Q.isAddCurrentUserThreadActivity(o)&&(v?_=d.length:(T=d.length,M=!0)),T>=0&&M&&(C.isThreadActivityType(o.messagetype)?T++:M=!1);const r=P&&o.createdTime===P.messageTimestamp,a=(null==P?void 0:P.cuid)&&o.cuid===P.cuid,p=o.cuid===e.focusedMessageCuid,m=o.isAlbum()&&e.focusedMessageCuid&&W.default.albumContainsMessage(o.getAlbumId(),e.focusedMessageCuid);(this._scrollToMessage&&(r||a||m)||p)&&(P&&o.isAlbum()&&(P.messageTimestamp=o.createdTime),V.log(B.LogTraceArea.MessageStreamDebug,"Scroll to message index:"+s),t.scrollToItemViewIndex=d.length,t.shouldFocusScrolledMessageCell=!0,this._isFocusInsideMessageStreamOnMount=!0),d.push(new q.MessageViewItemInfo(Ae.ItemListKey.MessagePrefix+o.cuid,o,f));const k=this._readReceiptsMarks[s];k&&d.push(new et(k.key,k.readReceipts,this._getReadReceiptsSummary(s))),I&&w===o.cuid&&d.push(new nt(Ae.ItemListKey.NewConnection+o.cuid,32)),(f||y)&&(f=!1,y=!1,this._isFocusInsideMessageStreamOnMount=!0)}if((null===(o=this.state)||void 0===o?void 0:o.isShowOldFriendBackHintDivider)&&d.push(new ot(Ae.ItemListKey.OldFriendBack,36,y,e.conversationId)),!h&&_>=0){0!==_||b.isEncryptedThread(e.conversationId)||(null===(n=this._conversation)||void 0===n?void 0:n.isSkypeSMSConversation())||(_=d.length);const s=t.enableGreetingCard&&!e.isIncomingContactInvitePending&&!b.isEncryptedThread(e.conversationId)&&!b.isPhoneMri(e.conversationId)&&!r;V.log(B.LogTraceArea.MessageStream,"Show wave:"+s+" enableGreetingCard:"+t.enableGreetingCard+" isIncomingContactInvitePending:"+e.isIncomingContactInvitePending+" isEncryptedThread:"+b.isEncryptedThread(e.conversationId)+" isPhoneMri:"+b.isPhoneMri(e.conversationId)+" skypeMessagesLength: "+r);const i=[new at(Ae.ItemListKey.ContactInviteHeaderItem,s?535:325,s,e.isContactInviteJustAccepted,e.isIncomingContactInvitePending,e.isEncryptedConversationEstablished,r>0)];d.splice(_,0,...i),this._scrollToMessage&&(t.scrollToItemViewIndex=_),h=!0}const{isJoinEnabled:k,isRegularMemberInModeratedGroup:A}=this.state||t;k?d.splice(-1===T?0:T,0,new ct(e.conversationId)):T>=0&&m.default.contacts().canInvitePeople&&!A&&((this.state?this.state.enableNewConversationCreation:t.enableNewConversationCreation)?d.splice(T,0,new dt(e.conversationId)):d.splice(T,0,new lt(e.conversationId))),this._shouldShowSpeechConsentItemInfo(this.state,t,d.length)&&d.push(new ht(e.conversationId));const x=a.filter(this._composingMris,(e=>!ae.default.isMyMri(e)));e.disableComposingIndicator?!e.disableComposingIndicator&&x.length>0&&d.push(new st(this._composingMris,e.conversationId)):d.push(new st(x,e.conversationId));const O=this.props,L=this._optimizeMessageSendSuccessNotification(d,s);if(L!==ft.SkipProcessingDueToRaceCondition&&(this._contentRendered&&(0,U.default)(O.isSelectMessagesModeActive,e.isSelectMessagesModeActive)&&L!==ft.Optimize?(this._disallowFetchingMoreMessagesFromStore=!0,this._applyModificationsDebounced(d,p,e,P&&P.messageTimestamp)):this._applyModifications(d,p,e,P&&P.messageTimestamp)),this._viewItemsListDirty=!1,V.log(B.LogTraceArea.MessageStreamDebug," Unread marker:unreadMarkerShown:"+this._unreadMarkerShown+";unreadMarkerTimestamp:"+this._unreadMarkerTimestamp+";unreadMarkerMessageIndex:"+this._unreadMarkerMessageIndex+";unreadMarkerViewIndex:"+this._unreadMarkerViewIndex),this._scrollToMessage&&t.isInitialMessagesLoaded&&t.scrollToItemViewIndex<0){const t="Unable to find the scroll to message with cuid: "+e.focusedMessageCuid+". ScrollToTimestamp: "+(P&&P.messageTimestamp)+". Please let the dev team know.";V.warn(B.LogTraceArea.MessageStream,t)}return t}_optimizeMessageSendSuccessNotification(e,t){var s;if(!h.default.getS4LMessagingFeaturesNoSubscription().enableFastMessageSendSuccessPropagation||void 0===t||(null===(s=this._conversation)||void 0===s?void 0:s.isEncryptedThread()))return ft.StandardFlow;const i=this._dataItemsInfo.getItemList(),o=L.default.calculateModifications(i,e,!0,!0,this._equalsItemInfo,this._canSubstituteItemsInfo);if(1!==o.length||i.length!==e.length)return ft.StandardFlow;if(this._isMessageSendSuccessRaceCondition(o[0],t))return ft.SkipProcessingDueToRaceCondition;const n=o[0],r=n.to&&n.to.skypeMessage;if(!r||r.cuid!==t)return ft.StandardFlow;return r.isMessageLie()?(V.warn(B.LogTraceArea.MessageStreamDebug,"_regenerateItemListIfDirty(): we were supposed to get here ONLY with acked lie"),ft.StandardFlow):ft.Optimize}_isMessageSendSuccessRaceCondition(e,t){const s=e.to&&e.to.skypeMessage,i=e.from&&e.from.skypeMessage;return!(!i||!s||i.content!==s.content||i.isMessageLie()||!s.isMessageLie()||i.isEdited()!==s.isEdited()||s.cuid!==t||i.cuid!==t)}_shouldShowSpeechConsentItemInfo(e,t,s){if(t.isChild)return!1;const i=a.isUndefined(t)||a.isUndefined(t.showSpeechConsentSuggestion)?e.showSpeechConsentSuggestion:t.showSpeechConsentSuggestion;return i&&-1===this._speechConsentSuggestionSeenAt&&(this._speechConsentSuggestionSeenAt=s),i||(this._speechConsentSuggestionSeenAt=-1),i&&this._speechConsentSuggestionSeenAt===s}_shouldDisplayContactInviteViewItemInfo(e,t){const s=t.isUsingStackNavigationContext||void 0===t.isUsingStackNavigationContext&&this.state.isUsingStackNavigationContext,i=!this._readOnlyConversation&&(e.isIncomingContactInvitePending||!e.isConversationAccepted);return s&&(i||e.showInviteHeaderForEncryptedThread)||b.isPhoneMri(this.props.conversationId)}_applyModifications(e,t,s=this.props,i){this._disallowFetchingMoreMessagesFromStore=!1;const o=this._dataItemsInfo.getItemList(),n=L.default.calculateModifications(o,e,!0,!0,this._equalsItemInfo,this._canSubstituteItemsInfo),r=L.default.convertToListModifications(n);s.isSelectMessagesModeActive&&this._updateSelectedMessages(r),this._dataItemsInfo.applyMany(r,(e=>this._regenerateMetadata(e,s,i)),((e,t)=>this._setOptions(e,t))),this._wasLatestMessageTheEndPreviously=t,this._shouldUpdateForTranslationChange=!1,this._shouldUpdateForHintChange=!1}_setOptions(e,t){const s=this._wasLatestMessageTheEndPreviously;e.type===L.ListModificationType.AddItems&&e.insertIndex===t.length&&(e.options={animateFromBottom:s})}_updateSelectedMessages(e){if(a.some(e,(e=>e.type===L.ListModificationType.RemoveItems))){const e=ve.default.getSelectedMessages();a.each(e,(e=>{!a.some(this._skypeMessages,(t=>t.cuid===e.message.cuid))&&ve.default.removeSelectedMessage(e)}))}}_regenerateMetadata(e,t,s){let i=0;const o=[];let n;a.each(e,((e,t)=>{e instanceof q.MessageViewItemInfo&&(e.metadata=a.assign(e.metadata,{streamItemIndex:i++,viewIndex:t}),o.push(e))})),a.eachRight(o,(e=>{const t=e.skypeMessage;return!(ae.default.isMyMri(t.creator)&&!t.isMessageLie()&&C.getMessageTypeGroup(t)===C.MessageTypeGroups.Picture)||(n=t.cuid,!1)})),a.each(o,((i,r)=>{const a=r>0?o[r-1]:void 0,l=a?a.skypeMessage:void 0,d=r+1<o.length?o[r+1]:void 0,c=d?d.skypeMessage:void 0,h=i.skypeMessage,u=ae.default.isMyMri(h.creator),p=l&&ae.default.isMyMri(l.creator);let g=0;const m=r>0&&e[i.metadata.viewIndex-1]instanceof et;let S=!(!a||m)&&i.metadata.viewIndex-a.metadata.viewIndex>1;const f=C.isThreadActivityType(h.messagetype);l&&(g=l.createdTime,S=S||f||C.getMessageTypeGroup(l)===C.MessageTypeGroups.Calling||l.isEmote());const y=h.createdTime-g>=ut,v=c&&c.createdTime-h.createdTime>=ut,_=!l||S||y||(u?!p:l.creator!==h.creator),b=r===o.length-1||v||!c||c.creator!==h.creator;let T=_&&!u,M=T,I=T||_&&u||_&&b;_&&(f||h.isEmote())&&(T=!1,M=!1,I=!1);const w=this._highlightScrollToTarget&&(s===h.createdTime||t.focusedMessageCuid===h.cuid);w&&(this._highlightScrollToTarget=!1);const P=C.getMessageTypeGroup(i.skypeMessage)===C.MessageTypeGroups.Text,k=this.props;let A=!1;if(t.isSelectMessagesModeActive!==k.isSelectMessagesModeActive||this._firstUpdateCompleteForMutliSelect){const e=i.metadata.viewIndex>this._topWholeViewIndex-3&&i.metadata.viewIndex<this._bottomWholeViewIndex+3;A=t.isSelectMessagesModeActive?e||this._firstUpdateCompleteForMutliSelect:!e&&!this._firstUpdateCompleteForMutliSelect}const x={isFirstInGroup:_,isLastInGroup:b,showUserIcon:M,showUserName:T,showTimestamp:I,isHighlighted:w,isReadOnly:this._readOnlyConversation,hasUnderlay:t.hasUnderlay,isLastPhotoByCurrentUser:!!n&&h.cuid===n,canPretendBeingSent:P,showSelectMessageCheckbox:A};i.metadata.shouldUpdate=!(0,U.default)(x,i.metadata.itemRenderInfo)||this._shouldUpdateForTranslationChange||this._shouldUpdateForHintChange,i.metadata.itemRenderInfo=x}))}_canSubstituteItemsInfo(e,t){return e.key===t.key}_convertViewIndexToMessage(e,t){const s=this._dataItemsInfo.getItemList();if(!(e<0))if(t)for(;e<s.length;){const t=s[e];if(t instanceof q.MessageViewItemInfo)return t;e++}else for(;e>=0;){const t=s[e];if(t instanceof q.MessageViewItemInfo)return t;e--}}_maybeTrackMessageSearchPerformance(e){const t=this.state.scrollRequest;if(a.isUndefined(t))return;const s=a.filter(e,(e=>e instanceof q.MessageViewItemInfo)),i=a.map(s,(e=>e.skypeMessage.createdTime));if(a.includes(i,t.messageTimestamp)){const e=t.id;if(this.state.lastTrackedScrollRequestId===e)return;this.setState({lastTrackedScrollRequestId:e});const s=!!t.zeroTermSearch;(0,ze.searchResultsRendered)(We.ScenarioSearchTypes.MessageInConversation,e,s,this.state.messageSearchLimit);const i={publicDirectory:!1,message:!1,indexedDb:!1,bots:!1,allPeople:!1,fastContacts:!1,messageInConversation:!0};(0,ze.compositeScenarioResultsRendered)(e,We.CompositeSearchOrigin.SearchInConversationPanel,void 0,s,i)}}_focusMountedItemOnMobile(){this._mountedItemToFocus?this._mountedItemToFocus.focusItemForScreenReader():V.warn(B.LogTraceArea.MessageStream,"Focus should be on message stream, but no item mounted")}_checkForConsumptionHorizonChange(){var e;if(V.log(B.LogTraceArea.ConsumptionHorizon,"MessageStream convId="+fe.mriOrId(this.props.conversationId)+" _checkForConsumptionHorizonChange"),this.props.conversationId===b.SkonsoleMri)return;if(0===this._dataItemsInfo.getItemList().length)return void V.log(B.LogTraceArea.ConsumptionHorizon,"MessageStream convId="+fe.mriOrId(this.props.conversationId)+" no messages displayed");if(!this._isUserActive())return void V.log(B.LogTraceArea.ConsumptionHorizon,"MessageStream convId="+fe.mriOrId(this.props.conversationId)+" user not active");if(this._lockUpdatesToConsumptionHorizon)return void V.log(B.LogTraceArea.ConsumptionHorizon,"MessageStream convId="+fe.mriOrId(this.props.conversationId)+" locked updates to CH");let t;for(let e=this._bottomPartialViewIndex;e>=0;e--){const s=this._convertViewIndexToMessage(e,!1);if(!s)continue;if(t=s.skypeMessage,s.metadata.streamItemIndex<=this._currentConsumptionHorizonItemIndex)break;const i=s.skypeMessage.isAlbumItem()&&1===W.default.getNotFailedMediaMessagesForAlbum(s.skypeMessage.getAlbumId()).length;if(s.skypeMessage.countsForUnreadCounts()||i)break}const s=null===(e=this._conversation)||void 0===e?void 0:e.getConsumptionHorizonTimestamp();t?(V.log(B.LogTraceArea.ConsumptionHorizon,"lastVisibleItem.createdTime:",t.createdTime,"chTimestamp:",s,"_lastVisibleItemForConsumptionHorizon.createdTime:",this._lastVisibleItemForConsumptionHorizon?this._lastVisibleItemForConsumptionHorizon.createdTime:"_lastVisibleItemForConsumptionHorizon is undefined"),t.createdTime>s&&(!this._lastVisibleItemForConsumptionHorizon||t.createdTime>this._lastVisibleItemForConsumptionHorizon.createdTime)&&(this._lastVisibleItemForConsumptionHorizon=t,V.log(B.LogTraceArea.ConsumptionHorizon,"MessageStream - scheduling update of consumption horizon to: "+t.getConsumptionHorizonString()+" convId="+fe.mriOrId(this.props.conversationId)+" CHindex="+this._currentConsumptionHorizonItemIndex+" BottomWholeViewIndex="+this._bottomWholeViewIndex+" ConsumptionHorizonTimestamp="+s+" current lastVisibleItem.createdTime="+(this._lastVisibleItemForConsumptionHorizon?this._lastVisibleItemForConsumptionHorizon.createdTime:null)+" new lastVisibleItem.createdTime="+t.createdTime),this._consumptionHorizonUpdateDebounceTimer&&Ee.default.clearTimeout(this._consumptionHorizonUpdateDebounceTimer),this._consumptionHorizonUpdateDebounceTimer=Ee.default.setTimeout(this._updateConsumptionHorizonToLastVisibleItem,this._messageReadDelay))):V.log(B.LogTraceArea.ConsumptionHorizon,"lastVisibleItem is undefined")}_renderOldConversationEmptyState(){return(0,n.jsx)(d.View,Object.assign({style:gt.noMessagesContainer},{children:(0,n.jsx)(be.default,{conversationId:this.props.conversationId,displayName:this.props.recipientDisplayName,gender:Ue.default.getFullUserProfileByMriNoSubscription(this.props.conversationId).gender,onGreet:this.props.onGreet,showBorder:!1,alwaysForceEmoticon:!0})}))}_renderBookmarkConversationEmptyState(){return(0,n.jsx)(u.default,{isUsingStackNavigationContext:this.state.isUsingStackNavigationContext})}_renderMybotConversationEmptyState(){return(0,n.jsx)(p.default,{onInitialRenderComplete:this._onInitialRenderComplete})}fetchFreHeaderBuildVersion(){return i.__awaiter(this,void 0,void 0,(function*(){this.setState({isFetchingFreHeadBuilding:!0});const e=yield Je.LocalStorage.getItem(Je.StorageKeys.FreBuildVersion);this.setState({freBuildVersion:e,isFetchingFreHeadBuilding:!1})}))}_renderMybotFreHeader(){return(0,n.jsx)(Xe.default,{isNoMessage:!this._skypeMessages||0===this._skypeMessages.length})}render(){var e,t,s;let i,o=null,r=null;if(this.state.isInitialMessagesLoaded)if(this._conversation.isBookmarksThread()&&0===this._skypeMessages.length)o=this._renderBookmarkConversationEmptyState();else if(this.props.isConversationAccepted&&!this.props.isIncomingContactInvitePending&&!this._readOnlyConversation&&_.default.haveAllMessagesForConversation(this.props.conversationId)&&0===this._skypeMessages.length)o=this._conversation.isMyBotThread()?this._renderMybotConversationEmptyState():b.isThread(this.props.conversationId)||b.isConversationWithPhoneNumber(this.props.conversationId)?null:this._conversation.isMyBotThread()?this._renderMybotConversationEmptyState():this._renderOldConversationEmptyState();else{this._conversation.isBookmarksThread()||(r=(0,n.jsx)(Ie.StatusPillView,{statusPillInstance:this._statusPillInstance,messageStreamStore:this._messageStreamStore,ref:this._statusPillRef,conversationId:this.props.conversationId,messageStreamFontSize:this.state.messageStreamFontSize,customAutoHideBehaviour:this.state.enableRevealInHistory?{onAutoHidden:this._handleSearchPillAutoHide}:void 0}));const e=this.state.scrollToItemViewIndex>=0?this.state.scrollToItemViewIndex:void 0;this._contentRendered||this._markHub2StreamScenarioStepCompleted("StartVMVRendering"),this._contentRendered=!0,o=(0,n.jsx)(He.VirtualMessageView,{ref:this._onListViewRef,observableList:this._dataItemsInfo,renderItem:this._renderItem,shouldUpdateItem:this._shouldUpdateItem,contentMaxWidth:$.messageStreamMaxContentWidth,onVisibleRangeChanged:this._onVisibleRangeChanged,initialScrollIndex:e,shouldFocusInitialItem:this.state.shouldFocusScrolledMessageCell&&!this.props.isMessageSearchPanelVisible||this._conversation.isBookmarksThread(),isMessageSearchPanelVisible:this.props.isMessageSearchPanelVisible,allowKeyboardLayoutUpdates:this.props.isMessageSearchPanelVisible,onUserScroll:this._onScroll,onLayout:this.props.onMessageStreamLayout,onInitialRenderComplete:this._onInitialRenderComplete,keyboardShouldPersistTaps:!0,keyboardDismissMode:Fe.default.getPlatformType()===B.PlatformType.Android?"none":"on-drag",scrollsToTop:!this.state.isReactionDetailsOn,scrollEnabled:!this.state.isScrollDisabled,horizontalPadding:this.props.safeAreaHorizontalInsets,canShowSuggestions:this.state.canShowSuggestions,leftSpacerWidth:this.props.leftSpacerWidth,rightSpacerWidth:this.props.rightSpacerWidth,useWideLayout:!this.state.isUsingStackNavigationContext},this._virtualMessageViewRefCount),this.state.enableMultiMessageQuoteOnKeyboard&&(o=(0,n.jsx)(l.default,Object.assign({ref:this._onCopyListenerRef,handler:this._onCopy},{children:o})))}else o=(0,n.jsx)(d.View,Object.assign({style:gt.spinnerContainer},{children:(0,n.jsx)(Le.default,{size:T.SXActivityIndicatorSize.Medium,tintColor:oe.default.getPrimaryColorNoSubscription(),deferTimeMs:1e3})}));const a=!(null===(e=this._conversation)||void 0===e?void 0:e.isSkypeSMSConversation())&&!(null===(t=this._conversation)||void 0===t?void 0:t.isEncryptedThread()),c=!this.props.hideSuggestions&&this.state.isLatestMessageTheEnd&&!!this.state.lastMessage&&a&&!(null===(s=this._conversation)||void 0===s?void 0:s.isBookmarksThread()),h=this.state.isUsingStackNavigationContext&&this.props.isMessageSearchPanelVisible;this.state.initialRenderCompleted&&c&&this.state.lastMessage&&(i=(0,n.jsx)(Oe.default,{conversationId:this.props.conversationId,lastMessage:this.state.lastMessage,useCompactLayout:this.state.useCompactLayout,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,onCardSuggestionAction:this.props.onCardSuggestionAction,disableQuickReply:this.props.isSelectMessagesModeActive||h,onSuggestionClicked:this.props.onSuggestionClicked,ref:this._onSuggestionsListViewRef,onToggled:this.props.onSuggestionsToggled,isRenderedIn4ColumnWidth:this.props.isRenderedIn4ColumnWidth,leftSpacerWidth:this.props.leftSpacerWidth,rightSpacerWidth:this.props.rightSpacerWidth,getInputEntities:this.props.getInputEntities,onMessageSent:this.props.onMessageSent},"SwiftQuickReplyListView"),this.state.isUsingStackNavigationContext||(i=(0,n.jsxs)(d.View,Object.assign({style:gt.actionsDesktopContainer},{children:[(0,n.jsx)(d.View,{style:this._getSpacerStyle(this.props.leftSpacerWidth)}),i,(0,n.jsx)(d.View,{style:this._getSpacerStyle(this.props.rightSpacerWidth)})]}))));const u=[gt.contentAreaContainer];let p;this.props.isSelectMessagesModeActive||(p=(0,n.jsx)(qe.default,{ref:this._onJumpToEndButtonRef,onPressCallback:this._onJumpToEndButtonPress,conversationId:this.props.conversationId,horizontalPadding:this.props.safeAreaHorizontalInsets},"jumpToEndButton"),Ke.default.isIPad()&&u.push(gt.tabletMargin));const g=this.props.renderDivider?this.props.renderDivider():void 0,m=this.props.preventAccessibilityFocus?d.Types.ImportantForAccessibility.NoHideDescendants:void 0,{isFetchingFreHeadBuilding:S,freBuildVersion:f}=this.state,y=!S&&$e.default.shouldShowFreHeader(this._conversation.isMyBotThread(),f)?this._renderMybotFreHeader():void 0;return(0,n.jsxs)(d.View,Object.assign({style:gt.contentOuterContainer,importantForAccessibility:m},{children:[(0,n.jsxs)(d.View,Object.assign({style:u},{children:[o,r,p,y]})),g,i]}))}_getSpacerStyle(e){return mt[e]||(mt[e]=d.Styles.createViewStyle({flex:1,minWidth:e})),mt[e]}_onScrolledToTheBottom(e){this.props.onScrolledToTheBottom&&this.props.onScrolledToTheBottom(e)}_scrollToBottomOfRefreshedStream(){const e=this._refreshConversationProperties(this.props,this.state,!0,!0);this.setState(e)}_reportRenderItemQoS(e,t){const s=ge.default.getTelemetryScenarioForMessage(e.conversationId,e.cuid);if(!s)return;const i=s.getSecondaryScenario(ye.ScenarioName.SendTextMessageTimeToAppearInChat);i&&(t?(i.markStepCompleted("AnimationCompleted"),i.finish()):i.isStepMarked("Render")||i.markStepCompleted("Render"));const o=e.isMessageLie();let n=s.getSecondaryScenario(ye.ScenarioName.SendTextMessageUI);if(n||(n=s.getSecondaryScenario(ye.ScenarioName.SendPictureUI)),!n||n.isResolved()||n.isInvalidated())return;const r="Visible"+(o?"Lie":"Real")+"ItemRender";if(o?n.isStepMarked(r)||n.markStepCompleted(r,void 0,void 0,!0):n.markPerfTargetStepCompleted(r),!o){n.finish();const t=n.getTotalDuration();if(!a.isUndefined(t)&&n.getScenarioName()===ye.ScenarioName[ye.ScenarioName.SendTextMessageUI]){const s=n.getIsInitialConnectivityGood()||!1,i=y.getCorrelationIdFromMessageParts(b.skypeIdToMri(ae.default.getSkypeId()),e.conversationId,e.getOriginalClientMessageId());V.track(new c.SendTextMessageUI(t,de.default.isUsingStackNavigationContext(),s,n.isInterrupted(),n.getTimePassedTillInterruption(),i,e.getOriginalClientMessageId()))}}}_scrollToBottom(){this._listView&&this._listView.scrollToBottom(),this._lockUpdatesToConsumptionHorizon=!1}_markHub2StreamScenarioStepCompleted(e){this._getContext().isPresentedInDesktopSubview||le.default.markScenarioStepCompleted(this.props.conversationId,e)}_getNewConnectionString(){const e=Ue.default.getFullUserProfileByMri(this.props.conversationId),t=H.getLocalizeParamForGender(e.gender);return z.getString("NewConnectionIndicator.UserAddedToContactList",{user:e.getShortName(),gender:t})}getSkypeMessages(){return this._skypeMessages}feedEphemeralMessage(e){this._messageStreamStore&&this._messageStreamStore.feedEphemeralMessage(e)}_checkMessageStreamStoreAndUpdate(e,t,s){this._messageStreamStore&&t&&this._messageStreamStore.isDestroyed()&&(this._updateMessageStreamStore(e,t.messageTimestamp,!1),V.log(B.LogTraceArea.MessageStreamDebug,"Update MessageStreamStore object reason: "+s))}_isUserActive(){return this._isUserPresentInApp||this._isUserScrolling}_maybeAnimateScrollToPosition(e,t){if(!(0,U.default)(e,t)&&!a.isUndefined(t)&&t.messageTimestamp){const e=a.findIndex(this._dataItemsInfo.getItemList(),(e=>e instanceof q.MessageViewItemInfo&&e.skypeMessage.createdTime===t.messageTimestamp));if(e>-1&&this._listView){const t=this._dataItemsInfo.getItemList()[e].key;this._listView.scrollToPosition(e,t,!0)}}}_getItemHint(e){var t,s;if(e===(null===(t=this.state.messageHintsData)||void 0===t?void 0:t.hintMessageId)&&this._messageCuidToShowHint===(null===(s=this.state.messageHintsData)||void 0===s?void 0:s.hintMessageId))return K.default.getMessageHintDataToDisplay()}}t.default=yt},996285:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(422801),r=s(671830),a=s(469840),l=s(898278),d=s(539549),c=s(731761),h=s(312381),u=s(437490),p=s(952262),g=s(746096),m=s(110117),S=s(436237),f=s(915877),y=s(733754),v=s(106658),C=s(18078),_=s(104735),b=s(795691),T=s(29130),M=s(210541),I=s(22222),w=s(581760),P=s(711828),k=s(680837),A=s(619675),x=s(24576),R=s(988523),O=s(702301),L=s(567977),F=s(853374),B=(0,f.lazyProperties)({container:()=>o.Styles.createViewStyle({paddingTop:20,paddingBottom:60}),avatar:()=>o.Styles.createViewStyle({marginBottom:10}),headerStyles:()=>o.Styles.createTextStyle({marginBottom:10}),participantsContainer:()=>o.Styles.createViewStyle({flexDirection:"row",marginBottom:20}),participantsIcon:()=>o.Styles.createViewStyle({marginRight:10}),actionsContainer:()=>o.Styles.createViewStyle({alignItems:"center",borderRadius:8,paddingTop:30,paddingBottom:15,paddingHorizontal:40,marginTop:75}),actionCaption:()=>o.Styles.createTextStyle({color:w.Color.gray400,marginBottom:20}),link:()=>o.Styles.createTextStyle({color:w.Color.blueDark,marginBottom:20}),linkButtonMinWidth:()=>o.Styles.createViewStyle({marginTop:10})});class D extends x.default{constructor(){super(...arguments),this._shareLinkToGroup=()=>{const e=F.default.newCauseId();S.log(g.LogTraceArea.MessageStream,"NewConversationLanding._shareLinkToGroup causeId: "+e),this._hasLink()&&this.state.inviteLink&&this.state.myDisplayName?(h.default.shareToClipboard(this.state.inviteLink),this.setState({isCopied:!0})):S.error(g.LogTraceArea.MessageStream,"NewConversationLanding._shareLinkToGroup inviteLink: "+!!this.state.inviteLink+" myDisplayName: "+!!this.state.myDisplayName)},this._onGroupSettingsPress=()=>{const e=F.default.newCauseId();S.log(g.LogTraceArea.MessageStream,"NewConversationLanding._onGroupSettingsPress causeId: "+e),u.dismissAll(),_.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:e})},this._onSharePress=()=>{const e=F.default.newCauseId();S.log(g.LogTraceArea.MessageStream,"NewConversationLanding._onSharePress causeId: "+e),u.dismissAll(),r.isThread(this.props.conversationId)&&(this.state.isJoinEnabled?this._shareLinkToGroup():(this.setState({isCreatingJoinLink:!0}),n.default.setJoinEnabled(this.props.conversationId,!this.state.isJoinEnabled)))},this._onAddPress=()=>{const e=F.default.newCauseId();S.log(g.LogTraceArea.MessageStream,"NewConversationLanding._onAddPress causeId: "+e),u.dismissAll(),R.contactAdded(this.props.conversationId);new c.default({convId:r.asSkypeThreadIdMaybe(this.props.conversationId),navigationOrigin:g.NavigationConversationOrigin.NewChat,peopleType:M.PeopleType.All,filterPeopleType:M.FilterType.GroupCapable,wizardSteps:[b.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}}_buildState(e,t){const s=(0,d.default)().getConversation(e.conversationId),i=C.default.getSkypeMri();return{conversationName:p.default.getDisplayName(e.conversationId),myDisplayName:p.default.getDisplayName(i),isJoinEnabled:s&&s.isJoinEnabled(),inviteLink:s&&a.default.getLink(s.id),isCreatingJoinLink:!t&&this.state.isCreatingJoinLink,isMinWidth:T.default.isMobileScreenSize(this._getRootViewId())}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.isCreatingJoinLink&&this._hasLink()&&t.isJoinEnabled!==this.state.isJoinEnabled&&(this._shareLinkToGroup(),this.setState({isCreatingJoinLink:!1}))}render(){const e=this.state.conversationName?(0,i.jsx)(A.Header,Object.assign({size:l.HeaderSize.h5,style:B.headerStyles},{children:this.state.conversationName})):void 0,t=this._useDarkTheme()?o.Styles.createViewStyle({borderColor:w.Color.gray400,borderWidth:1},!1):o.Styles.createViewStyle({backgroundColor:w.Color.gray50Overlay50},!1),s=y.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:this.props.memberCount}),n=this.state.isCopied?y.getString("InviteShare.ShareCopiedButtonLabel"):y.getString("MessageStream.NewConversationLandingShareGroupLink"),r=o.Styles.createViewStyle({alignSelf:"stretch",flexDirection:this.state.isMinWidth?"column":"row"},!1),a=this._hasLink()?(0,i.jsx)(A.BodyText,Object.assign({style:[B.link,this._useAccessibleTheme()?this._themeStyles.primaryTextColorStyle:void 0],selectable:!0},{children:this.state.inviteLink})):void 0;return(0,i.jsxs)(o.View,Object.assign({style:[B.container,k.default.alignItemsCenter]},{children:[(0,i.jsx)(O.default,{style:B.avatar,size:L.UserIconSize.Size100,userMri:this.props.conversationId}),e,(0,i.jsxs)(o.View,Object.assign({style:B.participantsContainer},{children:[(0,i.jsx)(m.default,{icon:P.SkypeIcon.ContactGroup,size:P.IconSize.size16,color:this._themeColors.primaryTextColor,style:B.participantsIcon}),(0,i.jsx)(A.Caption,Object.assign({messageStreamFontSize:v.MessageStreamFontSize.Large},{children:s}))]})),(0,i.jsx)(I.default,{icon:P.SkypeIcon.Topic,iconPositon:l.SXButtonIconPosition.End,buttonSize:l.SXButtonSize.Medium,buttonStyle:l.SXButtonStyle.ThemeNoBackground,title:y.getString("MessageStream.NewConversationLandingGroupSettingsLink"),onPress:this._onGroupSettingsPress}),(0,i.jsxs)(o.View,Object.assign({style:[B.actionsContainer,t]},{children:[a,(0,i.jsx)(A.BodyText,Object.assign({style:B.actionCaption,textThemeColor:l.TextThemeColor.Primary},{children:y.getString("MessageStream.NewConversationLandingActionsCaption")})),(0,i.jsxs)(o.View,Object.assign({style:r},{children:[(0,i.jsx)(I.default,{buttonSize:l.SXButtonSize.Medium,title:y.getString("MessageStream.NewConversationLandingAddPeopleButton"),onPress:this._onAddPress}),(0,i.jsx)(I.default,{style:this.state.isMinWidth?B.linkButtonMinWidth:void 0,buttonSize:l.SXButtonSize.Medium,buttonStyle:l.SXButtonStyle.ThemeNoBackground,title:n,onPress:this._onSharePress,disabled:this.state.isCreatingJoinLink})]}))]}))]}))}_hasLink(){return this.state.isJoinEnabled&&this.state.inviteLink}}t.default=D},94060:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(437490),r=s(770891),a=s(290120),l=s(710400),d=s(915877),c=s(519089),h=s(343512),u=s(748443),p=s(29130),g=s(581760),m=s(680837),S=s(24576),f=s(547662),y=10,v=(0,d.lazyProperties)({wrapperFullscreen:()=>o.Styles.createViewStyle({backgroundColor:g.Color.black,justifyContent:"center"}),container:()=>o.Styles.createViewStyle({position:"absolute"})}),C={};class _ extends S.default{constructor(){super(...arguments),this._currentTopValue=y,this._currentLeftValue=y,this._animatedTopValue=new o.Animated.Value(this._currentTopValue),this._animatedLeftValue=new o.Animated.Value(this._currentTopValue),this._animatedStyle=o.Styles.createAnimatedViewStyle({top:this._animatedTopValue,left:this._animatedLeftValue}),this._onClose=e=>{this._telemetryScenario&&this.state.contentProps&&(this._telemetryScenario.finish(this.state.contentProps,e),this._telemetryScenario=void 0),c.default.setContentProps(void 0)},this._onFullScreen=()=>{this.setState({isFullScreen:!this._shouldPlayFullScreen()})},this._onPan=e=>{const t=e.pageY-(this._lastPageY||e.initialPageY),s=e.pageX-(this._lastPageX||e.initialPageX);this._lastPageY=e.pageY,this._lastPageX=e.pageX;const i=this._currentTopValue+t,n=this._currentLeftValue+s,r=this._getContainerHeight(),a=this._getContainerWidth();if(this._currentTopValue=Math.min(Math.max(-r/2,i),this.state.draggableArea.height-r/2),this._currentLeftValue=Math.min(Math.max(-a/2,n),this.state.draggableArea.width-a/2),e.isComplete){this._lastPageX=void 0,this._lastPageY=void 0;const e=this._currentTopValue<this.state.draggableArea.height/2-r/2?y:this.state.draggableArea.height-y-r;o.Animated.parallel([o.Animated.timing(this._animatedTopValue,{toValue:e,easing:o.Animated.Easing.Out(),duration:150}),o.Animated.timing(this._animatedLeftValue,{toValue:y,easing:o.Animated.Easing.Out(),duration:150})]).start((()=>{this.isComponentMounted()&&(this._currentLeftValue=y,this._currentTopValue=e)}))}else this._animatedTopValue.setValue(this._currentTopValue),this._animatedLeftValue.setValue(this._currentLeftValue)}}_buildState(e,t){const s=this._getRootViewId(),i={viewWidth:p.default.getWidth(s),viewHeight:p.default.getHeight(s)+l.default.getUpdateInfo().height,isLandscape:p.default.getDeviceOrientation(s)===a.DeviceOrientation.Landscape,draggableArea:u.default.getDraggableArea(),contentProps:c.default.getContentProps()};return!i.contentProps||!t&&this.state.contentProps||(this._telemetryScenario=new h.default(i.contentProps)),i}_shouldPlayFullScreen(){return this.state.isFullScreen||this.state.isLandscape}_getContainerWidth(){return this._shouldPlayFullScreen()?this.state.viewWidth:this.state.draggableArea.width-20}_getContainerHeight(){return this.state.isLandscape?this.state.viewHeight:Math.round(this._getContainerWidth()*(this.state.viewWidth/this.state.viewHeight))}componentWillUnmount(){super.componentWillUnmount(),this._onClose(h.FinishReason.PipDestroyed)}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),this.state.draggableArea.height!==t.draggableArea.height&&this._currentTopValue!==y){const e=t.draggableArea.height-y-this._getContainerHeight();o.Animated.timing(this._animatedTopValue,{toValue:e,easing:o.Animated.Easing.Out(),duration:150}).start((()=>{this.isComponentMounted()&&(this._currentTopValue=e)}))}const i=this.state.isLandscape!==t.isLandscape||this.state.isFullScreen!==t.isFullScreen;this._telemetryScenario&&i&&t.contentProps&&this._telemetryScenario.markViewModeChanged(t.contentProps,{isLandscape:t.isLandscape,wasLandscape:this.state.isLandscape,isFullScreen:t.isFullScreen,wasFullScreen:this.state.isFullScreen});const r=!this.state.isLandscape&&t.isLandscape,a=!this.state.isFullScreen&&t.isFullScreen;t.contentProps&&(a||r)&&n.dismissAll()}_getDraggableAreaStyle(){const e=Object.assign({},this.state.draggableArea),t=`${e.width}x${e.height}x${e.x}x${e.y}`;return C[t]||(C[t]=o.Styles.createViewStyle({position:"absolute",overflow:"hidden",top:e.y,left:e.x,width:e.width,height:e.height,backgroundColor:g.Color.transparent})),C[t]}render(){const e=this._renderContent();if(!e)return null;const t=this._shouldPlayFullScreen(),s=t?[m.default.absoluteFill,v.wrapperFullscreen]:this._getDraggableAreaStyle(),n=[m.default.dimensionsStyle({width:this._getContainerWidth(),height:this._getContainerHeight()})];return t||n.push(v.container,this._animatedStyle),(0,i.jsx)(o.View,Object.assign({style:s,ignorePointerEvents:!t},{children:(0,i.jsx)(o.Animated.View,Object.assign({style:n},{children:(0,i.jsx)(o.GestureView,Object.assign({onPan:t?void 0:this._onPan,style:m.default.flexOne},{children:e}))}))}))}_renderContent(){if(this.state.contentProps&&this._telemetryScenario)return this.state.contentProps.contentType===r.PipContentType.Youtube?(0,i.jsx)(f.default,Object.assign({containerWidth:this._getContainerWidth(),onClose:this._onClose,onFullScreen:this._onFullScreen,isLandscape:this.state.isLandscape,isFullScreen:this.state.isFullScreen,viewportWidth:this.state.viewWidth,viewportHeight:this.state.viewHeight,telemetryScenario:this._telemetryScenario},this.state.contentProps)):void 0}}t.default=_},547662:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(967593),r=s(516778),a=s(898278),l=s(913944),d=s(915877),c=s(267824),h=s(733754),u=s(343512),p=s(451070),g=s(404057),m=s(915415),S=s(581760),f=s(311010),y=s(711828),v=s(680837),C=s(24576),_=s(912770),b=s(626712),T=s(516718),M=s(54288),I=s(220481),w=s(972090),P=(0,d.lazyProperties)({controlsWrapper:()=>r.Styles.createViewStyle({flexDirection:"column",alignSelf:"stretch",backgroundColor:S.Color.transparent}),controlsHeader:()=>r.Styles.createViewStyle({flexDirection:"row",flex:0,height:45}),headerButton:()=>r.Styles.createButtonStyle({width:35,height:35}),videoControlContainer:()=>r.Styles.createViewStyle({flex:1,justifyContent:"center",alignItems:"center",overflow:"visible"}),openInNativeAppLink:()=>r.Styles.createLinkStyle({backgroundColor:S.Color.blackOverlay50,padding:10,width:250,color:S.Color.white,fontSize:f.default.fontSize.size20,textAlign:"center"}),videoControlButton:()=>r.Styles.createButtonStyle({borderRadius:40,width:80,height:80,flex:-1,justifyContent:"center",alignItems:"center"}),videoControlButtonProtection:()=>r.Styles.createViewStyle({width:80,height:80,backgroundColor:S.Color.blackOverlay50,borderRadius:40})}),k={};class A extends C.default{constructor(){super(...arguments),this._onOpenInNativeAppPress=()=>{this._openInNativeApp(u.FinishReason.UserOpenedApp)},this._onErrorMessagePress=()=>{this._openInNativeApp(u.FinishReason.RestrictedVideoOpenedInApp)},this._onFullScreenPressed=()=>{this._showControls(),this.props.onFullScreen()},this._onClosePressed=()=>{this.props.onClose(u.FinishReason.UserClosed)},this._getCurrentTime=()=>{this._webView&&this._webView.postMessage(JSON.stringify({type:w.MessageType.GetCurrentTime}))},this._onMediaButton=()=>{this._webView&&this._webView.postMessage(JSON.stringify({type:this.state.playbackState===I.PlaybackState.Playing?w.MessageType.Pause:w.MessageType.Play}))},this._onMessage=e=>{if(!this.isComponentMounted())return;const t=g.default.parseJsonErrorable(e.data);if(!o.isError(t))switch(t.type){case w.MessageType.PlayerStateChanged:const e=t;e.state===I.PlaybackState.Paused||e.state===I.PlaybackState.Ended?this._showControls(!0):this._scheduleHideControls(),this.props.telemetryScenario.markPlaybackStateChanged(this.props,{newState:I.PlaybackState[e.state],oldState:I.PlaybackState[this.state.playbackState]}),this._videoViewerControlsStore&&(this._videoViewerControlsStore.setVideoPlayState(e.state===I.PlaybackState.Playing?M.VideoPlayState.Playing:M.VideoPlayState.Paused),this._videoViewerControlsStore.setVideoPlayProgress({current:e.currentTime,duration:e.duration})),this.setState({playbackState:e.state,videoDuration:e.duration});break;case w.MessageType.CurrentTime:const s=t;this.state.videoDuration&&this._videoViewerControlsStore&&this._videoViewerControlsStore.setVideoPlayProgress({current:s.currentTime,duration:this.state.videoDuration});break;case w.MessageType.VideoError:this.props.telemetryScenario.markContentFailedToLoad(this.props),this.setState({hasError:!0})}},this._onControlsProtectionPress=()=>{this._showControls()},this._onSeekTo=(e,t)=>{this._webView&&this.state.videoDuration&&this._videoViewerControlsStore&&(t?(this._showControls(!0),this._clearScrubberUpdateInterval()):(this._scheduleHideControls(),this._startScrubberUpdateInterval()),this._webView.postMessage(JSON.stringify({type:w.MessageType.SeekTo,seekTo:e*this.state.videoDuration,isDragging:t})),this._videoViewerControlsStore.setVideoPlayProgress({current:e*this.state.videoDuration,duration:this.state.videoDuration}))},this._scheduleHideControls=()=>{this._hideControlsTimeout=_.default.setTimeout((()=>{this.isComponentMounted()&&(this.setState({showControls:!1}),(this.props.isFullScreen||this.props.isLandscape)&&this._disableScrubber())}),3e3)},this._onWebViewRef=e=>{this._webView=e||void 0}}_buildState(e,t){const s=this.props,i={};return t?(i.playbackState=I.PlaybackState.Unstarted,i.showControls=!0):s.videoUrl!==e.videoUrl&&(this._clearHideControlsTimeout(),e.telemetryScenario.markContentChanged(e),i.playbackState=I.PlaybackState.Unstarted,i.showControls=!0,i.hasError=!1,i.videoDuration=void 0),i.leftInset=p.default.horizontalInsets().left,i}componentDidMount(){super.componentDidMount(),(this.props.isFullScreen||this.props.isLandscape)&&this._enableScrubber()}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),!this.props.isFullScreen&&e.isFullScreen||!this.props.isLandscape&&e.isLandscape?this._enableScrubber():(this.props.isFullScreen&&!e.isFullScreen||this.props.isLandscape&&!e.isLandscape)&&this._disableScrubber()}componentWillUnmount(){super.componentWillUnmount(),this._clearScrubberUpdateInterval()}render(){const e=this.props.isLandscape?this.props.viewportWidth:this.props.viewportHeight,t=this.props.isLandscape?this.props.viewportHeight:this.props.viewportWidth,s=[];return this.props.isLandscape?s.push(v.default.flexOne):s.push(v.default.dimensionsStyle({width:e,height:t}),this._getTransformScaleStyle(e,t)),this.state.leftInset&&s.push(r.Styles.createViewStyle({marginLeft:-this.state.leftInset},!1)),(0,i.jsxs)(r.View,Object.assign({style:v.default.flexOne},{children:[(0,i.jsx)(r.View,Object.assign({style:s},{children:(0,i.jsx)(I.default,{width:e,height:t,videoId:encodeURIComponent(this.props.videoId),videoPreviewUrl:b.default.isUrlValid(this.props.videoPreviewUrl)?this.props.videoPreviewUrl:void 0,onMessage:this._onMessage,onWebViewRef:this._onWebViewRef},"player")})),this._getControls()]}))}_getTransformScaleStyle(e,t){const s=`${e}x${t}x${this.props.containerWidth}`;if(!k[s]){const i=this.props.containerWidth/e;k[s]=r.Styles.createViewStyle({transform:[{translateY:-t/2},{translateX:-e/2},{scale:i},{translateY:t/2},{translateX:e/2}]})}return k[s]}_getControls(){const e=[];if(this.state.showControls){const t=[(0,i.jsx)(l.default,{size:y.IconSize.size20,color:S.Color.white,hoverColor:S.Color.gray400overlay95,icon:y.SkypeIcon.ClosePanel,onPress:this._onClosePressed,title:h.getString("Global.CloseButtonTitle"),accessibilityLabel:h.getString("Global.CloseButtonTitle"),style:P.headerButton},"cancel")];this.props.isLandscape||t.push((0,i.jsx)(l.default,{size:y.IconSize.size14,color:S.Color.white,hoverColor:S.Color.gray400overlay95,icon:this.props.isFullScreen?y.SkypeIcon.Contract:y.SkypeIcon.Expand,onPress:this._onFullScreenPressed,title:h.getString("CallPanel.FullScreenButton"),accessibilityLabel:h.getString("CallPanel.FullScreenButton"),style:P.headerButton},"fullscreen")),t.push((0,i.jsx)(r.View,{style:v.default.flexOne},"spacer")),t.push((0,i.jsx)(l.default,{size:y.IconSize.size16,color:S.Color.white,hoverColor:S.Color.gray400overlay95,icon:y.SkypeIcon.OpenOutside,onPress:this._onOpenInNativeAppPress,title:h.getString("MediaViewer.OpenInYouTubeApp"),accessibilityLabel:h.getString("MediaViewer.OpenInYouTubeApp"),style:P.headerButton},"openInApp"));const s=this._videoViewerControlsStore?(0,i.jsx)(T.VideoViewerControls,{controlsStore:this._videoViewerControlsStore,onPlayOrPause:o.noop,useCompactLayout:!0}):void 0;e.push((0,i.jsx)(n.GradientView,Object.assign({style:P.controlsHeader,direction:n.GradientDirection.BOTTOM,colors:[S.Color.blackOverlay60,S.Color.blackOverlay40,S.Color.transparent]},{children:t}),"controlsHeader"),(0,i.jsx)(r.View,Object.assign({style:P.videoControlContainer},{children:this._getVideoControl()}),"videoControls"),(0,i.jsx)(r.View,Object.assign({style:P.controlsHeader},{children:s}),"controlsFooter"))}return(0,i.jsx)(r.View,Object.assign({style:[P.controlsWrapper,v.default.absoluteFill],onPress:this._onControlsProtectionPress,disableTouchOpacityAnimation:!0},{children:e}),"controlsProtection")}_openInNativeApp(e){r.Linking.openUrl(this.props.videoUrl),this.props.onClose(e)}_getVideoControl(){if(this.state.hasError)return(0,i.jsx)(c.Link,Object.assign({url:this.props.videoUrl,onPress:this._onErrorMessagePress,style:P.openInNativeAppLink},{children:"This video cannot be watched outside YouTube. Click here to open YouTube."}));if(this.state.playbackState===I.PlaybackState.Unstarted)return(0,i.jsx)(r.View,Object.assign({style:P.videoControlButtonProtection},{children:(0,i.jsx)(m.default,{size:a.SXActivityIndicatorSize.Large,tintColor:S.Color.white})}));return this.state.playbackState>=I.PlaybackState.Ended&&this.state.playbackState<=I.PlaybackState.Paused?(0,i.jsx)(r.View,Object.assign({style:P.videoControlButtonProtection},{children:(0,i.jsx)(l.default,{icon:this.state.playbackState===I.PlaybackState.Playing?y.SkypeIcon.Pause:y.SkypeIcon.Play,size:y.IconSize.size40,color:S.Color.white,hoverColor:S.Color.whiteOverlay90,onPress:this._onMediaButton,style:P.videoControlButton})})):void 0}_enableScrubber(){this._videoViewerControlsStore||(this._videoViewerControlsStore=new M.VideoViewerControlsStore,this._videoViewerControlsStore.registerViewerCallbacks({onPlay:o.noop,onPause:o.noop,onSeekTo:this._onSeekTo}),this._videoViewerControlsStore.setScrubberControlsVisibility(!0),this._getCurrentTime(),this._startScrubberUpdateInterval())}_disableScrubber(){this._videoViewerControlsStore&&(this._videoViewerControlsStore=void 0,this._clearScrubberUpdateInterval())}_startScrubberUpdateInterval(){this._scrubberUpdateTimeout||(this._scrubberUpdateTimeout=_.default.setInterval(this._getCurrentTime,1e3))}_clearScrubberUpdateInterval(){this._scrubberUpdateTimeout&&(_.default.clearInterval(this._scrubberUpdateTimeout),this._scrubberUpdateTimeout=void 0)}_clearHideControlsTimeout(){this._hideControlsTimeout&&(_.default.clearTimeout(this._hideControlsTimeout),this._hideControlsTimeout=void 0)}_showControls(e=!1){this._clearHideControlsTimeout(),(this.props.isFullScreen||this.props.isLandscape)&&this._enableScrubber(),this.state.showControls||this.setState({showControls:!0}),e||this._scheduleHideControls()}}t.default=A},220481:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlaybackState=void 0;const i=s(785893),o=s(516778),n=s(915877),r=s(733754),a=s(581760),l=s(24576),d=s(972090);!function(e){e[e.Unstarted=-1]="Unstarted",e[e.Ended=0]="Ended",e[e.Playing=1]="Playing",e[e.Paused=2]="Paused",e[e.Buffering=3]="Buffering",e[e.Cued=5]="Cued"}(t.PlaybackState||(t.PlaybackState={}));const c=(0,n.lazyProperties)({webview:()=>o.Styles.createViewStyle({backgroundColor:a.Color.black,flex:1})});class h extends l.default{shouldComponentUpdate(e,t,s){return super.shouldComponentUpdate(e,t,s),e.videoId!==this.props.videoId}render(){return(0,i.jsx)(o.WebView,{ref:this.props.onWebViewRef,mediaPlaybackRequiresUserAction:!1,allowsInlineMediaPlayback:!0,onMessage:this.props.onMessage,source:(0,d.default)({videoId:this.props.videoId,width:this.props.width,height:this.props.height,locale:(0,r.getLocale)(),videoPreviewUrl:this.props.videoPreviewUrl}),javaScriptEnabled:!0,style:c.webview},this.props.videoId)}}t.default=h},972090:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageType=void 0;const i=s(853374);var o;!function(e){e[e.VideoError=0]="VideoError",e[e.PlayerStateChanged=1]="PlayerStateChanged",e[e.Play=2]="Play",e[e.Pause=3]="Pause",e[e.GetCurrentTime=4]="GetCurrentTime",e[e.CurrentTime=5]="CurrentTime",e[e.SeekTo=6]="SeekTo"}(o=t.MessageType||(t.MessageType={}));t.default=function(e){const t=i.default.newCauseId(),s=(e=>`\nbase-uri 'self' https:;\ndefault-src 'self' https:;\nscript-src 'nonce-${e}' https://s.ytimg.com https://www.youtube.com 'report-sample' 'unsafe-inline';\nconnect-src 'self' https://www.youtube.com;\nchild-src https://s.ytimg.com https://www.youtube.com;\nreport-uri https://edge.skype.com/r/c;\n`)(t);return{html:`\n<!DOCTYPE html>\n<html>\n<head>\n<style>\n    iframe, html, body {\n        margin: 0;\n        padding: 0;\n        background-color: black;\n        width: ${e.width}px;\n        height: ${e.height}px;\n    }\n\n    .fillAbsolute {\n        position: absolute;\n        left: 0;\n        top: 0;\n        width: ${e.width}px;\n        height: ${e.height}px;\n    }\n</style>\n<meta http-equiv="X-Content-Security-Policy" content="${s}">\n<meta http-equiv="Content-Security-Policy" content="${s}">\n<meta name="viewport" content="width=device-width, initial-scale=1">\n</head>\n<body>\n    <div id="player"></div>\n    ${e.videoPreviewUrl?'<img id="cover" class="fillAbsolute" src="'+e.videoPreviewUrl+'"/>':""}\n\n    <script nonce="${t}">\n    var tag = document.createElement('script');\n    tag.src = "https://www.youtube.com/iframe_api";\n    var firstScriptTag = document.getElementsByTagName('script')[0];\n    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n\n    var player;\n    var coverRemoved = ${!e.videoPreviewUrl};\n    function onYouTubeIframeAPIReady() {\n        player = new YT.Player('player', {\n        height: '${e.height}',\n        width: '${e.width}',\n        videoId: '${e.videoId}',\n        playerVars: {\n            'playsinline': 1,\n            'enablejsapi': 1,\n            'fs': 0,\n            'hl': '${e.locale}',\n            'iv_load_policy': 3,\n            'modestbranding': 1,\n            'controls': 0,\n            'rel': 0,\n        },\n        events: {\n            'onReady': onPlayerReady,\n            'onStateChange': onPlayerStateChange,\n            'onError': onError,\n        }\n        });\n    }\n\n    function onPlayerReady(event) {\n        event.target.playVideo();\n\n        document.addEventListener('message', function (event) {\n            var data = JSON.parse(event.data);\n\n            switch (data.type) {\n                case ${o.Play}:\n                    player.playVideo();\n                    break;\n                case ${o.Pause}:\n                    player.pauseVideo();\n                    break;\n                case ${o.GetCurrentTime}:\n                    window.postMessage(JSON.stringify({\n                        type: ${o.CurrentTime},\n                        currentTime: player.getCurrentTime(),\n                    }));\n                    break;\n                case ${o.SeekTo}:\n                    player.seekTo(data.seekTo, !data.isDragging);\n                    break;\n            }\n        });\n    }\n\n    function onError() {\n        window.postMessage(JSON.stringify({type: ${o.VideoError}}));\n    }\n\n    function onPlayerStateChange(event) {\n        if (event.data === 1 && !coverRemoved) {\n            var cover = document.getElementById('cover');\n\n            if (cover) {\n                cover.parentNode.removeChild(cover);\n                coverRemoved = true;\n            }\n        }\n\n        // there are some states, but we want to keep them covered, so report state only after cover is removed (so video starts playing)\n        if (coverRemoved) {\n            window.postMessage(JSON.stringify({\n                type: ${o.PlayerStateChanged},\n                state: event.data,\n                duration: player.getDuration(),\n                currentTime: player.getCurrentTime(),\n            }));\n        }\n    }\n    <\/script>\n</body>\n</html>\n            `}}},118644:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.openCustomReactionPanel=void 0;const i=s(785893),o=s(516778),n=s(110117),r=s(436237),a=s(915877),l=s(89808),d=s(104735),c=s(382677),h=s(346200),u=s(581760),p=s(711828),g=s(24576),m=(0,a.lazyProperties)({custumReactioButton:()=>o.Styles.createViewStyle({padding:5,borderRadius:15})});class S extends g.default{constructor(){super(...arguments),this._onPress=()=>{f(this.props.origin,this._getRootViewId())}}render(){var e;const t=o.Styles.createButtonStyle({backgroundColor:this._useAccessibleTheme()?u.Color.white:l.default.getPrimaryColorNoSubscription()},!1);return(0,i.jsx)(o.Button,Object.assign({style:[this.props.styles,t,m.custumReactioButton],onPress:this._onPress,title:c.getCustomReactionsStore(this.props.origin).getCustomReactionsModalTitle()},{children:(0,i.jsx)(n.default,{size:null!==(e=this.props.iconSize)&&void 0!==e?e:p.IconSize.size20,color:this._useAccessibleTheme()?u.Color.gray300:u.Color.white,icon:p.SkypeIcon.Topic})}))}}function f(e,t){d.default.navigateToCustomReactionsPanel(e,t),r.track(new h.CustomReactionsManipulationTelemetry(h.CustomReactionsManipulationAction.CustomReactionsPanelOpened,{customReactionsType:e}))}t.default=S,t.openCustomReactionPanel=f},224112:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(889391),a=s(618603),l=s(632949),d=s(746096),c=s(436237),h=s(915877),u=s(733754),p=s(879348),g=s(382677),m=s(29130),S=s(223528),f=s(311010),y=s(711828),v=s(619675),C=s(24576),_=s(418037),b=s(897634),T=(0,h.lazyProperties)({customReactionContainer:()=>n.Styles.createViewStyle({flex:1,borderBottomWidth:1}),customReactionsPickerMobile:()=>n.Styles.createViewStyle({paddingTop:4,paddingHorizontal:4,height:212}),customReactionsPickerMobileLandscape:()=>n.Styles.createViewStyle({height:118}),emptyState:()=>(0,h.lazyProperties)({sectionTitleText:()=>n.Styles.createViewStyle({marginTop:0,marginBottom:4,marginRight:4,marginLeft:12,paddingTop:4}),sectionTitleTextDestop:()=>n.Styles.createTextStyle({paddingTop:14,marginLeft:16}),sectionContent:()=>n.Styles.createTextStyle({textAlign:"center",marginTop:50})}),horizontalSpaces:()=>n.Styles.createViewStyle({paddingHorizontal:5}),searchResultTitle:()=>n.Styles.createTextStyle({marginTop:14,marginBottom:4,marginRight:4,marginLeft:16}),pesPickerSearchContainer:()=>n.Styles.createViewStyle({flexShrink:1,height:30,borderRadius:5,margin:10})});class M extends C.default{constructor(){super(...arguments),this._searchData={toggledFromSearchCount:0,searchAttemptsCount:0},this._getPesPickerPopupRef=()=>this._getPesPickerPopup,this._onPesPickerPopupRef=e=>{this._getPesPickerPopup=e||void 0},this._getContainerControlRef=()=>this._getContainerControl,this._onContainerControlRef=e=>{this._getContainerControl=e||void 0},this._onRemoveReaction=(e,t,s)=>{var i;const n=null===(i=e.decode())||void 0===i?void 0:i.encodedAttr(),r=g.updateReactionNameWithTone(s,null==n?void 0:n.tone);this._reactionsStore.removeReactions([r]),c.log(d.LogTraceArea.CustomReactionRemovedFromSet,"Reaction from Custom Reactions set is removed, custom reactions left ",o.size(this.state.selectedReactions))},this._onToggleReaction=(e,t,s)=>{var i;const r=null===(i=e.decode())||void 0===i?void 0:i.encodedAttr(),a=g.updateReactionNameWithTone(s,null==r?void 0:r.tone);this._reactionsStore.isLocalReaction(a)?this._reactionsStore.removeReactions([a]):this._reactionsStore.addReactions([a]),c.log(d.LogTraceArea.CustomReactionsToggleFromModal,"Toggle reactions from Custom Reactions modal, number of currently selected reactions ",o.size(this.state.selectedReactions)),this.state.searchQuery&&this.props.updateTelemetryData({toggledEmoticonCount:++this._searchData.toggledFromSearchCount,searchInitiatedCount:this._searchData.searchAttemptsCount}),this.state.selectedReactions.length>this.state.maxSelectedReactions&&n.Accessibility.announceForAccessibility(u.getString("ReactionsPanel.ExceededCustomReactionsLimit",{name:s}))},this._onSearchQueryChange=e=>{if(!this.isComponentMounted())return;const t=e.trim();t!==this.state.searchQuery&&(this.setState({searchQuery:t}),this.state.searchQuery&&this.props.updateTelemetryData({toggledEmoticonCount:this._searchData.toggledFromSearchCount,searchInitiatedCount:++this._searchData.searchAttemptsCount}))},this._onSearchQueryChangeDebounced=o.debounce(this._onSearchQueryChange,r.default.getS4LSearchFeatures().searchHeaderDebounceWait)}_buildState(e,t){return this._reactionsStore=this._getReactionsStore(e.origin),{selectedReactions:this._reactionsStore.getCurrentReactions(),maxSelectedReactions:this._reactionsStore.getCustomReactionsCount()}}_getReactionsStore(e){return g.getCustomReactionsStore(e)}render(){m.default.getWidthNoSubscription(this._getRootViewId()),m.default.getHeightNoSubscription(this._getRootViewId());let e=[];e=[n.Styles.createViewStyle({height:this._getPickerHeight()})];const t=(0,i.jsx)(S.default,{inputText:this.state.searchQuery,style:[T.pesPickerSearchContainer,this._themeStyles.searchBorderModernizeColorStyle],searchInputControlStyle:T.horizontalSpaces,placeholderText:u.getString("SearchInputControl.PlaceHolderTextShort"),accessibilityLabel:u.getString("SearchInputControl.PlaceHolderTextShort"),clearSearchIconSize:y.IconSize.size14,clearSearchIconColor:this._themeColors.primaryIconColor,inputStyle:[T.horizontalSpaces,f.default.fontStyle.caption],showSearchIcon:!0,hideBackground:!0,doNotAutoFocusOnMount:!0,onInputTextChange:this._onSearchQueryChangeDebounced}),s=(0,i.jsx)(n.View,Object.assign({style:e},{children:this._hasSelectedReactions()?this._renderCustomReactionsPicker():this._renderPlaceholder()})),o=!!this.state.searchQuery&&(0,i.jsx)(n.Text,Object.assign({style:[f.default.fontStyle.caption,T.searchResultTitle,this._themeStyles.pesPickerCategoryColorStyle]},{children:u.getString("SearchInputControl.SearchResults")})),r=(0,i.jsx)(l.default,{isCustomReactions:!1,doNotRenderPreview:!0,doNotRenderTabIndicator:!1,parentRef:this._getContainerControlRef,pesPickerPopupRef:this._getPesPickerPopupRef,onPesSelected:this._onToggleReaction,ref:void 0,renderMobileInterface:!1,filter:this.state.searchQuery,searchMode:!!this.state.searchQuery,showingInNarrowView:!0,overrideUseSmallEmoticonSizeMobile:!0,darkTheme:this._isDarkTheme(),renderWithToggleIcons:!0,selectedEmoticons:this.state.selectedReactions,hideDiverseIndicatior:!1,hideSearchDelete:!0,initialTabId:this._reactionsStore.getInitialTabId()});return(0,i.jsxs)(n.View,Object.assign({style:[T.customReactionContainer,this._themeStyles.headerShadowBorderColorStyle],ref:this._onContainerControlRef},{children:[t,s,o,r,(0,i.jsx)(p.PesPickerPopup,{ref:this._onPesPickerPopupRef,renderMobileInterface:!1})]}))}_getPickerHeight(){let e;return e=this.state.maxSelectedReactions<12?82:this.state.maxSelectedReactions<24?121:168,e}_renderPlaceholder(){const e=[f.default.fontStyle.caption,T.emptyState.sectionTitleText];return e.push(T.emptyState.sectionTitleTextDestop),(0,i.jsxs)(n.View,{children:[(0,i.jsx)(n.Text,Object.assign({style:e},{children:this._getEmptyStateTitle()})),(0,i.jsx)(v.BodyText,Object.assign({style:T.emptyState.sectionContent,textThemeColor:v.TextThemeColor.Secondary},{children:u.getString("ReactionsPanel.NoReactionsSelectedMessage")}))]})}_getEmptyStateTitle(){return u.getString("ReactionsPanel.ReactionsSelectedCounter",{count:0,maximum:this.state.maxSelectedReactions})}_renderCustomReactionsPicker(){return(0,i.jsx)(a.CustomReactionsPicker,{isCustomReactions:!0,doNotRenderPreview:!0,doNotRenderTabIndicator:!0,pesPickerPopupRef:this._getPesPickerPopupRef,renderMobileInterface:!1,ref:void 0,onPesSelected:this._onRemoveReaction,searchMode:!1,showingInNarrowView:!0,overrideUseSmallEmoticonSizeMobile:!0,darkTheme:this._isDarkTheme(),renderWithToggleIcons:!0,selectedEmoticons:this.state.selectedReactions,hideDiverseIndicatior:!0,autoFocusFirstItem:!0,customReactionOrigin:this.props.origin})}_hasSelectedReactions(){var e;return!!(null===(e=this.state.selectedReactions)||void 0===e?void 0:e.length)}_isDarkTheme(){return b.isDarkTheme(_.default.colorThemeNoSubscription())}}t.default=M},618603:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomReactionsPicker=void 0;const i=s(632949),o=s(733754),n=s(758962),r=s(382677),a=s(711828);class l extends i.default{_buildState(e,t){this.selectedReactions=r.getCustomReactionsStore(e.customReactionOrigin).getCurrentReactions(),this.selectedReactionsCount=this.selectedReactions.length,this.maxNumberOfCustomReactions=r.getCustomReactionsStore(e.customReactionOrigin).getCustomReactionsCount();const s=super._buildState(Object.assign({},e),t);return Object.assign({},s)}_getTabs(e,t){return[{id:"customReactions",packs:[{id:"custom",items:this.selectedReactions,title:this._getTitle()}],tabType:0,iconUrlOrAssetID:""}]}_getInitialPagedTabIndex(){return 0}_getTitle(){return o.getString("ReactionsPanel.ReactionsSelectedCounter",{count:this.selectedReactionsCount,maximum:this.maxNumberOfCustomReactions})}_getErrorSymbol(){return a.SkypeIcon.Blank}_supportsRenderTabsWithoutPaging(){return!1}_getPackAccessibilityLabel(e){return o.getString("PesPicker.CustomReactionsPackHeaderAccessibilityLabel",{count:this.selectedReactionsCount,maximum:this.maxNumberOfCustomReactions})}_getNumberOfItemsPerLine(){const e=n.frameHeights.emoticons.Size40+6;return this.state.availableWidth?Math.floor(this.state.availableWidth/e):void 0}}t.CustomReactionsPicker=l},291556:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(667294),n=s(705465),r=s(281878),a=s(884912),l=s(711828),d=s(118644),c=s(258187),h=s(600212),u=s(110117);t.default=(0,o.memo)((({onMoreButtonPressed:e})=>{const{rootViewId:t}=(0,c.useCommonContext)(),s=(0,r.useSUIThemeStyles)((e=>({button:{backgroundColor:e.colors.surfaceSecondary,width:32,height:32,alignItems:"center",justifyContent:"center",borderRadius:16,marginLeft:6}})),[]),o=(0,h.useSkypeTheme)();return(0,i.jsx)(n.Pressable,Object.assign({style:s.button,onPress:()=>{e(),(0,d.openCustomReactionPanel)(a.CustomReactionsType.Message,t)}},{children:(0,i.jsx)(u.default,{color:o.themeColors.textPrimary,size:l.IconSize.size20,icon:l.SkypeIcon.Plus})}))}))},843543:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(967593),r=s(667294),a=s(915877),l=s(600212),d=s(3553),c=(0,a.lazyProperties)({gradient:()=>o.Styles.createViewStyle({position:"absolute",top:0,right:36,bottom:0,width:14,height:48,overflow:"visible"})});t.default=(0,r.memo)((()=>{const{mode:{isDark:e},themeColors:{surfacePrimary:t}}=(0,l.useSkypeTheme)();return(0,i.jsx)(n.GradientView,{style:c.gradient,direction:n.GradientDirection.RIGHT,colors:[e?d.SkypeColor.black0p:d.SkypeColor.white0p,t]})}))},796107:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(281878),n=s(667294),r=s(705465),a=s(809206),l=s(660198),d=s(382677),c=s(934339),h=s(18078),u=s(317219),p=s(734102),g=s(82433),m=s(733754),S=s(436237),f=s(746096),y=(s(812854),s(346200)),v=s(795133),C=s(46929),_=s(584876),b=s(788952),T=s(886045),M=s(291556),I=s(417270),w=s(843543),P=c.Size.Medium,k=r.StyleSheet.create({viewContainer:{alignItems:"center",justifyContent:"center",overflow:"visible"},emoticonContainer:{flex:1,alignItems:"stretch",overflow:"visible"}}),A=e=>{var t;const s=g.default.getEmoticonByNameNoSubscription(e);return null!==(t=null==s?void 0:s.description)&&void 0!==t?t:e};t.default=(0,l.WithResub)((({allUserReactions:e,message:t,myMri:s,openReactionMenuTelemetry:l,onMoreButtonPressed:h,onReactionPressed:g})=>{const y=t.getReactions(),[x,R]=(0,n.useState)(y.filter((e=>e.users.some((e=>e.mri===s)))).reduce(((e,t)=>(e.set(t.key,t),e)),new Map)),O=(0,n.useCallback)(((e,t)=>{const s=A(t);e?(x.delete(t),R(new Map(x)),T.default.maybeAnnounceForAccessibility(m.getString("ReactionsMenu.YouRemovedReaction",{reactionName:s}))):T.default.maybeAnnounceForAccessibility(m.getString("ReactionsMenu.YouRemovedReactionError",{reactionName:s}))}),[x]),L=(0,n.useCallback)(((e,t)=>{const i=A(t);e?(x.set(t,{key:t,users:[{mri:s,time:Date.now()}]}),R(new Map(x)),T.default.maybeAnnounceForAccessibility(m.getString("ReactionsMenu.YouReacted",{reactionName:i}))):T.default.maybeAnnounceForAccessibility(m.getString("ReactionsMenu.YouReactedError",{reactionName:i}))}),[x,s]),F=(0,n.useCallback)(((e,s)=>{S.log(f.LogTraceArea.ReactionsPopupMenu,"_onClick - selectedReaction",s);const i=((e,t)=>{const s=d.separateReactionNameAndTone(e);return{message:t,reactionAction:{reaction:s.reactionNameWithoutTone,reactionLevel:40,reactionAdded:!1,isCustomReaction:(0,u.default)().isCustomReaction(e),reactionTone:s.reactionTone}}})(s,t);x.has(s)?((e,t,s,i)=>{S.log(f.LogTraceArea.ReactionsPopupMenu,"Removing the selected reaction",e),d.addRemoveReactionFromMessage(t,s,(t=>i(t,e)))})(s,i,l,O):((e,t,s,i)=>{S.log(f.LogTraceArea.ReactionsPopupMenu,"Adding the selected reaction",e),t.reactionAction.reactionAdded=!0,d.addRemoveReactionFromMessage(t,s,(s=>{if(a.default.isMobile()&&C.default.doesMessageHaveHint(t.message.cuid)&&"yes"===t.reactionAction.reaction){v.default.hintShownAndUsed();const e=_.default.getDefaultMessageHintObject();e.wasFeatureUsedByUser=!0,C.default.setMessagesHintData(b.MessageHintsTypes.DoubleTapMessageToLike,e)}i(s,e)}))})(s,i,l,L),g()}),[t,L,O,g,l,x]),[B,D]=(0,n.useState)(),E=(0,n.useCallback)(((e,t)=>{D(t)}),[]),V=(0,n.useCallback)((e=>{D(void 0)}),[]);return(0,i.jsxs)(o.Row,Object.assign({width:"100%",marginY:"10px",style:k.viewContainer},{children:[(0,i.jsx)(r.ScrollView,Object.assign({horizontal:!0,showsHorizontalScrollIndicator:!1},{children:(0,i.jsx)(o.Row,Object.assign({style:k.emoticonContainer},{children:(e=>e.map((e=>{const t=d.separateReactionNameAndTone(e),s=x.has(e),o=B&&B===e?p.ReactionButtonSelectionState.Selected:p.ReactionButtonSelectionState.NotSelected,n=o===p.ReactionButtonSelectionState.Selected,a=A(t.reactionNameWithoutTone);let l=a;return s&&(l+=", "+m.getString("Global.SelectedAccessibilityLabel")),(0,i.jsxs)(r.View,{children:[(h=e,!!h&&(0,i.jsx)(p.ReactionButton,{title:a,animateEmoticon:n||s,size:c.Size.Large,renderSize:P,reactionName:t.reactionNameWithoutTone,onPress:F,onHoverStart:E,onHoverEnd:V,selectionState:o,accessibilityLabel:l,tone:t.reactionTone})),(0,i.jsx)(I.default,{didUserSelect:s})]},"reactionButton"+a);var h})))(e)}))})),(0,i.jsx)(w.default,{}),(0,i.jsx)(M.default,{onMoreButtonPressed:h})]}))}),(e=>Object.assign(Object.assign({},e),{allUserReactions:(0,u.default)().getCustomReactions(),myMri:h.default.getSkypeMri(),openReactionMenuTelemetry:new y.ReactionPickerTelemetry(e.message,y.ReactionOriginType.ReactionsPopupMenu)})))},734102:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionButton=t.ReactionButtonSelectionState=void 0;const i=s(785893),o=s(665768),n=s(516778),r=s(217041),a=s(934339),l=s(915877),d=s(382677),c=s(680837);var h;!function(e){e[e.NotSelected=0]="NotSelected",e[e.Selected=1]="Selected"}(h=t.ReactionButtonSelectionState||(t.ReactionButtonSelectionState={}));const u=(0,l.lazyProperties)({button:()=>n.Styles.createButtonStyle({flex:1,alignSelf:"stretch"}),emoticonStyle:()=>n.Styles.createViewStyle({marginHorizontal:8,marginBottom:6,marginTop:6},!1)});class p extends r.ComponentBase{constructor(){super(...arguments),this._buttonScaleValue=new n.Animated.Value(1),this._buttonScaleAndTranslateStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._buttonScaleValue}]}),this._onPress=e=>{e.stopPropagation(),this.props.onPress(e,d.updateReactionNameWithTone(this.props.reactionName,this.props.tone))},this._onLongPress=e=>{e.stopPropagation(),this.props.onLongPress&&this.props.onLongPress(e,d.updateReactionNameWithTone(this.props.reactionName,this.props.tone))},this._onHoverStart=e=>{this.props.onHoverStart&&this.props.onHoverStart(e,d.updateReactionNameWithTone(this.props.reactionName,this.props.tone))},this._onHoverEnd=e=>{this.props.onHoverEnd&&this.props.onHoverEnd(e,d.updateReactionNameWithTone(this.props.reactionName,this.props.tone))}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.props.selectionState!==e.selectionState&&this._startAnimation(this.props.selectionState===h.Selected?1.35:1)}componentWillUnmount(){super.componentWillUnmount(),this._cancelAnimations()}render(){return(0,i.jsx)(n.View,Object.assign({style:[c.default.overflowVisible,u.emoticonStyle]},{children:(0,i.jsxs)(n.Animated.View,Object.assign({style:[c.default.overflowVisible,this._buttonScaleAndTranslateStyle]},{children:[(0,i.jsx)(a.AnimatedEmoticon,{size:this.props.size,renderSize:this.props.renderSize,innerText:this.props.title,emoticonName:this.props.reactionName,showPlaceHolder:!0,isStatic:!this.props.animateEmoticon,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants,zoomHint:this.state.zoomHint,preventSelectable:!0,tone:this.props.tone}),(0,i.jsx)(n.View,Object.assign({style:c.default.absoluteFill},{children:(0,i.jsx)(n.Button,{style:u.button,title:this.props.title,accessibilityLabel:this.props.accessibilityLabel,accessibilityTraits:this.props.accessibilityTraits,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,onPress:this._onPress,onLongPress:this.props.onLongPress?this._onLongPress:void 0,tabIndex:0,disableTouchOpacityAnimation:!0})}))]}))}))}_cancelAnimations(){this._pendingAnimation&&this._pendingAnimation.stop()}_startAnimation(e,t){this._cancelAnimations(),this.setState({zoomHint:e}),this._pendingAnimation=n.Animated.parallel([n.Animated.timing(this._buttonScaleValue,{toValue:e,duration:o.Common.Duration.Short,easing:o.Easing.SkypeExpoInOut5,useNativeDriver:!0})]),this._pendingAnimation.start((()=>{this._pendingAnimation=void 0,this.isComponentMounted()&&t&&t()}))}animatePress(e){const t=()=>{e&&e()};this.isComponentMounted()?this._startAnimation(1.35,(()=>{this.isComponentMounted()?this._startAnimation(1,(()=>{t()})):t()})):t()}}t.ReactionButton=p},117459:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionCountButton=void 0;const i=s(785893),o=s(516778),n=s(934339),r=s(889391),a=s(871908),l=s(662602),d=s(429791),c=s(82433),h=s(746096),u=s(584876),p=s(436237),g=s(915877),m=s(733754),S=s(795133),f=s(788952),y=s(18078),v=s(758962),C=s(425765),_=s(346200),b=s(382677),T=s(415963),M=s(581760),I=s(794050),w=s(619675),P=s(912770),k=s(853374),A=s(346200),x=s(886045),R=s(89808),O=s(24576),L=s(648638),F=s(734537),B=s(46929),D=(0,g.lazyProperties)({countContainerView:()=>o.Styles.createButtonStyle({flexDirection:"row",alignItems:"center",justifyContent:"center"}),desktopTransform:()=>o.Styles.createViewStyle({transform:[{rotateZ:"0"}]}),countContainerOuterView:()=>o.Styles.createButtonStyle({backgroundColor:M.Color.white}),countContainer:()=>o.Styles.createButtonStyle({padding:5}),countText:()=>o.Styles.createTextStyle({color:M.Color.gray300,alignSelf:"center",marginLeft:6})});class E extends O.default{constructor(){super(...arguments),this._onLayout=e=>{this._height=e.height},this._onIconButtonRef=e=>{this._iconButton=e||void 0},this._onHoverStart=e=>{if(this.state.enableReactionsHoverSummary&&!o.UserInterface.isNavigatingWithKeyboard()){const e=k.default.newCauseId();p.log(h.LogTraceArea.ReactionsCountButton,"_onHoverStart, causeId: "+e),this._popupDismissTimeout&&P.default.clearTimeout(this._popupDismissTimeout),this._hoverTimeout&&P.default.clearTimeout(this._hoverTimeout),this._hoverTimeout=P.default.setTimeout((()=>{this.state.isHovering&&(this._onHandleShowPopup(e),this._hoverTimeout=void 0)}),200)}this.state.isHovering||this.setState({isHovering:!0})},this._onHoverEnd=e=>{this._popupDismissTimeout&&P.default.clearTimeout(this._popupDismissTimeout),this._popupDismissTimeout=P.default.setTimeout((()=>{this.state.isPopupHovered?this._popupDismissTimeout=void 0:this._closePopup()}),150)},this._closePopup=()=>{this._reactionsSummaryPopup&&this.state.enableReactionsHoverSummary&&(this._reactionsSummaryPopup.dismissPopup(),this._reactionsSummaryPopup=void 0),this._hoverTimeout&&(P.default.clearTimeout(this._hoverTimeout),this._hoverTimeout=void 0),this.state.isHovering?this.setState({isHovering:!1,isPopupHovered:!1}):this.setState({isPopupHovered:!1})},this._onKeyPress=e=>l.default.maybeHandleKeyPress(e,(()=>{this._onPress(e)})),this._onPress=(e,t=!1)=>{const s=k.default.newCauseId();if(p.log(h.LogTraceArea.ReactionsCountButton,"_onPress, causeId: "+s),!this.state.reactWithClickEnabled||this.state.isMyMessage||this.state.isKeyboardNav&&!t)this.state.popupOn||this._onHandleShowPopup(s),this._reactionsSummaryPopup=void 0;else{const e=new A.ReactionPickerTelemetry(this.props.message,A.ReactionOriginType.ReactionsSummary),t={message:this.props.message,reactionAction:{reaction:this.state.reactionNameWithoutTone,reactionTone:this.state.reactionTone,reactionLevel:0,reactionAdded:!this.state.currentUserReacted,isCustomReaction:!1}};b.addRemoveReactionFromMessage(t,e,(e=>{if(B.default.doesMessageHaveHint(this.props.message.cuid)){S.default.hintShownAndUsed();const e=u.default.getDefaultMessageHintObject();e.wasFeatureUsedByUser=!0,B.default.setMessagesHintData(f.MessageHintsTypes.TapOnReactionToReactTheSame,e)}this._onAddingReactionDone(e,this.state.reactionEmoticonName,this.state.currentUserReacted)})),this._closePopup()}e.stopPropagation()},this._onPressFromSummaryPopup=e=>{this._onPress(e,!0),this._iconButton&&this._iconButton.requestFocus()},this._onClosePopup=()=>{this.isComponentMounted()&&(this._iconButton&&this._iconButton.requestFocus&&this._iconButton.requestFocus(),this.setState({popupOn:!1}),this.props.onClose&&this.props.onClose())},this._onPopupMouseEnter=()=>{this.setState({isPopupHovered:!0})},this._onPopupMouseLeave=()=>{this._closePopup()}}_buildState(e,t){const s=c.default.getEmoticonByName(e.reaction.key),{reactionTone:i,reactionNameWithoutTone:o}=b.separateReactionNameAndTone(e.reaction.key),n=r.default.getS4LMessagingFeatures(),a={reactionEmoticonName:s&&s.description||e.reaction.key,enableReactionsHoverSummary:n.enableReactionsHoverSummary&&!e.isNewsChannel,isPopupHovered:!1,reactionTone:i,reactionNameWithoutTone:o,currentUserReacted:e.reaction.users.some((e=>y.default.isMyMri(e.mri))),reactionSummaryBorderColor:F.default.getModernizeColors(R.default.getColorInfo()),reactWithClickEnabled:n.enableReactWithClickOnSummary,isMyMessage:y.default.isMyMri(e.message.creator),isKeyboardNav:L.default.isNavigatingWithKeyboard()};return t&&(a.popupOn=!1,a.isHovering=!1),a.accessibilityLabel=d.getAccessibilityLabelForReaction(e.message.conversationId,e.reaction),a}render(){const e=[D.countContainer,D.countContainerView,D.countContainerOuterView,this.props.style],t=v.getFrameHeight(this.props.reactionSize||n.Size.Small)+10,s=o.Styles.createViewStyle({height:t,borderRadius:t/2},!1);e.push(s);let r,a,l=this.props.isNewsChannel?void 0:m.getString("ReactionsDetailsOverlayPanel.ReactionButtonTitle",{reactionName:this.state.reactionEmoticonName});this.state.reactWithClickEnabled&&!this.state.isMyMessage&&(l=this.state.currentUserReacted?m.getString("ReactionsDetailsOverlayPanel.ReactionSummaryButtonTitleRemove",{reactionName:this.state.reactionEmoticonName}):this.props.isNewsChannel?void 0:m.getString("ReactionsDetailsOverlayPanel.ReactionSummaryButtonTitleAdd",{reactionName:this.state.reactionEmoticonName})),this.props.reaction.users.length>99?r=m.getString("ReactionsDetailsOverlayPanel.ReactionCountOverflow",{countText:99}):(this.props.reaction.users.length>1||!this.props.suppressSingleCounts)&&(r=this.props.reaction.users.length.toString()),r&&(a=(0,i.jsx)(w.Caption,Object.assign({selected:this.state.currentUserReacted,style:[D.countText,this.props.textStyle]},{children:r})));let d=D.countContainerView;if(d=[d,D.desktopTransform],this.state.reactWithClickEnabled){if(r&&this.state.currentUserReacted){const t=o.Styles.createViewStyle({borderColor:this.state.reactionSummaryBorderColor,borderWidth:2},!1);e.push(t)}!this.state.isHovering||this.state.currentUserReacted||this.state.isMyMessage||e.push(o.Styles.createViewStyle({shadowRadius:1,shadowColor:M.Color.gray500},!1))}return(0,i.jsx)(o.Button,Object.assign({ref:this._onIconButtonRef,style:e,title:l,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,onPress:this._onPress,onKeyPress:this._onKeyPress,onLongPress:this.state.reactWithClickEnabled?this._onHoverStart:void 0,activeOpacity:.8,accessibilityLabel:this.state.accessibilityLabel,disabled:this.props.disableAction,disabledOpacity:1},{children:(0,i.jsxs)(o.View,Object.assign({style:d,onLayout:this._onLayout},{children:[(0,i.jsx)(n.AnimatedEmoticon,{size:this.props.reactionSize||n.Size.Small,innerText:l,emoticonName:this.state.reactionNameWithoutTone,isStatic:!(this.state.isHovering&&!this.state.popupOn),allowTextFallback:!0,standaloneAnimation:!0,preventSelectable:!0,tone:this.state.reactionTone}),a]}))}))}_onAddingReactionDone(e,t,s){let i="ReactionsMenu.YouReactedError";i=e?s?"ReactionsMenu.YouReacted":"ReactionsMenu.YouRemovedReaction":s?"ReactionsMenu.YouReactedError":"ReactionsMenu.YouRemovedReactionError",x.default.maybeAnnounceForAccessibility(m.getString(i,{reaction:t}))}_onHandleShowPopup(e){if(p.log(h.LogTraceArea.ReactionsCountButton,"_onHandleShowPopup, causeId: "+e),!this.state.popupOn){this.setState({popupOn:!0});this._showReactionSummaryPopup(e)&&(p.track(new _.ReactionsSummaryClickTelemetry(this.state.reactionEmoticonName,this.props.message,this.props.reaction.users.length)),this._markReactionsRead(this.props.message),this.props.onOpen&&this.props.onOpen())}}_showReactionSummaryPopup(e){p.log(h.LogTraceArea.ReactionsCountButton,"_showReactionSummaryPopup, causeId: "+e);const t=this.state.popupOn?void 0:new I.default(T.ScenarioName.ReactionsSummary);return t&&t.start(),this._reactionsSummaryPopup=new C.ReactionsSummaryPopup(this.props.message.conversationId,t,this.props.reaction,(()=>this._iconButton),this._getRootViewId(),this._getRootViewType(),this._onClosePopup,this._height,this.props.anchorPositionAnywhere,this.state.currentUserReacted,this.state.reactWithClickEnabled&&!this.state.isMyMessage,this._onPopupMouseEnter,this._onPopupMouseLeave,this._onPressFromSummaryPopup),this._reactionsSummaryPopup.show()}_markReactionsRead(e){!e.isReactionRead()&&this.state.isMyMessage&&a.markReactionsAsRead(e)}}t.ReactionCountButton=E},502989:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(217041),a=s(915877),l=s(117459),d=s(680837),c=s(46929),h=(0,a.lazyProperties)({listContainer:()=>n.Styles.createViewStyle({flexDirection:"row",marginLeft:-5}),listContainerNoMargin:()=>n.Styles.createViewStyle({marginLeft:0}),countContainerSpacing:()=>n.Styles.createViewStyle({marginLeft:5,marginBottom:2}),reactionContainerSpacing:()=>n.Styles.createViewStyle({marginLeft:5,marginRight:0,marginBottom:2})});class u extends r.ComponentBase{_buildState(e,t){const s={};t&&(s.postedByCurrentUser=!1);const i=this.props;return e.message?!t&&i.message&&e.message.properties===i.message.properties||(s.reactions=e.message.getReactions()):s.reactions=void 0,s}componentDidUpdate(e,t,s){var i;super.componentDidUpdate(e,t,s),t.reactions&&t.reactions.length>0&&!this.state.reactions&&(null===(i=e.message)||void 0===i?void 0:i.cuid)&&c.default.doesMessageHaveHint(e.message.cuid)&&c.default.invalidateHintMessage(e.message.cuid)}render(){if(!this.state.reactions||0===this.state.reactions.length||!this.props.message)return null;const e=[h.listContainer,this.props.style,this.props.isNewsChannel?h.listContainerNoMargin:void 0],t=this.props.message,s=o.map(this.state.reactions,(e=>{const s=[];return this.props.showShadows&&s.push(d.default.shadowLightStyle),this.props.itemStyle&&s.push(this.props.itemStyle),this.props.countItemSpacing?s.push(this.props.countItemSpacing):s.push(this.props.isNewsChannel?h.reactionContainerSpacing:h.countContainerSpacing),(0,i.jsx)(l.ReactionCountButton,{style:s,message:t,reaction:e,reactionSize:this.props.reactionSize,textStyle:this.props.itemTextStyle,onOpen:this.props.onOpen,onClose:this.props.onClose,anchorPositionAnywhere:this.props.anchorPositionAnywhere,disableAction:this.props.disableAction,suppressSingleCounts:this.props.suppressSingleCounts,isNewsChannel:this.props.isNewsChannel},e.key)}));let r;if(o.isNumber(this.props.constrainedWidth)){r=n.Styles.createViewStyle({maxWidth:this.props.constrainedWidth},!1);const t=n.Styles.createViewStyle({minWidth:this.props.constrainedWidth-5,maxWidth:this.props.constrainedWidth-5},!1);e.push(t)}return(0,i.jsx)(n.View,Object.assign({style:[r,...e]},{children:s}))}}t.default=u},638693:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(297775),r=s(662602),a=s(677381),l=s(746096),d=s(913944),c=s(436237),h=s(915877),u=s(733754),p=s(932226),g=s(459713),m=s(146122),S=s(415963),f=s(886045),y=s(581760),v=s(711828),C=s(794050),_=s(988523),b=(0,h.lazyProperties)({reactionButton:()=>o.Styles.createViewStyle({paddingVertical:5,paddingHorizontal:5,width:30,alignItems:"center",justifyContent:"flex-start"})});class T extends a.default{constructor(){super(...arguments),this._onIconButtonRef=e=>{this._iconButton=e||void 0},this._onReactKeyPress=e=>r.default.maybeHandleKeyPress(e,(()=>{this._onReactClick(e)})),this._onReactClick=e=>{const t=()=>this._iconButton,s=this.props.message();let i;if(f.default.isMobileScreenReaderEnabled()){const e=new C.default(S.ScenarioName.ShowReactionsMenu);e.start(),c.log(l.LogTraceArea.ReactionIconButton,"_onReactClick - showing accessability menu.");new g.default(s).showReactionActionSheet(t,this._getRootViewId()),i=!0,e.finish()}else{const e=this.state.popupOn?void 0:new C.default(S.ScenarioName.ShowReactionsMenu);e&&e.start(),c.log(l.LogTraceArea.ReactionIconButton,"_onReactClick - showing normal menu.");i=new m.ReactionsMenuPopup(s,e,t,this._getRootViewId(),this._getRootViewType(),this._onClosePopup,this.props.onReactionSelected,this.props.keepOpenAfterReactionSelected,this.props.hideAlternateReactionPacks,this.props.anchorOffset).show()}i&&(this.setState({popupOn:!0}),this.props.onOpen&&this.props.onOpen()),this._trackSearchSuccessTelemetry(),e.stopPropagation()},this._onClosePopup=()=>{c.log(l.LogTraceArea.ReactionIconButton,"_onClosePopup"),this.isComponentMounted()&&(this.setState({popupOn:!1}),this._iconButton&&this._iconButton.requestFocus&&this._iconButton.requestFocus(),this.props.onClose&&this.props.onClose())}}_buildState(e,t){const s={isConnected:p.default.isConnected()};return t&&(s.popupOn=!1),s}render(){const e=this.props.colorOverride||y.Color.gray300,t=this.props.sizeOverride||v.IconSize.size20,s=!this.state.isConnected||!this.props.isMessageKnownByServer;s&&(this.state.isConnected?this.props.isMessageKnownByServer?c.log(l.LogTraceArea.ReactionIconButton,"ReactionButton disabled due to other reasons."):c.log(l.LogTraceArea.ReactionIconButton,"ReactionButton disabled due to version unknown by server."):c.log(l.LogTraceArea.ReactionIconButton,"ReactionButton disabled due to unavailable network."));const o=[b.reactionButton,this.props.style],r={ref:this._onIconButtonRef,style:o,title:u.getString("StreamItem.ReactButtonTitle"),key:"reactionsIcon",onPress:this.props.disableAction?void 0:this._onReactClick,onKeyPress:this.props.disableAction?void 0:this._onReactKeyPress,size:t,color:e,hoverColor:e,icon:this.props.isNewsChannel?v.SkypeIcon.ReactionAdd:v.SkypeIcon.EmoticonStroke,disabled:s,tabIndex:0,showHoverEffect:!0,importantForAccessibility:this.props.importantForAccessibility};return this.props.coachMarkType?(0,i.jsx)(n.default.IconButton,Object.assign({},r,{coachMarkType:this.props.coachMarkType,anchorAccessibilityLabel:u.getString("StreamItem.ReactButtonTitle")})):(0,i.jsx)(d.default,Object.assign({},r))}_trackSearchSuccessTelemetry(){_.messageActionDone(this.props.message().conversationId)}}t.default=T},417270:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(705465),n=s(667294),r=s(512193);t.default=(0,n.memo)((({didUserSelect:e})=>{const{emoticonStyle:t}=(0,r.useSkypeStyles)((({themeColors:{iconDisabled:t}})=>({emoticonStyle:{alignSelf:"center",width:4,height:4,backgroundColor:e?t:void 0,borderRadius:2}})),[e]);return(0,i.jsx)(o.View,{style:t})}))},459713:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(889391),n=s(82433),r=s(746096),a=s(436237),l=s(733754),d=s(18078),c=s(382677),h=s(317219),u=s(346200),p=s(886045),g=s(293194),m="more",S="previous";t.default=class{constructor(e){if(this._currentUserReactions=[],this._onActionButtonPress=(e,t,s)=>{const i=()=>{const t=e();t&&t.requestFocus&&t.requestFocus()};switch(s){case m:this._currentPackIndex++,this._showActionMenu(e,t);break;case S:this._currentPackIndex--,this._showActionMenu(e,t);break;case g.SXActionMenuCancel:case"cancel":a.track(this._reactionMenu),i();break;default:this._addOrRemoveReaction(s),i()}},this._message=e,this._reactionPack=o.default.getS4LMessagingFeatures().reactionPacks,i.isEmpty(this._reactionPack))return void a.warn(r.LogTraceArea.ReactionsActionSheet,"ReactionPack is empty");const t=d.default.getSkypeMri();this._currentUserReactions=i.filter(e.getReactions(),(e=>i.some(e.users,(e=>e.mri===t)))),this._currentPackIndex=0}showReactionActionSheet(e,t){this._showActionMenu(e,t),this._reactionMenu=new u.ReactionPickerTelemetry(this._message,u.ReactionOriginType.ReactionsActionSheet)}_showActionMenu(e,t){const s=[];i.each(this._reactionPack[this._currentPackIndex],(e=>{s.push({text:this._getEmoticonName(e),command:e})})),0!==this._currentPackIndex&&s.push({text:l.getString("Global.PreviousButtonTitle"),command:S}),this._currentPackIndex!==this._reactionPack.length-1&&s.push({text:l.getString("Global.MoreButtonTitle"),command:m}),g.default.showWithActionMenuConfig({options:{anchor:e,buttons:s},callback:s=>this._onActionButtonPress(e,t,s),rootViewId:t,invokingEvent:void 0})}_getEmoticonName(e){const t=n.default.getEmoticonByNameNoSubscription(e);return t&&t.description||e}_addOrRemoveReaction(e){const t={message:this._message,reactionAction:{reaction:e,reactionLevel:this._currentPackIndex,reactionAdded:!1,isCustomReaction:(0,h.default)().isCustomReaction(e)}},s=this._getEmoticonName(e);i.some(this._currentUserReactions,(t=>t.key===e))?(a.log(r.LogTraceArea.ReactionsActionSheet,"Removing the selected reaction",e),c.addRemoveReactionFromMessage(t,this._reactionMenu,(e=>{const t=e?"ReactionsMenu.YouRemovedReaction":"ReactionsMenu.YouRemovedReactionError";p.default.maybeAnnounceForAccessibility(l.getString(t,{reactionName:s}))}))):(a.log(r.LogTraceArea.ReactionsActionSheet,"Adding the selected reaction",e),t.reactionAction.reactionAdded=!0,c.addRemoveReactionFromMessage(t,this._reactionMenu,(e=>{const t=e?"ReactionsMenu.YouReacted":"ReactionsMenu.YouReactedError";p.default.maybeAnnounceForAccessibility(l.getString(t,{reactionName:s}))})))}}},146122:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsMenuPopup=void 0;const i=s(785893),o=s(516778),n=s(889391),r=s(733754),a=s(948133),l=s(917795),d=s(640363);class c extends l.default{constructor(e,t,s,i,o,n,r,a,l,d=0){super(s,(()=>{n&&n(),this._hidden=!0}),i,o),this._message=e,this._scenario=t,this._onReactionSelected=r,this._keepOpenAfterReactionSelected=a,this._hideAlternateReactionPacks=l,this._anchorOffsetOverride=d,this._hidden=!1,this._instanceId=c._instanceCounter++}_overrideAnchorOffset(e){return e+(this._anchorOffsetOverride||0)*(d.default.isRTL()?-1:1)}_getPopupId(){return c.popupId}_getAccessibilityTitle(){return r.getString("AccessibilityLabel.Reactions")}_isCacheable(){return n.default.getS4LMessagingFeaturesNoSubscription().enableCacheableReactionPopup}_getContainerStyle(){return o.Styles.createViewStyle({marginRight:4},!1)}_getPopupWidth(e){return e-4}_getPopupContent(e,t,s,o){return(0,i.jsx)(a.ReactionsPopupMenu,{message:this._message,scenario:this._scenario,onClose:this.dismissPopup,keepOpenAfterReactionSelected:this._keepOpenAfterReactionSelected,hideAlternateReactionPacks:this._hideAlternateReactionPacks,onReactionSelected:this._onReactionSelected,hidden:this._hidden,instanceId:this._instanceId,rootViewId:this._rootViewId})}}c._instanceCounter=0,c.popupId="reactionsMenuPopup",t.ReactionsMenuPopup=c},948133:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsPopupMenu=void 0;const i=s(785893),o=s(496486),n=s(583367),r=s(516778),a=s(809206),l=s(934339),d=s(462033),c=s(118644),h=s(884912),u=s(82433),p=s(746096),g=(s(812854),s(584876)),m=s(913944),S=s(436237),f=s(861253),y=s(172490),v=s(915877),C=s(733754),_=s(795133),b=s(788952),T=s(706250),M=s(18078),I=s(345087),w=s(734102),P=s(382677),k=s(317219),A=s(346200),x=s(29130),R=s(451070),O=s(886045),L=s(581760),F=s(711828),B=s(680837),D=s(24576),E=s(46929),V=l.Size.Large,N=l.Size.Medium,U=(0,v.lazyProperties)({panel:()=>r.Styles.createViewStyle({alignSelf:"center",alignItems:"stretch",justifyContent:"center",backgroundColor:L.Color.transparent,marginHorizontal:4,maxWidth:420,overflow:"visible"}),panelNavigation:()=>r.Styles.createViewStyle({overflow:"hidden"}),scrollPanel:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"flex-end",overflow:"visible"}),viewContainer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"stretch",justifyContent:"center",overflow:"hidden",alignSelf:"stretch"}),emoticonContainer:()=>r.Styles.createViewStyle({flex:0,flexDirection:"row",alignItems:"stretch",justifyContent:"space-around",overflow:"visible"}),emoticonContainerNavigation:()=>r.Styles.createViewStyle({justifyContent:"flex-start",alignContent:"center"}),scrollContainer:()=>r.Styles.createViewStyle({flex:0,overflow:"hidden",alignSelf:"center",alignContent:"center"}),panelMargin:()=>r.Styles.createViewStyle({marginHorizontal:30}),emoticon:()=>r.Styles.createViewStyle({flex:0,height:80,width:56,alignItems:"center",justifyContent:"center",overflow:"visible"}),defaultEmoticonForRN:()=>r.Styles.createViewStyle({width:53}),smallEmoticonForRN:()=>r.Styles.createViewStyle({height:64,width:44}),emoticonStyle:()=>r.Styles.createViewStyle({paddingTop:11,paddingBottom:5}),emoticonSelectedPlaceholder:()=>r.Styles.createViewStyle({alignSelf:"center",width:6,height:6}),emoticonSelected:()=>r.Styles.createViewStyle({backgroundColor:L.Color.blue,borderRadius:6}),navigationButtonContainer:()=>r.Styles.createViewStyle({flex:0,overflow:"visible",position:"absolute",top:0,bottom:0,justifyContent:"center"}),viewPageIndicator:()=>r.Styles.createViewStyle({flexDirection:"column",justifyContent:"space-around",alignItems:"stretch",paddingBottom:10}),nextButton:()=>r.Styles.createButtonStyle({right:10}),prevButton:()=>r.Styles.createButtonStyle({left:10}),scrollViewRTL:()=>r.Styles.createViewStyle({flexDirection:"row-reverse",transform:[{scaleX:-1}]}),customReactionsPanelButton:()=>r.Styles.createButtonStyle({position:"absolute",right:-8,bottom:-10,padding:5,borderRadius:15})});class j extends D.default{constructor(){super(...arguments),this._mountedRefsMap=new T.default,this._scrollViewFiredInitialLayout=!1,this._eventTracked=!1,this._isInitialized=!1,this._lastInstanceId=0,this._onClick=(e,t)=>{S.log(p.LogTraceArea.ReactionsPopupMenu,"_onClick - selectedReaction",t),this.state.isAnimatingPress||this.setState({isAnimatingPress:!0,selectedReactionKey:t})},this._onHoverStart=(e,t)=>{this.setState({hoverItem:t})},this._onHoverEnd=(e,t)=>{this.setState({hoverItem:void 0})},this._onScrollViewRef=e=>{this._scrollView=e||void 0},this._onScrollViewLayout=e=>{this._scrollViewFiredInitialLayout||(this._scrollViewFiredInitialLayout=!0,this._scrollView&&void 0!==this._scrollViewPendingScrollAmount&&(this._scrollView.setScrollLeft(this._scrollViewPendingScrollAmount,!1),this._scrollViewPendingScrollAmount=void 0))},this._onScroll=(e,t)=>{var s;const i=o.clamp(Math.ceil(Math.floor(t)/this._reactionContainerWidth),0,this.state.reactionPacks.length-1);i!==this.state.currentPack&&(this.setState({currentPack:i}),this._scrollingDueToArrowClick?this._scrollingDueToArrowClick=!1:null===(s=this._openReactionMenuTelemetry)||void 0===s||s.recordUserAction(A.ReactionNavigationAction.Swipe))},this._isEmoticonFake=e=>!e,this._showPrevious=()=>{this._onNextButtonPress(!1)},this._showNext=()=>{this._onNextButtonPress(!0)},this._onBack=()=>(this._close(),S.log(p.LogTraceArea.HardwareBackButton,"goBack: true componentId: ReactionsPopupMenu"),!0),this._onEscape=()=>(this._close(),!0),this._setInitialScroll=e=>{this._scrollView&&this._scrollViewFiredInitialLayout?this._scrollView.setScrollLeft(e,!1):this._scrollViewPendingScrollAmount=e},this._reactionsToPackages=e=>{const t=e.length%6;if(t){const s=o.fill(Array(6-t),"");e=o.concat(e,s)}return o.chunk(e,6)}}_buildState(e,t){const s={},i=this._getRootViewId();if(e.hidden&&!t)return s;if(this._isInitialized&&e.instanceId!==this._lastInstanceId&&this._uninitialize(),this._lastInstanceId=e.instanceId,s.width=x.default.getWidth(i),s.deviceOrientation=x.default.getDeviceOrientation(i),s.isMobileScreenSize=x.default.isMobileScreenSize(i),s.reactionPacks=this._reactionsToPackages((0,k.default)().getCustomReactions()),s.shouldAdjustScrollPosition=R.default.hasNonZeroSafeAreaInsets(),s.emoticonWidth=56,this._reactionContainerStyle=[U.panel],a.default.isMobile()){const e=53*s.reactionPacks[0].length;if(s.emoticonWidth=s.width-8<e?44:53,s.isMobileScreenSize&&s.deviceOrientation===n.DeviceOrientation.Portrait){const e=s.width-8,t=r.Styles.createViewStyle({maxWidth:e},!1);this._reactionContainerStyle.push(t)}this._reactionContainerStyle.push(U.panelNavigation)}else!this._isInitialized&&x.default.isMinDesktopWidth(i)&&(s.emoticonWidth=44),this._isInitialized&&(s.emoticonWidth=this.state.emoticonWidth);if(t||!this._isInitialized){s.currentPack=0,s.selectedReactionKey="";const i=e.message.getReactions(),n=M.default.getSkypeMri();if(s.userReactions=o.filter(i,(e=>o.some(e.users,(e=>e.mri===n)))),s.userReactions.length>0)for(let e=0;e<s.reactionPacks.length;e++){const t=s.reactionPacks[e],i=P.getReactionName(s.userReactions[0].key);if(t.indexOf(i)>=0){s.currentPack=e;break}}e.hidden||(e.scenario&&e.scenario.markStepCompleted("BuiltSate",void 0,void 0,!0),t||this._initialize(e,o.merge(this.state,s)))}return S.log(p.LogTraceArea.ReactionsPopupMenu,"Built state with reactionPacks: "+JSON.stringify(s.reactionPacks)+" currentPack: "+s.currentPack),s}_getEmoticonName(e){const t=u.default.getEmoticonByNameNoSubscription(e);return t&&t.description||e}_onRemovingReactionDone(e,t){let s="ReactionsMenu.YouRemovedReactionError";const i=this._getEmoticonName(t);if(e&&(s="ReactionsMenu.YouRemovedReaction",this.isComponentMounted())){const e=o.filter(this.state.userReactions,(e=>e.key!==t));this.setState({userReactions:e})}O.default.maybeAnnounceForAccessibility(C.getString(s,{reactionName:i}))}_onAddingReactionDone(e,t){let s="ReactionsMenu.YouReactedError";const i=this._getEmoticonName(t);if(e&&(s="ReactionsMenu.YouReacted",this.isComponentMounted())){const e=[...this.state.userReactions,{key:t,users:[{mri:M.default.getSkypeMri(),time:Date.now()}]}];this.props.onReactionSelected&&this.props.onReactionSelected(t),this.setState({userReactions:e})}O.default.maybeAnnounceForAccessibility(C.getString(s,{reactionName:i}))}_completeClick(e){const t=P.separateReactionNameAndTone(e),s={message:this.props.message,reactionAction:{reaction:t.reactionNameWithoutTone,reactionLevel:this.state.currentPack,reactionAdded:!1,isCustomReaction:(0,k.default)().isCustomReaction(e),reactionTone:t.reactionTone}};this._eventTracked=!0,o.some(this.state.userReactions,(t=>t.key===e))?(S.log(p.LogTraceArea.ReactionsPopupMenu,"Removing the selected reaction",e),P.addRemoveReactionFromMessage(s,this._openReactionMenuTelemetry,(t=>this._onRemovingReactionDone(t,e)))):(S.log(p.LogTraceArea.ReactionsPopupMenu,"Adding the selected reaction",e),s.reactionAction.reactionAdded=!0,P.addRemoveReactionFromMessage(s,this._openReactionMenuTelemetry,(t=>{if(a.default.isMobile()&&E.default.doesMessageHaveHint(s.message.cuid)&&"yes"===s.reactionAction.reaction){_.default.hintShownAndUsed();const e=g.default.getDefaultMessageHintObject();e.wasFeatureUsedByUser=!0,E.default.setMessagesHintData(b.MessageHintsTypes.DoubleTapMessageToLike,e)}this._onAddingReactionDone(t,e)}))),this.setState({isAnimatingPress:!1}),this.props.keepOpenAfterReactionSelected||this._close()}_renderReactionContainer(){let e,t,s,n=[];this.state.reactionPacks.length>0&&(this._numberOfReactionsPerPack=this.state.reactionPacks[0].length);for(let e=0;e<this.state.reactionPacks.length;e++){const t=this._getEmoticonReactionsForPack(this.state.reactionPacks[e],e);n=n.concat(t)}this._numberOfReactions=n.length,this._reactionContainerWidth=this._numberOfReactionsPerPack*this.state.emoticonWidth;const l=[U.viewContainer],d=[U.emoticonContainer,U.emoticonContainerNavigation];let c=this.state.emoticonWidth*this._numberOfReactions;const h=a.default.isMobile(),u=!h;u&&(c+=30),d.push(r.Styles.createViewStyle({width:c},!1));const p=this._getContext().isRTL;if(u){const e=p?F.SkypeIcon.NavigationForward:F.SkypeIcon.NavigationBack,o=p?F.SkypeIcon.NavigationBack:F.SkypeIcon.NavigationForward;t=(0,i.jsx)(r.Animated.View,Object.assign({style:[U.navigationButtonContainer,U.prevButton],onPress:this._showPrevious},{children:(0,i.jsx)(m.default,{size:20,onPress:this._showPrevious,color:L.Color.gray300,hoverColor:L.Color.gray100,icon:e,title:C.getString("Global.PreviousButtonTitle"),disabled:0===this.state.currentPack})}),"mouseControlsLeft"),s=(0,i.jsx)(r.Animated.View,Object.assign({style:[U.navigationButtonContainer,U.nextButton],onPress:this._showNext},{children:(0,i.jsx)(m.default,{size:20,onPress:this._showNext,color:L.Color.gray300,hoverColor:L.Color.gray100,icon:o,title:C.getString("Global.NextButtonTitle"),disabled:this.state.currentPack===this.state.reactionPacks.length-1})}),"mouseControlsRight")}else{let t=0;const s=o.map(this.state.reactionPacks,(e=>({uid:(t++).toString()})));e=(0,i.jsx)(I.default,{currentPage:this.state.currentPack,pages:s,indicatorDotSize:10,indicatorMargin:1,maxIndicators:10}),l.push(U.viewPageIndicator)}const g=r.Styles.createViewStyle({width:h?this._reactionContainerWidth:this._reactionContainerWidth+30},!1),S=[U.scrollContainer,g];this._reverseLayout()&&S.push(U.scrollViewRTL);let f=(0,i.jsx)(r.ScrollView,Object.assign({ref:this._onScrollViewRef,style:S,pagingEnabled:!0,horizontal:h,showsHorizontalScrollIndicator:!1,showsVerticalScrollIndicator:!1,keyboardShouldPersistTaps:!0,vertical:!1,onScroll:this._onScroll,scrollEnabled:h,onLayout:this._onScrollViewLayout,ignoreRTL:!0},{children:(0,i.jsx)(r.View,Object.assign({style:d},{children:n}))}));return u&&(f=(0,i.jsx)(r.View,Object.assign({style:[U.scrollPanel,U.panelMargin]},{children:f}))),(0,i.jsxs)(r.View,Object.assign({style:l},{children:[t,f,s,e]}))}_reverseLayout(){return!1}_onNextButtonPress(e){var t;this._scrollingDueToArrowClick=!0,null===(t=this._openReactionMenuTelemetry)||void 0===t||t.recordUserAction(A.ReactionNavigationAction.ArrowNavigation);const s=e?1:-1,i=(this.state.currentPack+s)*this._reactionContainerWidth;this._scrollView&&i>=0&&i<this._numberOfReactions*this.state.emoticonWidth&&this._scrollView.setScrollLeft(i,!0)}_getEmoticonReactionsForPack(e,t){return o.map(e,((e,s)=>{const n=e,d=P.separateReactionNameAndTone(n),c=o.some(this.state.userReactions,(e=>n===e.key)),h=[U.emoticonSelectedPlaceholder];c&&h.push(U.emoticonSelected);let u=w.ReactionButtonSelectionState.NotSelected;this.state.hoverItem&&this.state.hoverItem===n&&(u=w.ReactionButtonSelectionState.Selected);const p=u===w.ReactionButtonSelectionState.Selected,g=[U.emoticon];let m=V;this.state.emoticonWidth<53?(g.push(U.smallEmoticonForRN),m=N):this.state.emoticonWidth<56&&g.push(U.defaultEmoticonForRN);const S=this._getEmoticonName(d.reactionNameWithoutTone);let f=S;c&&(f+=", "+C.getString("Global.SelectedAccessibilityLabel"));const y=a.default.isMobile()?l.Size.Large:l.Size.ExtraLarge;return(0,i.jsxs)(r.View,Object.assign({style:g,ignorePointerEvents:!0},{children:[!this._isEmoticonFake(n)&&(0,i.jsx)(w.ReactionButton,{ref:this._mountedRefsMap.onComponentRef(n),title:S,animateEmoticon:p||c,size:y,renderSize:m,reactionName:d.reactionNameWithoutTone,style:U.emoticonStyle,onPress:this._onClick,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,selectionState:u,accessibilityLabel:f,tone:d.reactionTone}),(0,i.jsx)(r.View,{style:h})]}),"reactionButton"+t.toString()+s.toString())}))}_close(){this.props.onClose&&this.props.onClose()}_initialize(e,t){if(d.default.subscribe(this._onBack),y.default.addEscapeHandler(this._onEscape),this._scrollView){const e=t.currentPack*this._reactionContainerWidth;t.shouldAdjustScrollPosition?o.delay(this._setInitialScroll,100,e):t.currentPack>0&&o.defer(this._setInitialScroll,e)}this._openReactionMenuTelemetry=new A.ReactionPickerTelemetry(e.message,A.ReactionOriginType.ReactionsPopupMenu),e.scenario&&!e.scenario.isResolved()&&e.scenario.finish(),this._isInitialized=!0}_uninitialize(){d.default.unsubscribe(this._onBack),y.default.removeEscapeHandler(this._onEscape),this._eventTracked||S.track(this._openReactionMenuTelemetry),this._isInitialized=!1}componentDidMount(){super.componentDidMount(),this.props.hidden||this._initialize(this.props,this.state)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),(0,f.default)(this.state.deviceOrientation,t.deviceOrientation)||(S.log(p.LogTraceArea.ReactionsPopupMenu,"Closing due to orientation change"),this._close())}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),this.props.hidden&&this._isInitialized&&(this._uninitialize(),o.defer(this._setInitialScroll,0)),!t.isAnimatingPress&&this.state.isAnimatingPress){const e=this.state.selectedReactionKey,t=this._mountedRefsMap.ref(e);t&&this.state.hoverItem!==e?t.animatePress((()=>{this._completeClick(e)})):this._completeClick(e)}}componentWillUnmount(){super.componentWillUnmount(),this._isInitialized&&this._uninitialize()}render(){return(0,i.jsxs)(r.View,Object.assign({style:B.default.overflowVisible},{children:[(0,i.jsx)(r.View,Object.assign({style:this._reactionContainerStyle},{children:this._renderReactionContainer()})),(0,i.jsx)(c.default,{styles:U.customReactionsPanelButton,origin:h.CustomReactionsType.Message})]}))}}t.ReactionsPopupMenu=j},560160:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsPopupSummary=t.EmoticonHeight=void 0;const i=s(785893),o=s(496486),n=(s(583367),s(396265)),r=s(516778),a=s(934339),l=s(462033),d=s(481169),c=s(677381),h=s(952262),u=s(746096),p=s(436237),g=s(861253),m=s(172490),S=s(915877),f=s(18078),y=s(104735),v=s(758962),C=s(346200),_=s(382677),b=s(29130),T=s(914976),M=s(235108),I=s(581760),w=s(680837),P=(s(912770),s(853374)),k=s(73877);t.EmoticonHeight=v.frameHeights.emoticons.Size80;const A=12,x=(0,S.lazyProperties)({panel:()=>r.Styles.createViewStyle({alignSelf:"center",alignItems:"stretch",justifyContent:"center",backgroundColor:I.Color.transparent,borderRadius:10,height:t.EmoticonHeight,marginHorizontal:4,maxWidth:420,overflow:"hidden"}),emoticonHeaderTop:()=>r.Styles.createViewStyle({top:0}),emoticonHeaderBottom:()=>r.Styles.createViewStyle({bottom:0}),emoticonHeader:()=>r.Styles.createViewStyle({justifyContent:"center",alignItems:"center",height:v.frameHeights.emoticons.Size80,position:"absolute",left:0,right:0,flex:1,width:300}),virtualListContainer:()=>r.Styles.createViewStyle({paddingTop:A,paddingHorizontal:A,paddingBottom:A,flex:1,overflow:"hidden"}),virtualListContainerTop:()=>r.Styles.createViewStyle({paddingTop:t.EmoticonHeight}),virtualListContainerBottom:()=>r.Styles.createViewStyle({paddingBottom:t.EmoticonHeight})});class R extends c.default{constructor(){super(...arguments),this._animatedOpacityValue=new r.Animated.Value(0),this._animatedOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue}),this._onBack=()=>{const e=this._close();return p.log(u.LogTraceArea.HardwareBackButton,"goBack: "+e+" componentId: ReactionsPopupSummary"),e},this._onEscape=()=>(this._close(),!0),this._renderItem=e=>{let t,s="";return f.default.isMyMri(e.key)||(t=w.default.pointerCursor,s=e.displayName),(0,i.jsx)(M.default,{conversationId:this.props.conversationId,displayName:e.displayName,style:t,userMri:e.key,showMeLabel:!0,onItemPress:this._onPress,buttonTitle:s})},this._onVirtualListViewRef=e=>{this._virtualListView=e||void 0},this._onSummaryHeaderRef=e=>{this._summaryHeader=e||void 0},this._onHeaderPress=e=>{this._close(),this.props.onPress&&this.props.onPress(e)},this._onPress=e=>{const t=P.default.newCauseId();p.log(u.LogTraceArea.ReactionsPopupSummary,"_onPress - mri: "+T.mriOrId(e)+" causeId: "+t),f.default.isMyMri(e)||(this._close(),p.track(new C.ReactionPanelListItem(this.props.reaction.key,this.props.conversationId,this.props.reaction.users.length)),y.default.showDetailsPanelWithParams({mri:e,causeId:t,rootViewId:this._getRootViewId()}))}}_buildState(e,t){const s={},i=this._getRootViewId();s.width=Math.min(b.default.getWidth(i),300),s.maxHeight=402.3,s.deviceOrientation=b.default.getDeviceOrientation(i),s.isMobileScreenSize=b.default.isMobileScreenSize(i);const n=this.props;if(t||e.reaction!==n.reaction){const i=[];if(e.reaction.users.length>0){const t=(0,d.chain)(e.reaction.users,(0,d.map)((t=>({mri:t.mri,displayName:h.default.getMemberShortNameForConversation(e.conversationId,t.mri)}))),(0,d.sortBy)((e=>e.displayName)),(0,d.compact)());o.each(t,(e=>{i.push({key:e.mri,displayName:e.displayName,height:44,template:"convo",accessibilityTrait:r.Types.AccessibilityTrait.Button})}))}s.virtualListViewItemInfo=i,t&&e.scenario&&e.scenario.markStepCompleted("BuildSate",void 0,void 0,!0)}return s}_close(){return this.props.onClose&&this.props.onClose(),!0}componentDidMount(){super.componentDidMount(),l.default.subscribe(this._onBack),m.default.addEscapeHandler(this._onEscape),this._summaryHeader&&this._summaryHeader.requestFocus(),this.state.virtualListViewItemInfo.length&&this._maybeScrollToTop(),this.props.scenario&&this.props.scenario.finish()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),(0,g.default)(this.state.virtualListViewItemInfo,t.virtualListViewItemInfo)||this._maybeScrollToTop()}componentWillUnmount(){super.componentWillUnmount(),l.default.unsubscribe(this._onBack),m.default.removeEscapeHandler(this._onEscape)}render(){const e=[x.panel],t=this._computeHeight();e.push(r.Styles.createViewStyle({width:this.state.width,height:t},!1));const s=[x.emoticonHeader],o=[x.virtualListContainer,this._animatedOpacityStyle];"top"===this.props.anchorPosition?(o.push(x.virtualListContainerTop),s.push(x.emoticonHeaderTop)):(s.push(x.emoticonHeaderBottom),o.push(x.virtualListContainerBottom));const{reactionTone:l,reactionNameWithoutTone:d}=_.separateReactionNameAndTone(this.props.reaction.key);return(0,i.jsxs)(r.View,Object.assign({style:e,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave},{children:[(0,i.jsx)(r.Button,Object.assign({style:s,ref:this._onSummaryHeaderRef,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,onPress:this._onHeaderPress},{children:(0,i.jsx)(a.AnimatedEmoticon,{size:a.Size.ExtraLarge,innerText:d,emoticonName:d,isStatic:!1,standaloneAnimation:!0,tone:l},d)})),(0,i.jsx)(r.Animated.View,Object.assign({style:o},{children:(0,i.jsx)(n.VirtualListView,{ref:this._onVirtualListViewRef,itemList:this.state.virtualListViewItemInfo,renderItem:this._renderItem,animateChanges:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0})}))]}))}_computeHeight(){const e=44*this.props.reaction.users.length+10+t.EmoticonHeight+A;let s;if(e>this.state.maxHeight)s=this.state.maxHeight;else{const i=k.default.measureWindow(this._getRootViewId()).height-t.EmoticonHeight-this.props.anchorHeight;e>i&&(s=i)}if(s){return 44*(Math.floor((s-t.EmoticonHeight-A)/44)+.45)+t.EmoticonHeight+A}return e}_maybeScrollToTop(){this._animatedOpacityValue.setValue(1)}}t.ReactionsPopupSummary=R,t.default=R},425765:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsSummaryPopup=void 0;const i=s(785893),o=s(733754),n=s(560160),r=s(917795);class a extends r.default{constructor(e,t,s,i,o,n,r,a,l,d,c,h,u,p){super(i,r,o,n),this._conversationId=e,this._scenario=t,this._reaction=s,this._callerHeight=a,this._anchorPositionAnywhere=l,this._reactedByCurrentUser=d,this._showReactWithClickOption=c,this._onMouseEnter=h,this._onMouseLeave=u,this._onPress=p}_getPaddingInPopupCanvas(){return n.EmoticonHeight/2}_getPopupId(){return a.popupId}_getAccessibilityTitle(){return this._showReactWithClickOption?this._reactedByCurrentUser?o.getString("AccessibilityLabel.ReactionsSummaryRemoveReaction",{reactionName:this._reaction.key}):o.getString("AccessibilityLabel.ReactionsSummaryAddReaction",{reactionName:this._reaction.key}):o.getString("ReactionsDetailsOverlayPanel.ReactionButtonTitle",{reactionName:this._reaction.key})}_getPopupContent(e,t,s,o){return(0,i.jsx)(n.ReactionsPopupSummary,{conversationId:this._conversationId,scenario:this._scenario,reaction:this._reaction,onClose:this.dismissPopup,anchorPosition:e,anchorHeight:this._callerHeight,anchorPositionAnywhere:this._anchorPositionAnywhere,reactedByCurrentUser:this._reactedByCurrentUser,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,onPress:this._onPress})}}a.popupId="reactionsSummaryPopup",t.ReactionsSummaryPopup=a},123281:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReadReceiptsPopup=void 0;const i=s(785893),o=s(733754),n=s(659526),r=s(917795);class a extends r.default{constructor(e,t,s,i,o,n){super(s,i,o,n),this._conversationId=e,this._readReceiptsSum=t}_getPopupId(){return a.popupId}_getAccessibilityTitle(){return o.getString("StreamItem.ReadByPopupAccessibilityTitle")}_getPopupContent(e,t,s,o){return(0,i.jsx)(n.default,{conversationId:this._conversationId,readReceiptsSum:this._readReceiptsSum,onClose:this.dismissPopup,anchorPosition:e})}}a.popupId="readReceiptsPopup",t.ReadReceiptsPopup=a},659526:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=(s(583367),s(396265)),n=s(516778),r=s(462033),a=s(671830),l=s(677381),d=s(952262),c=s(746096),h=s(436237),u=s(861253),p=s(172490),g=s(915877),m=s(733754),S=s(104735),f=s(29130),y=s(235108),v=s(581760),C=s(619675),_=s(853374),b=s(73877),T=(0,g.lazyProperties)({container:()=>n.Styles.createViewStyle({alignSelf:"center",alignItems:"stretch",justifyContent:"center",backgroundColor:v.Color.transparent,padding:12,overflow:"hidden"}),headlineText:()=>n.Styles.createTextStyle({color:v.Color.white,paddingBottom:18,height:33}),virtualList:()=>n.Styles.createViewStyle({flex:1,overflow:"hidden"})});class M extends l.default{constructor(){super(...arguments),this._onBack=()=>{const e=this._close();return h.log(c.LogTraceArea.HardwareBackButton,"goBack: "+e+" componentId: ReadReceiptsSummary"),e},this._onEscape=()=>(this._close(),!0),this._renderItem=e=>(0,i.jsx)(y.default,{displayName:e.displayName,userMri:e.key,timestamp:e.timestamp,buttonTitle:e.displayName,onItemPress:this._onPress}),this._onPress=e=>{const t=_.default.newCauseId();h.log(c.LogTraceArea.Navigation,"ReadReceiptsSummary._onPress, causeId: "+t),S.default.showDetailsPanelWithParams({mri:e,causeId:t,rootViewId:this._getRootViewId()})},this._onSummaryHeaderRef=e=>{this._summaryHeader=e||void 0}}_buildState(e,t){const s={},i=this._getRootViewId();s.width=Math.min(f.default.getWidth(i),300),s.maxHeight=387,s.deviceOrientation=f.default.getDeviceOrientation(i),s.isMobileScreenSize=f.default.isMobileScreenSize(i);const o=this.props;return!t&&(0,u.default)(e.readReceiptsSum,o.readReceiptsSum)||(s.virtualListViewItemInfo=e.readReceiptsSum.map((t=>({key:t.mri,displayName:d.default.getMemberShortNameForConversation(e.conversationId,t.mri),height:44,template:"convo",timestamp:t.timestamp}))).sort(((e,t)=>e.displayName.localeCompare(t.displayName)))),s}_close(){return this.props.onClose&&this.props.onClose(),!0}componentDidMount(){super.componentDidMount(),r.default.subscribe(this._onBack),p.default.addEscapeHandler(this._onEscape),this._summaryHeader&&this._summaryHeader.requestFocus()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s)}componentWillUnmount(){super.componentWillUnmount(),r.default.unsubscribe(this._onBack),p.default.removeEscapeHandler(this._onEscape)}render(){const e=[T.container],t=this._computeHeight();e.push(n.Styles.createViewStyle({width:this.state.width,height:t},!1));const s=a.isOneOnOneConversation(this.props.conversationId)?m.getString("StreamItem.ReadByCount"):m.getString("StreamItem.ReadByGroupCount",{count:this.props.readReceiptsSum.length});return(0,i.jsxs)(n.View,Object.assign({style:e},{children:[(0,i.jsx)(n.View,Object.assign({ref:this._onSummaryHeaderRef,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityLabel:s},{children:(0,i.jsx)(C.Subtitle,Object.assign({style:T.headlineText},{children:s}))})),(0,i.jsx)(o.VirtualListView,{style:T.virtualList,itemList:this.state.virtualListViewItemInfo,renderItem:this._renderItem,animateChanges:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0})]}))}_computeHeight(){const e=57+44*this.props.readReceiptsSum.length;if(e>this.state.maxHeight)return this.state.maxHeight;const t=b.default.measureWindow(this._getRootViewId()).height;if(e>t){return 44*(Math.floor((t-57)/44)+.5)+57}return e}}t.default=M},807914:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=(s(496486),s(516778)),n=s(77605),r=s(94655),a=s(671830),l=s(147204),d=s(898278),c=s(629951),h=s(110117),u=s(436237),p=s(915877),g=s(733754),m=s(89808),S=s(104735),f=s(969417),y=s(527683),v=s(886045),C=(s(149769),s(722543)),_=s(868675),b=s(774342),T=s(195358),M=s(915415),I=s(581760),w=s(711828),P=s(79669),k=s(619675),A=s(24576),x=(0,p.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,justifyContent:"space-between",marginBottom:10}),containerMobile:()=>o.Styles.createViewStyle({marginBottom:5,marginTop:5,marginHorizontal:10}),row:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),creditIcon:()=>o.Styles.createViewStyle({paddingLeft:15,paddingRight:5}),activityStyle:()=>o.Styles.createViewStyle({height:14}),recipientNumberRow:()=>o.Styles.createViewStyle({flexShrink:1,paddingRight:10,flexWrap:"wrap"}),smsButton:()=>o.Styles.createViewStyle({flexDirection:"row",backgroundColor:I.Color.transparent})}),R="overflowPopupId";class O extends A.default{constructor(){super(...arguments),this._oldFragments=0,this._telemetryEvent=new f.SmsLineSwitcherShown,this._onRateInfoPress=()=>{this.canSendSMS()||(this.props.isSmsFailureScreenEnabled?S.default.navigateToSmsFailurePrompt(this.props.conversationId,this.props.phoneNumbers.length>0?this.props.phoneNumbers[0].number:"",!0):r.default.open(this._getRootViewId()))},this._getAccentColor=()=>this._themeColors.textInteractive,this._onNumberPickerRef=e=>{this._numberPickerRef=e||void 0},this._getPopupAnchor=()=>this._numberPickerRef,this._onSwitcherPressed=()=>{this._showOverflowPopup()},this._showOverflowPopup=()=>{const e={getAnchor:this._getPopupAnchor,renderPopup:(e,t,s,o)=>(0,i.jsx)(P.default,Object.assign({anchorPosition:e,anchorOffset:t,popupWidth:s,popupHeight:o,fillColor:this._themeColors.popoverBackgroundColor,strokeColor:this._useDarkTheme()?this._themeColors.popupBorderColor:void 0,skipPopupAutoFocus:!0},{children:(0,i.jsx)(_.default,{phoneNumbers:this.props.phoneNumbers,onOptionSelected:this._onOptionSelected})})),positionPriorities:["top"],dismissIfShown:!0,rootViewId:this._getRootViewId()};l.default.showPopup(e,R)},this._onOptionSelected=e=>{this.props.onPhoneNumberSelected(e),l.default.dismissPopup(R,this._getRootViewId())}}_buildState(e,t){e.selectedPhoneNumber||(this._oldFragments=0);const s={primaryColor:m.default.getPrimaryColor()};return e.selectedPhoneNumber&&(s.smsPriceInfo=b.default.getSmsRateByPhoneNumber(e.selectedPhoneNumber.number)),s}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this.props.selectedPhoneNumber&&this._telemetryEvent.setSwitchedToSmsMode(!0)}componentWillUnmount(){super.componentWillUnmount(),this._telemetryEvent&&u.track(this._telemetryEvent)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._scheduleAccessibilityAnnouncement&&(this._announceSmsInfoChangeInScreenReader(),this._scheduleAccessibilityAnnouncement=!1),e.selectedPhoneNumber&&!this.props.selectedPhoneNumber&&this._telemetryEvent.setSwitchedToSkype(!0),!e.selectedPhoneNumber&&this.props.selectedPhoneNumber&&this._telemetryEvent.setSwitchedToSmsMode(!0)}getTelemetryEvent(){return this._telemetryEvent}requestFocus(){this._numberPickerRef&&this._numberPickerRef.requestFocus()}canSendSMS(){if(!this.state.smsPriceInfo)return!0;if(this.state.smsPriceInfo.failureReason===C.FailureReason.InsufficientFunds)return!1;const{fragments:e}=T.calculateSmsFragments(this.props.rawTextInput),t=this.props.creditEntitlement&&this.props.creditEntitlement.balance||0;return!(this.state.smsPriceInfo.rate&&this.state.smsPriceInfo.rate*e>t)}render(){const e=a.isPhoneMri(this.props.conversationId);let t;e||(t=this._renderTargetSwitcher());const s=[],n=(0,i.jsxs)(o.View,Object.assign({style:x.row},{children:[this._renderRateSection(),this._renderCreditSection()]}),"rateAndCreditSection");e?s.push(this._renderRecipientNumberSection(),n):this.props.selectedPhoneNumber&&s.push(n);const r=[x.container,x.row];this.props.useMobileLayout&&r.push(x.containerMobile);const l=this.props.preventAccessibilityFocus?o.Types.ImportantForAccessibility.NoHideDescendants:void 0;return(0,i.jsxs)(o.View,Object.assign({style:r,importantForAccessibility:l},{children:[t,s]}))}_renderRecipientNumberSection(){const e=a.getPhoneNumberFromMri(this.props.conversationId);if(e){const t=y.default.parseAndFormat(e,y.PhoneNumberFormat.INTERNATIONAL)||e;return(0,i.jsx)(k.Caption,Object.assign({style:x.recipientNumberRow,textThemeColor:k.TextThemeColor.Primary},{children:g.getString("SMSMessaging.SendSmsToNumberViaSkype",{phoneNumber:t})}),"recipientNumberSection")}}_renderRateSection(){const{fragments:e,charactersRemaining:t}=T.calculateSmsFragments(this.props.rawTextInput);let s;if(this.state.smsPriceInfo){if(this.state.smsPriceInfo.failureReason)this.state.smsPriceInfo.failureReason===C.FailureReason.InsufficientFunds?this._accessibilityLabelForRateSection=g.getString("SMSMessaging.SmsCharactersLabel",{charactersRemaining:t}):this._accessibilityLabelForRateSection=g.getString("SMSMessaging.SmsPriceFetchFailure");else if(this.state.smsPriceInfo.rate&&this.state.smsPriceInfo.currency){const i=this.state.smsPriceInfo.rate*e;s=c.getFormattedRate(i,this.state.smsPriceInfo.currency,3),this._accessibilityLabelForRateSection=g.getString("SMSMessaging.SmsRateAndCharactersLabel",{charactersRemaining:t,formattedPrice:s})}this._oldFragments!==e&&(this._scheduleAccessibilityAnnouncement=!0,this._oldFragments=e)}const r=this.state.smsPriceInfo?void 0:(0,i.jsx)(M.default,{size:d.SXActivityIndicatorSize.ExtraSmall,tintColor:I.Color.blue,style:x.activityStyle}),a=(0,i.jsxs)(o.View,Object.assign({style:x.row},{children:[(0,i.jsxs)(k.Caption,Object.assign({textThemeColor:k.TextThemeColor.Primary},{children:[t,s&&" | ",s]})),r]})),l=(0,i.jsx)(o.View,Object.assign({title:1===e?this._accessibilityLabelForRateSection:void 0,importantForAccessibility:1===e?o.Types.ImportantForAccessibility.Yes:o.Types.ImportantForAccessibility.NoHideDescendants},{children:a}),"rateSection");if(1===e)return l;const h=o.Styles.createTextStyle({backgroundColor:this._getAccentColor(),marginRight:5},!1);return this._accessibilityLabelForRateSection=g.getString("SMSMessaging.SmsCount",{fragments:e})+this._accessibilityLabelForRateSection,(0,i.jsxs)(o.View,Object.assign({style:x.row,title:this._accessibilityLabelForRateSection,importantForAccessibility:o.Types.ImportantForAccessibility.Yes},{children:[(0,i.jsx)(n.default,{count:e.toString(),rawCount:e,isHighPriority:!0,style:h,badgeSize:n.BadgeSize.Desktop}),l]}),"rateSectionWithBadge")}_renderCreditSection(){if(!this.props.creditEntitlement)return;const e=this.props.creditEntitlement.balanceFormatted,t=(0,i.jsxs)(o.View,Object.assign({style:x.row},{children:[(0,i.jsx)(h.default,{icon:w.SkypeIcon.SkypeCredit,color:I.Color.yellow,style:x.creditIcon,size:w.IconSize.size16}),(0,i.jsx)(k.Caption,Object.assign({textThemeColor:k.TextThemeColor.Primary},{children:e}))]})),s={key:"creditSection",importantForAccessibility:o.Types.ImportantForAccessibility.Yes,title:g.getString("SMSMessaging.CreditTitle",{balance:e||0}),children:t};return this.canSendSMS()?(0,i.jsx)(o.View,Object.assign({},s)):(0,i.jsx)(o.Button,Object.assign({},s,{onPress:this._onRateInfoPress}))}_renderTargetSwitcher(){const e=o.Styles.createTextStyle({color:this._getAccentColor()},!1),t=this.props.selectedPhoneNumber?y.default.parseAndFormat(this.props.selectedPhoneNumber.number,y.PhoneNumberFormat.INTERNATIONAL)||"":g.getString("SMSMessaging.SendViaSkypeStatic"),s=this.props.selectedPhoneNumber?"SMSMessaging.SendSmsToNumber":"SMSMessaging.SendViaSkype",n=(0,i.jsx)(k.Caption,Object.assign({style:e},{children:t}),"label"),r=(0,i.jsx)(h.default,{icon:w.SkypeIcon.DownChevron,color:this._getAccentColor(),size:w.IconSize.size20}),a=this.props.selectedPhoneNumber?g.getString("SMSMessaging.SmsSelectorPhoneOptionAccessibilityTitle",{phoneNumber:this.props.selectedPhoneNumber.number}):g.getString("SMSMessaging.SmsSelectorSkypeOptionAccessibilityTitle");return(0,i.jsxs)(o.Button,Object.assign({ref:this._onNumberPickerRef,style:x.smsButton,title:a,disabled:this.props.disabled,onPress:this._onSwitcherPressed},{children:[(0,i.jsx)(k.Caption,Object.assign({textThemeColor:k.TextThemeColor.Primary},{children:g.getParts(s,{target:n})})),r]}))}_setFocusToSwitcher(){this._numberPickerRef&&v.default.isMobileScreenReaderEnabled()&&this._numberPickerRef.requestFocus()}_announceSmsInfoChangeInScreenReader(){this._accessibilityLabelForRateSection&&v.default.maybeAnnounceForAccessibility(this._accessibilityLabelForRateSection)}}t.default=O},795420:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(898278),r=s(915877),a=s(733754),l=s(527683),d=s(22222),c=s(711828),h=s(24576),u=(0,r.lazyProperties)({option:()=>o.Styles.createButtonStyle({flexDirection:"row",alignItems:"stretch",marginVertical:5,paddingHorizontal:15,justifyContent:"flex-start"})});class p extends h.default{constructor(){super(...arguments),this._onPress=()=>{this.props.onOptionSelected(this.props.phoneNumber)}}render(){let e,t,s;if(this.props.phoneNumber){let i=l.default.parseAndFormat(this.props.phoneNumber.number,l.PhoneNumberFormat.INTERNATIONAL);i||(i=this.props.phoneNumber.number),e=a.getString("SMSMessaging.SmsSelectorPhoneOptionAccessibilityTitle",{phoneNumber:i}),t=a.getString("SMSMessaging.SmsPhoneOption",{type:l.default.getStringForPhoneType(this.props.phoneNumber.type),phoneNumber:i}),s=c.SkypeIcon.MobileSmsNew}else e=a.getString("SMSMessaging.SmsSelectorSkypeOptionAccessibilityTitle"),t=a.getString("SMSMessaging.SendViaSkype",{target:a.getString("SMSMessaging.SendViaSkypeStatic"),chevron:""}),s=c.SkypeIcon.Message;return(0,i.jsx)(d.default,{style:u.option,buttonStyle:n.SXButtonStyle.ThemeNoBackground,buttonSize:n.SXButtonSize.Small,icon:s,title:t,onPress:this._onPress,accessibilityLabel:e})}}t.default=p},868675:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(587134),r=s(915877),a=s(733754),l=s(795420),d=s(619675),c=s(24576),h=(0,r.lazyProperties)({container:()=>o.Styles.createViewStyle({minWidth:280,paddingBottom:10}),sendToSmsLabel:()=>o.Styles.createViewStyle({paddingHorizontal:15})});class u extends c.default{render(){return(0,i.jsxs)(o.View,Object.assign({style:h.container},{children:[this._renderSkypeOption(),(0,i.jsx)(n.default,{useLightTheme:!this._useDarkTheme(),marginBottom:5,marginLeft:7,marginRight:7}),(0,i.jsx)(d.Caption,Object.assign({style:h.sendToSmsLabel},{children:a.getString("SMSMessaging.SendSmsToLabel")})),this._renderPhoneOptions()]}))}_renderPhoneOptions(){return this.props.phoneNumbers.map((e=>(0,i.jsx)(l.default,{phoneNumber:e,onOptionSelected:this.props.onOptionSelected},e.type+"_"+e.number)))}_renderSkypeOption(){return(0,i.jsx)(l.default,{onOptionSelected:this.props.onOptionSelected},"skype")}}t.default=u},788361:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=(s(583367),s(665768)),r=s(516778),a=s(719061),l=s(149748),d=s(539549),c=s(185641),h=s(557102),u=s(319596),p=s(913944),g=s(110117),m=s(436237),S=s(915877),f=s(733754),y=s(42036),v=s(106658),C=s(812056),_=s(445026),b=s(29130),T=s(451070),M=s(681115),I=s(886045),w=s(144487),P=s(600750),k=s(311010),A=s(711828),x=s(680837),R=s(360305),O=s(911698),L=s(619675),F=s(24576),B=(0,S.lazyProperties)({container:()=>r.Styles.createViewStyle({flex:0,flexDirection:"row",alignItems:"center",justifyContent:"space-between",position:"absolute",left:0,right:0}),containerLandscape:()=>r.Styles.createViewStyle({paddingHorizontal:34}),containerBottom:()=>r.Styles.createViewStyle({alignContent:"center",borderBottomWidth:0,borderLeftWidth:0,borderRightWidth:0,justifyContent:"center",bottom:0}),containerHeader:()=>r.Styles.createViewStyle({borderTopWidth:0,borderLeftWidth:0,borderRightWidth:0,height:l.HeaderHeightModernizeChatSmallHeader,paddingTop:8,paddingBottom:8}),leftChildren:()=>r.Styles.createViewStyle({flex:-1,alignItems:"flex-start",flexDirection:"row"}),centerChildrenColumn:()=>r.Styles.createViewStyle({flex:1,alignItems:"flex-start",flexDirection:"column",justifyContent:"flex-start"}),selectMessagesTitleHeader:()=>r.Styles.createViewStyle({justifyContent:"flex-start"}),modernizeHeaderConversationTypeTitleHeader:()=>(0,S.lazyProperties)({base:()=>r.Styles.createTextStyle({marginHorizontal:4}),desktop:()=>r.Styles.createTextStyle({fontSize:k.default.controlFontSize.caption}),mobile:()=>r.Styles.createTextStyle({fontSize:k.default.controlFontSize.caption})}),centerChildrenRow:()=>r.Styles.createViewStyle({marginVertical:5,alignItems:"center",justifyContent:"flex-start",flexDirection:"row"}),rightChildren:()=>r.Styles.createViewStyle({flex:-1,alignItems:"flex-end",flexDirection:"row",paddingHorizontal:20}),centerChildrenAction:()=>r.Styles.createViewStyle({flex:-1,justifyContent:"center",alignItems:"center"}),centerChildrenActionSpacing:()=>r.Styles.createViewStyle({flex:1,paddingBottom:5}),buttonStyles:()=>r.Styles.createButtonStyle({padding:6}),iconContainer:()=>r.Styles.createViewStyle({flex:0,alignItems:"center"}),iconContainerWidthDesktop:()=>r.Styles.createViewStyle({width:80}),iconContainerWidthMobile:()=>r.Styles.createViewStyle({width:64}),iconContainerActionsMobileBottom:()=>r.Styles.createViewStyle({flex:1,alignItems:"center"}),spacerDesktop:()=>r.Styles.createViewStyle({width:80,height:A.IconSize.default}),spacerMobile:()=>r.Styles.createViewStyle({width:64,height:A.IconSize.default}),horizontalSpacer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"flex-end",marginBottom:20,alignItems:"center"}),desktopContentContainer:()=>r.Styles.createViewStyle({width:v.messageStreamMaxContentWidth,alignSelf:"center",flex:-1,flexDirection:"row",justifyContent:"center"}),desktopContentContainerActions:()=>r.Styles.createViewStyle({justifyContent:"flex-end"}),closeButtonLandscape:()=>r.Styles.createButtonStyle({height:l.LandscapeButtonHeight,alignItems:"flex-start"}),closeButtonDesktop:()=>r.Styles.createButtonStyle({alignItems:"flex-start",paddingRight:38}),iconPadding:()=>r.Styles.createViewStyle({padding:1})});class D extends F.default{constructor(){super(...arguments),this._iconSize=A.IconSize.size24,this._onCancelButtonRef=e=>{this._cancelButton=e||void 0},this._onCancelMultipleMessages=e=>{this.cancelMultipleMessages()},this._onForwardMultipleMessages=e=>{this._actionTaken=O.SelectedMessagesActionType.Forward,u.forwardMessages(this.state.selectedMessages,C.MessageActionOrigin.StreamItemMultipleMessages,this.props.contextConversationId,this._onCancelOrComplete,this._getContext())},this._onRemoveMultipleMessages=e=>{this._actionTaken=O.SelectedMessagesActionType.Remove;const t=o.map(this.state.selectedMessages,(e=>e.message));y.default.deleteMultipleMessages(t,this._getRootViewId(),(()=>{this._onCancelOrComplete(),I.default.maybeAnnounceForAccessibility(f.getString("Global.RemoveMultipleMessages",{count:t.length}))}))},this._onCopyMultipleMessages=e=>{this._actionTaken=O.SelectedMessagesActionType.Copy,y.default.copyMultipleMessages(this.state.selectedMessages,this._getRootViewId()),this._onCancelOrComplete()},this._onCancelOrComplete=e=>{const t=!e,s=!!e&&e.length>0;if(t||s){this.props.onClosePanel(this._headerInitialPosition,this._actionsInitialPosition),w.default.deactivateSelectMessagesMode();const t=new C.SelectedMessagesTelemetry(this.props.conversationId,e?e.length:void 0,this.state.selectedMessages,this._actionTaken,this.state.commands);m.track(t)}}}_buildState(e,t){const s=R.default.isTabletUI(),i=this._getRootViewId(),n=(b.default.getDeviceOrientation(i),!1),a=w.default.getSelectedMessages(),h={leavePaddingForStatusBar:r.StatusBar.isOverlay()&&!1,statusBarHeight:T.default.statusBarHeight(),isLandscapeMobile:n,commands:{disabledCopy:!1,disabledForward:!1,disabledRemove:!1},selectedMessages:a,usePrimaryBackgroundColor:e.mobileUi||s,currentConversation:(0,d.default)().getConversation(e.conversationId)};let u;if(a.length>0&&h&&h.commands?o.each(a,(e=>{const t=this._isCommandDisabled([P.CommandTypes.Forward],e.actionMenuCommands),s=this._isCommandDisabled([P.CommandTypes.Remove],e.actionMenuCommands),i=this._isCommandDisabled([P.CommandTypes.Copy,P.CommandTypes.CopyLink,P.CommandTypes.CopyLocation,P.CommandTypes.CopyImage],e.actionMenuCommands);h.commands.disabledForward=h.commands.disabledForward||t,h.commands.disabledRemove=h.commands.disabledRemove||s,h.commands.disabledCopy=h.commands.disabledCopy||i})):(h.commands.disabledForward=!0,h.commands.disabledRemove=!0,h.commands.disabledCopy=!0),u=e.renderHeader?s?60:l.HeaderHeightCompositeBase:s?57:80,e.mobileUi&&!s){const t=70;u=e.renderHeader?t:void 0}if(this._containerHeightStyles=r.Styles.createViewStyle({height:u},!1),t&&(e.mobileUi?(this._headerInitialPosition=h.leavePaddingForStatusBar&&h.statusBarHeight>0?-70-h.statusBarHeight:-70,this._actionsInitialPosition=70+(e.bottomPadding||0)):(this._headerInitialPosition=-l.HeaderHeightCompositeExtended,this._actionsInitialPosition=(s?57:80)+(e.bottomPadding||0)),this._initialPosition=e.renderHeader?this._headerInitialPosition:this._actionsInitialPosition,e.panelAnimatedValue.setValue(this._initialPosition),this._innerMovingContainerYOffsetStyle=r.Styles.createAnimatedViewStyle({transform:[{translateY:e.panelAnimatedValue}]})),!e.mobileUi){const{left:e,right:t}=c.default.getSpacerWidths();h.leftDesktopSpacerWidth=e,h.rightDesktopSpacerWidth=t}return h}componentDidMount(){super.componentDidMount(),_.default.timing(this.props.panelAnimatedValue,{toValue:0,duration:n.Common.Duration.Default,easing:n.Easing.SkypeExpoOut5,useNativeDriver:!0}).start();const e=()=>{this.props.renderHeader&&this._cancelButton&&this._cancelButton.requestFocus()};o.delay(e,500)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=this._countSelectedMessages(t.selectedMessages),o=this._countSelectedMessages(this.state.selectedMessages);this.props.renderHeader&&i!==o&&r.Accessibility.announceForAccessibility(f.getString("MessageStream.MessagesSelected",{count:o}))}_isCommandDisabled(e,t){return!!o.isUndefined(t)||o.intersection(e,t).length<=0}_countSelectedMessages(e){return o.filter(e,(e=>!e.forwardAlbumId||e.message.isAlbum())).length}render(){const e=this._countSelectedMessages(this.state.selectedMessages),t=f.getString("MessageStream.MessagesSelected",{count:e}),s=!this.props.mobileUi&&this.props.renderHeader;let o;0===e&&(o=f.getString("MessageStream.DisabledButtonNoSelection"));const n=f.getString("Global.ForwardButton"),l=f.getString("Global.RemoveLabel"),d=f.getString("MessageActionMenu.ShareMenuCopy"),c=f.getString("Global.CancelLabel"),u=o||(this.state.commands.disabledForward?f.getString("MessageStream.DisabledForward"):n),p=o||(this.state.commands.disabledRemove?f.getString("MessageStream.DisabledRemove"):l),m=o||(this.state.commands.disabledCopy?f.getString("MessageStream.DisabledCopy"):d),S=this._getButtonView(c,f.getString("Global.CancelLabel"),A.SkypeIcon.Cancel,this._onCancelMultipleMessages,void 0,!0),y=[B.container,this._containerHeightStyles,this._themeStyles.viewBorderStyle,this.state.usePrimaryBackgroundColor?this._themeStyles.primaryBackgroundColorStyle:this._themeStyles.buttonBackgroundColorStyle,this._innerMovingContainerYOffsetStyle,this.state.isLandscapeMobile?B.containerLandscape:void 0],v=[B.rightChildren];this.props.renderActions&&(y.push(B.containerBottom),v.push(B.centerChildrenAction),this.props.mobileUi&&v.push(B.centerChildrenActionSpacing)),this.props.renderHeader&&(this.state.leavePaddingForStatusBar&&this.state.statusBarHeight&&y.push(M.default.marginTopStyle(this.state.statusBarHeight)),y.push(B.containerHeader));const C=(0,i.jsx)(r.View,Object.assign({style:B.leftChildren},{children:S})),_=k.default.modernizeSmallPanelHeaderFontStyle(),b=B.modernizeHeaderConversationTypeTitleHeader,T=[B.modernizeHeaderConversationTypeTitleHeader.base,this.props.mobileUi?b.mobile:b.desktop,this._themeStyles.secondaryTextColorStyle],I=this.state.currentConversation&&this.state.currentConversation.isOneOnOne()?this.state.currentConversation.getOtherPartyMri():void 0,w=h.ConversationUtils.getConversationTitleForSelection({mri:this.props.conversationId,otherPartyMri:I}),P=(0,i.jsxs)(r.View,Object.assign({style:[B.centerChildrenColumn,s?B.selectMessagesTitleHeader:void 0],accessibilityTraits:r.Types.AccessibilityTrait.Header,importantForAccessibility:r.Types.ImportantForAccessibility.Yes},{children:[(0,i.jsx)(r.Text,Object.assign({style:[x.default.flexNegativeOne,_,this._themeStyles.primaryTextColorStyle],numberOfLines:1},{children:t})),(0,i.jsxs)(r.View,Object.assign({style:B.centerChildrenRow},{children:[(0,i.jsx)(g.default,{icon:h.ConversationUtils.getIconForConversation(this.state.currentConversation),color:this._themeColors.secondaryTextColor,size:A.IconSize.size14,style:B.iconPadding}),(0,i.jsx)(r.Text,Object.assign({style:T},{children:w}))]}))]}));let R;if(this.props.renderHeader)R=(0,i.jsx)(r.View,{style:this.props.mobileUi?B.spacerDesktop:B.spacerMobile});else{const e=a.default.canForwardMessage()?this._getButtonView(n,u,A.SkypeIcon.ForwardItem,this._onForwardMultipleMessages,this.state.commands.disabledForward):void 0,t=this._getButtonView(d,m,A.SkypeIcon.Copy,this._onCopyMultipleMessages,this.state.commands.disabledCopy),s=this._getButtonView(l,p,A.SkypeIcon.Delete,this._onRemoveMultipleMessages,this.state.commands.disabledRemove),o=this.props.bottomPadding?[v,M.default.paddingBottomStyle(this.props.bottomPadding)]:v;R=(0,i.jsxs)(r.View,Object.assign({style:o},{children:[t,e,s]}))}if(!this.props.mobileUi){const e=r.Styles.createViewStyle({minWidth:this.state.leftDesktopSpacerWidth},!1),t=r.Styles.createViewStyle({minWidth:this.state.rightDesktopSpacerWidth},!1);return(0,i.jsxs)(r.Animated.View,Object.assign({style:y},{children:[(0,i.jsx)(r.View,{style:[B.horizontalSpacer,e]}),(0,i.jsxs)(r.View,Object.assign({style:[B.desktopContentContainer,this.props.renderActions?B.desktopContentContainerActions:void 0]},{children:[this.props.renderHeader?P:R,this.props.renderHeader?C:void 0]})),(0,i.jsx)(r.View,{style:[B.horizontalSpacer,t]})]}))}return(0,i.jsxs)(r.Animated.View,Object.assign({style:y},{children:[this.props.renderHeader?C:void 0,this.props.renderHeader?P:void 0,R]}))}_getButtonView(e,t,s,o,n,a){const l=this._themeColors.primaryIconColor,d=this._themeColors.iconHoverColor,c=(0,i.jsx)(p.default,{ref:a?this._onCancelButtonRef:void 0,icon:s,color:l,hoverColor:d,title:t,size:this._iconSize,onPress:o,style:B.buttonStyles,disabledOpacity:.2,disabled:n});let h=this.props.mobileUi?B.iconContainerWidthMobile:B.iconContainerWidthDesktop;const u=[this.props.renderActions?B.iconContainerActionsMobileBottom:B.iconContainer,h];let g;return a?(this.state.isLandscapeMobile&&u.push(B.closeButtonLandscape),this.props.mobileUi||(u.push(B.closeButtonDesktop),h=void 0)):g=(0,i.jsx)(L.Caption,Object.assign({small:!this.state.isLandscapeMobile,style:x.default.flexNegativeOne,numberOfLines:1,accessibilityHidden:!0,textThemeColor:n?L.TextThemeColor.Disabled:L.TextThemeColor.Primary},{children:e})),(0,i.jsxs)(r.View,Object.assign({style:u},{children:[c,g]}))}cancelMultipleMessages(){this._actionTaken=O.SelectedMessagesActionType.Cancel,this._onCancelOrComplete()}}t.default=D},115761:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(244770),r=s(898278),a=s(587134),l=s(913944),d=s(915877),c=s(733754),h=s(104735),u=s(55585),p=s(22222),g=s(581760),m=s(311010),S=s(711828),f=s(24576),y=s(853374),v=(0,d.lazyProperties)({container:()=>o.Styles.createViewStyle({flexDirection:"column",justifyContent:"center",alignItems:"center",paddingHorizontal:50,paddingTop:20}),contentContainer:()=>o.Styles.createViewStyle({padding:20,borderRadius:10,marginTop:15,flexShrink:void 0}),closeButton:()=>o.Styles.createViewStyle({alignSelf:"flex-end",paddingTop:16}),buttonsWrapper:()=>o.Styles.createViewStyle({alignSelf:"center",alignItems:"center",flexDirection:"row",justifyContent:"center",paddingTop:10}),button:()=>o.Styles.createViewStyle({margin:10,minWidth:175}),image:()=>o.Styles.createViewStyle({height:122,width:160,marginBottom:20,alignSelf:"center"}),header:()=>o.Styles.createTextStyle({textAlign:"center"}),body:()=>o.Styles.createTextStyle({maxWidth:450,paddingTop:10})});class C extends f.default{constructor(){super(...arguments),this._removeSpeechConsentSuggestion=()=>{u.default.hideSpeechConsentSuggestion()},this._onTellMeMorePress=e=>{h.default.showSpeechConsentPanel({causeId:y.default.newCauseId(),rootViewId:this._getRootViewId()}),this._removeSpeechConsentSuggestion()},this._getContainerStyles=()=>{const e=[v.contentContainer];return this._useAccessibleTheme()&&e.push(o.Styles.createViewStyle({borderColor:this._useDarkTheme()?g.Color.white:g.Color.black,borderWidth:2},!0)),e}}_renderButtons(){return(0,i.jsxs)(o.View,Object.assign({style:v.buttonsWrapper},{children:[(0,i.jsx)(p.default,{style:v.button,buttonStyle:r.SXButtonStyle.ColorStroke,buttonSize:r.SXButtonSize.Medium,title:c.getString("SpeechConsentPanel.TellMeButton"),onPress:this._onTellMeMorePress}),(0,i.jsx)(p.default,{style:v.button,buttonStyle:r.SXButtonStyle.ColorStroke,buttonSize:r.SXButtonSize.Medium,title:this._getLabelForDismissSuggestionButton(),onPress:this._removeSpeechConsentSuggestion})]}))}_getLabelForDismissSuggestionButton(){return u.default.lastTimeShowingSuggestion()?c.getString("SpeechConsentPanel.DontShowAgain"):c.getString("SpeechConsentPanel.MayBeLaterButton")}_getCloseButton(){return(0,i.jsx)(l.default,{onPress:this._removeSpeechConsentSuggestion,icon:S.SkypeIcon.ClosePanel,size:S.IconSize.size14,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.secondaryTextColor,showHoverEffect:!0,style:v.closeButton,title:c.getString("Global.CloseButtonTitle")})}render(){return(0,i.jsxs)(o.View,Object.assign({style:v.container},{children:[(0,i.jsx)(a.default,{marginLeft:0,marginRight:0}),this._getCloseButton(),(0,i.jsxs)(o.View,Object.assign({style:this._getContainerStyles()},{children:[(0,i.jsx)(o.Image,{source:n.Collection.SPEECH_CONSENT_PROMPT,style:v.image,resizeMode:"contain"}),(0,i.jsx)(o.Text,Object.assign({style:[v.header,m.default.panelHeaderFontStyle()]},{children:c.getString("SpeechConsentPanel.ConversationHeader")})),(0,i.jsx)(o.Text,Object.assign({style:[v.header,v.body,m.default.bodyFontStyle()]},{children:c.getString("SpeechConsentPanel.ConversationBody")})),this._renderButtons()]}))]}))}}t.default=C},252333:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(711930),r=s(915877),a=s(89808),l=s(330124),d=s(680837),c=s(360305),h=s(619675),u=s(24576),p=(0,r.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",flexDirection:"row",alignItems:"center",justifyContent:"center",marginLeft:10,marginRight:10,paddingTop:10,paddingRight:0,paddingBottom:0,paddingLeft:0}),containerDesktop:()=>o.Styles.createViewStyle({marginLeft:50,marginRight:50}),containerTablet:()=>o.Styles.createViewStyle({marginLeft:50,marginRight:0}),whisker:()=>o.Styles.createViewStyle({flex:1,marginTop:5,marginBottom:5,marginLeft:0,marginRight:0,height:1,flexDirection:"row",opacity:.4}),whiskerLeft:()=>o.Styles.createViewStyle({marginRight:5}),whiskerRight:()=>o.Styles.createViewStyle({marginLeft:5}),whiskerAccessible:()=>o.Styles.createViewStyle({opacity:1}),thickerWhisker:()=>o.Styles.createViewStyle({height:2,opacity:.8}),text:()=>o.Styles.createTextStyle({paddingHorizontal:10,paddingVertical:5,alignSelf:"center"})});class g extends u.default{constructor(){super(...arguments),this._onComponentRef=e=>{this._componentRef=e||void 0}}_buildState(e,t){return{isUsingStackNavigationContext:l.default.isUsingStackNavigationContext(),useTabletUI:c.default.isTabletUI(),text:e.textGetter?e.textGetter():e.text}}componentDidMount(){super.componentDidMount(),this.props.onMountItem&&this.props.onMountItem(this,this.props.focusStreamItemTextForMobileScreenReader)}focusItemForScreenReader(){this.isComponentMounted()&&this._componentRef&&this._componentRef.requestFocus()}render(){const e=[p.text,d.default.noWrap];this.props.dividerTypeIsLastRead&&!this._useAccessibleTheme()&&e.push(a.default.getTextColorStyleNoSubscription());const t=[p.container];this.state.isUsingStackNavigationContext||this._getContext().isPresentedInDesktopSubview||t.push(this.state.useTabletUI?p.containerTablet:p.containerDesktop);const s=n.default.headerAccessibilityInfo(this.state.text);return(0,i.jsxs)(o.View,Object.assign({style:t,ref:this._onComponentRef,tabIndex:-1,accessibilityLabel:s.accessibilityLabel,accessibilityTraits:s.accessibilityTraits,importantForAccessibility:o.Types.ImportantForAccessibility.Yes},{children:[this._whisker(p.whiskerLeft),(0,i.jsx)(h.Caption,Object.assign({style:e,selectable:!1,messageStreamFontSize:this.props.messageStreamFontSize,accessibilityHidden:!0},{children:this.state.text})),this._whisker(p.whiskerRight)]}))}_whisker(e){if(this.props.dividerTypeIsLastRead){const t=[p.whisker,p.thickerWhisker,e];return this._useAccessibleTheme()?t.push(o.Styles.createViewStyle({backgroundColor:this._themeColors.primaryTextColor},!1)):t.push(a.default.getBackgroundColorStyleNoSubscription()),(0,i.jsx)(o.View,{style:t})}{const t=[p.whisker,this._themeStyles.secondaryViewColorStyle,e];return this._useAccessibleTheme()&&t.push(p.whiskerAccessible),(0,i.jsx)(o.View,{style:t})}}}t.default=g},307698:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(952262),a=s(915877),l=s(733754),d=s(29130),c=s(88237),h=s(619675),u=s(24576),p=(0,a.lazyProperties)({streamItemContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start",overflow:"hidden",marginLeft:50,marginTop:8}),streamItemContainerComposite:()=>n.Styles.createViewStyle({marginLeft:50}),userNameText:()=>n.Styles.createTextStyle({flex:-1,marginRight:5})});class g extends u.default{_buildState(e,t){const s=o.compact(e.typingMris),i={compactedTypingMris:s,firstPersonTyping:void 0,secondPersonTyping:void 0,streamItemContainerHeight:Math.ceil(18*d.default.getContentSizeMultiplier())};return s.length>0&&(i.firstPersonTyping=r.default.getMemberShortNameForConversation(e.conversationId,s[0]),2===e.typingMris.length&&(i.secondPersonTyping=r.default.getMemberShortNameForConversation(e.conversationId,s[1]))),i}componentDidMount(){super.componentDidMount(),this.state.compactedTypingMris.length&&n.Accessibility.announceForAccessibility(l.getString("TypingIndicator.TypingAnnouncement"))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.compactedTypingMris.length&&!t.compactedTypingMris.length&&n.Accessibility.announceForAccessibility(l.getString("TypingIndicator.TypingAnnouncement"))}render(){const e=[p.streamItemContainer,n.Styles.createViewStyle({height:this.state.streamItemContainerHeight},!1)];return this.props.isUsingStackNavigationContext||e.push(p.streamItemContainerComposite),(0,i.jsx)(n.View,Object.assign({style:e},{children:this._renderOptionalTypingIndicator()}))}_renderOptionalTypingIndicator(){if(this.state.compactedTypingMris.length)return[(0,i.jsx)(h.Caption,Object.assign({style:p.userNameText,numberOfLines:1},{children:this._getTypingText()}),"caption"),(0,i.jsx)(c.default,{},"typingIndicator")]}_getTypingText(){return 1===this.state.compactedTypingMris.length&&this.state.firstPersonTyping?l.getString("TypingIndicator.OnePersonTyping",{typer:this.state.firstPersonTyping}):2===this.state.compactedTypingMris.length&&this.state.firstPersonTyping&&this.state.secondPersonTyping?l.getString("TypingIndicator.PeopleTyping",{peopleTyping:this.props.typingMris.length,firstTyper:this.state.firstPersonTyping,secondTyper:this.state.secondPersonTyping}):this.state.compactedTypingMris.length>2?l.getString("TypingIndicator.PeopleTyping",{peopleTyping:this.props.typingMris.length}):""}}t.default=g},88237:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(244770),r=s(915877),a=s(24576);var l;!function(e){e[e.None=0]="None",e[e.Loop=1]="Loop"}(l||(l={}));const d=(0,r.lazyProperties)({newIndicatorImage:()=>o.Styles.createImageStyle({width:30,height:15,top:1,opacity:.8})});class c extends a.default{_buildState(e,t){const s={};return t&&(s.currentAnimationStep=l.None),s}componentDidMount(){super.componentDidMount(),this.setState({currentAnimationStep:l.Loop})}render(){if(this.state.currentAnimationStep===l.None)return null;let e;e=this._useAccessibleTheme()?this._useDarkTheme()?n.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_DARK:n.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_LIGHT:this._useDarkTheme()?n.Collection.TYPING_INDICATOR_NEXT_DARK:n.Collection.TYPING_INDICATOR_NEXT_LIGHT;const t=o.Styles.createViewStyle({width:75,height:15,overflow:"visible"},!1);return(0,i.jsx)(o.View,Object.assign({style:t},{children:(0,i.jsx)(o.Image,{style:d.newIndicatorImage,source:e,resizeMode:"contain"})}))}}t.default=c},171308:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureButton=t.CaptureButtonSize=void 0;const i=s(785893),o=s(496486),n=s(643789),r=s(665768),a=s(516778),l=s(217041),d=s(244770),c=s(746096),h=s(812854),u=s(110117),p=s(436237),g=s(915877),m=s(733754),S=s(78780),f=s(581760),y=s(711828),v=s(680837),C=s(912770);t.CaptureButtonSize=80;const _=(0,g.lazyProperties)({captureButtonContainer:()=>a.Styles.createButtonStyle({width:t.CaptureButtonSize,height:t.CaptureButtonSize,overflow:"visible",alignSelf:"flex-start",alignItems:"center"}),captureContainerAccessibleRecord:()=>a.Styles.createViewStyle({width:t.CaptureButtonSize,height:2*t.CaptureButtonSize}),captureContainerAccessibleRecordLandscape:()=>a.Styles.createViewStyle({width:2*t.CaptureButtonSize,height:t.CaptureButtonSize,alignSelf:"flex-end",flexDirection:"row"}),captureButton:()=>a.Styles.createButtonStyle({width:t.CaptureButtonSize,height:t.CaptureButtonSize,overflow:"visible"}),shutterButtonImage:()=>a.Styles.createButtonStyle({width:59,height:59,position:"absolute"}),buttonActive:()=>a.Styles.createButtonStyle({backgroundColor:f.Color.white,width:59,height:59,position:"absolute",borderRadius:30}),recordButtonActive:()=>a.Styles.createImageStyle({backgroundColor:f.Color.red,borderWidth:2,borderColor:f.Color.white}),captureButtonOuterView:()=>a.Styles.createViewStyle({width:t.CaptureButtonSize,height:t.CaptureButtonSize,overflow:"visible",alignItems:"center",justifyContent:"center"}),captureButtonViewDisabled:()=>a.Styles.createViewStyle({opacity:1}),innerContainer:()=>a.Styles.createViewStyle({alignItems:"center",justifyContent:"center",overflow:"visible"}),accessibleRecordButton:()=>a.Styles.createViewStyle({height:t.CaptureButtonSize,width:t.CaptureButtonSize,alignItems:"center"}),accessibleRecordButtonIcon:()=>a.Styles.createViewStyle({position:"absolute"})});class b extends l.ComponentBase{constructor(){super(...arguments),this._pressed=!1,this._accessibleRecordButtonPressed=!1,this._panning=!1,this._captureButtonAnimatedOpacityValue=new a.Animated.Value(1),this._captureButtonAnimatedScaleValue=new a.Animated.Value(1),this._captureButtonAnimatedStyle=a.Styles.createAnimatedViewStyle({opacity:this._captureButtonAnimatedOpacityValue,transform:[{scale:this._captureButtonAnimatedScaleValue}]}),this._onShutterAnimationViewRef=e=>{this._shutterAnimationView=e||void 0},this._onRecordingAnimationViewRef=e=>{this._recordingAnimationView=e||void 0,o.delay((()=>{this.isComponentMounted()&&this._recordingAnimationView&&this._recordingAnimationView.reset()}),500)},this._onCaptureButtonPressIn=()=>{p.log(c.LogTraceArea.Capture,"CaptureButton _onCaptureButtonPressIn disabled: "+this.props.disabled+" _onPressIn hidden: "+this.props.hidden+" props.onPressIn: "+(this.props.onPressIn?"ok":"null")),this.props.disabled||this.props.hidden||(this._pressed=!0,this._updateButton(!0,!0,200,this._onStartRecording),this.props.onPressIn&&this.props.onPressIn(),h.default.triggerFeedback().then((()=>{h.default.unprepareFeedback()})))},this._onAccessibleRecordButtonPress=()=>{p.log(c.LogTraceArea.Capture,"CaptureButton_onAccessibleRecordButtonPress disabled: "+this.props.disabled+" props.onPressIn: "+(this.props.onPressIn?"ok":"null")),this._accessibleRecordButtonPressed=!0,this.props.isRecording?this._onCaptureButtonPressOut():this._onCaptureButtonPressIn()},this._onCaptureButtonPressOut=()=>{p.log(c.LogTraceArea.Capture,"CaptureButton _onCaptureButtonPressOut disabled: "+this.props.disabled+" panning: "+this._panning+" props.onPressOut: "+(this.props.onPressOut?"ok":"null")),this._panning||this.props.disabled||(this._pressed=!1,this._updateButton(!1,!0),this.props.onPressOut&&this.props.onPressOut())},this._onStartRecording=()=>{p.log(c.LogTraceArea.Capture,"CaptureButton _onStartRecording _pressed: "+this._pressed+" props.captureMode: "+this.props.captureMode),this._pressed&&this.props.captureMode!==c.CaptureMode.PhotoOnly&&(this._recordingAnimationView&&this._recordingAnimationView.play(),this.props.onStartRecording())},this._onPress=e=>{p.log(c.LogTraceArea.Capture,"CaptureButton _onPress disabled: "+this.props.disabled+" _onPress hidden: "+this.props.hidden+" props.onPress: "+(this.props.onPress?"ok":"null")),this.props.disabled||this.props.hidden||(this.props.captureMode===c.CaptureMode.VideoOnly||this.props.isRecording||this._updateButton(!1,!1),this._shutterAnimationView&&this._shutterAnimationView.play(),this.props.onPress&&this.props.onPress(e.timeStamp))},this._onPan=e=>{e.isComplete?(p.log(c.LogTraceArea.Capture,"CaptureButton _onPan complete"),this._panning=!1,this._onCaptureButtonPressOut()):this._panning||(this._panning=!0)},this._onPanDisabled=e=>{e.isComplete&&(p.log(c.LogTraceArea.Capture,"CaptureButton _onPanDisabled complete"),this._panning=!1)},this._onButtonRef=e=>{this._button=e||void 0}}componentWillUnmount(){super.componentWillUnmount(),h.default.unprepareFeedback()}componentDidMount(){super.componentDidMount(),this._accessibleRecordButtonPressed=!1,this._updateButton(this.props.isRecording,!0)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.props.isRecording!==e.isRecording&&(p.log(c.LogTraceArea.Capture,"CaptureButton componentDidUpdate isRecording "+e.isRecording+" -> "+this.props.isRecording),this._updateButton(this.props.isRecording,!0))}requestFocus(){this._button&&this._button.requestFocus()}_updateButton(e,t=!1,s=0,i=void 0){const o=e&&!this._accessibleRecordButtonPressed?1.5:1;!e&&this._recordingAnimationView&&this._recordingAnimationView.reset();const n=this.props.hidden?0:1;this._recordingTimeout&&(C.default.clearTimeout(this._recordingTimeout),this._recordingTimeout=void 0),t?this.props.captureMode!==c.CaptureMode.PhotoOnly&&this.props.isRecording?(a.Animated.parallel([r.timing.easeOut({value:this._captureButtonAnimatedOpacityValue,toValue:n,duration:r.Common.Duration.Short,useNativeDriver:!0}),r.timing.easeOut({value:this._captureButtonAnimatedScaleValue,toValue:o,duration:r.Common.Duration.Short,useNativeDriver:!0})]).start(),i&&(this._recordingTimeout=C.default.setTimeout((()=>{this.isComponentMounted()&&i()}),200+s))):r.timing.easeOut({value:this._captureButtonAnimatedOpacityValue,toValue:n,duration:r.Common.Duration.Short,useNativeDriver:!0}).start(i):(this.props.captureMode===c.CaptureMode.PhotoOnly&&this._captureButtonAnimatedOpacityValue.setValue(n),i&&i())}render(){const e=[_.captureButtonOuterView];let t;this.props.disabled&&e.push(_.captureButtonViewDisabled),this.props.isRecording&&(t=(0,i.jsx)(a.View,{style:[_.buttonActive,_.recordButtonActive]}));const s=[_.captureButtonContainer,v.default.absoluteFill,_.innerContainer];if(this.props.enableCameraPortraitLock){const e=a.Styles.createViewStyle({transform:[{rotate:this.props.rotate+"deg"}]},!1);s.push(e)}const r=this.props.enableAccessibleRecordButton?(0,i.jsxs)(a.Button,Object.assign({onPress:this._onAccessibleRecordButtonPress,style:_.accessibleRecordButton,accessibilityLabel:m.getString("CapturePreview.StartAndStopRecordingButton")},{children:[(0,i.jsx)(u.default,{icon:y.SkypeIcon.CallRecordDot,size:y.IconSize.size30,color:f.Color.red}),(0,i.jsx)(u.default,{icon:y.SkypeIcon.CallRecordStroke,size:y.IconSize.size30,color:f.Color.white,style:[_.accessibleRecordButtonIcon,v.default.shadowStyle]})]})):void 0,l=[_.captureButtonContainer];this.props.enableAccessibleRecordButton&&(l.push(_.captureContainerAccessibleRecord),this.props.isLandscape&&l.push(_.captureContainerAccessibleRecordLandscape));const c=this._accessibleRecordButtonPressed?a.Types.ImportantForAccessibility.NoHideDescendants:void 0;return(0,i.jsxs)(a.GestureView,Object.assign({style:l,onPan:this.props.disabled?this._onPanDisabled:this._onPan,importantForAccessibility:a.Types.ImportantForAccessibility.No},{children:[(0,i.jsx)(a.Button,Object.assign({ref:this._onButtonRef,style:_.captureButton,onPress:this._onPress,onPressIn:this._onCaptureButtonPressIn,onPressOut:this._onCaptureButtonPressOut,onLongPress:o.noop,disableTouchOpacityAnimation:!0,accessibilityLabel:this.props.captureAccessibilityLabel,importantForAccessibility:c},{children:(0,i.jsx)(a.View,Object.assign({style:e},{children:(0,i.jsxs)(a.Animated.View,Object.assign({style:[v.default.absoluteFill,_.innerContainer,this._captureButtonAnimatedStyle],blockPointerEvents:!0},{children:[(0,i.jsx)(n.default,{ref:this._onRecordingAnimationViewRef,style:s,source:S.default.CAPTURE_RECORD_PROGRESS_60_SECONDS.source,speed:59800/this.props.recordingDuration},"recordProgressIndicator"),(0,i.jsx)(a.View,Object.assign({style:[v.default.absoluteFill,_.innerContainer]},{children:(0,i.jsx)(a.Image,{style:[_.shutterButtonImage],source:d.Collection.CAPTURE_SHUTTER_BUTTON})})),(0,i.jsx)(n.default,{ref:this._onShutterAnimationViewRef,style:[v.default.absoluteFill,_.innerContainer],source:S.default.CAPTURE_PHOTO.source}),(0,i.jsx)(a.View,Object.assign({style:[v.default.absoluteFill,_.innerContainer]},{children:t}))]}),"captureButton")}))})),r]}))}}t.CaptureButton=b,t.default=b},770857:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureCoachmarksGestureView=t.CaptureCoachmarksBase=void 0;const i=s(785893),o=(s(560464),s(516778)),n=s(217041),r=s(915877),a=s(581760),l=(0,r.lazyProperties)({container:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,bottom:0,right:0,alignItems:"center",justifyContent:"center",overflow:"visible",backgroundColor:a.Color.transparent}),innerContainer:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,bottom:0,right:0,overflow:"visible"}),overlayIOS:()=>o.Styles.createViewStyle({opacity:1}),overlay:()=>o.Styles.createViewStyle({backgroundColor:a.Color.blackOverlay50}),coachmarksGestureView:()=>o.Styles.createViewStyle({position:"absolute",bottom:0,right:0,left:0,top:0,backgroundColor:a.Color.transparent})});class d extends n.ComponentBase{constructor(){super(...arguments),this._hasBeenDismissed=!1,this._backgroundAnimatedOpacityValue=new o.Animated.Value(1),this._backgroundAnimatedOpacityStyle=o.Styles.createAnimatedViewStyle({opacity:this._backgroundAnimatedOpacityValue}),this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss()},this._onContainerLayout=e=>{}}componentDidMount(){super.componentDidMount(),o.Animated.timing(this._backgroundAnimatedOpacityValue,{toValue:1,duration:500,easing:o.Animated.Easing.InOut()}).start()}dismiss(){this._hasBeenDismissed||(this.isComponentMounted()?o.Animated.timing(this._backgroundAnimatedOpacityValue,{toValue:0,duration:500,easing:o.Animated.Easing.InOut()}).start(this._onDismiss):this._onDismiss(),this._hasBeenDismissed=!0)}render(){let e;return this.props.hideOverlay||(e=(0,i.jsx)(o.View,{style:[l.innerContainer,l.overlay]})),(0,i.jsxs)(o.Animated.View,Object.assign({style:[l.container,this._backgroundAnimatedOpacityStyle],onLayout:this._onContainerLayout,ignorePointerEvents:!0},{children:[e,this._renderCoachmarks()]}))}}t.CaptureCoachmarksBase=d;class c extends n.ComponentBase{constructor(){super(...arguments),this._isDismissed=!1,this._onDismiss=()=>{this._isDismissed||(this.props.onDismiss(),this._isDismissed=!0)}}render(){return(0,i.jsx)(o.GestureView,{style:l.coachmarksGestureView,onTap:this._onDismiss,onPan:this._onDismiss,releaseOnRequest:!0})}}t.CaptureCoachmarksGestureView=c,t.default=d},65159:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureComboView=t.PresentationAnimationType=void 0;const i=s(785893),o=s(496486),n=s(583367),r=s(823113),a=s(516778),l=s(996074),d=s(994224),c=s(301065),h=s(723303),u=s(614980),p=s(459037),g=s(469198),m=s(803056),S=s(746096),f=s(436237),y=s(915877),v=s(572071),C=s(381157),_=s(206286),b=s(445026),T=s(581736),M=s(29130),I=s(581760),w=s(478262),P=s(680837),k=s(912770),A=s(853374),x=s(73877);var R;!function(e){e[e.Fade=1]="Fade"}(R=t.PresentationAnimationType||(t.PresentationAnimationType={}));const O=(0,y.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,backgroundColor:I.Color.black}),captureView:()=>a.Styles.createViewStyle({flex:1,backgroundColor:I.Color.black,overflow:"visible"}),mediaPickerWrapper:()=>P.default.absoluteFill});class L extends l.default{constructor(){super(...arguments),this._animatedPresentationOpacityValue=new a.Animated.Value(0),this._animatedPresentationStyle=a.Styles.createAnimatedViewStyle({opacity:this._animatedPresentationOpacityValue}),this._animatedOpacityValue=new a.Animated.Value(0),this._animatedOpacityStyle=a.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue}),this._onBackPressed=()=>{const e=A.default.newCauseId();f.log(S.LogTraceArea.Capture,"CaptureComboView._onBackPressed, causeId: "+e);const t=()=>{this.props.onBackPressed&&this.props.onBackPressed()||u.closeCaptureCombo(e,this._getContext())};return this.props.presentationAnimationType===R.Fade?b.default.timing(this._animatedPresentationOpacityValue,{toValue:0,duration:100,easing:a.Animated.Easing.Out(),useNativeDriver:!0}).start(t):t(),!0},this._onHandleMediaEditorParams=e=>{const t=A.default.newCauseId();return f.log(S.LogTraceArea.Capture,"CaptureComboView._onHandleMediaEditorParams, causeId: "+t),this.props.onHandleEditMediaSelection?this.props.onHandleEditMediaSelection(e):this.isComponentMounted()&&this.setState({previewParams:e,cameraMode:void 0,preventAccessibilityFocusMediaPicker:!0}),!0},this._onHandleCaptureParams=(e,t)=>(this.isComponentMounted()&&this.setState({previewParams:[e],cameraMode:t}),!0),this._onHandleMediaPicker=e=>(this.props.onWillShowMediaPicker&&this.props.onWillShowMediaPicker(),this.state.shouldRenderMediaPicker?this._mediaPickerPanel&&(this._mediaPickerPanel.expandOrCollapse(!0),this.setState({preventAccessibilityFocusCapture:!0})):this.setState({shouldRenderMediaPicker:!0},(()=>{this._mediaPickerPanel&&this._mediaPickerPanel.expandOrCollapse(!0)})),!0),this._onMediaPickerExpanded=e=>{if(this.state.shouldRenderMediaPicker&&this.props.onFocusOnCameraOrMediaPicker){const t=this._shouldRenderPreview()||e;this.props.onFocusOnCameraOrMediaPicker(t)}},this._onPreviewReject=e=>{const t=o.isUndefined(e)?this.state.previewParams&&!!this.state.previewParams[0].mediaSelection:e===S.PostSource.MediaPicker;this.setState({previewParams:[],preventAccessibilityFocusMediaPicker:!1,discardCameraTempFiles:!0},(()=>{t&&this._mediaPickerPanel&&this._mediaPickerPanel.expandOrCollapse(!0),this._onFocusOnCamera(!1)}))},this._onMediaPickerPanelRef=e=>{this._mediaPickerPanel=e||void 0},this._onCapturePanelRef=e=>{this._capturePanel=e||void 0},this._onCapturePreviewRef=e=>{this._capturePreview=e||void 0},this._onCaptureMultiPreviewRef=e=>{this._captureMultiPreview=e||void 0},this._goBack=e=>(f.log(S.LogTraceArea.Capture,"CaptureComboView._goBack, causeId: "+e),!(!this._capturePreview||!this._capturePreview.handleBackAction())||(!(!this._captureMultiPreview||!this._captureMultiPreview.handleBackAction())||(this._shouldRenderPreview()?(this._onPreviewReject(),!0):!(!this._mediaPickerPanel||!this._mediaPickerPanel.handleBackAction())||(!(!this._capturePanel||!this._capturePanel.handleBackAction())||(this.props.isInline?C.default.hideProcessingDialog(!1):this._onBackPressed()))))),this._mediaPickerClosed=()=>{this.setState({preventAccessibilityFocusCapture:!1})},this._onSendFlowComplete=()=>{this.props.onSendFlowWillComplete&&this.props.onSendFlowWillComplete(),this._intOnSendFlowComplete()},this._onFocusOnCamera=e=>{this.isComponentMounted()&&this.state.focusOnCamera!==e&&this.setState({focusOnCamera:e}),this.props.onFocusOnCameraOrMediaPicker&&this.props.onFocusOnCameraOrMediaPicker(this._shouldRenderPreview()||e)}}_buildState(e,t){const s=this._getRootViewId(),i={isLandscape:M.default.getDeviceOrientation(s)===n.DeviceOrientation.Landscape,isConnectedToCall:d.default.CallingStore.hasConnectedCalls(),hasMediaPickerPermissions:T.default.permissionStatus(w.PermissionType.CameraRoll)===r.PermissionStatus.Granted};return t&&(i.cameraMode=void 0,i.previewParams=[],i.shouldRenderMediaPicker=!!e.isInline&&!!e.isVisible&&i.hasMediaPickerPermissions,i.focusOnCamera=!1,i.sendingPhoto=!1,i.discardCameraTempFiles=!1),i}componentDidMount(){super.componentDidMount(),this.props.isInline||k.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({shouldRenderMediaPicker:!0})}),400),this.props.presentationAnimationType===R.Fade&&b.default.timing(this._animatedPresentationOpacityValue,{toValue:1,duration:100,easing:a.Animated.Easing.Out(),useNativeDriver:!0}).start(),(this.props.mediaPickerShouldCollapseFully||this.props.disableMediaPicker)&&this._animatedOpacityValue.setValue(1)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.shouldRenderMediaPicker&&!t.shouldRenderMediaPicker&&a.Animated.timing(this._animatedOpacityValue,{toValue:1,duration:200,easing:a.Animated.Easing.Out()}).start(),this.props.isInline&&e.isVisible!==this.props.isVisible&&(this.props.isVisible?this.setState({shouldRenderMediaPicker:this.state.hasMediaPickerPermissions}):this.setState({shouldRenderMediaPicker:!1})),this.props.onFocusOnCameraOrMediaPicker&&this.props.onFocusOnCameraOrMediaPicker(this._shouldRenderPreview())}_componentId(){return"CaptureComboView"}_intOnSendFlowComplete(){const e=A.default.newCauseId();f.log(S.LogTraceArea.Capture,"CaptureComboView._intOnSendFlowComplete, causeId: "+e),this.isComponentMounted()&&!this.props.willDismissOnSend&&this.setState({previewParams:[],sendingPhoto:!1}),this.props.onSendFlowComplete?this.props.onSendFlowComplete():u.closeCaptureCombo(e,this._getContext())}_shouldRenderPreview(e){return(e||this.state).previewParams.length>0}_shouldShowCamera(e,t){return!e.mediaPickerOnly&&!this._shouldRenderPreview(t)}render(){const e=o.isUndefined(this.props.isVisible)||this.props.isVisible,t=!this.props.disableMediaPicker&&(!this.props.isInline||e),s=this.props.opacityStyle||(this.props.isInline?void 0:this._animatedOpacityStyle),n=this.props.mediaPickerShouldCollapseFully||this.props.disableMediaPicker?0:this.state.isLandscape?-60:x.default.measureWindow(this._getRootViewId()).width/4*1.2;let r;t&&(r=(0,i.jsx)(a.View,Object.assign({style:O.mediaPickerWrapper,ignorePointerEvents:!0},{children:(0,i.jsx)(v.default,{ref:this._onMediaPickerPanelRef,conversationId:this.props.reactionsConversationId||this.props.conversationId,allowVideo:this.props.allowVideo,mediaPickerMode:this.props.mediaPickerOnly?c.MediaPickerMode.Inline:c.MediaPickerMode.InlinePeekaboo,allowMultiple:this.props.allowMultiple,defaultToAlbums:this.props.mediaPickerOnly&&this.props.defaultToAlbums,pauseLoading:!this.state.shouldRenderMediaPicker,capturedContentHandler:this.props.capturedContentHandler,thumbnailPeek:n,hidden:this.state.focusOnCamera||!this.props.mediaPickerOnly&&!this.state.shouldRenderMediaPicker||this._shouldRenderPreview(),overrideStatusBar:this.props.isInline,onExpanded:this._onMediaPickerExpanded,onHandleEditMediaSelection:this._onHandleMediaEditorParams,onSendFlowComplete:this._onSendFlowComplete,onBackPressed:this._onBackPressed,onClose:this._mediaPickerClosed,screenChangeOnSelection:!(this.props.mediaPickerOnly&&this.props.allowMultiple),preventAccessibilityFocus:this.state.preventAccessibilityFocusMediaPicker})}),"mediapicker"));const l=this._shouldShowCamera(this.props,this.state);let d;l&&(d=[O.captureView]);const u=l?(0,i.jsx)(p.default,{ref:this._onCapturePanelRef,style:d,captureMode:this.props.captureMode||S.CaptureMode.Default,capturedContentHandler:this.props.capturedContentHandler,conversationId:this.props.conversationId,reactionsConversationId:this.props.reactionsConversationId,isFocussedCamera:o.isUndefined(this.props.isFocussedCamera)||this.props.isFocussedCamera,isVisible:e,disableMediaPicker:this.props.disableMediaPicker,bottomControlsInset:Math.max(n,0),disableBackgroundCameraRelease:this.props.disableBackgroundCameraRelease,skipShareWithPanel:this.props.skipShareWithPanel||!!this.props.conversationId,showCoachmarksIfNeeded:this.props.showCoachmarksIfNeeded,isConnectedToCall:this.state.isConnectedToCall,adjustLayoutForDeviceOrientation:o.isUndefined(this.props.adjustLayoutForDeviceOrientation)||this.props.adjustLayoutForDeviceOrientation,opacityStyle:s,secondaryOpacityStyle:this.props.secondaryOpacityStyle,closeInsteadOfBackButton:!this.props.useBackArrow,preventAccessibilityFocus:this.state.preventAccessibilityFocusCapture,ignoreBottomSafeArea:this.props.ignoreBottomSafeArea,discardTempFilesFromPreviousSession:this.state.discardCameraTempFiles,onHandleCapture:this._onHandleCaptureParams,onHandleMediaPicker:this._onHandleMediaPicker,onCaptureFlowComplete:this._onSendFlowComplete,onFocusOnCamera:this._onFocusOnCamera,onBackPressed:this._onBackPressed,onTap:this.props.onCameraTapped},"capture"):void 0;let f;if(1===this.state.previewParams.length){const e=this.state.previewParams[0];f=(0,i.jsx)(g.default,{ref:this._onCapturePreviewRef,fileSize:e.fileSize,mediaWidth:e.width||0,mediaHeight:e.height||0,localMediaIsVideo:e.localMediaIsVideo,localMediaThumbnailUri:e.localMediaThumbnailUri,localMediaObjectUri:e.localMediaObjectUri,skipShareWithPanel:e.skipShareWithPanel,performMarkupOnly:this.props.performMarkupOnly,onCaptureFlowComplete:e.onCaptureFlowComplete,conversationId:e.conversationId,parentConversationId:this.props.conversationId,callId:e.callId,mediaSelection:e.mediaSelection,cameraMode:this.state.cameraMode,unlockOrientation:!0,disableCoachmarks:!0,capturedContentHandler:e.capturedContentHandler,captureSessionTelemetry:e.captureSessionTelemetry,entryPoint:e.mediaSelection?S.PostSource.MediaPicker:S.PostSource.Capture,markupEnabled:!this.props.disableMarkup,useCompactControls:this.props.useCompactSendControls,centerCompactControls:this.state.isLandscape,inlinePreview:!0,onReject:this._onPreviewReject,opacityStyle:s,isAvatarPreview:this.props.showAvatarOverlay,ignoreBottomSafeArea:this.props.ignoreBottomSafeArea,showCoachmarksIfNeeded:this.props.showCoachmarksIfNeeded,orientationLockKey:e.orientationLockKey})}this.state.previewParams.length>1&&this.props.conversationId&&_.default.isMediaPreviewEnabled(this.props.conversationId)&&(f=(0,i.jsx)(h.default,{ref:this._onCaptureMultiPreviewRef,mediaPreviews:this.state.previewParams,conversationId:this.props.conversationId,onReject:this._onPreviewReject}));const y=[O.container,this.props.style];return this.props.presentationAnimationType&&y.push(this._animatedPresentationStyle),(0,i.jsx)(m.default,Object.assign({goBack:this._goBack},{children:(0,i.jsxs)(a.Animated.View,Object.assign({style:y},{children:[u,f,r]}))}))}}t.CaptureComboView=L,t.default=L},632827:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(147204),n=s(898278),r=s(273865),a=s(65159),l="captureComboView";class d{static show(e,t,s){const n=e.onSendFlowComplete?d._sendFlowComplete(e.onSendFlowComplete):d.close,c=(0,i.jsx)(r.default,Object.assign({onDismiss:s},{children:(0,i.jsx)(a.default,{capturedContentHandler:e.capturedContentHandler,conversationId:e.conversationId,allowVideo:e.allowVideo,mediaPickerOnly:e.mediaPickerOnly,allowMultiple:e.allowMultiple,defaultToAlbums:e.defaultToAlbums,willDismissOnSend:e.willDismissOnSend,disableMarkup:e.disableMarkup,mediaPickerShouldCollapseFully:e.mediaPickerShouldCollapseFully,showCoachmarksIfNeeded:e.showCoachmarksIfNeeded,presentationAnimationType:a.PresentationAnimationType.Fade,disableBackgroundCameraRelease:e.disableBackgroundCameraRelease,captureMode:e.captureMode,showAvatarOverlay:e.showAvatarOverlay,performMarkupOnly:e.performMarkupOnly,disableMediaPicker:e.disableMediaPicker,onSendFlowComplete:n,onBackPressed:d.close},"captureCombo")}));o.default.showModal(c,l,t)}static _sendFlowComplete(e){return()=>{e(),d.close()}}}d.close=()=>(o.default.dismissModal(l,n.MainRootViewId),!0),t.default=d},815354:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(174958),n=s(155354),r=s(516778),a=s(272675),l=s(351885),d=s(746096),c=s(436237);class h extends l.CaptureOverlayView{constructor(){super(...arguments),this._onRenderTime=e=>{c.log(d.LogTraceArea.Capture,"CaptureFilterOverlayView._onRenderTime "+e),c.track(new a.ColorFilterRenderDurationEvent(e))},this._onFailure=e=>{c.log(d.LogTraceArea.Capture,"CaptureFilterOverlayView._onFailure "+o.pii.Omit(e)),c.track(new a.ColorFilterFailureEvent(e))}}_renderContent(){if(!this.props.captureOverlayType)return;const e=this.props.captureOverlayType.parameters;return(0,i.jsx)(n.default,{source:this.props.sourceImageUri,filter:e.filterName,filterDimension:64,style:this._imageStyle(),onFailure:this._onFailure,onRenderTime:this._onRenderTime})}_imageStyle(){return r.Styles.createViewStyle({position:"absolute",top:this.props.topOffset?Math.min(0,this.props.topOffset):0,left:0,right:0,bottom:0},!1)}}t.default=h},481547:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureMarkupColorControl=void 0;const i=s(785893),o=s(496486),n=s(588785),r=s(516778),a=s(217041),l=s(175080),d=s(915877),c=s(733754),h=s(886045),u=s(581760),p=s(640363),g=s(853374),m=[{id:"White",value:u.Color.white,stringKey:"Color.White"},{id:"Black",value:u.Color.black,stringKey:"Color.Black"},{id:"Red",value:u.Color.markupRed,stringKey:"Color.Red"},{id:"Redorange",value:u.Color.markupRedOrange,stringKey:"Color.Redorange"},{id:"Orange",value:u.Color.markupOrange,stringKey:"Color.Orange"},{id:"Yelloworange",value:u.Color.markupYellowOrange,stringKey:"Color.Yelloworange"},{id:"Yellow",value:u.Color.markupYellow,stringKey:"Color.Yellow"},{id:"Yellowgreen",value:u.Color.markupYellowGreen,stringKey:"Color.Yellowgreen"},{id:"Green",value:u.Color.markupGreen,stringKey:"Color.Green"},{id:"Bluegreen",value:u.Color.markupBlueGreen,stringKey:"Color.Bluegreen"},{id:"Blue",value:u.Color.markupBlue,stringKey:"Color.Blue"},{id:"Blueviolet",value:u.Color.markupBlueViolet,stringKey:"Color.Blueviolet"},{id:"Violet",value:u.Color.markupViolet,stringKey:"Color.Violet"},{id:"Redviolet",value:u.Color.markupRedViolet,stringKey:"Color.Redviolet"}],S=8.5,f=o.map(m,(e=>l.colorStringToRgb(e.value))),y=(0,d.lazyProperties)({innerContainer:()=>r.Styles.createViewStyle({flex:1,alignItems:"flex-start",backgroundColor:u.Color.transparent,overflow:"visible"}),gestureView:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,bottom:0,right:0,backgroundColor:u.Color.transparent}),topBorderStyle:()=>r.Styles.createViewStyle({borderTopRightRadius:4,borderTopLeftRadius:4}),bottomBorderStyle:()=>r.Styles.createViewStyle({borderBottomRightRadius:4,borderBottomLeftRadius:4}),strokePreviewSwatchBeakStyle:()=>r.Styles.createViewStyle({position:"absolute",top:8,right:-11.5,backgroundColor:u.Color.transparent})});class v extends a.ComponentBase{constructor(){super(...arguments),this._strokePreviewAnimatedTopValue=new r.Animated.Value(0),this._strokePreviewAnimatedStyle=r.Styles.createAnimatedViewStyle({top:this._strokePreviewAnimatedTopValue}),this._onLayoutChange=e=>{this.setState({viewDimensions:{width:e.width,height:e.height}})},this._onTap=e=>{const t=this._getColorAtPosition(e.pageY);this._updateColor(t.color,0===t.index)},this._onPan=e=>{const t=e.pageY-this.props.gestureRect.y;if((t<0||t>this.state.viewDimensions.height)&&!e.isComplete)return;const s=this._getColorAtPosition(e.pageY);if(this.props.colorOnly)this._updateColor(s.color,s.index<=0),this._updateStrokePreview(!e.isComplete,t-19.5);else{const i=this._getStrokeWidthAtPosition(e.pageX-this.props.gestureRect.x);this._updateColorAndStroke(s.color,s.index<=0,i),this._updateStrokePreview(!e.isComplete,t-i/2)}}}_buildState(e,t){const s={};return t&&(s.viewDimensions={width:0,height:0},s.showStrokePreview=!1,s.selectedColor=m[0],s.strokeWidth=5),s}_updateColor(e,t){this._announceForAccessibilityIfNeeded(e),e!==this.state.selectedColor&&(this.props.onColorSelected(e,t),this.setState({selectedColor:e}))}_updateColorAndStroke(e,t,s){this._announceForAccessibilityIfNeeded(e),e===this.state.selectedColor&&s===this.state.strokeWidth||(this.props.onColorSelected(e,t,s),this.setState({selectedColor:e,strokeWidth:s}))}_announceForAccessibilityIfNeeded(e){if(h.default.shouldAnnounceForAccessibility()&&this.state.selectedColor.id!==e.id){const t=c.getString(e.stringKey),s=c.getString("CapturePreview.PenColorChange",{color:t});r.Accessibility.announceForAccessibility(s)}}_renderColorPicker(){const e=o.map(m,((e,t)=>{const s=c.getString("CapturePreview.PenColorChange",{color:c.getString(e.stringKey)});return(0,i.jsx)(r.Button,{importantForAccessibility:r.Types.ImportantForAccessibility.Yes,accessibilityLabel:s,style:[this._getColorStyle(e.value),0===t?y.topBorderStyle:void 0,t===m.length-1?y.bottomBorderStyle:void 0]},e.value)}));return(0,i.jsxs)(r.View,Object.assign({onLayout:this._onLayoutChange,style:y.innerContainer},{children:[e,(0,i.jsx)(r.GestureView,{style:y.gestureView,onPan:this._onPan,onTap:this._onTap,importantForAccessibility:r.Types.ImportantForAccessibility.No})]}))}_getColorStyle(e){return r.Styles.createViewStyle({flex:1,width:16,marginLeft:4,marginVertical:-1,backgroundColor:e},!1)}_getColorAtPosition(e){const t=e-this.props.gestureRect.y,s=this.state.viewDimensions.height/f.length;let i=Math.floor(t/s);i<0&&(i=0),i>=f.length&&(i=f.length-1);let n=(t-i*s)/s;n=o.clamp(n,0,1);const r=f[i];let a,d=r;return n<.5?(d=0===i?r:f[i-1],a=l.colorBetween(d,r,n+.5)):n>=.5&&(d=i>=f.length-1?r:f[i+1],a=l.colorBetween(r,d,n-.5)),{color:{id:m[i].id,value:a?l.rgbToHex(a):u.Color.white,stringKey:m[i].stringKey},index:i}}_getStrokeWidthAtPosition(e){const t=p.default.isRTL();return g.default.mapValue(e/this.props.gestureRect.width,t?5:40,t?40:5)}_getStrokePreviewStyle(){const e=[];return e.push(r.Styles.createViewStyle({position:"absolute",overflow:"visible",width:39,height:39,borderWidth:3,borderRadius:8,borderColor:u.Color.white,left:-65,backgroundColor:this.state.selectedColor.value},!1)),e.push(this._strokePreviewAnimatedStyle),e}_updateStrokePreview(e,t){this.state.showStrokePreview!==e&&this.setState({showStrokePreview:e}),e&&this._strokePreviewAnimatedTopValue.setValue(t)}render(){const e=this.state.showStrokePreview?(0,i.jsx)(r.Animated.View,Object.assign({style:this._getStrokePreviewStyle()},{children:(0,i.jsx)(n.ImageSvg,Object.assign({viewBox:"0 0 8.5 17",width:S,height:17,style:y.strokePreviewSwatchBeakStyle},{children:(0,i.jsx)(n.SvgPath,{d:"M 0 0 L 8.5 8.5 L 0 17 L 0 0",fillColor:u.Color.white})}))})):void 0;return(0,i.jsxs)(r.View,Object.assign({style:this.props.style},{children:[this._renderColorPicker(),e]}))}}t.CaptureMarkupColorControl=v},711208:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(217041),a=s(889391),l=s(746096),d=s(436237),c=s(915877),h=s(733754),u=s(758962),p=s(404057),g=s(581760),m=s(640363),S=s(675865),f=10,y=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",overflow:"visible",backgroundColor:g.Color.transparent}),innerContainer:()=>n.Styles.createViewStyle({flex:1,padding:f,alignItems:"center",justifyContent:"center",overflow:"visible",backgroundColor:g.Color.transparent}),imageViewContainer:()=>n.Styles.createViewStyle({height:80,width:80,overflow:"visible",backgroundColor:g.Color.transparent}),imageViewInner:()=>n.Styles.createViewStyle({position:"absolute",top:-10,left:-10,height:100,width:100,overflow:"visible"}),gestureView:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:g.Color.transparent})});class v extends r.ComponentBase{constructor(){super(...arguments),this._currentBottomValue=0,this._currentLeftValue=0,this._currentRotation=0,this._currentScale=1.7,this._animatedBottomValue=new n.Animated.Value(0),this._animatedLeftValue=new n.Animated.Value(0),this._animatedOpacityValue=new n.Animated.Value(1),this._baseAnimatedStyle=n.Styles.createAnimatedViewStyle({bottom:this._animatedBottomValue,opacity:this._animatedOpacityValue}),this._animatedStyleLTR=n.Styles.createAnimatedViewStyle({left:this._animatedLeftValue}),this._animatedStyleRTL=n.Styles.createAnimatedViewStyle({right:this._animatedLeftValue}),this._animatedRotationValue=new n.Animated.Value(0),this._animatedRotationStyle=n.Styles.createAnimatedViewStyle({transform:[{rotate:this._animatedRotationValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._animatedScaleValue=new n.Animated.Value(1.7),this._animatedScaleStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._animatedScaleValue}]}),this._onRotate=e=>{const t=e.angle-e.initialAngle;this._animatedRotationValue.setValue(this._currentRotation+t),e.isComplete&&(this._currentRotation+=t)},this._onPinchZoom=e=>{const t=e.distance/e.initialDistance,s=e.centerPageY-e.initialCenterPageY,i=e.centerPageX-e.initialCenterPageX,n={x:e.centerPageX,y:e.centerPageY};o.isUndefined(this._prePinchZoomScale)&&(this._prePinchZoomScale=this._currentScale);let r=this._prePinchZoomScale*t;r=Math.min(5.5,r),r=Math.max(.7,r),this._animatedBottomValue.setValue(this._currentBottomValue-s),this._animatedLeftValue.setValue(this._currentLeftValue+i),this._animatedScaleValue.setValue(r),this._currentScale=r,e.isComplete&&(this._prePinchZoomScale=void 0,this._currentBottomValue-=s,this._currentLeftValue+=i),this._onDrag(n,e.isComplete)},this._onPan=e=>{const t=e.pageY-e.initialPageY,s=e.pageX-e.initialPageX,i={x:e.pageX,y:e.pageY};this._animatedBottomValue.setValue(this._currentBottomValue-t),this._animatedLeftValue.setValue(this._currentLeftValue+s),e.isComplete&&(this._currentBottomValue-=t,this._currentLeftValue+=s),this._onDrag(i,e.isComplete)},this._onPanAvatar=e=>{let t=e.pageY-e.initialPageY,s=e.pageX-e.initialPageX;const i=this.props.sticker&&this.props.sticker.width?this.props.sticker.width:0,o=this.props.sticker&&this.props.sticker.height?this.props.sticker.height:0,n=this.props.sticker&&this.props.sticker.avatarSquareSize?this.props.sticker.avatarSquareSize:0,r=this._currentLeftValue+s+f,a=this._currentLeftValue+s+f-n+i,l=this._currentBottomValue-t+f,d=this._currentBottomValue-t+f-n+o;r>=0&&s>=0?(this._animatedLeftValue.setValue(-10),this._currentLeftValue=-10,s=0):a<=0&&s<=0&&(this._animatedLeftValue.setValue(n-i-f),this._currentLeftValue=n-i-f,s=0),l>=0&&t<=0?(this._animatedBottomValue.setValue(-10),this._currentBottomValue=-10,t=0):d<=0&&t>=0&&(this._animatedBottomValue.setValue(n-o-f),this._currentBottomValue=n-o-f,t=0),this._animatedBottomValue.setValue(this._currentBottomValue-t),this._animatedLeftValue.setValue(this._currentLeftValue+s),e.isComplete&&(this._currentBottomValue-=t,this._currentLeftValue+=s)},this._onDoubleTap=e=>{this._removeSticker()},this._onImageLoaded=()=>{d.log(l.LogTraceArea.Capture,"CaptureMarkupSticker load success: "+this.props.stickerKey)},this._onImageError=e=>{d.log(l.LogTraceArea.Capture,"CaptureMarkupSticker load error: "+this.props.stickerKey+": "+p.default.errorAsString(e))}}_buildState(e,t){const{rewriteRules:s}=a.default.getConfigSettings().pes;let i=e.sticker?e.sticker.fullUrl:void 0;if(!i&&e.sticker&&e.sticker.baseUrl){const t=`${u.rewriteUrl(e.sticker.baseUrl,s)}/views/large?etag=${e.sticker.etag?e.sticker.etag:"v1"}`;i=S.default.getAuthenticatedUrl(t)}return{stickerUrl:i}}componentDidMount(){super.componentDidMount();const e=this.props.sticker&&this.props.sticker.width?this.props.sticker.width:u.frameHeights.emoticons.Size80,t=this.props.sticker&&this.props.sticker.height?this.props.sticker.height:u.frameHeights.emoticons.Size80,s=(this.props.gestureRect.width-e)/2-f,i=(this.props.gestureRect.height-t)/2-f;this._currentBottomValue=i,this._currentLeftValue=s,this._animatedBottomValue.setValue(i),this._animatedLeftValue.setValue(s),this.props.sticker&&(this.props.sticker.width||this.props.sticker.height)&&(this._currentScale=1,this._animatedScaleValue.setValue(this._currentScale))}_removeSticker(){this.props.onRemove&&this.props.onRemove(this.props.viewKey)}_onDrag(e,t=!1){if(this.props.onDragView){let s=1;this.props.onDragView(!t,e)&&(t?this._removeSticker():s=.5),this._animatedOpacityValue.setValue(s)}}render(){let e;this.props.allowsSelection&&(e=this.props.sticker&&this.props.sticker.isAvatar?(0,i.jsx)(n.GestureView,{style:y.gestureView,onPan:this._onPanAvatar,releaseOnRequest:!1,accessibilityLabel:h.getString("CapturePreview.ImageTitle")}):(0,i.jsx)(n.GestureView,{style:y.gestureView,onPan:this._onPan,onPinchZoom:this._onPinchZoom,onRotate:this._onRotate,onDoubleTap:this._onDoubleTap,releaseOnRequest:!1}));const t=[y.container,this._baseAnimatedStyle,this._animatedScaleStyle,m.default.isRTL()?this._animatedStyleRTL:this._animatedStyleLTR],s=this.props.sticker&&(this.props.sticker.height||this.props.sticker.width)?n.Styles.createViewStyle({height:this.props.sticker.height,width:this.props.sticker.width,top:0,left:0},!1):void 0,o=[y.imageViewContainer],r=[y.imageViewInner];s&&(o.push(s),r.push(s));const a=this.state.stickerUrl?(0,i.jsx)(n.View,Object.assign({style:o,blockPointerEvents:!0},{children:(0,i.jsx)(n.Image,{style:r,source:this.state.stickerUrl,onError:this._onImageError,onLoad:this._onImageLoaded})})):void 0;return(0,i.jsx)(n.Animated.View,Object.assign({style:t,blockPointerEvents:!this.props.allowsSelection},{children:(0,i.jsxs)(n.Animated.View,Object.assign({style:[y.innerContainer,this._animatedRotationStyle]},{children:[a,e]}))}))}}t.default=v},39225:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(163001),r=s(516778),a=s(711930),l=s(898278),d=s(677381),c=s(746096),h=s(110117),u=s(436237),p=s(915877),g=s(733754),m=s(706250),S=s(696168),f=s(617707),y=s(75821),v=s(431234),C=s(451070),_=s(681115),b=s(422538),T=s(2544),M=s(713130),I=s(915415),w=s(581760),P=s(640363),k=s(711828),A=s(680837),x=s(619675),R=s(853374),O=s(73877);n.PesListView;n.PesTabView;const L=n.PesTabView,F=n.PesListView,B=(0,p.lazyProperties)({paddingStyle:()=>r.Styles.createViewStyle({paddingHorizontal:5}),pesScrollContainerBase:()=>r.Styles.createViewStyle({backgroundColor:w.Color.blackOverlay70,alignSelf:"stretch"}),pesScrollContainerMobile:()=>r.Styles.createViewStyle({flex:1,backgroundColor:w.Color.transparent}),sectionTitle:()=>r.Styles.createViewStyle({alignSelf:"stretch",backgroundColor:w.Color.transparent,marginBottom:4}),sectionTitleText:()=>r.Styles.createTextStyle({color:w.Color.white,margin:4}),centeredContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",backgroundColor:w.Color.transparent,alignItems:"center",justifyContent:"center",position:"absolute",top:0,bottom:0,left:0,right:0}),errorIconContainer:()=>r.Styles.createViewStyle({alignItems:"center",justifyContent:"center",paddingBottom:30}),errorTextStyle:()=>r.Styles.createTextStyle({color:w.Color.white,textAlign:"center"}),messageContainer:()=>r.Styles.createViewStyle({flex:1,justifyContent:"center",alignItems:"center"}),messageText:()=>r.Styles.createTextStyle({color:w.Color.white,textAlign:"center",marginHorizontal:40}),container:()=>r.Styles.createViewStyle({backgroundColor:w.Color.blackOverlay50}),flippedView:()=>r.Styles.createViewStyle({transform:[{scaleX:-1}]})});class D extends d.default{constructor(){super(...arguments),this._headerRefsMap=new m.default,this._cachedDimensions={},this._setTabViewRef=e=>{this._tabView=e||void 0},this._setTabIndicatorRef=e=>{this._tabIndicator=e||void 0},this._renderTabContent=e=>{const t=this._reverseLayout();if(e.id===v.default.recentTabId&&0===e.packs.length){const e=[B.messageContainer];return t&&e.push(B.flippedView),(0,i.jsx)(r.View,Object.assign({style:e},{children:(0,i.jsx)(r.Text,Object.assign({style:B.messageText},{children:this._getEmptyRecentMessage()}))}))}const s=[B.pesScrollContainerBase,B.pesScrollContainerMobile,B.paddingStyle],n=A.default.flexOne;t&&s.push(B.flippedView),_.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets)&&s.push(_.default.horizontalPaddingStyle(this.state.safeAreaHorizontalInsets));const a={};o.each(e.packs,(e=>(a[e.id]=o.filter(e.items,(e=>!!this.state.items[e])),a)));const l=this._getItemHeight(),d=this._getNumberOfColumns();return(0,i.jsx)(r.View,Object.assign({style:s},{children:(0,i.jsx)(F,{packs:a,renderPackHeader:this._renderPackHeader,renderPackItem:this._renderPesItem,style:n,itemHeight:l,numberOfColumns:d})}))},this._renderPackHeader=e=>{const t=this.state.packs[e],s=a.default.headerAccessibilityInfo(t.title);return(0,i.jsx)(r.View,Object.assign({ref:this._headerRefsMap.onComponentRef(e),style:B.sectionTitle,accessibilityTraits:s.accessibilityTraits,accessibilityLabel:s.accessibilityLabel,importantForAccessibility:r.Types.ImportantForAccessibility.Yes},{children:(0,i.jsx)(x.Subtitle,Object.assign({style:B.sectionTitleText,numberOfLines:1},{children:t.title}))}),"sectionTitle")},this._renderPesItem=e=>{const t=this.state.items[e];if(!t)return u.warn(c.LogTraceArea.Pes,`Sticker with id ${e} not found`),null;const s=this._getItemDimension(),o=!!this.state.hoverItem&&this.state.hoverItem.id===t.id;return(0,i.jsx)(T.StickerItem,{id:t.id,info:t,isSelected:o,renderMobileInterface:!0,onHover:this._onPesHover,onSelected:this._onSelected,dimension:s,showPlaceholder:!0,numberInGroupAccessibilityLabel:!0},t.id)},this._onSelected=e=>{this.props.onStickerSelected&&this.props.onStickerSelected(e,{tabTitle:this._currentTabTitle,stickerName:e.name}),this.props.onClose&&this.props.onClose()},this._onPesHover=e=>{this.setState({hoverItem:e})},this._onTabSelected=e=>{this._currentTabTitle=e.title;const t=o.findIndex(this.state.tabs,(t=>t.id===e.id));this._tabView&&this._tabView.showTab(this.state.tabs[t]),this._tabIndicator&&this._tabIndicator.onPageSelected({position:t});const s=e.packs.length>0?e.packs[0].id:void 0;s&&o.defer((()=>{if(!this.isComponentMounted())return;const e=this._headerRefsMap.ref(s);e&&e.requestFocus()}))}}_buildState(e,t){const s=S.default.getCaptureStickerTabs(),i=S.default.getLoadingStatus();s.unshift(v.default.getRecentStickerInCaptureTabInfo()),this._reverseLayout()&&o.reverse(s);const n={},r={};o.each(s,(e=>{o.each(e.packs,(e=>{n[e.id]=e,o.each(e.items,(e=>{const t=this._getPesItem(e);t&&(o.isUndefined(t.visible)||t.visible)&&(r[t.id]=t)}))}))}));const a=C.default.horizontalInsets(l.HorizontalInsetDefault),d=O.default.measureWindow(this._getRootViewId()).width-a.left-a.right-16;return{tabs:s,packs:n,items:r,loadingStatus:i,safeAreaHorizontalInsets:a,bottomSafeAreaInset:C.default.bottomSafeAreaInset(l.BottomInsetDefault),availableWidth:d}}componentDidMount(){super.componentDidMount();const e=R.default.newCauseId();this.state.loadingStatus===S.PesConfigLoadingStatus.NotStarted?b.EnsureStarted(f.default).then((()=>f.default.refreshConfig(e))):this.state.loadingStatus===S.PesConfigLoadingStatus.Loading&&f.default.refreshConfig(e)}render(){const e=[B.container,this.props.style];if(o.isEmpty(this.state.tabs)){let t;return this.state.loadingStatus===S.PesConfigLoadingStatus.Loading?(e.push(B.centeredContainer),t=(0,i.jsx)(I.default,{size:l.SXActivityIndicatorSize.Large,tintColor:w.Color.white,useRXIndicator:!0})):t=this._getPickerErrorScreen(),(0,i.jsx)(r.View,Object.assign({style:e},{children:t}))}const t=this._reverseLayout(),s=[];return this.state.safeAreaHorizontalPaddingStyle&&s.push(this.state.safeAreaHorizontalPaddingStyle),this.state.bottomSafeAreaInset&&s.push(_.default.paddingBottomStyle(this.state.bottomSafeAreaInset)),(0,i.jsxs)(r.View,Object.assign({style:e},{children:[(0,i.jsx)(L,{style:t?B.flippedView:void 0,initialTab:this._getInitialTab(),ref:this._setTabViewRef,tabs:this.state.tabs,renderTab:this._renderTabContent,onTabSelected:this._onTabSelected,tabOrderReversed:t,removeHiddenItems:!1}),(0,i.jsx)(y.default,{style:s,transparentTheme:!0,initialTab:this._getInitialTab(),ref:this._setTabIndicatorRef,tabs:this.state.tabs,reversed:t,onTabSelected:this._onTabSelected})]}),"PesPickerContainer")}_reverseLayout(){return this._getContext().isRTL&&P.default.getPlatformType()===c.PlatformType.Android}_getItemDimension(){const e=this.state.availableWidth;if(this._cachedDimensions[e])return this._cachedDimensions[e];const t=Math.round(e/106),s=Math.max(3,t);return this._cachedDimensions[e]=Math.ceil(e/s)-1-6,this._cachedDimensions[e]}_getItemHeight(){return this._getItemDimension()}_getNumberOfColumns(){const e=this._getItemDimension();return Math.floor(this.state.availableWidth/e)}_getInitialTab(){if(this.state.tabs&&this.state.tabs.length>=2){const e=this.state.tabs[1];return this._currentTabTitle=e.title,e}}_getEmptyRecentMessage(){return g.getString("PesPicker.EmptyRecentStickers")}_getPickerErrorScreen(){const e=[B.centeredContainer];return e.push(B.paddingStyle),(0,i.jsxs)(r.View,Object.assign({style:e},{children:[(0,i.jsx)(r.View,Object.assign({style:B.errorIconContainer},{children:(0,i.jsx)(h.default,{icon:k.SkypeIcon.MojiDeleted,size:k.IconSize.size60,color:w.Color.white})})),(0,i.jsx)(x.BodyText,Object.assign({style:B.errorTextStyle},{children:g.getString("MediaBar.StickerPickerErrorText")}))]}))}_getPesItem(e){return M.default.getSticker(e)}}t.default=D},628580:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(217041),a=s(139285),l=s(710400),d=s(915877),c=s(733754),h=s(581760),u=s(640363),p=s(311010),g=p.default.controlFontSize.h2,m=p.default.controlFontSize.captureMarkupText,S=(0,d.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",flexDirection:"row",overflow:"visible"}),innerContainer:()=>n.Styles.createViewStyle({flex:1,overflow:"visible"}),gestureView:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:h.Color.transparent}),gestureViewIOSLarge:()=>n.Styles.createViewStyle({bottom:74}),textInputAbsolute:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,flex:1,flexDirection:"row",overflow:"visible"}),textInputAndMirrorShared:()=>n.Styles.createTextInputStyle({paddingVertical:0,paddingHorizontal:0,font:p.default.font.uiDisplayRegular,fontSize:m,wordBreak:"break-word",color:h.Color.white,textAlign:"center",backgroundColor:h.Color.transparent,overflow:"visible"}),textInputAndMirrorSharedIOS:()=>n.Styles.createTextInputStyle({paddingVertical:4}),textInputAndMirrorSharedLarge:()=>n.Styles.createTextInputStyle({fontSize:g,font:p.default.font.uiDisplayBold}),textInput:()=>n.Styles.createTextInputStyle({position:"absolute",top:0,left:0,right:0,bottom:0,flexDirection:"row"}),mirrorText:()=>n.Styles.createTextInputStyle({paddingVertical:4,opacity:0}),mirrorTextIOS:()=>n.Styles.createTextInputStyle({paddingTop:4,marginTop:-14,paddingBottom:18}),compositionArea:()=>n.Styles.createViewStyle({flex:1,overflow:"visible"}),compositionAreaIOSLarge:()=>n.Styles.createViewStyle({paddingVertical:16,marginBottom:-74})});class f extends r.ComponentBase{constructor(){super(...arguments),this._backgroundDimensions={height:0,width:0},this._focusChanging=!1,this._currentBottomValue=0,this._currentLeftValue=0,this._currentScale=1,this._currentRotation=0,this._animatedBottomValue=new n.Animated.Value(0),this._animatedLeftValue=new n.Animated.Value(0),this._animatedOpacityValue=new n.Animated.Value(1),this._baseAnimatedStyle=n.Styles.createAnimatedViewStyle({bottom:this._animatedBottomValue,opacity:this._animatedOpacityValue}),this._animatedStyleLTR=n.Styles.createAnimatedViewStyle({left:this._animatedLeftValue}),this._animatedStyleRTL=n.Styles.createAnimatedViewStyle({right:this._animatedLeftValue}),this._animatedRotationValue=new n.Animated.Value(0),this._animatedRotationStyle=n.Styles.createAnimatedViewStyle({transform:[{rotate:this._animatedRotationValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._animatedScaleValue=new n.Animated.Value(1),this._animatedScaleStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._animatedScaleValue}]}),this._onFocus=e=>{this._focusChanging=!1,this.setState({hasFocus:!0})},this._onBlur=()=>{this._focusChanging=!1,this.setState({hasFocus:!1})},this._onInput=e=>{this.setState({text:e}),this.props.onTextInput&&this.props.onTextInput(e)},this._onRotate=e=>{const t=e.angle-e.initialAngle,s=this._selectedRotation||0;this._animatedRotationValue.setValue(s+t),e.isComplete&&(this._currentRotation+=t,this._selectedRotation=this._currentRotation)},this._onPinchZoom=e=>{const t=e.distance/e.initialDistance,s=e.centerPageY-e.initialCenterPageY,i=e.centerPageX-e.initialCenterPageX,n={x:e.centerPageX,y:e.centerPageY},r=this._currentBottomValue-s,a=this._currentLeftValue+i;this._animatedBottomValue.setValue(r),this._animatedLeftValue.setValue(a),o.isUndefined(this._prePinchZoomScale)&&(this._prePinchZoomScale=this._currentScale);const l=this._prePinchZoomScale||1,d=Math.min(3,l*t);this._animatedScaleValue.setValue(d),this._currentScale=d,e.isComplete&&(this._currentBottomValue=r,this._currentLeftValue=a,this._selectedBottomValue=this._currentBottomValue,this._selectedLeftValue=this._currentLeftValue,this._selectedScale=this._currentScale,this._prePinchZoomScale=void 0),this._onDrag(n,e.isComplete)},this._onPan=e=>{const t=e.pageY-e.initialPageY,s=e.pageX-e.initialPageX,i={x:e.pageX,y:e.pageY},o=this._currentBottomValue-t,n=this._currentLeftValue+s;this._animatedBottomValue.setValue(o),this._animatedLeftValue.setValue(n),e.isComplete&&(this._currentBottomValue=o,this._currentLeftValue=n,this._selectedBottomValue=this._currentBottomValue,this._selectedLeftValue=this._currentLeftValue),this._onDrag(i,e.isComplete)},this._onTap=e=>{this.state.hasFocus||this.requestFocus()},this._onTextInputRef=e=>{this._textInput=e||void 0}}_buildState(e,t){const s={resizeMode:l.default.getResizeMode(),keyboardUpdateInfo:l.default.getUpdateInfo()};return t&&(s.hasFocus=!1,s.text="",s.selectedColor=void 0),s}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),this.props.onFocusChanged&&t.hasFocus!==this.state.hasFocus&&this.props.onFocusChanged(t.hasFocus),!this._focusChanging){let e,s,i,n;0!==t.keyboardUpdateInfo.height?(e=t.keyboardUpdateInfo.height+(this.props.bottomOffset||0),s=0,i=1,n=0):(e=o.isUndefined(this._selectedBottomValue)?this._currentBottomValue:this._selectedBottomValue,e=this._clampBottomValue(e),s=o.isUndefined(this._selectedLeftValue)?this._currentLeftValue:this._selectedLeftValue,i=o.isUndefined(this._selectedScale)?this._currentScale:this._selectedScale,n=o.isUndefined(this._selectedRotation)?this._currentRotation:this._selectedRotation),this._currentBottomValue=e,this._currentLeftValue=s,this._currentScale=i,this._currentRotation=n,this._animatedBottomValue.setValue(e),this._animatedLeftValue.setValue(s),this._animatedScaleValue.setValue(i),this._animatedRotationValue.setValue(n)}if(this.props.onHasText){const e=this._hasText(t);if(e!==this._hasText(this.state)||t.hasFocus!==this.state.hasFocus){const s=!e&&!t.hasFocus;this.props.onHasText(e,s)}}0===t.keyboardUpdateInfo.height&&this.state.keyboardUpdateInfo.height!==t.keyboardUpdateInfo.height&&this.blur()}requestFocus(){this._textInput&&!this.state.hasFocus&&(this._focusChanging=!0,this._textInput.requestFocus())}blur(){this._textInput&&this.state.hasFocus&&(this._focusChanging=!0,this._textInput.blur())}resetPosition(){this._selectedScale=void 0,this._selectedBottomValue=void 0,this._selectedLeftValue=void 0,this._selectedRotation=void 0}setColor(e){this.state.selectedColor!==e&&this.setState({selectedColor:e})}_hasText(e){return!(!e||!e.text)&&e.text.length>0}_onDrag(e,t=!1){if(this.props.onDragView){let s=1;if(this.props.onDragView(!t,e))t?(this.setState({text:void 0}),this.props.onHasText&&this.props.onHasText(!1,!0)):s=.5;else if(t){const e=this._clampBottomValue(this._currentBottomValue);e!==this._currentBottomValue&&(this._currentBottomValue=e,this._selectedBottomValue=this._currentBottomValue,n.Animated.timing(this._animatedBottomValue,{toValue:this._currentBottomValue,duration:150,easing:n.Animated.Easing.OutBack()}).start())}this._animatedOpacityValue.setValue(s)}}_clampBottomValue(e){const t=this.props.gestureRect.height-this._backgroundDimensions.height;return this._currentBottomValue<0?0:this._currentBottomValue>t?t:e}_colorStyle(){const e=this.state.selectedColor?this.state.selectedColor:h.Color.white;return n.Styles.createTextInputStyle({color:e},!1)}_widthStyle(){return n.Styles.createViewStyle({width:this.props.gestureRect.width,paddingHorizontal:(this.props.horizontalInset||0)+10},!1)}render(){const e=[S.textInputAndMirrorShared],t=[S.textInputAndMirrorShared];e.push(S.textInputAndMirrorSharedLarge,S.textInput,this._colorStyle()),t.push(S.textInputAndMirrorSharedLarge,S.mirrorText);const s=[S.gestureView],o=[S.compositionArea];const r=(0,i.jsx)(n.View,Object.assign({style:S.textInputAbsolute,ignorePointerEvents:!0},{children:(0,i.jsx)(n.TextInput,{accessibilityLabel:c.getString("CapturePreview.CaptionTextInputAccessibilityLabel"),ref:this._onTextInputRef,style:e,autoCorrect:!1,spellCheck:!1,value:this.state.text,multiline:!0,onChangeText:this._onInput,onFocus:this._onFocus,onBlur:this._onBlur,placeholder:"",keyboardAppearance:"dark",editable:this.props.allowsSelection,blurOnSubmit:!0,returnKeyType:"done",disableFullscreenUI:!0,maxLength:80,clearButtonMode:"never"})})),l=(0,i.jsxs)(n.Text,{children:[this.state.text,"\n"]},"mirror"),d=!this.state.hasFocus&&this.props.allowsSelection?(0,i.jsx)(n.GestureView,{style:s,onPan:this._onPan,onPinchZoom:this._onPinchZoom,onRotate:this._onRotate,onTap:this._onTap,releaseOnRequest:!1,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants}):void 0,h=[S.container,this._widthStyle(),this._baseAnimatedStyle,this._animatedScaleStyle,u.default.isRTL()?this._animatedStyleRTL:this._animatedStyleLTR];return(0,i.jsx)(n.Animated.View,Object.assign({style:h,ignorePointerEvents:this.props.allowsSelection,blockPointerEvents:!this.props.allowsSelection},{children:(0,i.jsx)(n.Animated.View,Object.assign({style:[S.innerContainer,this._animatedRotationStyle],ignorePointerEvents:!0},{children:(0,i.jsxs)(n.View,Object.assign({style:o,ignorePointerEvents:!0},{children:[(0,i.jsx)(a.HiddenText,Object.assign({style:t},{children:l})),r,d]}))}))}))}}t.default=f},883666:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureMarkupView=t.CaptureMarkupMode=void 0;const i=s(785893),o=s(496486),n=s(551488),r=s(216934),a=s(516778),l=s(397691),d=s(711208),c=s(628580),h=s(539003),u=s(662602),p=s(677381),g=s(746096),m=s(913944),S=s(436237),f=s(861253),y=s(710400),v=s(915877),C=s(733754),_=s(536150),b=s(404057),T=s(581760),M=s(711828),I=s(73877),w=(0,v.lazyProperties)({innerContainer:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",overflow:"visible"}),gestureSurface:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0,backgroundColor:T.Color.transparent}),shimBase:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0}),shimBaseColor:()=>a.Styles.createViewStyle({backgroundColor:T.Color.blackOverlay70}),androidAdditionalShimBaseColor:()=>a.Styles.createViewStyle({backgroundColor:T.Color.black}),backgroundGestureView:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:T.Color.transparent}),textShim:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:T.Color.blackOverlay50}),avatarBackground:()=>a.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:T.Color.white}),rnSurfaceStyle:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:T.Color.transparent}),accessibilityButtonsContainer:()=>a.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"center",position:"absolute",left:0,right:0,top:0,bottom:0}),nextButton:()=>a.Styles.createViewStyle({position:"absolute",right:0,paddingVertical:10,paddingRight:14,paddingLeft:0,backgroundColor:T.Color.blackOverlay50}),previousButton:()=>a.Styles.createViewStyle({position:"absolute",left:0,paddingVertical:10,paddingRight:0,paddingLeft:14,backgroundColor:T.Color.blackOverlay50})});var P;!function(e){e[e.None=0]="None",e[e.Ink=1]="Ink",e[e.Text=2]="Text",e[e.Stickers=3]="Stickers",e[e.Filters=4]="Filters"}(P=t.CaptureMarkupMode||(t.CaptureMarkupMode={}));class k extends p.default{constructor(){super(...arguments),this._stickerCount=0,this._selectedInkColor=T.Color.white,this._strokeWidth=5,this._controlsAnimatedOpacityValue=new a.Animated.Value(1),this._controlsAnimatedOpacityStyle=a.Styles.createAnimatedViewStyle({opacity:this._controlsAnimatedOpacityValue}),this._pathCount=0,this._isDrawing=!1,this._lift=!1,this._shouldRenderChildren=!1,this._gestureOffset={x:0,y:0},this._horizontalOffset=0,this._verticalOffset=0,this._stickerNames={},this._onCaptureMarkupPathRef=e=>{this._captureMarkupPath=e||void 0},this._onCaptureMarkupTextRef=e=>{this._captureMarkupText=e||void 0},this._onCaptureOverlayPagerRef=e=>{this._captureOverlayPager=e||void 0},this._onPan=e=>{if(this.props.markupMode===P.Ink){if(this._captureMarkupPath){const t=this._offsetPoint({x:e.pageX,y:e.pageY});this._captureMarkupPath.addPoint({x:t.x,y:t.y})}this._setIsDrawing(!0),e.isComplete&&this._onPathEnd(!0)}},this._onTap=e=>{switch(this.props.markupMode){case P.None:e.pageY>80&&this.props.onTextFocusChanged&&!this.state.isMobileScreenReaderEnabled&&this.props.onTextFocusChanged(!0);break;case P.Ink:if(this._captureMarkupPath){const t=this._offsetPoint({x:e.pageX,y:e.pageY});this._captureMarkupPath.addTap({x:t.x,y:t.y})}this._onPathEnd(!1);break;case P.Text:this._captureMarkupText&&this._captureMarkupText.blur()}},this._onRemoveSticker=e=>{delete this._stickerNames[e];let t=o.clone(this.state.stickers);t=o.remove(t,(t=>t.key!==e)),this.setState({stickers:t})},this._onContainerLayout=e=>{if(this.isComponentMounted()){const t=this._getSurfaceDimensions(e);u.default.measureLayoutRelativeToWindow((()=>this)).then((s=>{this._gestureOffset={x:s.x+(e.width-t.width)/2,y:s.y+(e.height-t.height)/2}}),(e=>{S.warn(g.LogTraceArea.Capture,"Capture markup component not measured: "+b.default.errorAsString(e))})),this._shouldRenderChildren=!0,this.setState({surfaceDimensions:t,viewDimensions:e,shouldRenderOverlays:!0})}},this._onHasText=e=>{if(this.state.hasText!==e){const t={};t.hasText=e,this.setState(t)}this.props.onHasText&&this.props.onHasText(e)},this._onAdvance=e=>{this._captureOverlayPager&&this._captureOverlayPager.onAdvance(e)},this._renderPath=(e,t,s,o)=>{const r=o>=this.state.pathRenderInfo.length-1-(e?1:0),a=o===this.state.pathRenderInfo.length-1;let l=n.CaptureMarkupPathRenderType.Dormant;return this._shouldRenderChildren?l=n.CaptureMarkupPathRenderType.All:r&&(l=n.CaptureMarkupPathRenderType.Current),(0,i.jsx)(n.CaptureMarkupPath,{id:s.key,style:w.rnSurfaceStyle,ref:a?this._onCaptureMarkupPathRef:void 0,renderType:l,surfaceDimensions:this.state.surfaceDimensions,initialColor:this._selectedInkColor,initialStrokeWidth:this._strokeWidth,levelsOfUndo:this.props.levelsOfUndo,onDraw:this.props.onHasMarkup,onCanUndo:this.props.onCanUndo},s.key)},this._optionalShimContainer=e=>{if(this.state.surfaceDimensions.width&&this.state.surfaceDimensions.height)return(0,i.jsxs)(a.View,Object.assign({style:this._shimsContainerStyle(),blockPointerEvents:!0},{children:[(0,i.jsx)(a.View,{style:[w.shimBase,e,this._leftShimStyle()]}),(0,i.jsxs)(a.View,Object.assign({style:this._middleShimContainerStyle()},{children:[(0,i.jsx)(a.View,{style:[w.shimBase,e,this._bottomShimStyle()]}),(0,i.jsx)(a.View,{style:[w.shimBase,e,this._topShimStyle()]})]})),(0,i.jsx)(a.View,{style:[w.shimBase,e,this._rightShimStyle()]})]}))}}_buildState(e,t){const s={resizeMode:y.default.getResizeMode(),keyboardUpdateInfo:y.default.getUpdateInfo(),isMobileScreenReaderEnabled:_.default.isMobileScreenReaderEnabled()};return t&&(s.viewDimensions={height:0,width:0},s.surfaceDimensions={height:0,width:0},s.pathRenderInfo=[],s.stickers=[],s.hasText=!1),s}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),y.default.setResizeMode(r.KeyboardAwareResizeMode.None)}componentWillUnmount(){super.componentWillUnmount(),y.default.setResizeMode(r.KeyboardAwareResizeMode.Default)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._lift=!1,this._shouldRenderChildren=!1,this._captureMarkupText&&this.props.markupMode!==e.markupMode&&(this.props.markupMode===P.Text?this._captureMarkupText.requestFocus():e.markupMode===P.Text&&this._captureMarkupText.blur()),this.state.stickers.length!==t.stickers.length&&this.props.onHasStickers&&this.props.onHasStickers(this.state.stickers.length>0);const i=o.map(this.state.stickers,(e=>e.sticker?e.sticker.id:void 0)),n=o.map(t.stickers,(e=>e.sticker?e.sticker.id:void 0));(0,f.default)(i,n)||(this.props.stickerIds&&this.props.stickerIds(o.compact(i)),this.props.stickerNames&&this.props.stickerNames(o.compact(o.values(this._stickerNames)))),this.props.markupMode===P.Ink&&o.isEmpty(this.state.pathRenderInfo)&&this.setState({pathRenderInfo:[this._newPathRenderInfo()]})}prepareForSnapshot(){this._controlsAnimatedOpacityValue.setValue(0),this._captureOverlayPager&&this._captureOverlayPager.prepareForSnapshot();const e=l.Defer();return o.delay((()=>e.resolve(void 0)),100),e.promise()}restoreAfterSnapshot(){this._controlsAnimatedOpacityValue.setValue(1),this._captureOverlayPager&&this._captureOverlayPager.restoreAfterSnapshot()}selectColor(e){this.props.markupMode!==P.Ink&&this.props.markupMode!==P.Text||(this._selectedInkColor=e,this._captureMarkupPath&&this._captureMarkupPath.setColor(e),this.props.markupMode===P.Text&&this._captureMarkupText&&this._captureMarkupText.setColor(e))}setStrokeWidth(e){this._strokeWidth=e,this._captureMarkupPath&&this._captureMarkupPath.setStrokeWidth(e)}resetTextPosition(){this._captureMarkupText&&this._captureMarkupText.resetPosition()}addSticker(e,t,s=void 0){const i=this._stickerKey();s&&(this._stickerNames[i]=s);const n=o.clone(this.state.stickers);n.push({stickerKey:i,key:i,sticker:e,isLocalMedia:t}),this.setState({stickers:n})}undoDrawing(){this.setState({pathRenderInfo:[this._newPathRenderInfo()]}),this.props.onHasMarkup&&this.props.onHasMarkup(!1)}undoLast(){this._captureMarkupPath&&this._captureMarkupPath.undoLast()}_stickerKey(){return this._stickerCount++,"sticker"+this._stickerCount}_offsetPoint(e){return{x:e.x-this._gestureOffset.x,y:e.y-this._gestureOffset.y}}_getSurfaceDimensions(e){let t,s;if(this.props.mediaDimensions){const i=this.props.mediaDimensions;if(i.width>i.height){const o=i.height/i.width;t=e.width,s=o*t}else{const o=i.width/i.height;s=e.height,t=o*s}}else t=e.width,s=e.height;return{height:s,width:t}}_setIsDrawing(e){this._isDrawing!==e&&(a.Animated.timing(this._controlsAnimatedOpacityValue,{toValue:e?0:1,duration:300,delay:e?1e3:100,easing:a.Animated.Easing.Linear()}).start(),this.props.onDrawing&&this.props.onDrawing(e),this._isDrawing=e)}_onPathEnd(e){this._lift=e,e&&this._captureMarkupPath&&this._captureMarkupPath.flushPoints(),this._setIsDrawing(!1)}_surfaceContainerStyle(){return a.Styles.createViewStyle({width:this.state.surfaceDimensions.width,height:this.state.surfaceDimensions.height},!1)}_shimsContainerStyle(){const e=this._getRootViewId(),t=I.default.measureWindow(e);return a.Styles.createViewStyle({position:"absolute",top:-1*this._verticalOffset,left:-1*this._horizontalOffset,right:this.state.surfaceDimensions.width+this._horizontalOffset,bottom:this.state.surfaceDimensions.height+this._verticalOffset,height:t.height,width:t.width,flexDirection:"row"},!1)}_leftShimStyle(){const e=I.default.measureWindow(this._getRootViewId());return a.Styles.createViewStyle({top:0,left:0,height:e.height,width:this._horizontalOffset},!1)}_middleShimContainerStyle(){const e=I.default.measureWindow(this._getRootViewId());return a.Styles.createViewStyle({top:0,left:this._horizontalOffset,width:this.state.surfaceDimensions.width,height:e.height},!1)}_rightShimStyle(){const e=I.default.measureWindow(this._getRootViewId());return a.Styles.createViewStyle({top:0,left:this.state.surfaceDimensions.width+this._horizontalOffset,height:e.height,width:this._horizontalOffset},!1)}_bottomShimStyle(){return a.Styles.createViewStyle({top:this.state.surfaceDimensions.height+this._verticalOffset,left:0,width:this.state.surfaceDimensions.width,height:this._verticalOffset},!1)}_topShimStyle(){return a.Styles.createViewStyle({top:0,left:0,width:this.state.surfaceDimensions.width,height:this._verticalOffset},!1)}_pagerStyle(){return a.Styles.createViewStyle({bottom:this.props.offset?Math.max(0,-1*this.props.offset.y):0},!1)}_newPathRenderInfo(){return{key:"path"+this._pathCount++}}_renderStickers(e){const t=[],s=[];return o.each(this.state.stickers,(i=>{const o=this._renderSticker(i,e);i.isLocalMedia?t.push(o):s.push(o)})),{localMediaStickers:t,stickers:s}}_allowStickerSelection(){return this.props.markupMode!==P.Ink&&this.props.markupMode!==P.Text&&(this.props.markupMode!==P.Filters||this.props.effectsEnabled)}_renderSticker(e,t){const s=this._allowStickerSelection();return(0,i.jsx)(d.default,{viewKey:e.key,stickerKey:e.stickerKey,sticker:e.sticker,gestureRect:t,allowsSelection:s,onRemove:this._onRemoveSticker,onDragView:this.props.onDragView},e.key)}render(){const e=this.state.surfaceDimensions,t=e.height>0&&e.width>0,s=t?(0,i.jsx)(a.View,Object.assign({style:this._surfaceContainerStyle(),blockPointerEvents:!0},{children:o.map(this.state.pathRenderInfo,o.partial(this._renderPath,this._lift,this._shouldRenderChildren))})):void 0,n=t?(0,i.jsx)(a.GestureView,{style:[w.gestureSurface,this._surfaceContainerStyle()],onPan:this._onPan,onTap:this._onTap}):void 0,r=this.props.markupMode===P.Text||this.state.hasText,l={x:this.props.offset?this.props.offset.x:0,y:this.props.offset?this.props.offset.y:0,height:this.state.viewDimensions.height,width:this.state.viewDimensions.width},d=this.props.markupMode!==P.Ink&&(this.props.markupMode!==P.Filters||this.props.effectsEnabled),u=t&&r?(0,i.jsx)(c.default,{ref:this._onCaptureMarkupTextRef,gestureRect:l,allowsSelection:d,bottomOffset:this.props.offset?-1*this.props.offset.y:void 0,horizontalInset:this.props.offset?Math.max(0,-1*this.props.offset.x):0,onHasText:this._onHasText,onFocusChanged:this.props.onTextFocusChanged,onDragView:this.props.onDragView,onTextInput:this.props.onTextInput}):void 0,p=this.props.markupMode===P.Text?(0,i.jsx)(a.View,{style:w.textShim}):void 0,g=this.props.enableOverlays?(0,i.jsx)(h.default,{ref:this._onCaptureOverlayPagerRef,style:this._pagerStyle(),enabled:this.props.markupMode===P.Filters,mediaId:this.props.mediaId,fileSize:this.props.fileSize,localMediaObjectUri:this.props.localMediaObjectUri,localMediaIsVideo:this.props.localMediaIsVideo,mediaDimensions:this.props.mediaDimensions,offset:this.props.offset,hidePageControl:this.props.hidePageControl,onOverlaySelected:this.props.onOverlaySelected,onOverlayProgress:this.props.onOverlayProgress,onTap:this._onTap,onPagerUpdated:this.props.onPagerUpdated,advanceToFirstOverlay:this.props.advanceToFirstOverlay}):void 0;let S,f;if(0!==this.state.viewDimensions.height&&0!==this.state.viewDimensions.width){const e={x:0,y:0,height:this.state.viewDimensions.height,width:this.state.viewDimensions.width};S=this._renderStickers(e),f=this.props.isAvatarPreview?(0,i.jsx)(a.View,{style:[w.avatarBackground]}):void 0}const y=I.default.measureWindow(this._getRootViewId());this._horizontalOffset=(y.width-this.state.surfaceDimensions.width)/2,this._verticalOffset=(y.height-this.state.surfaceDimensions.height)/2;let v,_;return this.state.isMobileScreenReaderEnabled||(v=(0,i.jsx)(a.GestureView,{style:w.backgroundGestureView,releaseOnRequest:!1})),this.props.markupMode===P.Filters&&this.state.isMobileScreenReaderEnabled&&(_=(0,i.jsxs)(a.Animated.View,Object.assign({style:[w.accessibilityButtonsContainer,this._controlsAnimatedOpacityStyle],ignorePointerEvents:!0},{children:[(0,i.jsx)(m.default,{size:M.IconSize.size40,style:w.previousButton,onPress:()=>this._onAdvance(!1),color:T.Color.white,hoverColor:T.Color.whiteOverlay70,icon:M.SkypeIcon.NavigationBack,title:C.getString("CameraEffects.PreviousButtonTitle")}),(0,i.jsx)(m.default,{size:M.IconSize.size40,style:w.nextButton,onPress:()=>this._onAdvance(!0),color:T.Color.white,hoverColor:T.Color.whiteOverlay70,icon:M.SkypeIcon.NavigationForward,title:C.getString("CameraEffects.NextButtonTitle")})]}))),(0,i.jsxs)(a.View,Object.assign({style:this.props.style,onLayout:this._onContainerLayout},{children:[f,(0,i.jsxs)(a.View,Object.assign({style:w.innerContainer},{children:[v,S?S.localMediaStickers:void 0,this.state.shouldRenderOverlays?g:void 0,_,undefined,s,S?S.stickers:void 0,p,this.props.markupMode===P.Text?n:null,u,this.props.markupMode===P.Ink?n:null,this._optionalShimContainer(w.shimBaseColor)]}))]}))}}t.CaptureMarkupView=k,t.default=k},867538:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(967593),n=s(665768),r=s(516778),a=s(217041),l=s(915877),d=s(581760),c=s(680837),h=(0,l.lazyProperties)({buttonContainer:()=>r.Styles.createViewStyle({alignItems:"center",justifyContent:"center",backgroundColor:d.Color.blackOverlay50}),buttonContainerSelected:()=>r.Styles.createViewStyle({backgroundColor:d.Color.blue,borderColor:d.Color.transparent}),absolutePosition:()=>r.Styles.createViewStyle({position:"absolute"}),mediaPickerThumbnail:()=>r.Styles.createViewStyle({width:35,height:35,borderWidth:1.5,borderColor:d.Color.white,borderRadius:8,alignSelf:"center"}),mediaPickerThumbnailImage:()=>r.Styles.createViewStyle({width:32,height:32,borderRadius:8}),recentAssetNotification:()=>r.Styles.createViewStyle({width:11,height:11,borderWidth:1.5,borderColor:d.Color.white,backgroundColor:d.Color.red,position:"absolute",top:9,right:9,borderRadius:6}),size:()=>r.Styles.createViewStyle({width:60,height:60,borderRadius:30,justifyContent:"center"})});class u extends a.ComponentBase{constructor(){super(...arguments),this._buttonAnimatedOpacityValue=new r.Animated.Value(1),this._buttonAnimatedScaleValue=new r.Animated.Value(1),this._buttonAnimatedStyle=r.Styles.createAnimatedViewStyle({opacity:this._buttonAnimatedOpacityValue,transform:[{scale:this._buttonAnimatedScaleValue}]}),this._rotationValue=new r.Animated.Value(0),this._rotationStyle=r.Styles.createAnimatedViewStyle({transform:[{rotate:this._rotationValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._onPressIn=()=>{this._updateButton(!0)},this._onPressOut=()=>{this._updateButton(!1)}}componentDidMount(){super.componentDidMount(),this._buttonAnimatedOpacityValue.setValue(this._fullOpacity(this.props)),this.props.enableCameraPortraitLock&&this._rotationValue.setValue(this.props.rotate||0)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.props.hidden===e.hidden&&this.props.disabled===e.disabled||this._buttonAnimatedOpacityValue.setValue(this._fullOpacity(e)),this.props.enableCameraPortraitLock&&this.props.rotate!==e.rotate&&n.timing.easeOut({value:this._rotationValue,toValue:e.rotate||0,useNativeDriver:!0}).start()}_fullOpacity(e){return e.hidden?0:e.disabled?.4:1}fadeInOrOut(e,t=0){const s=e?0:this._fullOpacity(this.props);this._internalUpdateButton(s,1,200,t)}_updateButton(e,t=0,s=!0){const i=this.props.hidden?0:e?.8:this._fullOpacity(this.props),o=e?.92:1;this._internalUpdateButton(i,o,350,t,s)}_internalUpdateButton(e,t,s,i=0,o=!0){o?r.Animated.parallel([r.Animated.timing(this._buttonAnimatedOpacityValue,{toValue:e,duration:s,delay:i,easing:r.Animated.Easing.InOut(),useNativeDriver:!0}),r.Animated.timing(this._buttonAnimatedScaleValue,{toValue:t,duration:s,delay:i,easing:r.Animated.Easing.OutBack(),useNativeDriver:!0})]).start():(this._buttonAnimatedOpacityValue.setValue(e),this._buttonAnimatedScaleValue.setValue(t))}render(){const e=[h.buttonContainer];this.props.selected&&e.push(h.buttonContainerSelected),e.push([h.size,this._buttonAnimatedStyle]),e.push(this.props.backgroundStyle);const t=this.props.backgroundColors?(0,i.jsx)(o.GradientView,{style:[h.absolutePosition,h.size],colors:this.props.backgroundColors,direction:o.GradientDirection.BOTTOM_RIGHT}):void 0;let s;e.push(this.props.style),this.props.showRecentAssetNotification&&(s=(0,i.jsx)(r.View,{style:h.recentAssetNotification},"recentAssetNotification"));const n=[h.mediaPickerThumbnailImage];return(0,i.jsxs)(r.Animated.View,Object.assign({style:e},{children:[t,(0,i.jsx)(r.Button,Object.assign({style:[c.default.absoluteFill,h.size],onPress:this.props.disabled?this.props.onDisabledPress:this.props.onPress,onPressIn:!this.props.disabled||this.props.onDisabledPress?this._onPressIn:void 0,onPressOut:!this.props.disabled||this.props.onDisabledPress?this._onPressOut:void 0,disableTouchOpacityAnimation:!0,accessibilityLabel:this.props.accessibilityLabel,importantForAccessibility:this.props.importantForAccessibility},{children:(0,i.jsxs)(r.Animated.View,Object.assign({style:[this.props.enableCameraPortraitLock?this._rotationStyle:void 0,h.size]},{children:[(0,i.jsx)(r.View,Object.assign({style:h.mediaPickerThumbnail},{children:(0,i.jsx)(r.Image,{style:n,source:this.props.recentAssetThumbnailUrl,resizeMode:"cover"},"recentAssetThumbnail_"+this.props.recentAssetTimestamp)})),s]}))}))]}))}}t.default=u},723303:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(583367),r=s(516778),a=(s(244770),s(397691)),l=s(4736),d=s(996074),c=s(292681),h=s(469198),u=s(803056),p=s(898278),g=s(952262),m=s(746096),S=s(139889),f=s(753559),y=s(913944),v=s(110117),C=s(708681),_=s(436237),b=s(915877),T=s(733754),M=s(531772),I=s(206286),w=s(526594),P=s(445026),k=s(104735),A=s(29130),x=s(451070),R=s(681115),O=s(415963),L=s(581760),F=s(711828),B=s(734528),D=s(680837),E=s(24576),V=s(853374),N=70,U=(0,b.lazyProperties)({container:()=>r.Styles.createViewStyle({flex:1,backgroundColor:L.Color.black,alignItems:"center"}),sendButton:()=>r.Styles.createButtonStyle({position:"absolute",bottom:92,right:10}),headerButton:()=>r.Styles.createButtonStyle({flexDirection:"row",alignSelf:"stretch",alignItems:"center",justifyContent:"center",height:F.IconSize.default,paddingHorizontal:8,backgroundColor:L.Color.transparent}),topControls:()=>r.Styles.createViewStyle({paddingTop:4,paddingHorizontal:10,flexDirection:"row",alignSelf:"stretch",justifyContent:"space-between",overflow:"visible",position:"absolute",left:0,right:0,top:0,height:64}),previewsContainerStyles:()=>r.Styles.createScrollViewStyle({backgroundColor:L.Color.blackOverlay70,paddingVertical:6}),previewsWrapper:()=>r.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0}),previewsStyles:()=>r.Styles.createViewStyle({flexDirection:"row",marginHorizontal:6}),plusContainer:()=>r.Styles.createViewStyle({height:N,width:40,borderRadius:3,justifyContent:"center",alignItems:"center",backgroundColor:L.Color.whiteOverlay20}),playButtonWrapperBg:()=>r.Styles.createViewStyle({backgroundColor:L.Color.blackOverlay20,alignItems:"center",justifyContent:"center"}),playButtonWrapper:()=>r.Styles.createViewStyle({backgroundColor:L.Color.blackOverlay10,borderRadius:F.IconSize.size40/2,borderStyle:"solid",borderWidth:2,borderColor:L.Color.white,alignItems:"center",justifyContent:"center",width:F.IconSize.size40,height:F.IconSize.size40}),progressBarStyle:()=>r.Styles.createViewStyle({bottom:92,right:60,left:10,height:40,margin:0,padding:0}),imageContainerStyle:()=>r.Styles.createViewStyle({marginRight:6,borderRadius:3}),imageStyle:()=>r.Styles.createViewStyle({width:N,height:N,borderRadius:3,borderWidth:2,borderColor:L.Color.transparent,overflow:"visible"}),imageStyleSelected:()=>r.Styles.createViewStyle({borderColor:L.Color.blue}),previewSlide:()=>r.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center"}),previewScrollContainerStyles:()=>r.Styles.createViewStyle({flexDirection:"row"}),topControlsShimContainer:()=>r.Styles.createImageStyle({position:"absolute",top:0,right:0,left:0,backgroundColor:L.Color.transparent,opacity:.8,height:64}),controlsShimInnerView:()=>r.Styles.createImageStyle({opacity:.9})});class j extends E.default{render(){const{preview:e}=this.props;return(0,i.jsx)(r.View,Object.assign({style:this.props.containerStyle},{children:e.localMediaIsVideo?(0,i.jsx)(M.default,{videoUrl:e.localMediaObjectUri,thumbnailUrl:e.localMediaThumbnailUri||"",style:this.props.style,progressBarStyle:U.progressBarStyle}):(0,i.jsx)(S.default,{origin:"CaptureMultiPreview",style:this.props.style,containerStyle:this.props.style,resizeMode:"contain",source:e.localMediaObjectUri})}))}}class H extends E.default{render(){return(0,i.jsx)(r.View,Object.assign({style:U.previewScrollContainerStyles},{children:this.props.previews.map((e=>(0,i.jsx)(j,{preview:e,style:this.props.style,containerStyle:this.props.containerStyle},e.localMediaObjectUri)))}))}}class z extends d.default{constructor(){super(...arguments),this._animatedPresentationOpacityValue=new r.Animated.Value(0),this._scrollingIndex=0,this._isSendingPreviews=!1,this._renderPreviewCarousel=()=>{const e=[U.container,D.default.absoluteFill];this.state.safeAreaInsets.top&&e.push(R.default.marginTopStyle(this.state.safeAreaInsets.top)),this.state.safeAreaInsets.bottom&&e.push(R.default.marginBottomStyle(this.state.safeAreaInsets.bottom)),(this.state.safeAreaInsets.left||this.state.safeAreaInsets.right)&&e.push(R.default.horizontalMarginStyle(this.state.safeAreaInsets));const t=this.state.conversationName?T.getString("CapturePreview.SendToAccessibilityLabel",{displayName:this.state.conversationName}):T.getString("CapturePreview.SendTitle");return(0,i.jsxs)(r.View,Object.assign({style:e},{children:[this.state.renderEmptyPreviews?void 0:this._renderPreview(),(0,i.jsx)(l.default,{title:T.getString("Global.SendButtonTitle"),style:U.sendButton,icon:F.SkypeIcon.Send,onPress:this._sendPreview,accessibilityLabel:t,size:l.ActionButtonSize.Small,backgroundColor:L.Color.blue,disabled:this._isSendingPreviews}),this._renderHeader(),this._renderThumbnailPreviews()]}))},this._renderPreviewThumbnail=(e,t)=>{const s=[U.imageStyle],{currentPreviewIndex:o,previews:n}=this.state;o===t&&s.push(U.imageStyleSelected);const a=T.getString("Global.CountOfTotal",{count:t+1,total:n.length});return(0,i.jsxs)(r.Button,Object.assign({onPress:()=>this._setCurrentPreviewIndex(t,!0),accessibilityLabel:a},{children:[(0,i.jsx)(S.default,{origin:"CapturePreview",style:s,containerStyle:U.imageContainerStyle,source:e.localMediaObjectUri,resizeMode:"cover"}),e.localMediaIsVideo?this._renderPlayVideoIcon():void 0]}),t)},this._goBack=()=>this._onBackPressed(),this._getDimensions=()=>{const e=this.state.previews[this.state.currentPreviewIndex],t=e.width/this.state.viewRect.width,s=e.height/this.state.viewRect.height,i=Math.max(t,s),o=e.width/i,n=e.height/i;return{height:Math.ceil(n),width:Math.ceil(o)}},this._onBackPressed=()=>{const e=V.default.newCauseId();return _.log(m.LogTraceArea.Capture,"CaptureMultiPreview._onBackPressed, causeId: "+e),this.props.onReject(),!0},this._renderAddMoreButton=()=>(0,i.jsx)(r.Button,Object.assign({style:U.plusContainer,onPress:this._onBackPressed,accessibilityLabel:T.getString("MediaBar.MediaPickerTitle")},{children:(0,i.jsx)(v.default,{icon:F.SkypeIcon.Plus,size:F.IconSize.size16,color:L.Color.white})})),this._onPreviewReject=()=>{this.isComponentMounted()&&this.setState({showCapturePreview:!1},(()=>this._scrollToItem(!0,!1)))},this._onMarkupComplete=(e,t,s,i)=>{if(!this.isComponentMounted())return;const n=this.props.mediaPreviews[this.state.currentPreviewIndex],r=o.cloneDeep(this.state.previews),a={localMediaObjectUri:e,height:i,width:s,fileSize:t,hasChanged:!0};r.splice(this.state.currentPreviewIndex,1,Object.assign(Object.assign({},n),a)),this.setState({previews:r,showCapturePreview:!1},(()=>this._scrollToItem(!0,!1)))},this._capturedContentHandler=new c.CapturedContentHandlerForMarkupOnly(this._onMarkupComplete),this._getFileForImage=e=>{const t=e.localMediaObjectUri,s=e.mediaSelection&&e.mediaSelection.fileName||"",{width:i,height:o,fileSize:n}=e;return C.default.downsizeImageIfNeeded(t,s,i,o,n)},this._sendPreview=()=>{const e=V.default.newCauseId();_.log(m.LogTraceArea.GenericUnsafe,"CaptureMultiPreview._sendPreview, causeId: "+e),this._isSendingPreviews||this.state.renderEmptyPreviews||(this._isSendingPreviews=!0,this._previewScrollRef?(this._previewHasUnmountedDeferred=a.Defer(),this.setState({renderEmptyPreviews:!0}),this._previewHasUnmountedDeferred.promise().then((()=>{this._sendPreviewInner(e)}))):this._sendPreviewInner(e))},this._onEditPress=()=>{this.setState({showCapturePreview:!0})},this._onPreviewScrollViewRef=e=>{if(this._previewScrollRef=e||void 0,!e&&this._previewHasUnmountedDeferred){const e=this._previewHasUnmountedDeferred;this._previewHasUnmountedDeferred=void 0,e.resolve(void 0)}},this._onThumbnailScrollViewRef=e=>{this._thumbnailScrollRef=e||void 0},this._onPreviewScrollViewScrollEnd=()=>{o.delay((()=>{this._setCurrentPreviewIndex(this._scrollingIndex,!1)}),300)},this._onPreviewScrollViewScroll=(e,t)=>{const s=Math.round(t/this.state.viewRect.width),i=o.clamp(s,0,this.state.previews.length-1);this._scrollingIndex=i},this._onScrollViewLayout=e=>{this.setState({viewRect:e},(()=>{this._scrollToItem(!0,!1)}))},this._scrollToItem=(e,t=!0)=>{const{width:s}=this.state.viewRect;e&&this._previewScrollRef&&this._previewScrollRef.setScrollLeft(this._scrollingIndex*s,t),this._thumbnailScrollRef&&(76*this._scrollingIndex-35>s/2?this._thumbnailScrollRef.setScrollLeft(76*this._scrollingIndex-s/2+35,t):this._thumbnailScrollRef.setScrollLeft(0,t))},this._setCurrentPreviewIndex=(e,t)=>{this._scrollingIndex!==e&&(this._scrollingIndex=e),this.setState({currentPreviewIndex:e},(()=>this._scrollToItem(t)))}}_buildState(e,t){const s=this._getRootViewId(),i=x.default.statusBarHeight(),o=x.default.bottomSafeAreaInset(p.BottomInsetDefault),r=x.default.horizontalInsets(p.HorizontalInsetDefault),a=A.default.getWidth(s),l=A.default.getHeight(s),d={isLandscape:A.default.getDeviceOrientation(s)===n.DeviceOrientation.Landscape,safeAreaInsets:Object.assign(Object.assign({},r),{top:i,bottom:o}),viewRect:t?{x:0,y:0,width:a,height:l}:this.state.viewRect};return t&&(d.renderEmptyPreviews=!1,d.previews=e.mediaPreviews,d.currentPreviewIndex=0,d.showCapturePreview=!1,d.conversationName=e.conversationId&&g.default.getDisplayName(e.conversationId)),d}componentDidMount(){super.componentDidMount(),P.default.timing(this._animatedPresentationOpacityValue,{toValue:1,duration:100,easing:r.Animated.Easing.Out(),useNativeDriver:!0}).start()}handleBackAction(){return this._onBackPressed(),!0}render(){return(0,i.jsx)(u.default,Object.assign({goBack:this._goBack},{children:this.state.showCapturePreview?this._renderEditPreview():this._renderPreviewCarousel()}))}_renderPreview(){const e=this._getDimensions(),t=r.Styles.createViewStyle({width:this.state.viewRect.width,height:this.state.viewRect.height},!1),s=[U.previewSlide,t];return(0,i.jsx)(r.View,Object.assign({style:[U.previewsWrapper,D.default.absoluteFill]},{children:(0,i.jsx)(r.ScrollView,Object.assign({ref:this._onPreviewScrollViewRef,onScroll:this._onPreviewScrollViewScroll,onScrollEndDrag:this._onPreviewScrollViewScrollEnd,onLayout:this._onScrollViewLayout,horizontal:!0,pagingEnabled:!0,scrollEventThrottle:16,style:U.previewsContainerStyles},{children:(0,i.jsx)(H,{previews:this.state.previews,style:e,containerStyle:s})}))}))}_renderPlayVideoIcon(){return(0,i.jsx)(r.View,Object.assign({style:[D.default.absoluteFill,U.playButtonWrapperBg]},{children:(0,i.jsx)(r.View,Object.assign({style:U.playButtonWrapper},{children:(0,i.jsx)(v.default,{icon:F.SkypeIcon.Play,size:F.IconSize.size16,color:L.Color.white})}))}))}_renderEditPreview(){const e=this.state.previews[this.state.currentPreviewIndex];return(0,i.jsx)(h.default,{fileSize:e.fileSize,mediaWidth:e.width||0,mediaHeight:e.height||0,localMediaIsVideo:e.localMediaIsVideo,localMediaThumbnailUri:e.localMediaThumbnailUri,localMediaObjectUri:e.localMediaObjectUri,skipShareWithPanel:!0,performMarkupOnly:!0,capturedContentHandler:this._capturedContentHandler,callId:e.callId,mediaSelection:e.mediaSelection,unlockOrientation:!0,disableCoachmarks:!0,captureSessionTelemetry:e.captureSessionTelemetry,entryPoint:e.mediaSelection?m.PostSource.MediaPicker:m.PostSource.Capture,markupEnabled:!0,useCompactControls:!1,centerCompactControls:this.state.isLandscape,inlinePreview:!0,onReject:this._onPreviewReject,ignoreBottomSafeArea:!1,orientationLockKey:e.orientationLockKey,showSendButtonOnTop:!0,alwaysShowSaveButton:!0})}_renderHeader(){const e=this.state.previews[this.state.currentPreviewIndex],t=(0,i.jsx)(y.default,{title:T.getString("Global.CancelLabel"),style:U.headerButton,size:F.IconSize.size24,color:L.Color.white,hoverColor:L.Color.gray300,icon:B.backIcon(),showShadow:!0,onPress:this._onBackPressed,accessibilityLabel:T.getString("CapturePreview.BackAccessibilityLabel")}),s=e.localMediaIsVideo?r.Types.ImportantForAccessibility.Yes:r.Types.ImportantForAccessibility.No,o=e.localMediaIsVideo?T.getString("AvatarPickerDialog.EditPictureButtonTitle"):void 0,n=(0,i.jsx)(y.default,{style:U.headerButton,size:F.IconSize.size24,color:L.Color.white,hoverColor:L.Color.gray300,showShadow:!0,icon:F.SkypeIcon.Topic,onPress:this._onEditPress,accessibilityLabel:o,importantForAccessibility:s,disabled:e.localMediaIsVideo}),a=this._renderOptionalTopControlsShim();return(0,i.jsxs)(r.View,Object.assign({style:U.topControls,ignorePointerEvents:!0},{children:[a,t,n]}))}_renderOptionalTopControlsShim(){}_renderThumbnailPreviews(){return(0,i.jsx)(r.View,Object.assign({style:U.previewsWrapper},{children:(0,i.jsx)(r.ScrollView,Object.assign({ref:this._onThumbnailScrollViewRef,horizontal:!0,style:U.previewsContainerStyles},{children:(0,i.jsxs)(r.View,Object.assign({style:U.previewsStyles},{children:[this.state.previews.map(this._renderPreviewThumbnail),this.state.previews.length<10?this._renderAddMoreButton():void 0]}))}))}))}_componentId(){return"CaptureMultiPreview"}_sendPreviewInner(e){_.log(m.LogTraceArea.GenericUnsafe,"CaptureMultiPreview._sendPreviewInner, causeId: "+e);const t=this.state.previews.map((t=>!t.hasChanged&&t.mediaSelection?a.Resolved({mediaSelection:t.mediaSelection,extension:f.default.extractFileExtension(t.mediaSelection.fileName||f.default.extractFileName(t.mediaSelection.node.node.image.uri)),scenario:{name:t.localMediaIsVideo?O.ScenarioName.SendVideo:O.ScenarioName.SendPicture},captureSessionTelemetry:t.captureSessionTelemetry,causeId:e}):this._getFileForImage(t)));a.all(t).then((e=>I.default.sendPreviewsWithData(this.props.conversationId,e,void 0))).then((()=>{const t=o.sumBy(this.state.previews,(e=>e.localMediaIsVideo?1:0)),s=this.state.previews.length;return _.track(new w.MediaPreviewTelemetryMobileEvent({imageCount:s-t,videoCount:t,totalCount:s})),_.log(m.LogTraceArea.GenericUnsafe,"CaptureMultiPreview._sendPreview, media sent, causeId: "+e),k.default.navigateToConversation({convId:this.props.conversationId,origin:m.NavigationConversationOrigin.MediaPicker,causeId:e})})).finally((()=>{this._isSendingPreviews=!1}))}}t.default=z},686817:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(665768),r=s(967593),a=s(217041),l=s(913944),d=(s(110117),s(915877)),c=s(581760),h=s(711828),u=(0,d.lazyProperties)({buttonContainer:()=>o.Styles.createViewStyle({alignItems:"center",justifyContent:"center",backgroundColor:c.Color.blackOverlay50}),buttonContainerSelected:()=>o.Styles.createViewStyle({backgroundColor:c.Color.blue,borderColor:c.Color.transparent}),buttonInnerStyle:()=>o.Styles.createButtonStyle({flex:1,paddingHorizontal:8,backgroundColor:c.Color.transparent}),absolutePosition:()=>o.Styles.createViewStyle({position:"absolute"}),justifyCenter:()=>o.Styles.createViewStyle({justifyContent:"center"}),alignCenter:()=>o.Styles.createViewStyle({alignSelf:"center"})});class p extends a.ComponentBase{constructor(){super(...arguments),this._buttonAnimatedOpacityValue=new o.Animated.Value(1),this._buttonAnimatedOpacityStyle=o.Styles.createAnimatedViewStyle({opacity:this._buttonAnimatedOpacityValue}),this._buttonAnimatedScaleValue=new o.Animated.Value(1),this._buttonAnimatedScaleStyle=o.Styles.createAnimatedViewStyle({transform:[{scale:this._buttonAnimatedScaleValue}]}),this._rotationValue=new o.Animated.Value(0),this._rotationStyle=o.Styles.createAnimatedViewStyle({transform:[{rotate:this._rotationValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._onPressIn=()=>{this._updateButton(!0)},this._onPressOut=()=>{this._updateButton(!1)}}componentDidMount(){super.componentDidMount(),this._buttonAnimatedOpacityValue.setValue(this._fullOpacity(this.props)),this._rotationValue.setValue(this.props.rotate||0)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.props.hidden===e.hidden&&this.props.disabled===e.disabled||this._buttonAnimatedOpacityValue.setValue(this._fullOpacity(e)),this.props.rotate!==e.rotate&&n.timing.easeOut({value:this._rotationValue,toValue:e.rotate||0,useNativeDriver:!0}).start()}_fullOpacity(e){return e.hidden?0:e.disabled?.4:1}fadeInOrOut(e,t=0){const s=e?0:this._fullOpacity(this.props);this._internalUpdateButton(s,1,200,t)}_updateButton(e,t=0,s=!0){const i=this.props.hidden?0:e?.8:this._fullOpacity(this.props),o=e?.92:1;this._internalUpdateButton(i,o,350,t,s)}_internalUpdateButton(e,t,s,i=0,n=!0){n?o.Animated.parallel([o.Animated.timing(this._buttonAnimatedOpacityValue,{toValue:e,duration:s,delay:i,easing:o.Animated.Easing.InOut()}),o.Animated.timing(this._buttonAnimatedScaleValue,{toValue:t,duration:s,delay:i,easing:o.Animated.Easing.OutBack()})]).start():(this._buttonAnimatedOpacityValue.setValue(e),this._buttonAnimatedScaleValue.setValue(t))}_getSizeStyle(e){return o.Styles.createViewStyle({width:e,height:e,borderRadius:e/2},!1)}render(){const e=this.props.size||56,t=this._getSizeStyle(e),s=[u.buttonContainer];this.props.selected&&s.push(u.buttonContainerSelected),s.push([t,this._buttonAnimatedOpacityStyle,this._buttonAnimatedScaleStyle]),s.push(this.props.backgroundStyle);const n=this.props.backgroundColors?(0,i.jsx)(r.GradientView,{style:[u.absolutePosition,t],colors:this.props.backgroundColors,direction:r.GradientDirection.BOTTOM_RIGHT}):void 0;return s.push(this.props.style),(0,i.jsx)(o.Animated.View,Object.assign({style:s},{children:(0,i.jsxs)(o.Animated.View,Object.assign({style:[this._rotationStyle,t]},{children:[n,(0,i.jsx)(l.default,{style:u.buttonInnerStyle,title:this.props.title,iconTextStyle:this.props.textStyle,onPress:this.props.disabled?this.props.onDisabledPress:this.props.onPress,onPressIn:!this.props.disabled||this.props.onDisabledPress?this._onPressIn:void 0,onPressOut:!this.props.disabled||this.props.onDisabledPress?this._onPressOut:void 0,size:h.IconSize.size24,color:this.props.iconColor||c.Color.white,hoverColor:this.props.iconColor||c.Color.white,icon:this.props.icon,disableTouchOpacityAnimation:!0,showShadow:this.props.showShadow,accessibilityLabel:this.props.accessibilityLabel,importantForAccessibility:this.props.importantForAccessibility})]}))}))}}t.default=p},116093:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureOverlayPageIndicator=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(889391),a=s(677381),l=s(915877),d=s(345087),c=s(29130),h=(0,l.lazyProperties)({syncIndicatorImage:()=>n.Styles.createViewStyle({height:10,width:10,transform:[{scale:.9}]}),syncIndicator:()=>n.Styles.createViewStyle({height:10,width:10,transform:[{scale:.7}],opacity:.7,marginLeft:3}),innerViewStyle:()=>n.Styles.createViewStyle({flexDirection:"row"}),innerViewStyleRTL:()=>n.Styles.createViewStyle({flexDirection:"row-reverse"})});class u extends a.default{_buildState(e,t){const s=this._getRootViewId(),i={maxPageIndicators:c.default.isSmallDevice(s)?7:15,enableGifCaptureLoadingIndicator:r.default.getS4LCMCFeatures().enableGifCaptureLoadingIndicator||!r.default.getS4LUiFeatures().jsonAnimationEnabled};return t&&(i.currentPage=0,i.totalPages=0),i}update(e,t){this.setState({currentPage:e,totalPages:t})}render(){if(!this.state.totalPages||this.props.hidden)return null;const e=this._getContext().isRTL?this.state.totalPages-1:0,t=o.times(this.state.totalPages,(t=>({uid:"page"+t,minOpacity:.33,indicatorFillStyle:t===e?d.PageIndicatorFillStyle.Unfilled:d.PageIndicatorFillStyle.Filled}))),s=this._getContext().isRTL;return(0,i.jsx)(n.View,Object.assign({style:this.props.style},{children:(0,i.jsx)(n.View,Object.assign({style:s?h.innerViewStyleRTL:h.innerViewStyle},{children:(0,i.jsx)(d.default,{currentPage:this.state.currentPage,pages:t,reverseOrder:s,indicatorDotSize:9,indicatorMargin:5,maxIndicators:this.state.maxPageIndicators,blockPointerEvents:!0,minIndicatorScale:1})}))}))}}t.CaptureOverlayPageIndicator=u,t.default=u},539003:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CaptureOverlayPager=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(217041),a=s(827028),l=s(815354),d=s(610666),c=s(351885),h=s(116184),u=s(746096),p=s(436237),g=s(861253),m=s(915877),S=s(581760),f=s(640363),y=s(680837),v=s(853374),C=(0,m.lazyProperties)({overlayContainer:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,alignItems:"center",justifyContent:"flex-end"}),stageContainer:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,overflow:"visible"}),gestureView:()=>y.default.absoluteFill,overlay:()=>n.Styles.createViewStyle({flex:1,backgroundColor:S.Color.transparent})});class _ extends r.ComponentBase{constructor(){super(...arguments),this._sendProgressEvents=!1,this._stageContainerXOffsetValue=new n.Animated.Value(0),this._stageContainerXOffsetStyle=n.Styles.createAnimatedViewStyle({transform:[{translateX:this._stageContainerXOffsetValue}]}),this._onLayoutChanged=e=>{const t={height:e.height,width:e.width};this.setState({viewDimensions:t})},this._onStageLayoutChanged=e=>{if(this.props.onOverlayProgress&&this._sendProgressEvents){const t=this._getCurrentOverlayType();if(this.state.viewDimensions.width){const s=e.x/this.state.viewDimensions.width;this._updateProgress(t,s)}else this.props.onOverlayProgress({leftOverlay:t,rightOverlay:t,progress:0})}},this._onPanHorizontal=e=>{if(!this.props.enabled)return;const t=e.pageX-e.initialPageX,s=Math.abs(t);if(this._stageContainerXOffsetValue.setValue(t),e.isComplete){const i=Math.min(this.state.viewDimensions.width/2,300),o=Math.abs(e.velocityX)>.35,r=s>i/2;let a=!0;if(r&&!o)a=!this.onAdvance(t<0);else if(o&&!r)a=!this.onAdvance(e.velocityX<0,!0);else{const s=t<0;s===e.velocityX<0&&(a=!this.onAdvance(s,!0))}a&&n.Animated.parallel([n.Animated.timing(this._stageContainerXOffsetValue,{toValue:0,duration:250,easing:o?n.Animated.Easing.Out():n.Animated.Easing.InOut()})]).start()}else this._sendProgressEvents=!0},this.onAdvance=(e,t=!1)=>{const s=e?1:-1;if(!o.find(this.state.overlayViewInfos,(e=>e.visualIndex===s)))return!1;const i=this.state.viewDimensions.width;return n.Animated.parallel([n.Animated.timing(this._stageContainerXOffsetValue,{toValue:e?-i:i,duration:250,easing:t?n.Animated.Easing.Out():n.Animated.Easing.InOut()})]).start((()=>{if(this.isComponentMounted()){this._sendProgressEvents=!1;let t=[];const s=e?-1:1;if(o.each(this.state.overlayViewInfos,(e=>{e.visualIndex+=s,e.xOffsetValue.setValue(e.visualIndex*this.state.viewDimensions.width),e.visualIndex>=-1&&e.visualIndex<=1&&t.push(e)})),t=o.sortBy(t,(e=>e.visualIndex)),e){const e=o.last(t);if(e){const s=this._getNextOverlayType(e.type);s&&t.push(_._overlayInfo(s,e.visualIndex+1,this.state.viewDimensions.width))}}else{const e=o.head(t);if(e){const s=this._getPreviousOverlayType(e.type);s&&t.push(_._overlayInfo(s,e.visualIndex-1,this.state.viewDimensions.width))}}const i=this._getCurrentOverlayType(t);this._updateProgress(i,0),this._stageContainerXOffsetValue.setValue(0),this.setState({overlayViewInfos:t})}})),!0}}_buildState(e,t){const s={overlayTypes:(f.default.isRTL()?o.reverse:o.identity)([...d.default.getOverlays(e.localMediaIsVideo)])};return t&&(s.viewDimensions={height:0,width:0},s.overlayViewInfos=[],s.prepareForSnapshot=!1),s}componentDidMount(){super.componentDidMount(),this._currentOverlay=this._getCurrentOverlayType(),this.props.onPagerUpdated&&this.props.onPagerUpdated(this._currentPage(this.props,this.state),this.state.overlayTypes.length)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.props.onPagerUpdated&&this.props.onPagerUpdated(this._currentPage(e,t),t.overlayTypes.length)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.viewDimensions!==t.viewDimensions&&o.each(this.state.overlayViewInfos,(e=>{e.xOffsetValue.setValue(e.visualIndex*this.state.viewDimensions.width)})),(!(0,g.default)(this.state.overlayTypes,t.overlayTypes)||0===this.state.overlayViewInfos.length&&this.state.overlayTypes.length>0)&&this._loadInitialOverlays(this._getCurrentOverlayType());const i=this._getCurrentOverlayType();i!==this._currentOverlay&&(this.props.onOverlaySelected&&this.props.onOverlaySelected(i),this._currentOverlay=i),!this.props.enabled&&e.enabled&&this._loadInitialOverlays()}prepareForSnapshot(){this.setState({prepareForSnapshot:!0})}restoreAfterSnapshot(){this.setState({prepareForSnapshot:!1})}_updateProgress(e,t){const s=t<0?e:this._getPreviousOverlayType(e),i=t>=0?e:this._getNextOverlayType(e);let o=t;o<0&&(o+=1),this.props.onOverlayProgress&&this.props.onOverlayProgress({leftOverlay:s,rightOverlay:i,progress:o})}_loadInitialOverlays(e){if(!this.isComponentMounted()||o.isEmpty(this.state.overlayTypes))return;let t=e||this.state.overlayTypes[0];if(-1===o.findIndex(this.state.overlayTypes,t)&&(t=this.state.overlayTypes[0]),this.props.advanceToFirstOverlay&&t.overlayType===a.OverlayType.None){const e=this._getNextOverlayType(t);e.overlayType!==a.OverlayType.None&&(t=e)}const s=[_._overlayInfo(t,0,this.state.viewDimensions.width)];let i=t,n=t;for(let e=1;e<=1;e++)i&&(i=this._getNextOverlayType(i),i&&s.push(_._overlayInfo(i,e,this.state.viewDimensions.width))),n&&(n=this._getPreviousOverlayType(n),n&&s.push(_._overlayInfo(n,-e,this.state.viewDimensions.width)));o.intersectionBy(this.state.overlayViewInfos,s,(e=>e.type.overlayType===a.OverlayType.None?e.type.overlayType:e.overlayId?e.overlayId:e.type.overlayType)).length!==s.length&&this.setState({overlayViewInfos:s})}_keyForOverlayType(e){if(e)switch(e.overlayType){case a.OverlayType.None:return"none";case a.OverlayType.Filter:return"filter_"+e.parameters.filterName}}_getCurrentOverlayType(e){const t=e||this.state.overlayViewInfos,s=o.find(t,(e=>0===e.visualIndex));return s?s.type:{overlayType:a.OverlayType.None}}_getPreviousOverlayType(e){const t=this._keyForOverlayType(e),s=o.findIndex(this.state.overlayTypes,(e=>this._keyForOverlayType(e)===t)),i=s>0?s-1:this.state.overlayTypes.length-1;return this.state.overlayTypes[i]}_getNextOverlayType(e){const t=this._keyForOverlayType(e),s=o.findIndex(this.state.overlayTypes,(e=>this._keyForOverlayType(e)===t)),i=s<this.state.overlayTypes.length-1?s+1:0;return this.state.overlayTypes[i]}_renderOverlay(e){if(e.type)switch(e.type.overlayType){case a.OverlayType.None:return(0,i.jsx)(c.BasicCaptureOverlayView,{style:C.overlay,onPanHorizontal:this.props.enabled?this._onPanHorizontal:void 0,onTap:this.props.onTap,topOffset:this.props.offset?this.props.offset.y:0});case a.OverlayType.Filter:return(0,i.jsx)(l.default,{style:C.overlay,captureOverlayType:e.type,onPanHorizontal:this.props.enabled?this._onPanHorizontal:void 0,topOffset:this.props.offset?this.props.offset.y:0,mediaDimensions:this.props.mediaDimensions,sourceImageUri:this.props.localMediaObjectUri});default:return(0,i.jsx)(h.default,{style:C.overlay,onPanHorizontal:this.props.enabled?this._onPanHorizontal:void 0,topOffset:this.props.offset?this.props.offset.y:0})}else p.log(u.LogTraceArea.Capture,"CaptureOverlayPager: _renderOverlay with no type "+JSON.stringify(e))}_currentPage(e,t){const s=this._getCurrentOverlayType(t.overlayViewInfos),i=this._keyForOverlayType(s);return o.findIndex(t.overlayTypes,(e=>this._keyForOverlayType(e)===i))}render(){const e=n.Styles.createViewStyle({width:this.state.viewDimensions.width,height:this.state.viewDimensions.height},!1),t=o.map(this.state.overlayViewInfos,(t=>{if(!t||!t.type)return p.log(u.LogTraceArea.Capture,"CaptureOverlayPager: render with no type "+JSON.stringify(t)),null;const s="overlay"+this._keyForOverlayType(t.type)+t.overlayId;let o=this._renderOverlay(t);return this.state.prepareForSnapshot&&0!==t.visualIndex&&(o=(0,i.jsx)(n.View,{})),(0,i.jsx)(n.Animated.View,Object.assign({style:[C.stageContainer,t.xOffsetStyle]},{children:(0,i.jsx)(n.View,Object.assign({style:e},{children:o}),"container")}),s)})),s=this._getCurrentOverlayType(),r=this._keyForOverlayType(s);p.log(u.LogTraceArea.Capture,"CaptureOverlayPager render "+r);const a=this.props.onTap?(0,i.jsx)(n.GestureView,{style:C.gestureView,onTap:this.props.onTap,importantForAccessibility:n.Types.ImportantForAccessibility.No}):void 0,l=[C.overlayContainer];f.default.getPlatformType()===u.PlatformType.Android&&l.push(y.default.overflowVisible),l.push(this.props.style);const d=[C.stageContainer,this._stageContainerXOffsetStyle];return(0,i.jsxs)(n.View,Object.assign({style:l,onLayout:this._onLayoutChanged},{children:[a,(0,i.jsx)(n.Animated.View,Object.assign({style:d,onLayout:this._onStageLayoutChanged},{children:t}))]}))}static _overlayInfo(e,t,s){const i=new n.Animated.Value(t*s),o=n.Styles.createAnimatedViewStyle({transform:[{translateX:i}]});let r=v.default.newGuid();const a=e.parameters;return a&&(r=a.filterName),{overlayId:r,type:e,visualIndex:t,xOffsetValue:i,xOffsetStyle:o}}}t.CaptureOverlayPager=_,t.default=_},351885:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BasicCaptureOverlayView=t.CaptureOverlayView=void 0;const i=s(785893),o=s(516778),n=s(677381);class r extends n.default{_renderContent(){}render(){return(0,i.jsx)(o.GestureView,Object.assign({style:this.props.style,onPanHorizontal:this.props.onPanHorizontal,onTap:this.props.onTap,releaseOnRequest:!1,importantForAccessibility:o.Types.ImportantForAccessibility.No},{children:this._renderContent()}))}}t.CaptureOverlayView=r;t.BasicCaptureOverlayView=class extends r{},t.default=r},459037:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CapturePanel=void 0;const i=s(785893),o=s(174958),n=s(496486),r=s(285788),a=s(418602),l=s(583367),d=s(823113),c=s(516778),h=(s(244770),s(397691)),u=s(219784),p=s(300060),g=s(889391),m=s(38566),S=s(272675),f=s(171308),y=s(867538),v=s(301065),C=s(686817),_=s(324779),b=s(951267),T=s(911009),M=s(898278),I=s(677381),w=s(746096),P=s(746096),k=s(245381),A=s(139285),x=s(436237),R=s(915877),O=s(733754),L=s(971349),F=s(10909),B=s(499201),D=s(46929),E=s(104735),V=s(330124),N=s(192210),U=s(269399),j=s(581736),H=s(364956),z=s(596345),W=s(491635),G=s(588378),K=s(29130),q=s(451070),Q=s(681115),X=s(536150),$=s(886045),J=s(404057),Y=s(581760),Z=s(711828),ee=s(478262),te=s(680837),se=s(619675),ie=s(912770),oe=s(853374);var ne,re,ae;!function(e){e[e.Camera=0]="Camera",e[e.Video=1]="Video"}(ne||(ne={})),function(e){e[e.Ready=0]="Ready",e[e.WaitingForCapture=1]="WaitingForCapture",e[e.TransitioningToPreview=2]="TransitioningToPreview"}(re||(re={})),function(e){e[e.Capture=0]="Capture",e[e.Camera=1]="Camera",e[e.MediaPicker=2]="MediaPicker"}(ae||(ae={}));const le=(0,R.lazyProperties)({permissionHelpView:()=>c.Styles.createViewStyle({flex:1,justifyContent:"center",alignItems:"center",backgroundColor:Y.Color.black,padding:20}),helpText:()=>c.Styles.createTextStyle({color:Y.Color.white,textAlign:"center"}),permissionButton:()=>c.Styles.createViewStyle({margin:20,borderColor:Y.Color.blue,borderStyle:"solid",borderWidth:1}),bottomControlsContainer:()=>c.Styles.createViewStyle({justifyContent:"center",alignItems:"center",position:"absolute",bottom:0,left:0,right:0,overflow:"visible"}),bottomControlsContainerLandscape:()=>c.Styles.createViewStyle({alignItems:"center",position:"absolute",bottom:0,right:0,top:0,overflow:"visible",flexDirection:"row"}),bottomControls:()=>c.Styles.createViewStyle({justifyContent:"space-between",alignItems:"flex-end",alignSelf:"stretch",overflow:"visible"}),bottomControlsPortrait:()=>c.Styles.createViewStyle({height:2*f.CaptureButtonSize,flexDirection:"row"}),bottomControlsLandscape:()=>c.Styles.createViewStyle({width:2*f.CaptureButtonSize}),photoShimLight:()=>c.Styles.createViewStyle({position:"absolute",top:0,right:0,left:0,height:64,opacity:.8,backgroundColor:Y.Color.transparent}),photoShimLandscape:()=>c.Styles.createViewStyle({height:100}),photoShimBottom:()=>c.Styles.createViewStyle({position:"absolute",bottom:0,right:0,left:0,height:100,opacity:.8,backgroundColor:Y.Color.transparent,transform:[{scaleY:-1}]}),focusContainer:()=>c.Styles.createViewStyle({flex:1,backgroundColor:Y.Color.transparent}),cameraPlaceholder:()=>c.Styles.createViewStyle({flex:1,justifyContent:"center",alignItems:"center"}),transparentButton:()=>c.Styles.createViewStyle({backgroundColor:Y.Color.transparent}),coachmarksStringContainer:()=>c.Styles.createViewStyle({backgroundColor:Y.Color.transparent,justifyContent:"center",alignItems:"center",position:"absolute",bottom:f.CaptureButtonSize,left:0,right:0,overflow:"visible"}),coachmarksStringText:()=>c.Styles.createTextStyle({color:Y.Color.white,backgroundColor:Y.Color.transparent,textAlign:"center"}),coachmarksError:()=>c.Styles.createTextStyle({backgroundColor:Y.Color.red,borderRadius:5,padding:5}),galleryButtonWrapperForAccessibility:()=>c.Styles.createViewStyle({justifyContent:"center",alignItems:"center",height:f.CaptureButtonSize,width:f.CaptureButtonSize,overflow:"visible"}),galleryButtonWrapperForAccessibilityPortrait:()=>c.Styles.createViewStyle({height:f.CaptureButtonSize}),textShadowStyle:()=>c.Styles.createViewStyle({shadowRadius:4,shadowOffset:{height:0,width:0},shadowOpacity:.5}),headerStyle:()=>c.Styles.createViewStyle({top:0})});class de extends I.default{constructor(){super(...arguments),this._isVisible=!1,this._appIsActive=!1,this._audioManagerClient=new m.default(m.AudioManagerSource.CapturePanel),this._shimAnimatedOpacity=new c.Animated.Value(1),this._shimAnimatedOpacityStyle=c.Styles.createAnimatedViewStyle({opacity:this._shimAnimatedOpacity}),this._innerControlsAnimatedOpacityValue=new c.Animated.Value(1),this._innerControlsAnimatedOpacityStyle=c.Styles.createAnimatedViewStyle({opacity:this._innerControlsAnimatedOpacityValue}),this._capturePanelId=n.uniqueId("CapturePanel"),this._shownCoachMarkString=!1,this._keepOrientationLockedOnTransition=!1,this._orientationLockKey=n.uniqueId("Camera"),this._coachMarkContext={coachMarkArea:T.CoachMarkAreaType.Camera},this._onCameraRef=e=>{this._camera=e||void 0,this._camera&&b.default.updateSettings(this._camera)},this._onAppStateChange=e=>{const t=oe.default.newCauseId();x.log(P.LogTraceArea.Capture,"CapturePanel._onAppStateChange "+e+" causeId: "+t),this._appIsActive=e===c.Types.AppActivationState.Active,this._updateVisibility(this.props.isVisible,!1,t)},this._onStartRecording=()=>{this.state.currentCaptureStep===re.Ready&&(this.props.isConnectedToCall?u.default.showOKAlert(O.getString("CapturePanel.VideoMessageNotAllowedTitle"),O.getString("CapturePanel.VideoMessageNotAllowedMessage"),this._getRootViewId()):this.state.microphonePermissionStatus===d.PermissionStatus.Granted?this.isComponentMounted()&&this.setState({currentMode:ne.Video}):this.state.microphonePermissionStatus===d.PermissionStatus.Unknown?j.default.requestPermission(ee.PermissionType.Microphone,ee.PermissionPromptOptions.SkipPrePrompt):this.state.microphonePermissionStatus===d.PermissionStatus.Denied&&H.default.showDeniedPromptWithSettingsOption(ee.PermissionType.Microphone,this._getRootViewId()))},this._onStopRecording=()=>{if(this.state.currentCaptureStep!==re.Ready)return void x.log(P.LogTraceArea.Capture,"CapturePanel _onStopRecording: not Ready");const e=oe.default.newCauseId();x.log(P.LogTraceArea.Capture,"CapturePanel _onStopRecording recordingInProgress: "+this.state.recordingInProgress+" camera: "+!!this._camera+" causeId: "+e),this.state.recordingInProgress?(this._camera&&(x.log(P.LogTraceArea.Capture,"CapturePanel _onStopRecording finishRecording causeId: "+e),this._camera.finishRecording()),this._initCaptureTelemetry(!0),this._keepOrientationLockedOnTransition=!0,this._setCaptureStep(re.TransitioningToPreview)):(this._camera&&(x.log(P.LogTraceArea.Capture,"CapturePanel _onStopRecording cancelRecording causeId: "+e),this._camera.cancelRecording()),this.isComponentMounted()&&this.setState({currentMode:ne.Camera}),this._animateButtonsIn())},this._onRecordError=e=>{const t=oe.default.newCauseId();x.error(P.LogTraceArea.Capture,J.default.errorAsString(e)),x.log(P.LogTraceArea.Capture,"CapturePanel had recording error causeId: "+t),this.isComponentMounted()&&(this._resetRecordingTimeout("error"),this.setState({recordingInProgress:!1}),this._setCaptureStep(re.Ready)),this._audioManagerClient.release(t)},this._onCameraTap=e=>{this._camera&&this._camera.focusTap(e.pageX,e.pageY),this.props.onTap&&this.props.onTap(e)},this._onCameraDoubleTap=()=>{this._onToggleCameraPress()},this._onPinchZoom=e=>{if(this._camera&&!(this.state.maxZoom<=1)&&(this._camera.zoom(e.isComplete,e.distance,e.initialDistance),this.state.isZooming!==!e.isComplete&&this.setState({isZooming:!e.isComplete}),b.default.hasBackTelephotoCamera())){const t=e.distance/e.initialDistance;let s=this.state.currentZoomLevel*t;s<1?s=1:s>this.state.maxZoom&&(s=this.state.maxZoom),e.isComplete&&(b.default.setZoomLevel(s),this.setState({currentZoomLevel:s}))}},this._onCapture=e=>{const t=oe.default.newCauseId();if(this.state.currentCaptureStep!==re.Ready||!this._camera)return void x.log(P.LogTraceArea.Capture," not ready for capture (step: "+this.state.currentCaptureStep+" camera: "+(this._camera?"ok":"none")+") causeId: "+t);this._keepOrientationLockedOnTransition=!0,this._initCaptureTelemetry(!1);const s=Date.now();x.log(P.LogTraceArea.Capture," _onCapture freeze: true");const i=new N.default(N.ScenarioName.PreviewSnappedPhoto);i.start(void 0,e),i.markStepCompleted("_onCapture"),b.default.setPerfScenario(N.ScenarioName.PreviewSnappedPhoto,i);const o=this._camera?h.fromThenable(this._camera.capture(true)):void 0,n=h.Defer(),r=ie.default.setTimeout((()=>{x.log(P.LogTraceArea.Capture," timeout"),n.reject("Capture timeout")}),5e3);o&&(o.then((()=>{x.track(new U.PerfCameraPhoto(Date.now()-s,V.default.isUsingStackNavigationContext()))})),h.race([o,n.promise()]).then((e=>{x.log(P.LogTraceArea.Capture,"Camera returned response of size "+e.fileSize);const t={localMediaObjectUri:e.uri,fileSize:e.fileSize,width:e.width||0,height:e.height||0,conversationId:this.props.reactionsConversationId||this.props.conversationId,parentConversationId:this.props.conversationId,skipShareWithPanel:this.props.skipShareWithPanel,onCaptureFlowComplete:this._onCaptureFlowComplete,capturedContentHandler:this.props.capturedContentHandler,captureSessionTelemetry:this._captureSessionTelemetry,entryPoint:w.PostSource.Capture,orientationLockKey:this._orientationLockKey};this.props.onHandleCapture&&this.props.onHandleCapture(t,this.state.cameraMode)?this._setCaptureStep(re.Ready):(E.default.navigateToCapturePreview(t),this._setCaptureStepDelayed(re.Ready,500))})).catch((e=>{x.error(P.LogTraceArea.Capture,J.default.errorAsString(e)),x.log(P.LogTraceArea.Capture," photo capture failed"),this._camera&&this._camera.enterPreview(),this._setCaptureStepDelayed(re.Ready,500)})).always((()=>{ie.default.clearTimeout(r)})),this._setCaptureStep(re.WaitingForCapture))},this._onCaptureFlowComplete=()=>{this.props.onCaptureFlowComplete&&this.props.onCaptureFlowComplete(),this._focusOnTab(!1,!1)},this._onCaptureButtonPressIn=()=>{this.setState({toolTipInfo:void 0}),c.Animated.timing(this._innerControlsAnimatedOpacityValue,{toValue:0,duration:200,easing:c.Animated.Easing.Out(),delay:200,useNativeDriver:!0}).start()},this._onCaptureButtonPressOut=()=>{x.log(P.LogTraceArea.Capture," _onCaptureButtonPressOut Video mode: "+(this.state.currentMode===ne.Video)),this.state.currentMode===ne.Video?this._onStopRecording():this._animateButtonsIn()},this._animateButtonsIn=()=>{x.log(P.LogTraceArea.Capture," _animateButtonsIn"),c.Animated.timing(this._innerControlsAnimatedOpacityValue,{toValue:1,duration:200,easing:c.Animated.Easing.Out(),delay:100,useNativeDriver:!0}).start()},this._onCameraPermissionPressed=e=>{e.stopPropagation(),j.default.requestPermission(ee.PermissionType.Camera,ee.PermissionPromptOptions.SkipPrePrompt,d.PermissionOrigin.CapturePanel)},this._onCaptureButtonRef=e=>{this._captureButton=e,this.state.enableAccessibleRecordButton||this._captureButton&&n.delay((()=>{if(!this.isComponentMounted())return;const e=O.getString("CapturePanel.CaptureButtonTooltip"),t={getElement:()=>this._captureButton,positions:[T.PopupAnchorPositon.Top,T.PopupAnchorPositon.Bottom],title:e,durationMs:3e3,anchorAccessibilityLabel:e,instanceId:"capturebuttonephermeraltext",rootViewId:this._getRootViewId()};this.setState({toolTipInfo:t})}),1e3)},this._onCameraFailure=e=>{x.log(P.LogTraceArea.Capture,"CapturePanel._onCameraFailure "+o.pii.Omit(e.failure)+" from "+e.source),x.track(new S.CameraFailureEvent(e.failure,e.source,e.details))},this._onFirstFrame=e=>{x.log(P.LogTraceArea.Capture,"CapturePanel._onFirstFrame from "+e.source),this._isVisibleTimeMs?x.track(new S.CameraFirstFrame(this._isVisibleTimeMs,e.source)):x.warn(P.LogTraceArea.Capture,"CapturePanel._onFirstFrame with no visible time!")},this._onQRCodeDetect=e=>{if(this.props.captureMode!==w.CaptureMode.QR)return;const{nativeEvent:t}=e,s=t.string;x.log(P.LogTraceArea.Capture,"CapturePanel._onQRCodeDetect "+o.pii.Omit(s)),(0,W.openJoinLink)(s,!0,this._getRootViewId())},this._onRecordingChange=e=>{const t=e.nativeEvent.isRecording;this.state.recordingInProgress&&!t&&this.state.currentMode===ne.Video&&this._setCaptureStep(re.TransitioningToPreview),t||this._resetRecordingTimeout("onRecordingChange"),this.isComponentMounted()&&this.setState({recordingInProgress:t,recordingStartTime:t?Date.now():0})},this._resetRecordingTimeout=e=>{this._recordingTimeout&&(x.log(P.LogTraceArea.Capture,": clearing recording timeout "+e),ie.default.clearTimeout(this._recordingTimeout),this._recordingTimeout=void 0)},this._onToggleCameraPress=()=>{const e=oe.default.newCauseId();x.log(P.LogTraceArea.Capture,"CapturePanel._onToggleCameraPress causeId: "+e),b.default.toggleCamera(),b.default.setZoomLevel(1),$.default.maybeAnnounceForAccessibility(this.state.cameraMode===b.CameraMode.Front?O.getString("CapturePanel.SwitchedCameraToFrontAccessibilityLabel"):O.getString("CapturePanel.SwitchedCameraToBackAccessibilityLabel"),100)},this._onMediaPickerPress=()=>{G.default.markAsWatched(),this.props.onHandleMediaPicker&&this.props.onHandleMediaPicker(this.props.conversationId)?x.log(P.LogTraceArea.Capture,"CapturePanel._onMediaPickerPress : onHandleMediaPicker "):(x.log(P.LogTraceArea.Capture,"CapturePanel._onMediaPickerPress"),E.default.navigateToMediaPickerPanelWithParams({capturedContentHandler:this.props.capturedContentHandler,conversationId:this.props.conversationId,onSendFlowComplete:this._onMediaPickerSendFlowComplete}))},this._onMediaPickerSendFlowComplete=()=>{const e=oe.default.newCauseId();x.log(P.LogTraceArea.Capture,"CapturePanel._onMediaPickerSendFlowComplete, causeId: "+e),this.props.onCaptureFlowComplete&&this.props.onCaptureFlowComplete(),this.props.conversationId?E.default.navigateToConversation({convId:this.props.conversationId,causeId:e,origin:P.NavigationConversationOrigin.CapturePanel}):E.default.navigateToRecentsTab()},this._headerBackPress=()=>{x.log(P.LogTraceArea.Capture,"CapturePanel._headerBackPress"),this.props.onBackPressed&&this.props.onBackPressed()},this._headerZoomPress=()=>{x.log(P.LogTraceArea.Capture,"CapturePanel._headerZoomPress"),this._camera&&(1===this.state.currentZoomLevel?(this._camera.setZoomFactor(2),b.default.setZoomLevel(2)):(this._camera.setZoomFactor(1),b.default.setZoomLevel(1)))},this._toolTipAnimationConfig={presentOffset:{x:0,y:15},dismissOffset:{x:0,y:0},duration:250,easing:c.Animated.Easing.OutBack()},this._onDismissTooltip=()=>{this._shownCoachMarkString=!0}}_buildState(e,t){const s=g.default.getS4LCMCFeatures(),i=q.default.bottomSafeAreaInset(M.BottomInsetDefault),o=q.default.horizontalInsets(M.HorizontalInsetDefault),n=this._getRootViewId(),r=b.default.getSupportedCameras(),a={flashMode:b.default.getCurrentFlashMode(),cameraMode:b.default.getCurrentCameraMode(),currentZoomLevel:b.default.getCurrentZoomLevel(),maxZoom:b.default.maxZoom(),cameraPermissionStatus:j.default.permissionStatus(ee.PermissionType.Camera),microphonePermissionStatus:j.default.permissionStatus(ee.PermissionType.Microphone),supportedCameras:r,inCallSelectedCameraId:undefined,inCallSelectedCameraPosition:undefined,bottomControlsInset:e.bottomControlsInset?Math.max(0,e.bottomControlsInset):0,horizontalSafeAreaInsets:o,bottomSafeAreaInset:i,cameraOverride:!b.default.isCameraAvailable(),enableAccessibleRecordButton:s.enableAccessibleRecordButton||X.default.isMobileScreenReaderEnabled(),enableCameraPortraitLock:s.enableCameraPortraitLock};if(t){const t=g.default.getOnboardingFeatures();a.forceCameraPermissionPrompt=t.enableInContextCameraPermission,a.currentMode=ne.Camera,a.recordingInProgress=!1,a.recordingStartTime=0,a.recordingTime="",a.currentCaptureStep=re.Ready,a.isZooming=!1,a.hideHeader=!1,a.deviceOrientation=e.adjustLayoutForDeviceOrientation?K.default.getDeviceOrientation(n):l.DeviceOrientation.Portrait,a.maxRecordingMs=s.maxRecordingMs,a.videoWidth=s.videoWidth,a.videoHeight=s.videoHeight,a.videoBitrate=s.videoBitrate,a.enableAdaptiveCameraContentScale=s.enableAdaptiveCameraContentScale,a.videoProfile=s.videoProfile,a.enableVideoBFrame=s.enableVideoBFrame,a.cameraVersion=s.cameraVersion}const d=[],c=v.CaptureFirstRunLevel.All;d.push({type:ae.MediaPicker,hidden:e.disableMediaPicker}),d.push({type:ae.Capture,hidden:e.captureMode===w.CaptureMode.QR}),d.push({type:ae.Camera,hidden:r<=1||e.captureMode===w.CaptureMode.QR}),a.buttonRenderInfo=d,a.coachmarksLevel=c;const h=D.default.getCaptureFirstRunLevel()||v.CaptureFirstRunLevel.None;return a.showCoachmarks=e.showCoachmarksIfNeeded&&h<c,a.recentAssetTimestamp=G.default.getRecentAssetTimestamp(),a.showRecentAssetNotification=G.default.hasRecentAsset(),a.recentAssetThumbnailUrl=G.default.getRecentAssetThumbnail(),a}componentDidMount(){super.componentDidMount();const e=oe.default.newCauseId();x.log(P.LogTraceArea.Capture,"CapturePanel: componentDidMount with isVisible = "+this.props.isVisible+" causeId: "+e),this._appIsActive=!0,this._updateVisibility(this.props.isVisible,!0,e),this.state.enableCameraPortraitLock||this._startOrStopOrientationListener(),this.props.isVisible&&this.props.isFocussedCamera&&!this.state.bottomControlsInset&&F.default.addOrUpdateBottomMargin(this._capturePanelId,f.CaptureButtonSize),this._appStateSubscription=p.default.subscribeForChanges("CapturePanel",this._onAppStateChange),this._camera&&this.props.discardTempFilesFromPreviousSession&&a.CameraView.discardTempFiles(),this.state.forceCameraPermissionPrompt&&this.state.cameraPermissionStatus===d.PermissionStatus.Unknown&&j.default.requestPermission(ee.PermissionType.Camera,ee.PermissionPromptOptions.SkipPrePrompt,d.PermissionOrigin.CapturePanel),this.state.enableCameraPortraitLock&&(this.setState({deviceOrientation:l.DeviceOrientation.Portrait}),B.default.addOrUpdateOrientationLock(this._orientationLockKey,l.DeviceOrientation.Portrait,!0).then((()=>{x.log(P.LogTraceArea.Capture,"CapturePanel lock orientation portrait"),this._startOrStopOrientationListener(),l.default.currentOrientationInSpace().then((e=>{x.log(P.LogTraceArea.Capture,"CapturePanel orientationInSpace",e),this.isComponentMounted()&&this.setState({deviceOrientationInSpace:e})}))}),(e=>{x.warn(P.LogTraceArea.Capture,"CapturePanel lockOrientation failed: "+J.default.errorAsString(e))})))}componentWillUnmount(){super.componentWillUnmount();const e=oe.default.newCauseId();x.log(P.LogTraceArea.Capture,"CapturePanel.componentWillUnmount causeId: "+e),this._updateVisibility(!1,!1,e),this._audioManagerClient.release(e),this._deviceOrientationKey&&(l.default.removeOrientationEventListener(this._deviceOrientationKey),this._deviceOrientationKey=void 0),F.default.removeBottomMargin(this._capturePanelId),this._appStateSubscription&&this._appStateSubscription.unsubscribe(),b.default.setZoomLevel(1),this.state.enableCameraPortraitLock&&!this._keepOrientationLockedOnTransition&&(B.default.removeOrientationLock(this._orientationLockKey),x.log(P.LogTraceArea.Capture,"CapturePanel remove orientation lock"))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=oe.default.newCauseId();x.log(P.LogTraceArea.Capture,"CapturePanel.componentDidUpdate causeId: "+i);const o=b.default.maybeGetAndClearPerfScenario(N.ScenarioName.ShowCameraViewfinder);o&&(o.markStepCompleted("componentDidUpdate"),n.defer((()=>{o&&(o.markStepCompleted("backOnJSThread"),o.finish())}))),this.state.currentMode!==t.currentMode&&(x.log(P.LogTraceArea.Capture,"CapturePanel currentMode "+t.currentMode+" -> "+this.state.currentMode+" causeId: "+i),this.state.currentMode!==ne.Video&&this._audioManagerClient.release(i),this._focusOnTab(this.state.currentMode!==ne.Camera,this.state.currentMode===ne.Video),this.state.enableCameraPortraitLock||(this.state.currentMode===ne.Video?l.default.lockOrientation().then(n.noop,(e=>{x.warn(P.LogTraceArea.Capture,"CapturePanel lockOrientation failed: "+J.default.errorAsString(e))})):l.default.unlockOrientation().then(n.noop,(e=>{x.warn(P.LogTraceArea.Capture,"CapturePanel unlockOrientation failed: "+J.default.errorAsString(e))})))),this.state.isZooming!==t.isZooming&&this._focusOnTab(this.state.isZooming,this.state.isZooming),this.state.currentCaptureStep!==t.currentCaptureStep&&(x.log(P.LogTraceArea.Capture,"CapturePanel currentCaptureStep "+t.currentCaptureStep+" -> "+this.state.currentCaptureStep+" causeId: "+i),this.state.currentCaptureStep===re.Ready&&this.setState({currentMode:ne.Camera})),this.state.currentMode===ne.Video&&t.currentMode!==ne.Video&&(x.log(P.LogTraceArea.Capture,"CapturePanel currentMode Video causeId: "+i),this._requestAudioRecord(i).then((()=>{if(this.state.currentMode!==ne.Video||!this._camera)return void this._audioManagerClient.release(i);const e=h.fromThenable(this._camera.startRecording()),t=h.Defer();this._recordingTimeout=ie.default.setTimeout((()=>{x.log(P.LogTraceArea.Capture,"CapturePanel timeout"),t.reject("Capture timeout")}),this.state.maxRecordingMs+5e3),h.race([e,t.promise()]).then((e=>{x.log(P.LogTraceArea.Capture,"CapturePanel got recording response");const t={localMediaObjectUri:e.uri,localMediaThumbnailUri:e.thumbnailUri,localMediaIsVideo:!0,fileSize:e.fileSize,width:e.width||0,height:e.height||0,conversationId:this.props.reactionsConversationId||this.props.conversationId,parentConversationId:this.props.conversationId,skipShareWithPanel:this.props.skipShareWithPanel,onCaptureFlowComplete:this._onCaptureFlowComplete,capturedContentHandler:this.props.capturedContentHandler,captureSessionTelemetry:this._captureSessionTelemetry,entryPoint:w.PostSource.Capture,orientationLockKey:this._orientationLockKey};this.props.onHandleCapture&&this.props.onHandleCapture(t,this.state.cameraMode)?this._setCaptureStep(re.Ready):(E.default.navigateToCapturePreview(t),this._setCaptureStepDelayed(re.Ready,500)),this._resetRecordingTimeout("success")})).catch(this._onRecordError)})).fail(this._onRecordError));const r=this._updateVisibility(this.props.isVisible,!1,i);if(this.props.adjustLayoutForDeviceOrientation!==e.adjustLayoutForDeviceOrientation&&this._startOrStopOrientationListener(),this.state.deviceOrientationInSpace===t.deviceOrientationInSpace||this.state.deviceOrientationInSpace!==l.DeviceOrientationInSpace.LandscapeLeft&&this.state.deviceOrientationInSpace!==l.DeviceOrientationInSpace.LandscapeRight||this.setState({toolTipInfo:void 0}),this.state.enableCameraPortraitLock&&this.state.deviceOrientation===l.DeviceOrientation.Portrait||!this.state.enableCameraPortraitLock){const e=q.default.statusBarHeight();this.setState({topControlsInset:e>24?e:0})}(r||this.props.isFocussedCamera!==e.isFocussedCamera||this.state.bottomControlsInset!==t.bottomControlsInset)&&(this._isVisible&&this.props.isFocussedCamera?F.default.addOrUpdateBottomMargin(this._capturePanelId,this.state.bottomControlsInset?0:f.CaptureButtonSize):F.default.removeBottomMargin(this._capturePanelId))}_updateVisibility(e,t,s){e=this._appIsActive&&e;const i=()=>{this._captureButton&&e&&this.isComponentMounted()&&this._captureButton.requestFocus()};return t&&n.delay((()=>{i()}),200),e!==this._isVisible&&(i(),x.log(P.LogTraceArea.Capture,"CapturePanel._updateVisibility changed from "+this._isVisible+" to "+e),e?this._isVisibleTimeMs=Date.now():this._isVisibleTimeMs&&(x.track(new S.CameraVisibleTime(this._isVisibleTimeMs,Date.now())),this._isVisibleTimeMs=void 0),b.default.setAsyncCaptureStatus(this._capturePanelId,e),e||(this._audioManagerClient.release(s),z.default.reset()),this._isVisible=e,!0)}handleBackAction(){return this.state.recordingInProgress}_startOrStopOrientationListener(){this.props.adjustLayoutForDeviceOrientation?this._deviceOrientationKey||(this._deviceOrientationKey=n.uniqueId("CaptureOrientation"),this.state.enableCameraPortraitLock?l.default.addOrientationEventListener(this._deviceOrientationKey,((e,t)=>{x.log(P.LogTraceArea.Capture,"CapturePanel _startOrStopOrientationListener deviceOrientation:",e,"deviceOrientationInSpace: ",t),this.isComponentMounted()&&this.state.deviceOrientation!==e&&this.setState({deviceOrientation:e}),this.isComponentMounted()&&this.state.currentMode!==ne.Video&&this.state.deviceOrientationInSpace!==t&&this.setState({deviceOrientationInSpace:t})})):l.default.addOrientationEventListener(this._deviceOrientationKey,(e=>{this.isComponentMounted()&&this.state.deviceOrientation!==e&&this.setState({deviceOrientation:e})}))):this._deviceOrientationKey&&(l.default.removeOrientationEventListener(this._deviceOrientationKey),this._deviceOrientationKey=void 0)}_requestAudioRecord(e){return x.log(P.LogTraceArea.Capture,"CapturePanel _requestAudioRecord: causeId: "+e),this._audioManagerClient.hasToken()?h.Resolved(void 0):this._audioManagerClient.requestMode(r.AudioModes.Capture,e).then((e=>h.Resolved()))}_focusOnTab(e,t){c.Animated.timing(this._shimAnimatedOpacity,{toValue:t?0:1,duration:200,easing:c.Animated.Easing.Linear()}).start(),this.props.onFocusOnCamera&&this.props.onFocusOnCamera(e),this.isComponentMounted()&&this.setState({hideHeader:!!t})}_clearCaptureStepTimer(){this._captureStepTimer&&(ie.default.clearTimeout(this._captureStepTimer),this._captureStepTimer=void 0)}_setCaptureStep(e,t={}){this._clearCaptureStepTimer(),this.isComponentMounted()&&(x.log(P.LogTraceArea.Capture," setting capture step: "+e),t.currentCaptureStep=e,this.setState(t))}_setCaptureStepDelayed(e,t){this._clearCaptureStepTimer(),t>0?(x.log(P.LogTraceArea.Capture," setting capture step: "+e+" delayed: "+t),this._captureStepTimer=ie.default.setTimeout((()=>{this._captureStepTimer=void 0,this.isComponentMounted()&&this.setState({currentCaptureStep:e})}),t)):this._setCaptureStep(e)}_deviceOrientationInSpaceCompensation(e){return e===l.DeviceOrientationInSpace.LandscapeLeft?90:e===l.DeviceOrientationInSpace.LandscapeRight?-90:0}_renderHeader(e){const t=[le.headerStyle,te.default.absoluteFill];return this.state.deviceOrientation===l.DeviceOrientation.Landscape&&this.state.horizontalSafeAreaInsets.left&&t.push(c.Styles.createViewStyle({left:this.state.horizontalSafeAreaInsets.left},!1)),t.push(c.Styles.createViewStyle({top:this.state.topControlsInset},!1)),this.state.hideHeader?void 0:(0,i.jsx)(_.default,{style:t,closeInsteadOfBackButton:this.props.closeInsteadOfBackButton,deviceOrientation:this.state.deviceOrientation,backButtonOnly:e,onBackPressed:this._headerBackPress,onZoomPressed:this._headerZoomPress,rotateIcons:this.state.enableCameraPortraitLock?this._deviceOrientationInSpaceCompensation(this.state.deviceOrientationInSpace):0,enableCameraPortraitLock:this.state.enableCameraPortraitLock})}_renderPermissionsStatusView(){let e,t;this.state.forceCameraPermissionPrompt||this.state.cameraPermissionStatus!==d.PermissionStatus.Unknown?this.state.cameraPermissionStatus===d.PermissionStatus.Denied&&(t=H.default.getDeniedPrompt(ee.PermissionType.Camera)):(t=H.default.getPrePrompt(ee.PermissionType.Camera),e=(0,i.jsx)(C.default,{backgroundStyle:le.permissionButton,title:O.getString("CapturePanel.CameraPermissionTitle"),onPress:this._onCameraPermissionPressed,icon:Z.SkypeIcon.Ok,orientationIsLandscape:this.state.deviceOrientation===l.DeviceOrientation.Landscape},"cameraPermission"));const s=[le.helpText];return Q.default.hasHorizontalSafeAreas(this.state.horizontalSafeAreaInsets)&&s.push(Q.default.horizontalMarginStyle(this.state.horizontalSafeAreaInsets)),(0,i.jsx)(c.View,Object.assign({style:this.props.style},{children:(0,i.jsxs)(c.GestureView,Object.assign({style:le.permissionHelpView,releaseOnRequest:!0},{children:[(0,i.jsx)(se.BodyText,Object.assign({size:se.BodyTextSize.BigDeprecated,style:s},{children:t})),e,this._renderHeader(!0)]}))}))}_initCaptureTelemetry(e){const t=new L.CaptureSession(w.PostSource.Capture);t.setIsVideo(e),t.setCameraMode(b.CameraMode[this.state.cameraMode]),t.setDeviceOrientation(this.state.deviceOrientation),this._captureSessionTelemetry=t}render(){const e=this.state.deviceOrientation===l.DeviceOrientation.Landscape;if(this.state.cameraPermissionStatus!==d.PermissionStatus.Granted)return(0,i.jsx)(T.CoachMarkContext.Provider,Object.assign({value:this._coachMarkContext},{children:this._renderPermissionsStatusView()}));let t;if(this.state.cameraOverride||!this.props.isFocussedCamera&&!this.state.recordingInProgress){let e;if(this.state.cameraOverride){const t=[le.helpText];Q.default.hasHorizontalSafeAreas(this.state.horizontalSafeAreaInsets)&&t.push(Q.default.horizontalMarginStyle(this.state.horizontalSafeAreaInsets)),e=(0,i.jsx)(se.BodyText,Object.assign({size:se.BodyTextSize.BigDeprecated,style:t},{children:O.getString("CapturePanel.SplitScreenWarningLabel")}))}t=(0,i.jsx)(c.View,Object.assign({style:le.cameraPlaceholder},{children:e}))}else t=(0,i.jsx)(a.CameraView,{ref:this._onCameraRef,style:te.default.flexOne,sessionActive:this.props.isVisible,cameraMode:b.default.convertCameraModeEnumToString(this.state.cameraMode),flashMode:b.default.convertFlashModeEnumToString(this.state.flashMode),useShutterAnimation:!1,onRecordingChange:this._onRecordingChange,onCameraFailure:this._onCameraFailure,onQRCodeDetect:this._onQRCodeDetect,onFirstFrame:this._onFirstFrame,releaseOnBackground:!this.props.disableBackgroundCameraRelease,videoThumbnailMaxDimension:360,videoThumbnailCompressionRate:70,maxRecordingMs:this.state.maxRecordingMs,videoWidth:this.state.videoWidth,videoHeight:this.state.videoHeight,videoBitrate:this.state.videoBitrate,adaptiveContentScale:this.state.enableAdaptiveCameraContentScale,fillContentMode:!0,useSensorOrientation:this.state.enableCameraPortraitLock});t&&!this.state.cameraOverride&&(t=(0,i.jsx)(c.GestureView,Object.assign({importantForAccessibility:c.Types.ImportantForAccessibility.No,style:le.focusContainer,onTap:this._onCameraTap,onDoubleTap:this._onCameraDoubleTap,onPinchZoom:this._onPinchZoom,releaseOnRequest:!this.state.isZooming},{children:t}),"camera"));const s=e?[le.bottomControlsContainerLandscape]:[le.bottomControlsContainer];this.state.bottomControlsInset&&this.state.deviceOrientation!==l.DeviceOrientation.Landscape&&s.push(c.Styles.createViewStyle({bottom:this.state.bottomControlsInset},!1)),this.state.horizontalSafeAreaInsets.right&&this.state.deviceOrientation===l.DeviceOrientation.Landscape&&s.push(c.Styles.createViewStyle({right:this.state.horizontalSafeAreaInsets.right},!1));const o=e?this.state.buttonRenderInfo.slice(0).reverse():this.state.buttonRenderInfo,r=n.map(o,(t=>{x.log(P.LogTraceArea.Capture," ButtonType: "+t.type+" hidden: "+t.hidden+" disabled: "+t.disabled);const s=[le.galleryButtonWrapperForAccessibility];this.state.deviceOrientation===l.DeviceOrientation.Portrait&&s.push(le.galleryButtonWrapperForAccessibilityPortrait);const o=this.state.enableCameraPortraitLock?this._deviceOrientationInSpaceCompensation(this.state.deviceOrientationInSpace):void 0;switch(t.type){case ae.MediaPicker:const n=O.getString("CapturePanel.MediaPickerAccessibilityLabel");let r;return r=this.state.recentAssetThumbnailUrl?(0,i.jsx)(y.default,{title:O.getString("CapturePanel.MediaPickerTitle"),onPress:t.disabled||t.hidden?void 0:this._onMediaPickerPress,hidden:t.hidden,selected:t.selected,disabled:t.disabled,backgroundStyle:le.transparentButton,showShadow:!0,accessibilityLabel:n,importantForAccessibility:t.hidden?c.Types.ImportantForAccessibility.NoHideDescendants:void 0,orientationIsLandscape:this.state.deviceOrientation===l.DeviceOrientation.Landscape,recentAssetThumbnailUrl:this.state.recentAssetThumbnailUrl,recentAssetTimestamp:this.state.recentAssetTimestamp,showRecentAssetNotification:this.state.showRecentAssetNotification,textStyle:le.textShadowStyle,rotate:o,enableCameraPortraitLock:this.state.enableCameraPortraitLock},"mediaPickerButton"):(0,i.jsx)(C.default,{title:O.getString("CapturePanel.MediaPickerTitle"),onPress:t.disabled||t.hidden?void 0:this._onMediaPickerPress,icon:Z.SkypeIcon.Picture,hidden:t.hidden,selected:t.selected,disabled:t.disabled,backgroundStyle:le.transparentButton,showShadow:!0,accessibilityLabel:n,importantForAccessibility:t.hidden?c.Types.ImportantForAccessibility.NoHideDescendants:void 0,orientationIsLandscape:this.state.deviceOrientation===l.DeviceOrientation.Landscape,size:60,rotate:o},"mediaPickerButton"),(0,i.jsx)(c.Animated.View,Object.assign({style:[s,this._innerControlsAnimatedOpacityStyle],ignorePointerEvents:!0},{children:(0,i.jsx)(T.CoachMarkContext.Provider,Object.assign({value:this._coachMarkContext},{children:r}))}),"mediaPickerButtonWrapper");case ae.Camera:const a=b.default.getCameraToggleMode();let d;return t.disabled||t.hidden||a===b.CameraMode.None||(d=a===b.CameraMode.Front?O.getString("CapturePanel.SwitchCameraToFrontAccessibilityLabel"):O.getString("CapturePanel.SwitchCameraToBackAccessibilityLabel")),(0,i.jsx)(c.Animated.View,Object.assign({style:[s,this._innerControlsAnimatedOpacityStyle],ignorePointerEvents:!0},{children:(0,i.jsx)(T.CoachMarkContext.Provider,Object.assign({value:this._coachMarkContext},{children:(0,i.jsx)(C.default,{title:O.getString("CapturePanel.SwitchCameraButtonTitle"),onPress:t.disabled||t.hidden?void 0:this._onToggleCameraPress,icon:Z.SkypeIcon.RotateOrientation,hidden:t.hidden,selected:t.selected,disabled:t.disabled,backgroundStyle:le.transparentButton,showShadow:!0,accessibilityLabel:d,importantForAccessibility:t.hidden?c.Types.ImportantForAccessibility.NoHideDescendants:void 0,size:60,textStyle:le.textShadowStyle,orientationIsLandscape:this.state.deviceOrientation===l.DeviceOrientation.Landscape,rotate:o},"cameraButton")}))}),"cameraButtonWrapper");case ae.Capture:let h;const u=(this.props.captureMode===w.CaptureMode.Default||this.props.captureMode===w.CaptureMode.VideoOnly)&&this.state.enableAccessibleRecordButton;let p=u?O.getString("CapturePanel.CapturePhotoButtonAccessibilityLabel"):O.getString("CapturePanel.CaptureButtonAccessibilityLabel");switch(this.props.captureMode){case w.CaptureMode.Default:h=this.state.currentMode===ne.Camera?this._onCapture:this._onStopRecording;break;case w.CaptureMode.PhotoOnly:h=this.state.currentMode===ne.Camera?this._onCapture:void 0,p=O.getString("CapturePanel.CapturePhotoButtonAccessibilityLabel");break;case w.CaptureMode.VideoOnly:h=this.state.currentMode===ne.Camera?this._onStartRecording:this._onStopRecording}return(0,i.jsx)(T.CoachMarkContext.Provider,Object.assign({value:this._coachMarkContext},{children:(0,i.jsx)(f.default,{ref:this._onCaptureButtonRef,captureMode:this.props.captureMode,bottomInset:this.state.bottomControlsInset,onPress:h,onPressIn:this._onCaptureButtonPressIn,onPressOut:this._onCaptureButtonPressOut,onStartRecording:this._onStartRecording,isRecording:this.state.currentMode===ne.Video,isLandscape:e,disabled:this.state.currentCaptureStep!==re.Ready||t.disabled,recordingDuration:this.state.maxRecordingMs,captureAccessibilityLabel:p,enableAccessibleRecordButton:u,rotate:o,enableCameraPortraitLock:this.state.enableCameraPortraitLock},"captureButton")}))}})),h=[le.bottomControls];e?h.push(le.bottomControlsLandscape):h.push(le.bottomControlsPortrait);let u=(0,i.jsx)(c.View,Object.assign({style:h,ignorePointerEvents:!0},{children:r}),"innerControls");this.props.secondaryOpacityStyle&&(u=(0,i.jsx)(c.Animated.View,Object.assign({style:[te.default.overflowVisible,this.props.secondaryOpacityStyle],ignorePointerEvents:!0},{children:u})));const p=(0,i.jsx)(c.View,Object.assign({style:s,ignorePointerEvents:!0},{children:u}),"bottomControls"+this.state.deviceOrientation),g=this.props.captureMode===w.CaptureMode.Default&&this.state.deviceOrientation!==l.DeviceOrientation.Landscape&&this.state.currentMode===ne.Camera&&this.props.isVisible;let m;const S=[le.coachmarksStringContainer],v=[le.coachmarksStringText];let _;if(g){this.state.bottomControlsInset&&S.push(c.Styles.createViewStyle({bottom:this.state.bottomControlsInset+f.CaptureButtonSize+30},!1));let e="";this.state.coachmarksErrorText?(e=this.state.coachmarksErrorText,v.push(le.coachmarksError)):(!this._shownCoachMarkString&&!this.state.enableCameraPortraitLock||this.state.enableCameraPortraitLock&&this.state.deviceOrientationInSpace===l.DeviceOrientationInSpace.Portrait)&&(_=(0,i.jsx)(k.default,{toolTipInfo:this.state.toolTipInfo,animateDismissal:!0,onDismiss:this._onDismissTooltip,animationConfig:this._toolTipAnimationConfig,containerOffsetY:14,textMarginHorizontal:14,textMarginVertical:10,backgroundColor:Y.Color.black,backgroundColorOpacity:.5,strokeColorOpacity:.5})),m=(0,i.jsx)(A.default,Object.assign({style:S},{children:(0,i.jsx)(se.BodyText,Object.assign({size:se.BodyTextSize.BigDeprecated,style:v},{children:e}))}),"coachmarkstring")}const M=[le.photoShimLight,this._shimAnimatedOpacityStyle];e&&M.push(le.photoShimLandscape);return(0,i.jsx)(c.View,Object.assign({style:this.props.style,importantForAccessibility:this.props.preventAccessibilityFocus?c.Types.ImportantForAccessibility.NoHideDescendants:void 0},{children:(0,i.jsxs)(T.CoachMarkContext.Provider,Object.assign({value:this._coachMarkContext},{children:[t,undefined,undefined,this.state.cameraOverride?void 0:m,this.state.cameraOverride?void 0:_,this.state.cameraOverride?void 0:p,this._renderHeader(this.state.cameraOverride)]}))}))}}t.CapturePanel=de,t.default=de},324779:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CapturePanelHeader=void 0;const i=s(785893),o=s(496486),n=s(583367),r=s(823113),a=s(665768),l=s(516778),d=s(217041),c=s(951267),h=s(746096),u=s(913944),p=s(436237),g=s(915877),m=s(733754),S=s(581736),f=s(886045),y=s(581760),v=s(711828),C=s(734528),_=s(478262),b=(0,g.lazyProperties)({header:()=>l.Styles.createViewStyle({alignItems:"center",alignSelf:"stretch",backgroundColor:y.Color.transparent,justifyContent:"space-between",overflow:"visible",margin:10}),headerPortrait:()=>l.Styles.createViewStyle({height:v.IconSize.default,flexDirection:"row"}),headerLandscape:()=>l.Styles.createViewStyle({width:v.IconSize.default,flexDirection:"column"}),button:()=>l.Styles.createButtonStyle({justifyContent:"center",alignItems:"center",width:v.IconSize.default,height:v.IconSize.default,borderRadius:v.IconSize.default/2,overflow:"visible"}),leftControls:()=>l.Styles.createViewStyle({flexDirection:"row"}),rightControls:()=>l.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end"}),rightBarButtons:()=>l.Styles.createViewStyle({flexDirection:"row"}),rightBarButtonsLandscape:()=>l.Styles.createViewStyle({flexDirection:"column"}),zoomButtonCircle:()=>l.Styles.createViewStyle({borderWidth:1.5,borderColor:y.Color.white,width:v.IconSize.size32,height:v.IconSize.size32,shadowColor:y.Color.black,shadowOpacity:.7,shadowRadius:2,shadowOffset:{height:0,width:0},overflow:"visible"}),zoomRatio:()=>l.Styles.createTextStyle({color:y.Color.white,fontSize:11})});class T extends d.ComponentBase{constructor(){super(...arguments),this._rotationValue=new l.Animated.Value(0),this._rotationStyle=l.Styles.createAnimatedViewStyle({transform:[{rotate:this._rotationValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._onToggleFlash=()=>{p.log(h.LogTraceArea.Capture,"CapturePanelHeader._onToggleFlash"),c.default.toggleFlash(),f.default.maybeAnnounceForAccessibility(m.getString(this.state.currentFlashMode===c.FlashMode.Off?"CapturePanel.ToggleFlashOnAccessibilityLabel":"CapturePanel.ToggleFlashOffAccessibilityLabel"))}}_buildState(e,t){return{hasFlash:c.default.hasFlash(),currentFlashMode:c.default.getCurrentFlashMode(),currentCameraMode:c.default.getCurrentCameraMode(),cameraPermissionStatus:S.default.permissionStatus(_.PermissionType.Camera),zoomRatio:c.default.getCurrentZoomLevel(),showTelephotoButton:c.default.getCurrentCameraMode()===c.CameraMode.Back&&c.default.hasBackTelephotoCamera()}}componentDidMount(){super.componentDidMount(),this.props.enableCameraPortraitLock&&this._rotationValue.setValue(this.props.rotateIcons||0)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.props.enableCameraPortraitLock&&this.props.rotateIcons!==e.rotateIcons&&a.timing.easeOut({value:this._rotationValue,toValue:e.rotateIcons||0,useNativeDriver:!0}).start()}render(){const e=this.props.closeInsteadOfBackButton?m.getString("CapturePanel.CloseCapturePanelAccessibilityLabel"):m.getString("Global.BackButtonTitle"),t=(0,i.jsx)(l.Animated.View,Object.assign({style:[this.props.enableCameraPortraitLock?this._rotationStyle:void 0,b.button]},{children:(0,i.jsx)(u.default,{style:b.button,size:v.IconSize.size24,onPress:this.props.onBackPressed,color:y.Color.white,hoverColor:y.Color.whiteOverlay70,icon:this.props.closeInsteadOfBackButton?C.closeIcon():C.backIcon(),title:e,showShadow:!0})})),s=(0,i.jsx)(l.View,Object.assign({style:b.leftControls},{children:t}));let a;if(!this.props.backButtonOnly&&this.state.cameraPermissionStatus===r.PermissionStatus.Granted){const e=[],t=o.round(this.state.zoomRatio,1);this.state.showTelephotoButton&&e.push((0,i.jsx)(l.Animated.View,Object.assign({style:[this.props.enableCameraPortraitLock?this._rotationStyle:void 0,b.button]},{children:(0,i.jsx)(l.Button,Object.assign({style:b.button,onPress:this.props.onZoomPressed,title:m.getString("CapturePanel.ZoomInfoAccessibilityLabel",{zoomFactor:t})},{children:(0,i.jsx)(l.View,Object.assign({style:[b.button,b.zoomButtonCircle]},{children:(0,i.jsx)(l.Text,Object.assign({style:b.zoomRatio,numberOfLines:1},{children:m.getString("CapturePanel.ZoomInfo",{zoomFactor:t})}))}))}))}),"zoomInfoIconButton"));this.state.hasFlash&&this.state.currentCameraMode!==c.CameraMode.Front&&e.push((0,i.jsx)(l.Animated.View,Object.assign({style:[this.props.enableCameraPortraitLock?this._rotationStyle:void 0,b.button]},{children:(0,i.jsx)(u.default,{style:b.button,size:v.IconSize.size24,onPress:this._onToggleFlash,color:y.Color.white,hoverColor:y.Color.gray100,icon:this.state.currentFlashMode===c.FlashMode.Off?v.SkypeIcon.FlashOff:v.SkypeIcon.FlashOn,title:this.state.currentFlashMode===c.FlashMode.Off?m.getString("CapturePanel.ToggleFlashOnAccessibilityLabel"):m.getString("CapturePanel.ToggleFlashOffAccessibilityLabel"),showShadow:!0})}),"flashbutton")),a=(0,i.jsx)(l.View,Object.assign({style:this.props.deviceOrientation===n.DeviceOrientation.Landscape?b.rightBarButtonsLandscape:b.rightBarButtons},{children:e}),"rightbuttons")}const d=[b.rightControls],h=(0,i.jsx)(l.View,Object.assign({style:d},{children:a})),p=[b.header,this.props.deviceOrientation===n.DeviceOrientation.Landscape?b.headerLandscape:b.headerPortrait,this.props.style];return(0,i.jsxs)(l.Animated.View,Object.assign({style:p},{children:[s,h]}))}}t.CapturePanelHeader=T,t.default=T},469198:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(174958),n=s(496486),r=s(285788),a=s(47282),l=s(211020),d=s(583367),c=s(216934),h=s(516778),u=s(244770),p=s(397691),g=s(4736),m=s(889391),S=s(38566),f=s(996074),y=s(502278),v=s(827028),C=s(272675),_=s(770857),b=(s(292681),s(481547)),T=s(39225),M=s(883666),I=s(301065),w=s(686817),P=s(116093),k=s(610666),A=s(345887),x=s(951267),R=s(711930),O=s(898278),L=s(662602),F=s(952262),B=s(770891),D=s(321444),E=s(746096),V=s(139889),N=s(753559),U=s(828719),j=s(913944),H=s(436237),z=s(710400),W=s(915877),G=s(733754),K=s(318743),q=s(10909),Q=s(499201),X=s(89808),$=s(46929),J=s(18078),Y=s(445026),Z=s(104735),ee=s(699097),te=s(431234),se=s(29130),ie=s(340395),oe=s(914976),ne=s(451070),re=s(681115),ae=s(415963),le=s(886045),de=s(404057),ce=s(915415),he=s(581760),ue=s(311010),pe=s(711828),ge=s(734528),me=s(680837),Se=s(782176),fe=s(912770),ye=s(853374),ve=s(960634),Ce=s(53332),_e=s(803729);var be;!function(e){e[e.None=0]="None",e[e.Loading=1]="Loading",e[e.Indicator=2]="Indicator"}(be||(be={}));const Te=pe.IconSize.default,Me="swipeToast",Ie=(0,W.lazyProperties)({container:()=>h.Styles.createViewStyle({flex:1,justifyContent:"space-between",alignItems:"center",backgroundColor:he.Color.black,overflow:"visible"}),containerFill:()=>h.Styles.createViewStyle({flex:1,backgroundColor:he.Color.black}),markupView:()=>h.Styles.createImageStyle({position:"absolute",left:0,right:0,top:0,bottom:0,overflow:"visible"}),markupViewHidden:()=>h.Styles.createImageStyle({position:"absolute",left:0,right:0,top:0,bottom:0,overflow:"visible",opacity:0}),image:()=>h.Styles.createImageStyle({position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:he.Color.black}),videoContainer:()=>me.default.absoluteFill,bottomControls:()=>h.Styles.createViewStyle({position:"absolute",bottom:10,left:0,right:10,flexDirection:"row",alignSelf:"stretch",justifyContent:"space-between",alignItems:"flex-end",overflow:"visible"}),bottomControlsSingle:()=>h.Styles.createViewStyle({justifyContent:"flex-end"}),bottomControlsNoLabel:()=>h.Styles.createViewStyle({right:10}),bottomControlsCompactCenter:()=>h.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),topControls:()=>h.Styles.createViewStyle({paddingTop:4,paddingHorizontal:10,flexDirection:"row",alignSelf:"stretch",justifyContent:"space-between",overflow:"visible"}),topInnerControls:()=>h.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center"}),iconButton:()=>h.Styles.createButtonStyle({alignItems:"center",justifyContent:"center",height:Te,width:Te,borderRadius:Te/2,backgroundColor:he.Color.transparent}),iconButtonBackground:()=>h.Styles.createButtonStyle({backgroundColor:he.Color.blackOverlay50}),undoButtonContainer:()=>h.Styles.createViewStyle({position:"absolute",right:100,left:100,padding:20,alignItems:"center",justifyContent:"center"}),markupIconButton:()=>h.Styles.createButtonStyle({marginLeft:10}),spinner:()=>h.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,backgroundColor:he.Color.transparent,justifyContent:"center",alignItems:"center",alignSelf:"stretch"}),palette:()=>h.Styles.createViewStyle({position:"absolute",top:80,width:44,right:0,overflow:"visible"}),colorControls:()=>h.Styles.createViewStyle({position:"absolute",top:0,bottom:0,right:0,left:0,overflow:"visible"}),stickerMenu:()=>h.Styles.createViewStyle({position:"absolute",top:0,bottom:0,right:0,left:0,overflow:"hidden",paddingTop:60}),sendButtonWithLabelWrapper:()=>h.Styles.createViewStyle({width:pe.IconSize.default,alignItems:"center",backgroundColor:he.Color.transparent,overflow:"visible",marginRight:10}),sendButtonLabel:()=>h.Styles.createTextStyle({position:"absolute",top:-18,right:0,width:200,color:he.Color.white,fontSize:ue.default.controlFontSize.actionButtonLabel,textAlign:"right",backgroundColor:he.Color.transparent}),leftButtonContainer:()=>h.Styles.createViewStyle({flexDirection:"row"}),cancelButton:()=>h.Styles.createViewStyle({marginLeft:10}),backButton:()=>h.Styles.createButtonStyle({flexDirection:"row",alignSelf:"stretch",alignItems:"center",justifyContent:"center",height:Te,paddingHorizontal:8,backgroundColor:he.Color.transparent}),icon:()=>h.Styles.createTextStyle({fontSize:pe.IconSize.size24,height:pe.IconSize.size24,backgroundColor:he.Color.transparent}),iconDark:()=>h.Styles.createTextStyle({color:he.Color.gray400}),topControlsShimContainer:()=>h.Styles.createImageStyle({position:"absolute",top:0,right:0,left:0,height:64,backgroundColor:he.Color.transparent,opacity:.8}),bottomControlsShimContainer:()=>h.Styles.createViewStyle({position:"absolute",bottom:0,right:0,left:0,height:100,opacity:.8,backgroundColor:he.Color.transparent,transform:[{scaleY:-1}]}),controlsShimInnerView:()=>h.Styles.createImageStyle({opacity:.9}),shadow:()=>h.Styles.createViewStyle({shadowColor:he.Color.black,shadowOpacity:.5,shadowRadius:1,shadowOffset:{height:0,width:0},overflow:"visible"}),avatarOverlay:()=>me.default.absoluteFill,avatarOverlayRow:()=>h.Styles.createViewStyle({flex:1,backgroundColor:he.Color.blackOverlay50}),avatarOverlayMaskRow:()=>h.Styles.createViewStyle({flex:0,flexDirection:"row"}),avatarOverlayColumn:()=>h.Styles.createViewStyle({flex:1,backgroundColor:he.Color.blackOverlay50}),avatarOverlayMask:()=>h.Styles.createImageStyle({height:250,width:250}),avatarOverlayMaskLarge:()=>h.Styles.createImageStyle({height:500,width:500}),pageIndicator:()=>h.Styles.createViewStyle({position:"absolute",right:0,left:0,bottom:10,height:pe.IconSize.default,alignItems:"center",justifyContent:"center"}),buttonWrapperForAccessibility:()=>h.Styles.createViewStyle({height:80,justifyContent:"flex-end"}),textShadowStyle:()=>h.Styles.createViewStyle({shadowRadius:4,shadowOffset:{height:0,width:0},shadowOpacity:.5}),paletteOffset:()=>h.Styles.createViewStyle({top:80}),paletteOffsetLandscape:()=>h.Styles.createViewStyle({top:60})});function we(e){const t=(0,U.parseFileUri)(e.uri),s=t?N.default.extractFileNameWithExtension(t.path):"";return{file:{uri:e.uri,name:s,size:e.size,type:e.type},extension:N.default.extractFileExtension(s),dimensions:{width:e.width,height:e.height}}}class Pe extends f.default{constructor(){super(...arguments),this._mediaSaved=!1,this._audioManagerClient=new S.default(S.AudioManagerSource.CapturePreview),this._isNativeMobile=!1,this._controlsAnimatedOpacityValue=new h.Animated.Value(0),this._controlsAnimatedOpacityStyle=h.Styles.createAnimatedViewStyle({opacity:this._controlsAnimatedOpacityValue}),this._controlsAnimatedScaleValue=new h.Animated.Value(0),this._controlsAnimatedScaleStyle=h.Styles.createAnimatedViewStyle({transform:[{scale:this._controlsAnimatedScaleValue}]}),this._markupControlsAnimatedScaleValue=new h.Animated.Value(0),this._markupControlsAnimatedOpacityValue=new h.Animated.Value(0),this._markupControlsAnimatedStyle=h.Styles.createAnimatedViewStyle({opacity:this._markupControlsAnimatedOpacityValue,transform:[{scale:this._markupControlsAnimatedScaleValue}]}),this._colorPaletteAnimatedTransformValue=new h.Animated.Value(44),this._colorPaletteAnimatedTransformStyle=h.Styles.createAnimatedViewStyle({transform:[{translateX:this._colorPaletteAnimatedTransformValue}]}),this._undoAnimatedBottomValue=new h.Animated.Value(-100),this._undoAnimatedOpacityValue=new h.Animated.Value(0),this._undoAnimatedPositionStyle=h.Styles.createAnimatedViewStyle({bottom:this._undoAnimatedBottomValue}),this._undoAnimatedOpacityStyle=h.Styles.createAnimatedViewStyle({opacity:this._undoAnimatedOpacityValue}),this._addStickersClickCount=0,this._stickerNames=[],this._onImageLoaded=e=>{if(this.props.entryPoint!==E.PostSource.Capture)return;const t=x.default.maybeGetAndClearPerfScenario(ae.ScenarioName.PreviewSnappedPhoto);t&&(t.markStepCompleted("_onImageLoaded"),n.defer((()=>{t&&(t.markStepCompleted("backOnJSThread"),t.finish())})))},this._onMarkupColorSelected=(e,t=!1,s)=>{this._markupView&&(this._markupView.selectColor(e.value),s&&this._markupView.setStrokeWidth(s)),this.isComponentMounted()&&this.state.selectedColor!==e&&this.setState({selectedColor:e,isLightColor:t})},this._onMarkupUndo=()=>{this._markupView&&(this._undoLastSupported()?this._markupView.undoLast():this._markupView.undoDrawing())},this._onContainerLayout=e=>{if(this.isComponentMounted()){const t=ye.default.newCauseId(),s=this._getSnapshotRect(e);this.setState({viewRect:e,snapShotRect:s}),H.log(E.LogTraceArea.Capture,"CapturePreview _onContainerLayout "+s.width+" "+s.height+" causeId: "+t),L.default.measureLayoutRelativeToWindow((()=>this)).then((e=>{if(this.isComponentMounted()){const t={x:e.x,y:e.y};this.setState({gestureOffset:t})}}),(e=>{H.warn(E.LogTraceArea.Capture,"Capture preview component not measured: "+de.default.errorAsString(e))}))}},this._onCoachmarksDismiss=()=>{this._dismissCoachmarks()},this._coachmarksViewed=()=>{$.default.setMediaEditorFirstRunLevel(this.state.coachmarksLevel)},this._onAddTextPressed=()=>{this.state.markupMode!==M.CaptureMarkupMode.Text?this.setState({markupMode:M.CaptureMarkupMode.Text,showColorPalette:!0}):this.setState({markupMode:M.CaptureMarkupMode.None})},this._enableEffects=()=>{const e=ye.default.newCauseId(),t=this.state.markupMode!==M.CaptureMarkupMode.Filters;H.log(E.LogTraceArea.Capture,"CapturePreview _enableEffects "+t+" causeId: "+e),this.setState({markupMode:t?M.CaptureMarkupMode.Filters:this._getDefaultMarkupMode(this.state),hasRequestedEffects:!0,overlayMode:this.state.hasRequestedEffects?be.Indicator:be.Loading}),t&&fe.default.setTimeout((()=>{this.isComponentMounted()&&(H.log(E.LogTraceArea.Capture,"CapturePreview _enableEffects show causeId:"+e),this.setState({overlayMode:this.state.effectsFailed?be.None:be.Indicator}))}),5e3)},this._onAddStickerPressed=()=>{const e=this.state.markupMode!==M.CaptureMarkupMode.Stickers;H.log(E.LogTraceArea.Capture,"CapturePreview _onAddStickerPressed "+e),e?this._addStickersClickCount++:n.delay((()=>{this._stickerButton&&this._stickerButton.requestFocus()}),100),this.setState({markupMode:e?M.CaptureMarkupMode.Stickers:this._getDefaultMarkupMode(this.state)}),$.default.setCaptureMarkupTooltipDismissed(!0)},this._onDrawButtonPressed=()=>{const e=this.state.markupMode!==M.CaptureMarkupMode.Ink,t={markupMode:e?M.CaptureMarkupMode.Ink:this._getDefaultMarkupMode(this.state),showColorPalette:e||this.state.showColorPalette};this.setState(t)},this._onStickerSelected=(e,t)=>{this._markupView&&this._markupView.addSticker(e,!1,t)},this._onStickerMenuClose=()=>{H.log(E.LogTraceArea.Capture,"CapturePreview sticker menu closed"),this.setState({markupMode:this._getDefaultMarkupMode(this.state)})},this._onMarkupDrawing=e=>{this._showOrHideControls(!e,e?300:100)},this._onHasMarkup=e=>{this.setState({hasMarkup:e})},this._onCanUndo=e=>{this.setState({canUndo:e})},this._onHasText=e=>{this.setState({hasText:e})},this._onHasStickers=e=>{this.setState({hasStickers:e})},this._onStickerIds=e=>{this.setState({stickerIds:e})},this._onStickerNames=e=>{this._stickerNames=e},this._onOverlaySelected=e=>{const t=e&&e.overlayType!==v.OverlayType.None;let s="CameraEffects.OriginalFilterAccessibilityLabel";t&&this._captureSessionTelemetry&&this._captureSessionTelemetry.setOverlayType(e.overlayType);const i=e.overlayType===v.OverlayType.Filter;if(i){const t=this._captureSessionTelemetry;if(t){const i=e.parameters;t.setFilterName(i.filterName),t.recordOverlayViewed("Filter_"+i.filterName),s=i.accessibilityLabelTextPath}}const o={hasOverlay:t,hasFilter:i};this.setState(o),this.state.shouldReadOverlayEffectType&&le.default.maybeAnnounceForAccessibility(G.getString(s))},this._onOverlayProgress=e=>{this.state.shouldReadOverlayEffectType||this.setState({shouldReadOverlayEffectType:!0})},this._onTextFocusChanged=e=>{e&&this.state.markupMode!==M.CaptureMarkupMode.Text?this.setState({markupMode:M.CaptureMarkupMode.Text,showColorPalette:!0}):e||this.state.markupMode!==M.CaptureMarkupMode.Text||this.setState({markupMode:this._getDefaultMarkupMode(this.state)})},this._onTextInput=e=>{const t=this.state.deviceOrientation===d.DeviceOrientation.Landscape?12:6;e.length>t&&(this._showOrHideColorPalette(!1),this._debouncedShowColorPalette())},this._debouncedShowColorPalette=n.debounce((()=>{this.isComponentMounted()&&(this.setState({showColorPalette:!0}),this._showOrHideColorPalette(!0))}),2e3),this._onDragView=(e,t)=>{this.state.showDeleteButton!==e&&(this.setState({showDeleteButton:e}),this._showOrHideControls(!e));const s=Te+40,i=(this.state.viewRect.width-s)/2,o=this.state.viewRect.height+this.state.safeAreaInsets.top-s,n=s,r=s;return t.x>i&&t.x<i+r&&t.y>o&&t.y<o+n},this._onCaptureMarkupView=e=>{if(this._markupView=e,this._markupView&&this.props.isAvatarPreview){const e={height:this.props.mediaHeight,width:this.props.mediaWidth},t=this._getProjectedDimensions(e,this.state.snapShotRect,!0);this._markupView.addSticker({id:"avatarImage",fullUrl:this.props.localMediaObjectUri,height:t.height,width:t.width,isAvatar:!0,avatarSquareSize:this.state.snapShotRect.width},!0)}},this._onStickerButtonRef=e=>{this._stickerButton=e||void 0},this._onSnapshotRef=e=>{this._snapShotView=e},this._onVideoRef=e=>{if(this._video=e||void 0,!e&&this._videoHasUnmountedDeferred){const e=this._videoHasUnmountedDeferred;this._videoHasUnmountedDeferred=void 0,e.resolve(void 0)}},this._onCoachmarksRef=e=>{this._coachmarks=e||void 0},this._onCaptureOverlayPageIndicatorRef=e=>{this._captureOverlayPageIndicator=e},this._onSendButtonRef=e=>{this._sendButton=e,n.delay((()=>{this._sendButton&&this.setState({shouldAnnouncePhotoVideoCaptured:!1})}),500)},this._onCaptureOverlayPageUpdated=(e,t)=>{this.setState({totalOverlayPages:t}),this.setState({overlayMode:be.Indicator}),this._captureOverlayPageIndicator&&this._captureOverlayPageIndicator.update(e,t)},this._onGetAnchorRect=e=>{let t;switch(e){case A.CapturePreviewButtonId.Send:case A.CapturePreviewButtonId.HubSend:t=this._sendButton}return t?L.default.measureLayoutRelativeToWindow((()=>t)):p.Rejected("CapturePreview: View not found "+e)},this._onVideoCanPlay=()=>{this.isComponentMounted()&&this.setState({mediaReady:!0})},this._onAudioManagerError=e=>{const t=ye.default.newCauseId();H.log(E.LogTraceArea.Capture,"CapturePreview had and AudioManager error causeId: "+t),this._audioManagerClient.release(t),H.error(E.LogTraceArea.Capture,de.default.errorAsString(e))},this._onAccept=e=>{const t=ye.default.newCauseId();H.log(E.LogTraceArea.Capture,"CapturePreview _onAccept sendEnabled:"+this.state.sendEnabled+" causeId:"+t),this.state.sendEnabled&&(this._video?(this._videoHasUnmountedDeferred=p.Defer(),this.setState({noRenderVideo:!0}),this._videoHasUnmountedDeferred.promise().then((()=>{this._onAcceptInner(t)}))):this._onAcceptInner(t))},this._onCancelPressed=e=>{if(!0===this._mediaSaved&&this._completeCaptureSession(),this.state.markupMode!==this._getDefaultMarkupMode(this.state))this.setState({markupMode:this._getDefaultMarkupMode(this.state)});else{if(this._captureSessionTelemetry&&(this._captureSessionTelemetry.setIsCanceled(!0),H.track(this._captureSessionTelemetry),delete this._captureSessionTelemetry),!this.props.inlinePreview){const e=ye.default.newCauseId();H.log(E.LogTraceArea.Navigation,"CapturePreview._onCancelPressed, causeId: "+e),Z.default.goBack(e,this._getContext())}this.props.onReject&&this.props.onReject(this.props.entryPoint)}return!0},this._onCaptureFlowComplete=()=>{this.props.onCaptureFlowComplete&&this.props.onCaptureFlowComplete()},this._onLensSnapshotError=()=>{this._imageWithLensPromise&&this._imageWithLensPromise.reject()},this._onLensSnapshotLoaded=()=>{fe.default.setTimeout((()=>{this._imageWithLensPromise&&this._imageWithLensPromise.resolve(void 0)}),200)},this._onSavePressed=()=>{const e=ye.default.newCauseId();H.log(E.LogTraceArea.Capture,"CapturePreview._onSavePressed causeId:"+e),this._mediaSaved=!0;(this.props.localMediaIsVideo?this._saveVideoToCameraRoll(e):this._savePhotoToCameraRoll(e)).then((()=>{H.log(E.LogTraceArea.Capture,"CapturePreview._onSavePressed success causeId:"+e)}),(t=>{H.log(E.LogTraceArea.Capture,"CapturePreview._onSavePressed error: "+de.default.errorAsString(t)+" causeId:"+e)}))},this._renderSendButton=()=>{let e=this.props.isAvatarPreview?G.getString("MyProfilePanel.UploadPhoto"):G.getString("CapturePreview.SendTitle");if(this.state.sendButtonLabel&&(e=G.getString("CapturePreview.SendToAccessibilityLabel",{displayName:this.state.sendButtonLabel})),this.state.shouldAnnouncePhotoVideoCaptured&&void 0===this.props.mediaSelection){const t=this.props.localMediaIsVideo?"CapturePreview.VideoCaptured":"CapturePreview.PhotoCaptured",s=G.getString(t);e=R.default.combinedAccessibilityLabel(s,e,". ")}this.props.showSendButtonOnTop&&(e=G.getString("Global.DoneButtonTitle"));const t=this.props.performMarkupOnly?pe.SkypeIcon.Ok:pe.SkypeIcon.Send;return(0,i.jsx)(g.default,{ref:this._onSendButtonRef,title:G.getString("CapturePreview.SendTitle"),accessibilityLabel:e,onPress:this._onAccept,icon:t,importantForAccessibility:h.Types.ImportantForAccessibility.Yes,flipIcon:this._getContext().isRTL&&t!==pe.SkypeIcon.Ok,size:g.ActionButtonSize.Small,backgroundColor:this.props.showSendButtonOnTop?he.Color.blue:he.Color.whiteOverlay20,autoFocus:!0},"send")}}_buildState(e,t){t&&(this._mediaId=ye.default.newGuid(),this._captureSessionTelemetry=e.captureSessionTelemetry);let s=I.MediaEditorFirstRunLevel.None,i=I.MediaEditorFirstRunLevel.None;e.performMarkupOnly||e.useCompactControls||e.disableCoachmarks||(s=e.conversationId?I.MediaEditorFirstRunLevel.Conversation:I.MediaEditorFirstRunLevel.Hub,i=$.default.getMediaEditorFirstRunLevel()||I.MediaEditorFirstRunLevel.None);const o=m.default.getS4LCMCFeatures(),n=this._getRootViewId(),r=ne.default.keepStatusBarVisible()?ne.default.statusBarPadding():0,a=e.ignoreBottomSafeArea?0:ne.default.bottomSafeAreaInset(O.BottomInsetDefault),l=ne.default.horizontalInsets(O.HorizontalInsetDefault),d={keyboardUpdateInfo:z.default.getUpdateInfo(),keyboardResizeMode:z.default.getResizeMode(),showCoachmarks:e.showCoachmarksIfNeeded&&s>i&&D.default.isEngagementContentEnabled(),coachmarksLevel:s,sendButtonLabel:e.sendButtonLabel||(!e.callId&&e.conversationId?F.default.getDisplayName(e.conversationId):void 0),deviceOrientation:se.default.getDeviceOrientation(n),gradientColors:X.default.getGradientColors(),primaryColorStyle:X.default.getPrimaryBackgroundColorStyle(),effectsEnabled:!(e.isAvatarPreview||this.state&&this.state.effectsFailed||e.localMediaIsVideo||e.callId||this._isMediaSelectionGif()),safeAreaInsets:Object.assign(Object.assign({},l),{top:r,bottom:a}),mySkypeId:J.default.getSkypeId(),showOverlayEffectsCoachmark:k.default.hasOverlays(e.localMediaIsVideo)&&D.default.isEngagementContentEnabled(),alwaysEnableVideoMarkup:!1,sendOverlayAsMetadata:!1,enableCameraPortraitLock:o.enableCameraPortraitLock};return t&&(d.noRenderVideo=!1,d.mediaReady=!e.localMediaIsVideo,d.isMuted=!1,d.lensSnapshot=void 0,d.markupMode=M.CaptureMarkupMode.None,d.hasRequestedEffects=!1,d.markupEnabled=!1,d.overlayMode=be.None,d.viewRect={x:0,y:0,height:0,width:0},d.snapShotRect={x:0,y:0,height:0,width:0},d.hasMarkup=!1,d.canUndo=!1,d.hasText=!1,d.hasStickers=!1,d.hasOverlay=!1,d.stickerIds=[],d.selectedColor={id:"White",value:he.Color.white,stringKey:"Color.White"},d.isLightColor=!0,d.showColorPalette=!1,d.showDeleteButton=!1,d.hasFilter=!1,d.sendEnabled=!0,d.videoMarkupFXEnabled=!1,d.readyForTooltips=!1,d.videoProcessingInProgress=!1,d.gestureOffset={x:0,y:0},d.showOverlayEffectsCoachmark=!1,d.shouldReadOverlayEffectType=!1,d.shouldAnnouncePhotoVideoCaptured=!0),d}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount();const e=ye.default.newCauseId();H.log(E.LogTraceArea.Capture,"CapturePreview.UNSAFE_componentWillMount causeId: "+e),Y.default.markAnimatedValue(this._controlsAnimatedScaleValue,0)}componentWillUnmount(){super.componentWillUnmount();const e=ye.default.newCauseId();H.log(E.LogTraceArea.Capture,"CapturePreview.componentWillUnmount causeId: "+e),q.default.removeBottomMargin("CapturePreview"),q.default.removeToastMessage(Me),this.state.enableCameraPortraitLock||void 0===this._previousOrientation||(H.log(E.LogTraceArea.Capture,"CapturePreview unlockOrientation causeId:"+e),d.default.unlockOrientation().then(n.noop,(t=>{H.warn(E.LogTraceArea.Capture,"CapturePreview unlockOrientation failed: "+de.default.errorAsString(t)+" causeId:"+e)}))),this.state.enableCameraPortraitLock&&this.props.orientationLockKey&&(H.log(E.LogTraceArea.Capture,"CapturePreview remove orientation lock"),Q.default.removeOrientationLock(this.props.orientationLockKey)),this._audioManagerClient.release(e)}componentDidMount(){super.componentDidMount();const e=ye.default.newCauseId();H.log(E.LogTraceArea.Capture,"CapturePreview this.props.localMediaObjectUri "+o.pii.Omit(this.props.localMediaObjectUri)+" ("+this.props.mediaWidth+"x"+this.props.mediaHeight+") causeId:"+e),H.log(E.LogTraceArea.Capture,"CapturePreview this.props.localMediaThumbnailUri "+(this.props.localMediaThumbnailUri?o.pii.Omit(this.props.localMediaThumbnailUri):"undefined")+" causeId:"+e);const t=this._desiredOrientation();if(this.props.unlockOrientation||H.warn(E.LogTraceArea.Capture,"CapturePreview.componentWillMount ignoring props.unlockOrientation causeId:"+e),this._lockOrientation(t,!0,e),this.props.entryPoint===E.PostSource.Capture){const e=x.default.getPerfScenario(ae.ScenarioName.PreviewSnappedPhoto);e&&e.markStepCompleted("componentDidMount")}q.default.addOrUpdateBottomMargin("CapturePreview",90),n.delay((()=>{this.isComponentMounted()&&(H.log(E.LogTraceArea.Capture,"CapturePreview show controls causeId:"+e),h.Animated.parallel([Y.default.timing(this._controlsAnimatedScaleValue,{toValue:1,duration:400,easing:h.Animated.Easing.OutBack(),useNativeDriver:!0}),h.Animated.timing(this._controlsAnimatedOpacityValue,{toValue:1,duration:100,easing:h.Animated.Easing.In()})]).start((e=>{fe.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({readyForTooltips:!0})}),100)})),this.state.effectsEnabled&&(H.log(E.LogTraceArea.Capture,"CapturePreview.componentDidMount forceEffects causeId: "+e),this._enableEffects()))}),200),this.props.markupEnabled&&!this._isMediaSelectionGif()&&this._enableMarkupDeferred(e)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),!t.markupEnabled&&this.state.markupEnabled&&H.warn(E.LogTraceArea.Capture,"CapturePreview UNSAFE_componentWillUpdate: setting markupEnabled true -> false may cause unexpected behavior")}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=ye.default.newCauseId();H.log(E.LogTraceArea.Capture,"CapturePreview componentDidUpdate causeId:"+i),t.isMuted!==this.state.isMuted&&this._video&&this._video.mute(this.state.isMuted),this.state.mediaReady&&!t.mediaReady&&n.delay((()=>{this._requestPlayback().then((()=>{this.isComponentMounted()&&this._video&&this._video.play()})).fail(this._onAudioManagerError)}),200),!e.markupEnabled&&this.props.markupEnabled&&this._enableMarkupDeferred(i),!t.markupEnabled&&this.state.markupEnabled&&h.Animated.parallel([Y.default.timing(this._markupControlsAnimatedScaleValue,{toValue:1,duration:400,easing:h.Animated.Easing.OutBack(),useNativeDriver:!0}),Y.default.timing(this._markupControlsAnimatedOpacityValue,{toValue:1,duration:100,easing:h.Animated.Easing.Linear(),useNativeDriver:!0})]).start(),t.markupMode!==this.state.markupMode&&(this._shouldShowColorPalette(this.state)?this._showOrHideColorPalette(!0):this._showOrHideColorPalette(!1,0,!0));const o=this._showUndoButton(this.state);if(this._showUndoButton(t)!==o){const e=o?200:0,t=o?this.state.safeAreaInsets.bottom-10:-100,s=[h.Animated.timing(this._undoAnimatedBottomValue,{toValue:t,duration:200,delay:e,easing:o?h.Animated.Easing.OutBack():h.Animated.Easing.In()}),h.Animated.timing(this._undoAnimatedOpacityValue,{toValue:o?1:0,duration:200,delay:e,easing:h.Animated.Easing.Out()})];h.Animated.parallel(s).start()}t.sendEnabled!==this.state.sendEnabled&&(H.log(E.LogTraceArea.Capture,"CapturePreview sendEnabled "+t.sendEnabled+" -> "+this.state.sendEnabled),this.state.sendEnabled||fe.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({sendEnabled:!0})}),2e3)),void 0===this._previousOrientation&&this._hasMarkup(this.state)&&!this._hasMarkup(t)&&this._lockOrientation(void 0,!1,i),this.state.effectsEnabled&&this.state.showOverlayEffectsCoachmark&&!t.showOverlayEffectsCoachmark&&!le.default.shouldAnnounceForAccessibility()&&q.default.scheduleTextMessage(G.getString("CapturePreview.SwipeToSeeEffects"),Me,this._getRootViewId())}_lockOrientation(e,t,s){H.log(E.LogTraceArea.Capture,"CapturePreview _lockOrientation desiredOrientation:"+e+" requiresMatch:"+t+" causeId:"+s),this.state.enableCameraPortraitLock||d.default.currentOrientation().then((i=>{const o=void 0!==e?e:i;t&&i!==o?H.log(E.LogTraceArea.Capture,"CapturePreview _lockOrientation noop causeId:"+s):(H.log(E.LogTraceArea.Capture,"CapturePreview _lockOrientation orientation:"+o+" causeId:"+s),this._previousOrientation=i,d.default.lockOrientation(o).then(n.noop,(e=>{H.warn(E.LogTraceArea.Capture,"CapturePreview lockOrientation failed: "+de.default.errorAsString(e)+" causeId:"+s)})))})).catch((e=>{H.warn(E.LogTraceArea.Capture,"CapturePreview currentOrientation failed: "+de.default.errorAsString(e)+" causeId:"+s)}))}_desiredOrientation(){return this.props.mediaWidth>this.props.mediaHeight?d.DeviceOrientation.Landscape:d.DeviceOrientation.Portrait}_requestPlayback(){const e=ye.default.newCauseId();return H.log(E.LogTraceArea.Capture,"CapturePreview._requestPlayback causeId: "+e),this._audioManagerClient.hasToken()?p.Resolved(void 0):this._audioManagerClient.requestMode(r.AudioModes.VideoPlayback,e).then((e=>p.Resolved()))}_enableMarkupDeferred(e){fe.default.setTimeout((()=>{this.isComponentMounted()&&(H.log(E.LogTraceArea.Capture,"CapturePreview _enableMarkupDeferred causeId:"+e),this.setState({markupEnabled:!0}))}),500)}_showUndoButton(e){return e.showDeleteButton||e.canUndo&&e.markupMode===M.CaptureMarkupMode.Ink}render(){const e=[Ie.containerFill,me.default.absoluteFill];this.state.safeAreaInsets.top&&e.push(re.default.marginTopStyle(this.state.safeAreaInsets.top));const t=this.state.noRenderVideo,s=this.state.markupMode===M.CaptureMarkupMode.Ink,o=this.state.markupMode===M.CaptureMarkupMode.Stickers,n=this.state.markupMode===M.CaptureMarkupMode.Text,r=this._getSnapshotContainerStyle();let a,c;if(!t&&this.props.localMediaIsVideo&&this.props.localMediaObjectUri){const e=!1;a=(0,i.jsx)(_e.default,{origin:"CaptureVideoPreview",ref:this._onVideoRef,style:e?Ie.videoContainer:r,loop:!0,source:this.props.localMediaObjectUri,resizeMode:e?"stretch":void 0,onCanPlay:this._onVideoCanPlay,accessibilityLabel:G.getString("CapturePreview.VideoTitle"),mediaProvider:B.MediaProvider.Preview}),e&&(a=(0,i.jsx)(h.View,Object.assign({style:r},{children:a})))}this._mediaDimensions={width:this.props.mediaWidth,height:this.props.mediaHeight},this.props.localMediaIsVideo||this.props.isAvatarPreview||!this.props.localMediaObjectUri||(c=(0,i.jsx)(h.Image,{style:Ie.image,source:this.props.localMediaObjectUri,onLoad:this._onImageLoaded,resizeMode:"stretch",accessibilityLabel:G.getString("CapturePreview.ImageTitle")}));const p=this.state.lensSnapshot&&!this.props.isAvatarPreview?(0,i.jsx)(V.default,{origin:"CapturePreview",style:Ie.image,containerStyle:Ie.image,source:this.state.lensSnapshot,resizeMode:"stretch",onError:this._onLensSnapshotError,onLoad:this._onLensSnapshotLoaded},"imageWithLensSnapshot"):void 0,g=this.state.showDeleteButton||this.state.markupMode===M.CaptureMarkupMode.Ink||this.state.markupMode===M.CaptureMarkupMode.Stickers,m=this.props.isAvatarPreview?{height:this._avatarOverlayHeight(this.state.viewRect),width:this._avatarOverlayWidth(this.state.viewRect)}:this._mediaDimensions,S=this.state.overlayMode===be.Loading&&0===this.state.totalOverlayPages,f=this.state.markupEnabled&&this.props.localMediaObjectUri&&(!this.props.localMediaIsVideo||this._videoMarkupSupported())?(0,i.jsx)(M.CaptureMarkupView,{markupMode:this.state.markupMode,ref:this._onCaptureMarkupView,style:S?Ie.markupViewHidden:Ie.markupView,mediaId:this._mediaId,localMediaObjectUri:this.props.localMediaObjectUri,localMediaIsVideo:!!this.props.localMediaIsVideo,fileSize:this.props.fileSize,enableOverlays:!this.props.isAvatarPreview&&!this.state.effectsFailed&&!this.props.localMediaIsVideo,mediaDimensions:m,levelsOfUndo:this._levelsOfUndo(),hidePageControl:g,offset:this.state.snapShotRect,isAvatarPreview:this.props.isAvatarPreview,advanceToFirstOverlay:!this.state.effectsEnabled,effectsEnabled:this.state.effectsEnabled,onDrawing:this._onMarkupDrawing,onHasMarkup:this._onHasMarkup,onCanUndo:this._onCanUndo,onHasText:this._onHasText,onHasStickers:this._onHasStickers,stickerIds:this._onStickerIds,stickerNames:this._onStickerNames,onOverlaySelected:this._onOverlaySelected,onOverlayProgress:this._onOverlayProgress,onTextFocusChanged:this._onTextFocusChanged,onDragView:this._onDragView,onPagerUpdated:this._onCaptureOverlayPageUpdated,onTextInput:this._onTextInput},"markupView"):void 0,y=this.state.deviceOrientation===d.DeviceOrientation.Landscape,v=this._getKeyboardInset()>0?this._getKeyboardInset()+20:y?90:120,C={x:this.state.gestureOffset.x,y:this.state.gestureOffset.y+(y?60:80),height:this.state.viewRect.height-v,width:this.state.viewRect.width},I=G.getString("CapturePreview.PenColorPickerWithColorAccessibilityLabel",{color:G.getString(this.state.selectedColor.stringKey)}),k=(0,i.jsx)(b.CaptureMarkupColorControl,{style:Ie.colorControls,onColorSelected:this._onMarkupColorSelected,gestureRect:C,colorOnly:!0}),x=this.state.markupEnabled&&this.state.showColorPalette?(0,i.jsx)(h.Animated.View,Object.assign({style:this._getColorPaletteStyle(v),importantForAccessibility:h.Types.ImportantForAccessibility.Yes,accessibilityLabel:I},{children:k}),"colorControl"):void 0,R=[Ie.iconButton,Ie.markupIconButton],L=Ie.textShadowStyle,F=this.props.useCompactControls||this.props.performMarkupOnly&&!this.props.alwaysShowSaveButton||this.state.markupMode===M.CaptureMarkupMode.Text||this._shouldSendOriginalMedia()&&this.props.mediaSelection?void 0:(0,i.jsx)(h.Animated.View,Object.assign({style:[this._controlsAnimatedScaleStyle,Ie.buttonWrapperForAccessibility],ignorePointerEvents:!0,importantForAccessibility:h.Types.ImportantForAccessibility.Yes,accessibilityTraits:h.Types.AccessibilityTrait.Button},{children:(0,i.jsx)(j.default,{style:R,size:pe.IconSize.size24,onPress:this._onSavePressed,color:he.Color.white,hoverColor:he.Color.gray300,icon:pe.SkypeIcon.Download,title:G.getString("CapturePreview.SaveTitle"),iconTextStyle:L,showShadow:!0,accessibilityLabel:G.getString("CapturePreview.SaveAccessibilityLabel")})}),"save");let D;if(this.state.markupEnabled&&(!this.props.localMediaIsVideo||this._videoMarkupSupported())){const e=[Ie.iconButton,Ie.markupIconButton],t=[Ie.icon,Ie.textShadowStyle];s&&(e.push(this._getColorStyle(this.state.selectedColor.value)),this.state.isLightColor&&t.push(Ie.iconDark));const r=[Ie.iconButton,Ie.markupIconButton],a=L;o&&r.push(this.state.primaryColorStyle);const l=[Ie.iconButton,Ie.markupIconButton],d=L;n&&l.push(this.state.primaryColorStyle);let c=s?G.getString("CapturePreview.CloseDrawAccessibilityLabel"):G.getString("CapturePreview.DrawAccessibilityLabel");c+=", "+G.getString(this.state.selectedColor.stringKey);const u=this.props.showSendButtonOnTop&&(0,i.jsx)(h.Animated.View,Object.assign({style:[this._markupControlsAnimatedStyle,Ie.markupIconButton]},{children:this._renderSendButton()}),"send");D=(0,i.jsxs)(h.View,Object.assign({style:Ie.topInnerControls},{children:[(0,i.jsx)(h.Animated.View,Object.assign({style:this._markupControlsAnimatedStyle},{children:(0,i.jsx)(j.default,{style:l,size:Te,onPress:this._onAddTextPressed,color:he.Color.white,hoverColor:he.Color.gray300,icon:pe.SkypeIcon.AddText,title:G.getString("CapturePreview.TextTitle"),iconTextStyle:d,showShadow:!n,accessibilityLabel:n?G.getString("CapturePreview.DoneAddingTextAccessibilityLabel"):G.getString("CapturePreview.AddTextAccessibilityLabel")})}),"text"),(0,i.jsx)(h.Animated.View,Object.assign({style:this._markupControlsAnimatedStyle},{children:(0,i.jsx)(j.default,{ref:this._onStickerButtonRef,style:r,size:Te,onPress:this._onAddStickerPressed,color:he.Color.white,hoverColor:he.Color.gray300,icon:pe.SkypeIcon.StickersCamera,title:G.getString("CapturePreview.AddStickersTitle"),iconTextStyle:a,showShadow:!o,accessibilityLabel:o?G.getString("CapturePreview.CloseAddStickersAccessibilityLabel"):G.getString("CapturePreview.AddStickersAccessibilityLabel")})}),"stickers"),(0,i.jsx)(h.Animated.View,Object.assign({style:this._markupControlsAnimatedStyle},{children:(0,i.jsx)(j.default,{style:e,size:Te,onPress:this._onDrawButtonPressed,color:he.Color.white,hoverColor:he.Color.gray300,icon:pe.SkypeIcon.InfoStroke,title:G.getString("CapturePreview.DrawTitle"),iconTextStyle:t,showShadow:!s,accessibilityLabel:c})}),"draw"),u]}))}const E=[Ie.undoButtonContainer,this._undoAnimatedPositionStyle];this.state.markupMode===M.CaptureMarkupMode.Ink&&E.push(this._controlsAnimatedOpacityStyle);const N=(0,i.jsx)(h.Animated.View,Object.assign({style:E,ignorePointerEvents:!0},{children:(0,i.jsx)(h.Animated.View,Object.assign({style:this._undoAnimatedOpacityStyle,ignorePointerEvents:!0},{children:(0,i.jsx)(j.default,{style:[Ie.iconButton,Ie.iconButtonBackground],size:Te,onPress:this.state.hasMarkup?this._onMarkupUndo:void 0,color:he.Color.white,hoverColor:he.Color.gray300,icon:this.state.markupMode===M.CaptureMarkupMode.Ink?pe.SkypeIcon.Undo:pe.SkypeIcon.Delete,title:G.getString("CapturePreview.UndoTitle"),iconTextStyle:L,showShadow:!0,flipIcon:this.state.markupMode===M.CaptureMarkupMode.Ink&&this._getContext().isRTL},"undo")}))}),"undoContainer");let U;if(this.props.useCompactControls&&this.state.markupMode===M.CaptureMarkupMode.None)this.props.markupEnabled&&(U=(0,i.jsx)(h.View,{style:Ie.backButton}));else{const e=y?pe.IconSize.size20:pe.IconSize.size24;U=(0,i.jsx)(h.Animated.View,Object.assign({style:this._controlsAnimatedScaleStyle},{children:(0,i.jsx)(j.default,{title:G.getString("Global.CancelLabel"),style:Ie.backButton,size:e,color:he.Color.white,hoverColor:he.Color.gray300,icon:this.props.iconForClose||ge.backIcon(),showShadow:!0,onPress:this._onCancelPressed,accessibilityLabel:G.getString("CapturePreview.BackAccessibilityLabel")})}),"cancel")}let H=this.props.useCompactControls?(0,i.jsx)(w.default,{style:Ie.cancelButton,title:G.getString("Global.CancelLabel"),size:60,onPress:this._onCancelPressed,icon:pe.SkypeIcon.Undo,orientationIsLandscape:this.state.deviceOrientation===d.DeviceOrientation.Landscape},"cancel"):void 0;const z=!F&&!H,W=[Ie.bottomControls];let K;if(this.state.sendButtonLabel||W.push(Ie.bottomControlsNoLabel),z&&W.push(Ie.bottomControlsSingle),this.props.useCompactControls&&this.props.centerCompactControls&&W.push(Ie.bottomControlsCompactCenter),this.state.safeAreaInsets.bottom&&W.push(re.default.paddingBottomStyle(this.state.safeAreaInsets.bottom-10)),(this.state.safeAreaInsets.left||this.state.safeAreaInsets.right)&&W.push(re.default.horizontalPaddingStyle(this.state.safeAreaInsets)),W.push(this._controlsAnimatedOpacityStyle),this.state.videoProcessingInProgress||this.state.overlayMode===be.Loading&&0===this.state.totalOverlayPages){let e;K=(0,i.jsx)(ce.default,{size:O.SXActivityIndicatorSize.Medium,tintColor:he.Color.white}),K=this.state.videoProcessingInProgress?(0,i.jsxs)(h.Button,Object.assign({style:Ie.spinner},{children:[K,e]})):(0,i.jsxs)(h.View,Object.assign({style:Ie.spinner},{children:[K,e]}))}let q,Q=!this.props.showSendButtonOnTop&&this._renderSendButton();if(this.state.sendButtonLabel&&(Q=(0,i.jsxs)(h.View,Object.assign({style:Ie.sendButtonWithLabelWrapper,ignorePointerEvents:!0,importantForAccessibility:h.Types.ImportantForAccessibility.No},{children:[(0,i.jsx)(h.Text,Object.assign({style:[Ie.sendButtonLabel,Ie.shadow],numberOfLines:1,importantForAccessibility:h.Types.ImportantForAccessibility.No},{children:this.state.sendButtonLabel})),Q]}))),this.props.opacityStyle&&(Q=(0,i.jsx)(h.Animated.View,Object.assign({style:[me.default.overflowVisible,this.props.opacityStyle]},{children:Q})),H&&(H=(0,i.jsx)(h.Animated.View,Object.assign({style:[this.props.opacityStyle,Ie.buttonWrapperForAccessibility],ignorePointerEvents:!0,importantForAccessibility:h.Types.ImportantForAccessibility.Yes},{children:H})))),F||H){const e=[Ie.leftButtonContainer];q=(0,i.jsxs)(h.View,Object.assign({style:e,ignorePointerEvents:!0},{children:[F,H]}))}const X=[Ie.topControls,this._controlsAnimatedOpacityStyle];(this.state.safeAreaInsets.left||this.state.safeAreaInsets.right)&&X.push(re.default.horizontalPaddingStyle(this.state.safeAreaInsets));const $=U||D?(0,i.jsxs)(h.Animated.View,Object.assign({style:X,ignorePointerEvents:!0},{children:[undefined,U,D,undefined]}),"topControls"):void 0,J=[Ie.controlsShimInnerView,me.default.absoluteFill],Y=[Ie.bottomControlsShimContainer,this._controlsAnimatedOpacityStyle];this.state.safeAreaInsets.bottom&&Y.push(h.Styles.createViewStyle({height:100+this.state.safeAreaInsets.bottom},!1));const Z=(0,i.jsx)(h.Animated.View,Object.assign({style:Y,blockPointerEvents:!0},{children:(0,i.jsx)(h.Image,{style:J,resizeMode:"stretch",source:u.Collection.PHOTO_SHIM})})),ee=this.state.markupMode!==M.CaptureMarkupMode.Stickers?(0,i.jsxs)(h.Animated.View,Object.assign({style:W,ignorePointerEvents:!0},{children:[q,Q]}),"buttonsContainer"):void 0;let te;if(this.state.markupMode===M.CaptureMarkupMode.Stickers){const e=[Ie.stickerMenu];this.state.safeAreaInsets.top&&e.push(h.Styles.createViewStyle({top:-1*this.state.safeAreaInsets.top,paddingTop:this.state.safeAreaInsets.top+60},!1)),te=(0,i.jsx)(T.default,{style:e,onStickerSelected:this._onStickerSelected,onClose:this._onStickerMenuClose})}const se=this.state.showCoachmarks?(0,i.jsx)(A.CapturePreviewCoachmarks,{ref:this._onCoachmarksRef,getAnchorRect:this._onGetAnchorRect,supportedButtons:this._coachmarksButtonIds(),onDismiss:this._coachmarksViewed}):void 0,oe=this.state.showCoachmarks?(0,i.jsx)(_.CaptureCoachmarksGestureView,{onDismiss:this._onCoachmarksDismiss}):void 0,ne=this.props.isAvatarPreview?(0,i.jsxs)(h.View,Object.assign({style:Ie.avatarOverlay,blockPointerEvents:!0},{children:[(0,i.jsx)(h.View,{style:Ie.avatarOverlayRow}),(0,i.jsxs)(h.View,Object.assign({style:Ie.avatarOverlayMaskRow},{children:[(0,i.jsx)(h.View,{style:Ie.avatarOverlayColumn}),(0,i.jsx)(h.Image,{style:this._useLargeAvatarOverlay(this.state.viewRect)?Ie.avatarOverlayMaskLarge:Ie.avatarOverlayMask,source:u.Collection.AVATAR_ROUND_MASK}),(0,i.jsx)(h.View,{style:Ie.avatarOverlayColumn})]})),(0,i.jsx)(h.View,{style:Ie.avatarOverlayRow})]})):void 0;let ae;if(!this.state.effectsFailed){const e=[Ie.pageIndicator];this.state.safeAreaInsets.bottom&&e.push(h.Styles.createViewStyle({bottom:this.state.safeAreaInsets.bottom},!1));const t=this.state.markupMode!==M.CaptureMarkupMode.Filters||this.state.overlayMode!==be.Indicator&&0===this.state.totalOverlayPages;ae=(0,i.jsx)(P.default,{ref:this._onCaptureOverlayPageIndicatorRef,style:e,hidden:t})}return(0,i.jsxs)(h.View,Object.assign({style:e},{children:[(0,i.jsx)(ie.default,{statusBarKey:"CapturePreview",barStyle:ie.BarStyle.LIGHT_CONTENT,animated:!0}),(0,i.jsxs)(h.View,Object.assign({style:Ie.container,onLayout:this._onContainerLayout},{children:[a,(0,i.jsxs)(l.CaptureSnapshotView,Object.assign({ref:this._onSnapshotRef,style:r,importantForAccessibility:this.state.markupMode===M.CaptureMarkupMode.Stickers?h.Types.ImportantForAccessibility.NoHideDescendants:void 0},{children:[c,p,f]}),"snapshot"),ne,se,Z,ae,ee,N,te,$,x,undefined,oe,K]}))]}))}_levelsOfUndo(){return this._undoLastSupported()?10:1}_getKeyboardInset(){return this.state.keyboardResizeMode===c.KeyboardAwareResizeMode.None?this.state.keyboardUpdateInfo.height:0}_getColorPaletteStyle(e){const t=[Ie.palette,this._colorPaletteAnimatedTransformStyle];return t.push(h.Styles.createViewStyle({bottom:e},!1)),t.push(this.state.deviceOrientation===d.DeviceOrientation.Landscape?Ie.paletteOffsetLandscape:Ie.paletteOffset),t}_getColorStyle(e){return h.Styles.createViewStyle({backgroundColor:e},!1)}_shouldShowColorPalette(e){return e.markupMode===M.CaptureMarkupMode.Ink||e.markupMode===M.CaptureMarkupMode.Text}_showOrHideControls(e,t=0){h.Animated.timing(this._controlsAnimatedOpacityValue,{toValue:e?1:0,duration:300,delay:t,easing:h.Animated.Easing.Linear()}).start(),this._showOrHideColorPalette(e,t)}_showOrHideColorPalette(e,t,s){e?h.Animated.timing(this._colorPaletteAnimatedTransformValue,{toValue:0+(this.state.safeAreaInsets.right>10?10-this.state.safeAreaInsets.right:0),duration:300,delay:t||0,easing:h.Animated.Easing.InOutBack(),useNativeDriver:!0}).start():h.Animated.timing(this._colorPaletteAnimatedTransformValue,{toValue:44,duration:200,delay:t||0,easing:h.Animated.Easing.Out(),useNativeDriver:!0}).start((e=>{this.isComponentMounted()&&s&&this.setState({showColorPalette:!1})}))}_dismissCoachmarks(){this._coachmarks&&this._coachmarks.dismiss()}_onAcceptInner(e){H.log(E.LogTraceArea.Capture,"CapturePreview _onAcceptInner causeId:"+e),q.default.removeToastMessage(Me),this.props.performMarkupOnly?this.props.localMediaIsVideo?this._saveVideo(!1,e).then((e=>{if(e.uri){const t=we({uri:e.uri,size:e.fileSize||this._nonNullFileSize(),type:"video",width:this.props.mediaWidth,height:this.props.mediaHeight});this.props.capturedContentHandler.handleCapturedContent([t],this.props.entryPoint,this.props.cameraMode)}this._onCaptureFlowComplete()}),(e=>{H.error(E.LogTraceArea.Capture,de.default.errorAsString(e)),this._onCaptureFlowComplete()})):this._snapShotImage().then((e=>{const t=we({uri:e,size:this._nonNullFileSize(),type:"image",width:this.props.mediaWidth,height:this.props.mediaHeight});this.props.capturedContentHandler.handleCapturedContent([t],this.props.entryPoint,this.props.cameraMode),this._onCaptureFlowComplete()}),(e=>{H.error(E.LogTraceArea.Capture,de.default.errorAsString(e)),this._onCaptureFlowComplete()})):this.props.skipShareWithPanel?this.props.conversationId&&this._postToConversation(this.props.conversationId,e):this._shouldSendOriginalMedia()&&this.props.mediaSelection?this.props.capturedContentHandler.handleMediaSelection(this.props.mediaSelection,!this.props.mediaSelection.node.node.isPhoto,e):this.props.localMediaIsVideo?this._saveVideo(!1,e).then((e=>{H.log(E.LogTraceArea.Capture,"CapturePreview video result "+o.pii.Omit(e.uri)+" "+(e.thumbnailUri?o.pii.Omit(e.thumbnailUri):"undefined"));const t=we({uri:e.uri,size:e.fileSize||this._nonNullFileSize(),type:"video",width:this.props.mediaWidth,height:this.props.mediaHeight});if(e.thumbnailUri){const s=(0,U.parseFileUri)(e.thumbnailUri),i=s?N.default.extractFileNameWithExtension(s.path):"";t.thumbnail={file:{uri:e.thumbnailUri,name:i,size:void 0,type:"image"},extension:N.default.extractFileExtension(i)}}this.props.capturedContentHandler.handleCapturedContent([t],this.props.entryPoint,this.props.cameraMode)}),(e=>H.error(E.LogTraceArea.Capture,de.default.errorAsString(e)))):this._snapShotImage().then((e=>{const t=we({uri:e,size:this.props.fileSize,type:"image",width:this.props.mediaWidth,height:this.props.mediaHeight});if(this.props.localMediaThumbnailUri){const e=(0,U.parseFileUri)(this.props.localMediaThumbnailUri),s=e?N.default.extractFileNameWithExtension(e.path):"";t.thumbnail={file:{uri:this.props.localMediaThumbnailUri,name:s,size:void 0,type:"image"},extension:N.default.extractFileExtension(s)}}this.props.capturedContentHandler.handleCapturedContent([t],this.props.entryPoint,this.props.cameraMode)}),(e=>H.error(E.LogTraceArea.Capture,de.default.errorAsString(e)))),this.setState({sendEnabled:!1})}handleBackAction(){return this._onCancelPressed()}_postToConversation(e,t){let s;H.log(E.LogTraceArea.Capture,"CapturePreview_postToConversation, conversationId: "+oe.mriOrId(e)),s=this.props.localMediaIsVideo?this._sendCapturedVideo(e,t):this._sendCapturedPhoto(e,t),s.then((()=>{this._onCaptureFlowComplete()})).catch(n.noop)}_sendCapturedPhoto(e,t){if(e){if(H.log(E.LogTraceArea.Capture,"CapturePreview sending captured photo, conversationId: "+oe.mriOrId(e)+" callId: "+this.props.callId+" causeId: "+t),this._shouldSendOriginalMedia()&&this.props.mediaSelection){const e=this._captureSessionTelemetry;return delete this._captureSessionTelemetry,this.props.capturedContentHandler.handleMediaSelection(this.props.mediaSelection,!1,t,e)}return this._snapShotImage().then((e=>{const s=we({uri:e,size:this.props.fileSize,type:"image",width:this.props.mediaWidth,height:this.props.mediaHeight});this.props.capturedContentHandler.handleCapturedContent([s],this.props.entryPoint,this.props.cameraMode),this._onAfterImagePosted(s.extension,t)}))}return H.log(E.LogTraceArea.Capture,"CapturePreview not sending captured photo (no conversation)"),p.Resolved()}_onAfterImagePosted(e,t){if(this.props.entryPoint!==E.PostSource.MessageComposer){const t=this.props.entryPoint===E.PostSource.MediaPicker?K.FilePickerOrigin.MediaPickerItem:K.FilePickerOrigin.CapturePreview;H.track(new K.FilesSentViaPicker(t,0,!1,[Se.default.changeExtensionForTelemetry(e)]))}this.props.callId?y.default.updateCallTelemetry(this.props.callId,t,(e=>e.postPhotoReaction())):(this._mediaSaved=!0,this._completeCaptureSession())}_sendCapturedVideo(e,t){if(e){if(this.props.mediaSelection&&this._shouldSendOriginalMedia()){const e=this._captureSessionTelemetry;return delete this._captureSessionTelemetry,this.props.capturedContentHandler.handleMediaSelection(this.props.mediaSelection,!0,t,e)}return this._saveVideo(this.state.sendOverlayAsMetadata,t).then((e=>{const t=e.uri;if(!t)return;if(!e.thumbnailUri)return;H.log(E.LogTraceArea.Capture,"CapturePreview sending video "+o.pii.Omit(t)+" thumbnail uri "+(e.thumbnailUri?o.pii.Omit(e.thumbnailUri):"undefined"));let s=this.props.mediaSelection&&this.props.mediaSelection.fileName;if(!s){const e=(0,U.parseFileUri)(t);s=e?N.default.extractFileNameWithExtension(e.path):""}const i={file:{uri:t,name:s,size:e.fileSize?e.fileSize:this.props.fileSize,type:"video/mp4"},extension:N.default.extractFileExtension(s),dimensions:{width:this.props.mediaWidth,height:this.props.mediaHeight},thumbnail:{file:{uri:e.thumbnailUri,name:N.default.extractFileName(s)+"-thumbnail.jpg",size:void 0,type:"image/jpg"},extension:"jpg",dimensions:{width:this.props.mediaWidth,height:this.props.mediaHeight}}};this.props.capturedContentHandler.handleCapturedContent([i],this.props.entryPoint,this.props.cameraMode,e.overlayUri);const n=this.props.entryPoint===E.PostSource.MediaPicker?K.FilePickerOrigin.MediaPickerItem:K.FilePickerOrigin.CapturePreview;H.track(new K.FilesSentViaPicker(n,0,!1,[Se.default.changeExtensionForTelemetry(i.extension)])),this._mediaSaved=!0,this._completeCaptureSession()}))}return H.log(E.LogTraceArea.Capture,"CapturePreview not sending captured video (no conversation)"),p.Resolved()}_savePhotoToCameraRoll(e){return H.log(E.LogTraceArea.Capture,"CapturePreview._savePhotoToCameraRoll causeId:"+e),this._shouldSendOriginalMedia()&&this.props.mediaSelection?(H.log(E.LogTraceArea.Capture,"CapturePreview._savePhotoToCameraRoll save original causeId:"+e),p.Resolved()):ee.default.requestCameraRollPermission().then((t=>(H.log(E.LogTraceArea.Capture,"CapturePreview._savePhotoToCameraRoll: Access allowed?",t?"yes":"no causeId:"+e),t?this._snapShotImage().then((e=>a.default.saveToCameraRoll(e))).then((()=>{H.log(E.LogTraceArea.Capture,"CapturePreview._savePhotoToCameraRoll toast causeId:"+e),q.default.scheduleTextMessage(G.getString("CapturePreview.PhotoSavedNotification"),void 0,this._getRootViewId())})):void 0)))}_saveVideoToCameraRoll(e){return H.log(E.LogTraceArea.Capture,"CapturePreview._saveVideoToCameraRoll causeId:"+e),this._shouldSendOriginalMedia()&&this.props.mediaSelection?(H.log(E.LogTraceArea.Capture,"CapturePreview._saveVideoToCameraRoll save original causeId:"+e),p.Resolved()):ee.default.requestCameraRollPermission().then((t=>(H.log(E.LogTraceArea.Capture,"CapturePreview._saveVideoToCameraRoll: Access allowed?",t?"yes":"no causeId:"+e),t?this._saveVideo(!1,e).then((t=>(H.log(E.LogTraceArea.Capture,"CapturePreview._saveVideoToCameraRoll result:"+(t.uri?"yes":"no")+" causeId:"+e),t.uri?a.default.saveToCameraRoll(t.uri):p.Rejected("no uri")))).then((()=>{H.log(E.LogTraceArea.Capture,"CapturePreview._saveVideoToCameraRoll toast causeId:"+e),q.default.scheduleTextMessage(G.getString("CapturePreview.VideoSavedNotification"),void 0,this._getRootViewId())})):void 0)))}_hasMarkup(e){return e.hasMarkup||e.hasText||e.hasStickers||e.hasOverlay}_shouldSendOriginalMedia(){return!(this.props.isRemotePicture||this.state.hasMarkup||this.state.hasText||this.state.hasStickers||this.state.hasOverlay||this.state.hasFilter)}_snapShotImage(){if(this._shouldSendOriginalMedia())return p.Resolved(this.props.localMediaObjectUri);H.track(new C.MarkupAdded(this.props.entryPoint,this.state.hasMarkup,this.state.hasText,this.state.hasStickers,this.state.hasOverlay,this.state.hasFilter,this.state.stickerIds)),this._setCaptureSessionMarkupInfo(),te.default.registerStickersInCapture(this.state.stickerIds),H.log(E.LogTraceArea.Capture,"CapturePreview snapshotting markup view"),this._imageWithLensPromise=p.Defer();return this._markupView.prepareForSnapshot().then((()=>this._snapShotView.takeSnapshot(this.props.localMediaObjectUri,{format:"jpeg",quality:.7}))).then((e=>(this._markupView&&(H.log(E.LogTraceArea.Capture,"CapturePreview restoring markup view"),this._markupView.restoreAfterSnapshot()),this._setLensSnapshot(void 0),this._imageWithLensPromise=void 0,e))).fail((e=>{H.error(E.LogTraceArea.Capture,de.default.errorAsString(e)),H.log(E.LogTraceArea.Capture,"CapturePreview snapshot failed"),this._markupView&&(H.log(E.LogTraceArea.Capture,"CapturePreview restoring markup view"),this._markupView.restoreAfterSnapshot()),this._setLensSnapshot(void 0),this._imageWithLensPromise=void 0}))}_snapShotVideoMarkup(){return this._hasMarkup(this.state)?(H.log(E.LogTraceArea.Capture,"CapturePreview snapshotting markup for video"),this._setCaptureSessionMarkupInfo(),te.default.registerStickersInCapture(this.state.stickerIds),this._markupView.prepareForSnapshot().then((()=>this._snapShotView.takeSnapshot(void 0,{format:"png"}))).then((e=>(this._markupView&&(H.log(E.LogTraceArea.Capture,"CapturePreview restoring markup view"),this._markupView.restoreAfterSnapshot()),e)))):p.Resolved(this.props.localMediaObjectUri)}_setCaptureSessionMarkupInfo(){const e=this._captureSessionTelemetry;e&&(e.clearMarkup(),e.setInk(this.state.hasMarkup),e.setText(this.state.hasText),e.setStickers(this.state.hasStickers),e.setOverlay(this.state.hasOverlay),e.setFilter(this.state.hasFilter),e.setStickerIds(this.state.stickerIds),this._setCaptureSessionStickerNames())}_setCaptureSessionStickerNames(){const e=this._captureSessionTelemetry;if(e){const t=[],s=[];n.each(this._stickerNames,(e=>{e.tabTitle&&t.push(e.tabTitle.toLowerCase()),e.stickerName&&s.push(e.stickerName.toLowerCase())})),e.setTabNames(t),e.setStickerNames(s)}}_completeCaptureSession(){const e=this._captureSessionTelemetry;e&&(e.setMediaSentStatus(this._mediaSaved),e.setAddStickersClickCount(this._addStickersClickCount),H.track(e),delete this._captureSessionTelemetry),this._mediaSaved=!1}_saveVideo(e,t){if(this._shouldSendOriginalMedia()||!this._videoMarkupSupported())return p.Resolved({uri:this.props.localMediaObjectUri,thumbnailUri:this.props.localMediaThumbnailUri});return this.setState({videoProcessingInProgress:!0}),this._snapShotVideoMarkup().then((s=>e?p.Resolved({uri:this.props.localMediaObjectUri,thumbnailUri:this.props.localMediaThumbnailUri,overlayUri:s}):ve.default.saveVideoWithoutView(this.props.localMediaObjectUri,s,Ce.default.reencodeOptions(),t,undefined).manipulationPromise)).then((e=>(this.setState({videoProcessingInProgress:!1}),e))).catch((e=>(H.error(E.LogTraceArea.Capture,de.default.errorAsString(e)),H.log(E.LogTraceArea.Capture,`CapturePreview saveVideo error causeId: ${t}`),this.setState({videoProcessingInProgress:!1}),p.Resolved({uri:this.props.localMediaObjectUri,thumbnailUri:this.props.localMediaThumbnailUri}))))}_setLensSnapshot(e){this.isComponentMounted()&&this.setState({lensSnapshot:e})}_useLargeAvatarOverlay(e){return e.width>500&&e.height>500}_avatarOverlayHeight(e){return this._useLargeAvatarOverlay(e)?500:250}_avatarOverlayWidth(e){return this._useLargeAvatarOverlay(e)?500:250}_getSnapshotRect(e){let t;t=this.props.isAvatarPreview?{height:this._avatarOverlayHeight(e),width:this._avatarOverlayWidth(e)}:this._getProjectedDimensions({width:this.props.mediaWidth,height:this.props.mediaHeight},e);let s=(e.height-t.height)/2;return!this.props.isAvatarPreview&&e.height-t.height<=150&&s>0&&(s=0),{height:t.height,width:t.width,x:(e.width-t.width)/2,y:s}}_getProjectedDimensions(e,t,s){const i=e.width/t.width,o=e.height/t.height,n=s?Math.min(i,o):Math.max(i,o),r=e.width/n,a=e.height/n;return{height:this.props.isAvatarPreview?a:Math.ceil(a),width:this.props.isAvatarPreview?r:Math.ceil(r)}}_getSnapshotContainerStyle(){return h.Styles.createViewStyle({position:"absolute",height:this.state.snapShotRect.height,width:this.state.snapShotRect.width,top:this.state.snapShotRect.y,left:this.state.snapShotRect.x,overflow:"visible"},!1)}_coachmarksButtonIds(){return this.props.conversationId?[A.CapturePreviewButtonId.Send]:[A.CapturePreviewButtonId.HubSend]}_videoMarkupSupported(){return!!this.state.alwaysEnableVideoMarkup||this._isNativeMobile&&!this.props.performMarkupOnly&&this.state.videoMarkupFXEnabled&&this.props.entryPoint===E.PostSource.Capture}_undoLastSupported(){return this._isNativeMobile}_isMediaSelectionGif(){return this.props.fileExtension&&N.default.isGifImageExtension(this.props.fileExtension)||!!this.props.mediaSelection&&!!this.props.mediaSelection.node.node.image&&N.default.getFileContentType(this.props.mediaSelection.node.node.image.uri)===N.default.imageContentTypes.gif}_getDefaultMarkupMode(e){return e.effectsEnabled?M.CaptureMarkupMode.Filters:M.CaptureMarkupMode.None}_nonNullFileSize(){return this.props.fileSize}}t.default=Pe},345887:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CapturePreviewCoachmarks=t.CapturePreviewButtonId=void 0;const i=s(785893),o=s(496486),n=s(770857),r=s(302860),a=s(733754);var l;!function(e){e[e.Send=0]="Send",e[e.HubSend=1]="HubSend"}(l=t.CapturePreviewButtonId||(t.CapturePreviewButtonId={}));class d extends n.CaptureCoachmarksBase{constructor(){super(...arguments),this._onContainerLayout=e=>{const t={width:e.width,height:e.height};this.setState({viewDimensions:t})}}_buildState(e,t){const s={};return t&&(s.viewDimensions={width:0,height:0}),s}_renderCoachmarks(){return o.map(this.props.supportedButtons,(e=>this._renderCoachmark(e)))}_renderCoachmark(e){let t,s,o=r.CoachmarkAlignment.Center;const n=this.state.viewDimensions.width>this.state.viewDimensions.height;switch(e){case l.Send:t=a.getString("CapturePreview.SendButtonTooltip"),s=80,o=r.CoachmarkAlignment.Right;break;case l.HubSend:t=a.getString("CapturePreview.HubSendButtonTooltip"),s=n?80:140,o=r.CoachmarkAlignment.Right}return(0,i.jsx)(r.Coachmark,{alignment:o,direction:r.CoachmarkDirection.Down,displayText:t,height:s,viewDimensions:this.state.viewDimensions,getAnchorRect:this.props.getAnchorRect?()=>this.props.getAnchorRect(e):void 0},"coachmark"+e)}}t.CapturePreviewCoachmarks=d,t.default=d},116184:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});s(785893);const i=s(516778),o=s(351885);class n extends o.CaptureOverlayView{_renderContent(){}_imageStyle(){return i.Styles.createViewStyle({position:"absolute",top:this.props.topOffset?Math.min(0,this.props.topOffset):0,left:0,right:0,bottom:0},!1)}}t.default=n},302860:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Coachmark=t.CoachmarkAlignment=t.CoachmarkDirection=void 0;const i=s(785893),o=s(516778),n=s(217041),r=s(746096),a=s(436237),l=s(861253),d=s(915877),c=s(404057),h=s(581760),u=s(640363),p=s(680837),g=s(619675),m=s(912770);var S,f;!function(e){e[e.Down=0]="Down",e[e.Up=1]="Up",e[e.Left=2]="Left",e[e.Right=3]="Right"}(S=t.CoachmarkDirection||(t.CoachmarkDirection={})),function(e){e[e.Center=0]="Center",e[e.Left=1]="Left",e[e.Right=2]="Right"}(f=t.CoachmarkAlignment||(t.CoachmarkAlignment={}));const y=300,v=100,C=(0,d.lazyProperties)({verticalLine:()=>o.Styles.createViewStyle({flex:1,width:1,backgroundColor:h.Color.white}),horizontalLine:()=>o.Styles.createViewStyle({flex:1,height:1,backgroundColor:h.Color.white}),dimmedBack:()=>o.Styles.createViewStyle({opacity:.55}),alignItemsLeft:()=>o.Styles.createViewStyle({alignItems:"flex-start"}),alignItemsRight:()=>o.Styles.createViewStyle({alignItems:"flex-end"}),textAlignLeft:()=>o.Styles.createTextStyle({textAlign:"left"}),textAlignRight:()=>o.Styles.createTextStyle({textAlign:"right"}),textAlignCenter:()=>o.Styles.createTextStyle({textAlign:"center"})});class _ extends n.ComponentBase{constructor(){super(...arguments),this._animatedOpacityValue=new o.Animated.Value(0),this._animatedOpacityStyle=o.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue})}_buildState(e,t){return{}}componentDidMount(){super.componentDidMount(),this._animatedOpacityValue.setValue(this.state.anchorPoint?1:0),this._updateAnchorPoint()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),(0,l.default)(e.viewDimensions,this.props.viewDimensions)||this._updateAnchorPoint(),(0,l.default)(t.anchorPoint,this.state.anchorPoint)||o.Animated.timing(this._animatedOpacityValue,{toValue:this.state.anchorPoint?1:0,duration:this.state.anchorPoint?350:0,easing:o.Animated.Easing.Linear()}).start()}_updateAnchorPoint(){this._clearAnchorPoint(),m.default.setTimeout((()=>{this.isComponentMounted()&&this.props.getAnchorRect&&this.props.getAnchorRect().then((e=>{if(!this.isComponentMounted())return;let t;this._isHorizontal(this.props.direction)?(t={x:e.x,y:e.y+e.height/2},this.props.direction===S.Left&&(t.x+=e.width)):(t={x:e.x+e.width/2,y:e.y},this.props.direction===S.Up&&(t.y+=e.height)),this.setState({anchorPoint:t})}),(e=>a.error(r.LogTraceArea.Capture,c.default.errorAsString(e))))}),this.props.presentationDelay||500)}_clearAnchorPoint(){this.setState({anchorPoint:void 0})}_renderCoachmark(){const e=(0,i.jsx)(g.BodyText,Object.assign({bold:!0,size:g.BodyTextSize.SmallDeprecated,style:this._coachmarkTextStyle()},{children:this.props.displayText})),t=(0,i.jsx)(o.View,{style:this._isHorizontal(this.props.direction)?C.horizontalLine:C.verticalLine}),s=this.props.direction===S.Up||this.props.direction===S.Left;return(0,i.jsxs)(o.View,Object.assign({style:this._coachmarkStyle()},{children:[s?t:e,s?e:t]}))}_containerStyle(){if(!this.state.anchorPoint)return;const e=u.default.isRTL();if(this._isHorizontal(this.props.direction)){const t=this.state.anchorPoint.y-50;let s=this.state.anchorPoint.x;const i=this.props.anchorPadding||6;return this.props.direction!==S.Right||e?s+=i:s-=(this.props.height||y)+i+160,e?o.Styles.createViewStyle({position:"absolute",right:s,top:t,overflow:"visible"},!1):o.Styles.createViewStyle({position:"absolute",left:s,top:t,overflow:"visible"},!1)}let t=this.state.anchorPoint.x;this.props.alignment===f.Center?t-=(this.props.width||y)/2:this.props.alignment!==f.Right||e||(t-=this.props.width||y);let s=this.state.anchorPoint.y;const i=this.props.anchorPadding||6;return this.props.direction===S.Down?s-=(this.props.height||v)+i:s+=i,e?o.Styles.createViewStyle({position:"absolute",right:t,top:s,overflow:"visible"},!1):o.Styles.createViewStyle({position:"absolute",left:t,top:s,overflow:"visible"},!1)}_coachmarkStyle(){return this._isHorizontal(this.props.direction)?[o.Styles.createViewStyle({height:v,width:(this.props.height||y)+160,flexDirection:"row",overflow:"visible"},!1),this._getAlignItemsStyle()]:[o.Styles.createViewStyle({width:this.props.width||y,height:this.props.height||v,overflow:"visible"},!1),this._getAlignItemsStyle()]}_coachmarkTextStyle(){const e=this._isHorizontal(this.props.direction);return[o.Styles.createTextStyle({color:h.Color.white,width:e?160:this.props.width||250,paddingVertical:e?0:8,paddingHorizontal:e?8:0,backgroundColor:h.Color.transparent},!1),this._getTextAlignStyle()]}_getTextAlignStyle(){if(this._isHorizontal(this.props.direction))return this.props.direction===S.Right?C.textAlignRight:C.textAlignLeft;switch(this.props.alignment){case f.Center:return C.textAlignCenter;case f.Left:return C.textAlignLeft;case f.Right:return C.textAlignRight}}_getAlignItemsStyle(){if(this._isHorizontal(this.props.direction))return p.default.alignItemsCenter;switch(this.props.alignment){case f.Center:return p.default.alignItemsCenter;case f.Left:return C.alignItemsLeft;case f.Right:return C.alignItemsRight}}_isHorizontal(e){return e===S.Left||e===S.Right}render(){if(!this.state.anchorPoint)return null;const e=[],t=this._containerStyle();return t&&e.push(t),this.props.dimmedBack&&e.push(C.dimmedBack),(0,i.jsx)(o.View,Object.assign({style:e},{children:(0,i.jsx)(o.Animated.View,Object.assign({style:[p.default.overflowVisible,this._animatedOpacityStyle]},{children:this._renderCoachmark()}))}))}}t.Coachmark=_,t.default=_},630886:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(67930),n=s(995359),r=s(474470),a=s(746096),l=s(211375),d=s(436237),c=s(104735),h=s(853374);var u;!function(e){e[e.Capture=0]="Capture",e[e.Preview=1]="Preview"}(u||(u={}));class p extends o.default{constructor(){super(...arguments),this._closePanelAndCleanTempFile=()=>{this._closePanel()},this._closePanel=()=>{const e=h.default.newCauseId();d.log(a.LogTraceArea.Capture,"DesktopCaptureComboView._closePanel causeId: "+e),c.default.goBack(e,this._getContext())},this._onRecordingCompleted=(e,t,s,i)=>{this.setState({mode:u.Preview,previewUrl:e,previewBlob:t,videoDuration:s,transactionId:i})},this._recordAgain=()=>{this.setState({mode:u.Capture})}}_buildState(e,t){const s={};return t&&(s.mode=u.Capture),s}_getHeaderText(e){}render(){switch(this.state.mode){case u.Capture:return(0,i.jsx)(n.default,{conversationId:this.props.conversationId,onCloseButtonPress:this._closePanelAndCleanTempFile,onRecordingCompleted:this._onRecordingCompleted});case u.Preview:return(0,i.jsx)(r.default,{conversationId:this.props.conversationId,previewUrl:this.state.previewUrl,blob:this.state.previewBlob,duration:this.state.videoDuration,closePanel:this._closePanel,recordAgain:this._recordAgain,transactionId:this.state.transactionId,onShareComplete:this.props.onShareComplete});default:return null}}componentWillUnmount(){super.componentWillUnmount(),l.setFocusWithDelay(l.FocusEvent.VideoMessageClosed,250)}}t.default=p},995359:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(174958),n=s(496486),r=s(418602),a=s(850066),l=s(516778),d=s(244770),c=s(219784),h=s(889391),u=s(67930),p=s(272675),g=s(911009),m=s(816402),S=s(580814),f=s(884817),y=s(952262),v=s(770891),C=s(746096),_=s(245381),b=s(913944),T=s(436237),M=s(915877),I=s(733754),w=s(886045),P=s(404057),k=s(581760),A=s(640363),x=s(311010),R=s(711828),O=s(680837),L=s(619675),F=s(912770),B=s(853374),D=s(803729),E=s(203230),V=(0,M.lazyProperties)({cameraContainer:()=>l.Styles.createViewStyle({flex:1,alignSelf:"stretch",backgroundColor:k.Color.black}),flippedView:()=>l.Styles.createViewStyle({flex:1,alignSelf:"stretch",transform:[{rotateY:"-180"}]}),overlayContainer:()=>l.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:k.Color.transparent}),controlsContainer:()=>l.Styles.createViewStyle({flex:1,alignItems:"flex-end",justifyContent:"center",flexDirection:"row",paddingHorizontal:20,paddingBottom:40}),headerRow:()=>l.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"flex-start",alignContent:"center",flexDirection:"row"}),closeButton:()=>l.Styles.createScrollViewStyle({paddingRight:20}),headerContainer:()=>l.Styles.createViewStyle({top:0,left:0,right:0,paddingVertical:20,paddingLeft:20}),conversationNameTextStyle:()=>l.Styles.createTextStyle({color:k.Color.white,overflow:"hidden",flex:1}),durationTextStyle:()=>l.Styles.createTextStyle({color:k.Color.whiteOverlay50,paddingLeft:46}),noPreviewContainer:()=>l.Styles.createViewStyle({backgroundColor:k.Color.black}),noPreviewTextContainer:()=>l.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,flexDirection:"row",alignItems:"center",alignContent:"center",justifyContent:"center"}),noPreviewTextStyle:()=>l.Styles.createTextStyle({fontSize:x.default.controlFontSize.headerSizeSmall,fontFamily:x.default.fontFamily.uidDisplayRegular,color:k.Color.white,overflow:"hidden",textAlign:"center",flex:1})});class N extends u.default{constructor(){super(...arguments),this._onCameraFailure=e=>{T.error(C.LogTraceArea.Capture,"DesktopCapturePanel._onCameraFailure "+o.pii.Omit(e.failure)),T.track(new p.CameraFailureEvent(e.failure,"Desktop",e.details)),e.failure!==r.CameraPreviewFailureErrorOnStart&&e.failure!==r.CameraPreviewFailureNoCamera||(this.state.isVisible&&c.default.showOKAlert(I.getString("CapturePreview.UnableToOpenCamera"),I.getString("CapturePreview.UnableToOpenCameraDescription"),this._getRootViewId()),this._closePanel())},this._toolTipAnimationConfig={presentOffset:{x:0,y:15},dismissOffset:{x:0,y:5},duration:250,easing:l.Animated.Easing.OutBack()},this._previewCallback=(e,t)=>{if(this.isComponentMounted()){if(!e&&!t)return void this._onCameraFailure({source:"VimService.startPreview",failure:r.CameraPreviewFailureErrorOnStart});this.setState({previewUrl:e,previewStream:t,isInitializingDevice:!1,startPreviewOnMount:!0})}},this._onRecordButtonRef=e=>{this._recordButton=e||void 0,this._recordButton&&n.delay((()=>{if(!this.isComponentMounted())return;const e=I.getString("CapturePreview.ReadyToRecord"),t={getElement:()=>this._recordButton,positions:[g.PopupAnchorPositon.Top,g.PopupAnchorPositon.Bottom],title:e,durationMs:3e3,anchorAccessibilityLabel:e,instanceId:"recordbutton",rootViewId:this._getRootViewId()};this.setState({toolTipInfo:t})}),1e3)},this._onCloseButtonPress=e=>{e.stopPropagation(),this._closePanel()},this._onRef=e=>{this._videoRef=e||void 0,this._videoRef&&this.state.startPreviewOnMount&&(this._videoRef.play(),this._videoRef.mute(!0))},this._onRecordButtonPress=e=>{if(this.state.isRecording)this._stopRecording();else{this.setState({isRecording:!0}),this._videoRecordingStartTime=Date.now(),this._startRecordingTimer();try{a.default.startRecording()}catch(e){T.error(C.LogTraceArea.Capture,"Desktop VIM unable to start recording.",P.default.errorAsString(e))}}},this._recordBlobCallback=(e,t)=>{this._recordUrl=t,T.log(C.LogTraceArea.Capture,"Desktop captured blob "+(this._recordUrl?o.pii.Omit(this._recordUrl):"undefined")),this._videoRef?this._videoRef.stop():T.warn(C.LogTraceArea.Capture,"Desktop record callback with undefined video reference."),this.isComponentMounted()&&this.setState({previewUrl:void 0,previewStream:void 0,isProcessingVideo:!1});const s=Date.now()-this._videoRecordingStartTime,i=new E.RecordEvent(s,e.size);if(this._recordUrl){const t=B.default.newGuid();i.setStatus(!0,t),T.track(i),this.props.onRecordingCompleted(this._recordUrl,e,s,t)}else{const e="Desktop record callback with undefined recording URL.";T.warn(C.LogTraceArea.Capture,e),i.setStatus(!1,void 0,e),T.track(i),this.setState({failedToRecord:!0})}}}_buildState(e,t){const s={},i=h.default.getS4LCMCFeatures();if(t){s.isInitializingDevice=!0,s.cameraLabel=f.default.getSelectedCameraID(),s.microphoneLabel=f.default.getSelectedMicID(),s.videoProfile=i.videoProfile,s.maxRecordingMs=i.maxRecordingMs;try{a.default.startPreview(this._previewCallback,s.cameraLabel,s.microphoneLabel),s.startPreviewOnMount=!0}catch(e){T.error(C.LogTraceArea.Capture,"Desktop VIM unable to start camera preview.",P.default.errorAsString(e)),s.startPreviewOnMount=!1}s.isRecording=!1,s.recordedVideoDuration=0,s.isVisible=!1,e.conversationId&&(s.conversationName=y.default.getDisplayName(e.conversationId)),s.toolTipInfo=void 0,s.failedToRecord=!1,s.isProcessingVideo=!1}return s}_getHeaderText(e){}componentWillUnmount(){super.componentWillUnmount(),this.setState({isVisible:!1}),this._stopRecordingTimer(),a.default.stopPreview(),this._videoRef&&this._videoRef.stop()}componentDidMount(){super.componentDidMount(),this.setState({isVisible:!0})}render(){const e=this.state.isRecording||this.state.isProcessingVideo?void 0:(0,i.jsx)(_.default,{toolTipInfo:this.state.toolTipInfo,animateDismissal:!0,animationConfig:this._toolTipAnimationConfig,containerOffsetY:7});if(this.state.previewUrl||this.state.previewStream){const t=(0,i.jsx)(D.default,{origin:"desktop-capture-panel",ref:this._onRef,source:this.state.previewUrl,sourceObj:this.state.previewStream,style:V.cameraContainer,resizeMode:"cover",mediaProvider:v.MediaProvider.Capture,ariaHidden:!0});return(0,i.jsxs)(l.View,Object.assign({style:V.overlayContainer},{children:[(0,i.jsx)(l.View,Object.assign({style:V.flippedView},{children:t})),(0,i.jsxs)(l.View,Object.assign({style:O.default.absoluteFill},{children:[this._getCapturePanelHeader(),this._getCapturePanelControls()]})),e]}))}return this.state.isInitializingDevice?null:(0,i.jsxs)(l.View,Object.assign({style:[V.overlayContainer,V.noPreviewContainer]},{children:[(0,i.jsx)(l.View,Object.assign({style:V.noPreviewTextContainer},{children:(0,i.jsx)(l.Text,Object.assign({style:V.noPreviewTextStyle,numberOfLines:1},{children:I.getString(this.state.failedToRecord?"CapturePreview.UnableToRecord":"CapturePreview.NoWebCamAvailable")}))})),this._getCapturePanelHeader()]}))}_closePanel(){this.setState({isVisible:!1}),a.default.stopPreview(),this.props.onCloseButtonPress()}_getCapturePanelHeader(){const e=h.default.getS4LUiFeaturesNoSubscription().enableWindowRightClose&&A.default.isWindowCloseOnRight(),t=(0,i.jsx)(b.default,{onPress:this._onCloseButtonPress,style:V.closeButton,size:R.IconSize.size24,color:k.Color.whiteOverlay90,hoverColor:k.Color.white,icon:R.SkypeIcon.ClosePanel,title:I.getString("Global.CloseButtonTitle"),importantForAccessibility:l.Types.ImportantForAccessibility.Yes});let s,o;return this.state.conversationName&&(s=(0,i.jsx)(l.Text,Object.assign({style:[x.default.fontStyle.messagingHeader,V.conversationNameTextStyle],numberOfLines:1},{children:this.state.conversationName}))),this.state.isRecording&&this.state.recordedVideoDuration&&(o=(0,i.jsx)(L.Subtitle,Object.assign({style:V.durationTextStyle},{children:m.default.getElapsedTimeStringFromMs(this.state.recordedVideoDuration)}))),(0,i.jsxs)(l.View,Object.assign({style:V.headerContainer},{children:[(0,i.jsx)(l.Image,{style:V.overlayContainer,resizeMode:"stretch",source:d.Collection.PHOTO_SHIM}),(0,i.jsxs)(l.View,Object.assign({style:V.headerRow},{children:[e?void 0:t,s,e?t:void 0]})),o]}))}_getCapturePanelControls(){const e=this.state.isRecording&&this.state.recordedVideoDuration?this.state.recordedVideoDuration/this.state.maxRecordingMs:void 0,t=(0,i.jsx)(S.default,{ref:this._onRecordButtonRef,showProgressIndicator:this.state.isRecording,progress:e,onPress:this._onRecordButtonPress});return(0,i.jsx)(l.View,Object.assign({style:V.controlsContainer},{children:t}))}_startRecordingTimer(){this._timerToken||(this._timerToken=F.default.setInterval((()=>{const e=Date.now()-this._videoRecordingStartTime;e>=this.state.maxRecordingMs&&this._stopRecording(),this.setState({recordedVideoDuration:e})}),1e3))}_stopRecordingTimer(){this._timerToken&&(F.default.clearInterval(this._timerToken),this._timerToken=void 0)}_stopRecording(){w.default.maybeAnnounceForAccessibility("CapturePreview.RecordingSuccessful"),a.default.stopRecording((e=>{this._recordUrl=a.default.getRecordedVideoBlob(this._recordBlobCallback)})),a.default.stopPreview(),this._stopRecordingTimer(),this.setState({isRecording:!1,isProcessingVideo:!0})}}t.default=N},905805:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DesktopCapturePreview=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(4736),a=s(67930),l=s(911009),d=s(952262),c=s(245381),h=s(915877),u=s(733754),p=s(581760),g=s(711828),m=(0,h.lazyProperties)({controlsContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"flex-end",justifyContent:"center",flexDirection:"row",paddingHorizontal:20,paddingBottom:40}),overlayContainer:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:p.Color.black})});class S extends a.default{constructor(){super(...arguments),this._toolTipAnimationConfig={presentOffset:{x:0,y:15},dismissOffset:{x:0,y:5},duration:250,easing:n.Animated.Easing.OutBack()},this._onSendButtonRef=e=>{this._sendButton=e||void 0,this._sendButton&&o.delay((()=>{if(!this.isComponentMounted())return;const e=u.getString("CapturePreview.SendTitle"),t={getElement:()=>this._sendButton,positions:[l.PopupAnchorPositon.Top,l.PopupAnchorPositon.Bottom],title:e,durationMs:3e3,anchorAccessibilityLabel:e,instanceId:"sendbutton",rootViewId:this._getRootViewId()};this.setState({toolTipInfo:t})}),1e3)},this._triggerOnSendButtonPress=()=>{this._onSendButtonPress()},this._triggerOnCloseButtonPress=()=>{this._onCloseButtonPress()}}_buildState(e,t){const s={};return e.conversationId&&t&&(s.conversationName=d.default.getDisplayName(e.conversationId)),s.toolTipInfo=void 0,s}render(){const e=(0,i.jsx)(c.default,{toolTipInfo:this.state.toolTipInfo,animateDismissal:!0,animationConfig:this._toolTipAnimationConfig,containerOffsetY:7});return(0,i.jsxs)(n.View,Object.assign({style:m.overlayContainer},{children:[this.renderCapturedMediaContent(),this.renderCapturedMediaControls(),e]}))}renderCapturePreviewDefaultControls(){const e=(0,i.jsx)(r.default,{ref:this._onSendButtonRef,size:r.ActionButtonSize.Default,title:u.getString("CapturePreview.SendTitle"),onPress:this._triggerOnSendButtonPress,icon:g.SkypeIcon.Send,autoFocus:!0,importantForAccessibility:n.Types.ImportantForAccessibility.Yes});return(0,i.jsx)(n.View,Object.assign({style:m.controlsContainer},{children:e}))}}t.DesktopCapturePreview=S},580814:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(217041),r=s(915877),a=s(733754),l=s(411397),d=s(581760),c=s(711828),h=c.IconSize.size60,u=c.IconSize.size24,p=(0,r.lazyProperties)({outerContainerCircle:()=>o.Styles.createViewStyle({width:h,height:h,borderRadius:h/2,backgroundColor:d.Color.white}),innerContainerCircle:()=>o.Styles.createViewStyle({width:u,height:u,borderRadius:u/2,borderColor:d.Color.white,borderWidth:2,backgroundColor:d.Color.red}),outerContainerCircleRecording:()=>o.Styles.createViewStyle({width:h,height:h,borderRadius:h/2,backgroundColor:d.Color.red}),innerContainerCircleRecording:()=>o.Styles.createViewStyle({width:u,height:u,borderRadius:u/3,borderColor:d.Color.white,borderWidth:2,backgroundColor:d.Color.white}),innerContainerAbsolute:()=>o.Styles.createViewStyle({position:"absolute",top:(h-u)/2,left:(h-u)/2}),progessIndicator:()=>o.Styles.createImageStyle({position:"absolute",width:h,height:h,backgroundColor:d.Color.transparent})});class g extends n.ComponentBase{render(){let e=null,t=p.outerContainerCircle,s=p.innerContainerCircle;if(this.props.showProgressIndicator&&this.props.progress&&this.props.progress>0){const o={fillOpacity:0,strokeOpacity:1,strokeColor:d.Color.whiteOverlay90,fillColor:d.Color.transparent,strokeWidth:2};e=(0,i.jsx)(l.default,{style:p.progessIndicator,progress:this.props.progress,size:h,progressStrokeProperties:o}),t=p.outerContainerCircleRecording,s=p.innerContainerCircleRecording}return(0,i.jsxs)(o.Button,Object.assign({style:t,onPress:this.props.onPress,autoFocus:!0,title:a.getString("CapturePreview.StartAndStopRecordingButton"),importantForAccessibility:o.Types.ImportantForAccessibility.Yes},{children:[e,(0,i.jsx)(o.View,{style:[p.innerContainerAbsolute,s]})]}))}}t.default=g},474470:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(174958),n=s(496486),r=s(362520),a=s(516778),l=s(244770),d=s(889391),c=s(905805),h=s(770891),u=s(746096),p=s(753559),g=s(913944),m=s(110117),S=s(436237),f=s(861253),y=s(915877),v=s(733754),C=s(785207),_=s(415963),b=s(886045),T=s(910265),M=s(581760),I=s(640363),w=s(311010),P=s(711828),k=s(734528),A=s(803729),x=s(203230),R=s(211276),O=P.IconSize.size60,L=(0,y.lazyProperties)({playButtonborderStyle:()=>a.Styles.createViewStyle({position:"absolute",alignItems:"center",justifyContent:"center",borderRadius:O/2,borderStyle:"solid",borderWidth:2,borderColor:M.Color.white,width:O,height:O,backgroundColor:M.Color.blackOverlay20}),cameraContainer:()=>a.Styles.createViewStyle({position:"absolute",flex:1,alignSelf:"stretch"}),overlayContainer:()=>a.Styles.createViewStyle({position:"absolute",alignItems:"center",justifyContent:"center",top:0,left:0,right:0,bottom:0}),headerContainer:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,paddingVertical:20,paddingLeft:20}),conversationNameTextStyle:()=>a.Styles.createTextStyle({color:M.Color.white,overflow:"hidden",flex:1}),controls:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),topControls:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start",justifyContent:"center"}),centerControls:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),bottomControls:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-end",justifyContent:"center"}),playButtonContainer:()=>a.Styles.createViewStyle({marginTop:50}),closeButton:()=>a.Styles.createScrollViewStyle({paddingRight:20}),headerRow:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"flex-start",alignContent:"center",flexDirection:"row"})});class F extends c.DesktopCapturePreview{constructor(){super(...arguments),this._onContainerLayout=e=>{this.isComponentMounted()&&!(0,f.default)(e,this.state.viewRect)&&this.setState({viewRect:e})},this._closePanelAndCleanTempFile=()=>{this.props.closePanel()},this._closeConfirmCancelDialog=()=>{this.isComponentMounted()&&this.setState({showConfirmCancelDialog:!1})},this._onPlayPausePress=()=>{this._videoRef&&(S.log(u.LogTraceArea.Capture,"DesktopCaptureVideoPreview play/pause pressed"),this.state.videoPlaying?(this.setState({videoPlaying:!1}),this._videoRef.pause()):(this.setState({videoPlaying:!0}),this._videoRef.play()))},this._onPlayEnd=()=>{this._videoRef&&this.isComponentMounted()&&this.setState({videoPlaying:!1})},this._announceForAccessibilityForMessageSent=()=>{b.default.maybeAnnounceForAccessibility(v.getString("MessageComposer.MessageSentLabel"),0)},this._onRef=e=>{this._videoRef=e||void 0}}_buildState(e,t){const s=Object.assign({},super._buildState(e,t));return t&&(s.videoPlaying=!1,s.showConfirmCancelDialog=!1,s.viewRect={x:0,y:0,height:0,width:0}),s}renderCapturedMediaContent(){return this.props.previewUrl?(0,i.jsx)(a.View,Object.assign({style:[L.overlayContainer],onLayout:this._onContainerLayout},{children:(0,i.jsx)(A.default,{origin:"desktop-capture-panel",ref:this._onRef,onEnded:this._onPlayEnd,source:this.props.previewUrl,style:L.cameraContainer,resizeMode:"cover",mediaProvider:h.MediaProvider.Preview})})):null}_getHeaderText(e){}renderCapturedMediaControls(){const e=this.state.videoPlaying?P.SkypeIcon.Pause:P.SkypeIcon.Play,t=this.state.videoPlaying?v.getString("MediaViewer.Pause"):v.getString("MediaViewer.Play"),s=(0,i.jsx)(a.Button,Object.assign({style:[L.playButtonborderStyle,L.playButtonContainer],onPress:this._onPlayPausePress,accessibilityLabel:t,importantForAccessibility:a.Types.ImportantForAccessibility.Yes},{children:(0,i.jsx)(m.default,{icon:e,size:P.IconSize.size24,color:M.Color.white})})),o=this.renderHeader(),n=this.renderCapturePreviewDefaultControls();let r=(0,i.jsxs)(a.View,Object.assign({style:L.controls},{children:[(0,i.jsx)(a.View,Object.assign({style:L.topControls},{children:o})),(0,i.jsx)(a.View,Object.assign({style:L.centerControls},{children:s})),(0,i.jsx)(a.View,Object.assign({style:L.bottomControls},{children:n}))]}));return this.state.showConfirmCancelDialog&&(r=this._renderConfirmCancelDialog()),(0,i.jsx)(a.View,Object.assign({style:L.overlayContainer},{children:r}))}_renderConfirmCancelDialog(){const e=v.getString("CapturePreview.DiscardVideoMessageTitle"),t=v.getString("CapturePreview.DiscardVideoMessageText"),s=[{text:v.getString("CapturePreview.KeepVideoMessage"),isCancel:!0,onPress:this._closeConfirmCancelDialog},{text:v.getString("CapturePreview.CancelVideoMessage"),onPress:this._closePanelAndCleanTempFile},{text:v.getString("CapturePreview.RerecordVideoMessage"),isSubmit:!0,onPress:this.props.recordAgain}];return(0,i.jsx)(T.default,{dialogId:"confirmCancelDialog",closeOnClickOutside:!1,text:e,simpleContent:t,buttons:s,accessibilityLabel:t})}componentWillUnmount(){super.componentWillUnmount(),this._videoRef&&this._videoRef.stop()}renderHeader(){const e=d.default.getS4LUiFeaturesNoSubscription().enableWindowRightClose&&I.default.isWindowCloseOnRight(),t=(0,i.jsx)(g.default,{onPress:this._triggerOnCloseButtonPress,style:L.closeButton,size:P.IconSize.size24,color:M.Color.whiteOverlay90,hoverColor:M.Color.white,icon:k.closeIcon(),title:v.getString("Global.CloseButtonTitle"),importantForAccessibility:a.Types.ImportantForAccessibility.Yes});return this.state.conversationName?(0,i.jsxs)(a.View,Object.assign({style:L.headerContainer},{children:[(0,i.jsx)(a.Image,{style:L.overlayContainer,resizeMode:"stretch",source:l.Collection.PHOTO_SHIM}),(0,i.jsxs)(a.View,Object.assign({style:L.headerRow},{children:[e?void 0:t,(0,i.jsx)(a.Text,Object.assign({style:[w.default.fontStyle.messagingHeader,L.conversationNameTextStyle],numberOfLines:1},{children:this.state.conversationName})),e?t:void 0]}))]})):null}_onSendButtonPress(){if(!this.props.previewUrl)return void this.props.closePanel();let e=p.default.extractFileNameWithExtension(this.props.previewUrl);r.extname(e)||(e+=".mp4");const t={name:_.ScenarioName.SendVideo,transactionId:this.props.transactionId};if(this.props.blob){const s=this.props.blob,i=new File([s],e),r={file:i,extension:"mp4"};(0,R.captureFrameFromVideo)(URL.createObjectURL(i),.5).then((a=>{const l=new x.UploadEvent(this.props.duration,s.size);if(a){const s=a.blob,d=e+"-thumbnail."+a.extension;if(n.attempt((()=>s.name=d)),n.attempt((()=>s.lastModifiedDate=new Date(i.lastModified))),r.thumbnail={file:s,extension:a.extension},a.width>=0&&a.height>=0){const e={width:a.width,height:a.height};r.dimensions=e,r.thumbnail.dimensions=e}S.log(u.LogTraceArea.Capture,"DesktopCaptureVideoPreview thumbnail generated ",d," ",a),S.log(u.LogTraceArea.Capture,"DesktopCaptureVideoPreview uriWrapper ",o.pii.Omit(r.file.name)),this.props.conversationId&&(C.default.postVideoWithThumbnail([this.props.conversationId],r,u.PostSource.CapturePreview,!0,t),l.setStatus(!0,this.props.transactionId),this._announceForAccessibilityForMessageSent())}else l.setStatus(!1,"Unable to capture thumbnail frame from captured video.");S.track(l)}))}this.props.closePanel(),this.props.onShareComplete&&this.props.onShareComplete()}_onCloseButtonPress(){this.setState({showConfirmCancelDialog:!0})}}t.default=F},646507:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BookmarksPanelHeader=void 0;const i=s(785893),o=s(516778),n=s(192758),r=s(746096),a=s(913944),l=s(110117),d=s(915877),c=s(733754),h=s(104735),u=s(330124),p=s(827357),g=s(311010),m=s(711828),S=s(24576),f=s(853374),y=(0,d.lazyProperties)({container:()=>o.Styles.createViewStyle({flexDirection:"row",flex:1}),titleContainer:()=>o.Styles.createViewStyle({flexDirection:"row",flex:1,alignContent:"center",alignItems:"center"}),mobileTitleContainer:()=>o.Styles.createViewStyle({justifyContent:"center"}),title:()=>o.Styles.createTextStyle({font:g.default.font.uiDisplayBold,fontSize:g.default.controlFontSize.headerSizeSmall,flexShrink:1,paddingLeft:10}),mobileTitle:()=>o.Styles.createTextStyle({fontSize:g.default.controlFontSize.panelHeader,paddingLeft:3}),closeButton:()=>o.Styles.createButtonStyle({marginRight:12}),mobileCloseButton:()=>o.Styles.createViewStyle({marginLeft:10,marginRight:0}),spacer:()=>o.Styles.createViewStyle({width:32}),splitViewStyle:()=>o.Styles.createViewStyle({paddingLeft:20})});class v extends S.default{constructor(){super(...arguments),this._onClose=()=>{const e=f.default.newGuid();o.Accessibility.announceForAccessibility(c.getString("BookmarksConversation.BookmarksClosedAnnouncementText")),this.state.isUsingStackNavigationContext?h.default.goBack(e,this._getContext()):this.state.lastVisitedConversationId&&!this.state.isLeftPanelHiddenOnDesktop?h.default.navigateToConversation({causeId:e,convId:this.state.lastVisitedConversationId,origin:r.NavigationConversationOrigin.Search}):h.default.navigateToWelcomeScreen(e)}}_buildState(e,t){return{isUsingStackNavigationContext:u.default.isUsingStackNavigationContext(),lastVisitedConversationId:n.default.getLastVisitedConversationId(),isLeftPanelHiddenOnDesktop:p.default.isDesktopSplitNavStackCollapsed()}}render(){const e=this._getCloseButton(),t=this._getTitleElement(),s=(0,i.jsx)(o.View,{style:y.spacer});return this.state.isUsingStackNavigationContext?(0,i.jsxs)(o.View,Object.assign({style:y.container},{children:[e,t,s]})):(0,i.jsxs)(o.View,Object.assign({style:y.container},{children:[t,e]}))}_getTitleElement(){const e=[y.title,this._themeStyles.primaryTextColorStyle],t=[y.titleContainer];return this.state.isUsingStackNavigationContext&&(e.push(y.mobileTitle),t.push(y.mobileTitleContainer)),this.state.isLeftPanelHiddenOnDesktop&&t.push(y.splitViewStyle),(0,i.jsxs)(o.View,Object.assign({style:t},{children:[(0,i.jsx)(l.default,{icon:m.SkypeIcon.Bookmarked,size:this.state.isUsingStackNavigationContext?m.IconSize.size18:m.IconSize.size28,color:this._themeColors.primaryTextColor,importantForAccessibility:o.Types.ImportantForAccessibility.No}),(0,i.jsx)(o.Text,Object.assign({style:e},{children:c.getString("BookmarksConversation.BookmarksChatTitle")}))]}))}_getCloseButton(){const e=[y.closeButton];return this.state.isUsingStackNavigationContext&&e.push(y.mobileCloseButton),(0,i.jsx)(a.default,{icon:m.SkypeIcon.ClosePanel,size:this.state.isUsingStackNavigationContext?m.IconSize.size24:m.IconSize.size32,color:this._themeColors.primaryTextColor,hoverColor:this._themeColors.iconHoverColor,style:e,onPress:this._onClose,title:c.getString("BookmarksConversation.CloseButtonLabel"),autoFocus:!0})}}t.BookmarksPanelHeader=v,t.default=v},149748:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentPanelHeader=t.LandscapeButtonHeight=t.HeaderHeightModernizeChatSmallHeader=t.HeaderHeightMobileLandscape=t.PanelHeightMobileSmall=t.HeaderHeightMobile=t.HeaderHeightCompositeExtended=t.HeaderHeightCompositeBase=void 0;const i=s(785893),o=s(496486),n=s(583367),r=s(709133),a=s(516778),l=s(281878),d=s(705465),c=s(889391),h=s(646507),u=s(598925),p=s(480200),g=s(905531),m=s(581697),S=s(671830),f=s(297775),y=s(911009),v=s(898278),C=s(400984),_=s(320373),b=s(330963),T=s(389888),M=s(539549),I=s(546172),w=s(437490),P=s(952262),k=s(746096),A=s(913944),x=s(805581),R=s(436237),O=s(710400),L=s(915877),F=s(733754),B=s(866127),D=s(23422),E=s(46929),V=s(18078),N=s(104735),U=s(330124),j=s(827357),H=s(29130),z=s(451070),W=s(681115),G=s(284299),K=s(677914),q=s(71987),Q=s(170919),X=s(581760),$=s(711828),J=s(734528),Y=s(680837),Z=s(360305),ee=s(24576),te=s(16383),se=s(988523),ie=s(567977),oe=s(666526),ne=s(172758),re=s(853374),ae=s(667024),le=s(415963),de=s(879015),ce=s(846116),he=s(825577),ue=s(710056),pe=s(741660),ge=s(843511),me=s(845148),Se=s(640363),fe=s(994224);t.HeaderHeightCompositeBase=97,t.HeaderHeightCompositeExtended=88,t.HeaderHeightMobile=70,t.PanelHeightMobileSmall=60,t.HeaderHeightMobileLandscape=44,t.HeaderHeightModernizeChatSmallHeader=56;t.LandscapeButtonHeight=32;const ye=(0,L.lazyProperties)({contentPanelHeader:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",alignSelf:"stretch",justifyContent:"space-between",height:t.HeaderHeightMobile,overflow:"visible"}),contentPanelHeaderSmall:()=>a.Styles.createViewStyle({height:t.PanelHeightMobileSmall}),contentPanelGuestHeader:()=>a.Styles.createViewStyle({paddingLeft:16}),contentPanelHeaderLandscape:()=>a.Styles.createViewStyle({height:t.HeaderHeightMobileLandscape}),backButton:()=>a.Styles.createButtonStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:X.Color.transparent}),modernHeaderBackButton:()=>a.Styles.createButtonStyle({paddingLeft:0,paddingRight:0}),backButtonLandscapeNormalView:()=>a.Styles.createButtonStyle({height:52,paddingLeft:16,paddingRight:16}),backButtonModernizeSmallHeader:()=>a.Styles.createButtonStyle({height:t.HeaderHeightModernizeChatSmallHeader,paddingLeft:18,paddingRight:18}),headerControlsContainer:()=>a.Styles.createButtonStyle({flex:-1,alignSelf:"stretch",alignItems:"center",flexDirection:"row"}),headerButtonContainer:()=>a.Styles.createViewStyle({flex:1,overflow:"hidden",height:$.IconSize.default}),headerButtonInnerContainer:()=>a.Styles.createViewStyle({alignItems:"stretch",justifyContent:"center"}),headerButtonContainerLandscape:()=>a.Styles.createViewStyle({height:t.LandscapeButtonHeight}),leftControls:()=>a.Styles.createViewStyle({width:56,flexDirection:"row"}),userIconWrapper:()=>a.Styles.createButtonStyle({paddingRight:12}),tablet:()=>(0,L.lazyProperties)({contentPanelHeader:()=>a.Styles.createViewStyle({paddingLeft:20,paddingRight:5}),contentPanelHeaderAndroid:()=>a.Styles.createViewStyle({height:t.PanelHeightMobileSmall+1}),contentPanelHeaderWithIcon:()=>a.Styles.createViewStyle({paddingLeft:10}),headerButtonInnerContainer:()=>a.Styles.createViewStyle({alignSelf:"flex-start",overflow:"visible",height:$.IconSize.default}),conversationSwitcherIPad:()=>a.Styles.createViewStyle({height:Q.SearchInputHeight.iOS}),conversationSwitcher:()=>a.Styles.createViewStyle({marginTop:-1})}),compositeNav:()=>(0,L.lazyProperties)({contentPanelHeader:()=>a.Styles.createViewStyle({paddingLeft:20,paddingRight:15,height:t.HeaderHeightCompositeBase}),contentPanelHeaderWithBackButton:()=>a.Styles.createViewStyle({paddingLeft:0}),contentPanelHeaderExperimental:()=>a.Styles.createViewStyle({height:t.HeaderHeightCompositeExtended}),headerButton:()=>a.Styles.createButtonStyle({alignSelf:"center",marginRight:10})}),modernizeSmallHeader:()=>(0,L.lazyProperties)({contentPanelHeader:()=>a.Styles.createViewStyle({paddingLeft:20,paddingRight:20}),contentPanelModernizedHeader:()=>a.Styles.createViewStyle({height:t.HeaderHeightModernizeChatSmallHeader}),smallPaddingControl:()=>a.Styles.createViewStyle({paddingRight:12}),headerButton:()=>a.Styles.createButtonStyle({alignSelf:"center",marginRight:10}),userIconWrapper:()=>a.Styles.createButtonStyle({paddingRight:12})})});class ve extends ee.default{constructor(){super(...arguments),this._onContentPanelHeaderContainerRef=e=>{this._contentPanelHeaderContainerRef=e||void 0},this._anchorNavigateToDetailsPanel=()=>{const e=re.default.newCauseId();R.log(k.LogTraceArea.Navigation,"ContentPanelHeader._anchorNavigateToDetailsPanel, causeId: "+e),this._intNavigateToDetailsPanel(e)},this._navigateToDetailsPanel=e=>{e&&e.stopPropagation();const t=re.default.newCauseId();R.log(k.LogTraceArea.Navigation,"ContentPanelHeader._navigateToDetailsPanel, causeId: "+t),this._intNavigateToDetailsPanel(t)},this._onOpenMainWindowClick=()=>{const e=re.default.newCauseId();R.log(k.LogTraceArea.Navigation,"ContentPanelHeader._openMainWindow, causeId: "+e);const t=this._getRootViewId();t!==v.MainRootViewId&&N.default.openMainWindow(!0,t,e)},this._onBackButtonClick=e=>{e.stopPropagation(),O.default.immediatelyResetUpdateInfo();const t=re.default.newCauseId();ae.default.createTrackerAndMarkPressTime(t,le.ScenarioName.ResponsivenessGoBackFromConversation,e),R.log(k.LogTraceArea.Navigation,"ContentPanelHeader._handleBackButtonClick, causeId: "+t),this.props.activeCallStatus===p.ActiveCallStatus.Connected&&Se.default.isEdgeShoreline()&&this.props.activeCallId?fe.default.CallNavigationHelper.answerOrJoinCall({conversationMri:this.state.conversationOwnerMri,callId:this.props.activeCallId,knownToBeAnswer:!0,withVideo:!1,autoAnswer:!0,origin:k.NavigationCallOrigin.ConversationHeader},t):(N.default.goBack(t,this._getContext()),ae.default.markActionDoneAndRemoveTracker(t))}}_buildState(e,t){const s=this._getRootViewId(),{enableGroupedConversations:i,enableMagicSkypeLogo:o,enableMagicPreviewLogo:r,enableMagicBotToolbox:l}=c.default.getS4LMessagingFeatures(),{enableMessageTranslation:d,enableTranslatorBotDeprecation:h,translatorBotDeprecationDate:p,translatorAgentId:m}=c.default.getS4LCMCFeatures(),f=(0,M.default)().getConversation(e.conversationId),y=U.default.isUsingStackNavigationContext(),_=S.isEncryptedThread(e.conversationId),b=Z.default.isTabletUI(),T=b?n.DeviceOrientation.Portrait:H.default.getDeviceOrientation(s),w=T===n.DeviceOrientation.Landscape,k=y||b||H.default.isTinyScreenSizeNoSubscription(s),A=f&&f.isEncryptedThread()?f.getOtherPartyMriOrConvId():e.conversationId,R=ne.default.getConversationOwner(A),O=C.default.isConversationAccepted(R),L=f&&f.isOneOnOne()&&(S.isMriWithUserMetadata(R)||e.otherPartyMri&&S.isMriWithUserMetadata(e.otherPartyMri))&&(O||e.otherPartyMri&&S.isS4BBridgeMri(e.otherPartyMri)),F=S.isPhoneMri(e.conversationId)&&S.isOneOnOneConversation(e.conversationId),D=V.default.isGuestUser(),E=S.isGalleryInConversationSupported(e.conversationId)&&(L&&!S.isS4BBridgeMri(e.conversationId)||!e.otherPartyMri),N=!e.hideBackButton&&!D&&(this._getContext().isPresentedByMobileStackNavigator||this._getRootViewType()===v.RootViewType.SplitViewContent||I.default.collapseDesktopStackNavContext()&&j.default.isDesktopSplitNavStackCollapsed());return Object.assign(Object.assign({conversationOwnerMri:R,conversationName:f?P.default.getDisplayName(f.id):"",isMinDesktopWidth:H.default.isMinDesktopWidth(s),uiOrientation:T,leavePaddingForStatusBar:a.StatusBar.isOverlay()&&(T===n.DeviceOrientation.Portrait||!y),statusBarHeight:z.default.statusBarHeight(),useMobileUI:k,showConversationIcon:b&&!N,useTabletUI:b,isEncryptedThread:_,isGalleryEnabled:E,shouldShowUserPresence:L,shouldShowCallRate:F,showBackButton:N,showConversationSwitcher:i,hideBotCoachMarks:S.getMriNamespace(e.conversationId)===S.Namespaces.Bot,isGuestUser:D,isLandscape:w},ve._getScheduledCallState(e.conversationId,w,k)),{isTranslationFeatureEnabled:d,isTranslatorBotDeprecationEnabled:h,translatorBotDeprecationDate:p,canAccessConversationDetails:g.default.navigation().canAccessConversationDetails,translationState:x.default.getConversationTranslationState(e.conversationId)||u.TranslationState.Disabled,isThreadWithTranslatorBot:f&&f.hasSpecificAgentMember(m)&&f.getMemberMrisWithoutMe().length>1,isModernizeChatHeaderMobile:B.default.modernizeChatHeaderMobileVersion(),isMagicBot:(0,ce.isMagicBotConversation)(e.conversationId),isNewsChannel:(0,pe.isContentChannel)(f),isMyBot:S.isMyBotConversation(e.conversationId),shouldShowSkypeLogo:o&&(0,ce.isMagicBotContainingConversation)(f)&&(null==f?void 0:f.isGroupConversation())&&!b,enableMagicSkypeLogo:o,enableMagicPreviewLogo:r,enableMagicBotToolbox:l})}componentDidMount(){super.componentDidMount(),this._newConversationSetup(),this._contentPanelHeaderContainerRef&&this._contentPanelHeaderContainerRef.setFocusLimited(!!this.props.preventAccessibilityFocus)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.conversationId!==this.props.conversationId&&(this._oldConversationCleanup(),this._newConversationSetup()),this.props.preventAccessibilityFocus!==e.preventAccessibilityFocus&&this._contentPanelHeaderContainerRef&&this._contentPanelHeaderContainerRef.setFocusLimited(!!this.props.preventAccessibilityFocus)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s)}componentWillUnmount(){super.componentWillUnmount(),this._oldConversationCleanup()}_oldConversationCleanup(){this._finishedSyncingSubscriptionToken&&(this._finishedSyncingSubscriptionToken.unsubscribe(),this._finishedSyncingSubscriptionToken=void 0)}_newConversationSetup(){m.default.forceThreadDetailsFetchIfNeeded(this.props.conversationId),this._finishedSyncingSubscriptionToken=m.default.finishedSyncingConversation.subscribe((e=>{e===this.props.conversationId&&m.default.forceThreadDetailsFetchIfNeeded(this.props.conversationId)}))}_getLeftIcon(e=!1){let t,s,o,n,r=[ye.backButton];const a=this._themeColors.iconPrimary,l=this._themeColors.iconPrimary;return this.state.isModernizeChatHeaderMobile?e?(r=[...r,ye.backButtonModernizeSmallHeader],n=$.IconSize.size20):(r=[...r,ye.backButtonLandscapeNormalView],n=$.IconSize.size24):(r=[...r,ye.backButtonModernizeSmallHeader],n=$.IconSize.size16),this._getRootViewType()===v.RootViewType.SplitViewContent?(t=$.SkypeIcon.Menu,s=F.getString("CallPanel.OpenRecentsButtonTitle"),o=this._onOpenMainWindowClick):(t=this.props.contextConversationId?J.closeIcon():J.backIcon(),s=F.getString("Global.BackButtonTitle"),o=this._onBackButtonClick),(this.state.isNewsChannel||this.state.isMagicBot||this.state.isMyBot)&&(r=[...r,ye.modernHeaderBackButton]),(0,i.jsx)(A.default,{style:r,size:n,onPress:o,color:a,hoverColor:l,icon:t,title:s})}_getLeftControls(e){return(0,i.jsx)(a.View,{children:this._getLeftIcon(e)},"leftcontrols")}_getHeaderStyles(e){const s=[ye.contentPanelHeader,this.props.style,this._themeStyles.messageStreamBackgroundColorStyle,a.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1)];if(this.state.useMobileUI)this.state.useTabletUI?(s.push(ye.tablet.contentPanelHeader),this.state.showConversationIcon&&s.push(ye.tablet.contentPanelHeaderWithIcon)):(this.state.isGuestUser||this.props.hideBackButton)&&s.push(ye.contentPanelGuestHeader),e?s.push(ye.contentPanelHeaderLandscape):s.push(ye.contentPanelHeaderSmall),s.push(ye.modernizeSmallHeader.smallPaddingControl),this.state.leavePaddingForStatusBar&&this.state.statusBarHeight&&s.push(W.default.marginTopStyle(this.state.statusBarHeight)),this.props.safeAreaHorizontalInsets&&W.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&s.push(W.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets));else{s.push([ye.modernizeSmallHeader.contentPanelHeader,this.state.showBackButton?ye.compositeNav.contentPanelHeaderWithBackButton:void 0]),s.push(ye.compositeNav.contentPanelHeaderExperimental);let e=0;this.state.leavePaddingForStatusBar&&this.state.statusBarHeight&&(e+=this.state.statusBarHeight,s.push(W.default.heightStyle(t.HeaderHeightCompositeExtended+this.state.statusBarHeight))),this.state.useTabletUI&&(e+=10),e&&s.push(W.default.paddingTopStyle(e)),this.props.safeAreaHorizontalInsets&&W.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&s.push(W.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets))}return s.push(ye.modernizeSmallHeader.contentPanelModernizedHeader),{headerStyles:s,headerWrapperStyle:[]}}_getChatIcon(){const e=this.state.canAccessConversationDetails;return(0,i.jsx)(a.Button,Object.assign({style:ye.modernizeSmallHeader.userIconWrapper,onPress:e?this._navigateToDetailsPanel:void 0,importantForAccessibility:a.Types.ImportantForAccessibility.NoHideDescendants,accessibilityLabel:F.getString("MyProfilePanel.UserAvatarAccessibilityLabel",{user:this.state.conversationName})},{children:(0,i.jsx)(oe.default,{mri:this.props.otherPartyMri||this.props.conversationId,isOneOnOne:!!this.props.otherPartyMri,size:ie.AvatarIconSize.Size40,showStatus:!1,statusBorderColor:this._themeColors.primaryBackgroundColor})}),"leftcontrols-chaticon")}_getControlsContent(e,t){let s;const n=this._getChatIcon();if(this.state.useMobileUI){const r=[ye.headerButtonContainer];t&&r.push(ye.headerButtonContainerLandscape);const l=[ye.headerButtonInnerContainer];this.state.useTabletUI?l.push(ye.tablet.headerButtonInnerContainer):l.push(...r);const d=t,c=this.state.canAccessConversationDetails,h=(0,i.jsx)(a.View,Object.assign({style:r},{children:(0,i.jsx)(a.View,Object.assign({style:l},{children:(0,i.jsx)(D.default,{conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,colorThemeOverride:this._currentTheme,hideSecondRow:d,deviceOrientation:this.state.uiOrientation,shouldShowUserPresence:this.state.shouldShowUserPresence,shouldShowCallRate:this.state.shouldShowCallRate,hidePresenceIndicator:this.state.showConversationIcon,onTitlePress:c?this._navigateToDetailsPanel:void 0,conversationOwnerMri:this.state.conversationOwnerMri,isModernizeSmallHeaderMobile:this.state.isModernizeChatHeaderMobile})}))}),"centercontrols");s=(0,o.compact)([e,n,h])}else s=(0,i.jsxs)(a.View,Object.assign({style:ye.headerControlsContainer},{children:[e,n,this.state.hideBotCoachMarks?this._renderPanelHeader():this._renderCoachMarkPanelHeader()]}),"controlscontent");return s}_renderOptionalGroupSwitcher(){return this._shouldRenderTabSwitcher()&&this.props.otherPartyMri?(0,i.jsx)(T.default,{style:this.state.useTabletUI?ye.tablet.conversationSwitcher:void 0,heightStyle:void 0,mri:this.props.otherPartyMri,currentConversationId:this.props.conversationId,safeAreaHorizontalInsets:this.props.safeAreaHorizontalInsets,preventAccessibilityFocus:this.props.preventAccessibilityFocus}):void 0}_renderOptionalScheduledCallBanner(){return this.state.scheduledCall&&this.state.shouldRenderScheduledCallBanner?(0,i.jsx)(G.default.ScheduledCallConversationBanner,{scheduledCall:this.state.scheduledCall}):void 0}_renderOptionalTranslationBanner(){return this.state.isTranslationFeatureEnabled&&this.state.translationState!==u.TranslationState.Disabled?(0,i.jsx)(te.default,{conversationId:this.props.conversationId,conversationName:this.state.conversationName}):void 0}_renderOptionalDeprecationTranslationBanner(){return this.state.isTranslatorBotDeprecationEnabled&&this.state.isThreadWithTranslatorBot?(0,i.jsx)(te.default,{conversationId:this.props.conversationId,conversationName:this.state.conversationName,translatorBotDeprecationDate:this.state.translatorBotDeprecationDate,isDeprecated:!0}):void 0}_renderCallControlButtons(){const e=(0,i.jsx)(_.default,{conversationOwnerMri:this.state.conversationOwnerMri,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,activeCallId:this.props.activeCallId,activeCallStatus:this.props.activeCallStatus,hasActiveCall:this.props.hasActiveCall,onCallStartedAnsweredOrJoined:this.props.onCallStartedAnsweredOrJoined,preventAccessibilityFocus:this.props.preventAccessibilityFocus,localAddressBookPhones:this.props.localAddressBookPhones,isGalleryEnabled:this.state.isGalleryEnabled,isMessageSearchPanelEnabled:this.props.isMessageSearchPanelEnabled,onToggleMessageSearchPanel:this.props.onToggleMessageSearchPanel,onGalleryPressed:this.props.onGalleryPressed});return this.state.shouldShowSkypeLogo?(0,i.jsxs)(l.Row,Object.assign({alignItems:"center",space:"2"},{children:[e,(0,i.jsx)(ue.SkypeLogo,{size:$.IconSize.size24})]})):e}render(){if(!(!this.state.isNewsChannel&&!this.state.isMagicBot&&!this.state.isMyBot)){let e,t;return this.state.isMagicBot&&(e=(0,i.jsx)(de.MagicBotHeaderTitle,{conversationId:this.props.conversationId,onPress:this.state.canAccessConversationDetails?this._navigateToDetailsPanel:void 0},"title"),(this.state.enableMagicSkypeLogo||this.state.enableMagicPreviewLogo||this.state.enableMagicBotToolbox)&&(t=(0,i.jsx)(de.MagicBotConversationControls,{showPreviewText:this.state.enableMagicPreviewLogo,showToolboxButton:this.state.enableMagicBotToolbox,openToolboxByDefault:this.props.openMagicBotToolboxByDefault}))),this.state.isNewsChannel&&(e=(0,i.jsx)(he.NewsChannelHeaderTitle,{conversationId:this.props.conversationId},"title")),this.state.isMyBot&&(e=(0,i.jsx)(ge.MyBotHeaderTitle,{conversationId:this.props.conversationId,onPress:this.state.canAccessConversationDetails?this._navigateToDetailsPanel:void 0},"title"),t=(0,i.jsx)(me.MyBotConversationControls,{conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,hasActiveCall:this.props.hasActiveCall,isGalleryEnabled:!0,onGalleryPressed:this.props.onGalleryPressed})),(0,i.jsx)(d.SafeAreaView,{children:(0,i.jsx)(he.ConversationHeader,{CardControl:e,BackButton:this.state.showBackButton?this._getLeftControls(this.state.isLandscape):void 0,ConversationControls:t})})}const e=this.props.preventAccessibilityFocus?a.Types.ImportantForAccessibility.NoHideDescendants:void 0,t=this._getHeaderStyles(this.state.isLandscape),s=this.state.showBackButton?this._getLeftControls(this.state.isLandscape):void 0;if(S.isBookmarkConversation(this.props.conversationId)){const e=this.state.useMobileUI?void 0:this._themeStyles.secondaryBackgroundColorStyle;return(0,i.jsx)(a.View,Object.assign({style:[t.headerWrapperStyle,e]},{children:(0,i.jsx)(a.View,Object.assign({style:[t.headerStyles,e]},{children:(0,i.jsx)(h.BookmarksPanelHeader,{})}))}))}return(0,i.jsxs)(a.View,Object.assign({style:t.headerWrapperStyle,ref:this._onContentPanelHeaderContainerRef,onLayout:this.props.onLayout,limitFocusWithin:a.Types.LimitFocusType.Limited},{children:[(0,i.jsxs)(a.View,Object.assign({style:t.headerStyles,importantForAccessibility:e},{children:[this._getControlsContent(s,this.state.isLandscape),this._renderCallControlButtons()]})),this._renderOptionalGroupSwitcher(),this._renderOptionalScheduledCallBanner(),this._renderOptionalTranslationBanner(),this._renderOptionalDeprecationTranslationBanner()]}))}_renderCoachMarkPanelHeader(){let e=F.getString("ContentPanelHeader.ProfileButtonAccessibilityLabel",{conversationName:this.state.conversationName});this.state.isEncryptedThread&&(e+=","+F.getString("ContentPanelHeader.PrivateConversationLabel"));const t={coachMarkType:y.CoachMarkType.ChatProfile,onAnchorPress:this._anchorNavigateToDetailsPanel,anchorAccessibilityLabel:e},s=[ye.headerControlsContainer,ye.compositeNav.headerButton,Y.default.pointerCursor];return this.state.isMinDesktopWidth&&s.push(Y.default.flexOne),(0,i.jsx)(f.default.View,Object.assign({style:s,disableTouchOpacityAnimation:!0},t,{children:this._renderPanelHeader()}),"centercontrols")}_renderPanelHeader(){const e=this.state.canAccessConversationDetails;return(0,i.jsx)(a.View,Object.assign({style:Y.default.flexOne},{children:(0,i.jsx)(b.default,{onPress:e?this._navigateToDetailsPanel:void 0,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,useTabletUI:this.state.useTabletUI,shouldShowUserPresence:this.state.shouldShowUserPresence,shouldShowCallRate:this.state.shouldShowCallRate,hidePresenceIndicator:this.state.showConversationIcon,hideSecondRow:!1,preventAccessibilityFocus:!e||this.props.preventAccessibilityFocus,colorThemeOverride:this._currentTheme,onToggleMessageSearchPanel:this.props.onToggleMessageSearchPanel,onGalleryPressed:this.props.onGalleryPressed,isMessageSearchPanelEnabled:this.props.isMessageSearchPanelEnabled,conversationOwnerMri:this.state.conversationOwnerMri})}),"centercontrols")}_shouldRenderTabSwitcher(){return this.state.showConversationSwitcher&&!!this.props.otherPartyMri&&!this.props.hideConversationSwitcher}_intNavigateToDetailsPanel(e){R.log(k.LogTraceArea.Navigation,"ContentPanelHeader._intNavigateToDetailsPanel, causeId: "+e),r.default.isSupported()&&w.dismissAll(),se.userProfileViewed(this.props.conversationId),this.props.onOpenDropdown?this.props.onOpenDropdown():N.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:e})}static _getScheduledCallState(e,t,s){const i=K.default.getUpcomingScheduledCallsByConversationId(e);let o,n=!1;if(i){const e=E.default.getScheduledCallsBannerDismissStates()||{};o=i.find((i=>{const o=e[i.id];return n=q.default.shouldRenderScheduledCallBanner(t,s,K.ExpirationGracePeriodMs,i,o)}))}return{scheduledCall:o,shouldRenderScheduledCallBanner:n}}}t.ContentPanelHeader=ve,t.default=ve},320373:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shouldUseGradientBackgroundButton=t.ContentPanelHeaderButtons=t.LandscapeButtonHeight=t.HeaderHeightCompositeExtended=t.HeaderHeightCompositeBase=t.ButtonStatus=void 0;const i=s(785893),o=s(583367),n=s(967593),r=s(516778),a=s(496486),l=s(148540),d=s(1706),c=s(219784),h=s(889391),u=s(4736),p=s(994224),g=s(598925),m=s(37034),S=s(109520),f=s(480200),y=s(905531),v=s(671830),C=s(898278),_=s(225739),b=s(539549),T=s(557102),M=s(731761),I=s(437490),w=s(229565),P=s(341706),k=s(125793),A=s(759799),x=s(746096),R=s(211375),O=s(913944),L=s(436237),F=s(915877),B=s(733754),D=s(536699),E=s(164723),V=s(812462),N=s(844972),U=s(89808),j=s(178735),H=s(104735),z=s(330124),W=s(795691),G=s(29130),K=s(172425),q=s(210541),Q=s(22222),X=s(581760),$=s(640363),J=s(711828),Y=s(311010),Z=s(360305),ee=s(24576),te=s(988523),se=s(18078),ie=s(853374),oe=s(757139),ne=s(764245),re=s(948310);var ae;!function(e){e[e.Selected=0]="Selected",e[e.Unselected=1]="Unselected",e[e.Disabled=2]="Disabled"}(ae=t.ButtonStatus||(t.ButtonStatus={}));const le=J.IconSize.size40,de=J.IconSize.size24,ce="rightButton";t.HeaderHeightCompositeBase=97,t.HeaderHeightCompositeExtended=100,t.LandscapeButtonHeight=32;const he=(0,F.lazyProperties)({modernizeIconContainer:()=>r.Styles.createViewStyle({width:le,height:le,borderRadius:le/2}),controls:()=>r.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end"}),rightIconMargin:()=>r.Styles.createViewStyle({marginRight:8}),leftIconMargin:()=>r.Styles.createViewStyle({marginLeft:8}),leftIconMarginControl:()=>r.Styles.createViewStyle({marginLeft:4}),backgroundStyle:()=>({paddingLeft:15,paddingRight:20}),modernizedBackgroundStyle:()=>({paddingLeft:10,paddingRight:14}),modernizeMoreOptionsIconButton:()=>r.Styles.createViewStyle({width:J.IconSize.size20,marginLeft:8,marginRight:0}),compositeNav:()=>(0,F.lazyProperties)({controlsContainer:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),headerButtonHover:()=>r.Styles.createViewStyle({opacity:.8}),gradientViewStyle:()=>r.Styles.createViewStyle({borderRadius:le/2}),leftIconMargin:()=>r.Styles.createViewStyle({marginLeft:10})}),unsubscribeSubscribeButton:()=>r.Styles.createTextStyle({fontSize:Y.default.controlFontSize.smallButton,fontFamily:Y.default.fontFamily.uidDisplayRegular})});class ue extends ee.default{constructor(){super(...arguments),this._ignoreDisposingCallObserving=!1,this.handleFocusEvent=e=>(L.log(x.LogTraceArea.ContentPanel,"ContentPanelHeaderButton.handleFocusEvent: "+e),!(e!==R.FocusEvent.OpenGoLiveNotification||!this._joinButton)&&(this._joinButton.requestFocus(),!0)),this._onJoinButtonRef=e=>{this._joinButton=e||void 0},this._onMoreOptionsButtonPress=()=>{if(!this._moreOptionsButtonRef)return;const e=this._getRootViewId(),t=ie.default.newCauseId();oe.default.showWithContent({rootViewId:e,anchor:()=>this._moreOptionsButtonRef,content:(0,i.jsx)(ne.default,{onRowPress:()=>oe.default.close(e,t),descriptors:this._getExtendedChatControlsDescriptors()}),menuId:"more_options_header_menu",menuWidth:210,borderRadius:10,togglable:!0,onCloseMenu:()=>{oe.default.close(this._getRootViewId(),t)}},t)},this._onMoreOptionsButtonRef=e=>this._moreOptionsButtonRef=e||void 0,this._getAudioCallIcon=()=>this.state.multipleAudioCallOptionsAvailable?J.SkypeIcon.CallOptions:v.isPhoneMri(this.props.conversationId)?J.SkypeIcon.SkypeOut:J.SkypeIcon.CallStart,this._onJoinOrStartAudioCall=()=>this._onStartCall(!1),this._onStartVideoCall=()=>this._onStartCall(!0),this._onAddContact=()=>{if(I.dismissAll(),te.contactAdded(this.props.conversationId),this.props.otherPartyMri){const e=this.state.skypeUserOwnerMri?[this.state.skypeUserOwnerMri]:[this.props.otherPartyMri];new M.default({peopleType:this.state.enableMyBot?q.PeopleType.AllExcludingMyBot:q.PeopleType.All,filterPeopleType:q.FilterType.GroupCapable,navigationOrigin:x.NavigationConversationOrigin.HeaderButtonNewGroupWithUser,invitedUsersMris:e,wizardSteps:[W.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}else{new M.default({convId:v.asSkypeThreadIdMaybe(this.props.conversationId),navigationOrigin:x.NavigationConversationOrigin.HeaderButtonAddUserToGroup,peopleType:this.state.enableMyBot?q.PeopleType.AllExcludingMyBot:q.PeopleType.All,filterPeopleType:q.FilterType.GroupCapable,wizardSteps:[W.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}},this._onUnsubscribePress=()=>{c.default.showConfirmationAlert(B.getString("UserSettingsPanel.UnsubscribeEngagementBotTitle"),B.getString("UserSettingsPanel.UnsubscribeEngagementBotDescription"),B.getString("Global.Unsubscribe"),(()=>{w.default.archiveEngagementBot(this.props.conversationId,this._getRootViewId(),x.ArchiveConversationOrigin.ConversationHeader),j.default.setUserPreferencesLocal({enableInAppEngagementNotifications:!1,enablePushEngagementNotifications:!1})}),this._getRootViewId())},this._onSubscribePress=()=>{w.default.unarchiveEngagementBot(this.props.conversationId,z.default.isUsingStackNavigationContext(),this._getContext(),x.UnarchiveConversationOrigin.ConversationHeader),j.default.setUserPreferencesLocal({enableInAppEngagementNotifications:!0,enablePushEngagementNotifications:!0})},this._onStartCallPressed=()=>{L.log(x.LogTraceArea.JoinLink,"ContentPanelHeader._onStartCallPressed"),this.state.showTwinCam||D.default.beginTrackingJoinMeetNow(E.MeetNowOrigin.CallPanel),H.default.navigateToCallPreviewView({conversationMri:this.props.conversationId,callOrigin:x.NavigationCallOrigin.ConversationHeader,activeCallId:p.default.ActiveCallUIHelper.getActiveCallId(this.props.conversationId),isGoLive:!0})},this._onDontStartCall=()=>L.log(x.LogTraceArea.ContentPanel,"ContentPanelHeader call button disabled"),this._onCallButtonRef=e=>{this._callButton=e||void 0},this._getCallButtonRef=()=>this._callButton}_buildState(e){const t=(0,b.default)(),s=t.getConversation(e.conversationId),i=z.default.isUsingStackNavigationContext(),n=v.isEncryptedThread(e.conversationId),r=Z.default.isTabletUI(),a=r?o.DeviceOrientation.Portrait:G.default.getDeviceOrientation(this._getRootViewId()),l=!!e.activeCallId&&p.default.CallingStore.isCallIncoming(e.activeCallId),c=e.conversationOwnerMri&&v.isSkypeIdMri(e.conversationOwnerMri)?e.conversationOwnerMri:void 0,u=c&&T.ConversationUtils.hasMultipleAudioCallOptions(c),m=h.default.getS4LCMCFeatures(),S={isMinDesktopWidth:G.default.isSmallOrTinyScreenSize(this._getRootViewId()),uiOrientation:a,userColor:U.default.getPrimaryColor(),isUserBlocked:t.isConversationBlocked(s),isUserCreator:(null==s?void 0:s.creator())===se.default.getSkypeMri(),isBlockedPSTNMri:v.isBlockedPSTNMri(e.conversationId),isOutgoingVideoDisabled:p.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),showActiveCall:!l,useMobileUI:i,useTabletUI:r,isEncryptedThread:n,canInvitePeople:y.default.contacts().canInvitePeople,isCallIncoming:l,multipleAudioCallOptionsAvailable:u,enableJoinerCallPreview:m.enableJoinerCallPreview&&v.isGroupConversation(e.conversationId),hasActiveGoLive:!!s&&s.hasGoLive(),isPSTNGroup:T.ConversationUtils.isPSTNGroup(s),skypeUserOwnerMri:c,alwaysNavigateToLobby:null==s?void 0:s.isGroupConversation(),isGroupConversation:null==s?void 0:s.isGroupConversation(),isRegularMemberInModeratedGroup:s&&(0,N.isRegularMemberInModeratedGroup)(s),isConciergeBot:v.isConciergeBotMri(e.conversationId),enableInAppEngagementNotifications:!!j.default.getUserPreferencesLocal().enableInAppEngagementNotifications,enableObservingCall:m.enableObservingCall,callState:e.activeCallId?p.default.CallingStore.getCallState(e.activeCallId):void 0,showTwinCam:!!e.activeCallId&&(m.twinCamEnabled&&p.default.CallingStore.getConnectedEndpoints(e.activeCallId).length>0),enableMyBot:h.default.getS4LMessagingFeatures().enableMyBot},f=v.isAgent(e.conversationId);S.isCallingCapable=!!s&&(!f||!s||d.default.isCallingCapable(s.id));const C=S.useMobileUI||!c&&!!v.isPhoneMri(e.conversationId)||v.isS4BBridgeMri(e.conversationId);S.canAddParticipant=!C&&(!f||!s||d.default.isGroupCapable(s.id));const _=n&&P.default.getHandshakeState(e.conversationId)!==k.SecureHandshakeState.Completed,M=S.skypeUserOwnerMri?S.skypeUserOwnerMri:e.conversationId;return S.skypeUserOwnerMri?S.isOutgoingCallingDisabled=!p.default.CallNavigationHelper.isOutgoingCallingAllowed(M):S.isOutgoingCallingDisabled=_||!p.default.CallNavigationHelper.isOutgoingCallingAllowed(M),S.isCallingDisabled=!p.default.CallNavigationHelper.isCallingAllowed(M),S.isOutgoingCallingDisabled?(S.outgoingCallingDisabledReason=p.default.CallNavigationHelper.whyOutgoingCallingIsNotAllowed(M),!S.outgoingCallingDisabledReason&&_&&(S.outgoingCallingDisabledReason=g.CallValidationFailureReason.E2eeHandshakeIncomplete)):S.outgoingCallingDisabledReason=void 0,S.isCallingDisabled&&(S.callingDisabledReason=p.default.CallNavigationHelper.whyCallingIsNotAllowed(M)),S.noCameraFound=!p.default.DeviceStore.hasCameras(),S}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.isOutgoingCallingDisabled===t.isOutgoingCallingDisabled&&this.props.conversationId===e.conversationId||L.log(x.LogTraceArea.ContentPanel,"ContentPanelHeader calling changed to "+(this.state.isOutgoingCallingDisabled?"disabled ":"allowed")+(this.state.isOutgoingCallingDisabled?" reason: "+this.state.outgoingCallingDisabledReason:"")),this.state.noCameraFound!==t.noCameraFound&&L.log(x.LogTraceArea.Calling,"ContentPanelHeaderButtons: noCamerasFound changed to: "+this.state.noCameraFound)}componentDidMount(){super.componentDidMount();const e=ie.default.newCauseId();L.log(x.LogTraceArea.ContentPanel,"ContentPanelHeader calling "+(this.state.isOutgoingCallingDisabled?"disabled ":"allowed")+(this.state.isOutgoingCallingDisabled?" reason: "+this.state.outgoingCallingDisabledReason:"")+"causeId: "+e),L.log(x.LogTraceArea.Calling,"ContentPanelHeaderButtons: noCamerasFound: "+this.state.noCameraFound),this._joinButton&&R.register(R.FocusEvent.OpenGoLiveNotification,this),this.state.enableObservingCall&&this.props.activeCallId&&this.state.callState===l.CallState.None&&p.default.CallingStore.subscribeToCall(this.props.conversationId,this.props.activeCallId,x.NavigationCallOrigin.ConversationHeader,e).then((()=>{L.log(x.LogTraceArea.Calling,"ContentPanel: subscribed to call: "+this.props.activeCallId),this.isComponentMounted()||this.state.callState!==l.CallState.Observing||p.default.CallingStore.disposeObservingCalls(e)}))}componentWillUnmount(){super.componentWillUnmount();const e=ie.default.newCauseId();this.state.enableObservingCall&&this.props.activeCallId&&!this._ignoreDisposingCallObserving&&p.default.CallingStore.disposeObservingCalls(e),this._ignoreDisposingCallObserving=!1}_getAudioAndVideoCallStatus(){if(this.state.alwaysNavigateToLobby)return{audioCallStatus:ae.Selected,videoCallStatus:this.state.noCameraFound?ae.Disabled:ae.Selected};let e,t;return this.state.isCallIncoming||this.state.isOutgoingCallingDisabled?(e=ae.Disabled,t=ae.Disabled):this.props.hasActiveCall?(e=ae.Selected,t=this.state.noCameraFound?ae.Disabled:ae.Selected):(e=ae.Unselected,t=ae.Unselected),{audioCallStatus:e,videoCallStatus:t}}_getVideoCallButtonInfo(e){if((!this.props.hasActiveCall||this.props.hasActiveCall&&this.state.isCallIncoming)&&(!this.state.isOutgoingCallingDisabled||!this.state.useMobileUI)&&this.props.conversationId!==$.default.getEchoMri()&&(!v.isPhoneMri(this.props.conversationId)||this.state.skypeUserOwnerMri)&&(!this.state.isEncryptedThread||this.state.skypeUserOwnerMri)&&(!this.state.isPSTNGroup||this.state.skypeUserOwnerMri)&&!this.state.hasActiveGoLive){let t;t=this.state.isOutgoingCallingDisabled?_.default.callingDisabledTooltip(this.state.outgoingCallingDisabledReason):this.state.noCameraFound?B.getString("ContentPanelHeader.NoCameraVideoCallButtonTitle"):B.getString("ContentPanelHeader.VideoCallButtonTitle");const s=e!==ae.Disabled?this._onStartVideoCall:this._onDontStartCall;return{icon:J.SkypeIcon.Video,iconSize:this.state.useMobileUI?de:J.IconSize.size20,title:t,accessibilityLabel:t||B.getString("ContentPanelHeader.VideoCallButtonTitle"),onPress:s,status:e}}}_getJoinCallButtonInfo(){let e,t="callbutton";const s=this.state.alwaysNavigateToLobby||!this.state.isCallingDisabled?ae.Selected:ae.Disabled;switch(this.props.activeCallStatus){case f.ActiveCallStatus.Connected:e=B.getString("CallBanner.GoToCallMessage"),t+="_connected";break;case f.ActiveCallStatus.OnHold:e=B.getString("CallBanner.ResumeLiveCallMessage"),t+="_onhold";break;default:e=B.getString("CallBanner.JoinLiveCallMessage")}let i=e;s===ae.Disabled&&(i=_.default.callingDisabledTooltip(this.state.callingDisabledReason));const o=s!==ae.Disabled?this._onJoinOrStartAudioCall:this._onDontStartCall;return{key:t,title:i,accessibilityLabel:i||B.getString("ContentPanelHeader.CallButtonTitle"),onPress:o,ref:this._onJoinButtonRef,status:s,buttonStyle:C.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:X.AgnosticGradientFillButtonColors.green,gradientDirection:n.GradientDirection.BOTTOM_RIGHT,buttonText:e,iconSize:de,isWideButton:!0,iconHorizontalMargin:4,icon:V.default.getMeetNowIcon()}}_getAudioCallButtonInfo(e){let t=this.state.isEncryptedThread?B.getString("ContentPanelHeader.PrivateCallButtonTitle"):B.getString("ContentPanelHeader.CallButtonTitle");this.state.isOutgoingCallingDisabled&&(t=_.default.callingDisabledTooltip(this.state.outgoingCallingDisabledReason));const s=e!==ae.Disabled?this._onJoinOrStartAudioCall:this._onDontStartCall;return{key:"callbutton",title:t,accessibilityLabel:t||B.getString("ContentPanelHeader.CallButtonTitle"),onPress:s,ref:this._onCallButtonRef,icon:this._getAudioCallIcon(),iconSize:this.state.useMobileUI?de:J.IconSize.size20,accessibilityTraits:this.state.multipleAudioCallOptionsAvailable?[r.Types.AccessibilityTrait.Button,r.Types.AccessibilityTrait.HasPopup]:void 0,status:e}}_getMoreOptionsButtonInfo(){if(!this._shouldUnfoldExtendedControlButtons())return{ref:this._onMoreOptionsButtonRef,style:[he.modernizeMoreOptionsIconButton],title:B.getString("ContentPanelHeaderTitle.MoreOptionsButtonTitle"),icon:J.SkypeIcon.MoreVertical,onPress:this._onMoreOptionsButtonPress,color:X.Color.transparent,noBackgroundIcon:!0,iconSize:de}}_shouldShowJoinCallButton(){return this.props.hasActiveCall&&this.state.showActiveCall}_shouldShowStartCallButton(){return this.state.isGroupConversation&&!this.props.hasActiveCall}_getStartCallButtonInfo(){var e;let t=B.getString("MeetNow.StartCall"),s=ae.Unselected;return(this.state.isUserCreator&&this.state.isOutgoingCallingDisabled||this.state.isRegularMemberInModeratedGroup)&&(t=null!==(e=_.default.callingDisabledTooltip(this.state.outgoingCallingDisabledReason))&&void 0!==e?e:t,s=ae.Disabled),{title:t,status:s,icon:V.default.getMeetNowIcon(),buttonText:this._shouldUnfoldExtendedControlButtons()?B.getString("MeetNow.StartCall"):void 0,accessibilityLabel:B.getString("MeetNow.StartCall"),onPress:this._onStartCallPressed,iconSize:de,iconHorizontalMargin:4}}_getFindButton(){return{title:B.getString("ContentPanelHeaderTitle.FindButtonTitle"),icon:J.SkypeIcon.Search,onPress:this.props.onToggleMessageSearchPanel,color:X.Color.transparent,noBackgroundIcon:!0,iconSize:de}}_getGalleryButton(){return{title:B.getString("ContentPanelHeaderTitle.GalleryButtonTitle"),icon:J.SkypeIcon.Gallery1,onPress:this.props.onGalleryPressed,color:X.Color.transparent,noBackgroundIcon:!0,iconSize:de}}_getModernizedAddContactsButton(){if(!this.state.canAddParticipant||this.props.hideAddContactButton)return;const e=this.state.isUserBlocked||this.state.isBlockedPSTNMri?ae.Disabled:ae.Unselected,t=this.props.otherPartyMri?B.getString("SetConversationParticipantsPanel.CreateNewGroupTitle"):B.getString("SetConversationParticipantsPanel.AddPeopleTitle");return{title:this.state.isUserBlocked?void 0:t,icon:J.SkypeIcon.ContactAdd,onPress:this._onAddContact,color:X.Color.transparent,status:e,noBackgroundIcon:!0,iconSize:de}}_getUnsubscribeButton(){const e=ae.Unselected,t=this.state.enableInAppEngagementNotifications,s=t?B.getString("Global.Unsubscribe"):B.getString("Global.Subscribe"),i=t?J.SkypeIcon.MailOff:J.SkypeIcon.Mail,o=this.state.enableInAppEngagementNotifications?this._onUnsubscribePress:this._onSubscribePress;return{title:s,icon:i,buttonText:s,buttonTextStyle:[he.unsubscribeSubscribeButton,this._themeStyles.buttonTextColorStyle],onPress:o,color:X.Color.transparent,status:e,noBackgroundIcon:!0,iconSize:J.IconSize.size18,iconHorizontalMargin:4}}_getButtonDescriptors(){const e=this._getBarButtonInfo(),t=this._getExtendedChatControlsDescriptors();return[...this._shouldUnfoldExtendedControlButtons()?t:[],...e,!this.state.useMobileUI&&a.compact(t).length>0?this._getMoreOptionsButtonInfo():void 0]}_getBarButtonInfo(){const e=[];if(this.state.isConciergeBot)return[this._getUnsubscribeButton()];if(this.state.isCallingCapable)if(this._shouldShowStartCallButton())e.push(this._getStartCallButtonInfo());else{const t=this._getAudioAndVideoCallStatus();if(!this.state.isOutgoingVideoDisabled){const s=this._getVideoCallButtonInfo(t.videoCallStatus);s&&e.push(s)}const s=this._shouldShowJoinCallButton()?this._getJoinCallButtonInfo():this._getAudioCallButtonInfo(t.audioCallStatus);s&&e.push(s)}return e}_getExtendedChatControlsDescriptors(){const e=[this.props.isMessageSearchPanelEnabled?this._getFindButton():void 0,this.props.isGalleryEnabled?this._getGalleryButton():void 0];return this._showAddContactButton()&&e.push(this._getModernizedAddContactsButton()),e}_shouldUnfoldExtendedControlButtons(){return!this.state.useMobileUI&&!this.state.isMinDesktopWidth}_showAddContactButton(){return this.state.canInvitePeople&&!this.state.isRegularMemberInModeratedGroup}render(){const e=[he.controls],t=this.props.preventAccessibilityFocus?r.Types.ImportantForAccessibility.NoHideDescendants:void 0,s=this.props.preventAccessibilityFocus?-1:void 0,o=this._getButtonDescriptors(),n=null==o?void 0:o.reduce(((e,i,o)=>{if(!i)return e;i.color=this._adjustButtonColor(i);const{buttonStyle:n,textColor:r,hoverStyle:a}=this._getBarButtonStyles(i,0===o),l=this._renderBarButton(i,r,n,a,t,s,o);return l?(e.push(l),e):e}),[]);return(0,i.jsx)(r.View,Object.assign({style:this.state.useMobileUI?e:he.compositeNav.controlsContainer},{children:n}),"rightcontrols")}_getBarButtonStyles(e,t){return{buttonStyle:this._getModernizedButtonStyle(e,t),textColor:this._getTextColor(e),hoverStyle:this._getHoverStyle(e)}}_getModernizedButtonStyle(e,t){if(e.buttonText)return[t?he.leftIconMargin:he.leftIconMarginControl];const s=e.status===ae.Disabled,i=[he.modernizeIconContainer,e.noBackgroundIcon?he.rightIconMargin:he.leftIconMargin];return s&&i.push(r.Styles.createTextStyle({color:this._getContext().themeColors.iconDisabled},!1)),i}_getTextColor(e){return e.status===ae.Selected?this.state.useMobileUI?this.state.userColor:X.Color.white:e.status===ae.Disabled?this._themeColors.iconDisabled:this._themeColors.headerIconColor}_getHoverStyle(e){if(!this.state.useMobileUI)return e.color?he.compositeNav.headerButtonHover:this._themeStyles.buttonBackgroundHoverColorStyle}_renderBarButton(e,t,s,i,o,n,r){return e.buttonText?this._renderTextButton(e,t,s,r):e.icon?this._renderIconButton(e,t,s,i,o,n,r):void 0}_renderTextButton(e,t,s,o){const r=e.status===ae.Disabled,a=this._getButtonConfig(e.color,t,r),l=e.icon?he.modernizedBackgroundStyle:this.state.useMobileUI?void 0:he.backgroundStyle,d=[Y.default.fontStyle.body];let c=e.color||e.status===ae.Disabled?C.SXButtonStyle.Custom:C.SXButtonStyle.GradientFill;e.buttonStyle&&(c=e.buttonStyle);const h={style:s,disabled:r,buttonConfig:a,backgroundStyle:l,textStyleOverride:d,buttonStyle:c,textStyleDeprecated:e.buttonTextStyle,buttonSize:C.SXButtonSize.Medium,iconSize:e.iconSize,key:e.key||`${ce}${o}`,icon:e.icon,gradientDirection:e.gradientDirection||n.GradientDirection.BOTTOM_RIGHT,reverseGradientColor:!0,iconHorizontalMargin:e.iconHorizontalMargin,title:e.buttonText,hoverText:e.title,accessibilityLabel:e.accessibilityLabel||e.buttonText,accessibilityTraits:e.accessibilityTraits,allowTextWrap:!1,onPress:e.onPress,accessoryView:e.accessoryView,agnosticGradientColor:e.agnosticGradientColor};return(0,i.jsx)(Q.default,Object.assign({},h,{ref:e.ref}))}_renderIconButton(e,t,s,o,n,r,a){var l;const d={key:e.key||`${ce}${a}`,style:[...s,...e.style||[]],title:e.title,icon:e.icon,onPress:e.onPress,accessibilityLabel:e.accessibilityLabel,accessibilityTraits:e.accessibilityTraits,disabled:e.status===ae.Disabled,importantForAccessibility:n,tabIndex:r},c=d.disabled?t:this._themeColors.iconPrimary;return pe(!this.state.useMobileUI,e)?(0,i.jsx)(u.default,Object.assign({ref:e.ref},d,{iconSize:e.iconSize,size:u.ActionButtonSize.Small,reverseGradientColor:!0})):(0,i.jsx)(O.default,Object.assign({ref:e.ref},d,{hoverStyle:o,size:null!==(l=e.iconSize)&&void 0!==l?l:J.IconSize.size20,color:c,hoverColor:this._themeColors.iconPrimary,toolTip:e.title}))}_getButtonConfig(e,t,s){if(e)return e?{backgroundColor:e,textColor:this.state.isConciergeBot?this._themeColors.buttonTextColor:X.Color.white}:{backgroundColor:this._themeColors.buttonBackgroundColor,hoverBackgroundColor:s?void 0:this._themeColors.buttonBackgroundHoverColor,textColor:t}}_onStartCall(e){const t=ie.default.newCauseId();L.log(x.LogTraceArea.ContentPanel,"ContentPanelHeader._onStartCall("+e+") "+t);const s=()=>{te.callStarted(this.props.conversationId,e),this.state.isGroupConversation&&!this.state.showTwinCam&&D.default.beginTrackingJoinMeetNow(E.MeetNowOrigin.CallPanel),this.state.showTwinCam&&(re.default.beginTrackingTwinCam(x.NavigationCallOrigin.TwinCamJoin),re.default.trackJoinNavigationStarted(this.props.conversationId)),this.props.hasActiveCall&&this.props.activeCallStatus===f.ActiveCallStatus.Connected&&L.track(new S.FullChatUXTelemetryEvent(S.FullChatUXNavigation.Leave,this.props.conversationId,this.props.activeCallId||""));const s=x.NavigationCallOrigin.ConversationHeader;!K.default.shouldShowInterstitial(this.props.conversationId,e)||this.props.activeCallId?(this._ignoreDisposingCallObserving=!0,m.default.startCallOrMaybePrompt(this._getCallButtonRef,this._getRootViewId(),{skypeMri:this.state.skypeUserOwnerMri?this.state.skypeUserOwnerMri:this.props.conversationId,initiatingConversation:this.props.conversationId,onCallStartedAnsweredOrJoined:this.props.onCallStartedAnsweredOrJoined,userIntent:e?g.StartCallOrMaybePromptUserIntent.Video:g.StartCallOrMaybePromptUserIntent.Audio,phones:this.props.localAddressBookPhones,callOrigin:s,inviteOrigin:x.ContactInviteOrigin.ConversationHeader,showCallPreview:this.state.enableJoinerCallPreview,showTwinCam:this.state.showTwinCam},t,!1,this._getCallButtonRef)):K.default.maybeShowRinglessCallInterstitial(this.props.conversationId,e,s,t)};v.isPhoneMri(this.props.conversationId)&&A.default.shouldRequestAcknowledgementNoSubscription()?H.default.navigateToE911AcknowledgementPanel(t,this._getRootViewId(),s):s()}_adjustButtonColor(e){return e.status===ae.Disabled?X.Color.gray300:e.color}}function pe(e,t){return e&&!t.noBackgroundIcon&&t.status!==ae.Disabled}t.ContentPanelHeaderButtons=ue,t.default=ue,t.shouldUseGradientBackgroundButton=pe},407788:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentPanelHeaderDropdown=void 0;const i=s(785893),o=s(583367),n=s(516778),r=s(889391),a=s(462033),l=s(63413),d=s(476621),c=s(671830),h=s(496418),u=s(225739),p=s(731761),g=s(220076),m=s(746096),S=s(676242),f=s(791771),y=s(649770),v=s(139285),C=s(436237),_=s(861253),b=s(915877),T=s(733754),M=s(445026),I=s(104735),w=s(795691),P=s(932226),k=s(29130),A=s(210541),x=s(739182),R=s(615301),O=s(906262),L=s(149769),F=s(581760),B=s(711828),D=s(680837),E=s(172758),V=s(853374),N=s(73877),U=s(677381);var j;!function(e){e[e.Visible=0]="Visible",e[e.Hiding=1]="Hiding",e[e.Hidden=2]="Hidden"}(j||(j={}));const H=(0,b.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:F.Color.transparent}),content:()=>n.Styles.createViewStyle({minHeight:50,alignSelf:"stretch",borderBottomLeftRadius:3,borderBottomRightRadius:3,flexDirection:"row"}),contentStacked:()=>n.Styles.createViewStyle({flexDirection:"column"}),background:()=>n.Styles.createViewStyle({flex:1,backgroundColor:F.Color.blackOverlay50}),rowStyle:()=>n.Styles.createViewStyle({paddingLeft:20}),menuSection:()=>n.Styles.createViewStyle({flex:1,flexBasis:0}),stackedSection:()=>n.Styles.createViewStyle({alignSelf:"stretch"}),gallerySection:()=>n.Styles.createViewStyle({flex:1,flexBasis:0,marginRight:15}),stackedGallerySection:()=>n.Styles.createViewStyle({alignSelf:"stretch",paddingHorizontal:20}),galleryButtonHeader:()=>n.Styles.createViewStyle({height:60}),galleryStacked:()=>n.Styles.createViewStyle({marginBottom:15}),hiddenContent:()=>n.Styles.createViewStyle({opacity:0})});class z extends U.default{constructor(){super(...arguments),this._isDragging=!1,this._contentTransform=0,this._contentContainerTransformValue=new n.Animated.Value(-200),this._contentContainerTransformStyle=n.Styles.createAnimatedViewStyle({transform:[{translateY:this._contentContainerTransformValue}]}),this._backgroundOpacityValue=new n.Animated.Value(0),this._backgroundOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._backgroundOpacityValue}),this._onBackButtonPressed=()=>(this._dismiss(),!0),this._onLayoutChanged=e=>{const t={height:e.height,width:e.width};(0,_.default)(this.state.viewDimensions,t)||this.setState({viewDimensions:t})},this._dismiss=()=>{this.showOrHide()},this._onHasGalleryItems=e=>{this.isComponentMounted()&&this.state.hasGalleryItems!==e&&this.setState({hasGalleryItems:e})},this._onPanVertical=e=>{const t=e.pageY-e.initialPageY;let s=this._contentTransform+t;if(s>0&&(s=0),this._contentContainerTransformValue.setValue(s),this._isDragging||(this._isDragging=!0),e.isComplete){this._contentTransform+=t;const s=this.state.viewDimensions.height/2;let i=!1;i=!(e.velocityY<-.1)&&this._contentTransform>s,i?this._presentContent(!0):this.showOrHide()}},this._renderMenuItem=(e,t)=>{if(e===u.MenuItem.ShareLink)return(0,i.jsx)(y.default,{style:t||H.rowStyle,conversationId:this.props.conversationId,hideDivider:!0,origin:f.ShareGroupButtonOrigin.ConversationHeader},"item"+e);let s,o,n,r,a=!1;switch(e){case u.MenuItem.NewGroup:s=B.SkypeIcon.ContactGroupTwoPersonas;const t=this.state.firstName||this.state.displayName;o=t?T.getString("UserSettingsPanel.CreateNewGroupWithUser",{userName:t}):T.getString("SetConversationParticipantsPanel.CreateNewGroupTitle"),n=this._onCreateNewGroupWithUser;break;case u.MenuItem.PrivateConversation:s=B.SkypeIcon.PrivateChatFill,o=T.getString("DetailsPanelHeader.StartPrivateConversationButtonTitle"),n=this._onStartPrivateConversation;break;case u.MenuItem.SendSMS:s=B.SkypeIcon.MobileSmsNew,o=T.getString("SMSMessaging.ContactOptionsPopupSendSMSLabel"),n=this._onPressSMSMessageButton,r=this._onSmsButtonRef;break;case u.MenuItem.Settings:s=B.SkypeIcon.Info,o=T.getString("ConversationDropDown.SettingsTitle"),n=this._onNavigateToSettings;break;case u.MenuItem.Gallery:s=B.SkypeIcon.Gallery1,o=T.getString("GalleryPanel.DesktopPanelTitle"),n=this._onNavigateToGallery;break;case u.MenuItem.AddParticipants:s=B.SkypeIcon.ContactAdd,o=T.getString("GroupProfilePanel.AddToGroupTitle"),n=this._onNavigateToAddPeople,a=!this.state.isConnected;break;default:s=V.default.switchStatementExhaustiveChecking(e)}return(0,i.jsx)(x.default,{ref:r,style:t||H.rowStyle,icon:s,title:o,disabled:a,hideDivider:!0,onPress:n},"item"+e)},this._onCreateNewGroupWithUser=()=>{if(this._dismiss(),!this.props.otherPartyMri)return;new p.default({peopleType:A.PeopleType.All,filterPeopleType:A.FilterType.GroupCapable,invitedUsersMris:[this.props.otherPartyMri],navigationOrigin:m.NavigationConversationOrigin.UserProfileNewGroupWithUser,wizardSteps:[w.WizardSteps.setConvParticipants]}).start(this._getRootViewId())},this._onStartPrivateConversation=()=>{this._dismiss(),this.props.otherPartyMri&&g.createAndNavigateToPrivateConversation(this.props.otherPartyMri,m.E2EEInviteOrigin.UserProfile,this._getContext())},this._onPressSMSMessageButton=()=>{if(!this.props.otherPartyMri)return void this._dismiss();const e=V.default.newCauseId();C.log(m.LogTraceArea.Navigation,"UserProfileContent._onPressSMSMessageButton causeId: "+e),L.default.getPhoneNumberToNavigateTo(this.props.otherPartyMri,(()=>this._smsButtonRef),this._getRootViewId()).then((t=>{this._dismiss(),t&&this.props.otherPartyMri&&d.default.ensureConversationLoadedOrFaked(this.props.otherPartyMri).then((s=>{R.default.setFlowId(R.SmsFlowId.UserProfile),R.default.setNextFlowId(R.SmsFlowId.UserProfile),I.default.navigateToConversation({convId:this.props.otherPartyMri,origin:m.NavigationConversationOrigin.UserProfile,isNewConversation:s,causeId:e,selectedNumberForSMS:t})}))})).catch((()=>{}))},this._onNavigateToSettings=()=>{this._dismiss();const e=V.default.newCauseId();C.log(m.LogTraceArea.Navigation,"ContentPanelHeaderDropDown._onNavigateToSettings, causeId: "+e),I.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:e})},this._onNavigateToGallery=()=>{this._dismiss(),I.default.toggleGallery(this.props.conversationId,this._getContext())},this._onSmsButtonRef=e=>{this._smsButtonRef=e||void 0},this._onNavigateToAddPeople=()=>{if(this.state.isConnected){this._dismiss();new p.default({convId:this.props.conversationId,peopleType:A.PeopleType.AllExcludingBots,filterPeopleType:A.FilterType.GroupCapable,navigationOrigin:m.NavigationConversationOrigin.GroupProfile,wizardSteps:[w.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}}}_buildState(e,t){var s;const i=r.default.getS4LCMCFeatures(),o=e.otherPartyMri?E.default.getFullUserProfileByMri(e.otherPartyMri):void 0,n=this._getRootViewId(),a=O.default.isPaidUser(),d=c.isEncryptedThread(e.conversationId),h=e.otherPartyMri&&(l.default.isMriBlocked(e.otherPartyMri)||c.isBlockedPSTNMri(e.otherPartyMri)),p=void 0!==i.translatorAgentId&&l.default.isMriBlocked(i.translatorAgentId),g={deviceOrientation:k.default.getDeviceOrientation(n),displayName:null===(s=null==o?void 0:o.getDisplayName)||void 0===s?void 0:s.call(o),firstName:null==o?void 0:o.firstName,isConnected:P.default.isConnected()};if(t){g.shouldRenderContent=!1,g.visibility=j.Hidden;const e=N.default.measureWindow(this._getRootViewId());g.viewDimensions={height:200,width:e.width},g.hasGalleryItems=!1}return g.menuItems=u.default.getMenuItems({isMriBlocked:h,isEncryptedThread:d,hasTranslatorAgentId:!!i.translatorAgentId,isTranslatorMriBlocked:p,canShowSmsEntryPoint:a,otherPartyMri:e.otherPartyMri}),g}showOrHide(e){if(this.isComponentMounted()){let t;this.state.visibility===j.Visible?(t=j.Hiding,h.default.setCoachMarkEnabled(!0)):(t=j.Visible,h.default.setCoachMarkEnabled(!1),this._contentContainerTransformValue.setValue(-1*this.state.viewDimensions.height));const s=this.state.shouldRenderContent||t===j.Visible;this.setState({shouldRenderContent:s,visibility:t},e)}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.visibility!==t.visibility&&(this.state.visibility===j.Hiding?(this._dismissContent(!0),a.default.unsubscribe(this._onBackButtonPressed)):this.state.visibility===j.Visible&&(this._presentContent(!0),a.default.subscribe(this._onBackButtonPressed)))}_presentContent(e){this._expandOrCollapse(!0,e)}_dismissContent(e){this._expandOrCollapse(!1,e,(()=>{this.isComponentMounted()&&this.state.visibility===j.Hiding&&this.setState({visibility:j.Hidden})}))}_expandOrCollapse(e,t=!0,s){if(0===this.state.viewDimensions.height)return;const i=e?0:-1*this.state.viewDimensions.height,o=e?1:0,r=()=>{s&&s(),this._isDragging=!1};if(this._animation&&(this._animation.stop(),this._animation=void 0),t){const e=200;this._animation=n.Animated.parallel([M.default.timing(this._backgroundOpacityValue,{toValue:o,duration:e,easing:n.Animated.Easing.Out(),useNativeDriver:!0}),M.default.timing(this._contentContainerTransformValue,{toValue:i,duration:e,easing:n.Animated.Easing.Out(),useNativeDriver:!0})]),this._animation.start(r)}else this._backgroundOpacityValue.setValue(o),this._contentContainerTransformValue.setValue(i),r();this._contentTransform=i}render(){if(!this.state.shouldRenderContent)return null;const e=this.state.visibility===j.Hidden,t=[H.content,this._getContext().themeStyles.primaryBackgroundColorStyle],s=this.state.deviceOrientation===o.DeviceOrientation.Portrait;s&&t.push(H.contentStacked);const r=(0,i.jsx)(n.GestureView,Object.assign({onPanVertical:this._onPanVertical,panPixelThreshold:20,releaseOnRequest:!1,importantForAccessibility:n.Types.ImportantForAccessibility.No},{children:(0,i.jsxs)(n.View,Object.assign({style:t,onLayout:this._onLayoutChanged},{children:[(0,i.jsx)(n.View,Object.assign({style:s?H.stackedSection:H.menuSection},{children:this.state.menuItems.map((e=>this._renderMenuItem(e)))})),(0,i.jsxs)(n.View,Object.assign({style:s?H.stackedGallerySection:H.gallerySection},{children:[this.state.hasGalleryItems?this._renderMenuItem(u.MenuItem.Gallery,H.galleryButtonHeader):void 0,(0,i.jsx)(S.default,{style:H.galleryStacked,conversationId:this.props.conversationId,usePortraitLayout:!0,useRoundedCorners:!0,hideWhenEmpty:!0,onItemPress:this._dismiss,onHasItems:this._onHasGalleryItems})]}))]}))})),a=[D.default.absoluteFill,this._contentContainerTransformStyle],l=[H.container];e&&l.push(H.hiddenContent);const d=e?void 0:(0,i.jsx)(v.default,Object.assign({style:D.default.absoluteFill,onPress:this._dismiss,disableTouchOpacityAnimation:!0},{children:(0,i.jsx)(n.Animated.View,{style:[H.background,this._backgroundOpacityStyle]})}));return(0,i.jsxs)(n.Animated.View,Object.assign({style:l,importantForAccessibility:e?n.Types.ImportantForAccessibility.NoHideDescendants:n.Types.ImportantForAccessibility.No,blockPointerEvents:e},{children:[d,(0,i.jsx)(n.Animated.View,Object.assign({style:a,ignorePointerEvents:!0},{children:r}))]}))}}t.ContentPanelHeaderDropdown=z,t.default=z},764245:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(516778),o=s(144228),n=s(153211),r=(0,s(915877).lazyProperties)({rowStyle:()=>i.Styles.createViewStyle({minHeight:44})});class a extends o.default{_buildRows(e){const{descriptors:t,onRowPress:s}=e;return null==t?void 0:t.reduce(((e,t)=>{if(!t)return e;const{icon:i,iconSize:o,key:a,onPress:l,title:d}=t;return e.push({props:{key:a,icon:i,iconSize:o,titleText:d,onRowPress:()=>{null==l||l(),s()},style:[r.rowStyle],hideBorder:!0},builder:n.default.buildRow}),e}),[])}}t.default=a},330963:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(889391),a=s(994224),l=s(544279),d=s(47447),c=s(1706),h=s(671830),u=s(234196),p=s(225739),g=s(881632),m=s(703871),S=s(539549),f=s(986374),y=s(952262),v=s(770891),C=s(211375),_=s(136400),b=s(110117),T=s(805581),M=s(923944),I=s(861253),w=s(458666),P=s(915877),k=s(733754),A=s(853703),x=s(380622),R=s(827357),O=s(527683),L=s(654565),F=s(581760),B=s(311010),D=s(711828),E=s(496755),V=s(24576),N=s(912770),U=s(388117),j=s(721788),H=s(172758),z=(0,P.lazyProperties)({titleContainer:()=>n.Styles.createViewStyle({flex:1,paddingHorizontal:0,alignItems:"stretch",justifyContent:"center"}),headerContainer:()=>n.Styles.createViewStyle({flex:1,justifyContent:"center"}),firstRow:()=>n.Styles.createButtonStyle({justifyContent:"flex-start",flexDirection:"row"}),secondRow:()=>n.Styles.createViewStyle({flex:-1,justifyContent:"flex-start",flexDirection:"row"}),secondRowHeight:()=>n.Styles.createViewStyle({height:25}),secondRowDivider:()=>n.Styles.createViewStyle({marginLeft:7,marginRight:3}),secondRowDividerRN:()=>n.Styles.createViewStyle({marginHorizontal:0}),secondRowTextStyles:()=>n.Styles.createTextStyle({flex:-1,lineHeight:25,height:25}),conversationNameText:()=>n.Styles.createTextStyle({color:F.Color.black,font:B.default.font.uiDisplayBold,fontSize:B.default.controlFontSize.headerSizeSmall,flexShrink:1}),textTruncation:()=>n.Styles.createViewStyle({flexShrink:1}),userPresenceIndicator:()=>n.Styles.createViewStyle({width:8,height:8,borderRadius:4,marginRight:4,alignSelf:"center",bottom:0}),lockIcon:()=>n.Styles.createViewStyle({paddingRight:6,paddingTop:2}),conversationName:()=>n.Styles.createViewStyle({bottom:0,alignItems:"center",flexDirection:"row",flexShrink:1}),buttonIcon:()=>n.Styles.createTextStyle({minWidth:D.IconSize.size16,textAlign:"center",marginRight:3}),button:()=>n.Styles.createViewStyle({flexShrink:0,flexDirection:"row",alignItems:"center",paddingLeft:4,marginRight:7}),translatorButtonIcon:()=>n.Styles.createViewStyle({minWidth:D.IconSize.size16,marginRight:3}),translatorButton:()=>n.Styles.createViewStyle({flexShrink:0,flexDirection:"row",alignItems:"center",paddingLeft:4,marginRight:7}),noPaddingRightStyle:()=>n.Styles.createViewStyle({paddingRight:0}),manageGroupWrapper:()=>n.Styles.createViewStyle({height:20,width:23}),manageGroupIcon:()=>n.Styles.createTextStyle({paddingLeft:3,paddingTop:0,paddingRight:0,marginRight:0,lineHeight:20})});class W extends V.default{constructor(){super(...arguments),this.handleFocusEvent=e=>!(e!==C.FocusEvent.MessageSearchClosed||!this._findButtonRef)&&(this._findButtonRef.requestFocus(),!0),this._onFirstRowButtonPress=e=>{this.props.onPress&&this.props.onPress(e)},this._onTranslatorPress=e=>{e.stopPropagation(),this._onFirstRowButtonPress(e)}}_buildState(e,t){const s=(0,S.default)().getConversation(e.conversationId);let i=y.default.getDisplayName(e.conversationOwnerMri);const o=h.isAgent(e.conversationId);i&&s&&!s.isThread()&&!o&&O.default.isPossiblyPhoneNumber(i)&&O.default.isPossibleNumber(i)&&(i=O.default.parseAndFormat(i,O.PhoneNumberFormat.INTERNATIONAL)||i);const d=r.default.getS4LMessagingFeatures(),u={conversationName:i,isEncryptedThread:h.isEncryptedThread(e.conversationId),memberCount:s?Math.max(s.getMemberCount(),0):0,groupedConversationsEnabled:d.enableGroupedConversations,moodReact:void 0,moodRawText:void 0,callRateText:void 0,theme:void 0,isGalleryShowing:R.default.isGalleryShowing(),isOneOnOne:!!s&&s.isOneOnOne(),isTranslatedConversation:a.default.InCallBotUtils.isCallTranslatorBotTranslationEnabled(e.conversationId)&&T.default.isConversationTranslated(e.conversationId),translatorLocale:T.default.getLocalCallTranslatorBotSpokenLanguageLocale(),isTrustedAgent:o&&c.default.isTrustedAgent(e.conversationId)},p=e.conversationOwnerMri;if(e.shouldShowUserPresence&&p){const e=H.default.getFullUserProfileByMri(p);if(u.gender=e&&e.gender,u.userPresence=j.default.getCachedUserPresence(p),u.isUserActive=j.default.isActiveUser(p),e.mood){u.theme=this._currentTheme;const s=f.decodeFromContent(e.mood),i=g.toEntities(s,{supportEmoticons:!0});if(u.moodRawText=i?M.getRawText(i):void 0,u.moodLabel=x.getAccessibilityTitle(e.mood),t||!(0,I.default)(u.moodRawText,this.state.moodRawText)||u.theme!==this.state.theme){const e=this._themeColors,t=this._themeStyles,i=[this._getSecondLineStyle(t.secondaryTextColorStyle)];i.push(n.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1));const o={processing:{emoticons:v.ProcessingLevel.Full,quotes:v.ProcessingLevel.None,wikiMarkup:v.ProcessingLevel.Stripped,links:v.ProcessingLevel.Full,atMentions:v.ProcessingLevel.Stripped},renderMedia:!1,mediaPlaceholderIconColor:e.primaryTextColor,allowLargeEmoticons:!1,numberOfLines:1,textOverrideStyle:i,boldTextStyle:i,regularTextStyle:i,linkStyle:t.linkTextColorStyle};u.moodReact=(0,m.renderReact)(s,o).value}else u.moodReact=this.state.moodReact}}else e.shouldShowCallRate&&e.otherPartyMri&&(u.callRateText=l.default.getCallRateByMri(e.otherPartyMri));return u}componentDidMount(){super.componentDidMount(),this._updateLastSeenTextTimer=N.default.setInterval((()=>{this.state.userPresence&&this.state.userPresence.lastSeenAtUtc&&this.isComponentMounted()&&this.forceUpdate()}),6e4),C.register(C.FocusEvent.MessageSearchClosed,this),this._fetchUserPresence(this.props)}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t);this.props.conversationId!==e.conversationId&&this._fetchUserPresence(e)}componentWillUnmount(){super.componentWillUnmount(),o.isUndefined(this._updateLastSeenTextTimer)||N.default.clearInterval(this._updateLastSeenTextTimer),C.unregister(C.FocusEvent.MessageSearchClosed,this)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s)}_fetchUserPresence(e){const t=e.conversationOwnerMri;e.shouldShowUserPresence&&t&&L.default.forceFetchPresence(t)}_renderSecondRowText(e,t,s,o=this.props.onPress){const r=[this._getSecondLineStyle(this._themeStyles.secondaryTextColorStyle)];r.push(n.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1));const a=(0,i.jsx)(n.Text,Object.assign({style:r,numberOfLines:1},{children:e}),"secondRowText");return this._renderSecondRowItems(a,void 0,t,s,o)}_renderSecondRowItems(e,t,s,o,r=this.props.onPress){return(0,i.jsxs)(n.View,Object.assign({style:z.secondRow},{children:[(0,i.jsxs)(_.HoverableButton,Object.assign({onPress:r,style:z.secondRow,title:o,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants,tabIndex:-1,disableHoverOpacityStyles:!r,disableCursor:!r},{children:[t,e]})),this._renderTranslatorButton()]}))}_renderTranslatorButton(){if(this.state.isTranslatedConversation&&this.state.translatorLocale){const e=k.getString("ContentPanelHeaderTitle.TranslatedToTitle",{language:this._getLanguageTitle(this.state.translatorLocale)});return[this._renderDivider("translatorDivider"),(0,i.jsxs)(_.HoverableButton,Object.assign({onPress:this._onTranslatorPress,style:z.translatorButton,title:k.getString("ContentPanelHeaderTitle.TranslatorButtonTitle"),importantForAccessibility:n.Types.ImportantForAccessibility.Yes},{children:[(0,i.jsx)(b.default,{icon:D.SkypeIcon.SkypeTranslator,style:z.translatorButtonIcon,color:this._themeColors.secondaryTextColor,size:D.IconSize.size12}),(0,i.jsx)(n.Text,Object.assign({style:this._getSecondLineStyle(this._themeStyles.secondaryTextColorStyle),numberOfLines:1},{children:e}))]}),"translator-button")]}}_renderDivider(e){const t=this._getSecondLineStyle(this._themeStyles.secondaryTextColorStyle),s=d.UICapabilities.inlineTextFormattingSupported()?[z.secondRowDivider,t]:[z.secondRowDividerRN,t];return(0,i.jsx)(E.default,{style:s},e)}render(){const e=[B.default.fontStyle.messagingStreamChatHeader,z.textTruncation,this._themeStyles.headerTextColorStyle];e.push(n.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1));const t=this.props.preventAccessibilityFocus?n.Types.ImportantForAccessibility.NoHideDescendants:void 0,s=this.props.preventAccessibilityFocus?-1:void 0,o=this.state.isEncryptedThread&&!this.state.groupedConversationsEnabled?(0,i.jsx)(b.default,{icon:D.SkypeIcon.Lock,size:D.IconSize.size20,color:this._themeColors.headerTextColor,style:z.lockIcon},"lockIcon"):void 0,r=p.default.accessibilityLabel(this.state,!!this.props.hideSecondRow,!!this.props.shouldShowUserPresence,!!this.props.shouldShowCallRate),a=this.props.hideSecondRow?void 0:this._renderSecondRow(),l=this.state.isTrustedAgent?this._getOptionalCertifiedIcon():void 0,d=!this.state.isTrustedAgent&&this.props.onPress?this._getOptionalGroupManageIcon():void 0,c=(0,i.jsxs)(n.View,Object.assign({style:z.headerContainer},{children:[(0,i.jsx)(n.View,Object.assign({style:z.firstRow},{children:(0,i.jsx)(_.HoverableButton,Object.assign({onPress:this.props.onPress?this._onFirstRowButtonPress:void 0,title:this.state.conversationName,style:z.textTruncation,accessibilityLabel:r,importantForAccessibility:t,tabIndex:s,activeOpacity:this.props.activeOpacity,disableHoverOpacityStyles:!this.props.onPress,disableCursor:!this.props.onPress},{children:(0,i.jsxs)(n.View,Object.assign({style:z.conversationName},{children:[o,(0,i.jsx)(n.Text,Object.assign({style:e,numberOfLines:1,ellipsizeMode:"tail"},{children:this.state.conversationName?this.state.conversationName.split("\n",1):""})),l,d]}))}))})),a]}));return(0,i.jsx)(n.View,Object.assign({style:z.titleContainer},{children:c}))}_getOptionalCertifiedIcon(){return(0,i.jsx)(u.default,{botMri:this.props.conversationId})}_getOptionalGroupManageIcon(){const e=this._themeColors.iconPrimary,t=this._themeColors.iconPrimary;return(0,i.jsx)(n.View,Object.assign({style:z.manageGroupWrapper},{children:(0,i.jsx)(A.default,{iconColorOverride:e,onPress:this.props.onPress,accessibilityLabel:k.getString("CallPanel.ManageGroupAccessibilityLabel"),isCompact:!1,style:z.manageGroupIcon,iconSize:D.IconSize.size20,hoverColor:t,disableHoverOpacityStyles:!0},`manageGroupButton-${this.props.conversationId}`)}))}_renderSecondRow(){const e=[this._getSecondLineStyle(this._themeStyles.secondaryTextColorStyle)];e.push(n.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1));const t=h.isS4BBridgeMri(this.props.conversationId);if(this.props.shouldShowUserPresence&&!t){const t=h.getLastSeenPresenceText(this.state.userPresence,!1,this.state.gender,this.state.isUserActive);let s;const o=h.getHoverTitle(this.state.userPresence,this.state.gender);if(!this.props.hidePresenceIndicator&&this.state.userPresence&&this.state.userPresence.status&&(s=U.default.getPresenceIcon(p.default.getPresenceStatusForIcon(this.state.isUserActive,this.state.userPresence),z.userPresenceIndicator,D.IconSize.size8,void 0,o)),s||t||this.state.moodReact){const o=this.state.moodLabel?k.getString("ContentPanelHeaderTitle.MoodMessageWrapper",{moodMessage:this.state.moodLabel}):void 0,r=this.state.moodReact||(0,i.jsx)(n.Text,Object.assign({style:e,numberOfLines:1},{children:t}),"userPresenceText");return this._renderSecondRowItems(r,s,o,this.state.moodRawText||t)}}else{if(!this.props.otherPartyMri){const e=k.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:this.state.memberCount});return this._renderSecondRowText(e,e,e)}if(this.props.shouldShowCallRate)return(0,i.jsx)(n.Text,Object.assign({style:e},{children:this.state.callRateText}));if(t)return(0,i.jsx)(n.Text,Object.assign({style:e},{children:k.getString("ContentPanelHeaderTitle.TeamsInteropSubtitle")}))}}_getSecondLineStyle(e){return[B.default.fontStyle.messagingStreamChatSubHeader,e]}_getLanguageTitle(e){const t=w.getShortLanguageTitle(e);return o.isEmpty(t)?e:t}}t.default=W},389888:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(889391),a=s(77605),l=s(671830),d=s(475760),c=s(331751),h=s(962340),u=s(820770),p=s(539549),g=s(978118),m=s(557102),S=s(757139),f=s(746096),y=s(913944),v=s(436237),C=s(547126),_=s(915877),b=s(733754),T=s(717999),M=s(706250),I=s(734537),w=s(178735),P=s(104735),k=s(330124),A=s(29130),x=s(681115),R=s(126978),O=s(581760),L=s(711828),F=s(680837),B=s(360305),D=s(24576),E=s(912770),V=s(853374),N=(0,_.lazyProperties)({wrapper:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start"}),wrapperStackNav:()=>n.Styles.createViewStyle({paddingTop:10}),hiddenTabsDropdownButtonContainer:()=>n.Styles.createViewStyle({width:50,flexDirection:"row",alignItems:"center",justifyContent:"center",paddingBottom:8}),hiddenTabsDropdownBadge:()=>n.Styles.createViewStyle({marginLeft:6}),hiddenTabsDropdownWithCounterContainer:()=>n.Styles.createViewStyle({width:62}),desktopTabContainer:()=>n.Styles.createViewStyle({minWidth:148}),hiddenTabContainer:()=>n.Styles.createViewStyle({height:40,paddingVertical:10,justifyContent:"flex-start",borderBottomWidth:0})});class U extends D.default{constructor(){super(...arguments),this._mountedRefsMap=new M.default,this._overflowTelemetrySent=!1,this._visitedConversations=[],this._renderConversationTab=(e,t,s)=>{let o;const r=this.state.conversationIds&&this.state.conversationIds.length||0;this.state.counts&&this.state.counts[e]&&this.state.counts[e].unreadCount&&(o=this.state.counts[e].unreadCount);const a=[];let l,d;return this.state.isSmallScreen||a.push(N.desktopTabContainer),(this.state.isSmallScreen||this.state.enableConversationTabsDropdown&&this.state.tabsConfiguration.hiddenConversations.length)&&a.push(F.default.flexOne),s&&this.state.enableConversationTabsDropdown&&(l=this._themeStyles.rowHoverViewStyle,d=this._themeStyles.rowHoverViewStyle,a.push(F.default.flexOne,N.hiddenTabContainer),t<this.state.conversationIds.length-1&&a.push(n.Styles.createViewStyle({borderColor:this._themeColors.secondaryBackgroundColor,borderBottomWidth:1},!1))),(0,i.jsx)(h.default,{ref:this._mountedRefsMap.onComponentRef(e),convId:e,icon:m.ConversationUtils.getIconForConversationMri(e),tabPosition:t,totalTabs:r,tabContainerStyle:a,tabContainerHoverStyle:l,tabContainerSelectedStyle:d,selected:this.props.currentConversationId===e,focused:this.state.focusedConversationId===e,shouldUpdateOnFocus:this.state.hasFocus,badgeCount:o,onShowActionMenu:this._showActionMenu,onNavigateToConversation:this._navigateToConversation,preventAccessibilityFocus:this.props.preventAccessibilityFocus,hasMultipleSmsTabs:this._hasMultipleSmsTabs()},e)},this._onHiddenTabsDropdownButtonRef=e=>{this._hiddenTabsDropdownButtonRef=e||void 0},this._onHiddenTabsDropdownButtonPress=()=>{const e=V.default.newCauseId();v.log(f.LogTraceArea.Navigation,"ConversationGroupSwitcher._onHiddenTabsDropdownButtonPress isHiddenTabsDropdownVisible: "+this._isHiddenTabsDropdownVisible+" causeId: "+e),this._isHiddenTabsDropdownVisible?this._hideHiddenTabsDropdown(e):this._showHiddenTabsDropdown(this.state.tabsConfiguration.hiddenConversations,e)},this._navigateToConversation=e=>{const t=V.default.newCauseId();let s;v.log(f.LogTraceArea.Navigation,"ConversationGroupSwitcher._navigateToConversation, causeId: "+t),s=()=>{w.default.setLastOpenedTabForUser(this.props.mri,e),P.default.navigateToConversation({causeId:t,convId:e,shouldReplaceCurrentContext:!0,origin:f.NavigationConversationOrigin.TabSwitcher})},this.state.enableConversationTabsDropdown?this.setState({headTabId:e},s):s()},this._showActionMenu=(e,t)=>{g.default.open(e,t,(()=>this._mountedRefsMap.ref(t)),this._getContext())},this._onKeyPress=e=>{if(!this.isComponentMounted())return;const t=this.state.conversationIds;let s=o.findIndex(t,(e=>e===this.state.focusedConversationId));e.keyCode!==C.default.DOWN&&e.keyCode!==C.default.LEFT||(s-=1),e.keyCode!==C.default.UP&&e.keyCode!==C.default.RIGHT||(s+=1),s<0?s=t.length-1:s>=t.length&&(s=0),this.setState({focusedConversationId:t[s]})},this._onBlur=()=>{this._focusResetTimeout&&E.default.clearTimeout(this._focusResetTimeout),this._focusResetTimeout=E.default.setTimeout((()=>{this.isComponentMounted()&&this.state.focusedConversationId!==this.props.currentConversationId&&this.setState({hasFocus:!1,focusedConversationId:this.props.currentConversationId})}),250)},this._onFocus=()=>{this.isComponentMounted()&&!this.state.hasFocus&&this.setState({hasFocus:!0}),this._focusResetTimeout&&(E.default.clearTimeout(this._focusResetTimeout),this._focusResetTimeout=void 0)}}_buildState(e,t){const s=(0,p.default)().getConversation(e.currentConversationId),i=l.isOneOnOneConversation(e.mri)?c.default.getDisplayableConversationsForUser(e.currentConversationId):[],n=l.isOneOnOneConversation(e.mri)?c.default.getAllSiblingConversations(e.currentConversationId):[],a=r.default.getS4LMessagingFeaturesNoSubscription().enableConversationTabsDropdown;s&&!o.includes(this._visitedConversations,s)&&o.includes(n,s)&&!o.includes(i,s)&&this._visitedConversations.push(s);const h=u.default.getConversationsWithDraft(),g=o.intersection(h,n),S=o.intersection(this._visitedConversations,n);S.length||(this._visitedConversations=[]);const f=o.uniqBy(i.concat(S,g),"id"),y=m.ConversationUtils.getOrderedConversationIds(f,s),v=this._getRootViewId(),C=k.default.isUsingStackNavigationContext(),_=A.default.getWidth(v),b=e.currentConversationId,T=_<=750,M=T?0:R.default.getWidth(R.SideBar.Left),w={conversationIds:y,isSmallScreen:T,isStackNav:C,width:_,badgeColorStyle:I.default.getBadgeColorStyle(),focusedConversationId:b,enableConversationTabsDropdown:a,isSmallDevice:A.default.isSmallDevice(v)};return this._hasMultipleConversations(w)?w.counts=o.reduce(y,((e,t)=>(e[t]=d.default.getMessageCountsForConversation(t),e)),{}):w.counts=void 0,t&&(w.hasFocus=!1),a&&(w.tabsConfiguration=this._getTabsConfiguration(y,w.width||0,M)),w}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),this.state.enableConversationTabsDropdown&&this.state.tabsConfiguration.hiddenConversations.length!==t.tabsConfiguration.hiddenConversations.length){const e=V.default.newCauseId();v.log(f.LogTraceArea.Navigation,"ConversationGroupSwitcher.UNSAFE_componentWillUpdate, causeId: "+e),this._hideHiddenTabsDropdown(e)}}_hasMultipleConversations(e=this.state){return!!e.conversationIds&&e.conversationIds.length>1}_hasMultipleSmsTabs(e=this.state){return!!e.conversationIds&&e.conversationIds.filter((e=>l.isPhoneMri(e))).length>1}_renderTabsDropdownContainer(){if(!this.state.enableConversationTabsDropdown)return;if(!this.state.tabsConfiguration.hiddenConversations.length)return;const e=this.state.tabsConfiguration.hiddenConversations.map((e=>this.state.counts&&this.state.counts[e]&&this.state.counts[e].unreadCount||0)).reduce(((e,t)=>t+e)),t=e&&!this.state.isSmallDevice?(0,i.jsx)(a.default,{count:e.toString(),rawCount:e,badgeSize:a.BadgeSize.Desktop,isHighPriority:!0,colorStyle:this.state.badgeColorStyle,style:N.hiddenTabsDropdownBadge}):null,s=[N.hiddenTabsDropdownButtonContainer];e&&s.push(N.hiddenTabsDropdownWithCounterContainer);const o=this.props.preventAccessibilityFocus?n.Types.ImportantForAccessibility.NoHideDescendants:void 0;return(0,i.jsxs)(n.View,Object.assign({style:s,importantForAccessibility:o},{children:[(0,i.jsx)(y.default,{ref:this._onHiddenTabsDropdownButtonRef,icon:L.SkypeIcon.DownChevron,title:b.getString("Global.MoreButtonTitle"),color:O.Color.gray300,hoverColor:this._themeColors.iconHoverColor,size:L.IconSize.size15,onPress:this._onHiddenTabsDropdownButtonPress}),t]}))}render(){const{tabsConfiguration:e,conversationIds:t}=this.state,s=this._hasMultipleConversations(),r=[N.wrapper,this._themeStyles.messageStreamBackgroundColorStyle];this.props.safeAreaHorizontalInsets&&x.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&r.push(x.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets)),this.props.style&&r.push(this.props.style),this.state.isStackNav&&s&&r.push(N.wrapperStackNav),s&&this.props.heightStyle&&r.push(this.props.heightStyle);let a=[];return a=this.state.enableConversationTabsDropdown?s?o.map(e.visibleConversations,((e,t)=>this._renderConversationTab(e,t,!1))):void 0:s?o.map(t,((e,t)=>this._renderConversationTab(e,t,!1))):void 0,r.push(n.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1)),a?(0,i.jsxs)(n.View,Object.assign({style:r,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityTraits:n.Types.AccessibilityTrait.TabList,onKeyPress:this._onKeyPress,onFocus:this._onFocus,onBlur:this._onBlur},{children:[a,this._renderTabsDropdownContainer()]})):(0,i.jsx)(n.View,{style:r})}_hideHiddenTabsDropdown(e){v.log(f.LogTraceArea.Navigation,"ConversationGroupSwitcher._hideHiddenTabsDropdown, causeId: "+e),S.default.close(this._getRootViewId(),e)}_showHiddenTabsDropdown(e,t){v.log(f.LogTraceArea.Navigation,"ConversationGroupSwitcher._showHiddenTabsDropdown, causeId: "+t);const s=e.map(((e,t)=>{const s=this._renderConversationTab(e,t,!0);return{builder:()=>s,props:{key:e+t,rowHeight:40}}}));this._isHiddenTabsDropdownVisible=!0,S.default.showWithBuilders({builders:s,anchor:()=>this._hiddenTabsDropdownButtonRef,rootViewId:this._getRootViewId(),getTitle:()=>{},onCloseMenu:e=>{v.log(f.LogTraceArea.Navigation,"ConversationGroupSwitcher.onCloseMenu, causeId: "+e),this._isHiddenTabsDropdownVisible=!1},staticContent:!0,useDesktopPopup:!0,menuId:"HiddenTabsMenu"})}_getTabsConfiguration(e,t,s){const i={hiddenConversations:[],visibleConversations:[]},n=t-s,r=A.default.isSmallDevice(this._getRootViewId());B.default.isTablet();let a=3;a=r?2:(n-62)/148;const l=Math.min(a,e.length),d=[...e];if(i.visibleConversations=d.splice(0,l),i.hiddenConversations=d,this.state&&void 0!==this.state.headTabId){const e=o.remove(i.hiddenConversations,(e=>e===this.state.headTabId));if(e.length){const t=i.visibleConversations.splice(-1,1,e[0]);i.hiddenConversations.unshift(t[0])}}return i.hiddenConversations.length&&!this._overflowTelemetrySent&&(this._overflowTelemetrySent=!0,v.track(new T.MessagingTabsHiddenEvent(i.visibleConversations.length,i.hiddenConversations.length))),i}}t.default=U},962340:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(77605),r=s(671830),a=s(711930),l=s(662602),d=s(539549),c=s(557102),h=s(915877),u=s(733754),p=s(734537),g=s(527683),m=s(581760),S=s(680837),f=s(619675),y=s(24576),v=(0,h.lazyProperties)({conversationTitle:()=>o.Styles.createTextStyle({textAlign:"center",marginHorizontal:6}),conversationItem:()=>o.Styles.createViewStyle({paddingBottom:8,borderBottomWidth:2,borderStyle:"solid",borderColor:m.Color.transparent,flexDirection:"row",justifyContent:"center",alignItems:"center"}),conversationItemDesktop:()=>o.Styles.createViewStyle({paddingHorizontal:10}),conversationItemMobile:()=>o.Styles.createViewStyle({paddingHorizontal:8})});class C extends y.default{constructor(){super(...arguments),this._onShowActionMenu=e=>{e.stopPropagation(),e.preventDefault(),this.props.onShowActionMenu(e,this.props.convId)},this._onPress=e=>{e.stopPropagation(),e.preventDefault(),this.props.onNavigateToConversation(this.props.convId)},this._onTabKeyPress=e=>l.default.maybeHandleKeyPress(e,(()=>{this.props.onNavigateToConversation(this.props.convId)})),this._onComponentRef=e=>{this._componentRef=e||void 0},this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHovering:!1})}}_buildState(e,t){const s=(0,d.default)().getConversation(e.convId),i=s&&s.getOtherPartyMri()||"";return{badgeColorStyle:p.default.getBadgeColorStyle(),otherPartyMri:i}}requestFocus(){this._componentRef&&this._componentRef.requestFocus()}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.shouldUpdateOnFocus&&e.focused&&!this.props.focused&&this._componentRef&&this._componentRef.requestFocus&&this._componentRef.requestFocus()}render(){const e=[v.conversationItem,S.default.noncollapsibleView,S.default.pointerCursor],t=[v.conversationTitle,o.Styles.createTextStyle({color:this._themeColors.secondaryTextColor},!1)];let s,l;const d=!!this.props.selected,h=c.ConversationUtils.getConversationNameForTab(this.props.convId,this.state.otherPartyMri,this.props.hasMultipleSmsTabs);let p=a.default.applyMoreOptionsAccessibilityHint(d?u.getString("ContentPanelHeader.CurrentConversationTab",{conversationType:h}):u.getString("ContentPanelHeader.SwitchToConversation",{conversationType:h}));if(this.props.badgeCount){p+=", "+u.getString("ContentPanelHeader.UnreadMessageCount",{count:this.props.badgeCount})}d?(l=this.props.tabContainerSelectedStyle,t.push(this._themeStyles.primaryTextColorStyle),e.push(o.Styles.createViewStyle({borderColor:this._themeColors.primaryTextColor},!1))):this.state.isHovering&&(s=this.props.tabContainerHoverStyle,e.push(o.Styles.createViewStyle({borderColor:this._themeColors.strokePrimary},!1))),this._useAccessibleTheme()&&t.push(this._themeStyles.primaryTextColorStyle),this.props.useMobileTabs?e.push(v.conversationItemMobile):e.push(v.conversationItemDesktop);const m=this.props.badgeCount&&!d?(0,i.jsx)(n.default,{count:this.props.badgeCount.toString(),rawCount:this.props.badgeCount,badgeSize:n.BadgeSize.Desktop,isHighPriority:!0,colorStyle:this.state.badgeColorStyle}):void 0,y=a.default.tabAccessibilityLabel(p,this.props.tabPosition,this.props.totalTabs,!1),C=a.default.tabAccessibilityTraits(d),_=this.props.preventAccessibilityFocus?o.Types.ImportantForAccessibility.NoHideDescendants:o.Types.ImportantForAccessibility.Yes;let b;if(r.isConversationWithPhoneNumber(this.props.convId)){const e=r.stripMriNamespace(this.state.otherPartyMri);b=g.default.parseAndFormat(e,g.PhoneNumberFormat.INTERNATIONAL)||e}return(0,i.jsxs)(o.View,Object.assign({ref:this._onComponentRef,style:[e,this.props.tabContainerStyle,s,l],tabIndex:this.props.focused?0:-1,onPress:this._onPress,onKeyPress:this._onTabKeyPress,onLongPress:this._onShowActionMenu,onContextMenu:this._onShowActionMenu,importantForAccessibility:_,accessibilityTraits:C,accessibilityLabel:y,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,title:b},{children:[(0,i.jsx)(f.BodyText,Object.assign({style:t,numberOfLines:1},{children:h})),m]}))}}t.default=C},196060:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectMessagesUIState=void 0;const i=s(785893),o=s(665768),n=s(516778),r=s(1706),a=s(889391),l=s(607499),d=s(153338),c=s(994224),h=s(47447),u=s(905531),p=s(314920),g=s(614980),m=s(871908),S=s(671830),f=s(911009),y=s(149748),v=s(407788),C=s(887399),_=s(475760),b=s(329241),T=s(539549),M=s(731761),I=s(843368),w=s(437490),P=s(746096),k=s(245381),A=s(211375),x=s(609112),R=s(805581),O=s(766649),L=s(436237),F=s(710400),B=s(172490),D=s(915877),E=s(518460),V=s(733754),N=s(206286),U=s(603088),j=s(673319),H=s(663328),z=s(323005),W=s(953189),G=s(798603),K=s(635762),q=s(844972),Q=s(130886),X=s(445026),$=s(104735),J=s(795691),Y=s(827357),Z=s(960621),ee=s(29130),te=s(914976),se=s(451070),ie=s(681115),oe=s(886045),ne=s(170919),re=s(210541),ae=s(788361),le=s(144487),de=s(126978),ce=s(581760),he=s(680837),ue=s(360305),pe=s(24576),ge=s(863066),me=s(267096),Se=s(853374),fe=s(73877),ye=s(846116),ve=s(879015),Ce=s(741660);var _e;!function(e){e[e.Active=0]="Active",e[e.Closing=1]="Closing",e[e.Deactive=2]="Deactive"}(_e=t.SelectMessagesUIState||(t.SelectMessagesUIState={}));const be=(0,D.lazyProperties)({headerWrapper:()=>n.Styles.createViewStyle({borderBottomWidth:1,borderStyle:"solid",borderColor:ce.Color.transparent}),containerHorizontal:()=>n.Styles.createViewStyle({flexDirection:"row"}),contentPanel:()=>n.Styles.createViewStyle({flex:1,alignItems:"center"}),contentPanelContents:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),contentPanelLowerContents:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"stretch",paddingBottom:20}),contentPanelLowerContentsNoPadding:()=>n.Styles.createViewStyle({paddingBottom:0})});class Te extends pe.default{constructor(){super(...arguments),this._virtualStreamRefCount=0,this._innerMovingContainerSelectMessagesHeader=new n.Animated.Value(0),this._innerMovingContainerSelectMessagesActions=new n.Animated.Value(0),this._searchStore=new b.default,this._coachMarkContext={coachMarkArea:f.CoachMarkAreaType.Conversation},this._onMessagePanelRef=e=>{this._messagePanel=e||void 0},this._onDropDownRef=e=>{this._dropdownRef=e||void 0},this._onSelectedMessagesHeaderRef=e=>{this._selectedMessagesHeaderRef=e||void 0},this._onMessageSearchPanelRef=e=>{this._messageSearchPanel=e||void 0},this._onMessageSent=()=>{if(this.state.isSearchShowing){const e=Se.default.newCauseId();L.log(P.LogTraceArea.ContentPanel,"DesktopContentPanel._onMessageSent, causeId: "+e),$.default.closeSearchPanel(e,this._getContext(),!0)}},this._onMojiPreviewClosed=()=>{this.isComponentMounted()&&this.setState({mojiPreview:void 0})},this._onMojiPreviewOpened=e=>{this.setState({mojiPreview:e})},this._onMojiPreviewClosePressed=()=>{Z.MojiPreviewService.closePesPreview()},this._onMojiSend=()=>{this.state.mojiPreview&&Z.MojiPreviewService.sendPes(this.state.mojiPreview),Z.MojiPreviewService.closePesPreview()},this._handleLaunchCamera=()=>{if(!h.UICapabilities.cameraSupported())return;w.dismissAll();const e=this.props.navContext;g.navigateToCaptureComboModalWithParams({capturedContentHandler:new p.CapturedContentHandlerForPosting(e.state.conversationId),conversationId:e.state.conversationId,allowVideo:!0,mediaPickerShouldCollapseFully:!0,showCoachmarksIfNeeded:!0,allowOfficeLens:!0},this._getContext())},this._onToggleFindPanelWithOverflowConfig=e=>{const t=Se.default.newCauseId();if(L.log(P.LogTraceArea.ContentPanel,"DesktopContentPanel._onToggleFindPanelWithOverflowConfig, causeId: "+t),this.state.isFindPanelShowing)L.track(new j.MessageOverflowEvent(j.MessageOverflowAction.MessageOverflowCloseButtonClicked)),$.default.closeFindPanel(t,this._getContext());else{const s=this.props.navContext.state.conversationId;s&&(L.track(new j.MessageOverflowEvent(j.MessageOverflowAction.MessageOverflowOpenButtonClicked)),$.default.navigateToFindPanel(s,e,this._getContext(),t,this.state.useTabletUI?this._onCloseFindPanel:void 0),oe.default.maybeAnnounceForAccessibility(V.getString("FindPanel.FindPanelOpenedAccessibilityLabel")))}return!0},this._onCloseFindPanel=()=>{const e=Se.default.newCauseId();L.log(P.LogTraceArea.ContentPanel,"DesktopContentPanel._onCloseFindPanel, causeId: "+e),$.default.closeFindPanel(e,this._getContext())},this._onToggleFindPanel=e=>{this._onToggleFindPanelWithOverflowConfig(e),I.default.close(this._getRootViewId())},this._onCallStartedAnsweredOrJoinedViaHeader=()=>{this.blurStream()},this._onOpenDropdown=()=>{this._dropdownRef&&this._dropdownRef.showOrHide()},this._onShowGestureHint=e=>{this.isComponentMounted()&&this.setState({toolTipInfo:e})},this._onDismissPopup=()=>{this.isComponentMounted()&&this.state.toolTipInfo&&this.setState({toolTipInfo:void 0})},this._onEscape=()=>(this._selectedMessagesHeaderRef&&this._selectedMessagesHeaderRef.cancelMultipleMessages(),!0),this._onCloseSelectMessagesPanel=(e,t)=>{if(!this.isComponentMounted())return;this.setState({currentSelectMessagesUIState:_e.Closing});const s=[X.default.timing(this._innerMovingContainerSelectMessagesHeader,{toValue:e,duration:o.Common.Duration.Default,easing:o.Easing.SkypeExpoIn5,useNativeDriver:!0}),X.default.timing(this._innerMovingContainerSelectMessagesActions,{toValue:t,duration:o.Common.Duration.Default,easing:o.Easing.SkypeExpoIn5,useNativeDriver:!0})];n.Animated.parallel(s).start((e=>{e.finished&&this.isComponentMounted()&&this.setState({currentSelectMessagesUIState:_e.Deactive})}))},this._trackSearchClosed=e=>{this._messageSearchPanel&&(L.track(new K.ClosedSearch(e,this._messageSearchPanel.didUserSearch(),this._messageSearchPanel.getLastSearchResultsCount(),this._messageSearchPanel.getNumberOfRequests())),this._messageSearchPanel.resetTelemetryParams())},this._startVideoCall=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=this.props.navContext.state.conversationId;if(s&&c.default.CallNavigationHelper.isOutgoingCallingAllowed(s)){const e=Se.default.newCauseId();L.log(P.LogTraceArea.Calling,"DesktopContentPanel._startVideoCall KeyboardShortcut"+e),c.default.CallNavigationHelper.startCall({conversationMri:s,withVideo:!0,origin:P.NavigationCallOrigin.DesktopContentPanel},e).then((()=>{oe.default.maybeAnnounceForAccessibility(V.getString("CallOrInviteMenu.StartVideoCallKeyboardShortcutAccessibilityLabel"))}))}return!0},this._startAudioCall=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=this.props.navContext.state.conversationId;if(s&&c.default.CallNavigationHelper.isOutgoingCallingAllowed(s)){const e=Se.default.newCauseId();L.log(P.LogTraceArea.Calling,"DesktopContentPanel._startAudioCall KeyboardShortcut"+e),c.default.CallNavigationHelper.startCall({conversationMri:s,withVideo:!1,origin:P.NavigationCallOrigin.DesktopContentPanel},e).then((()=>{oe.default.maybeAnnounceForAccessibility(V.getString("CallOrInviteMenu.StartAudioCallKeyboardShortcutAccessibilityLabel"))}))}return!0},this._showConversationProfile=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=Se.default.newCauseId();L.log(P.LogTraceArea.ContentPanel,"DesktopContentPanel._showConversationProfile, causeId: "+s);const i=this.props.navContext.state.conversationId;return $.default.closeGenericDesktopModal(s,this._getRootViewId()),i&&$.default.showDetailsPanelWithParams({mri:i,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:s}),!0},this._addPeopleToConversation=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread||this.state.isS4BConversation)return!1;const s=Se.default.newCauseId();L.log(P.LogTraceArea.ContentPanel,"DesktopContentPanel._addPeopleToConversation, causeId: "+s);const i=this.props.navContext.state.conversationId;if($.default.closeGenericDesktopModal(s,this._getRootViewId()),S.isGroupConversation(i)){new M.default({convId:S.asSkypeThreadIdMaybe(i),navigationOrigin:P.NavigationConversationOrigin.KeyboardShortcutAddPeopleToGroup,peopleType:re.PeopleType.AllExcludingBots,filterPeopleType:re.FilterType.GroupCapable,wizardSteps:[J.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}else{new M.default({peopleType:re.PeopleType.AllExcludingBots,filterPeopleType:re.FilterType.GroupCapable,navigationOrigin:P.NavigationConversationOrigin.KeyboardShortcutNewGroupWithUser,invitedUsersMris:[i],wizardSteps:[J.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}return!0},this._markAsUnread=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=this.props.navContext.state.conversationId;return s&&this.state.unreadCount<1&&m.markMessageUnread(s),n.Accessibility.announceForAccessibility(V.getString("ConversationsListItem.MarkUnreadAnnouncement")),!0},this._enableMultipleMessagesMode=(e,t)=>t===this._getRootViewId()&&!this.state.isBookmarksThread&&(le.default.activateSelectMessagesMode(t),!0),this._onGalleryPress=e=>{e&&(e.stopPropagation(),e.preventDefault());const t=Y.default.isGalleryShowing();$.default.toggleGallery(this.props.navContext.state.conversationId,this._getContext()),t?oe.default.maybeAnnounceForAccessibility(V.getString("AccessibilityLabel.GalleryClosed")):oe.default.maybeAnnounceForAccessibility(V.getString("AccessibilityLabel.GalleryOpened"))},this._onToggleMessageSearchPanel=e=>!!this.state.isMessageSearchPanelEnabled&&(this.state.isMessageSearchPanelVisible?(this._searchStore.cancelSearch(),this._trackSearchClosed(e),this._messageSearchPanelOpenOrigin===ne.MessageSearchToggleOrigin.HeaderIcon&&n.UserInterface.isNavigatingWithKeyboard()?A.setFocus(A.FocusEvent.MessageSearchClosed):this._focusMessageComposer(),this._messageSearchPanelOpenOrigin=void 0):(this.blurStream(),this._searchStore.resetSearch(),this._messageSearchPanelOpenOrigin=e,L.track(new K.OpenedSearch(e))),!0),this._onToggleSearchByShortcut=(e,t)=>!(!this.state.isMessageSearchPanelEnabled||t!==this._getRootViewId()||this.state.isBookmarksThread||this.state.isS4BConversation)&&(this._onToggleMessageSearchPanel(ne.MessageSearchToggleOrigin.KeyboardShortcut),!0),this._onToggleSearchByHeaderIcon=()=>{this._onToggleMessageSearchPanel(ne.MessageSearchToggleOrigin.HeaderIcon)},this._archiveConversation=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=this.props.navContext.state.conversationId,i=(0,T.default)().getConversation(s),o=this._getContext();return!i||i.isArchived()||c.default.ActiveCallUIHelper.hasActiveCall(s)||l.default.showIfRequired(this._getRootViewId()).then((()=>{const e=Se.default.newCauseId();L.log(P.LogTraceArea.ContentPanel,"[DesktopContentPanel] - _archiveConversation causeId: "+e),d.default.archiveConversation(s,P.ArchiveConversationOrigin.KeyboardShortcut,this._getRootViewId()),$.default.navigateAfterArchivingConversation(s,e,o)})),!0},this._focusMessageComposer=()=>{this._messagePanel&&this._messagePanel.focusTextInputForAccessibility()}}_buildState(e,t){const{tabletConversationDetailsEnabled:s}=a.default.getS4LUiFeatures(),i=e.navContext.state.conversationId,o=(0,T.default)().getConversation(i),n={bottomSafeAreaInset:se.default.bottomSafeAreaInset(4),isKeyboardShown:F.default.isKeyboardSeen(),showMagicBotConsentBanner:a.default.getS4LMessagingFeatures().enableMagicBotBanner&&(0,ye.isMagicBotContainingConversation)(o)&&(null==o?void 0:o.isGroupConversation())},l=this.props,d=this._getRootViewId();n.otherPartyMri=o&&o.isOneOnOne()?o.getOtherPartyMri():void 0;const h=C.isConversationBlocked(i);return n.responsiveWidth=ee.default.getResponsiveWidth(d),n.isFileUploadCapable=!O.default.isUsingGogoNetwork()&&i&&(!S.isAgent(i)||r.default.hasCapability(i,"file.send"))&&!h&&!(o&&o.isLogicalOneOnOneSmsConversation())&&!S.isS4BBridgeMri(i)&&!e.navContext.state.selectedNumberForSMS,n.hasConnectedCalls=c.default.CallingStore.hasConnectedCalls(),n.isConversationBlocked=h,n.localAddressBookContact=i&&S.isOneOnOneConversation(i)?E.default.getContactByCorrespondingMri(i):void 0,n.activeCallId=c.default.ActiveCallUIHelper.getActiveCallId(i),n.hasActiveCall=c.default.ActiveCallUIHelper.hasActiveCall(i),n.activeCallStatus=c.default.ActiveCallUIHelper.activeCallStatus(i),n.unreadCount=i?_.default.getMessageCountsForConversation(i).unreadCount:0,n.useTabletUI=ue.default.isTabletUI(),n.useDropdown=!!n.otherPartyMri&&n.useTabletUI&&s,n.isSearchShowing=Y.default.isSearchShowing(),n.isFindPanelShowing=Y.default.isFindPanelShowing(d),n.isSelectMessagesModeActive=le.default.isSelectMessagesModeActive(d),n.isNewsChannel=(0,Ce.isContentChannel)(o),n.isNewsBot=(0,Ce.isTodayBot)(i),n.isSelectMessagesModeActive?n.currentSelectMessagesUIState=_e.Active:!t&&G.shouldCancelMessageSelection(l.navContext.state.conversationId,e.navContext.state.conversationId)?n.currentSelectMessagesUIState=_e.Deactive:n.currentSelectMessagesUIState=this.state?this.state.currentSelectMessagesUIState:_e.Deactive,n.canSeeGuestUpsell=u.default.identity().canSeeGuestUpsell,n.isTranslatedConversation=R.default.isConversationTranslated(i),n.isMessageSearchPanelEnabled=S.isSearchInConversationSupported(i)&&!n.isTranslatedConversation,n.isMessageSearchPanelVisible=n.isMessageSearchPanelEnabled&&!!this._searchStore.getSearchQuery(),n.isBookmarksThread=S.isBookmarkConversation(i),n.isS4BConversation=S.isS4BBridgeMri(i),n}blurStream(){this._messagePanel&&this._messagePanel.blur()}_componentId(){return"DesktopContentPanel"}componentDidMount(){super.componentDidMount();const e=Se.default.newCauseId();L.log(P.LogTraceArea.ContentPanel,"[DesktopContentPanel] - componentDidMount causeId: "+e),this._newConversationSetup(this.props.navContext,e),this._mojiPreviewOpenSubscriptionToken=Z.MojiPreviewService.onPesPreviewOpened(this._onMojiPreviewOpened),this._mojiPreviewCloseSubscriptionToken=Z.MojiPreviewService.onPesPreviewClosed(this._onMojiPreviewClosed),this._registerKeyboardHandlers();const{scrollToTimestamp:t}=this.props.navContext.state;if(t){const e=`[DesktopContentPanel] - componentDidMount, searchStore.setTimestamp: ${t}`;L.log(P.LogTraceArea.ContentPanel,e),this._searchStore.setTimestamp(t)}}UNSAFE_componentWillReceiveProps(e,t){const s=this.props.navContext,i=e.navContext,o=i.state.conversationId,n=o!==s.state.conversationId,r=Se.default.newCauseId();L.log(P.LogTraceArea.ContentPanel,"[DesktopContentPanel] - UNSAFE_componentWillReceiveProps causeId: "+r,"Conversation id differs = "+n),n?(this.props.enableConversationSwitchWithoutRemount?this._oldConversationCleanup():this._virtualStreamRefCount++,this._searchStore.cancelSearch(),this._newConversationSetup(i,r)):N.default.isMediaPreviewEnabled(o)&&!this.props.navContext.state.selectedNumberForSMS&&e.navContext.state.selectedNumberForSMS&&U.default.destroy(o);const a=i.state.scrollToTimestamp;if(a){const e=`DesktopContentPanel, searchStore.setTimestamp: ${a}, causeId: ${r}`;L.log(P.LogTraceArea.ContentPanel,e),this._searchStore.setTimestamp(a,void 0,i.state.causeId)}super.UNSAFE_componentWillReceiveProps(e,t)}componentWillUnmount(){super.componentWillUnmount(),this._mojiPreviewOpenSubscriptionToken&&this._mojiPreviewOpenSubscriptionToken.unsubscribe(),this._mojiPreviewCloseSubscriptionToken&&this._mojiPreviewCloseSubscriptionToken.unsubscribe(),this._gifPreviewOpenSubscriptionToken&&this._gifPreviewOpenSubscriptionToken.unsubscribe(),this._gifPreviewCloseSubscriptionToken&&this._gifPreviewCloseSubscriptionToken.unsubscribe(),this._unregisterKeyboardHandlers(),B.default.removeEscapeHandler(this._onEscape),this._oldConversationCleanup(!0)}_newConversationSetup(e,t){const s=e.state.conversationId;s&&(L.log(P.LogTraceArea.ContentPanel,"[DesktopContentPanel] - maybePreheatCall for conversation, id: "+te.mriOrId(s)+" causeId: "+t),c.default.CallPreheatHelper.maybePreheatCall(s,t)),e.state.origin===P.NavigationConversationOrigin.GoLiveNotification&&A.setFocus(A.FocusEvent.OpenGoLiveNotification)}_oldConversationCleanup(e=!1){const t=this.props.navContext,s=[ge.Scenarios.SearchToConversation,ge.Scenarios.RecommendationFromRecentsToConversation,ge.Scenarios.RecommendationFromContactsToConversation];me.default.interruptScenarios(t.state.conversationId,s),le.default.isSelectMessagesModeActive(this._getRootViewId())&&le.default.deactivateSelectMessagesMode(),this.state.isMessageSearchPanelVisible&&this._trackSearchClosed(ne.MessageSearchToggleOrigin.NavigationOut)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.isSelectMessagesModeActive!==this.state.isSelectMessagesModeActive&&(this.state.isSelectMessagesModeActive?B.default.addEscapeHandler(this._onEscape):B.default.removeEscapeHandler(this._onEscape))}render(){const e=de.default.getWidthNoSubscription(),t=this.props.navContext,s=this.state.mojiPreview&&this._shouldShowPreview()?(0,i.jsx)(Q.MojiPreview,{moji:this.state.mojiPreview,onClose:this._onMojiPreviewClosePressed,onSend:this._onMojiSend},t.state.conversationId):void 0,o=this.state.toolTipInfo?(0,i.jsx)(k.default,{toolTipInfo:this.state.toolTipInfo,onDismiss:this._onDismissPopup,containerOffsetX:e}):void 0,r=this.state.useDropdown?(0,i.jsx)(v.default,{ref:this._onDropDownRef,conversationId:t.state.conversationId,otherPartyMri:this.state.otherPartyMri},t.state.conversationId):void 0,a=[be.containerHorizontal,this._themeStyles.primaryBackgroundColorStyle];this.props.enableConversationSwitchWithoutRemount?a.push(he.default.flexOne):a.push(he.default.absoluteFill),a.push(n.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1));const l=fe.WindowDimensionUtils.measureWindow(this._getRootViewId()).width-e;let d,c;this.state.currentSelectMessagesUIState!==_e.Deactive&&(d=(0,i.jsx)(ae.default,{ref:this._onSelectedMessagesHeaderRef,renderHeader:!0,conversationId:t.state.conversationId,mobileUi:this.state.useTabletUI,panelAnimatedValue:this._innerMovingContainerSelectMessagesHeader,onClosePanel:this._onCloseSelectMessagesPanel}),c=(0,i.jsx)(ae.default,{renderActions:!0,conversationId:t.state.conversationId,panelAnimatedValue:this._innerMovingContainerSelectMessagesActions,onClosePanel:this._onCloseSelectMessagesPanel}));const h=this.state.canSeeGuestUpsell?(0,i.jsx)(x.default,{}):void 0,u=this.state.isSelectMessagesModeActive||this.state.isMessageSearchPanelVisible&&this.state.useTabletUI,p=(0,i.jsx)(y.ContentPanelHeader,{conversationId:t.state.conversationId,otherPartyMri:this.state.otherPartyMri,activeCallId:this.state.activeCallId,hasActiveCall:this.state.hasActiveCall,activeCallStatus:this.state.activeCallStatus,localAddressBookPhones:this.state.localAddressBookContact?this.state.localAddressBookContact.phones:void 0,onCallStartedAnsweredOrJoined:this._onCallStartedAnsweredOrJoinedViaHeader,onOpenDropdown:this.state.useDropdown?this._onOpenDropdown:void 0,preventAccessibilityFocus:u,hideConversationSwitcher:this.state.isSelectMessagesModeActive,onToggleMessageSearchPanel:this._onToggleSearchByHeaderIcon,isMessageSearchPanelVisible:this.state.isMessageSearchPanelVisible,isMessageSearchPanelEnabled:this.state.isMessageSearchPanelEnabled,onGalleryPressed:this._onGalleryPress,hideBackButton:this.props.navContext.state.hideBackButton,openMagicBotToolboxByDefault:this.props.navContext.state.openMagicBotToolboxByDefault}),g=(0,i.jsx)(z.MessageSearchPanelAnimatedWrapper,{conversationId:t.state.conversationId,onCancel:this._onToggleMessageSearchPanel,ref:this._onMessageSearchPanelRef,isMessageSearchPanelVisible:this.state.isMessageSearchPanelVisible,useMobileUI:this.state.useTabletUI,searchStore:this._searchStore}),m=this.state.useTabletUI?(0,i.jsx)(W.MobileSearchNavigationPanel,{useMobileUI:!0,searchStore:this._searchStore}):void 0,S=[be.contentPanelLowerContents,this.state.isBookmarksThread||this.state.isNewsChannel||this.state.isNewsBot?be.contentPanelLowerContentsNoPadding:void 0];return this.state.bottomSafeAreaInset&&!this.state.isKeyboardShown&&S.push(ie.default.paddingBottomStyle(this.state.bottomSafeAreaInset)),(0,i.jsx)(n.View,Object.assign({style:a},{children:(0,i.jsxs)(f.CoachMarkContext.Provider,Object.assign({value:this._coachMarkContext},{children:[(0,i.jsxs)(n.View,Object.assign({style:he.default.flexOne},{children:[(0,i.jsxs)(n.View,Object.assign({style:[be.headerWrapper,n.Styles.createViewStyle({borderBottomWidth:1,borderColor:this._getContext().themeColors.dividerPrimary},!1)]},{children:[p,g,d,h,this.state.showMagicBotConsentBanner?(0,i.jsx)(ve.MagicBotConsentBanner,{}):null]})),(0,i.jsxs)(n.View,Object.assign({style:be.contentPanel},{children:[(0,i.jsx)(n.View,Object.assign({style:be.contentPanelContents},{children:(0,i.jsx)(n.View,Object.assign({style:S},{children:(0,i.jsx)(H.default,{ref:this._onMessagePanelRef,enableConversationSwitchWithoutRemount:this.props.enableConversationSwitchWithoutRemount,conversationId:t.state.conversationId,otherPartyMri:this.state.otherPartyMri,focusedMessageCuid:t.state.focusedMessageCuid,forceRefreshFocus:t.state.forceRefreshFocus,allowUploads:this.state.isFileUploadCapable,isNewConversation:t.state.isNewConversation,isFindPanelHidden:!this.state.isFindPanelShowing,availableWidth:l,hasConnectedCalls:this.state.hasConnectedCalls,selectedNumberForSMS:t.state.selectedNumberForSMS,inviteToken:t.state.inviteToken,showBottomDivider:this.state.useTabletUI,onLaunchCamera:this._handleLaunchCamera,onToggleFindPanel:this._onToggleFindPanel,onHandleOverflow:this._onToggleFindPanelWithOverflowConfig,onInitialRenderComplete:this.props.onInitialRenderComplete,isInvisible:this.props.isInvisible,onMessageSent:this._onMessageSent,onShowGestureHint:this._onShowGestureHint,isSelectMessagesModeActive:this.state.isSelectMessagesModeActive,isFromSearch:this.state.isSearchShowing,isFromPeopleRecommendations:t.state.isFromPeopleRecommendations,isMessageSearchPanelVisible:this.state.isMessageSearchPanelVisible,focusJoinCallButton:this.props.navContext.state.origin===P.NavigationConversationOrigin.GoLiveNotification,directShareEventData:this.props.navContext.state.directShareEventData,isTranslatedConversation:this.state.isTranslatedConversation,searchStore:this._searchStore},this.props.enableConversationSwitchWithoutRemount?void 0:this._virtualStreamRefCount)}))})),r]})),c,m]})),s,o]}))}))}_shouldShowPreview(){return!1}_registerKeyboardHandlers(){const e=this.props.navContext.state.conversationId,t=(0,T.default)().getConversation(e);(0,q.isRegularMemberInModeratedGroup)(t)||(B.default.addHandler(P.KeyboardShortcut.StartVideoCall,this._startVideoCall),B.default.addHandler(P.KeyboardShortcut.StartAudioCall,this._startAudioCall),B.default.addHandler(P.KeyboardShortcut.AddPeopleToConversation,this._addPeopleToConversation)),B.default.addHandler(P.KeyboardShortcut.ShowConversationProfile,this._showConversationProfile),B.default.addHandler(P.KeyboardShortcut.MarkAsUnread,this._markAsUnread),B.default.addHandler(P.KeyboardShortcut.EnableMultipleSelectMessages,this._enableMultipleMessagesMode),B.default.addHandler(P.KeyboardShortcut.ArchiveConversation,this._archiveConversation),B.default.addHandler(P.KeyboardShortcut.SearchInConversation,this._onToggleSearchByShortcut)}_unregisterKeyboardHandlers(){const e=this.props.navContext.state.conversationId,t=(0,T.default)().getConversation(e);(0,q.isRegularMemberInModeratedGroup)(t)||(B.default.removeHandler(P.KeyboardShortcut.StartVideoCall,this._startVideoCall),B.default.removeHandler(P.KeyboardShortcut.StartAudioCall,this._startAudioCall),B.default.removeHandler(P.KeyboardShortcut.AddPeopleToConversation,this._addPeopleToConversation)),B.default.removeHandler(P.KeyboardShortcut.ShowConversationProfile,this._showConversationProfile),B.default.removeHandler(P.KeyboardShortcut.MarkAsUnread,this._markAsUnread),B.default.removeHandler(P.KeyboardShortcut.EnableMultipleSelectMessages,this._enableMultipleMessagesMode),B.default.removeHandler(P.KeyboardShortcut.ArchiveConversation,this._archiveConversation),B.default.removeHandler(P.KeyboardShortcut.SearchInConversation,this._onToggleSearchByShortcut)}}t.default=Te},691707:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(300060),a=s(889391),l=s(996074),d=s(196060),c=s(436237),h=s(915877),u=s(20022),p=s(603088),g=s(526594),m=s(144487),S=s(680837),f=s(912770),y=s(781571),v=(0,h.lazyProperties)({container:()=>S.default.flexOne});class C extends l.default{constructor(){super(...arguments),this._refCounter=0,this._onAppExitCallback=()=>p.default.markSavedAsDraft(this.props.navContext.state.conversationId),this._onInitialRenderComplete=()=>{this._forceTimer&&(f.default.clearTimeout(this._forceTimer),this._forceTimer=void 0),this.setState({viewRendered:!0});const e=this._refCounter;o.delay((()=>{this.isComponentMounted()&&this.state.oldProps&&e===this._refCounter&&this.setState({oldProps:void 0})}),100)}}_buildState(e,t){const s={},i=this.props,o=e.navContext.state,n=i.navContext.state;return o.conversationId===n.conversationId&&o.scrollToTimestamp===n.scrollToTimestamp&&o.focusedMessageCuid===n.focusedMessageCuid&&o.forceRefreshFocus===n.forceRefreshFocus||(this._refCounter++,s.oldProps=i,s.viewRendered=!1),s.enableConversationSwitchWithoutRemount=a.default.getS4LMessagingFeatures().enableConversationSwitchWithoutRemount,s}componentDidMount(){super.componentDidMount(),a.default.getS4LMessagingFeaturesNoSubscription().enableMediaPreviewDraftsPersistentStorage&&(u.default.addObserver(u.LifecycleEventType.ON_EXIT,this._onAppExitCallback),this._appStateSubscription=r.default.subscribeForChanges("DesktopContentPanelManager",(e=>{o.includes([n.Types.AppActivationState.Inactive,n.Types.AppActivationState.Background],e)&&p.default.markSavedAsDraft(this.props.navContext.state.conversationId).then((()=>{const e=p.default.getConversationsWithMediaDraft().length;e>0&&c.track(new g.MediaPreviewAppExitWithDraftsEvent(e))})).catch(o.noop)})))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);this.props.navContext.id!==e.navContext.id&&(y.default.clear(e.navContext.state.conversationId),a.default.getS4LMessagingFeaturesNoSubscription().enableMediaPreviewDrafts?p.default.markSavedAsDraft(e.navContext.state.conversationId):p.default.destroy(e.navContext.state.conversationId,!0),m.default.isSelectMessagesModeActive(this._getRootViewId())&&m.default.deactivateSelectMessagesMode())}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),u.default.removeObserver(u.LifecycleEventType.ON_EXIT,this._onAppExitCallback),y.default.clear(this.props.navContext.state.conversationId),a.default.getS4LMessagingFeaturesNoSubscription().enableMediaPreviewDrafts?p.default.markSavedAsDraft(this.props.navContext.state.conversationId):p.default.destroy(this.props.navContext.state.conversationId,!0)}_renderContentPanelSwitch(){let e=null;this.state.oldProps&&(e=(0,i.jsx)(d.default,{navContext:this.state.oldProps.navContext,isInvisible:!0},this._refCounter-1),this._setForceShowPanelTimer());const t=(0,i.jsx)(d.default,{navContext:this.props.navContext,onInitialRenderComplete:this.state.oldProps?this._onInitialRenderComplete:void 0},this._refCounter),s=this.state.viewRendered?t:e;return[this.state.viewRendered?e:t,s]}render(){return this.state.enableConversationSwitchWithoutRemount?(0,i.jsx)(d.default,{navContext:this.props.navContext,enableConversationSwitchWithoutRemount:this.state.enableConversationSwitchWithoutRemount}):(0,i.jsx)(n.View,Object.assign({style:v.container},{children:this._renderContentPanelSwitch()}))}_setForceShowPanelTimer(){const e=this._refCounter;this._forceTimer=f.default.setTimeout((()=>{this.isComponentMounted()&&this.state.oldProps&&e===this._refCounter&&this.setState({oldProps:void 0})}),a.default.getS4LMessagingFeaturesNoSubscription().oldContentPanelForceHideTimeout)}}t.default=C},946239:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GalleryButton=void 0;const i=s(785893),o=s(516778),n=s(136400),r=s(110117),a=s(915877),l=s(733754),d=s(711828),c=s(24576),h=(0,a.lazyProperties)({icon:()=>o.Styles.createViewStyle({minWidth:d.IconSize.size16,marginRight:3}),galleryButton:()=>o.Styles.createViewStyle({flexShrink:0,flexDirection:"row",paddingLeft:4,paddingRight:4,alignItems:"center"})});class u extends c.default{constructor(){super(...arguments),this._onRef=e=>{this._button=e||void 0}}requestFocus(){this._button&&this._button.requestFocus()}render(){var e;const t=this.props.preventAccessibilityFocus?o.Types.ImportantForAccessibility.NoHideDescendants:void 0,s=this.props.preventAccessibilityFocus?-1:void 0,a=l.getString("ContentPanelHeaderTitle.GalleryButtonTitle"),c=this.props.iconColorOverride?this.props.iconColorOverride:this._themeColors.secondaryTextColor;return(0,i.jsxs)(n.HoverableButton,Object.assign({ref:this._onRef,style:[h.galleryButton,this.props.style],title:a,accessibilityLabel:this.props.accessibilityLabel?this.props.accessibilityLabel:a,onPress:this.props.onPress,importantForAccessibility:t,tabIndex:s,disabled:this.props.disabled},{children:[(0,i.jsx)(r.default,{icon:d.SkypeIcon.Gallery1,style:h.icon,color:c,size:null!==(e=this.props.iconSize)&&void 0!==e?e:d.IconSize.size12}),this.props.hideIconText?void 0:this._getIconText()]}))}_getIconText(){return(0,i.jsx)(o.Text,Object.assign({style:this.props.textStyle,numberOfLines:1},{children:l.getString("ContentPanelHeaderTitle.Gallery")}))}}t.GalleryButton=u,t.default=u},853703:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(913944),r=s(915877),a=s(733754),l=s(711828),d=s(24576),c=(0,r.lazyProperties)({manageGroupButton:()=>o.Styles.createViewStyle({flexShrink:0,flexDirection:"row",paddingLeft:4,paddingRight:8,alignItems:"center",minWidth:l.IconSize.size16,marginRight:3})});class h extends d.default{requestFocus(){this._button&&this._button.requestFocus()}render(){var e,t;const s=this.props.preventAccessibilityFocus?o.Types.ImportantForAccessibility.NoHideDescendants:void 0,r=this.props.preventAccessibilityFocus?-1:void 0,d=a.getString("ConversationsListItem.ChatGroupManageLabel"),h=this.props.iconColorOverride?this.props.iconColorOverride:this._themeColors.secondaryTextColor,u=null!==(e=this.props.hoverColor)&&void 0!==e?e:this._themeColors.iconHoverColor,p=this.props.isCompact?l.IconSize.size12:null!==(t=this.props.iconSize)&&void 0!==t?t:l.IconSize.size18;return(0,i.jsx)(n.default,{style:[c.manageGroupButton,this.props.style],title:d,accessibilityLabel:this.props.accessibilityLabel?this.props.accessibilityLabel:d,onPress:this.props.onPress,importantForAccessibility:s,tabIndex:r,disabled:this.props.disabled,icon:l.SkypeIcon.Settings,color:h,size:p,hoverColor:u})}}t.default=h},323005:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSearchPanelAnimatedWrapper=t.MessageSearchPanel=void 0;const i=s(785893),o=s(496486),n=s(665768),r=s(516778),a=s(889391),l=s(353026),d=s(915877),c=s(733754),h=s(953189),u=s(298469),p=s(451070),g=s(170919),m=s(24576),S=s(110996),f=s(269399),y=s(853374),v=s(17791),C=s(359405);class _ extends m.default{constructor(){super(...arguments),this._didSearch=!1,this._lastSearchResultsCount=0,this._numberOfRequests=0,this.didUserSearch=()=>this._didSearch,this.getLastSearchResultsCount=()=>this._lastSearchResultsCount,this.getNumberOfRequests=()=>this._numberOfRequests,this.resetTelemetryParams=()=>{this._didSearch=!1,this._lastSearchResultsCount=0,this._numberOfRequests=0},this._onViewRef=e=>{this._viewRef=e||void 0},this._onCancelButtonPress=()=>{this._onCancel(g.MessageSearchToggleOrigin.CancelButton)},this._onCancel=e=>{this._performSearchDebounced.cancel(),this.props.onCancel(e)},this._clearSearch=()=>{this._performSearchDebounced.cancel(),this.props.searchStore.resetSearch(),this.setState({searchQuery:""},(()=>this.requestFocus()))},this._onQueryTextChange=e=>{this.props.searchStore.getSearchQuery()&&(this.setState({searchQuery:e}),this._performSearchDebounced(e,this.props.conversationId))},this._performSearch=(e,t,s,i,o)=>{this._zeroTermSearch=0===e.length,this._scenarioID=i||y.default.newCauseId();const n=this._scenarioID;(0,S.willSearch)(f.ScenarioSearchTypes.MessageInConversation,n);const r=null!=o?o:this.state.messageSearchLimit;(0,S.searchCallSent)(f.ScenarioSearchTypes.MessageInConversation,n,this._zeroTermSearch,r),this.props.searchStore.findQuery({query:e},t,n).then((e=>{(0,S.searchResultsReceived)(f.ScenarioSearchTypes.MessageInConversation,n,this._zeroTermSearch,r),s&&this.props.searchStore.focusMessage(s),this._announceResultsFound(e)})).catch((e=>{const t=v.default.isNetworkingAvailable();(0,S.searchResultsNotReceived)(f.ScenarioSearchTypes.MessageInConversation,n,this._zeroTermSearch,-1,"",t,r)})),this._numberOfRequests++,this._didSearch=!0},this._performSearchDebounced=o.debounce(this._performSearch,300),this._onScrollToMessageFromSearch=o.debounce((()=>{const{results:e,currentMessageIndex:t}=this.state,{conversationId:s}=this.props;e.length&&e[t]&&(0,C.getMessageTimestamp)(e[t],s).then((e=>{s===this.props.conversationId&&this.props.searchStore.setTimestamp(null==e?void 0:e.timestamp,null==e?void 0:e.cuid,this._scenarioID,this._zeroTermSearch)}))}),300),this._announceResultsFound=o.debounce((e=>{const t=c.getString("ContentPanelHeader.SearchInConversationResultsFoundAnnouncement",{count:e});r.Accessibility.announceForAccessibility(t)}),300)}_buildState(e,t){const s={},i=a.default.getS4LMessagingFeatures();s.currentMessageIndex=e.searchStore.getFocusedMessageIndex(),s.results=e.searchStore.getResults(),s.isLoading=e.searchStore.isLoadingResults(),s.messageSearchLimit=i.inConversationMessageSearch.initialPageSize;const o=l.default.getSearchQuery();return o&&e.conversationId===o.conversationId?(this._performSearch(o.query,o.conversationId,o.messageId,o.sessionId,s.messageSearchLimit),s.searchQuery=o.query,l.default.resetSearchQuery()):t&&(s.searchQuery=""),s}componentDidUpdate(e,t,s){var i,o,n,r;super.componentDidUpdate(e,t,s);(null===(o=null===(i=t.results)||void 0===i?void 0:i[t.currentMessageIndex])||void 0===o?void 0:o.ClientMessageId)!==(null===(r=null===(n=this.state.results)||void 0===n?void 0:n[this.state.currentMessageIndex])||void 0===r?void 0:r.ClientMessageId)&&this._onScrollToMessageFromSearch(),!1===this.props.isMessageSearchPanelVisible&&!0===e.isMessageSearchPanelVisible&&this.setState({searchQuery:""})}requestFocus(){this._viewRef&&this._viewRef.requestFocus()}render(){const e=this.props.useMobileUI?void 0:(0,i.jsx)(h.MessageSearchPanelNavigation,{useMobileUI:this.props.useMobileUI,searchStore:this.props.searchStore});return(0,i.jsx)(u.default,{onCancel:this._onCancel,onChangeText:this._onQueryTextChange,onClearPress:this._clearSearch,ref:this._onViewRef,clearSearch:this._clearSearch,onCancelButtonPress:this._onCancelButtonPress,isLoading:this.state.isLoading,searchQuery:this.state.searchQuery,navigationComponent:e,disableUi:!this.props.isMessageSearchPanelVisible,searchStore:this.props.searchStore})}}t.MessageSearchPanel=_;const b=(0,d.lazyProperties)({container:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",position:"absolute",left:0,right:0,height:70})});class T extends m.default{constructor(e){super(e),this._animatedHeightValue=new r.Animated.Value(0),this._animatedOpacityValue=new r.Animated.Value(0),this._animatedPositionValueStackNav=new r.Animated.Value(-70),this._animatedMenuStyleStackNav=r.Styles.createAnimatedViewStyle({top:this._animatedPositionValueStackNav}),this._animatedMenuStyle=r.Styles.createAnimatedViewStyle({height:this._animatedHeightValue,opacity:this._animatedOpacityValue}),this.didUserSearch=()=>!!this._messageSearchRef&&this._messageSearchRef.didUserSearch(),this.getLastSearchResultsCount=()=>this._messageSearchRef?this._messageSearchRef.getLastSearchResultsCount():0,this.getNumberOfRequests=()=>this._messageSearchRef?this._messageSearchRef.getNumberOfRequests():0,this.resetTelemetryParams=()=>this._messageSearchRef&&this._messageSearchRef.resetTelemetryParams(),this._onMessageSearchRef=e=>{this._messageSearchRef=e||void 0},this._animatedHeightValue.setValue(e.isMessageSearchPanelVisible?61:0),this._animatedOpacityValue.setValue(e.isMessageSearchPanelVisible?1:0)}_buildState(e,t){const s={leavePaddingForStatusBar:r.StatusBar.isOverlay(),statusBarHeight:p.default.statusBarHeight()};return t&&this._animatedPositionValueStackNav.setValue(e.isMessageSearchPanelVisible?T._zeroPosition(s):-70),s}componentDidMount(){super.componentDidMount(),this._animate(this.props.isMessageSearchPanelVisible)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.props.isMessageSearchPanelVisible!==e.isMessageSearchPanelVisible&&this._animate(this.props.isMessageSearchPanelVisible)}_animate(e){if(this.isComponentMounted()){if(this._animation&&this._animation.stop(),this.props.useMobileUI)this._animation=r.Animated.timing(this._animatedPositionValueStackNav,{toValue:e?T._zeroPosition(this.state):-70,duration:n.Common.Duration.Default,easing:n.Easing.SkypeExpoInOut5});else{const t=r.Animated.timing(this._animatedHeightValue,{toValue:e?61:0,duration:500,easing:n.Easing.SkypeExpoInOut5}),s=r.Animated.timing(this._animatedOpacityValue,{toValue:e?1:0,duration:300,easing:n.Easing.Linear,delay:e?200:100});this._animation=r.Animated.parallel([t,s])}this._animation.start((()=>{this._animation=void 0})),this._messageSearchRef&&e&&this._messageSearchRef.requestFocus()}}render(){const e=this.props.isMessageSearchPanelVisible?this.props.importantForAccessibility:r.Types.ImportantForAccessibility.NoHideDescendants,t=this.props.useMobileUI?[b.container,this._themeStyles.primaryBackgroundColorStyle,this._animatedMenuStyleStackNav]:this._animatedMenuStyle;return(0,i.jsx)(r.Animated.View,Object.assign({style:t,importantForAccessibility:e},{children:(0,i.jsx)(_,Object.assign({},this.props,{ref:this._onMessageSearchRef}))}))}static _zeroPosition(e){return(e.leavePaddingForStatusBar?e.statusBarHeight:0)||0}}t.MessageSearchPanelAnimatedWrapper=T},953189:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MobileSearchNavigationPanel=t.MessageSearchPanelNavigation=void 0;const i=s(785893),o=s(496486),n=s(665768),r=s(516778),a=s(913944),l=s(915877),d=s(733754),c=s(886045),h=s(581760),u=s(311010),p=s(711828),g=s(619675),m=s(24576),S=(0,l.lazyProperties)({rowCenterContainer:()=>r.Styles.createViewStyle({backgroundColor:h.Color.transparent,flexDirection:"row",alignItems:"center"}),buttonsContainer:()=>r.Styles.createViewStyle({flexDirection:"row"}),buttonStyle:()=>r.Styles.createViewStyle({padding:0,alignItems:"center",justifyContent:"center",width:20,height:20,borderRadius:10,marginRight:8}),results:()=>r.Styles.createViewStyle({marginRight:16}),stackNavigationOverrides:()=>(0,l.lazyProperties)({rowCenterContainer:()=>r.Styles.createViewStyle({height:50,borderTopWidth:1}),buttonsContainer:()=>r.Styles.createViewStyle({paddingLeft:10,paddingRight:10,width:88}),spacerStyle:()=>r.Styles.createViewStyle({width:88}),buttonStyle:()=>r.Styles.createViewStyle({marginRight:20}),results:()=>r.Styles.createTextStyle({fontSize:u.default.fontSize.size18,textAlign:"center",flexDirection:"row",flexGrow:1})})});class f extends m.default{constructor(){super(...arguments),this._onPrevButtonRef=e=>{this._prevButtonRef=e},this._onNextButtonRef=e=>{this._nextButtonRef=e},this._onChangeDirectionUp=()=>{this.props.searchStore.focusPreviousMessage(),this.props.searchStore.isFocusingPreviousDisabled()&&this._nextButtonRef&&this._nextButtonRef.requestFocus()},this._onChangeDirectionDown=()=>{this.props.searchStore.focusNextMessage(),this.props.searchStore.isFocusingNextDisabled()&&this._prevButtonRef&&this._prevButtonRef.requestFocus()}}_buildState(e,t){return{results:e.searchStore.getResults(),currentMessageIndex:e.searchStore.getFocusedMessageIndex(),isMovingUpDisabled:e.searchStore.isFocusingPreviousDisabled(),isMovingDownDisabled:e.searchStore.isFocusingNextDisabled()}}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),c.default.shouldAnnounceForAccessibility()&&t.currentMessageIndex!==this.state.currentMessageIndex){const e=d.getString("MessageSearchNavigation.NumberOfResults",{currentIndex:t.currentMessageIndex+1,totalNumberOfResults:this.state.results.length});r.Accessibility.announceForAccessibility(e)}}render(){const e=[S.rowCenterContainer];return this.props.useMobileUI&&(e.push(S.stackNavigationOverrides.rowCenterContainer),e.push(this._themeStyles.headerShadowBorderColorStyle),e.push(this._themeStyles.primaryBackgroundColorStyle)),(0,i.jsxs)(r.View,Object.assign({style:e},{children:[this.props.useMobileUI?[this._getButtons(),this._getCaption()]:[this._getCaption(),this._getButtons()],this._getOptionalSpacer()]}))}_getCaption(){return this.props.useMobileUI?(0,i.jsx)(r.Text,Object.assign({style:[S.stackNavigationOverrides.results,this._themeStyles.primaryTextColorStyle]},{children:d.getString("MessageSearchNavigation.NumberOfResults",{currentIndex:this.state.currentMessageIndex+1,totalNumberOfResults:this.state.results.length})}),"caption"):(0,i.jsxs)(g.Caption,Object.assign({style:S.results,textThemeColor:g.TextThemeColor.Primary},{children:[o.isEmpty(this.state.results)?0:this.state.currentMessageIndex+1," / ",this.state.results.length]}),"caption")}_getButtons(){const e=[S.buttonsContainer];this.props.useMobileUI&&e.push(S.stackNavigationOverrides.buttonsContainer);const t=[this.props.useMobileUI?S.stackNavigationOverrides.buttonStyle:S.buttonStyle,this.props.useMobileUI?void 0:this._themeStyles.buttonBackgroundColorStyle],s=this.props.useMobileUI?p.IconSize.size24:p.IconSize.size10,o=this.props.useMobileUI&&!this.state.isMovingUpDisabled?h.Color.blueDark:this._themeColors.primaryTextColor,n=this.props.useMobileUI&&!this.state.isMovingDownDisabled?h.Color.blueDark:this._themeColors.primaryTextColor;return(0,i.jsxs)(r.View,Object.assign({style:e},{children:[(0,i.jsx)(a.default,{disabled:this.state.isMovingUpDisabled,onPress:this._onChangeDirectionUp,icon:p.SkypeIcon.UpChevron,disabledOpacity:.4,size:s,color:o,hoverColor:this._themeColors.primaryTextColor,hoverStyle:this._themeStyles.buttonBackgroundHoverColorStyle,style:t,title:d.getString("ContentPanelHeader.SearchInConversationPreviousResultTitle"),ref:this._onPrevButtonRef}),(0,i.jsx)(a.default,{disabled:this.state.isMovingDownDisabled,onPress:this._onChangeDirectionDown,icon:p.SkypeIcon.DownChevron,disabledOpacity:.4,size:s,color:n,hoverColor:this._themeColors.primaryTextColor,hoverStyle:this._themeStyles.buttonBackgroundHoverColorStyle,style:t,title:d.getString("ContentPanelHeader.SearchInConversationNextResultTitle"),ref:this._onNextButtonRef})]}),"buttons")}_getOptionalSpacer(){if(this.props.useMobileUI)return(0,i.jsx)(r.View,{style:S.stackNavigationOverrides.spacerStyle})}}t.MessageSearchPanelNavigation=f;const y=(0,l.lazyProperties)({container:()=>r.Styles.createViewStyle({flex:1,height:50,position:"absolute",left:0,right:0})});class v extends m.default{constructor(){super(...arguments),this._animatedPositionValue=new r.Animated.Value(-50),this._animatedNavStyle=r.Styles.createAnimatedViewStyle({bottom:this._animatedPositionValue})}componentDidMount(){super.componentDidMount(),this._animate(this.state.isMessageSearchPanelVisible)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.isMessageSearchPanelVisible!==t.isMessageSearchPanelVisible&&this._animate(this.state.isMessageSearchPanelVisible)}_buildState(e,t){const s={isMessageSearchPanelVisible:!!e.searchStore.getSearchQuery()};return t&&this._animatedPositionValue.setValue(this._bottomPosition(s.isMessageSearchPanelVisible)),s}_animate(e){this.isComponentMounted()&&(this._animation&&this._animation.stop(),this._animation=r.Animated.timing(this._animatedPositionValue,{toValue:this._bottomPosition(e),duration:n.Common.Duration.Default,easing:n.Easing.SkypeExpoInOut5}),this._animation.start((()=>{this._animation=void 0})))}_bottomPosition(e){return e?0:-50}render(){return(0,i.jsx)(r.Animated.View,Object.assign({style:[y.container,this._animatedNavStyle,this.props.style]},{children:(0,i.jsx)(f,Object.assign({},this.props))}))}}t.MobileSearchNavigationPanel=v},298469:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(898278),r=s(185641),a=s(136400),l=s(913944),d=s(110117),c=s(547126),h=s(915877),u=s(733754),p=s(106658),g=s(330124),m=s(170919),S=s(915415),f=s(581760),y=s(311010),v=s(711828),C=s(360305),_=s(619675),b=s(24576),T={},M=(0,h.lazyProperties)({container:()=>o.Styles.createViewStyle({paddingVertical:0,paddingHorizontal:0,flex:1,flexDirection:"row",overflow:"hidden"}),rightContainerStyle:()=>o.Styles.createViewStyle({borderLeftWidth:1,borderStyle:"solid",alignItems:"stretch"}),centerContainer:()=>o.Styles.createViewStyle({overflow:"hidden",backgroundColor:f.Color.transparent,flexGrow:0,flexShrink:1,flexDirection:"row",alignSelf:"flex-end",marginBottom:11,height:38,width:p.maxStreamContentWidth}),innerContainer:()=>o.Styles.createViewStyle({borderRadius:5,borderWidth:1,flex:1,flexDirection:"row"}),rowCenterContainer:()=>o.Styles.createViewStyle({backgroundColor:f.Color.transparent,flexDirection:"row",alignItems:"center"}),searchInput:()=>o.Styles.createTextInputStyle({flex:1,fontSize:y.default.controlFontSize.caption,backgroundColor:f.Color.transparent,height:20}),searchInputContainer:()=>o.Styles.createViewStyle({padding:8,flex:1,flexDirection:"row",alignItems:"center"}),searchInputIcon:()=>o.Styles.createViewStyle({marginRight:8}),closeButton:()=>o.Styles.createViewStyle({backgroundColor:f.Color.transparent,marginLeft:20}),loadingContainer:()=>o.Styles.createViewStyle({alignItems:"center",justifyContent:"center",marginHorizontal:10}),loader:()=>o.Styles.createViewStyle({padding:0}),cancelBtn:()=>o.Styles.createViewStyle({paddingHorizontal:20}),innerContainerRight:()=>o.Styles.createButtonStyle({paddingLeft:20}),stackNavigationOverrides:()=>(0,h.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",overflow:"hidden",alignItems:"stretch"}),leftSpacer:()=>o.Styles.createViewStyle({width:10}),rightSpacer:()=>o.Styles.createViewStyle({width:10}),centerContainer:()=>o.Styles.createViewStyle({overflow:"hidden",flexGrow:1,flexDirection:"row",alignSelf:"center",height:30}),searchInput:()=>o.Styles.createTextInputStyle({fontSize:y.default.controlFontSize.body}),innerContainer:()=>o.Styles.createViewStyle({borderRadius:15}),cancelBtn:()=>o.Styles.createViewStyle({paddingLeft:10})})});class I extends b.default{constructor(){super(...arguments),this._renderCancelButton=()=>this.state.useMobileUI?(0,i.jsx)(o.Button,Object.assign({onPress:this.props.onCancelButtonPress,style:M.stackNavigationOverrides.cancelBtn},{children:(0,i.jsx)(_.BodyText,Object.assign({style:this._themeStyles.primaryTextColorStyle},{children:u.getString("Global.CancelLabel")}))})):(0,i.jsx)(a.HoverableButton,Object.assign({onPress:this.props.onCancelButtonPress,style:M.cancelBtn,disabled:this.props.disableUi},{children:(0,i.jsx)(_.Caption,Object.assign({textThemeColor:_.TextThemeColor.Primary},{children:u.getString("Global.CancelLabel")}))})),this._renderLoading=()=>{if(this.props.isLoading)return(0,i.jsx)(o.View,Object.assign({style:M.loadingContainer},{children:(0,i.jsx)(S.default,{size:n.SXActivityIndicatorSize.ExtraSmall,tintColor:this._themeColors.primaryIconColor,style:M.loader,useRXIndicator:!0})}))},this._renderNavigationComponent=()=>this.props.navigationComponent,this._renderSearchInput=()=>{const e=[M.searchInput,this.state.useMobileUI?M.stackNavigationOverrides.searchInput:void 0,this._themeStyles.primaryTextColorStyle],t=this.state.useMobileUI?u.getString("ContentPanelHeader.SearchConversationPlaceholderMobile"):u.getString("ContentPanelHeader.SearchConversationPlaceholder");return(0,i.jsxs)(o.View,Object.assign({style:M.searchInputContainer},{children:[(0,i.jsx)(d.default,{icon:v.SkypeIcon.Search,size:v.IconSize.size15,color:this._themeColors.secondaryTextColor,style:M.searchInputIcon}),(0,i.jsx)(o.TextInput,{ref:this._onSearchInputRef,style:e,onChangeText:this.props.onChangeText,value:this.props.searchQuery,placeholder:t,placeholderTextColor:this._themeColors.primaryTextColor,onKeyPress:this._onKeyPress,clearButtonMode:"never",importantForAccessibility:o.Types.ImportantForAccessibility.No,editable:!this.props.disableUi}),this._renderClearButton(),this._renderLoading()]}))},this._renderClearButton=()=>{if(!this.props.isLoading&&""!==this.props.searchQuery)return(0,i.jsx)(l.default,{onPress:this.props.onClearPress,icon:v.SkypeIcon.ClosePanel,size:v.IconSize.size14,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.secondaryTextColor,style:M.closeButton,showHoverEffect:!0,title:u.getString("ContentPanelHeader.SearchInConversationClearTitle")})},this._onSearchInputRef=e=>{this._searchInputRef=e||void 0},this._onKeyPress=e=>{e.keyCode===c.default.ENTER?(!0===e.shiftKey?this.props.searchStore.focusNextMessage():this.props.searchStore.focusPreviousMessage(),this.requestFocus()):e.keyCode===c.default.ESCAPE&&(""!==this.props.searchQuery?this.props.clearSearch():this.props.onCancel(m.MessageSearchToggleOrigin.EscapeKey))}}_buildState(e,t){let s={};t&&(s={leftSpacerWidth:10,rightSpacerWidth:10});const{left:i,right:o}=r.default.getSpacerWidths();return s.leftSpacerWidth=C.default.isTablet()?i:i+p.messageStreamOverflowWidth,s.rightSpacerWidth=C.default.isTablet()?o:o+p.messageStreamOverflowWidth,s.useMobileUI=g.default.isUsingStackNavigationContext()||C.default.isTablet(),s}_getSpacerStyle(e){return T[e]||(T[e]=o.Styles.createViewStyle({flex:1,minWidth:e})),T[e]}render(){const e=[M.innerContainer,this.state.useMobileUI?M.stackNavigationOverrides.innerContainer:void 0,this._themeStyles.dividerBorderColorStyle],t=[M.rowCenterContainer,M.rightContainerStyle,this._themeStyles.dividerBorderColorStyle],s=this.state.useMobileUI?M.stackNavigationOverrides.leftSpacer:this._getSpacerStyle(this.state.leftSpacerWidth),n=this.state.useMobileUI?M.stackNavigationOverrides.rightSpacer:this._getSpacerStyle(this.state.rightSpacerWidth);let r;this.state.useMobileUI||(r=(0,i.jsxs)(o.View,Object.assign({style:t},{children:[(0,i.jsx)(o.View,Object.assign({style:[M.rowCenterContainer,M.innerContainerRight]},{children:this._renderNavigationComponent()})),this._renderCancelButton()]})));const a=this.state.useMobileUI?M.stackNavigationOverrides.centerContainer:M.centerContainer,l=this.state.useMobileUI?M.stackNavigationOverrides.container:M.container;return(0,i.jsxs)(o.View,Object.assign({style:l},{children:[(0,i.jsx)(o.View,{style:s}),(0,i.jsxs)(o.View,Object.assign({style:a},{children:[(0,i.jsxs)(o.View,Object.assign({style:e},{children:[this._renderSearchInput(),r]})),this.state.useMobileUI?this._renderCancelButton():void 0]})),(0,i.jsx)(o.View,{style:n})]}))}requestFocus(){this._searchInputRef&&this._searchInputRef.requestFocus()}}t.default=I},23422:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(889391),r=s(1706),a=s(671830),l=s(297775),d=s(911009),c=s(234196),h=s(225739),u=s(703871),p=s(539549),g=s(986374),m=s(952262),S=s(770891),f=s(110117),y=s(861253),v=s(915877),C=s(733754),_=s(853703),b=s(380622),T=s(654565),M=s(311010),I=s(711828),w=s(619675),P=s(24576),k=s(912770),A=s(388117),x=s(721788),R=s(172758),O=I.IconSize.size15+5,L=I.IconSize.size15,F=(0,v.lazyProperties)({titleContainerNewComposer:()=>o.Styles.createViewStyle({alignItems:"stretch",justifyContent:"center"}),secondRowNewComposer:()=>o.Styles.createViewStyle({flexDirection:"row",marginTop:1,alignItems:"center",overflow:"visible"}),secondRowTextNewComposer:()=>o.Styles.createTextStyle({flex:-1,lineHeight:20}),moodText:()=>o.Styles.createTextStyle({overflow:"visible"}),userPresenceIndicator:()=>o.Styles.createViewStyle({width:8,height:8,borderRadius:4,marginRight:3}),placeholderContainerStyle:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",width:24,height:18}),chatNameIconWrapper:()=>o.Styles.createViewStyle({width:O,height:L}),certifiedIconWrapper:()=>o.Styles.createViewStyle({position:"relative",top:2}),textTruncation:()=>o.Styles.createViewStyle({flexShrink:1}),manageGroupIconWrapper:()=>o.Styles.createViewStyle({width:23,height:20,flexShrink:0}),manageGroupIcon:()=>o.Styles.createTextStyle({paddingLeft:3,paddingTop:2,paddingRight:0,marginRight:0,lineHeight:20,width:23,height:20}),conversationName:()=>o.Styles.createViewStyle({flexShrink:1,flexDirection:"row",marginRight:20})});class B extends P.default{_buildState(e,t){const s=(0,p.default)().getConversation(e.conversationId),i=n.default.getS4LMessagingFeatures(),l=a.isAgent(e.conversationId),d={conversationName:m.default.getDisplayName(R.default.getConversationOwner(e.conversationId)),isEncryptedThread:a.isEncryptedThread(e.conversationId),memberCount:s?Math.max(s.getMemberCount(),0):0,hideBotCoachMark:a.getMriNamespace(e.conversationId)===a.Namespaces.Bot,groupedConversationsEnabled:i.enableGroupedConversations,theme:void 0,isOneOnOne:!!s&&s.isOneOnOne(),isAgent:l,isTrustedAgent:l&&r.default.isTrustedAgent(e.conversationId)},c=e.conversationOwnerMri;if(e.shouldShowUserPresence&&c){const s=R.default.getFullUserProfileByMri(c);if(d.gender=s&&s.gender,d.userPresence=x.default.getCachedUserPresence(c),d.isUserActive=x.default.isActiveUser(c),s.mood&&!e.hideSecondRow){d.theme=this._currentTheme;const e=g.decodeFromContent(s.mood);if(d.moodRawText=s.mood,d.moodLabel=b.getAccessibilityTitle(s.mood),t||!(0,y.default)(d.moodRawText,this.state.moodRawText)||d.theme!==this.state.theme){const t=this._themeColors,s=this._themeStyles,i=[M.default.captionFontStyle(),F.secondRowTextNewComposer,F.moodText];i.push(o.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1));const n={processing:{emoticons:S.ProcessingLevel.Full,quotes:S.ProcessingLevel.None,wikiMarkup:S.ProcessingLevel.Stripped,links:S.ProcessingLevel.Full,atMentions:S.ProcessingLevel.Stripped},renderMedia:!1,mediaPlaceholderIconColor:t.primaryTextColor,allowLargeEmoticons:!1,numberOfLines:1,textOverrideStyle:i,boldTextStyle:i,regularTextStyle:i,linkStyle:s.linkTextColorStyle};d.moodReact=(0,u.renderReact)(e,n).value}else d.moodReact=this.state.moodReact}else d.moodReact=void 0,d.moodRawText=void 0}else d.moodReact=void 0,d.moodRawText=void 0;return d}componentDidMount(){super.componentDidMount(),this._updateLastSeenTextTimer=k.default.setInterval((()=>{this.state.userPresence&&this.state.userPresence.lastSeenAtUtc&&this.isComponentMounted()&&this.forceUpdate()}),6e4),this._fetchUserPresence(this.props)}componentWillUnmount(){super.componentWillUnmount(),this._updateLastSeenTextTimer&&k.default.clearInterval(this._updateLastSeenTextTimer)}_fetchUserPresence(e){e.shouldShowUserPresence&&e.conversationOwnerMri&&T.default.forceFetchPresence(e.conversationOwnerMri)}_userPresenceText(){let e;if(a.isS4BBridgeMri(this.props.conversationId))e=C.getString("ContentPanelHeaderTitle.TeamsInteropSubtitleShort");else{const t=a.isPhoneMri(this.props.conversationId)&&a.isSkypeId(this.props.conversationOwnerMri)||!a.isPhoneMri(this.props.conversationId);e=this.state.userPresence&&!this.state.isAgent&&t?a.getLastSeenPresenceText(this.state.userPresence,!1,this.state.gender,this.state.isUserActive):""}return e}_memberCountText(){return C.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:this.state.memberCount})}render(){const e=[F.titleContainerNewComposer,this.props.style];return this.state.hideBotCoachMark?this._renderWrapperPanelHeader(e):this._renderCoachMarkPanelHeader(e)}_renderSecondRowElement(){let e,t;const s=[F.secondRowTextNewComposer,M.default.fontStyle.messagingStreamChatSubHeader,this.props.isModernizeSmallHeaderMobile?M.default.fontStyle.messagingStreamChatSubHeaderMobile:void 0];if(s.push(o.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1)),!this.props.hidePresenceIndicator&&this.state.userPresence&&this.state.userPresence.status&&(t=A.default.getPresenceIcon(h.default.getPresenceStatusForIcon(this.state.isUserActive,this.state.userPresence),F.userPresenceIndicator,I.IconSize.size8,void 0,void 0)),this.state.moodReact)e=this.state.moodReact;else if(this.props.shouldShowCallRate)this.props.hideSecondRow||this.props.otherPartyMri&&(e=(0,i.jsx)(w.Caption,Object.assign({style:s,numberOfLines:1},{children:this.state.callRateText})));else{const t=this.props.hideSecondRow?void 0:this.props.otherPartyMri?this._userPresenceText():this._memberCountText();e=t?(0,i.jsx)(w.Caption,Object.assign({style:s,numberOfLines:1},{children:t})):void 0}return e||t?(0,i.jsxs)(o.View,Object.assign({style:F.secondRowNewComposer},{children:[t,e]})):void 0}_renderPanelHeader(){const e=this.props.isModernizeSmallHeaderMobile?[M.default.modernizeSmallHeaderMobileFontStyle(this._currentTheme),F.textTruncation]:[M.default.modernizeSmallPanelHeaderFontStyle(this._currentTheme),F.textTruncation],t=this.state.isEncryptedThread&&!this.state.groupedConversationsEnabled?(0,i.jsx)(o.View,Object.assign({style:F.placeholderContainerStyle},{children:(0,i.jsx)(f.default,{icon:I.SkypeIcon.Lock,size:I.IconSize.size24,color:this._themeColors.primaryIconColor})})):void 0,s=this.state.isTrustedAgent?this._getOptionalCertifiedIcon():void 0,n=this.props.isModernizeSmallHeaderMobile||this.state.isTrustedAgent?void 0:this._getOptionalGroupManageIcon();return e.push(o.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1)),(0,i.jsxs)(o.View,Object.assign({style:F.conversationName},{children:[t,(0,i.jsx)(o.Text,Object.assign({style:e,numberOfLines:1,ellipsizeMode:"tail"},{children:this.state.conversationName})),s,n]}))}_getOptionalGroupManageIcon(){return(0,i.jsx)(o.View,Object.assign({style:F.manageGroupIconWrapper},{children:(0,i.jsx)(_.default,{iconColorOverride:this._themeColors.iconHoverColor,onPress:this.props.onTitlePress,accessibilityLabel:C.getString("CallPanel.ManageGroupAccessibilityLabel"),isCompact:!1,iconSize:I.IconSize.size20,style:F.manageGroupIcon,hoverColor:this._themeColors.headerIconColor,disableHoverOpacityStyles:!0},`manageGroupButton-${this.props.conversationId}`)}))}_getOptionalCertifiedIcon(){const e=[F.chatNameIconWrapper,F.certifiedIconWrapper];return(0,i.jsx)(c.default,{botMri:this.props.conversationId,style:e})}_renderWrapperPanelHeader(e){return(0,i.jsxs)(o.Button,Object.assign({onPress:this.props.onTitlePress,style:e},{children:[this._renderPanelHeader(),this.props.hideSecondRow?void 0:this._renderSecondRowElement()]}))}_renderCoachMarkPanelHeader(e){const t=h.default.accessibilityLabel(this.state,!!this.props.hideSecondRow,!!this.props.shouldShowUserPresence,!!this.props.shouldShowCallRate),s={coachMarkType:d.CoachMarkType.ChatProfile,onAnchorPress:this.props.onTitlePress,anchorAccessibilityLabel:t};return(0,i.jsxs)(l.default.Button,Object.assign({style:e,onPress:this.props.onTitlePress,title:t},s,{children:[this._renderPanelHeader(),this.props.hideSecondRow?void 0:this._renderSecondRowElement()]}))}}t.default=B},118192:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardPreviewPanel=void 0;const i=s(785893),o=s(583367),n=s(516778),r=s(4736),a=s(462033),l=s(898278),d=s(746096),c=s(913944),h=s(436237),u=s(710400),p=s(172490),g=s(915877),m=s(733754),S=(s(540897),s(330124)),f=(s(526424),s(29130)),y=s(451070),v=s(581760),C=s(711828),_=s(734528),b=s(680837),T=s(24576),M=(0,g.lazyProperties)({overlayInner:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,flex:1,alignItems:"center",justifyContent:"center"}),containerButton:()=>n.Styles.createButtonStyle({flex:1,alignSelf:"stretch",justifyContent:"center",alignItems:"center"}),closeButton:()=>n.Styles.createViewStyle({position:"absolute",alignItems:"flex-end",top:0,left:0,paddingVertical:12,paddingHorizontal:12}),bottomControlsSingle:()=>n.Styles.createViewStyle({justifyContent:"flex-start",position:"absolute",alignItems:"flex-start",bottom:0,right:0,paddingVertical:12,paddingHorizontal:12}),mojiContainerTransparentDarkTheme:()=>n.Styles.createViewStyle({backgroundColor:v.Color.blackOverlay80})});class I extends T.default{constructor(){super(...arguments),this.backgroundColor=v.Color.transparent,this._opacityAnimationValue=new n.Animated.Value(0),this._opacityAnimationStyle=n.Styles.createAnimatedViewStyle({opacity:this._opacityAnimationValue}),this._onPress=e=>{e.stopPropagation(),this._closePanel()},this._onClose=e=>{e.stopPropagation(),this._closePanel()},this._onBack=()=>(this._closePanel(),h.log(d.LogTraceArea.HardwareBackButton,"goBack: true componentId: KeyboardPreviewPanel"),!0),this._onEscape=()=>(this._closePanel(),!0)}_buildState(e,t){const s=this._getRootViewId(),i=f.default.getDeviceOrientation(s),o=(S.default.isUsingStackNavigationContext(),u.default.getUpdateInfo());let n;n=e.useFullScreen?0:o.height;let r=y.default.statusBarPadding();r&&(r+=10);const a=Object.assign({top:r,bottom:y.default.bottomSafeAreaInset(l.BottomInsetDefault)},y.default.horizontalInsets(l.HorizontalInsetDefault));return{keyboardHeight:n,nativeKeyboardHeight:o.height,windowHeight:f.default.getHeight(s),deviceOrientation:i,safeAreaIsets:a}}_closePanel(){this.props.onClose&&this.props.onClose()}_getDeviceOrientation(){return this.state.deviceOrientation}_getAvailableHeight(){let e=this.state.windowHeight-this.state.keyboardHeight;return this.state.safeAreaIsets.top&&!this.props.useFullScreen&&(e-=this.state.safeAreaIsets.top),e}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this.backgroundColor=this.props.useTransparentDarkTheme?v.Color.transparent:this._themeColors.primaryBackgroundColor}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),t.deviceOrientation!==this.state.deviceOrientation&&this._closePanel()}componentDidMount(){super.componentDidMount(),a.default.subscribe(this._onBack),p.default.addEscapeHandler(this._onEscape),n.Animated.timing(this._opacityAnimationValue,{toValue:1,duration:100,easing:n.Animated.Easing.Linear()}).start()}componentWillUnmount(){super.componentWillUnmount(),a.default.unsubscribe(this._onBack),p.default.removeEscapeHandler(this._onEscape),n.Animated.timing(this._opacityAnimationValue,{toValue:0,duration:100,easing:n.Animated.Easing.Linear()}).start()}render(){const e=[M.overlayInner,this._themeStyles.primaryBackgroundColorStyle,this.props.style];e.push(this._opacityAnimationStyle);const t=this.state.deviceOrientation===o.DeviceOrientation.Landscape?C.IconSize.size20:C.IconSize.size24;let s;if(this.props.showSendButton){const e=[M.bottomControlsSingle];(this.state.safeAreaIsets.right||this.state.safeAreaIsets.right)&&e.push(n.Styles.createViewStyle({bottom:this.state.safeAreaIsets.bottom,right:this.state.safeAreaIsets.right},!1));const t=(0,i.jsx)(r.default,{title:this.props.sendButtonTitle,onPress:this.props.onSend,icon:C.SkypeIcon.Send,importantForAccessibility:n.Types.ImportantForAccessibility.Yes});s=(0,i.jsx)(n.View,Object.assign({style:e,ignorePointerEvents:!0},{children:t}),"buttonsContainer")}let a=_.closeIcon();this.props.useTransparentDarkTheme?(this.backgroundColor=v.Color.transparent,e.push(M.mojiContainerTransparentDarkTheme),a=_.closeIcon()):this.backgroundColor=this._themeColors.primaryBackgroundColor;const l=[M.closeButton];return(this.state.safeAreaIsets.top||this.state.safeAreaIsets.left)&&l.push(n.Styles.createViewStyle({top:this.state.safeAreaIsets.top,left:this.state.safeAreaIsets.left},!1)),(0,i.jsxs)(n.Animated.View,Object.assign({style:e},{children:[(0,i.jsx)(n.Button,Object.assign({style:[M.containerButton,b.default.defaultCursor],onPress:this._onPress,importantForAccessibility:n.Types.ImportantForAccessibility.No},{children:this._renderElement()}),"tapTarget"),(0,i.jsx)(c.default,{style:l,size:t,onPress:this._onClose,color:this.props.useTransparentDarkTheme?v.Color.gray50:this._themeColors.headerIconColor,hoverColor:this.props.useTransparentDarkTheme?v.Color.gray300:this._themeColors.iconHoverColor,icon:a,title:m.getString("Global.CloseButtonTitle")}),s]}))}}t.KeyboardPreviewPanel=I},130886:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MojiPreview=void 0;const i=s(785893),o=s(583367),n=s(516778),r=s(770891),a=s(118192),l=s(915877),d=s(276093),c=s(526424),h=s(758962),u=(0,l.lazyProperties)({mojiContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center"})});class p extends a.KeyboardPreviewPanel{UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),e.moji!==this.props.moji&&this.props.onMojiUpdated&&this.props.onMojiUpdated()}_renderElement(){const e=this._getDeviceOrientation()===o.DeviceOrientation.Landscape,t=this._getOptimalMojiSize(e);return(0,i.jsx)(n.View,Object.assign({style:u.mojiContainer},{children:(0,i.jsx)(d.default,{borderColor:this.props.borderColor||this.backgroundColor,src:this.props.moji.baseUrl,metadataPosition:e?r.MojiMetadataAlign.Right:r.MojiMetadataAlign.Bottom,size:t,isPreviewModeOn:!0,onSend:this.props.onSend,pesID:this.props.moji.id,useTransparentDarkTheme:this.props.useTransparentDarkTheme||this._useDarkTheme(),showReplayButtonAfterPlay:this.props.showReplayOnMojiAfterPlay,autoPlay:!0,setAccessibilityFocusOnMoji:this.props.setAccessibilityFocusOnMoji},this.props.moji.id)}))}_getPesInlineSearchTotalHeight(){return c.MojiInlineSearchTotalHeight}_getOptimalMojiSize(e){let t=r.MojiSize.Large;const s=e?this._getAvailableHeight():this._getAvailableHeight()-c.MojiPreviewMetadataHeight;return s<=h.frameHeights.moji.Size80?t=r.MojiSize.Small:s<=h.frameHeights.moji.Size108?t=r.MojiSize.MediumSmall:s<=h.frameHeights.moji.Size200&&(t=r.MojiSize.Medium),t}}t.MojiPreview=p},944720:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(338173),r=s(249758),a=s(476621),l=s(871908),d=s(671830),c=s(539549),h=s(557102),u=s(952262),p=s(746096),g=s(436237),m=s(733754),S=s(293194),f=s(735370),y="learnMore";class v{constructor(e,t,s,v){if(this._conversationIds=e,this._getAnchor=t,this._rootViewId=s,this._deletionSource=v,this._isBot=!1,this._getDeleteChatMenuItems=e=>{const t=[{text:e?m.getString("InfoPanel.ClearGroupConfirmationConfirmButtonTitle"):m.getString("ConfirmationDialog.DeleteLabel"),command:"deleteChat"}];return e&&t.push({text:m.getString("Global.LearnMore"),command:y}),{items:t,destructiveIndex:0}},this._deleteBotChat=()=>{if(!this._otherPartyMri)return o.Resolved();const e=d.stripMriNamespace(this._otherPartyMri);return g.track(new r.BotContactInteraction(p.BotsInteraction.DeleteBot,e,u.default.getDisplayName(this._conversationIds[0])||"")),n.default.removeAgentFromContacts(e)},this._deleteChat=()=>{const e=i.map(this._conversationIds,(e=>a.default.ensureConversationLoaded(e).then((()=>{if((0,c.default)().isConversationKnown(e)){const t=f.getConversationTypeForTelemetry(e);l.deleteConversationAsync(e,this._deletionSource,t)}}))));return o.all(e)},this._deleteConversation=()=>this._isBot?this._deleteBotChat().then(this._deleteChat):this._deleteChat(),this._onHandleDeleteChatMenuCommand=e=>{e===S.SXActionMenuCancel||this._handled||(e!==y?(this._handled=!0,this._deleteConversation().then((()=>{this._deffered.resolve(!0)})).catch((e=>{this._deffered.reject(e)}))):h.ConversationUtils.openClearLeaveConversationLearnMore())},this._onHandleCancelCommand=()=>{this._handled||(this._handled=!0,this._deffered.resolve(!1))},this._deffered=o.Defer(),this._handled=!1,1===e.length){const t=(0,c.default)().getConversation(e[0]);this._isGroupConv=!(!t||!d.isGroupConversation(t.id));const s=t&&t.isOneOnOne()?t.getOtherPartyMri():void 0;s&&(this._otherPartyMri=s,this._isBot=d.isAgent(s))}}open(){const e=this._isBot?m.getString("UserProfilePanel.DeleteBotConfirmationContent"):h.ConversationUtils.getDeleteConfirmationTitle(this._conversationIds);let t;t=this._isBot?m.getString("UserProfilePanel.DeleteBotConfirmationDialogContent"):this._conversationIds.length>1?m.getString("InfoPanel.DeleteConfirmationDialogContentGroup",{name:u.default.getShortDisplayName(this._conversationIds[0])||""}):this._isGroupConv?m.getString("InfoPanel.ClearGroupConfirmationDialogContent"):m.getString("InfoPanel.DeleteConfirmationDialogContent");const s=this._getDeleteChatMenuItems(this._isGroupConv),i={anchor:this._getAnchor,buttons:s.items,cancelButtonPosition:S.CancelButtonPosition.End,title:e,message:t,dialogAccessibilityTitle:t,destructiveButtonIndex:s.destructiveIndex};S.default.showWithActionMenuConfig({options:i,callback:this._onHandleDeleteChatMenuCommand,onCancel:this._onHandleCancelCommand,useAlertForDesktop:!0,useAlertForMobile:!1,rootViewId:this._rootViewId,invokingEvent:void 0})}getPromise(){return this._deffered.promise()}}v.showDialog=(e,t,s,i)=>{const o=new v(e,t,s,i);return o.open(),o.getPromise()},t.default=v},978118:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(61375),o=s(671830),n=s(878364),r=s(557102),a=s(341706),l=s(125793),d=s(733754),c=s(921090),h=s(69413),u=s(293194),p="delete",g="clear",m="endPrivate",S="safeCode";class f{constructor(e,t,s){this._convId=e,this._anchor=t,this._context=s,this._getOverflowMenuItems=()=>{const e=[];if(o.isEncryptedThread(this._convId)){const t=a.default.getHandshakeState(this._convId);t===l.SecureHandshakeState.Completed&&e.push({text:d.getString("InfoPanel.SafeCodeLabel"),command:S}),t!==l.SecureHandshakeState.None&&e.push({text:d.getString("InfoPanel.EndConversationLabel"),command:m})}return o.isOneOnOneConversation(this._convId)?e.push({text:r.ConversationUtils.getDeleteConfirmationTitle([this._convId]),command:p}):e.push({text:d.getString("InfoPanel.ClearGroupConfirmationDialogTitle"),command:g}),e},this._selectOverflowMenuItem=(e,t)=>{switch(u.default.dismiss(f.MenuId,t),e){case p:(0,n.deleteConversation)(this._convId,this._anchor,this._context,"ConversationTabActionMenu",i.DeleteConversationSource.TabSwitcher);break;case m:(0,h.endPrivateConversation)(this._convId,t);break;case S:(0,h.showPrivateConversationSafeCode)(this._convId,t)}},this._actionMenuConfig={anchor:t,useTheme:!0,positionPriorities:["bottom","top"],popupBeakSize:{height:0,width:0}}}show(e){const t=c.rootViewIdForComponentContext(this._context);u.default.showWithOptions({id:f.MenuId,config:this._actionMenuConfig,getMenuItems:this._getOverflowMenuItems,handleMenuCommand:e=>this._selectOverflowMenuItem(e,t),rootViewId:t,invokingEvent:e})}static open(e,t,s,i){new f(t,s,i).show(e)}}f.MenuId="ConversationActionMenuId",t.default=f},565752:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(996074),r=s(898278),a=s(915877),l=s(89808),d=s(915415),c=s(619675),h=s(912770),u=(0,a.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",flexDirection:"column",paddingHorizontal:40,paddingBottom:40,justifyContent:"center"}),message:()=>o.Styles.createTextStyle({alignSelf:"center",textAlign:"center",marginVertical:20})});class p extends n.default{constructor(){super(...arguments),this._announceA11y=()=>{this.isComponentMounted()&&this._isComponentVisible()&&this._a11yTimer&&(h.default.clearTimeout(this._a11yTimer),this._a11yTimer=void 0,o.Accessibility.announceForAccessibility(this.props.message))}}componentDidMount(){super.componentDidMount(),this._a11yTimer=h.default.setTimeout(this._announceA11y,500)}componentWillUnmount(){super.componentWillUnmount(),this._a11yTimer&&h.default.clearTimeout(this._a11yTimer)}render(){return(0,i.jsxs)(o.View,Object.assign({style:u.container},{children:[(0,i.jsx)(d.default,{size:r.SXActivityIndicatorSize.Large,tintColor:l.default.getPrimaryColorNoSubscription()}),(0,i.jsx)(c.BodyText,Object.assign({bold:!0,style:u.message},{children:this.props.message}))]}))}}t.default=p},31714:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NewChatMenuItem=void 0;const i=s(785893),o=s(516778),n=s(898278),r=s(913944),a=s(915877),l=s(311010),d=s(711828),c=s(24576),h=(0,a.lazyProperties)({row:()=>o.Styles.createViewStyle({flex:1,justifyContent:"flex-start",flexDirection:"row",alignItems:"center",paddingVertical:n.NewChatMenuItemSizes.paddingVertical}),icon:()=>o.Styles.createViewStyle({width:d.IconSize.size20,height:d.IconSize.size20,marginHorizontal:20,justifyContent:"center"}),title:()=>o.Styles.createViewStyle({alignSelf:"center"})});class u extends c.default{constructor(){super(...arguments),this._onItemRef=e=>{this._itemRef=e||void 0},this._onPress=e=>{this.props.onPressItem(this.props.info.command,(()=>this._itemRef),this._getRootViewId(),e.shiftKey||e.metaKey)}}render(){const e=l.default.rowTitleFontStyle(this._currentTheme);return(0,i.jsxs)(o.View,Object.assign({style:h.row,importantForAccessibility:o.Types.ImportantForAccessibility.Yes,accessibilityLabel:this.props.info.title,onPress:this._onPress,ref:this._onItemRef},{children:[(0,i.jsx)(r.default,{style:h.icon,icon:this.props.info.icon,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,size:d.IconSize.size20}),(0,i.jsx)(o.Text,Object.assign({style:[h.title,e]},{children:this.props.info.title}))]}))}}t.NewChatMenuItem=u,t.default=u},509341:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(396265),r=s(516778),a=s(898278),l=s(790070),d=s(766649),c=s(915877),h=s(733754),u=s(812462),p=s(31714),g=s(711828),m=s(680837),S=s(24576),f=(0,c.lazyProperties)({panel:()=>r.Styles.createViewStyle({flex:1,justifyContent:"flex-start",alignContent:"flex-start",alignSelf:"stretch",marginTop:10}),itemDivider:()=>r.Styles.createViewStyle({height:1,marginHorizontal:10})});class y extends S.default{constructor(){super(...arguments),this._renderItem=(e,t)=>[(0,i.jsx)(p.NewChatMenuItem,{onPressItem:this._onHandleCommand,info:e},e.key),(0,i.jsx)(r.View,{style:[f.itemDivider,this._themeStyles.dividerColorStyle]},"itemDivider")],this._onHandleCommand=(e,t,s,i)=>{l.default.handleAddMenuCommand(e,t,s,!0,i)}}_buildState({commands:e},t){const s={isUsingGogoNetwork:d.default.isUsingGogoNetwork()};return{menuItems:this._generateMenuItems(e,s)}}render(){return(0,i.jsx)(r.View,Object.assign({style:m.default.flexOne},{children:(0,i.jsx)(n.VirtualListView,{style:f.panel,itemList:this.state.menuItems,renderItem:this._renderItem,clickOnEnterPress:!0,accessibilityTrait:r.Types.AccessibilityTrait.None,animateChanges:!1,skipRenderIfItemUnchanged:!0,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,hoveredItemStyle:this._themeStyles.rowHoverViewStyle,showOverflow:!1,onInitialRenderComplete:this.props.onInitialRenderComplete,restoreFocusAfterUpdate:!0,disableScrolling:!0})}))}_generateMenuItems(e,t){return o.compact(o.map(e,(e=>this._menuItemForHubCommand(e,t))))}static calculateHeight(e){return e*a.NewChatMenuItemSizes.height+65}_menuItemForHubCommand(e,t){switch(e){case l.HubCommands.AddConversationGroupCommand:return{key:e,command:e,height:a.NewChatMenuItemSizes.height,template:e,icon:g.SkypeIcon.ContactGroupAdd,title:h.getString("Hub.NewGroupChatLabel")};case l.HubCommands.AddConversationModeratedGroupCommand:return{key:e,command:e,height:a.NewChatMenuItemSizes.height,template:e,icon:g.SkypeIcon.ContactGroup,title:h.getString("Hub.NewModeratedGroupChatShortLabel")};case l.HubCommands.AddConversationPrivateCommand:return{key:e,command:e,height:a.NewChatMenuItemSizes.height,template:e,icon:g.SkypeIcon.Privacy,title:h.getString("Hub.NewPrivateChatShortLabel")};case l.HubCommands.AddBotCommand:return{key:e,command:e,height:a.NewChatMenuItemSizes.height,template:e,icon:g.SkypeIcon.BotAdd,title:h.getString("Hub.FindBotLabel")};case l.HubCommands.NewGroupCallCommand:return{key:e,command:e,height:a.NewChatMenuItemSizes.height,template:e,icon:g.SkypeIcon.CallAdd,title:h.getString("Hub.NewCallLabel"),disabled:t.isUsingGogoNetwork};case l.HubCommands.NewCellularSmsConversationCommand:return{key:e,command:e,height:a.NewChatMenuItemSizes.height,template:e,icon:g.SkypeIcon.MobileSmsNew,title:h.getString("Hub.NewCellularSmsChatLabel")};case l.HubCommands.NewMeetNowCommand:return{key:e,command:e,height:a.NewChatMenuItemSizes.height,template:e,icon:u.default.getMeetNowIcon(),title:h.getString("MeetNow.FeatureName")}}}}t.default=y},285677:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(557102),r=s(952262),a=s(733754),l=s(293194),d="deleteChat",c="deleteAll",h="__DELIMITER__";class u{constructor(e,t,s){this._convIds=e,this._getAnchor=t,this._rootViewId=s,this._getDeleteChatMenuItems=()=>{const e=[];return i.each(this._convIds,(t=>{e.push({text:n.ConversationUtils.getConversationTitleForSelection(t),command:d+h+t.mri})})),e.push({text:a.getString("InfoPanel.DeleteAll"),command:c}),{items:e,destructiveIndex:e.length-1}},this._handleCommand=e=>{const[t,s]=e.split(h);switch(t){case d:this._deffered.resolve([s]);break;case c:this._deffered.resolve(this._convIds.map((e=>e.mri)));break;case l.SXActionMenuCancel:this._deffered.resolve(void 0)}},this._deffered=o.Defer()}open(){const e=this._getDeleteChatMenuItems(),t=a.getString("InfoPanel.WhichConversationToDelete",{name:r.default.getShortDisplayName(this._convIds[0].mri)||""}),s={anchor:this._getAnchor,buttons:e.items,cancelButtonPosition:l.CancelButtonPosition.End,title:a.getString("InfoPanel.DeleteConfirmationDialogTitle"),message:t,dialogAccessibilityTitle:t,destructiveButtonIndex:e.destructiveIndex};l.default.showWithActionMenuConfig({options:s,callback:this._handleCommand,useAlertForDesktop:!0,rootViewId:this._rootViewId,invokingEvent:void 0,suppressModalDismissalEvents:!0})}getPromise(){return this._deffered.promise()}}u.showDialog=(e,t,s)=>{const i=new u(e,t,s);return i.open(),i.getPromise()},t.default=u},938931:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(110117),r=s(915877),a=s(733754),l=s(106658),d=s(451070),c=s(681115),h=s(711828),u=s(680837),p=s(619675),g=s(24576),m=s(587331),S=(0,r.lazyProperties)({container:()=>o.Styles.createViewStyle({flexDirection:"row",paddingHorizontal:20,paddingVertical:15}),textContainer:()=>o.Styles.createViewStyle({paddingHorizontal:10}),heading:()=>o.Styles.createTextStyle({marginBottom:10})});class f extends g.default{constructor(){super(...arguments),this.onToggle=(e,t)=>{this.props.onChange(t)}}_buildState(e){return{bottomSafeAreaInset:d.default.bottomSafeAreaInset()}}render(){const e=this.state.bottomSafeAreaInset?c.default.paddingBottomStyle(this.state.bottomSafeAreaInset):void 0;return(0,i.jsxs)(o.View,Object.assign({style:[S.container,e,this.props.style]},{children:[(0,i.jsx)(n.default,{icon:h.SkypeIcon.Link,size:h.IconSize.size20,color:this._themeColors.primaryIconColor}),(0,i.jsxs)(o.View,Object.assign({style:[S.textContainer,u.default.flexOne]},{children:[(0,i.jsx)(p.BodyText,Object.assign({style:S.heading},{children:a.getString("SetConversationParticipantsPanel.ShareLinkFooterHeading")})),(0,i.jsx)(p.Caption,Object.assign({messageStreamFontSize:l.MessageStreamFontSize.Large},{children:a.getString("SetConversationParticipantsPanel.ShareLinkFooterCaption")}))]})),(0,i.jsx)(m.default,{isOn:this.props.shareLink,onChange:this.onToggle})]}))}}t.default=f},832749:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(996074),r=s(316760),a=s(746096),l=s(436237),d=s(915877),c=s(733754),h=s(104735),u=s(190631),p=s(680837),g=s(853374),m=(0,d.lazyProperties)({locationPanel:()=>o.Styles.createViewStyle({flex:1,alignItems:"stretch"})});class S extends n.default{constructor(){super(...arguments),this._onCloseButtonRef=e=>{this._closeButtonRef=e||void 0},this._onClose=()=>{const e=g.default.newCauseId(),t=this._getContext();l.log(a.LogTraceArea.Navigation,"DesktopLocationPanel._onCloseButtonClick,  causeId: "+e),this.props.displayInModal?h.default.closeGenericDesktopModal(e,this._getRootViewId()):h.default.closeFindPanel(e,t)}}static getHeaderText(){return c.getString("LocationPicker.SendLocation")}componentDidMount(){super.componentDidMount(),this._closeButtonRef&&this._closeButtonRef.requestFocus()}render(){const e={setButtonRef:this._onCloseButtonRef};e.closeButtonType=u.CloseButtonType.Close,e.onPress=this._onClose;const t=(0,i.jsx)(u.SimplePanelHeader,{panelName:S.getHeaderText(),leftButton:e,useCenteredControls:!0});return(0,i.jsxs)(o.View,Object.assign({style:[m.locationPanel,this._themeStyles.primaryBackgroundColorStyle]},{children:[t,this._renderPanelContent()]}))}_renderPanelContent(){return(0,i.jsx)(r.default,{style:[p.default.flexOne,p.default.overflowVisible],conversationId:this.props.conversationId,displayInPopUp:!1,displayInModal:!!this.props.displayInModal})}_componentId(){return"LocationPanel"}}t.default=S},316760:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(482897),r=s(783407),a=s(516778),l=s(996074),d=s(351077),c=s(898278),h=s(609143),u=s(404336),p=s(341444),g=s(746096),m=s(746096),S=s(139285),f=s(497174),y=s(436237),v=s(915877),C=s(733754),_=s(62523),b=s(46634),T=s(546705),M=s(751176),I=s(624897),w=s(89808),P=s(18078),k=s(104735),A=s(913168),x=s(785207),R=s(29130),O=s(415963),L=s(915415),F=s(478262),B=s(680837),D=s(853374),E=700,V=450,N=(0,v.lazyProperties)({container:()=>a.Styles.createViewStyle({width:322,flexDirection:"column",borderRadius:3}),containerPopUp:()=>a.Styles.createViewStyle({width:E,height:V,flexDirection:"row",borderRadius:3}),containerModal:()=>a.Styles.createViewStyle({width:u.DefaultWidth,flexDirection:"column",borderRadius:3}),centerContent:()=>a.Styles.createViewStyle({justifyContent:"center",alignItems:"center",position:"absolute",top:0,bottom:0,right:0,left:0}),mobileSize:()=>(0,v.lazyProperties)({containerPopUp:()=>a.Styles.createViewStyle({width:320,height:V,flexDirection:"column",borderRadius:3}),placesContainerPopUp:()=>a.Styles.createViewStyle({width:320,height:V-180})}),map:()=>a.Styles.createViewStyle({justifyContent:"center",minHeight:280,flexBasis:1}),places:()=>(0,v.lazyProperties)({container:()=>a.Styles.createViewStyle({width:-78,height:700}),containerPopUp:()=>a.Styles.createViewStyle({width:E-400,height:V}),containerModal:()=>a.Styles.createViewStyle({width:u.DefaultWidth,flexBasis:1})})});class U extends l.default{constructor(){super(...arguments),this._setMapRef=e=>{this._map=e||void 0},this._onMapLoaded=()=>{this.isComponentMounted()&&this.setState({mapLoaded:!0})},this._onCurrentLocationChanged=e=>{this.isComponentMounted()&&this.setState({currentSelectedLocation:{latitude:e.latitude,longitude:e.longitude,latitudeDelta:_.LatitudeDelta,longitudeDelta:_.LongitudeDelta},selectedPlace:e,locationType:F.LocationType.Custom})},this._setSearchInputControlRef=e=>{this._searchInputControl=e||void 0},this._onInputTextChange=e=>{if(!this.isComponentMounted())return;const t=e.trim();this.setState({rawSearchQuery:e}),this._setSearchQuery(t)},this._setSearchQuery=o.throttle((e=>{this.isComponentMounted()&&this.setState({searchQuery:e})})),this._onCancelSearchPress=()=>{this.state.isSearchingPlaceActive&&(y.track(new T.LocationPickerSearchCancel(this.state.locationType)),this._blurSearchInput(),this.isComponentMounted()&&this.setState({rawSearchQuery:"",isSearchingPlaceActive:!1}))},this._onSetInitialLocation=e=>{this.isComponentMounted()&&this.setState({currentSelectedLocation:{latitude:e.latitude,longitude:e.longitude,latitudeDelta:_.LatitudeDelta,longitudeDelta:_.LongitudeDelta}})},this._onNearByPlaceFromSearchSelected=e=>{this._onNearByPlaceSetState(e,F.LocationType.Search),y.track(new T.LocationPickerNearbyClicked(F.LocationType.Search))},this._onSendPress=e=>{let t;const s=e.name,i=e.address;if(t=s===i?i:C.getString("LocationPicker.FullAddress",{addressFriendlyName:s,address:i}),t||(t=C.getString("LocationPicker.LocationSharedFallback")),!this.props.conversationId)return;const{latitude:o,longitude:r}=e,a=new f.LinkEntity(t,M.default.getBingMapsLocationUrl({latitude:o,latitudeDelta:_.LatitudeDelta,longitude:r,longitudeDelta:_.LongitudeDelta},s)),l=new f.GeoLocationEntity(this.state.locationType===F.LocationType.Current,P.default.getSkypeMri(),o,r,void 0,(new Date).getTime(),n.default.getDefaultId(),void 0,C.getLocale(),C.getLanguageFromLocale(),t,void 0,void 0,s,i,[a]);x.default.postMessageFromInput(this.props.conversationId,g.PostSource.LocationPicker,[l],d.MessageTypes.Location,{name:O.ScenarioName.SendLocation}),y.track(new T.LocationPickerSend(this.state.locationType));const c=D.default.newCauseId(),h=this._getContext();y.log(m.LogTraceArea.Navigation,"DesktopLocationWidget._onSendPress,  causeId: "+c),this.props.displayInPopUp?I.default.dismissPopup(this._getRootViewId()):this.props.displayInModal?k.default.closeGenericDesktopModal(c,this._getRootViewId()):k.default.closeFindPanel(c,h)}}_buildState(e,t){const s=this._getRootViewId(),i={isMobileScreenSize:R.default.isMobileScreenSize(s)||R.default.isMinDesktopWidth(s),locationType:t?F.LocationType.None:this.state.locationType,rawSearchQuery:t?"":this.state.rawSearchQuery},o=b.default.getLocationForBing();return t&&o&&(i.currentSelectedLocation={latitude:o.coords.latitude,longitude:o.coords.longitude,latitudeDelta:_.LatitudeDelta,longitudeDelta:_.LongitudeDelta}),i}componentDidMount(){super.componentDidMount(),y.track(new T.LocationPickerNavigationOpen(this.state.locationType))}componentWillUnmount(){super.componentWillUnmount(),y.track(new T.LocationPickerNavigationClose(this.state.locationType))}render(){let e,t;e=this.props.displayInPopUp?this.state.isMobileScreenSize?N.mobileSize.containerPopUp:N.containerPopUp:this.props.displayInModal?[N.containerModal,B.default.flexOne]:N.container,this.state.mapLoaded||(t=(0,i.jsx)(a.View,Object.assign({style:[e,N.centerContent,this._themeStyles.primaryBackgroundColorStyle]},{children:(0,i.jsx)(L.default,{size:c.SXActivityIndicatorSize.Large,tintColor:w.default.getPrimaryColorNoSubscription()})})));const s=(0,i.jsx)(S.default,Object.assign({style:[B.default.flexOne,this.props.displayInPopUp?void 0:N.map]},{children:(0,i.jsx)(h.DesktopBingMap,{ref:this._setMapRef,onCurrentLocationChanged:this._onCurrentLocationChanged,onLocationSend:this._onSendPress,onSetInitialLocation:this._onSetInitialLocation,onMapLoaded:this._onMapLoaded})}));let o;o=this.props.displayInPopUp?this.state.isMobileScreenSize?N.mobileSize.placesContainerPopUp:N.places.containerPopUp:this.props.displayInModal?N.places.containerModal:N.places.container;const n=(0,i.jsxs)(a.View,Object.assign({style:[this.props.displayInPopUp?void 0:B.default.flexOne,o]},{children:[(0,i.jsx)(a.View,{children:(0,i.jsx)(p.default,{ref:this._setSearchInputControlRef,blurOnSubmit:!0,autoFocus:!0,searchInputSmallMode:!0,hideCloseButton:!0,rawSearchQuery:this.state.rawSearchQuery,onInputTextChange:this._onInputTextChange,cancelSearch:this._onCancelSearchPress})}),(0,i.jsx)(a.View,Object.assign({style:B.default.flexOne},{children:(0,i.jsx)(A.default,{locationType:this.state.locationType,style:B.default.flexOne,query:this.state.searchQuery,searchModeOn:!0,latitude:this.state.currentSelectedLocation&&this.state.currentSelectedLocation.latitude,longitude:this.state.currentSelectedLocation&&this.state.currentSelectedLocation.longitude,sendItem:this._onSendPress,onItemSelected:this._onNearByPlaceFromSearchSelected})}))]}));return(0,i.jsxs)(a.View,Object.assign({style:e},{children:[s,n,t]}))}_blurSearchInput(){this._searchInputControl&&this._searchInputControl.blurInput()}_onNearByPlaceSetState(e,t){this._blurSearchInput(),this._map&&this._map.sendCommand({type:r.Commands.SetNearbyLocation,location:{address:e.address,name:e.name,region:{center:{latitude:e.latitude,longitude:e.longitude},width:_.LatitudeDelta,height:_.LongitudeDelta}}})}}t.default=U},542683:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(396265),r=s(516778),a=s(711930),l=s(898278),d=s(400984),c=s(23293),h=s(182146),u=s(104735),p=s(816402),g=s(770891),m=s(746096),S=s(680115),f=s(644949),y=s(359405),v=s(915877),C=s(733754),_=s(268080),b=s(764387),T=s(217093),M=s(932226),I=s(874636),w=s(785207),P=s(667806),k=s(915415),A=s(581760),x=s(619675),R=s(24576),O=s(562141),L=s(518606),F=s(124221),B=s(436237),D=s(715598),E="bottomSpacer",V="g_",N="d_",U="activityIndicator",j=(0,v.lazyProperties)({panel:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),dateHeaderTextEnhanced:()=>r.Styles.createTextStyle({fontSize:18}),dateHeaderText:()=>r.Styles.createTextStyle({marginLeft:10,marginTop:16}),bottomSpacer:()=>r.Styles.createViewStyle({height:20,flex:0,backgroundColor:A.Color.transparent}),activityIndicator:()=>r.Styles.createViewStyle({flex:1,height:100,paddingVertical:20,alignContent:"center",alignItems:"center",justifyContent:"center"}),dateHeader:()=>r.Styles.createViewStyle({flexDirection:"row",marginLeft:10,marginVertical:20,justifyContent:"flex-start",flexGrow:1}),iconStyle:()=>r.Styles.createTextStyle({justifyContent:"flex-end",paddingBottom:1.5})});class H extends R.default{constructor(){super(...arguments),this._lastScrollTop=0,this._hasRenderedLastItem=!1,this._postedItemsIds=[],this._onListViewRef=e=>{this._listView=e||void 0},this._onScroll=(e,t)=>{if(e>=this._lastScrollTop&&this._hasRenderedLastItem){let e=h.RetrievalMask.All;switch(this.props.viewMode){case T.GalleryViewMode.Media:e=h.RetrievalMask.Media;break;case T.GalleryViewMode.Files:e=h.RetrievalMask.Files;break;case T.GalleryViewMode.Links:e=h.RetrievalMask.Links}h.default.fetchMoreMessages(this.props.conversationId,e)}this._lastScrollTop=e},this._renderItem=(e,t)=>{if(o.isUndefined(e.index))return[];if(this._hasRenderedLastItem=e.index>=this.state.galleryItemResults.length-20,e.key===E)return(0,i.jsx)(r.View,{style:j.bottomSpacer});if(e.key===U)return(0,i.jsx)(r.View,Object.assign({style:j.activityIndicator},{children:(0,i.jsx)(k.default,{size:l.SXActivityIndicatorSize.Large,tintColor:this.state.primaryColor})}));const s=e.key.substring(0,2);if(s===V){const t=this.state.galleryItemResults[e.index];return(0,i.jsx)(P.StreamItem,{message:t,isFirstInGroup:!0,isLastInGroup:!0,isLastMessage:!0,isReadOnly:!1,isLastPhotoByCurrentUser:!1,renderOrigin:g.MessageRenderOrigin.CompositeGalleryCanvas,isConversationAccepted:this.state.isConversationAccepted,disableReactions:!0,disableSelectMultipleMessages:!0,onItemPress:this._onItemPress,onRevealInConvPress:this._onRevealInConvPress,getRootWindowComponent:this._getListView})}if(s===N){const t=parseInt(e.key.slice(2),10),s=p.default.getDisplayDateString(t),o=a.default.headerAccessibilityInfo(s),n=p.default.getMidnight(t);return(0,i.jsx)(r.Button,Object.assign({onPress:()=>this._onPressDateItem(n),accessibilityLabel:o.accessibilityLabel,accessibilityTraits:o.accessibilityTraits,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,style:[j.dateHeader]},{children:(0,i.jsx)(x.Subtitle,Object.assign({accessibilityHidden:!0,style:j.dateHeaderTextEnhanced},{children:s}))}))}return(0,i.jsx)(r.View,{})},this._getListView=()=>this._listView,this._onPressDateItem=o.debounce((e=>{const{conversationId:t}=this.props;O.default.getMessagesForConversationAfterTime(t,e,1,!1).then((e=>{var s;this.isComponentMounted&&t===this.props.conversationId&&(u.default.navigateToMessageFromSearchMessagePanel(null===(s=e[0])||void 0===s?void 0:s.createdTime,t,this._getRootViewId()),B.track(new F.EnhancedHistorySearchEvent(F.EnhancedHistorySearchActionType.Date)))})),this.props.onClose()}),300),this._onRevealInConvPress=o.debounce(((e,t)=>{e.preventDefault(),e.stopPropagation();const{conversationId:s}=this.props;(0,y.getGalleryItemTimestamp)(t.cuid,s,Number(t.getOriginalServerId())).then((e=>{if(!this.isComponentMounted||s!==this.props.conversationId)return;let i;if(t.isAlbumItem()){i=L.default.getAlbumMessage(t.getAlbumId()).createdTime}u.default.navigateToMessageFromSearchMessagePanel(i||(null==e?void 0:e.timestamp)||t.createdTime,s,this._getRootViewId()),B.track(new F.EnhancedHistorySearchEvent(F.EnhancedHistorySearchActionType.Reveal))})),this.props.onClose()}),300),this._onItemPress=(e,t)=>{e.preventDefault(),e.stopPropagation(),(0,D.notifyOpenAI)(t),b.default.isMediaItem(t)&&(I.pictureViewerWillOpen(),_.default.showWithMessageConfig({initialMessage:t,animateOpenClose:!0,reverseOrder:!1,rootViewId:this._getRootViewId(),origin:m.NavigationMediaViewerOrigin.Gallery}))}}_buildState(e,t){return Object.assign(Object.assign({isConnectedToNetwork:M.default.isConnected(),isConversationAccepted:d.default.isConversationAccepted(e.conversationId)},this._buildResults(e,!o.isEmpty(this._postedItemsIds),t)),{primaryColor:c.default.getPrimaryColor(e.conversationId)})}_buildResults(e,t,s=!1){let i=[];const r=[];let a,l=h.RetrievalState.None;switch(e.viewMode){case T.GalleryViewMode.None:i=[],l=h.RetrievalState.None;break;case T.GalleryViewMode.All:i=h.default.getCombinedItemsForConversation(e.conversationId,Date.now(),10,s,!0),l=h.default.getCombinedRetrievalState(e.conversationId);break;case T.GalleryViewMode.Media:i=h.default.getMediaForConversation(e.conversationId,Date.now(),10,s,!0),l=h.default.getMediaRetrievalState(e.conversationId);break;case T.GalleryViewMode.Files:i=h.default.getFilesForConversation(e.conversationId,Date.now(),10,s,!0),l=h.default.getFilesRetrievalState(e.conversationId);break;case T.GalleryViewMode.Links:i=h.default.getLinksForConversation(e.conversationId,Date.now(),10,s,!0),l=h.default.getLinksRetrievalState(e.conversationId)}return t&&r.push({key:U,height:100,template:"activityIndicator",isNavigable:!1,index:0}),o.each(i,((e,t)=>{a&&p.default.isSameDay(a,e.createdTime)||(a=e.createdTime,r.push({key:N+a,height:36,index:t,template:"dgcl_dateItem",isNavigable:!1,accessibilityGroup:n.Types.AccessibilityGroupMarker.Begin,accessibilityGroupLabel:p.default.getDisplayDateString(a)})),r.push({key:V+e.cuid,height:200,template:"dgcl_galleryItem",index:t,measureHeight:!0})})),i.length>0&&r.push({key:E,height:20,template:"dgcl_spacer",isNavigable:!1}),{galleryItemResults:i,galleryItemList:r,retrievalState:l}}componentDidMount(){super.componentDidMount(),this._telemetryScenarioSingleton=f.GalleryTelemetryScenario.getInstance(!0),this._postCreatedSubscriptionToken=w.default.postCreated.subscribe((e=>{o.isEmpty(e.amsUploads)||(this._postedItemsIds.push(e.postTime),this.isComponentMounted()&&!e.editedMessageCuid&&o.includes(e.conversationIds,this.props.conversationId)&&this.setState(this._buildResults(this.props,!0)))})),this._postUpdatedSubscriptionToken=w.default.postUpdated.subscribe((e=>{if(!o.isEmpty(e.amsUploads)){const t=this._postedItemsIds.indexOf(e.postTime);e.isFinished&&t>-1&&this._postedItemsIds.splice(t,1),0===this._postedItemsIds.length&&this.setState(this._buildResults(this.props,!1))}}))}shouldComponentUpdate(e,t,s){return e.viewMode!==T.GalleryViewMode.None&&super.shouldComponentUpdate(e,t,s)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this._telemetryScenarioSingleton&&(e.conversationId!==this.props.conversationId?(this._telemetryScenarioSingleton.markStep(f.GalleryScenarioStep.ConversationChanged),this._telemetryScenarioSingleton=f.GalleryTelemetryScenario.getInstance(!0)):e.viewMode!==this.props.viewMode&&this._telemetryScenarioSingleton.markChangedViewMode(e.viewMode))}componentWillUnmount(){super.componentWillUnmount(),this._telemetryScenarioSingleton.markStep(f.GalleryScenarioStep.GalleryClosed),f.GalleryTelemetryScenario.destroyInstance(),this._postCreatedSubscriptionToken&&(this._postCreatedSubscriptionToken.unsubscribe(),this._postCreatedSubscriptionToken=void 0),this._postUpdatedSubscriptionToken&&(this._postUpdatedSubscriptionToken.unsubscribe(),this._postUpdatedSubscriptionToken=void 0)}render(){const e=this._renderStatus(),t=e?null:(0,i.jsx)(n.VirtualListView,{ref:this._onListViewRef,style:j.panel,itemList:this.state.galleryItemList,renderItem:this._renderItem,animateChanges:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,clickOnEnterPress:!0,onScroll:this._onScroll,accessibilityLabel:C.getString("ContentPanelHeaderTitle.Gallery")},"gallery"+this.props.viewMode);return e||t}_renderStatus(){if(!this.state.isConnectedToNetwork){if(this.state.galleryItemResults.length)return;{let e;switch(this.props.viewMode){case T.GalleryViewMode.Media:e=C.getString("GalleryMediaPanel.NoConnectionMedia");break;case T.GalleryViewMode.Files:e=C.getString("GalleryMediaPanel.NoConnectionFiles");break;case T.GalleryViewMode.Links:e=C.getString("GalleryMediaPanel.NoConnectionLinks")}return S.default.renderStatus(C.getString("GalleryMediaPanel.NoConnection"),e,this._currentTheme)}}if(this.state.retrievalState===h.RetrievalState.Failed)return S.default.renderStatus(C.getString("GalleryMediaPanel.FailureTopStatus"),C.getString("GalleryMediaPanel.FailureBottomStatus"),this._currentTheme);if(0===this.state.galleryItemResults.length){let e;switch(this.props.viewMode){case T.GalleryViewMode.Media:e=C.getString("GalleryMediaPanel.NoMediaStatus");break;case T.GalleryViewMode.Files:e=C.getString("GalleryMediaPanel.NoFilesStatus");break;case T.GalleryViewMode.Links:e=C.getString("GalleryMediaPanel.NoLinksStatus")}return S.default.renderStatus(C.getString("GalleryMediaPanel.NoContentStatus"),e,this._currentTheme)}}}t.default=H},990625:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(671830),a=s(711930),l=s(898278),d=s(765110),c=s(781511),h=s(436237),u=s(915877),p=s(733754),g=s(104735),m=s(217093),S=s(293194),f=s(680837),y=s(24576),v=(0,u.lazyProperties)({filterPicker:()=>n.Styles.createButtonStyle({flexDirection:"row",marginHorizontal:10,alignItems:"center"}),chevronStyle:()=>n.Styles.createTextStyle({marginLeft:8,marginTop:0})}),C="all",_="media",b="links",T="files";class M extends y.default{constructor(){super(...arguments),this._onFilterPickerButtonRef=e=>{this._filterPickerButton=e||void 0},this._onFilterPickerClick=e=>{e.stopPropagation();const t={anchor:()=>this._filterPickerButton,useTheme:!0,popupBeakSize:{height:0,width:0},popupOffset:{x:0,y:10},positionPriorities:["bottom"],colorThemeOverride:this.props.colorThemeOverride};S.default.showWithOptions({id:"galleryFilterId",config:t,getMenuItems:r.isEncryptedThread(this.props.conversationId)?this._getFilterMenuItemsForPrivateConversations:this._getFilterMenuItems,handleMenuCommand:this._onHandleMenuCommand,rootViewId:this._getRootViewId(),invokingEvent:e})},this._getFilterMenuItems=()=>[{text:p.getString("DesktopGalleryFilter.All"),command:C,selected:this.state.viewMode===m.GalleryViewMode.All,selectableType:l.SXMenuItemSelectableType.Checkbox},{text:p.getString("DesktopGalleryFilter.Media"),command:_,selected:this.state.viewMode===m.GalleryViewMode.Media,selectableType:l.SXMenuItemSelectableType.Checkbox},{text:p.getString("DesktopGalleryFilter.Links"),command:b,selected:this.state.viewMode===m.GalleryViewMode.Links,selectableType:l.SXMenuItemSelectableType.Checkbox},{text:p.getString("DesktopGalleryFilter.Files"),command:T,selected:this.state.viewMode===m.GalleryViewMode.Files,selectableType:l.SXMenuItemSelectableType.Checkbox}],this._getFilterMenuItemsForPrivateConversations=()=>[{text:p.getString("DesktopGalleryFilter.All"),command:C,selected:this.state.viewMode===m.GalleryViewMode.All,selectableType:l.SXMenuItemSelectableType.Checkbox},{text:p.getString("DesktopGalleryFilter.Links"),command:b,selected:this.state.viewMode===m.GalleryViewMode.Links,selectableType:l.SXMenuItemSelectableType.Checkbox},{text:p.getString("DesktopGalleryFilter.Files"),command:T,selected:this.state.viewMode===m.GalleryViewMode.Files,selectableType:l.SXMenuItemSelectableType.Checkbox}],this._onHandleMenuCommand=e=>{if(e===S.SXActionMenuCancel||!this.isComponentMounted())return;const t=this._getGalleryViewModeFromCommand(e);h.track(new c.GalleryFilterSwitchedEvent(this.props.conversationId,this.state.viewMode,t)),this.isComponentMounted()&&this.setState({viewMode:t},(()=>{o.defer((()=>{g.default.setDesktopGalleryViewMode(this.props.conversationId,t,this._getContext(),!0)}))}))}}_buildState(e,t){return{viewMode:e.viewMode}}render(){const e=a.default.combinedAccessibilityLabel(p.getString("DesktopGalleryFilter.MenuTitle"),this._currentMenuItemLabel());return(0,i.jsx)(d.default,{ref:this._onFilterPickerButtonRef,style:[v.filterPicker,f.default.noncollapsibleView,this.props.style],accessibilityLabel:e,label:this._currentMenuItemLabel(),labelColor:this.props.rightClose?this._themeColors.headerIconColor:void 0,overrideIconColor:this.props.rightClose?this._themeColors.headerIconColor:void 0,onPress:this._onFilterPickerClick,chevronStyle:this.props.rightClose?v.chevronStyle:void 0})}_getGalleryViewModeFromCommand(e){switch(e){case C:return m.GalleryViewMode.All;case _:return m.GalleryViewMode.Media;case b:return m.GalleryViewMode.Links;case T:return m.GalleryViewMode.Files;default:return m.GalleryViewMode.All}}_currentMenuItemLabel(){switch(this.state.viewMode){case m.GalleryViewMode.All:return p.getString("DesktopGalleryFilter.All");case m.GalleryViewMode.Media:return p.getString("DesktopGalleryFilter.Media");case m.GalleryViewMode.Links:return p.getString("DesktopGalleryFilter.Links");case m.GalleryViewMode.Files:return p.getString("DesktopGalleryFilter.Files")}return""}}t.default=M},535697:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(889391),r=s(990625),a=s(915877),l=s(733754),d=s(640363),c=s(190631),h=s(581760),u=s(711828),p=s(360305),g=s(24576),m=(0,a.lazyProperties)({galleryPanelHeader:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),filterButtonWrapper:()=>o.Styles.createViewStyle({alignItems:"center",justifyContent:"center",flexDirection:"row",backgroundColor:h.Color.transparent,marginTop:5}),tabletFilterButton:()=>o.Styles.createViewStyle({minHeight:u.IconSize.default,alignItems:"center",justifyContent:"center"}),verticalLine:()=>o.Styles.createViewStyle({width:1,height:24,backgroundColor:h.Color.rightCloseSeparator,marginHorizontal:8}),rightCloseControl:()=>o.Styles.createViewStyle({paddingHorizontal:10})});class S extends g.default{constructor(){super(...arguments),this._onCloseButtonRef=e=>{this._closeButtonRef=e||void 0}}_buildState(e,t){return{useTabletUI:p.default.isTabletUI(),rightClose:n.default.getS4LUiFeaturesNoSubscription().enableWindowRightClose&&d.default.isWindowCloseOnRight()}}componentDidMount(){super.componentDidMount(),this._closeButtonRef&&this._closeButtonRef.requestFocus()}render(){const e=[m.galleryPanelHeader,this._themeStyles.primaryBackgroundColorStyle];let t;if(this.state.rightClose&&e.push(m.rightCloseControl),!this.props.hideDesktopGalleryFilter){const e=[m.filterButtonWrapper];t=(0,i.jsxs)(o.View,Object.assign({style:e},{children:[(0,i.jsx)(r.default,{style:this.state.useTabletUI?m.tabletFilterButton:void 0,conversationId:this.props.conversationId,viewMode:this.props.viewMode,colorThemeOverride:this.props.colorThemeOverride,rightClose:this.state.rightClose}),this.state.rightClose&&(0,i.jsx)(o.View,{style:m.verticalLine,ignorePointerEvents:!0})]}))}const s={closeButtonType:c.CloseButtonType.Close,onPress:this.props.onClose,setButtonRef:this._onCloseButtonRef,title:l.getString("MediaViewer.CloseSharingPromptConfirmButtonLabel")};return(0,i.jsx)(c.SimplePanelHeader,{style:e,useCenteredControls:!this.state.rightClose,panelName:l.getString("GalleryPanel.DesktopPanelTitle"),leftButton:s,colorThemeOverride:this.props.colorThemeOverride,hideBottomBorder:!0,leavePaddingForStatusBar:o.StatusBar.isOverlay()&&this._isPresentedInTabletRightNav(),rightButtons:{customButtonComponent:t}})}}t.default=S},675942:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(1706),r=s(996074),a=s(698172),l=s(502278),d=s(47447),c=(s(314920),s(614980),s(671830)),h=s(509709),u=s(803056),p=s(898278),g=s(887399),m=s(539549),S=s(542683),f=s(535697),y=(s(437490),s(403782)),v=s(103291),C=s(746096),_=s(761317),b=s(753559),T=s(781511),M=s(136400),I=s(110117),w=s(766649),P=s(436237),k=s(915877),A=s(733754),x=s(318743),R=s(104735),O=s(785207),L=s(415963),F=s(886045),B=s(581760),D=s(711828),E=s(619675),V=s(853374),N=(0,k.lazyProperties)({galleryPanel:()=>o.Styles.createViewStyle({flex:1,alignItems:"stretch"}),dragAndDropContainer:()=>o.Styles.createViewStyle({marginHorizontal:10,marginVertical:5,height:60}),dragAndDropContainerExpanded:()=>o.Styles.createViewStyle({height:300}),dragAndDropDefault:()=>o.Styles.createButtonStyle({flex:1,alignSelf:"stretch",borderRadius:10,paddingLeft:15,paddingRight:10,backgroundColor:B.Color.black,flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),dragAndDropDefaultWrapper:()=>o.Styles.createViewStyle({position:"absolute",height:60,left:0,right:0}),dropAndDropText:()=>o.Styles.createTextStyle({flexShrink:1}),dragAndDropInline:()=>o.Styles.createViewStyle({height:60,borderRadius:10,paddingLeft:15,paddingRight:10,marginHorizontal:10,marginVertical:5,backgroundColor:B.Color.black,flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),failedFileShareContainer:()=>o.Styles.createViewStyle({flexDirection:"row",paddingTop:10}),failedFileShareTextContainer:()=>o.Styles.createViewStyle({flex:1,flexWrap:"wrap"}),errorIconPadding:()=>o.Styles.createViewStyle({paddingLeft:15,paddingRight:10})});class U extends r.default{constructor(){super(...arguments),this._showFilePicker=e=>{if(P.track(new T.GalleryAddItemPanelOpenedEvent(this.props.conversationId)),d.UICapabilities.desktopFilePickerSupported()){const t=e=>{if(b.default.isImageExtension(b.default.extractFileExtension(e.file.name))){const t={name:L.ScenarioName.SendPicture},s=this.props.callId;if(s){const i={callId:s,scenarioInfo:t,properties:this.props.parentConversationId?a.default.getReactionsThreadPostParams(this.props.parentConversationId):void 0};O.default.postUpload([this.props.conversationId],e,C.PostSource.Gallery,!1,i).then((()=>{l.default.updateCallTelemetry(s,"MediaPicker",(e=>e.postMediaPickerPhotoReaction()))})).then((()=>{F.default.maybeAnnounceForAccessibility(A.getString("MessageComposer.FileSentLabel"))}))}else O.default.postUpload([this.props.conversationId],e,C.PostSource.Gallery,!1,{scenarioInfo:t}).then((()=>{F.default.maybeAnnounceForAccessibility(A.getString("MessageComposer.FileSentLabel"))}))}else if(b.default.isVideoExtension(b.default.extractFileExtension(e.file.name))){const t={name:L.ScenarioName.SendVideo};O.default.postVideoWithThumbnail([this.props.conversationId],e,C.PostSource.Gallery,!1,t).then((()=>{F.default.maybeAnnounceForAccessibility(A.getString("MessageComposer.FileSentLabel"))}))}else{const t={name:L.ScenarioName.SendFile};O.default.postUpload([this.props.conversationId],e,C.PostSource.Gallery,!1,{scenarioInfo:t}).then((()=>{F.default.maybeAnnounceForAccessibility(A.getString("MessageComposer.FileSentLabel"))}))}};_.FilePickerUtils.showMultiFilesPicker(t,x.FilePickerOrigin.DesktopGalleryPanel,void 0,this._getRootViewId(),e)}else 0},this._setShowOverlayStateFalse=()=>{this.isComponentMounted()&&this.setState({showOverlay:!1})},this._setShowOverlayStateTrue=()=>{this.isComponentMounted()&&this.setState({showOverlay:!0})},this._onCloseButtonClick=()=>{const e=V.default.newCauseId();P.log(C.LogTraceArea.Navigation,"DesktopGalleryPanel._onCloseButtonClick,  causeId: "+e),this.props.onClose?this.props.onClose(e):R.default.closeGalleryPanel(e,this._getContext())},this._goBack=e=>(P.log(C.LogTraceArea.Navigation,"DesktopGalleryPanel._goBack,  causeId: "+e),this._isPresentedInTabletRightNav()?(this._onCloseButtonClick(),!0):super._goBack(e))}_buildState(e,t){const s=c.isOneOnOneConversation(e.conversationId)&&c.isAgent(e.conversationId)&&n.default.hasCapability(e.conversationId,"file.send"),i=g.isConversationBlocked(e.conversationId),o=w.default.isUsingGogoNetwork(),r=(0,m.default)().getConversation(e.conversationId),a={hasFileSendCapability:(s||!i)&&!o,e2eeHandshake:r&&r.isEncryptedThread()?r.getEncryptionHandshake():void 0};return t&&(a.showOverlay=!1),a}componentDidMount(){super.componentDidMount(),P.track(new T.GalleryOpenedEvent(this.props.conversationId))}_renderOptionalDragAndDropArea(){if(!this.state.hasFileSendCapability)return;const e=this._getDragDropLabel(),t=[(0,i.jsx)(E.BodyText,Object.assign({textThemeColor:p.TextThemeColor.Secondary,style:N.dropAndDropText},{children:e}),"label"),(0,i.jsx)(I.default,{icon:D.SkypeIcon.Plus,color:this._themeColors.headerIconColor,size:D.IconSize.size24},"icon")];let s;{const n=[N.dragAndDropDefault];this._useDarkTheme()||n.push(this._themeStyles.secondaryBackgroundColorStyle),s=(0,i.jsx)(o.View,Object.assign({style:N.dragAndDropDefaultWrapper},{children:(0,i.jsx)(M.HoverableButton,Object.assign({style:n,onPress:this._showFilePicker,accessibilityLabel:e,accessibilityTraits:o.Types.AccessibilityTrait.Button},{children:t}))}))}if(d.UICapabilities.dragAndDropSupported()&&this._allowsUpload()){const e=[N.dragAndDropContainer];let t;return this.state.showOverlay&&(e.push(N.dragAndDropContainerExpanded),t=(0,i.jsx)(h.default,{conversationId:this.props.conversationId,label:this._getDragDropLabel()})),(0,i.jsxs)(y.default,Object.assign({origin:x.FilePickerOrigin.DragAndDropToGallery,style:e,conversationId:this.props.conversationId,onDragEnter:this._setShowOverlayStateTrue,onDragLeave:this._setShowOverlayStateFalse,onDropCompleted:this._setShowOverlayStateFalse,callId:this.props.callId,parentConversationId:this.props.parentConversationId,dropTargetSource:v.DropTargetOrigin.DesktopGalleryPanel},{children:[s,t]}))}}_getDragDropLabel(){let e;return e=d.UICapabilities.dragAndDropSupported()?"DesktopFindPanelDragAndDrop.DropFilesDraggedOver":"CallReactionsBar.PhotoButtonTitle",A.getString(e)}render(){return(0,i.jsx)(u.default,Object.assign({goBack:this._goBack},{children:(0,i.jsxs)(o.View,Object.assign({style:[N.galleryPanel,this._themeStyles.primaryBackgroundColorStyle]},{children:[(0,i.jsx)(f.default,{conversationId:this.props.conversationId,viewMode:this.props.viewMode,hideDesktopGalleryFilter:!1,onClose:this._onCloseButtonClick}),this._renderOptionalDragAndDropArea(),(0,i.jsx)(S.default,{conversationId:this.props.conversationId,viewMode:this.props.viewMode,onClose:this._onCloseButtonClick})]}))}))}_allowsUpload(){return!this.state.e2eeHandshake}}t.default=U},676242:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(583367),r=s(516778),a=s(889391),l=s(400984),d=s(681959),c=s(677381),h=s(182146),u=s(986374),p=s(770891),g=s(746096),m=s(139889),S=s(685609),f=s(552115),y=s(753559),v=s(680115),C=s(110117),_=s(547126),b=s(915877),T=s(733754),M=s(223284),I=s(764387),w=s(312762),P=s(706250),k=s(104735),A=s(217093),x=s(932226),R=s(29130),O=s(581760),L=s(640363),F=s(311010),B=s(711828),D=s(680837),E=s(600212),V=s(619675),N=s(163841);var U;!function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large",e[e.ExtraLarge=3]="ExtraLarge"}(U||(U={}));const j=150,H=.5,z=1.5,W="mediaitem",G=(0,b.lazyProperties)({rowView:()=>r.Styles.createViewStyle({flexDirection:"row"}),container:()=>r.Styles.createViewStyle({height:j,marginTop:10,marginBottom:10,marginLeft:10,marginRight:10}),containerRounded:()=>r.Styles.createViewStyle({marginTop:0,marginBottom:0,marginLeft:0,marginRight:0}),tile:()=>r.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:O.Color.gray300}),tileIcon:()=>r.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:O.Color.transparent}),tileTextContainer:()=>r.Styles.createViewStyle({flex:-1,flexDirection:"column",backgroundColor:O.Color.transparent}),tileText:()=>r.Styles.createTextStyle({color:O.Color.white}),errorTitle:()=>r.Styles.createTextStyle({color:O.Color.white,textAlign:"center",marginBottom:10}),errorMessage:()=>r.Styles.createTextStyle({color:O.Color.white,textAlign:"center",paddingHorizontal:40}),errorTextContainer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center",justifyContent:"center",height:j}),galleryTileContainer:()=>r.Styles.createViewStyle({marginTop:H,marginBottom:H,marginLeft:H,marginRight:H}),galleryTileContainerRounded:()=>r.Styles.createViewStyle({borderRadius:10,marginTop:z,marginBottom:z,marginLeft:z,marginRight:z}),galleryPanel:()=>r.Styles.createViewStyle({alignSelf:"stretch",backgroundColor:O.Color.transparent,flexDirection:"row"}),loadingStatusContainer:()=>r.Styles.createViewStyle({flex:1,alignItems:"center",paddingTop:50,backgroundColor:O.Color.darkThemeBackground}),overlayContainer:()=>D.default.absoluteFill,lightBlackOverlay:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:O.Color.blackOverlay20})});class K extends c.default{constructor(){super(...arguments),this._maxGifFileSizeForIOs=a.default.getConfigSettings().urlPreview.gifSizeLimitInBytes,this._mountedRefsMap=new P.default,this._onLayout=e=>{this.isComponentMounted()&&this.setState({galleryWidth:e.width})},this._onMediaItemClick=()=>{this.props.onItemPress&&this.props.onItemPress(),this._navigateToGallery(A.GalleryViewMode.Media)},this._onLinkItemClick=()=>{this.props.onItemPress&&this.props.onItemPress(),this._navigateToGallery(A.GalleryViewMode.Links)},this._onFileItemClick=()=>{this.props.onItemPress&&this.props.onItemPress(),this._navigateToGallery(A.GalleryViewMode.Files)},this._onKeyPress=e=>{let t=this.state.focusedIndex;e.keyCode!==_.default.UP&&e.keyCode!==_.default.LEFT||(t-=1),e.keyCode!==_.default.DOWN&&e.keyCode!==_.default.RIGHT||(t+=1),t<0||t>=this.state.itemResults.length||this.isComponentMounted()&&this.setState({focusedIndex:t})}}_buildState(e,t){const s={};t&&(s.isRetrievingItems=!1,s.itemCount=0,s.fileItemInfo={},s.itemResults=[],s.itemsRetrievalFailed=!1,s.itemUrls={},s.urlPreviewInfo={},s.swiftMessageInfo={},s.galleryWidth=0,s.focusedIndex=0);const i=this._getRootViewId(),o=e.usePortraitLayout?n.DeviceOrientation.Portrait:R.default.getDeviceOrientation(i);s.deviceOrientation=o,s.isConversationAccepted=l.default.isConversationAccepted(e.conversationId);const r=this._getNumberOfItemsToShow(s.deviceOrientation),a=h.default.getCombinedItemsForConversation(e.conversationId,Date.now(),r,t,!0),d=h.default.getMediaRetrievalState(e.conversationId),c=h.default.getFilesRetrievalState(e.conversationId),u=h.default.getLinksRetrievalState(e.conversationId);s.isConnectedToNetwork=x.default.isConnected(),s.isRetrievingItems=d===h.RetrievalState.Retrieving||c===h.RetrievalState.Retrieving||u===h.RetrievalState.Retrieving,s.itemCount=a.length,s.itemsRetrievalFailed=d===h.RetrievalState.Failed||c===h.RetrievalState.Failed||u===h.RetrievalState.Failed,s.itemResults=a.slice(0,r),s.fileItemInfo=this._getInfoForFiles(s.itemResults);const p=this._getUrlsInfo(s.itemResults);return s.itemUrls=p.urls,s.urlPreviewInfo=p.urlPreviewInfo,s.swiftMessageInfo=this._getSwiftMessageInfo(s.itemResults),s}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.focusedIndex!==t.focusedIndex&&this.focusItem(this.state.focusedIndex)}focusItem(e=0){if(!(e<0||e>this.state.itemResults.length-1))if(this.state.focusedIndex===e){const t=this._mountedRefsMap.ref(W+e);t&&t.requestFocus()}else this.setState({focusedIndex:e})}componentDidMount(){if(super.componentDidMount(),this.props.onHasItems){const e=!o.isEmpty(this.state.itemResults);this.props.onHasItems(e)}}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),this.props.onHasItems){const e=!o.isEmpty(this.state.itemResults),s=!o.isEmpty(t.itemResults);s!==e&&this.props.onHasItems(s)}}_getInfoForFiles(e){const t=this.state&&!o.isEmpty(this.state.fileItemInfo)?this.state.fileItemInfo:{};return o.each(e,(e=>{if(I.default.isFile(e)){const s=u.decode(e),i=s?s.getFirstUriObjectChild(w.UriObjectFileNode):null;if(i){const s=i.getNameForUI(),o=i.getSizeInBytes(),n=f.default.formatFileSize(o,1);t[e.cuid]={displayFilename:s,fileSize:n?n.formattedString:""}}}})),t}_getUrlsInfo(e){const t={},s={};return o.each(e,(e=>{if(I.default.isLink(e)){const i=u.decode(e),n=o.first(i.getWebLinks()),r=n&&e.hasUrlPreviewMetadata()?e.getUrlPreviewMetadata(n):void 0;n&&(t[e.cuid]=n),r&&(s[e.cuid]=r)}})),{urlPreviewInfo:s,urls:t}}_getSwiftMessageInfo(e){const t={};return o.each(e,(e=>{if(I.default.isSwiftCard(e)){const s=u.decode(e);if(I.default.isDecodedRootNodeASwiftCardWithLink(s)){const i=s.getFirstUriObjectChild(w.SwiftUriObjectNode);i&&i.swiftChild&&(t[e.cuid]=i.swiftChild.swiftMessage)}}})),t}_getNumberOfItemsToShow(e){return 5}render(){if(this.props.hideWhenEmpty&&o.isEmpty(this.state.itemResults))return null;const e=[G.container];return this.props.useRoundedCorners?e.push(G.containerRounded):e.push(D.default.flexOne),this.props.style&&e.push(this.props.style),(0,i.jsx)(r.View,Object.assign({style:e,onLayout:this._onLayout},{children:this._getGalleryView()}))}_getGalleryView(){if(o.isEmpty(this.state.itemResults))return this.state.isConnectedToNetwork?this.state.itemsRetrievalFailed?this._getErrorView(T.getString("GalleryMediaPanel.FailureTopStatus"),T.getString("GalleryMediaPanel.FailureBottomStatus")):this.state.isRetrievingItems?v.default.renderLoadingStatus(G.loadingStatusContainer):this._getErrorView(T.getString("GalleryPanel.NoContentTitle"),T.getString("GalleryPanel.NoContentStatus")):this._getErrorView(T.getString("GalleryMediaPanel.NoConnectionTitle"),T.getString("GalleryMediaPanel.NoConnectionAll"));{const e=[G.galleryPanel];return this.props.useRoundedCorners||e.push(D.default.flexOne),(0,i.jsx)(r.View,Object.assign({style:e,onKeyPress:this._onKeyPress},{children:this._getGalleryItemView()}))}}_getErrorView(e,t){return(0,i.jsx)(r.View,Object.assign({style:E.default.themeStylesForTheme(N.Theme.ColorfulDark).primaryBackgroundColorStyle},{children:(0,i.jsxs)(r.View,Object.assign({style:G.errorTextContainer},{children:[(0,i.jsx)(V.PanelHeader,Object.assign({style:G.errorTitle},{children:e})),(0,i.jsx)(V.BodyText,Object.assign({style:G.errorMessage},{children:t}))]}))}))}_getGalleryItemView(){const e=this.state.itemResults.length;return this.state.deviceOrientation===n.DeviceOrientation.Landscape||e<=2?this._getViewForSingleItems():3===e?this._getViewForThreeItemsInPortrait():4===e?this._getViewForFourItemsInPortrait():this._getViewForFiveItemsInPortrait()}_getViewForSingleItems(){return o.map(this.state.itemResults,((e,t)=>this._getGalleryItem(t)))}_getViewForThreeItemsInPortrait(){const e=[];return e.push(this._getGalleryItem(0)),e.push((0,i.jsxs)(r.View,{children:[this._getGalleryItem(1),this._getGalleryItem(2)]},"Item1Item2")),e}_getViewForFourItemsInPortrait(){const e=[];return e.push(this._getGalleryItem(0)),e.push((0,i.jsxs)(r.View,{children:[this._getGalleryItem(1),(0,i.jsxs)(r.View,Object.assign({style:G.rowView},{children:[this._getGalleryItem(2),this._getGalleryItem(3)]}),"Item2Item3")]},"Item1Item2Item3")),e}_getViewForFiveItemsInPortrait(){const e=[];return e.push(this._getGalleryItem(0)),e.push((0,i.jsxs)(r.View,{children:[this._getGalleryItem(1),this._getGalleryItem(3)]},"Item1Item2")),e.push((0,i.jsxs)(r.View,{children:[this._getGalleryItem(2),this._getGalleryItem(4)]},"Item3Item4")),e}_getGalleryItem(e){const t=this.state.itemResults[e],s=this._getItemDimensions(e);let o;if(I.default.isMediaItem(t)){let n=this.props.accessibilityPrefix||"";n+=", "+T.getString("GalleryMediaPanel.MediaAccessibilityLabel",{currentItemIndex:e+1,numberOfItems:this.state.itemResults.length}),o=(0,i.jsx)(M.default,{ref:this._mountedRefsMap.onComponentRef(W+e),tabIndex:this.state.focusedIndex===e?0:-1,message:t,height:s.height,width:s.width,onThumbnailPress:this._onMediaItemClick,thumbnailIconsSize:this._getItemIconSize(s.tileSize),showVideoMediaTypeIcon:!0,showCreator:!1,accessibilityLabel:n,renderOrigin:p.MessageRenderOrigin.StackGalleryCanvas},t.cuid)}else o=this._getFileOrLinkGalleryTile(e,t,s);const n=[G.galleryTileContainer];return this.props.useRoundedCorners&&n.push(G.galleryTileContainerRounded),(0,i.jsx)(r.View,Object.assign({style:n},{children:o}),t.cuid)}_getFileOrLinkGalleryTile(e,t,s){const n=r.Styles.createViewStyle({height:s.height,width:s.width},!1),a=[G.tile,n],l=(0,i.jsx)(r.View,{style:E.default.themeStylesForTheme(N.Theme.ColorfulDark).primaryBackgroundColorStyle});let c,h,u,p;if(I.default.isFile(t)){const e=this.state.fileItemInfo[t.cuid];if(e){const t=S.FileIconHelper.getFileIconGlyph(e.displayFilename),i=S.FileIconHelper.getFileIconColor(e.displayFilename);a.push(r.Styles.createViewStyle({backgroundColor:i},!1)),u=this._getItemIcon(t,O.Color.white,s.tileSize),s.tileSize!==U.Small&&this.state.isConversationAccepted&&(p=this._getItemText(e.displayFilename,e.fileSize,s))}}else if(I.default.isSwiftCard(t)){const e=this.state.swiftMessageInfo?this.state.swiftMessageInfo[t.cuid]:void 0,n=e?o.find(e.attachments,(e=>I.default.isSwiftCardAttachmentALink(e))):void 0;let a="";n&&n.content&&(n.content.image?a=n.content.image.url:n.content.images&&(a=n.content.images[0].url)),a&&this.state.isConversationAccepted?(c=(0,i.jsx)(m.default,{origin:"GalleryCombinedListTitleBackgroundFromFile",altView:l,containerStyle:G.overlayContainer,errorView:l,resizeMode:"cover",source:a,style:G.overlayContainer}),h=(0,i.jsx)(r.View,{style:G.lightBlackOverlay})):c=l,u=this._getItemIcon(B.SkypeIcon.Link,O.Color.white,s.tileSize),s.tileSize!==U.Small&&n&&n.content&&n.content.title&&this.state.isConversationAccepted&&(p=this._getItemText(d.renderText(n.content.title),n.content.subtitle?d.renderText(n.content.subtitle):"",s))}else{const e=this.state.itemUrls&&this.state.itemUrls[t.cuid]?this.state.itemUrls[t.cuid]:"",o=this.state.urlPreviewInfo?this.state.urlPreviewInfo[t.cuid]:void 0,n=o&&L.default.getPlatformType()===g.PlatformType.iOS&&o.content_type===y.default.imageContentTypes.gif&&o.size&&o.size>this._maxGifFileSizeForIOs;o&&o.thumbnail&&!n&&this.state.isConversationAccepted?(c=(0,i.jsx)(m.default,{origin:"GalleryCombinedListTitleBackgroundFromURLP",altView:l,containerStyle:G.overlayContainer,errorView:l,resizeMode:"cover",source:o.thumbnail,style:G.overlayContainer}),h=(0,i.jsx)(r.View,{style:G.lightBlackOverlay})):c=l,u=this._getItemIcon(B.SkypeIcon.Link,O.Color.white,s.tileSize),s.tileSize!==U.Small&&this.state.isConversationAccepted&&(p=this._getItemText(o&&o.title?o.title:e||"",o&&o.site?o.site:"",s))}const f=I.default.isFile(t)?"GalleryMediaPanel.FileAccessibilityLabel":"GalleryMediaPanel.LinkAccessibilityLabel";return(0,i.jsxs)(r.Button,Object.assign({ref:this._mountedRefsMap.onComponentRef(W+e),tabIndex:this.state.focusedIndex===e?0:-1,onPress:I.default.isFile(t)?this._onFileItemClick:this._onLinkItemClick,activeOpacity:.8,style:a,title:T.getString(f,{currentItemIndex:e+1,numberOfItems:this.state.itemResults.length})},{children:[c,h,u,p]}))}_getTileSize(e,t){let s=U.Small;return 1===e?s=U.ExtraLarge:2===e?s=U.Large:3===e?s=0===t?U.Large:U.Medium:4===e?0===t?s=U.Large:1===t&&(s=U.Medium):0===t&&(s=U.Large),s}_getItemDimensions(e){const t=this._itemMargin(),s=this.state.itemResults.length,i=this.state.galleryWidth-20,o=this._getTileSize(s,e);if(s<=2||this.state.deviceOrientation===n.DeviceOrientation.Landscape){return{height:3===s&&e>0?75:j,width:(i-2*s*t)/s,tileSize:o}}if(3===s){return{height:e>0?75-t:j,width:2*((i-8*t)/4)+2*t,tileSize:o}}if(4===s){const s=(i-4*t)/4;return{height:e>0?75-t:j,width:e>1?s:2*s+2*t,tileSize:o}}{const s=(i-4*t)/4;return{height:0===e?j:75-t,width:0===e?2*s:s,tileSize:o}}}_getItemIconSize(e){let t=B.IconSize.size24;return e!==U.ExtraLarge&&e!==U.Large||(t=B.IconSize.size48),t}_getItemTitleStyle(e){return e===U.ExtraLarge?[F.default.fontStyle.panelHeader,G.tileText]:[F.default.fontStyle.bodyBold,G.tileText]}_getItemSubtitleStyle(e){return e===U.ExtraLarge?[F.default.fontStyle.body,G.tileText]:[F.default.fontStyle.caption,G.tileText]}_getItemIcon(e,t,s){return(0,i.jsx)(r.View,Object.assign({style:G.tileIcon},{children:(0,i.jsx)(C.default,{icon:e,size:this._getItemIconSize(s),color:t})}))}_getItemText(e,t,s){const o=this._getItemTitleStyle(s.tileSize),n=this._getItemSubtitleStyle(s.tileSize),a=r.Styles.createViewStyle({paddingHorizontal:10,paddingBottom:10,width:s.width},!1);return(0,i.jsxs)(r.View,Object.assign({style:[G.tileTextContainer,a]},{children:[(0,i.jsx)(r.Text,Object.assign({style:o,numberOfLines:1},{children:e})),(0,i.jsx)(r.Text,Object.assign({style:n,numberOfLines:1},{children:t}))]}))}_itemMargin(){return this.props.useRoundedCorners?z:H}_navigateToGallery(e){k.default.navigateToGallery(this.props.conversationId,e,this._getContext())}}t.default=K},680115:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(898278),r=s(915877),a=s(915415),l=s(22222),d=s(581760),c=s(600212),h=s(619675),u=s(163841),p=s(897634),g=(0,r.lazyProperties)({statusContainer:()=>o.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center"}),statusTextTop:()=>o.Styles.createTextStyle({color:d.Color.white,marginBottom:12,backgroundColor:d.Color.transparent}),statusTextBottom:()=>o.Styles.createTextStyle({color:d.Color.white,backgroundColor:d.Color.transparent,textAlign:"center",marginHorizontal:44}),button:()=>o.Styles.createButtonStyle({flex:0,alignSelf:"stretch",marginBottom:20,marginHorizontal:35})});t.default=class{static renderStatus(e,t,s){const n=c.default.themeStylesForTheme(s||u.Theme.ColorfulDark);return(0,i.jsxs)(o.View,Object.assign({style:[g.statusContainer,n.primaryBackgroundColorStyle]},{children:[(0,i.jsx)(h.PanelHeader,Object.assign({style:[g.statusTextTop,n.primaryTextColorStyle]},{children:e})),(0,i.jsx)(h.BodyText,Object.assign({style:[g.statusTextBottom,n.primaryTextColorStyle]},{children:t}))]}))}static renderStatusWithButton(e,t,s,r){const a=r||u.Theme.ColorfulDark,d=c.default.themeStylesForTheme(a);return(0,i.jsxs)(o.View,Object.assign({style:[g.statusContainer,d.primaryBackgroundColorStyle]},{children:[(0,i.jsx)(l.default,{style:g.button,onPress:t,title:e,buttonStyle:p.isDarkTheme(a)?n.SXButtonStyle.LightFill:n.SXButtonStyle.DarkFill}),(0,i.jsx)(h.BodyText,Object.assign({style:[g.statusTextBottom,d.primaryTextColorStyle]},{children:s}))]}))}static renderLoadingStatus(e){const t=e||g.statusContainer;return(0,i.jsx)(o.View,Object.assign({style:t},{children:(0,i.jsx)(a.default,{tintColor:d.Color.gray300,size:n.SXActivityIndicatorSize.Medium,useRXIndicator:!0})}))}}},597647:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(396265),r=s(516778),a=s(671830),l=s(400984),d=s(182146),c=s(816402),h=s(770891),u=s(680115),p=s(272759),g=s(915877),m=s(733754),S=s(217093),f=s(932226),y=s(536150),v=s(667806),C=s(581760),_=s(619675),b=s(24576),T="spacerForTabBar",M="bottomSpacer",I="g_",w="d_",P=(0,g.lazyProperties)({panel:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),pannelPadding:()=>r.Styles.createViewStyle({paddingTop:90}),dateHeaderText:()=>r.Styles.createTextStyle({marginLeft:10,marginTop:16}),dateHeaderTextCompositeNav:()=>r.Styles.createTextStyle({marginLeft:4}),topSpacer:()=>r.Styles.createViewStyle({height:80,flex:0,backgroundColor:C.Color.transparent}),bottomSpacer:()=>r.Styles.createViewStyle({height:20,flex:0,backgroundColor:C.Color.transparent})});class k extends b.default{constructor(){super(...arguments),this._lastScrollTop=0,this._hasRenderedLastItem=!1,this._getListView=()=>this._listView,this._onListViewRef=e=>{this._listView=e||void 0},this._onScroll=(e,t)=>{if(e>=this._lastScrollTop&&this._hasRenderedLastItem){let e=d.RetrievalMask.All;switch(this.props.viewMode){case S.GalleryViewMode.Media:e=d.RetrievalMask.Media;break;case S.GalleryViewMode.Files:e=d.RetrievalMask.Files;break;case S.GalleryViewMode.Links:e=d.RetrievalMask.Links}d.default.fetchMoreMessages(this.props.conversationId,e)}const s=this._lastScrollTop>1;this.isComponentMounted()&&this.state.scrolled!==s&&this.setState({scrolled:s}),this._lastScrollTop=e},this._renderItem=(e,t)=>{if(o.isUndefined(e.index))return[];if(this._hasRenderedLastItem=e.index>=this.state.galleryItemResults.length-10,e.key===T)return(0,i.jsx)(r.View,{style:P.topSpacer});if(e.key===M)return(0,i.jsx)(r.View,{style:P.bottomSpacer});const s=e.key.substring(0,2);if(s===I){const t=this.state.galleryItemResults[e.index];return(0,i.jsx)(v.StreamItem,{message:t,isFirstInGroup:!0,isLastInGroup:!0,isLastMessage:!0,isReadOnly:!1,isLastPhotoByCurrentUser:!1,renderOrigin:h.MessageRenderOrigin.StackGalleryCanvas,isConversationAccepted:this.state.isConversationAccepted,disableSelectMultipleMessages:!0,disableReactions:!0,getRootWindowComponent:this._getListView})}if(s===w){const t=[P.dateHeaderText];return this.props.isUsingStackNavigationContext||t.push(P.dateHeaderTextCompositeNav),(0,i.jsx)(_.Subtitle,Object.assign({style:t},{children:c.default.getDisplayDateString(parseInt(e.key.substring(2),10))}))}return(0,i.jsx)(r.View,{})}}_buildState(e,t){const s={};s.is1on1Conversation=!a.isThread(e.conversationId),s.isConnectedToNetwork=f.default.isConnected(),s.isConversationAccepted=l.default.isConversationAccepted(e.conversationId),s.isMobileScreenReaderEnabled=e.isUsingStackNavigationContext&&y.default.isMobileScreenReaderEnabled();const i=[];let n,h=[],u=d.RetrievalState.None,p=200;switch(e.viewMode){case S.GalleryViewMode.Media:break;case S.GalleryViewMode.Files:h=d.default.getFilesForConversation(e.conversationId,Date.now(),10,t,!0),u=d.default.getFilesRetrievalState(e.conversationId),p=200;break;case S.GalleryViewMode.Links:h=d.default.getLinksForConversation(e.conversationId,Date.now(),10,t,!0),u=d.default.getLinksRetrievalState(e.conversationId),p=200}return e.displayTabBar&&!s.isMobileScreenReaderEnabled&&i.push({key:T,height:80,template:"gil_spacer",isNavigable:!1}),o.each(h,((e,t)=>{n&&c.default.isSameDay(n,e.createdTime)||(n=e.createdTime,i.push({key:w+n,height:36,index:t,template:"gil_dateItem",isNavigable:!1})),i.push({key:I+e.cuid,height:p,template:"gil_media",index:t,measureHeight:!0,accessibilityTrait:r.Types.AccessibilityTrait.Button})})),h.length>0&&i.push({key:M,height:20,template:"gil_spacer",isNavigable:!1}),s.galleryItemList=i,s.galleryItemResults=h,s.retrievalState=u,t&&(s.scrolled=!1),s}render(){const e=this._renderStatus(),t=e?null:(0,i.jsx)(n.VirtualListView,{ref:this._onListViewRef,style:P.panel,itemList:this.state.galleryItemList,renderItem:this._renderItem,animateChanges:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,clickOnEnterPress:!1,horizontalPadding:this.props.safeAreaHorizontalInsets,onScroll:this._onScroll},"gallery"+this.props.viewMode);if(this.props.displayTabBar){const s=[P.panel];return this.state.isMobileScreenReaderEnabled&&s.push(P.pannelPadding),(0,i.jsxs)(r.View,Object.assign({style:s},{children:[e||t,(0,i.jsx)(p.default,{viewMode:this.props.viewMode,onTabSelected:this.props.onTabSelected,scrolled:this.state.scrolled})]}))}return e||t}_renderStatus(){if(!this.state.isConnectedToNetwork){if(this.state.galleryItemResults.length)return;{let e;switch(this.props.viewMode){case S.GalleryViewMode.Media:break;case S.GalleryViewMode.Files:e=m.getString("GalleryMediaPanel.NoConnectionFiles");break;case S.GalleryViewMode.Links:e=m.getString("GalleryMediaPanel.NoConnectionLinks")}return u.default.renderStatus(m.getString("GalleryMediaPanel.NoConnection"),e,this._currentTheme)}}if(this.state.retrievalState===d.RetrievalState.Retrieving&&this.props.isUsingStackNavigationContext)return u.default.renderLoadingStatus();if(this.state.retrievalState===d.RetrievalState.Failed)return u.default.renderStatus(m.getString("GalleryMediaPanel.FailureTopStatus"),m.getString("GalleryMediaPanel.FailureBottomStatus"),this._currentTheme);if(0===this.state.galleryItemResults.length){let e;switch(this.props.viewMode){case S.GalleryViewMode.Media:break;case S.GalleryViewMode.Files:e=m.getString("GalleryMediaPanel.NoFilesStatus");break;case S.GalleryViewMode.Links:e=m.getString("GalleryMediaPanel.NoLinksStatus")}return u.default.renderStatus(m.getString("GalleryMediaPanel.NoContentStatus"),e,this._currentTheme)}}}t.default=k},607044:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(47447),a=(s(314920),s(614980),s(182146)),l=s(770891),d=s(746096),c=s(761317),h=s(753559),u=s(680115),p=s(272759),g=s(317873),m=s(485433),S=s(766649),f=s(915877),y=s(733754),v=s(318743),C=s(268080),_=s(18078),b=s(932226),T=s(785207),M=s(681115),I=s(415963),w=s(536150),P=s(886045),k=s(600750),A=s(581760),x=s(24576),R=s(715598),O=(0,f.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"stretch",backgroundColor:A.Color.transparent}),gridStackNav:()=>n.Styles.createViewStyle({paddingTop:90}),gridCompositeNav:()=>n.Styles.createViewStyle({paddingHorizontal:10}),gridCompositeNavWithTabBar:()=>n.Styles.createViewStyle({paddingTop:90})});class L extends x.default{constructor(){super(...arguments),this._lastScrollTop=0,this._onGridViewRef=e=>{this._gridView=e||void 0},this._onScroll=(e,t)=>{e>=this._lastScrollTop&&a.default.fetchMoreMessages(this.props.conversationId,a.RetrievalMask.Media),this.isComponentMounted()&&this.setState({scrolled:this._lastScrollTop>1}),this._lastScrollTop=e},this._onSharePhotoButtonPress=e=>{r.UICapabilities.desktopFilePickerSupported()&&c.FilePickerUtils.showMultiFilesPicker((e=>{const t=h.default.extractFileExtension(e.file.name);let s;if(h.default.isVideoExtension(t)){const t={name:I.ScenarioName.SendVideo};s=T.default.postVideoWithThumbnail([this.props.conversationId],e,d.PostSource.Gallery,!1,t)}else if(h.default.isImageExtension(t)){const t={name:I.ScenarioName.SendPicture};s=T.default.postUpload([this.props.conversationId],e,d.PostSource.Gallery,!1,{scenarioInfo:t})}else{const t={name:I.ScenarioName.SendFile};s=T.default.postUpload([this.props.conversationId],e,d.PostSource.Gallery,!1,{scenarioInfo:t})}s.then((()=>{P.default.maybeAnnounceForAccessibility(y.getString("MessageComposer.FileSentLabel"))}))}),v.FilePickerOrigin.GalleryMediaList,void 0,this._getRootViewId(),e)},this._onMediaItemPress=e=>{const t={};o.each(this.state.mediaResultsAsMessages,(e=>{const s=this._getMediaNode(e.cuid);s&&(t[e.cuid]={component:s})})),g.default.potentiallyMarkItemViewed(e,l.MessageRenderOrigin.StackGalleryCanvas),(0,R.notifyOpenAI)(e),C.default.showWithMessageConfig({initialMessage:e,animateOpenClose:!0,reverseOrder:!1,rootViewId:this._getRootViewId(),onClose:()=>{this.isComponentMounted()&&this.forceUpdate()},getContentNode:e=>{const t=this._getMediaNode(e);return t?{component:t}:void 0},origin:d.NavigationMediaViewerOrigin.Gallery})},this._getMessageActions=e=>{const t=[k.CommandTypes.Forward,k.CommandTypes.SaveMedia,k.CommandTypes.ViewInChat];return _.default.isMyMri(e.creator)&&t.push(k.CommandTypes.Remove),{actionMenuCommands:t,outerButtonCommands:[]}}}_buildState(e,t){return{mediaResultsAsMessages:a.default.getMediaForConversation(e.conversationId,Date.now(),15,t,!0),retrievalState:a.default.getMediaRetrievalState(e.conversationId),isConnectedToNetwork:b.default.isConnected(),disableHighBandwidthOperations:S.default.isUsingGogoNetwork(),isMobileScreenReaderEnabled:w.default.isMobileScreenReaderEnabled(),scrolled:!1}}render(){const e=this._renderStatus(),t=[];if(this.props.isUsingStackNavigationContext)this.props.displayTabBar&&!this.state.isMobileScreenReaderEnabled&&t.push(O.gridStackNav);else{const e=[O.gridCompositeNav];this.props.displayTabBar&&e.push(O.gridCompositeNavWithTabBar),t.push(e)}this.props.safeAreaHorizontalInsets&&M.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&t.push(M.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets));const s=e?void 0:(0,i.jsx)(m.default,{ref:this._onGridViewRef,contentStyles:t,mediaMessages:this.state.mediaResultsAsMessages,showCreatorOnThumbnails:!0,showVideoMediaTypeIcon:!0,onGridItemPress:this._onMediaItemPress,thumbnailsPerRow:this.props.isUsingStackNavigationContext?3:4,itemBorderRadius:0,thumbnailPadding:0,showThumbnailOverlay:!0,thumbnailIconsSize:40,getMessageActions:this._getMessageActions,onScroll:this._onScroll,renderOrigin:l.MessageRenderOrigin.StackGalleryCanvas});if(this.props.displayTabBar){const t=[O.container];return this.state.isMobileScreenReaderEnabled&&t.push(O.gridStackNav),(0,i.jsxs)(n.View,Object.assign({style:t},{children:[e||s,(0,i.jsx)(p.default,{viewMode:this.props.viewMode,onTabSelected:this.props.onTabSelected,scrolled:this.state.scrolled})]}))}return(0,i.jsx)(n.View,Object.assign({style:O.container},{children:e||s}))}_renderStatus(){return this.state.isConnectedToNetwork?this.state.retrievalState===a.RetrievalState.Retrieving&&this.props.isUsingStackNavigationContext?u.default.renderLoadingStatus():this.state.retrievalState===a.RetrievalState.Failed?u.default.renderStatus(y.getString("GalleryMediaPanel.FailureTopStatus"),y.getString("GalleryMediaPanel.FailureBottomStatus"),this._currentTheme):0===this.state.mediaResultsAsMessages.length?this.state.disableHighBandwidthOperations?u.default.renderStatus(y.getString("GalleryMediaPanel.NoContentStatus"),y.getString("GalleryMediaPanel.NoMediaStatus"),this._currentTheme):u.default.renderStatusWithButton(y.getString("GalleryMediaPanel.NoMediaButtonLabel"),this._onSharePhotoButtonPress,y.getString("GalleryMediaPanel.NoMediaStatus")):void 0:this.state.mediaResultsAsMessages.length?void 0:u.default.renderStatus(y.getString("GalleryMediaPanel.NoConnection"),y.getString("GalleryMediaPanel.NoConnectionMedia"),this._currentTheme)}_getMediaNode(e){if(this._gridView)return this._gridView.getMediaNode(e)}}t.default=L},272759:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(217041),r=s(231652),a=s(915877),l=s(733754),d=s(217093),c=s(581760),h=s(711828),u=s(619675),p=(0,a.lazyProperties)({tabBar:()=>o.Styles.createViewStyle({flex:0,height:80,position:"absolute",top:10,left:0,right:0,backgroundColor:c.Color.transparent,flexDirection:"row",justifyContent:"center",alignItems:"center"}),tabBarLabel:()=>o.Styles.createTextStyle({textAlign:"center",marginTop:1}),tabLabelScrolled:()=>o.Styles.createTextStyle({opacity:0})});class g extends n.ComponentBase{constructor(){super(...arguments),this._onMediaTabPress=e=>{e.stopPropagation(),this.props.viewMode!==d.GalleryViewMode.Media&&this.props.onTabSelected&&this.props.onTabSelected(d.GalleryViewMode.Media)},this._onFilesTabPress=e=>{e.stopPropagation(),this.props.viewMode!==d.GalleryViewMode.Files&&this.props.onTabSelected&&this.props.onTabSelected(d.GalleryViewMode.Files)},this._onLinksTabPress=e=>{e.stopPropagation(),this.props.viewMode!==d.GalleryViewMode.Links&&this.props.onTabSelected&&this.props.onTabSelected(d.GalleryViewMode.Links)}}render(){const e=(0,i.jsx)(r.default,{icon:h.SkypeIcon.Media,label:l.getString("GalleryTabBar.MediaTabButtonLabel"),selected:this.props.viewMode===d.GalleryViewMode.Media,onTabButtonPress:this._onMediaTabPress,tabPosition:0,totalTabs:3}),t=(0,i.jsx)(r.default,{icon:h.SkypeIcon.Link,label:l.getString("GalleryTabBar.LinksTabButtonLabel"),selected:this.props.viewMode===d.GalleryViewMode.Links,onTabButtonPress:this._onLinksTabPress,tabPosition:1,totalTabs:3}),s=(0,i.jsx)(r.default,{icon:h.SkypeIcon.FileMultiple,label:l.getString("GalleryTabBar.FilesTabButtonLabel"),selected:this.props.viewMode===d.GalleryViewMode.Files,onTabButtonPress:this._onFilesTabPress,tabPosition:2,totalTabs:3}),n=[p.tabBarLabel];this.props.scrolled&&n.push(p.tabLabelScrolled);const a=(0,i.jsx)(u.Caption,Object.assign({style:n,selected:this.props.viewMode===d.GalleryViewMode.Media},{children:l.getString("GalleryTabBar.MediaTabButtonLabel")})),c=(0,i.jsx)(u.Caption,Object.assign({style:n,selected:this.props.viewMode===d.GalleryViewMode.Links},{children:l.getString("GalleryTabBar.LinksTabButtonLabel")})),g=(0,i.jsx)(u.Caption,Object.assign({style:n,selected:this.props.viewMode===d.GalleryViewMode.Files},{children:l.getString("GalleryTabBar.FilesTabButtonLabel")}));return(0,i.jsxs)(o.View,Object.assign({style:p.tabBar},{children:[(0,i.jsxs)(o.View,{children:[e,a]}),(0,i.jsxs)(o.View,{children:[t,c]}),(0,i.jsxs)(o.View,{children:[s,g]})]}))}}t.default=g},231652:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(217041),r=s(4736),a=s(711930),l=(0,s(915877).lazyProperties)({button:()=>o.Styles.createButtonStyle({marginHorizontal:5})});class d extends n.ComponentBase{constructor(){super(...arguments),this._onClickButton=e=>{this.props.onTabButtonPress&&this.props.onTabButtonPress(e)}}render(){const e=a.default.tabAccessibilityLabel(this.props.label,this.props.tabPosition,this.props.totalTabs),t=a.default.tabAccessibilityTraits(this.props.selected);return(0,i.jsx)(r.default,{style:l.button,icon:this.props.icon,title:this.props.label,deselected:!this.props.selected,accessibilityLabel:e,accessibilityTraits:t,onPress:this._onClickButton})}}t.default=d},441639:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(285788),r=s(823113),a=s(516778),l=s(4736),d=s(38566),c=s(120948),h=s(690247),u=s(816402),p=s(746096),g=s(913944),m=s(436237),S=s(915877),f=s(733754),y=s(318743),v=s(265822),C=s(89808),_=s(581736),b=s(364956),T=s(415963),M=s(886045),I=s(262232),w=s(581760),P=s(311010),k=s(711828),A=s(478262),x=s(680837),R=s(24576),O=s(853374),L=s(898278),F=s(915415),B=(0,S.lazyProperties)({container:()=>a.Styles.createViewStyle({height:89,alignItems:"center",flex:1}),progress:()=>a.Styles.createViewStyle({alignSelf:"stretch",height:8,backgroundColor:w.Color.gray100Overlay30}),progressBar:()=>x.default.absoluteFill,messageWrapper:()=>a.Styles.createViewStyle({flexDirection:"column",justifyContent:"flex-start",flex:1}),message:()=>a.Styles.createTextStyle({flexDirection:"column",justifyContent:"flex-start",font:P.default.font.uiDisplayRegular,fontSize:P.default.fontSize.size17,flex:1,paddingHorizontal:16,paddingVertical:12}),messageTimeMaxedOut:()=>a.Styles.createTextStyle({color:w.Color.blue}),innerContainer:()=>a.Styles.createViewStyle({paddingRight:16,paddingLeft:4,flexDirection:"row",alignSelf:"stretch",alignItems:"center",flex:1,justifyContent:"space-between"}),cancelButton:()=>a.Styles.createViewStyle({height:k.IconSize.default,width:k.IconSize.size32}),sendButton:()=>a.Styles.createButtonStyle({borderRadius:k.IconSize.default/2,height:k.IconSize.default,width:k.IconSize.default}),desktopOverrides:()=>(0,S.lazyProperties)({container:()=>a.Styles.createViewStyle({height:50,alignItems:"center",flex:1,flexDirection:"row"}),innerContainer:()=>a.Styles.createViewStyle({borderRadius:25,paddingRight:10,paddingLeft:6}),progress:()=>a.Styles.createViewStyle({marginRight:8,marginLeft:6,flexShrink:0,flexGrow:1,alignSelf:"center",backgroundColor:w.Color.gray300Overlay70}),messageWrapper:()=>a.Styles.createViewStyle({flexGrow:0}),message:()=>a.Styles.createTextStyle({paddingHorizontal:10,fontSize:P.default.controlFontSize.tabHeader}),sendButton:()=>a.Styles.createButtonStyle({marginLeft:5,width:40,height:40}),cancelButton:()=>a.Styles.createViewStyle({width:40,height:40,borderRadius:20})}),loadingIndicator:()=>a.Styles.createTextStyle({flexGrow:1,fontSize:P.default.controlFontSize.tabHeader,paddingLeft:12})});class D extends R.default{constructor(){super(...arguments),this._progressBarWidth=0,this._progressBarAnimatedValue=new a.Animated.Value(0),this._progressBarAnimatedStyle=a.Styles.createAnimatedViewStyle({width:this._progressBarAnimatedValue}),this._audioManagerClient=new d.default(d.AudioManagerSource.AudioMessageComposer),this._onLayoutChanges=e=>{this._progressBarWidth=e.width},this._onCancelRecording=()=>{M.default.maybeAnnounceForAccessibility(f.getString("AudioMessageComposer.AudioMessageCancelled")),this.props.onDone(),m.track(new y.AudioMessageCancelEvent)},this._onSendRecording=()=>{const e=O.default.newCauseId();switch(m.log(p.LogTraceArea.AudioMessageComposer,"_onSendRecording causeId: "+e),h.default.getRecordingStateNoSubscription()){case h.RecordingState.StartingMic:case h.RecordingState.Recording:h.default.stopRecording();break;case h.RecordingState.None:return void m.error(p.LogTraceArea.AudioMessageComposer,"Cannot send audio message: not recording audio")}c.postAudio(this.props.conversationId,T.ScenarioName.SendAudioMessage).then((()=>{h.default.reset(),M.default.maybeAnnounceForAccessibility(f.getString("AudioMessageComposer.AudioMessageSent")),M.default.isMobileScreenReaderEnabled()?(I.default.SkypeMessageSent.playOnce(e),o.delay((()=>this.props.onDone()),1500)):this.props.onDone()}))},this._resetRecording=e=>{h.default.reset(),this._audioManagerClient.release(e)},this._startRecording=e=>{if(this._playerToken=v.default.registerAsPlayer(),this.state.microphonePermissionStatus===r.PermissionStatus.Granted){const t=M.default.isMobileScreenReaderEnabled()?n.AudioModes.CallPreferSpeaker:n.AudioModes.RecordAudioMessage;this._audioManagerClient.requestMode(t,e).then((e=>{e&&this.isComponentMounted()&&(v.default.setAsActive(this._playerToken),h.default.startRecording(250))}))}else this.state.microphonePermissionStatus===r.PermissionStatus.Unknown&&_.default.requestPermission(A.PermissionType.Microphone,A.PermissionPromptOptions.SkipPrePrompt).then((e=>{e===r.PermissionStatus.Granted&&(this.setState({microphonePermissionStatus:e}),h.default.startRecording(250))}))}}_buildState(e,t){const s=h.default.getRecordingState();return{elapsedRecordingTimeMs:h.default.getElapsedTimeMs(),recordingError:h.default.getRecordingError(),microphonePermissionStatus:_.default.permissionStatus(A.PermissionType.Microphone),sendDisabled:!o.includes([h.RecordingState.Recording,h.RecordingState.HasAudio],s),isRecording:s===h.RecordingState.Recording,isStartingMic:s===h.RecordingState.StartingMic}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=O.default.newCauseId();m.log(p.LogTraceArea.AudioMessageComposer,"componentDidUpdate causeId:",i);const o=h.default.getRecordingState(),n=h.default.getRecordingError();if(o===h.RecordingState.Recording)if(this.state.elapsedRecordingTimeMs>=this.props.maxRecordingTimeMs){h.default.stopRecording(),this._progressBarAnimatedValue.setValue(this._progressBarWidth);const e=f.getString("AudioMessageComposer.RecordingFinishedAccessibiltyAnnouncement");M.default.maybeAnnounceForAccessibility(e)}else{const e=this.state.elapsedRecordingTimeMs/this.props.maxRecordingTimeMs;this._progressBarAnimatedValue.setValue(Math.abs(this._progressBarWidth*e))}else n!==h.RecordingError.StartFailed&&n!==h.RecordingError.StopFailed||this._audioManagerClient.release(i)}componentDidMount(){super.componentDidMount();const e=O.default.newCauseId();m.log(p.LogTraceArea.AudioMessageComposer,"componentDidMount causeId:",e),this._startRecording(e)}componentWillUnmount(){super.componentWillUnmount();const e=O.default.newCauseId();m.log(p.LogTraceArea.AudioMessageComposer,"componentWillUnmount causeId:",e),this._resetRecording(e)}render(){let e;if(this.state.microphonePermissionStatus!==r.PermissionStatus.Granted)this.state.microphonePermissionStatus===r.PermissionStatus.Denied&&b.default.showDeniedPromptWithSettingsOption(A.PermissionType.Microphone,this._getRootViewId()),e=f.getString("AudioMessageComposer.NoMicrophoneAccess");else switch(this.state.recordingError){case h.RecordingError.None:break;case h.RecordingError.StartFailed:case h.RecordingError.StopFailed:e=f.getString("AudioMessageComposer.RecordingFailed");break;default:m.error(p.LogTraceArea.AudioMessageComposer,"Unhandled recording error case"+this.state.recordingError)}{const t=[B.innerContainer,B.desktopOverrides.innerContainer];return this._themeStyles.messageComposerBackgroundStyle&&t.push(this._themeStyles.messageComposerBackgroundStyle),(0,i.jsxs)(a.View,Object.assign({style:B.desktopOverrides.container},{children:[(0,i.jsxs)(a.View,Object.assign({style:t},{children:[this._getCancelButton(),this._getProgressBar(),this._getTimerElement(e)]})),this._getSendButton(e)]}))}}_getSendButton(e){const t=[B.sendButton];return t.push(B.desktopOverrides.sendButton),(0,i.jsx)(l.default,{size:l.ActionButtonSize.Small,title:f.getString("AudioMessageComposer.SendButtonTitle"),onPress:this._onSendRecording,style:t,icon:k.SkypeIcon.Send,disabled:!o.isEmpty(e)||this.state.sendDisabled,flipIcon:this._getContext().isRTL,autoFocus:!0})}_getTimerElement(e){let t=e;if(!t){const e=Math.round(this.state.elapsedRecordingTimeMs/1e3),s=u.default.getElapsedTimePartsFromS(e);t=f.getString("AccessibilityLabel.NumberOfMinutesSecondsRecorded",{minuteCount:s.minutes,secondCount:s.seconds})}const s=[B.message,this._themeStyles.primaryTextColorStyle];return s.push(B.desktopOverrides.message),this.state.elapsedRecordingTimeMs>=this.props.maxRecordingTimeMs&&s.push(B.messageTimeMaxedOut),(0,i.jsx)(a.View,Object.assign({accessibilityLabel:t,importantForAccessibility:a.Types.ImportantForAccessibility.Yes,style:B.desktopOverrides.messageWrapper},{children:(0,i.jsx)(a.Text,Object.assign({style:s,numberOfLines:2,importantForAccessibility:a.Types.ImportantForAccessibility.No},{children:e||u.default.getElapsedTimeStringFromMs(this.state.elapsedRecordingTimeMs)}))}))}_getCancelButton(){if(this.state.isStartingMic)return(0,i.jsx)(F.default,{size:L.SXActivityIndicatorSize.ExtraSmall,tintColor:this._themeColors.primaryIconColor});const e=[B.cancelButton];return e.push(B.desktopOverrides.cancelButton),(0,i.jsx)(g.default,{title:f.getString("AudioMessageComposer.CancelButtonTitle"),disabled:this.state.isStartingMic,onPress:this._onCancelRecording,size:k.IconSize.size20,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,hoverStyle:this._themeStyles.buttonBackgroundHoverColorStyle,style:e,icon:k.SkypeIcon.Cancel})}_getProgressBar(){if(this.state.isStartingMic)return(0,i.jsx)(a.Text,Object.assign({style:[B.loadingIndicator,this._themeStyles.primaryTextColorStyle]},{children:f.getString("Global.LoadingStatus")}));const e=[B.progress];return e.push(B.desktopOverrides.progress),(0,i.jsx)(a.View,Object.assign({style:e,onLayout:this._onLayoutChanges},{children:(0,i.jsx)(a.Animated.View,{style:[B.progressBar,this._progressBarAnimatedStyle,C.default.getBackgroundColorStyleNoSubscription()]})}))}}t.default=D},220490:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(244770),r=s(915877),a=s(733754),l=s(24576),d=(0,r.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",paddingHorizontal:30}),image:()=>o.Styles.createImageStyle({width:142,height:132}),paragraph:()=>o.Styles.createTextStyle({marginTop:40,marginBottom:20}),paragraphCommon:()=>o.Styles.createTextStyle({textAlign:"center"})});class c extends l.default{render(){const e=this.props.isUsingStackNavigationContext?a.getString("BookmarksConversation.SecondParagraphMobile"):a.getString("BookmarksConversation.SecondParagraphDesktop");return(0,i.jsxs)(o.View,Object.assign({style:d.container},{children:[(0,i.jsx)(o.Image,{style:d.image,source:n.Collection.BOOKMARKS_EMPTY_STATE}),(0,i.jsx)(o.Text,Object.assign({style:[this._themeStyles.secondaryTextColorStyle,d.paragraph,d.paragraphCommon]},{children:a.getString("BookmarksConversation.FirstParagraph")})),(0,i.jsx)(o.Text,Object.assign({style:[this._themeStyles.secondaryTextColorStyle,d.paragraphCommon]},{children:e}))]}))}}t.default=c},154549:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(671830),a=s(147204),l=s(400984),d=s(539549),c=s(765947),h=s(913944),u=s(528234),p=s(104794),g=s(452461),m=s(207705),S=s(926448),f=s(915877),y=s(733754),v=s(798401),C=s(178735),_=s(581760),b=s(711828),T=s(79669),M=s(24576),I=(0,f.lazyProperties)({popupInnerView:()=>n.Styles.createViewStyle({minWidth:210}),buttonWithBackground:()=>n.Styles.createViewStyle({borderRadius:20,width:40,height:40,marginLeft:4}),redDot:()=>n.Styles.createViewStyle({width:10,height:10,borderRadius:5,backgroundColor:_.Color.red,position:"absolute",right:0,top:0})});class w extends M.default{constructor(){super(...arguments),this._onMoreButtonPress=e=>{this._openMorePopup(),this.state.shouldShowRedDot&&(C.default.setUserPreferencesLocal({showComposerPopupMenuIndicator:!1}),this.setState({shouldShowRedDot:!1})),this.props.onOverflowButtonPress&&this.props.onOverflowButtonPress(e)},this._onMoreButtonRef=e=>{this._moreButtonRef=e||void 0},this._openMorePopup=()=>{const e=m.default.filterIntegrations(o.values(this.state.allIntegrations),this._getIntegrationFilters()),t={getAnchor:()=>this._moreButtonRef,renderPopup:(t,s,o,r)=>(0,i.jsx)(T.default,Object.assign({anchorPosition:t,anchorOffset:s,popupWidth:o,popupHeight:r,fillColor:this._themeColors.popoverBackgroundColor,strokeColor:this._useDarkTheme()?this._themeColors.popupBorderColor:void 0,skipPopupAutoFocus:!0,borderRadius:10},{children:(0,i.jsx)(n.View,Object.assign({style:I.popupInnerView},{children:(0,i.jsx)(p.default,{conversationId:this.props.conversationId,hideAddInsTitle:!0,isInline:!0,onIntegrationPress:this._onIntegrationPress,overflowActionConfig:this.props.overflowConfig,otherPartyMri:this.props.otherPartyMri,filteredIntegrations:e})}))})),positionPriorities:["top","bottom"],dismissIfShown:!0,rootViewId:this._getRootViewId(),onDismiss:this._onPopupDismiss};a.default.showPopup(t,"composerPopup"),this.setState({isPopupOpened:!0})},this._onPopupDismiss=()=>{this.setState({isPopupOpened:!1})},this._onIntegrationPress=e=>{c.default.openIntegration(e,this.props.conversationId,this._getContext(),void 0,void 0,void 0)},this._filterBing=e=>e.id!==u.IntegrationIds.Bing,this._filterHidden=e=>!e.hideInFindPanel,this._filterConnectors=e=>!S.default.isConnectorIntegration(e)||r.isGroupConversation(this.props.conversationId)}_buildState(e,t){const s=m.default.getProxiedIntegrations(o.compact(g.default.getIntegrations())),i={};o.each(s,(e=>{i[e.id]=e}));const n={shouldShowRedDot:C.default.getUserPreferencesLocal().showComposerPopupMenuIndicator&&v.default.isAnyMediaBarItemNew(e.overflowConfig.mediaBarItems),allIntegrations:i},r=(0,d.default)().getConversation(e.conversationId);return r&&(n.conversation=r,n.isConversationAccepted=!!r&&l.default.isConversationAccepted(r.id)),n}render(){const e=m.default.filterIntegrations(o.values(this.state.allIntegrations),this._getIntegrationFilters());if(o.isEmpty(this.props.overflowConfig.mediaBarItems)&&o.isEmpty(e))return null;const t=[I.buttonWithBackground,this._themeStyles.buttonBackgroundColorStyle],s=this.state.shouldShowRedDot?(0,i.jsx)(n.View,{style:I.redDot}):void 0;return this.state.isPopupOpened&&t.push(this._themeStyles.buttonBackgroundHoverColorStyle),(0,i.jsxs)(n.View,{children:[(0,i.jsx)(h.default,{color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:b.SkypeIcon.More,size:b.IconSize.size20,style:t,hoverStyle:this._themeStyles.buttonBackgroundHoverColorStyle,accessibilityLabel:y.getString("Global.MoreOptions"),onPress:this._onMoreButtonPress,ref:this._onMoreButtonRef}),s]})}_getIntegrationFilters(){return[this._filterBing,this._filterConnectors,this._filterHidden]}}t.default=w},403326:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(711930),r=s(139889),a=s(915877),l=s(581760),d=s(711828),c=s(24576),h=d.IconSize.size20,u=(0,a.lazyProperties)({button:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"flex-start",minHeight:44}),iconAltView:()=>o.Styles.createViewStyle({height:h,width:h,borderRadius:10,backgroundColor:l.Color.gray100}),icon:()=>o.Styles.createImageStyle({height:h,width:h,borderRadius:10,justifyContent:"center",alignItems:"center"}),iconContainer:()=>o.Styles.createButtonStyle({height:h,width:h,justifyContent:"center",alignItems:"center",marginHorizontal:12}),buttonTitle:()=>o.Styles.createTextStyle({width:150,lineHeight:18,overflow:"visible"})});class p extends c.default{constructor(){super(...arguments),this._onHoverStart=()=>{this.isComponentMounted&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted&&this.setState({isHovering:!1})},this._onPress=()=>{this.props.onIntegrationPress(this.props.integration)}}_buildState(e,t){const s={};return t&&(s.isHovering=!1),s}render(){const e=(0,i.jsx)(o.View,{style:u.iconAltView}),t=(0,i.jsx)(r.default,{origin:"IntegrationsView",altView:e,style:u.icon,containerStyle:u.iconContainer,source:this.props.integration.icon,resizeMode:"cover"}),s=[u.button];this.state.isHovering&&s.push(this._themeStyles.rowHoverViewStyle);const a=this.props.integration.name,l=this.props.integration.description;return(0,i.jsxs)(o.Button,Object.assign({accessibilityLabel:n.default.combinedAccessibilityLabel(a,l),style:s,onPress:this._onPress,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd},{children:[t,(0,i.jsx)(o.Text,Object.assign({style:[this._themeStyles.primaryTextColorStyle,u.buttonTitle]},{children:a}))]}))}}t.default=p},194814:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(711930),r=s(915877),a=s(798401),l=s(539320),d=s(680837),c=s(24576),h=(0,r.lazyProperties)({button:()=>o.Styles.combine(o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"flex-start",minHeight:44}),d.default.pointerCursor),buttonTitle:()=>o.Styles.createTextStyle({width:150,lineHeight:18,overflow:"visible"}),buttonTitleWithLabel:()=>o.Styles.createTextStyle({width:138,paddingRight:5}),mediaBarIconContainer:()=>o.Styles.createButtonStyle({marginHorizontal:4}),newLabel:()=>o.Styles.createButtonStyle({flex:1,marginRight:15})});class u extends c.default{constructor(){super(...arguments),this._onHoverStart=()=>{this.isComponentMounted&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted&&this.setState({isHovering:!1})},this._onFocus=()=>{this.isComponentMounted&&this.setState({isFocused:!0})},this._onBlur=()=>{this.isComponentMounted&&this.setState({isFocused:!1})},this._onMediaBarPress=(e,t)=>{this.props.onMediaBarItemPress(e,t)},this._onMediaBarKeyPress=(e,t)=>{this.props.onMediaBarItemKeyPress(e,t)}}_buildState(e,t){const s={};return t&&(s.isHovering=!1,s.isFocused=!1,s.isNewItem=a.default.isMediaBarItemNew(e.mediaBarItem.id)),s}componentWillUnmount(){super.componentWillUnmount(),this.state.isNewItem&&a.default.setMediaBarItemAsSeen(this.props.mediaBarItem.id)}render(){const e=this.props.mediaBarItem.render(this.props.mediaBarItemProps),t=a.default.getMediaBarItemTitle(this.props.mediaBarItem.id),s=a.default.getMediaBarItemDescription(this.props.mediaBarItem.id),r=[h.button];(this.state.isHovering||this.state.isFocused)&&r.push(this._themeStyles.rowHoverViewStyle);const d=[this._themeStyles.primaryTextColorStyle,h.buttonTitle];return this.state.isNewItem&&d.push(h.buttonTitleWithLabel),(0,i.jsxs)(o.View,Object.assign({accessibilityLabel:n.default.combinedAccessibilityLabel(t,s),importantForAccessibility:o.Types.ImportantForAccessibility.Yes,accessibilityTraits:o.Types.AccessibilityTrait.Button,onPress:e=>this._onMediaBarPress(e,this.props.mediaBarItem),onKeyPress:e=>this._onMediaBarKeyPress(e,this.props.mediaBarItem),tabIndex:0,style:r,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,onFocus:this._onFocus,onBlur:this._onBlur},{children:[(0,i.jsx)(o.View,Object.assign({style:h.mediaBarIconContainer},{children:e})),(0,i.jsx)(o.Text,Object.assign({style:d},{children:t})),this.state.isNewItem&&(0,i.jsx)(l.default,{style:h.newLabel})||void 0]}))}}t.default=u},738386:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(667294),o=s(785893),n=s(174958),r=s(496486),a=s(583367),l=s(516778),d=s(244770),c=s(934339),h=s(739119),u=s(63413),p=s(544279),g=s(671830),m=s(898278),S=s(400984),f=s(23293),y=s(539549),v=s(952262),C=s(904604),_=s(746096),b=s(110117),T=s(436237),M=s(976391),I=s(915877),w=s(650556),P=s(267824),k=s(647662),A=s(733754),x=s(104735),R=s(330124),O=s(192210),L=s(616819),F=s(29130),B=s(914976),D=s(420486),E=s(938985),V=s(965988),N=s(404057),U=s(915415),j=s(22222),H=s(581760),z=s(311010),W=s(711828),G=s(478262),K=s(680837),q=s(360305),Q=s(794050),X=s(619675),$=s(24576),J=s(482415),Y=s(702301),Z=s(567977),ee=s(172758),te="processingInviteLink",se=(0,I.lazyProperties)({contactInviteHeaderContainer:()=>l.Styles.createViewStyle({flex:1,alignItems:"center",borderBottomWidth:1,paddingBottom:20}),contactInviteHeaderContainerDesktop:()=>l.Styles.createViewStyle({justifyContent:"flex-start",flex:0}),userIcon:()=>l.Styles.createViewStyle({marginTop:20}),confirmationText:()=>l.Styles.createTextStyle({marginHorizontal:24,textAlign:"center"}),buttonContainer:()=>l.Styles.createViewStyle({flexDirection:"row",flex:0,alignSelf:"stretch",marginTop:20,marginHorizontal:24,justifyContent:"center"}),contactInviteButton:()=>l.Styles.createButtonStyle({height:60,flex:1,maxWidth:200}),contactInviteButtonHalfWidth:()=>l.Styles.createButtonStyle({flexBasis:0}),contactInviteButtonSpacer:()=>l.Styles.createButtonStyle({marginLeft:10}),annotationContainer:()=>l.Styles.createViewStyle({flex:0,flexDirection:"row",alignSelf:"stretch",marginHorizontal:16,marginTop:18,marginBottom:4,justifyContent:"center"}),annotationContainerColumn:()=>l.Styles.createViewStyle({alignSelf:"center",alignItems:"center",flexDirection:"column"}),annotationContainerColumnDesktop:()=>l.Styles.createViewStyle({alignSelf:"flex-start",alignItems:"flex-start",marginLeft:0}),annotationPart:()=>l.Styles.createViewStyle({flexDirection:"row",flex:-1,maxWidth:250}),annotationText:()=>l.Styles.createTextStyle({paddingLeft:4,flex:-1}),divider:()=>l.Styles.createViewStyle({flex:0,width:1,height:20,marginHorizontal:8}),pstnHeaderText:()=>l.Styles.createTextStyle({fontSize:z.default.controlFontSize.bodySmallDeprecated}),pstnImage:()=>l.Styles.createImageStyle({height:250,width:250}),pstnCtaButton:()=>l.Styles.createButtonStyle({minWidth:200,marginVertical:5,marginHorizontal:15}),pstnCtaButtonsContainer:()=>l.Styles.createViewStyle({justifyContent:"center"}),pstnCtaExplanationText:()=>l.Styles.createTextStyle({fontSize:z.default.controlFontSize.bodySmallDeprecated,marginVertical:5}),pstnCtaSeparatorText:()=>l.Styles.createTextStyle({marginVertical:10}),confirmationTextSmallViewSpacing:()=>l.Styles.createViewStyle({paddingTop:20}),experimentalInviteContainerDesktop:()=>l.Styles.createViewStyle({borderBottomWidth:1}),experimentalInviteBoxSection:()=>l.Styles.createViewStyle({marginTop:40,marginBottom:20,paddingVertical:15,paddingHorizontal:20,alignItems:"center",borderRadius:8}),experimentalInviteBoxSectionDesktop:()=>l.Styles.createViewStyle({width:360}),experimentalCommonMarginTop:()=>l.Styles.createViewStyle({marginTop:20}),experimentalInviteBoxSectionWide:()=>l.Styles.createViewStyle({width:440}),experimentalInviteBoxSectionMobile:()=>l.Styles.createViewStyle({marginTop:20,flex:1,alignSelf:"stretch",marginHorizontal:10}),experimentalInviteButton:()=>l.Styles.createViewStyle({minWidth:150,marginHorizontal:50,marginTop:20}),experimentalInviteButtonMobile:()=>l.Styles.createViewStyle({minWidth:100,alignSelf:"stretch"}),experimentalIncomingInviteButton:()=>l.Styles.createViewStyle({marginHorizontal:10,maxWidth:250}),experimentalInviteEmoticonContainer:()=>l.Styles.createViewStyle({marginBottom:20}),experimentalInviteText:()=>l.Styles.createTextStyle({paddingHorizontal:20,textAlign:"center"}),experimentalInviteAnnotationDivider:()=>l.Styles.createViewStyle({height:10}),experimentalInviteHeader:()=>l.Styles.createTextStyle({fontSize:20,textAlign:"center",flexShrink:1}),experimentalInviteButtonContainer:()=>l.Styles.createTextStyle({flexDirection:"row",flexWrap:"wrap",alignSelf:"stretch",justifyContent:"center"}),experimentalHeaderContainer:()=>l.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"center",flex:1}),experimentalHeaderContainerDesktop:()=>l.Styles.createViewStyle({flexDirection:"row",overflow:"hidden",marginHorizontal:20}),experimentalHeaderTextDesktop:()=>l.Styles.createViewStyle({justifyContent:"center",flexShrink:1,alignItems:"flex-start",flexWrap:"wrap"}),experimentalHeaderTextContainerDesktop:()=>l.Styles.createViewStyle({flexShrink:0,flexGrow:0,flexDirection:"row",alignItems:"flex-start",overflow:"hidden"}),experimentalUserIconDesktop:()=>l.Styles.createViewStyle({marginRight:20}),experimentalUserIconMobile:()=>l.Styles.createViewStyle({alignSelf:"center"})});class ie extends $.default{constructor(){super(...arguments),this._onInviteButtonRef=e=>{this._inviteButtonRef=e||void 0},this._onInvite=()=>{g.getPhoneNumberFromMri(this.props.conversationId)&&E.default.initiateJoinLinkInvite({target:new E.ShareSheetInvite,origin:_.ContactInviteOrigin.PstnChatWindow,showLoadingModalWhileGettingJoinLink:!0,recipientName:this.state.userShortDisplayName,anchor:()=>this._inviteButtonRef,rootViewId:this._getRootViewId()})},this._onAddCredit=()=>{x.default.navigateToBalanceStatePanel("ContactInviteHeader.fromCTA",this._getRootViewId())},this._onAcceptInvite=e=>{T.log(_.LogTraceArea.Contacts,"ContactInviteHeader._onAcceptInvite"),this.props.inviteToken?(this._inviteAcceptanceScenario&&this._inviteAcceptanceScenario.markStepCompleted("AcceptButtonClicked"),w.LoadingDialog.show({dialogId:te,dialogText:A.getString("UrlConverter.ProcessingInviteLinkMessage"),showActivityIndicator:!0,showCancelButton:!1},this._getRootViewId()),M.default.autoBuddy(this.props.inviteToken).then((e=>(T.log(_.LogTraceArea.AutoBuddy,`handleAutoBuddyInviteLink: autoBuddy [${e.Buddied}, ${n.pii.Omit(e.Uri)}]`),e.Buddied&&this._inviteAcceptanceScenario&&(this._inviteAcceptanceScenario.markStepCompleted("AutobuddySucceed"),this._inviteAcceptanceScenario.isResolved()||(this._inviteAcceptanceScenario.finish(),this._inviteAcceptanceScenario=void 0)),e.Buddied||(T.warn(_.LogTraceArea.AutoBuddy,`Failed to autobuddy ${n.pii.Omit(this.props.inviteToken||"")}`),this._inviteAcceptanceScenario&&(this._inviteAcceptanceScenario.markStepCompleted("AutobuddyFailed"),this._inviteAcceptanceScenario.isResolved()||(this._inviteAcceptanceScenario.fail("Failed to autobuddy"),this._inviteAcceptanceScenario=void 0))),this._acceptInvite()))).finally((()=>{w.LoadingDialog.dismiss(te,this._getRootViewId())}))):this._acceptInvite()},this._onBlockInviter=()=>{const e={mriToBlock:this.state.inviterMri,rootViewId:this._getRootViewId(),reportContext:_.ReportContextListOptions.ContactRequest,isBlockingDialog:!0},t={navigateAway:!0,declineInvite:!0};if(this.state.isOneOnOneConversation){this.props.inviteToken&&this._inviteAcceptanceScenario&&(this._inviteAcceptanceScenario.markStepCompleted("BlockInviterClicked"),this._inviteAcceptanceScenario.finish(),this._inviteAcceptanceScenario=void 0);u.default.isMriBlocked(this.state.inviterMri)?(0,J.unblockContact)(this.state.inviterMri):x.default.navigateToReportConcernModal(e,t)}else e.groupConversationId=this.props.conversationId,x.default.navigateToReportConcernModal(e,t)}}_buildState(e,t){const s=g.isOneOnOneConversation(e.conversationId);let i;if(s)i=e.otherPartyMri;else{const t=(0,y.default)().getConversation(e.conversationId);i=t?t.getAddedBy():void 0}const o=i?ee.default.getFullUserProfileByMri(i):void 0,n=!!this._isPSTNConversationAndSmsAllowed()&&p.default.isPhoneMriTollFree(e.conversationId),r=C.default.getCreditEntitlement(),l=!!h.getPositiveCreditBalance(r)||C.default.userHasSubscriptions(),d=this._getRootViewId(),c=!!i&&!g.isPhoneMri(i);let u=!1;return!g.isOneOnOneConversation(e.conversationId)||g.isEncryptedThread(e.conversationId)||g.isV2OneToOneThread(e.conversationId)||(u=!S.default.isManuallyAddedContact(ee.default.getConversationOwner(e.conversationId))),{isUsingStackNavigationContext:R.default.isUsingStackNavigationContext(),isSmallDevice:F.default.isSmallDevice(d),isSmallHeightView:F.default.isSmallDesktopHeightView(d),isMediumHeightView:F.default.isHeightSmallerThanThreshold(768,d),isLandscape:F.default.getDeviceOrientation(d)===a.DeviceOrientation.Landscape&&R.default.isUsingStackNavigationContext(),useTabletUI:q.default.isTabletUI(),inviterMri:i,isOneOnOneConversation:s,isTollFreeNumber:n,isPayingUser:l,userFullDisplayName:i?v.default.getDisplayName(i):A.getString("Notifications.UnknownUserShort"),userShortDisplayName:i?v.default.getShortDisplayName(i):A.getString("Notifications.UnknownUserShort"),gender:o?o.gender:void 0,gradientColors:i&&c?f.default.getGradientColors(i):void 0,primaryColor:i&&c?f.default.getPrimaryColor(i):void 0,isSearchingSkypeGraph:!1,showBlockPSTNUser:u,isPairedToSkypeUser:!!e.otherPartyMri&&ee.default.getConversationOwner(e.otherPartyMri)!==e.otherPartyMri}}_getLocationFromSkypeGraphResult(e){return e.nodeProfileData.city&&e.nodeProfileData.state?A.getString("ContactInviteResponder.LocationCityState",{city:e.nodeProfileData.city,state:e.nodeProfileData.state}):e.nodeProfileData.city&&e.nodeProfileData.country?A.getString("ContactInviteResponder.LocationCityCountry",{city:e.nodeProfileData.city,country:e.nodeProfileData.country}):e.nodeProfileData.state&&e.nodeProfileData.country?A.getString("ContactInviteResponder.LocationStateCountry",{state:e.nodeProfileData.state,country:e.nodeProfileData.country}):e.nodeProfileData.city||e.nodeProfileData.state||e.nodeProfileData.country||""}componentDidMount(){if(super.componentDidMount(),!this.state.inviterMri)return;const e=g.getSkypeIdFromMri(this.state.inviterMri);e&&(D.default.searchPeopleAsync(e,Date.now().toString()).then((t=>{const s=t&&t.results?t.results:[];if(this.isComponentMounted()){const t=r.find(s,(t=>t.nodeProfileData&&t.nodeProfileData.skypeId===e));t?this.setState({location:this._getLocationFromSkypeGraphResult(t),numberOfMutualContacts:t.nodeConnectionData?t.nodeConnectionData.mutualFriendCount:0,isSearchingSkypeGraph:!1}):(T.warn(_.LogTraceArea.Contacts,"The Skype Graph did not return any data for SkypeID: "+B.mriOrId(e)),this.setState({location:void 0,numberOfMutualContacts:void 0,isSearchingSkypeGraph:!1}))}})).fail((t=>{T.error(_.LogTraceArea.Contacts,"Fetching loc and mutual contact data for ("+B.mriOrId(e)+") from the Skype Graph failed with: "+N.default.errorAsString(t))})),this.setState({isSearchingSkypeGraph:!0})),this.props.inviteToken&&(this._inviteAcceptanceScenario=new Q.default(O.ScenarioName.InviteAcceptance),this._inviteAcceptanceScenario.start(),this._inviteAcceptanceScenario.markStepCompleted("AcceptInviteUIshown"))}componentWillUnmount(){super.componentWillUnmount(),this.props.inviteToken&&this._inviteAcceptanceScenario&&!this._inviteAcceptanceScenario.isResolved()&&(this._inviteAcceptanceScenario.invalidate(),this._inviteAcceptanceScenario=void 0)}render(){if(this.state.isOneOnOneConversation&&!this._isPSTNConversationAndSmsAllowed()&&!g.isEncryptedThread(this.props.conversationId))return this._renderInvite();const e=this.state.isSmallDevice?44:60,t=this.state.isUsingStackNavigationContext?void 0:this.state.gradientColors;let s,i,n;if(this.state.isUsingStackNavigationContext||(s=[se.contactInviteHeaderContainerDesktop,this._themeStyles.messageStreamBackgroundColorStyle]),this.props.showWave&&this.props.onGreet&&(i=(0,o.jsx)(V.default,{conversationId:this.props.conversationId,displayName:this.state.userShortDisplayName,gender:this.state.gender,onGreet:this.props.onGreet})),!this.state.isSmallHeightView){const s=this.state.isUsingStackNavigationContext&&!this.props.isIncomingContactInvitePending;n=(0,o.jsxs)(L.default,Object.assign({backgroundHeight:s?Z.UserIconSize.Size120+e:Z.UserIconSize.Size120,paddingTop:s?e:0,gradientColors:t},{children:[this._renderPstnOrNonPstnConversationView(),this._renderPstnOptionsButtons()]}))}return(0,o.jsxs)(l.View,Object.assign({style:s},{children:[(0,o.jsxs)(l.View,Object.assign({style:[se.contactInviteHeaderContainer,this.props.style,this._themeStyles.dividerBorderColorStyle]},{children:[n,this._renderOptionalConfirmationText(),this._renderAnnotationContainer(),this._renderOptionalButtonsContainer(),this._renderBlockUnWantedPSTNUserText(),this._renderBlockPSTNHyperLink()]})),i]}))}_isPSTNConversationAndSmsAllowed(){return g.isPhoneMri(this.props.conversationId)}_renderBlockPSTNHyperLink(){if(!this.state.showBlockPSTNUser||!this.state.inviterMri)return;const e=A.getString("PSTNConversation.BlockPSTNNumber",{PSTNNumber:g.stripMriNamespace(this.state.inviterMri)});return(0,o.jsx)(l.Button,Object.assign({onPress:this._onBlockInviter,accessibilityLabel:e},{children:(0,o.jsx)(P.Link,Object.assign({url:"#",onPress:this._onBlockInviter},{children:e}),"blockPSTNHyperLink")}))}_renderBlockUnWantedPSTNUserText(){if(!this.state.showBlockPSTNUser)return;const e=[z.default.messagingHeaderFontStyle(!1,F.default.isSmallDeviceNoSubscription(this._getRootViewId()),this._currentTheme,!0),se.confirmationText,this._isPSTNConversationAndSmsAllowed()?se.pstnCtaExplanationText:void 0];return(0,o.jsx)(l.Text,Object.assign({style:e},{children:A.getString("PSTNConversation.BlockUnWantedPSTNUser")}))}_showInviteToSkypeOption(){return this._isPSTNConversationAndSmsAllowed()&&!this.state.isTollFreeNumber&&!this.state.isPairedToSkypeUser}_showAddCreditOption(){return this._showInviteToSkypeOption()&&!this.state.isPayingUser}_getInviteToSkypeButtonConfig(){return{buttonStyle:this.state.isPayingUser?m.SXButtonStyle.DarkFill:m.SXButtonStyle.ThemeStroke,style:se.pstnCtaButton}}_getAddCreditButtonConfig(){return{buttonStyle:this.state.isPayingUser?m.SXButtonStyle.ThemeStroke:m.SXButtonStyle.DarkFill,style:se.pstnCtaButton}}_renderPstnOrNonPstnConversationView(){return this.state.isTollFreeNumber?(0,o.jsx)(l.Image,{source:d.Collection.PSTN_PHONE,style:se.pstnImage}):!this._isPSTNConversationAndSmsAllowed()||this.state.isTollFreeNumber||this.state.isPairedToSkypeUser?(0,o.jsx)(Y.UserIcon,{userMri:this.props.conversationId,size:Z.UserIconSize.Size120,style:se.userIcon,importantForAccessibility:l.Types.ImportantForAccessibility.NoHideDescendants}):this.state.isPayingUser?(0,o.jsx)(l.Image,{source:d.Collection.PSTN_CLUSTER,style:se.pstnImage}):(0,o.jsx)(l.Image,{source:d.Collection.PSTN_PHONE,style:se.pstnImage})}_renderOptionalConfirmationText(){if(this._isPSTNConversationAndSmsAllowed())return;const e=[z.default.messagingHeaderFontStyle(!1,this.state.isSmallDevice,this._currentTheme,!0),se.confirmationText,this._isPSTNConversationAndSmsAllowed()?se.pstnHeaderText:void 0];return this.state.isSmallHeightView&&e.push(se.confirmationTextSmallViewSpacing),(0,o.jsx)(X.PanelHeader,Object.assign({style:e},{children:this._getConfirmationTextString()}))}_renderPstnOptionsButtons(){const e=[z.default.messagingHeaderFontStyle(!1,this.state.isSmallDevice,this._currentTheme,!0),se.confirmationText,this._isPSTNConversationAndSmsAllowed()?se.pstnCtaExplanationText:void 0];return this._showAddCreditOption()?(0,o.jsxs)(l.View,Object.assign({style:se.pstnCtaButtonsContainer},{children:[(0,i.createElement)(j.default,Object.assign({},this._getInviteToSkypeButtonConfig(),{key:"invite",ref:this._onInviteButtonRef,buttonSize:m.SXButtonSize.Medium,onPress:this._onInvite,title:A.getString("PSTNConversation.InviteButtonLabel")})),(0,o.jsx)(X.PanelHeader,Object.assign({style:e},{children:A.getString("PSTNConversation.InviteLabel")})),(0,o.jsx)(X.PanelHeader,Object.assign({style:[e,se.pstnCtaSeparatorText]},{children:A.getString("PSTNConversation.InviteButtonAndAddCreditButtonsSeperatorLabel")})),(0,i.createElement)(j.default,Object.assign({},this._getAddCreditButtonConfig(),{key:"addCredit",buttonSize:m.SXButtonSize.Medium,onPress:this._onAddCredit,title:A.getString("PSTNConversation.AddCreditButtonLabel")})),(0,o.jsx)(X.PanelHeader,Object.assign({style:e},{children:A.getString("PSTNConversation.UseSkypeCreditToCallLabel")}))]})):this._showInviteToSkypeOption()?(0,o.jsxs)(l.View,Object.assign({style:se.pstnCtaButtonsContainer},{children:[(0,i.createElement)(j.default,Object.assign({},this._getInviteToSkypeButtonConfig(),{key:"invite",ref:this._onInviteButtonRef,buttonSize:m.SXButtonSize.Medium,onPress:this._onInvite,title:A.getString("PSTNConversation.InviteButtonLabel")})),(0,o.jsx)(X.PanelHeader,Object.assign({style:e},{children:A.getString("PSTNConversation.InviteLabel")}))]})):void 0}_renderInvite(){let e,t;const s=[se.experimentalInviteBoxSection,this._themeStyles.secondaryBackgroundColorStyle],i=[K.default.alignItemsCenter,this._themeStyles.dividerBorderColorStyle],n=!this.state.isMediumHeightView,r=this._getConfirmationTextString();if(i.push(se.experimentalInviteContainerDesktop),s.push(se.experimentalInviteBoxSectionDesktop),this.state.isMediumHeightView&&s.push(se.experimentalCommonMarginTop),this.props.isIncomingContactInvitePending&&this.state.inviterMri){const i=[se.experimentalInviteButton,se.experimentalIncomingInviteButton,K.default.flexOne];if(n){const e="star";t=(0,o.jsx)(l.View,Object.assign({style:se.experimentalInviteEmoticonContainer},{children:(0,o.jsx)(c.AnimatedEmoticon,{size:c.Size.Large,innerText:e,emoticonName:e,showPlaceHolder:!0,standaloneAnimation:!0,placeholderBackgroundColor:this._themeColors.secondaryBackgroundColor})}))}s.push(se.experimentalInviteBoxSectionWide),e=(0,o.jsxs)(l.View,Object.assign({style:s},{children:[t,(0,o.jsx)(X.BodyText,Object.assign({style:se.experimentalInviteText,numberOfLines:2,ellipsizeMode:"tail"},{children:r})),(0,o.jsxs)(l.View,Object.assign({style:se.experimentalInviteButtonContainer},{children:[(0,o.jsx)(j.default,{title:A.getString("ContactInviteResponder.DeclineButtonText"),onPress:this._onBlockInviter,style:i,buttonStyle:this._useDarkTheme()?m.SXButtonStyle.ThemeStroke:m.SXButtonStyle.LightFill,buttonSize:m.SXButtonSize.Medium,disabled:this.state.isAcceptingContact},"declineContactInvite"),(0,o.jsx)(j.default,{title:A.getString("ContactInviteResponder.AcceptButtonText"),onPress:this._onAcceptInvite,style:i,buttonSize:m.SXButtonSize.Medium,showActivityIndicator:this.state.isAcceptingContact},"acceptContactInvite")]}))]}))}else if(this.props.showWave&&this.props.onGreet)n&&(t=(0,o.jsx)(l.View,Object.assign({style:se.experimentalInviteEmoticonContainer},{children:(0,o.jsx)(c.AnimatedEmoticon,{size:c.Size.Large,innerText:"hi",emoticonName:"hi",showPlaceHolder:!0,standaloneAnimation:!0,placeholderBackgroundColor:this._themeColors.secondaryBackgroundColor})}))),e=(0,o.jsxs)(l.View,Object.assign({style:s},{children:[t,(0,o.jsx)(X.BodyText,Object.assign({style:se.experimentalInviteText,numberOfLines:3,ellipsizeMode:"tail"},{children:r})),(0,o.jsx)(j.default,{style:se.experimentalInviteButton,buttonSize:m.SXButtonSize.Medium,title:A.getString("MessageStream.SayHiButton"),allowTextWrap:!1,onPress:this.props.onGreet})]}));else{if(n){let e;this.props.isContactInviteJustAccepted&&!g.isEncryptedThread(this.props.conversationId)||this.props.isEncryptedConversationEstablished?e="star":this.props.isAnyMessageInTheStream&&(e="sleepy"),e&&(t=(0,o.jsx)(l.View,Object.assign({style:se.experimentalInviteEmoticonContainer},{children:(0,o.jsx)(c.AnimatedEmoticon,{size:c.Size.Large,innerText:e,emoticonName:e,showPlaceHolder:!0,standaloneAnimation:!0,placeholderBackgroundColor:this._themeColors.secondaryBackgroundColor})})))}e=(0,o.jsxs)(l.View,Object.assign({style:s},{children:[t,(0,o.jsx)(X.BodyText,Object.assign({style:se.experimentalInviteText,numberOfLines:2,ellipsizeMode:"tail"},{children:r}))]}))}const a=[se.userIcon],d=[se.experimentalHeaderContainer],h=[se.experimentalCommonMarginTop],u=[];d.push(se.experimentalHeaderContainerDesktop),h.push(se.experimentalHeaderTextDesktop),u.push(se.experimentalHeaderTextContainerDesktop),a.push(se.experimentalUserIconDesktop);const p=this.state.isSmallDevice||this.state.isSmallHeightView?Z.UserIconSize.Size60:Z.UserIconSize.Size100;return(0,o.jsxs)(l.View,Object.assign({style:i,accessibilityLabel:r,accessibilityLiveRegion:l.Types.AccessibilityLiveRegion.Polite},{children:[(0,o.jsxs)(l.View,Object.assign({style:d},{children:[(0,o.jsx)(Y.UserIcon,{userMri:this.props.conversationId,size:p,style:a,importantForAccessibility:l.Types.ImportantForAccessibility.NoHideDescendants}),(0,o.jsxs)(l.View,Object.assign({style:h},{children:[(0,o.jsx)(X.PanelHeader,Object.assign({style:[u,se.experimentalInviteHeader],numberOfLines:1,ellipsizeMode:"tail"},{children:this.state.userFullDisplayName})),this._renderAnnotationContainer(!0)]}))]})),e]}))}_getConfirmationTextString(){if(this.props.isIncomingContactInvitePending){let e;return e=this.state.isOneOnOneConversation?"ContactInviteResponder.ConfirmationTextShort":"ContactInviteResponder.GroupConfirmationText",A.getString(e,{userName:this.state.userShortDisplayName})}if(this.props.isContactInviteJustAccepted&&!g.isEncryptedThread(this.props.conversationId)||this.props.isEncryptedConversationEstablished)return A.getString("MessageStream.SkypeFriendshipConfirmation");if(this._isPSTNConversationAndSmsAllowed())return A.getString("MessageStream.CallOrSendSMS");if(g.isEncryptedThread(this.props.conversationId))return A.getString("MessageStream.PrivateConversationHeaderFirstLine",{buddy:this.state.userShortDisplayName});const e=k.getLocalizeParamForGender(this.state.gender||G.eGender.Unspecified);return this.props.isAnyMessageInTheStream?A.getString("MessageStream.SkypeBeforeFriendshipConfirmation",{userName:this.state.userShortDisplayName,gender:e}):A.getString("MessageStream.GreetWithWaveActionLabel",{name:this.state.userShortDisplayName,gender:e})}_renderAnnotationContainer(e=!1){if(this.state.isSearchingSkypeGraph)return(0,o.jsx)(U.default,{size:m.SXActivityIndicatorSize.Small,tintColor:this.state.primaryColor||H.Color.blue});{let t,s,i;this.state.location&&(t=(0,o.jsxs)(l.View,Object.assign({style:se.annotationPart},{children:[(0,o.jsx)(b.default,{icon:W.SkypeIcon.Location,size:W.IconSize.size15,color:this._themeColors.primaryTextColor}),(0,o.jsx)(X.BodyText,Object.assign({style:se.annotationText,numberOfLines:1,ellipsizeMode:"tail"},{children:this.state.location}))]}))),!r.isUndefined(this.state.numberOfMutualContacts)&&this.state.numberOfMutualContacts>=0&&(s=(0,o.jsxs)(l.View,Object.assign({style:se.annotationPart},{children:[(0,o.jsx)(b.default,{icon:W.SkypeIcon.ContactGroupTwoPersonas,size:W.IconSize.size15,color:this._themeColors.primaryTextColor}),(0,o.jsx)(X.BodyText,Object.assign({style:se.annotationText,numberOfLines:1,ellipsizeMode:"tail"},{children:A.getString("ContactInviteResponder.MutualContactsCount",{count:this.state.numberOfMutualContacts})}))]}))),t&&s&&(i=e?(0,o.jsx)(l.View,{style:se.experimentalInviteAnnotationDivider}):(0,o.jsx)(l.View,{style:[se.divider,this._themeStyles.dividerColorStyle]}));const n=[se.annotationContainer];return e&&(n.push(se.annotationContainerColumn),n.push(se.annotationContainerColumnDesktop)),(0,o.jsxs)(l.View,Object.assign({style:n},{children:[t,i,s]}))}}_renderOptionalButtonsContainer(){if(this.props.isIncomingContactInvitePending&&this.state.inviterMri){const e=A.getString("ContactInviteResponder.DeclineButtonText"),t=A.getString("ContactInviteResponder.AcceptButtonText"),s=Math.abs(e.length-t.length)<=3,i=[se.contactInviteButton];return s&&i.push(se.contactInviteButtonHalfWidth),(0,o.jsxs)(l.View,Object.assign({style:se.buttonContainer},{children:[(0,o.jsx)(j.default,{title:e,style:i,onPress:this._onBlockInviter,buttonStyle:m.SXButtonStyle.ThemeStroke,disabled:this.state.isAcceptingContact},"declineContactInvite"),(0,o.jsx)(j.default,{title:t,style:r.concat(i,se.contactInviteButtonSpacer),onPress:this._onAcceptInvite,showActivityIndicator:this.state.isAcceptingContact},"acceptContactInvite")]}))}}_acceptInvite(){T.log(_.LogTraceArea.Contacts,"ContactInviteHeader._acceptInvite"),this.setState({isAcceptingContact:!0});return(this.state.isOneOnOneConversation?S.default.acceptContactInvite(this.state.inviterMri):S.default.acceptGroupConversationInvite(this.props.conversationId,this.state.inviterMri)).then((()=>{var e,t;this.isComponentMounted()&&(this.setState({isAcceptingContact:!1}),null===(t=(e=this.props).onIncomingContactInviteAccepted)||void 0===t||t.call(e)),T.log(_.LogTraceArea.Contacts,"ContactInviteHeader._acceptInvite: finished successfully")}))}}t.default=ie},296082:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioMessageItem=void 0;const i=s(733754),o=s(624897),n=s(711828);class r extends o.MediaBarItem{constructor(){super(...arguments),this._onPress=e=>{this.props.onPress&&this.props.onPress()}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:n.SkypeIcon.Microphone,title:i.getString("MessageComposer.RecordButtonTitle"),onPress:this._onPress}}}t.AudioMessageItem=r},578723:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BingSearchItem=void 0;const i=s(733754),o=s(624897),n=s(711828),r=s(478262),a=s(581760);class l extends o.default{constructor(){super(...arguments),this._onItemPress=e=>{this.props.onBlur&&this.props.onBlur(),this.props.onCustomAction&&this.props.onCustomAction(r.MediaBarCustomAction.MentionBing)}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:n.SkypeIcon.BingFull,size:this.props.presentedInOverflowMenu?18:void 0,title:i.getString("MediaBar.BingSearchTitle"),onPress:this._onItemPress,iconColor:a.Color.transparent,selectedIconColor:a.Color.transparent,forceIconColor:!0}}}t.BingSearchItem=l},148649:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CameraItem=void 0;const i=s(47447),o=s(711930),n=s(211375),r=s(733754),a=s(624897),l=s(711828),d=s(478262);class c extends a.default{constructor(){super(...arguments),this._onItemPress=e=>{i.UICapabilities.cameraSupported()&&(this.props.onBlur&&this.props.onBlur(),this.props.onCustomAction&&(o.default.registerMobileFocusHandler(n.FocusEvent.CloseMobileModal,(()=>this.isComponentMounted()?this:void 0)),this.props.onCustomAction(d.MediaBarCustomAction.LaunchCamera)))}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:l.SkypeIcon.Camera,title:r.getString("MediaBar.CameraButtonTitle"),onPress:this._onItemPress}}}t.CameraItem=c},208223:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContactPickerItem=void 0;const i=s(746096),o=s(281020),n=s(436237),r=s(733754),a=s(624897),l=s(104735),d=s(711828),c=s(853374);class h extends a.default{constructor(){super(...arguments),this._onPress=e=>{const t=c.default.newCauseId();n.log(i.LogTraceArea.Navigation,"ContactPickerItem._onPress causeId: "+t),l.default.navigateToShareContactsToConversationPanel({panelTitle:r.getString("DetailsPanelHeader.ShareContactToConversationTitle"),causeId:t,entryPoint:o.ShareContactOrigin.MessageComposer,conversationId:this.props.conversationId,onShareComplete:this._onShareComplete},this._getRootViewId())}}isNavigatingAwayOnPress(){return!0}getVirtualKeyboard(e){}getIconMetadata(){return{icon:d.SkypeIcon.ContactCard,title:r.getString("MediaBar.ContactPickerTitle"),onPress:this._onPress}}}t.ContactPickerItem=h},330757:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmoticonPickerItem=void 0;const i=s(785893),o=s(496486),n=s(709133),r=s(632949),a=s(733754),l=s(80372),d=s(624897),c=s(63584),h=s(711828);class u extends d.MediaBarItemVirtualWidthKeyboard{constructor(){super(...arguments),this._onKeyboardButtonClick=e=>{n.default.showNativeKeyboard(),this.props.onFocus&&this.props.onFocus()},this._onPesPickerButtonClick=e=>{this.props.onBlur&&this.props.onBlur()}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.active!==this.props.active&&(this.props.active?c.EmoticonPickerTelemetry.open():c.EmoticonPickerTelemetry.closed())}_showSystemKeyboardIcon(){return!1}getId(){return this._showSystemKeyboardIcon()?l.SystemKeyboardId:this.props.id}getAccessibilityLabel(){return a.getString("MediaBar.EmoticonPicker")}getVirtualKeyboard(e){return u.getVirtualKeyboard(e,this._useDarkTheme())}getIcon(){if(this.props.isMobileInterface||this.props.canRender)return super.getIcon()}getIconMetadata(){return this._showSystemKeyboardIcon()?{icon:h.SkypeIcon.AddText,title:a.getString("MediaBar.SystemKeyboard"),iconColor:this._themeColors.primaryIconColor,onPress:this._onKeyboardButtonClick}:{icon:h.SkypeIcon.EmoticonStroke,title:a.getString("MediaBar.EmoticonPickerTitle"),onPress:this._onPesPickerButtonClick}}static getVirtualKeyboard(e,t){return(0,i.jsx)(r.default,{ref:e.onKeyboardItemRef,onPesDeleteButtonPress:e.onEmoticonBackspacePress,renderMobileInterface:!!e.isMobileInterface,darkTheme:t,onPesSelected:e.onEmoticonSelected||o.noop,availableWidth:e.availableWidth||0,conversationId:e.conversationId,showCategorySwitcher:e.showCategorySwitcher,onMessageSent:e.onMessageSent,onCloseSearch:e.onCloseSearch,preventAutoFocusOnCategory:e.preventAutoFocusOnCategory,clearEditInChatsComposer:e.clearEditInChatsComposer,onCustomAction:e.onCustomAction,pesPickerPopupRef:e.pesPickerPopupRef})}}t.EmoticonPickerItem=u},301014:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExpressionPickerItem=void 0;const i=s(709133),o=s(516778),n=s(915877),r=s(733754),a=s(80372),l=s(624897),d=s(540897),c=s(63584),h=s(758962),u=s(711828),p=s(710400),g=s(843368),m=(0,n.lazyProperties)({desktopUnifiedExpressionPickerActiveIcon:()=>o.Styles.createButtonStyle({justifyContent:"flex-start",paddingTop:14,paddingHorizontal:10}),desktopUnifiedExpressionPickerActiveIconOverride:()=>o.Styles.createButtonStyle({paddingHorizontal:11,paddingTop:10,minHeight:40})});class S extends l.default{constructor(){super(...arguments),this._onKeyboardButtonClick=()=>{var e,t;i.default.showNativeKeyboard(),null===(t=(e=this.props).onFocus)||void 0===t||t.call(e)},this._onPesPickerButtonClick=()=>{var e,t;null===(t=(e=this.props).onBlur)||void 0===t||t.call(e),this.state.isDesktopUnifiedExpressionPickerActive&&g.default.close(this._getRootViewId())}}_buildState(e){return{isDesktopUnifiedExpressionPickerActive:!e.isMobileInterface&&e.active,keyboardSeen:p.default.isKeyboardSeen()}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.active!==this.props.active&&(this.props.active?(c.EmoticonPickerTelemetry.startOpenScenario(),c.EmoticonPickerTelemetry.open(),d.default.activatePicker(h.TabType.Emoticon)):(d.default.deactivatePicker(),c.EmoticonPickerTelemetry.closed(),c.EmoticonPickerTelemetry.finishOpenScenario(),c.MojiPickerTelemetry.closed(),c.StickerPickerTelemetry.closed(),c.GifPickerTelemetry.closed(),this.requestFocus())),this.props.active&&t.keyboardSeen!==this.state.keyboardSeen&&this.state.keyboardSeen&&c.EmoticonPickerTelemetry.markKeyboardSeen()}_showSystemKeyboardIcon(){return!1}getId(){return this._showSystemKeyboardIcon()?a.SystemKeyboardId:this.props.id}getIconStyle(){return this.state.isDesktopUnifiedExpressionPickerActive?[m.desktopUnifiedExpressionPickerActiveIcon,m.desktopUnifiedExpressionPickerActiveIconOverride]:super.getIconStyle()}getIconMetadata(){const e={title:r.getString("MediaBar.ExpressionPickerTitle"),selectedTitle:r.getString("MediaBar.ExpressionPickerSelectedTitle"),scale:this.props.active?1:void 0,onPress:this._showSystemKeyboardIcon()?this._onKeyboardButtonClick:this._onPesPickerButtonClick};return this.state.isDesktopUnifiedExpressionPickerActive?(e.icon=u.SkypeIcon.DownChevron,e.selectedIconColor=this._themeColors.secondaryTextColor,e.showSelectedBackground=!1,e.showActiveIconHoverColor=!0,e.size=u.IconSize.size18):(e.icon=u.SkypeIcon.EmoticonStroke,e.selectedIconColor=this._themeColors.buttonBackgroundColor,e.showSelectedBackground=!0,e.showActiveIconHoverColor=!0,e.size=u.IconSize.size24,e.iconColor=this._themeColors.primaryIconColor,e.iconStyle=this._themeStyles.pillBorderColorStyle),e}}t.ExpressionPickerItem=S},529245:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AcceptedFileTypes=void 0;const i=s(47447),o=s(314920),n=s(711930),r=s(746096),a=s(761317),l=s(753559),d=s(211375),c=s(733754),h=s(624897),u=s(609748),p=s(318743),g=s(206286),m=s(603088),S=s(785207),f=s(415963),y=s(886045),v=s(711828),C=s(360305),_=s(153940),b=s(364956),T=s(491632),M=s(478262),I=s(898278),w=s(615112);var P;!function(e){e[e.MediaOnly=0]="MediaOnly",e[e.All=1]="All"}(P=t.AcceptedFileTypes||(t.AcceptedFileTypes={}));class k extends h.MediaBarItem{constructor(){super(...arguments),this._onIconPress=e=>{const t={capturedContentHandler:new o.CapturedContentHandlerForPosting(this.props.conversationId),conversationId:this.props.conversationId,allowVideo:!0,mediaPickerOnly:!0,mediaPickerShouldCollapseFully:!0,allowMultiple:!0,willDismissOnSend:!0,allowOfficeLens:!0},s=e=>{const t=l.default.extractFileExtension(e.file.name),s=e.thumbnail&&l.default.isVideoExtension(t),i=l.default.isImageExtension(t);if(g.default.isMediaPreviewEnabled(this.props.conversationId))return g.default.addPreviews([e],this.props.conversationId,r.PostSource.MediaPicker),this._onShareComplete();const o=this._getRootViewType();if(s){const t={name:f.ScenarioName.SendVideo};S.default.postVideoWithThumbnail([this.props.conversationId],e,r.PostSource.MediaPicker,!1,t,void 0,void 0,void 0,o).then(this._onFileSent)}else if(i){const t={name:f.ScenarioName.SendPicture};S.default.postUpload([this.props.conversationId],e,r.PostSource.MediaPicker,!1,{scenarioInfo:t},o).then(this._onFileSent)}else{const t={name:f.ScenarioName.SendFile};S.default.postUpload([this.props.conversationId],e,this.props.acceptedFileTypes===P.MediaOnly?r.PostSource.MediaPicker:r.PostSource.FilePicker,!1,{scenarioInfo:t},o).then(this._onFileSent)}this.props.onFocus&&this.props.onFocus(),this.props.onActive&&this.props.onActive(""),this.props.announceForAccessibilityForMessageSent&&this.props.announceForAccessibilityForMessageSent()};i.UICapabilities.desktopFilePickerSupported()?a.FilePickerUtils.isDocumentPickerSupported()?(this.props.onBlur&&this.props.onBlur(),a.FilePickerUtils.showDocumentPicker(s,this._getRootViewId())):a.FilePickerUtils.showMultiFilesPicker(s,this.props.acceptedFileTypes===P.MediaOnly?p.FilePickerOrigin.MediaPickerItem:p.FilePickerOrigin.FilePickerItem,void 0,this._getRootViewId(),e,m.default.getPreviews(this.props.conversationId).length):C.default.isTabletUINoSubscription()&&(this.props.onBlur&&this.props.onBlur(),n.default.registerMobileFocusHandler(d.FocusEvent.CloseMobileModal,(()=>this.isComponentMounted()?this:void 0)),this._launchOfficeLensInGalleryMode(t.capturedContentHandler))},this._onFileSent=()=>{this._announceForAccessibility(c.getString("MessageComposer.FileSentLabel")),this._onShareComplete()}}getId(){return this.props.acceptedFileTypes===P.MediaOnly?u.MediaBarItemKeys.MediaPicker:u.MediaBarItemKeys.FilePicker}getIconMetadata(){let e,t;return e=this.props.acceptedFileTypes===P.MediaOnly?v.SkypeIcon.Picture:v.SkypeIcon.Media,this.props.acceptedFileTypes===P.MediaOnly?(this.props.active,t=c.getString("MediaBar.MediaPickerTitle")):(this.props.active,t=c.getString("MediaBar.FilePickerTitle")),{icon:e,title:t,onPress:this._onIconPress}}isNavigatingAwayOnPress(){return!!this.props.presentedInOverflowMenu||!0}_launchOfficeLensInGalleryMode(e){(0,_.checkCameraRollPermissions)().then((()=>{const t=(0,_.getCaptureFor)(_.CaptureScenario.Messaging);null==t||t.startInPickerMode(e).then((s=>t.handleCapturedContent(e,s))).then((()=>{t.trackCaptureSuccess(w.CaptureProviderScenarioTelemetry.Picker),this._announceForAccessibility(c.getString("MessageComposer.FileSentLabel"))}))})).catch((()=>{T.Instrumentation.log(r.LogTraceArea.FilePicker,"File Picker: required camera permissions not granted"),b.default.showDeniedPromptWithSettingsOption(M.PermissionType.CameraRoll,I.MainRootViewId)}))}_announceForAccessibility(e){this.props.announceForAccessibilityForMessageSent||y.default.maybeAnnounceForAccessibility(e)}componentWillUnmount(){super.componentWillUnmount(),a.FilePickerUtils.cleanUp(this._getRootViewId())}}t.default=k},130387:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GifPickerItem=void 0;const i=s(785893),o=s(496486),n=s(601720),r=s(733754),a=s(624897),l=s(63584),d=s(711828);class c extends a.MediaBarItemVirtualWidthKeyboard{constructor(){super(...arguments),this._onPesPickerButtonClick=e=>{this.props.onBlur&&this.props.onBlur()}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.active!==this.props.active&&(this.props.active?l.GifPickerTelemetry.open():l.GifPickerTelemetry.closed())}getAccessibilityLabel(){return r.getString("MediaBar.GifPicker")}getId(){return this.props.id}getVirtualKeyboard(e){return c.getVirtualKeyboard(e,this._useDarkTheme())}getIconMetadata(){const e=this.props.active?r.getString("MediaBar.GifPickerActiveTitle"):r.getString("MediaBar.GifPickerTitle");return{icon:d.SkypeIcon.Moji,title:e,onPress:this._onPesPickerButtonClick}}static getVirtualKeyboard(e,t){return(0,i.jsx)(n.default,{ref:e.onKeyboardItemRef,renderMobileInterface:!!e.isMobileInterface,darkTheme:t,onPesSelected:e.onGifSelected||o.noop,availableWidth:e.availableWidth||0,conversationId:e.conversationId,showCategorySwitcher:e.showCategorySwitcher,preventAutoFocusOnCategory:e.preventAutoFocusOnCategory,onCustomAction:e.onCustomAction})}}t.GifPickerItem=c},88824:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(570570),n=(s(711930),s(316760)),r=s(746096),a=(s(211375),s(733754)),l=s(46634),d=s(624897),c=s(238915),h=s(104735),u=s(711828);class p extends d.default{constructor(){super(...arguments),this._onLocationItemPress=e=>{this.props.origin===c.MediaBarItemOrigin.MessageOverflow&&(l.default.bingLocationConsentAndPermissionGranted()?(l.default.updateLocation(r.LocationUpdateReason.LocationPicker,!0),h.default.navigateToLocationPicker(this.props.conversationId,this._getContext())):o.default.displayModal(this._getRootViewId(),{onSureButtonClick:()=>{l.default.updateLocation(r.LocationUpdateReason.LocationPicker,!0),super._renderPopup()},onModalClosed:()=>this.requestFocus()}))}}isNavigatingAwayOnPress(){return this.props.origin===c.MediaBarItemOrigin.MessageOverflow}getVirtualKeyboard(e){return(0,i.jsx)(n.default,{conversationId:e.conversationId,displayInPopUp:!0})}getAccessibilityLabel(){return a.getString("MediaBar.LocationTitle")}_renderPopup(){return l.default.bingLocationConsentAndPermissionGranted()?(l.default.updateLocation(r.LocationUpdateReason.LocationPicker,!0),h.default.navigateToLocationPicker(this.props.conversationId,this._getContext()),!0):(o.default.displayModal(this._getRootViewId(),{onSureButtonClick:()=>{l.default.updateLocation(r.LocationUpdateReason.LocationPicker,!0),h.default.navigateToLocationPicker(this.props.conversationId,this._getContext())},onModalClosed:()=>this.requestFocus()}),!0)}getIconMetadata(){return{icon:u.SkypeIcon.Location,title:a.getString("MediaBar.LocationPickerTitle"),onPress:this._onLocationItemPress}}}t.default=p},988140:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MagicBotToolboxItem=void 0;const i=s(785893),o=s(667294),n=s(733754),r=s(624897),a=s(711828),l=s(478262),d=s(879015),c=s(491632),h=s(752869);class u extends r.default{constructor(){super(...arguments),this._handleButtonClick=e=>{this.props.onCustomAction&&this.props.onCustomAction(l.MediaBarCustomAction.LaunchBingToolbox)}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:a.SkypeIcon.Sparkle,title:n.getString("MediaBar.MagicBotToolboxTitle"),onPress:this._handleButtonClick}}}t.MagicBotToolboxItem=(0,o.forwardRef)(((e,t)=>{const{openMagicBotToolbox:s}=(0,d.useMagicBotToolbox)({target:"binggroup"}),n=(0,o.useCallback)(((t,i)=>{var o;null===(o=e.onCustomAction)||void 0===o||o.call(e,t,i),t===l.MediaBarCustomAction.LaunchBingToolbox&&(s(),c.Instrumentation.track(new h.MagicBotToolboxOpen(h.MagicBotToolboxOrigin.MediaBarGroup)))}),[s,e]);return(0,i.jsx)(u,Object.assign({},e,{onCustomAction:n,ref:t}))}))},45532:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MojiPickerItem=void 0;const i=s(785893),o=s(496486),n=s(733754),r=s(624897),a=s(901117),l=s(63584),d=s(711828);class c extends r.MediaBarItemVirtualWidthKeyboard{constructor(){super(...arguments),this._onPesPickerButtonClick=e=>{this.props.onBlur&&this.props.onBlur()}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.active!==this.props.active&&(this.props.active?l.MojiPickerTelemetry.open():l.MojiPickerTelemetry.closed())}getAccessibilityLabel(){return n.getString("MediaBar.MojiPicker")}getId(){return this.props.id}getVirtualKeyboard(e){return c.getVirtualKeyboard(e,this._useDarkTheme())}getIconMetadata(){const e=this.props.active?n.getString("MediaBar.MojiPickerActiveTitle"):n.getString("MediaBar.MojiPickerTitle");return{icon:d.SkypeIcon.Moji,title:e,onPress:this._onPesPickerButtonClick}}static getVirtualKeyboard(e,t){return(0,i.jsx)(a.default,{ref:e.onKeyboardItemRef,renderMobileInterface:!!e.isMobileInterface,darkTheme:t,onPesSelected:e.onMojiSelected||o.noop,availableWidth:e.availableWidth||0,conversationId:e.conversationId,showCategorySwitcher:e.showCategorySwitcher,preventAutoFocusOnCategory:e.preventAutoFocusOnCategory,onCustomAction:e.onCustomAction})}}t.MojiPickerItem=c},339159:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PeopleItem=void 0;const i=s(671830),o=s(731761),n=s(746096),r=s(733754),a=s(624897),l=s(795691),d=s(210541),c=s(711828);class h extends a.MediaBarItemVirtualWidthKeyboard{constructor(){super(...arguments),this._onPress=e=>{if(this.props.otherPartyMri){new o.default({peopleType:d.PeopleType.All,filterPeopleType:d.FilterType.GroupCapable,navigationOrigin:n.NavigationConversationOrigin.MediaBar,invitedUsersMris:[this.props.otherPartyMri],wizardSteps:[l.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}else if(this.props.conversationId){new o.default({convId:i.asSkypeThreadIdMaybe(this.props.conversationId),navigationOrigin:n.NavigationConversationOrigin.MediaBar,peopleType:d.PeopleType.All,filterPeopleType:d.FilterType.GroupCapable,wizardSteps:[l.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}}}getIconMetadata(){return{icon:c.SkypeIcon.ContactAdd,title:r.getString("MediaBar.PeopleTitle"),onPress:this._onPress}}isNavigatingAwayOnPress(){return!!this.props.presentedInOverflowMenu}getVirtualKeyboard(e){}}t.PeopleItem=h},699070:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PollItem=void 0;const i=s(436237),o=s(733754),n=s(624897),r=s(262393),a=s(371926),l=s(711828);class d extends n.default{constructor(){super(...arguments),this._onButtonClick=e=>{i.track(new a.PollLaunchedEvent(a.LaunchOrigin.MediaBarItem)),r.default.NavigationActions.navigateToPollCreationPanel({conversationId:this.props.conversationId},this._getRootViewId())}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:l.SkypeIcon.Poll,title:o.getString("MediaBar.PollTitle"),onPress:this._onButtonClick}}}t.PollItem=d},938185:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RichtextEditorItem=void 0;const i=s(911009),o=s(733754),n=s(624897),r=s(711828),a=s(781571);class l extends n.default{constructor(){super(...arguments),this._onRichtextPickerButtonClick=()=>{a.default.setVisibility(this.props.conversationId,!this.state.isOpened)}}_buildState(e){return{isOpened:a.default.panelOpened(e.conversationId)}}getIconMetadata(){const e={title:o.getString("MediaBar.RichtextEditorPickerTitle"),selectedTitle:o.getString("MediaBar.RichtextEditorPickerCloseTitle"),coachMarkType:i.CoachMarkType.RichtextEditor,onPress:this._onRichtextPickerButtonClick,size:r.IconSize.size18,showActiveIconHoverColor:!0};return e.icon=this.state.isOpened?r.SkypeIcon.DownChevron:r.SkypeIcon.Format,e}}t.RichtextEditorItem=l},720360:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScheduleCallItem=void 0;const i=s(733754),o=s(624897),n=s(34273),r=s(279829),a=s(711828);class l extends o.default{constructor(){super(...arguments),this._onButtonClick=e=>{n.default.NavigationActions.navigateToScheduleCallCreationPanel({conversationId:this.props.conversationId,entryPoint:r.ScheduleCallEntryPoint.MediaBar},this._getRootViewId())}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:a.SkypeIcon.Schedule,title:i.getString("MediaBar.ScheduleCallTitle"),onPress:this._onButtonClick}}}t.ScheduleCallItem=l},537589:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SendCreditItem=void 0;const i=s(496486),o=s(671830),n=s(436237),r=s(733754),a=s(746096),l=s(624897),d=s(104735),c=s(423175),h=s(914976),u=s(4455),p=s(711828);class g extends l.default{constructor(){super(...arguments),this._onPress=()=>{const e=o.getSkypeIdFromMri(this.props.conversationId);i.isUndefined(e)?n.error(a.LogTraceArea.Navigation,"Conversation is not eligible for sending Skype Credit. Conversation ID: "+h.mriOrId(this.props.conversationId)):(u.default.resetValuesNoTrigger(),u.default.setBeneficiary(e),d.default.navigateToSendCreditPanel(this._getRootViewId()),n.track(new c.SendCreditEvent(c.SendCreditStep.ChatClick)))}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:p.SkypeIcon.SkypeCredit,title:r.getString("MediaBar.SendCreditTitle"),onPress:this._onPress}}}t.SendCreditItem=g},9613:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(217093),o=s(104735),n=s(733754),r=s(711828),a=s(624897);class l extends a.MediaBarItem{constructor(){super(...arguments),this._handleVideoMessageItemPress=e=>{o.default.navigateToSkypeClipsRecorder(i.SkypeClipsRecordScenario.chat,this.props.conversationId)}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:r.SkypeIcon.MeetNow,title:n.getString("MediaBar.SkypeClipsRecordTitle"),onPress:this._handleVideoMessageItemPress}}}t.default=l},563080:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SmsItem=void 0;const i=s(733754),o=s(624897),n=s(711828);class r extends o.default{getIconMetadata(){return{icon:n.SkypeIcon.MobileSmsNew,title:i.getString("SMSMessaging.SendSmsButtonTitle")}}}t.SmsItem=r},795960:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StickerPickerItem=void 0;const i=s(785893),o=s(496486),n=s(733754),r=s(624897),a=s(63584),l=s(63110),d=s(711828);class c extends r.MediaBarItemVirtualWidthKeyboard{constructor(){super(...arguments),this._onPesPickerButtonClick=e=>{this.props.onBlur&&this.props.onBlur()}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.active!==this.props.active&&(this.props.active?a.StickerPickerTelemetry.open():a.StickerPickerTelemetry.closed())}getId(){return this.props.id}getVirtualKeyboard(e){return c.getVirtualKeyboard(e,this._useDarkTheme())}getIconMetadata(){const e=this.props.active?n.getString("MediaBar.StickerPickerActiveTitle"):n.getString("MediaBar.StickerPickerTitle");return{icon:d.SkypeIcon.Sticker,title:e,onPress:this._onPesPickerButtonClick}}static getVirtualKeyboard(e,t){return(0,i.jsx)(l.default,{ref:e.onKeyboardItemRef,renderMobileInterface:!!e.isMobileInterface,darkTheme:t,onPesSelected:e.onStickerSelected||o.noop,availableWidth:e.availableWidth||0,conversationId:e.conversationId,showCategorySwitcher:e.showCategorySwitcher,preventAutoFocusOnCategory:e.preventAutoFocusOnCategory,onCustomAction:e.onCustomAction})}}t.StickerPickerItem=c},56503:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(823113),o=s(889391),n=s(994224),r=s(746096),a=s(436237),l=s(733754),d=s(624897),c=s(104735),h=s(581736),u=s(711828),p=s(478262);class g extends d.MediaBarItem{constructor(){super(...arguments),this._onVideMessageItemPress=e=>{o.default.isDesktopVIMEnabled()?(n.default.AugmentedPermissionsPromptHelper.subscribeToAugmentedPermissionEvents(),h.default.requestPermission(p.PermissionType.MicrophoneAndCamera,p.PermissionPromptOptions.SkipPrePrompt,i.PermissionOrigin.VideoMessageItem).then((e=>{a.log(r.LogTraceArea.Navigation,"VideoMessageItem browser permissionStatus:",i.PermissionStatus[e]),e===i.PermissionStatus.Granted&&c.default.navigateToDesktopCaptureComboModal(this.props.conversationId,this._onShareComplete,this._getContext()),n.default.AugmentedPermissionsPromptHelper.unsubscribeFromAugmentedPermissionEvents()}))):a.log(r.LogTraceArea.Navigation,"Unexpected code path location selector only works with desktop/electron")}}isNavigatingAwayOnPress(){return!0}getIconMetadata(){return{icon:o.default.getS4LMessagingFeaturesNoSubscription().useNewVideoMessageIcon?u.SkypeIcon.MessageVideo:u.SkypeIcon.Videomail,title:l.getString("MediaBar.VideoMessageTitle"),onPress:this._onVideMessageItemPress}}}t.default=g},122763:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardHost=void 0;const i=s(785893),o=s(216934),n=s(516778),r=s(217041),a=s(710400);class l extends r.ComponentBase{constructor(e){super(e)}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),a.default.setResizeMode(o.KeyboardAwareResizeMode.Default)}shouldComponentUpdate(e){return!1}componentWillUnmount(){super.componentWillUnmount(),a.default.setResizeMode(o.KeyboardAwareResizeMode.Default)}render(){return(0,i.jsx)(n.View,{children:this.props.children})}}t.KeyboardHost=l},80372:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaBar=t.SystemKeyboardId=void 0;const i=s(785893),o=s(496486),n=s(709133),r=s(516778),a=s(437490),l=(s(122763),s(915877)),d=s(238915),c=s(706250),h=s(29130),u=s(478262),p=s(680837),g=s(360305),m=s(24576),S=s(73877),f="VirtualKeyboard",y=(0,l.lazyProperties)({container:()=>r.Styles.createViewStyle({flexDirection:"column",overflow:"visible"}),listIconsContainer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",overflow:"visible",height:50}),listIconsContainerVerticalAlignment:()=>p.default.alignItemsCenter,virtualKeyboardStyle:()=>r.Styles.createViewStyle({height:0,overflow:"hidden"}),nonVirtualKeyboardStyle:()=>r.Styles.createViewStyle({height:216,overflow:"hidden"})});function v(e){return e!==t.SystemKeyboardId&&""!==e}t.SystemKeyboardId="SystemKeyboard";class C extends m.default{constructor(){super(...arguments),this._keyboardRefsMap=new c.default,this._iconRefsMap=new c.default,this._itemRefsMap=new c.default,this._onSelectedCallback=e=>{this.props.onItemSelected&&this.props.onItemSelected(e)},this._onHandleCustomAction=(e,t)=>{switch(e){case u.MediaBarCustomAction.LaunchKeyboard:const s=this.getItemById(t.id);s?s.selectItem():this.props.onCustomAction&&this.props.onCustomAction(e,t);break;case u.MediaBarCustomAction.CloseKeyboard:this.props.onBlur();break;default:this.props.onCustomAction&&this.props.onCustomAction(e,t)}}}_buildState(e,t){const s={};t&&(s.keyboardSerial=++C._keyboardSerial);const i=this.props;(t||e.activeId!==i.activeId)&&(""===e.activeId||e.activeId);const o=this._getRootViewId(),n=h.default.getWidth(o);return s.availableWidth=g.default.isTablet()?S.default.measureScreen(this._getRootViewId()).width:n,s}_getHeight(){return v(this.props.activeId)&&this.props.customKeyboardHeight>10?this.props.customKeyboardHeight:0}_showCustomKeyboard(e){return o.defer((()=>{e?(this.props.onFocus&&this.props.onFocus(),e.show(),this.props.focusCustomKeyboardWhenShown&&this._focusKeyboard()):(this.props.onCustomKeyboardClose&&this.props.onCustomKeyboardClose(),n.default.dismiss())}))}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),n.default.isSupported()&&this.props.activeId!==e.activeId){const e=this._keyboardRefsMap.ref(this._getLocalKeyboardId(this.props.activeId)+f);this._showCustomKeyboard(e)}}_focusKeyboard(){const e=this._itemRefsMap.ref(this.props.activeId);e&&e.requestFocus()}componentDidMount(){if(super.componentDidMount(),this.props.autoFocusFirstItem&&this.props.itemDescriptors.length>0){let e=0;for(;e<this.props.itemDescriptors.length;){const t=this.getItemById(this.props.itemDescriptors[e].id);if(t&&t.requestFocus())break;e++}}this._keyboardDismissRegistrationHandle=a.register(this)}componentWillUnmount(){super.componentWillUnmount(),n.default.isSupported()&&n.default.dismiss(),a.unregister(this._keyboardDismissRegistrationHandle)}_getLocalKeyboardId(e){return`${e}-${this.state.keyboardSerial}`}getItemById(e){return this._iconRefsMap.ref(e)}render(){const e={};let t;if(this.props.showIcons){const s=o.map(this.props.itemDescriptors,((t,s)=>{const i=this._getMediaBarItemProps(t,s,this.props.itemDescriptors.length),n=o.extend({},i,t.propOverrides),r=t.render(n),a=t.getVirtualKeyboard&&t.getVirtualKeyboard(n,this._useDarkTheme());return a&&(e[this._getLocalKeyboardId(t.id)]={keyboard:a,height:t.keyboardHeight}),r})),n=this.props.preventAccessibilityFocus?r.Types.ImportantForAccessibility.NoHideDescendants:void 0,a=[y.listIconsContainer,y.listIconsContainerVerticalAlignment];t=(0,i.jsx)(r.View,Object.assign({style:a,importantForAccessibility:n},{children:s}),"mediabar")}else o.each(this.props.itemDescriptors,((t,s)=>{const i=this._getMediaBarItemProps(t,s,this.props.itemDescriptors.length),n=o.extend({},i,t.propOverrides),r=t.getVirtualKeyboard&&t.getVirtualKeyboard(n,this._useDarkTheme());r&&(e[this._getLocalKeyboardId(t.id)]={keyboard:r,height:t.keyboardHeight})}));const s=[];if(this.props.isMobileInterface)if(n.default.isSupported())o.each(e,((e,t)=>{const o=t+f,r=e.keyboard;s.push((0,i.jsx)(n.default,Object.assign({ref:this._keyboardRefsMap.onComponentRef(o),virtualKeyboardKey:o,retainOnDismiss:!1,style:y.virtualKeyboardStyle,height:e.height},{children:r}),o))}));else if(v(this.props.activeId)){const{keyboard:t}=e[this._getLocalKeyboardId(this.props.activeId)];t&&s.push((0,i.jsx)(r.View,Object.assign({style:y.nonVirtualKeyboardStyle},{children:t}),f))}let a;return a=s,(0,i.jsxs)(r.View,Object.assign({style:y.container},{children:[t,a]}))}dismissKeyboard(){this._isComponentVisible()&&n.default.dismiss()}_getMediaBarItemProps(e,t,s){let i=this.props.colorOverride;return i||(i=this._themeColors.secondaryTextColor),{id:e.id,key:e.id,ref:this._iconRefsMap.onComponentRef(e.id),onKeyboardItemRef:this._itemRefsMap.onComponentRef(e.id),listIndex:t,numberItems:s,onActive:this._onSelectedCallback,isMobileInterface:this.props.isMobileInterface,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,active:this.props.activeId===e.id,onFocus:this.props.onFocus,onBlur:this.props.onBlur,onInputChange:this.props.onInputChange,availableWidth:this.state.availableWidth,onEmoticonBackspacePress:this.props.onBackspace,onCustomAction:this._onHandleCustomAction,onMessageSent:this.props.onMessageSent,onCloseSearch:this.props.onCloseSearch,colorOverride:i,hoverColorOverride:this._themeColors.primaryTextColor,clearEditInChatsComposer:this.props.clearEditInChatsComposer,disabled:this.props.disableActionOnMediaBar||e.disabled,announceForAccessibilityForMessageSent:this.props.announceForAccessibilityForMessageSent,origin:d.MediaBarItemOrigin.MessageComposer}}}C._nonVirtualKeyboardHeight=216,C._keyboardSerial=0,t.MediaBar=C},624897:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaBarItemVirtualWidthKeyboard=t.MediaBarItem=void 0;const i=s(785893),o=s(496486),n=s(709133),r=s(967593),a=s(516778),l=s(297775),d=s(911009),c=s(147204),h=s(746096),u=s(913944),p=s(436237),g=s(915877),m=s(318743),S=s(89808),f=s(104735),y=s(833348),v=s(581760),C=s(711828),_=s(79669),b=s(24576),T=s(853374),M="mediaBarPopup",I=(0,g.lazyProperties)({iconMobileVerticalPadding:()=>a.Styles.createButtonStyle({marginTop:8,paddingBottom:8,paddingLeft:12,paddingRight:12}),iconMobileHorizontalPaddingFirst:()=>a.Styles.createButtonStyle({paddingLeft:4}),iconMobileHorizontalPaddingLast:()=>a.Styles.createButtonStyle({paddingRight:4}),iconDesktop:()=>a.Styles.createButtonStyle({padding:8}),selectedIcon:()=>a.Styles.createViewStyle({height:C.IconSize.size20,width:C.IconSize.size20,borderRadius:C.IconSize.size20/2}),selectedIconContainer:()=>a.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,alignItems:"center",justifyContent:"center"}),selectionIndicator:()=>a.Styles.createViewStyle({position:"absolute",left:2,right:2,bottom:0,height:2}),selectedIconWithBackgroundContainer:()=>a.Styles.createViewStyle({justifyContent:"center"}),buttonWithBackground:()=>a.Styles.createViewStyle({borderRadius:20,width:40,height:40,marginLeft:4,marginRight:4})});class w extends b.default{constructor(){super(...arguments),this._customOnPress=e=>{if(p.log(h.LogTraceArea.MediaBarItem,"onPress callback"),y.default.isAnimationPending())return void p.log(h.LogTraceArea.MediaBarItem,"returning because of PendingAnimationStore.isAnimationPending() == true");const t=this.getIconMetadata();if(this.isNavigatingAwayOnPress())p.log(h.LogTraceArea.MediaBarItem,"this.isNavigatingAwayOnPress() == true"),o.isUndefined(t.onPress)||(p.log(h.LogTraceArea.MediaBarItem,"calling metadata.onPress"),t.onPress(e));else{if(this._renderPopup()&&this.props.onActive){const e=this.getId();p.log(h.LogTraceArea.MediaBarItem,"calling this.props.onActive with id "+e),this.props.onActive(e)}o.isUndefined(t.onPress)||(p.log(h.LogTraceArea.MediaBarItem,"calling metadata.onPress"),t.onPress(e)),n.default.isSupported()&&!this.hasVirtualKeyboard()&&(p.log(h.LogTraceArea.MediaBarItem,"dismissing keyboard"),n.default.dismiss())}p.track(new m.MediaBarItemPressed(this.getId(),this.props.active,this.props.conversationId,this.props.origin)),e&&e.stopPropagation()},this._onIconRefChanged=e=>{this._iconButton=e||void 0},this._getIconRef=()=>this._iconButton,this._onShareComplete=()=>{if(this._getContext().isPresentedInDesktopRightNav){const e=T.default.newCauseId();p.log(h.LogTraceArea.MediaBarItem,"_onShareComplete, causeId: "+e),f.default.maybeCloseRightPanel(e,this._getContext())}}}static dismissPopup(e){c.default.dismissPopup(M,e)}hasVirtualKeyboard(){return!1}isNavigatingAwayOnPress(){return!1}getVirtualKeyboard(e){return w.getVirtualKeyboard(e,this._useDarkTheme())}static getVirtualKeyboard(e,t){}getId(){return this.props.id}componentDidMount(){super.componentDidMount()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s)}selectItem(){this._customOnPress()}requestFocus(){return!(!this._iconButton||!this._iconButton.requestFocus)&&(this._iconButton.requestFocus(),!0)}getAccessibilityLabel(){}getIconStyle(){let e=[I.iconDesktop];return this.props.isMobileInterface&&(e=[I.iconMobileVerticalPadding],0===this.props.listIndex&&e.push(I.iconMobileHorizontalPaddingFirst),this.props.listIndex===(this.props.numberItems?this.props.numberItems-1:0)&&e.push(I.iconMobileHorizontalPaddingLast)),e}getIcon(){const e=this.getIconMetadata(),t=[this.props.iconStyleOverride||e.iconStyle||this.getIconStyle()];let s=this.props.colorOverride||e.iconColor||this._themeColors.primaryIconColor||v.Color.transparent;e.forceIconColor&&(s=e.iconColor||this.props.colorOverride||this._themeColors.primaryIconColor||v.Color.transparent);let o,n=this.props.active&&!e.showActiveIconHoverColor?s:this.props.hoverColorOverride||this._themeColors.iconHoverColor||s;this.props.presentedInOverflowMenu||(t.push(this._themeStyles.buttonBackgroundColorStyle),t.push(I.buttonWithBackground),o=this._themeStyles.buttonBackgroundHoverColorStyle,s=e.forceIconColor&&e.iconColor?e.iconColor:this._themeColors.primaryIconColor,n=this._themeColors.iconHoverColor),this.props.active;const c=e.size||C.IconSize.size20,h=this.props.active&&!this.props.isMobileInterface&&this._useAccessibleTheme()?(0,i.jsx)(a.View,{style:[I.selectionIndicator,this._themeStyles.primaryViewColorStyle]}):void 0;let p,g=e.title;this.props.active&&e.selectedTitle&&(g=e.selectedTitle);const m={key:this.props.id,icon:e.icon||C.SkypeIcon.Blank,size:c,color:s,title:g,hoverColor:n,style:t,hoverStyle:o,onPress:this._customOnPress,disabled:this.props.disabled,accessoryView:h,importantForAccessibility:this.props.preventAccessibilityFocus?a.Types.ImportantForAccessibility.NoHideDescendants:void 0,tabIndex:this.props.preventAccessibilityFocus?-1:void 0};if(p=e.coachMarkType?(0,i.jsx)(l.default.IconButton,Object.assign({anchorRef:this._onIconRefChanged,anchorAccessibilityLabel:g,coachMarkType:e.coachMarkType,onAnchorPress:this._customOnPress,positions:[d.PopupAnchorPositon.Top]},m)):(0,i.jsx)(u.default,Object.assign({ref:this._onIconRefChanged},m)),this.props.active&&e.showSelectedBackground){const s=e.selectedIconSize?a.Styles.createViewStyle({width:e.selectedIconSize,height:e.selectedIconSize,borderRadius:e.selectedIconSize/2},!1):I.selectedIcon;let o;o=this._useAccessibleTheme()?(0,i.jsx)(a.View,{style:[s,this._themeStyles.primaryViewColorStyle]}):(0,i.jsx)(r.GradientView,{style:s,colors:S.default.getGradientColorsNoSubscription(),direction:r.GradientDirection.BOTTOM_RIGHT});const n=[I.selectedIconWithBackgroundContainer];return e.scale&&n.push({transform:[{scale:e.scale}]}),(0,i.jsxs)(a.View,Object.assign({style:n},{children:[(0,i.jsx)(a.View,Object.assign({style:I.selectedIconContainer},{children:(0,i.jsx)(a.Animated.View,Object.assign({style:t},{children:o}))})),p]}))}return p}render(){return this.getIcon()||null}_renderPopup(){if(this._shouldRenderPopup()){const e=this.getVirtualKeyboard(this.props);if(e){const t={getAnchor:()=>this._iconButton,renderPopup:(t,s,o,n)=>(0,i.jsx)(_.default,Object.assign({anchorPosition:t,anchorOffset:s,popupWidth:o,popupHeight:n,contentStretchAcrossWidth:!0,fillColor:this._themeColors.primaryBackgroundColor,strokeColor:this._useDarkTheme()?this._themeColors.dividerColor:void 0,skipPopupAutoFocus:!0,popupAccessibilityTitle:this.getAccessibilityLabel()},{children:e})),positionPriorities:["top","bottom"],onDismiss:()=>{this.isComponentMounted()&&(this.props.onActive&&this.props.onActive(void 0),this.requestFocus())},dismissIfShown:!0,rootViewId:this._getRootViewId()};return c.default.showPopup(t,M)}}return!0}_shouldRenderPopup(){return!this.props.isMobileInterface}}t.MediaBarItem=w;t.MediaBarItemVirtualWidthKeyboard=class extends w{hasVirtualKeyboard(){return!0}},t.default=w},519243:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(18369),r=s(685609),a=s(552115),l=s(753559),d=s(913944),c=s(110117),h=s(915877),u=s(733754),p=s(581760),g=s(311010),m=s(711828),S=s(478262),f=s(680837),y=s(619675),v=s(24576),C=135,_=p.Color.white,b=(0,h.lazyProperties)({previewInfoWithThumbnail:()=>o.Styles.createViewStyle({width:C}),fileSizeCaption:()=>o.Styles.createTextStyle({marginBottom:2}),itemContainer:()=>o.Styles.createViewStyle({height:C,width:C,borderRadius:6,padding:10,justifyContent:"flex-end",marginRight:10,marginBottom:10}),noPadding:()=>o.Styles.createViewStyle({padding:0}),removeIconWrapper:()=>o.Styles.createViewStyle({position:"absolute",top:0,right:0,marginTop:6,marginRight:18,backgroundColor:p.Color.blackOverlay35,borderRadius:m.IconSize.size18/2,borderStyle:"solid",borderWidth:1,borderColor:_,alignItems:"center",justifyContent:"center",width:m.IconSize.size18,height:m.IconSize.size18}),cardTitle:()=>o.Styles.createTextStyle({width:120,height:38,marginBottom:8,marginTop:14,justifyContent:"flex-start",fontSize:g.default.controlFontSize.body}),playButtonWrapperBg:()=>o.Styles.createViewStyle({backgroundColor:p.Color.blackOverlay20,alignItems:"center",justifyContent:"center"}),playButtonWrapper:()=>o.Styles.createViewStyle({backgroundColor:p.Color.blackOverlay10,borderRadius:m.IconSize.size60/2,borderStyle:"solid",borderWidth:2,borderColor:p.Color.white,alignItems:"center",justifyContent:"center",width:m.IconSize.size60,height:m.IconSize.size60}),fileContainer:()=>o.Styles.createViewStyle({flexDirection:"column",alignContent:"flex-end"})});class T extends v.default{constructor(){super(...arguments),this._onItemPress=e=>{e.stopPropagation(),this.props.onItemPress(this.props.preview)},this._onItemRemoved=e=>{e.stopPropagation(),this.props.onItemRemoved&&this.props.onItemRemoved(this.state.uid)},this._onPreviewItemRef=e=>{this._previewItemRef=e}}_buildState(e,t){const{data:s,uid:i,thumbnailUrl:o}=e.preview;return{uid:i,fileData:s,fileType:l.default.getFileType(s.extension),fileName:l.default.extractFileNameForKnownFileTypes(s.file.name),thumbnailUrl:o}}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.isNavigatingWithKeyboard&&!this.props.isNavigatingWithKeyboard&&this._previewItemRef.requestFocus()}render(){let e,t;const s=b.previewInfoWithThumbnail;let n=!0,l="";switch(this.state.fileType){case S.UploadFileType.Video:t=this._renderPlayVideoIcon(),e=this.state.thumbnailUrl?this._renderThumbnailsPreview(this.state.thumbnailUrl):void 0,l=u.getString("VideoNode.OpenVideoTitle")+this.state.fileData.file.name;break;case S.UploadFileType.Picture:e=this.state.thumbnailUrl?this._renderThumbnailsPreview(this.state.thumbnailUrl):void 0,l=u.getString("FileTransfer.ImageOpenWithFileName",{fileName:this.state.fileData.file.name});break;default:l=this.state.fileData.file.name;const d=this.state.fileData.file.size?a.default.formatFileSize(this.state.fileData.file.size,2).formattedString:void 0;n=!1;const h=(0,i.jsx)(y.Caption,Object.assign({numberOfLines:1,ellipsizeMode:"tail",style:b.fileSizeCaption},{children:d})),p=r.FileIconHelper.getIconFromFileType(this.state.fileName,this.state.fileType),f=(0,i.jsx)(c.default,{icon:p.icon,size:s?g.default.controlFontSize.panelHeaderLarge:m.IconSize.size24,color:this._themeColors.secondaryTextColor,style:s});e=(0,i.jsxs)(o.View,Object.assign({style:b.fileContainer},{children:[f,(0,i.jsx)(y.CardTitle,Object.assign({numberOfLines:1,ellipsizeMode:"tail",style:b.cardTitle},{children:this.state.fileName})),h]}))}const h=[b.itemContainer,this._themeStyles.primaryBackgroundColorStyle,this.props.previewMode?f.default.defaultCursor:f.default.pointerCursor];n&&h.push(b.noPadding);const p=this.props.previewMode?void 0:(0,i.jsx)(o.View,Object.assign({style:b.removeIconWrapper},{children:(0,i.jsx)(d.default,{icon:m.SkypeIcon.ClosePanel,color:_,hoverColor:_,size:m.IconSize.size12,onPress:this._onItemRemoved,title:u.getString("MediaPreview.RemoveItem",{fileName:this.state.fileData.file.name})},"remove"+this.state.uid)}));return(0,i.jsxs)(o.View,{children:[(0,i.jsxs)(o.Button,Object.assign({ref:this._onPreviewItemRef,style:h,onPress:n&&!this.props.previewMode?this._onItemPress:void 0,importantForAccessibility:n?void 0:o.Types.ImportantForAccessibility.NoHideDescendants,accessibilityLabel:l,accessibilityTraits:o.Types.AccessibilityTrait.Button,tabIndex:n?0:-1},{children:[e,t]}),this.state.uid),p]})}_renderPlayVideoIcon(){return(0,i.jsx)(o.View,Object.assign({style:[f.default.absoluteFill,b.playButtonWrapperBg]},{children:(0,i.jsx)(o.View,Object.assign({style:b.playButtonWrapper},{children:(0,i.jsx)(c.default,{icon:m.SkypeIcon.Play,size:m.IconSize.size24,color:p.Color.white})}))}))}_renderThumbnailsPreview(e){return(0,i.jsx)(n.ImagePreview,{imagePreviewHeight:C,imagePreviewWidth:C,urlThumbnail:e,borderRadius:6})}}t.default=T},264862:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(889391),a=s(47447),l=s(314920),d=s(614980),c=s(711930),h=s(746096),u=s(935933),p=s(761317),g=s(753559),m=s(211375),S=s(110117),f=s(648638),y=s(915877),v=s(733754),C=s(318743),_=s(519243),b=s(206286),T=s(603088),M=s(945983),I=s(268080),w=s(822669),P=s(581760),k=s(711828),A=s(680837),x=s(360305),R=s(24576),O=s(418037),L=s(379467),F=(0,y.lazyProperties)({mediaPreviewItems:()=>n.Styles.createViewStyle({flexDirection:"row",flex:1,flexWrap:"wrap",overflow:"visible"}),mediaPreview:()=>n.Styles.createViewStyle({flex:1,paddingLeft:10,paddingRight:10,paddingTop:10}),plusContainer:()=>n.Styles.createViewStyle({height:135,width:60,borderRadius:6,justifyContent:"center",alignItems:"center"})});class B extends R.default{constructor(){super(...arguments),this._createGalleryPreviews=e=>o.reduce(e,((e,t)=>{const{thumbnailUrl:s,videoThumbnailUrl:i,data:o,uid:n}=t,r=g.default.isVideoExtension(o.extension);if(g.default.isImageExtension(o.extension)){const t={id:n,mediaType:w.PictureViewer.MediaType,thumbnailUrl:s,displayResolutionUrl:s,fullResolutionUrl:s};e.push(t)}else if(r&&i){const t={id:n,mediaType:L.VideoViewer.MediaType,thumbnailUrl:s,videoUrl:i,resumeVideo:!0,loop:!1,useGlobalMute:!0};e.push(t)}return e}),[]),this._showGallery=e=>{const t=o.find(this.state.galleryPreviews,(t=>t.id===e.uid));t&&this._showMediaViewer(t)},this._showMediaViewer=e=>{T.default.increaseOpenGalleryCount(this.props.conversationId),I.default.showWithConfig({initialMedia:e,totalMedia:this.state.galleryPreviews.length,rootViewId:this._getRootViewId(),controller:{getOptions:this._getControllerOptions,getNextMedia:this._getControllerNextMedia,getPreviousMedia:this._getControllerPreviousMedia}})},this._getControllerOptions=()=>({dismissAnimationType:M.DismissAnimationType.Vertical,animateOpenClose:!0}),this._getControllerNextMedia=e=>{const t=o.findIndex(this.state.galleryPreviews,(t=>t.id===e.id));return-1===t||t+1>=this.state.galleryPreviews.length?void 0:this.state.galleryPreviews[t+1]},this._getControllerPreviousMedia=e=>{const t=o.findIndex(this.state.galleryPreviews,(t=>t.id===e.id));return t<=0?void 0:this.state.galleryPreviews[t-1]},this._renderPreview=(e,t)=>(0,i.jsx)(_.default,{preview:e,index:t,onItemPress:this._showGallery,onItemRemoved:this._onRemoveItem,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard},"key"+e.uid),this._onRemoveItem=e=>{T.default.removePreview(this.props.conversationId,e)},this._shouldRenderComponent=()=>!o.isEmpty(this.state.previews)&&this.state.isMediaPreviewEnabled,this._onAddMoreIconPress=e=>{const t={capturedContentHandler:new l.CapturedContentHandlerForPosting(this.props.conversationId),conversationId:this.props.conversationId,allowVideo:!0,mediaPickerOnly:!0,mediaPickerShouldCollapseFully:!0,allowMultiple:!0,willDismissOnSend:!0},s=e=>{if(b.default.isMediaPreviewEnabled(this.props.conversationId))return b.default.addPreviews([e],this.props.conversationId,h.PostSource.MediaPreview)};a.UICapabilities.desktopFilePickerSupported()?p.FilePickerUtils.isDocumentPickerSupported()?p.FilePickerUtils.showDocumentPicker(s,this._getRootViewId(),this.state.previews.length):p.FilePickerUtils.showMultiFilesPicker(s,C.FilePickerOrigin.MediaPreview,void 0,this._getRootViewId(),e,this.state.previews.length):x.default.isTabletUINoSubscription()&&(c.default.registerMobileFocusHandler(m.FocusEvent.CloseMobileModal,(()=>this.isComponentMounted()?this._iconButton:void 0)),d.navigateToCaptureComboModalWithParams(t,this._getContext()))},this._onIconRef=e=>{this._iconButton=e||void 0},this._getIconRef=()=>this._iconButton,this._onLayoutChange=e=>{if(!this.isComponentMounted())return;e.x,e.y,e.width;const t=e.height;t>this.state.previewHeight?this.setState({previewHeight:189}):t<this.state.previewHeight&&this.setState({previewHeight:156})},this._showFileLimitAlert=()=>{u.show(this._getRootViewId())}}_buildState(e,t){const s=T.default.getPreviews(e.conversationId);return{previews:s,galleryPreviews:this._createGalleryPreviews(s),isMediaPreviewEnabled:b.default.isMediaPreviewEnabled(e.conversationId),previewHeight:156,usesDarkTheme:O.default.isDarkTheme(),isNavigatingWithKeyboard:f.default.isNavigatingWithKeyboard(),fileLimit:r.default.getS4LMessagingFeatures().limitForFilePicker}}componentDidMount(){super.componentDidMount(),this._previewLimitSubscription=T.default.previewLimitExceeded.subscribe(this._showFileLimitAlert)}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),t.previews.length<this.state.previews.length){const e=this.state.previews.length-t.previews.length||0,s=v.getString("MediaPreview.AddedItem",{count:e});n.Accessibility.announceForAccessibility(s)}}componentWillUnmount(){super.componentWillUnmount(),this._previewLimitSubscription&&(this._previewLimitSubscription.unsubscribe(),this._previewLimitSubscription=void 0)}_renderAddMoreButton(){const e=n.Styles.createViewStyle({backgroundColor:this.state.usesDarkTheme?P.Color.whiteOverlay20:this._themeColors.secondaryTextColor},!1);return(0,i.jsx)(n.Button,Object.assign({style:[F.plusContainer,e],onPress:this._onAddMoreIconPress,ref:this._onIconRef,title:v.getString("MediaPreview.AttachMoreFilesButton")},{children:(0,i.jsx)(S.default,{icon:k.SkypeIcon.Plus,size:k.IconSize.size24,color:P.Color.white})}))}UNSAFE_componentWillReceiveProps(e,t){this.props.conversationId!==e.conversationId&&(r.default.getS4LMessagingFeaturesNoSubscription().enableMediaPreviewDrafts?T.default.markSavedAsDraft(this.props.conversationId):T.default.destroy(this.props.conversationId,!0)),super.UNSAFE_componentWillReceiveProps(e,t)}render(){if(!this._shouldRenderComponent())return null;const e=this.state.previews.length<this.state.fileLimit?this._renderAddMoreButton():void 0,t=n.Styles.createScrollViewStyle({height:this.state.previewHeight},!1),s=n.Styles.createViewStyle({borderBottomWidth:1,borderColor:this._themeColors.secondaryTextColor,borderStyle:"solid"},!1);return(0,i.jsx)(n.View,Object.assign({style:[F.mediaPreview,t]},{children:(0,i.jsx)(n.View,Object.assign({style:[s,A.default.flexOne]},{children:(0,i.jsx)(n.ScrollView,Object.assign({style:A.default.flexOne},{children:(0,i.jsxs)(n.View,Object.assign({style:F.mediaPreviewItems,onLayout:this._onLayoutChange},{children:[this.state.previews.map(this._renderPreview),e]}))}))}))}))}}t.default=B},854757:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(809206),n=s(397691),r=s(746096),a=s(211375),l=s(436237),d=s(8145),c=s(771540),h=s(964642),u=s(24576),p=[a.FocusEvent.CloseRightPanel,a.FocusEvent.RefreshConversation,a.FocusEvent.DeclineCallFromCallBanner,a.FocusEvent.ClosePurchaseDialog,a.FocusEvent.VideoMessageClosed,a.FocusEvent.CloseUnansweredCallPanel],g=(a.FocusEvent.CloseRightPanel,a.FocusEvent.CloseUnansweredCallPanel,a.FocusEvent.CloseMobileSearchInConversation,o.BrowserEnvironment.isAndroid());class m extends u.default{constructor(){super(...arguments),this.handleFocusEvent=e=>(l.log(r.LogTraceArea.GenericUnsafe,"MessageComposer.handleFocusEvent"),!(!p.includes(e)||!this._child)&&(e===a.FocusEvent.VideoMessageClosed?this._child.focusVideoButton():this._child.requestFocus(),!0)),this._onChildRef=e=>{this._child=e||void 0}}_buildState(e,t){const s={isDesktopComposer:!0};return l.log(r.LogTraceArea.MessageComposer,"MessageComposer version: "+(s.isDesktopComposer?"DesktopComposerWithPopup":"V2")),s}componentDidMount(){super.componentDidMount(),a.register(p,this)}componentWillUnmount(){super.componentWillUnmount(),a.unregister(p,this)}blur(){this._child&&this._child.blur()}blurIfFocused(){this._child&&this._child.blurIfFocused()}requestFocus(){this._child&&this._child.requestFocus()}focusVideoButton(){this._child&&this._child.focusVideoButton&&this._child.focusVideoButton()}focusSendButton(){this._child&&this._child.focusSendButton&&this._child.focusSendButton()}focusOverflowButton(){this._child&&this._child.focusOverflowButton&&this._child.focusOverflowButton()}isFocused(){return!!this._child&&this._child.isFocused()}setTextInputAccessibilityFocus(){this._child&&this._child.setTextInputAccessibilityFocus()}getInputEntities(){return this._child?this._child.getInputEntities():n.Resolved([])}autoReplaceText(e,t,s){this._child&&this._child.autoReplaceText(e,t,s)}insertSearchResult(e,t,s){this._child&&this._child.insertSearchResult(e,t,s)}replaceText(e,t,s,i){this._child&&this._child.replaceText(e,t,s,i)}abortTextAutoCompletion(){this._child&&this._child.abortTextAutoCompletion()}getOverflowConfig(){return this._child?this._child.getOverflowConfig():void 0}onDragDropText(e){var t,s;null===(s=null===(t=this._child)||void 0===t?void 0:t.onDragDropText)||void 0===s||s.call(t,e)}render(){return g?(0,i.jsx)(h.default,Object.assign({ref:this._onChildRef},this.props)):this.state.isDesktopComposer?(0,i.jsx)(c.default,Object.assign({ref:this._onChildRef},this.props)):(0,i.jsx)(d.default,Object.assign({ref:this._onChildRef},this.props))}}t.default=m},964642:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(785893),n=s(516778),r=s(496486),a=s(809206),l=s(274840),d=s(709133),c=s(54569),h=s(397691),u=s(4736),p=s(889391),g=s(180843),m=s(968894),S=s(296082),f=s(739119),y=s(578723),v=s(94655),C=s(16625),_=s(148649),b=s(47447),T=s(905531),M=s(951267),I=s(871908),w=s(351077),P=s(671830),k=s(496418),A=s(898278),x=s(154549),R=s(208223),O=s(881632),L=s(417677),F=s(820770),B=s(539549),D=s(986374),E=s(884817),V=s(843368),N=s(110547),U=s(437490),j=s(952262),H=s(330757),z=s(82433),W=s(770891),G=s(904604),K=s(746096),q=s(301014),Q=s(529245),X=s(761317),$=s(753559),J=s(480469),Y=s(913944),Z=s(766649),ee=s(497174),te=s(923944),se=s(436237),ie=s(861253),oe=s(172490),ne=s(547126),re=s(915877),ae=s(733754),le=s(88824),de=s(80372),ce=s(624897),he=s(238915),ue=s(609748),pe=s(318743),ge=s(264862),me=s(206286),Se=s(603088),fe=s(947193),ye=s(961428),ve=s(723752),Ce=s(422929),_e=s(371639),be=s(106658),Te=s(540897),Me=s(844972),Ie=s(45532),we=s(89808),Pe=s(178735),ke=s(104735),Ae=s(833348),xe=s(339159),Re=s(879348),Oe=s(63584),Le=s(699070),Fe=s(785207),Be=s(29130),De=s(857946),Ee=s(415963),Ve=s(720360),Ne=s(886045),Ue=s(537589),je=s(615301),He=s(149769),ze=s(807914),We=s(563080),Ge=s(450795),Ke=s(581760),qe=s(640363),Qe=s(311010),Xe=s(711828),$e=s(478262),Je=s(680837),Ye=s(626712),Ze=s(273096),et=s(172758),tt=s(853374),st=s(56503),it=s(846116),ot=s(752869),nt=s(69576),rt=s(534256),at=s(559669),lt=s(768696),dt=s(422801),ct=s(61375),ht=s(372210),ut=s(939848),pt=s(558387),gt=s(988140),mt=/^[,.;:?!'].*/;var St;!function(e){e[e.OverflowButton=0]="OverflowButton",e[e.OverflowButtonCoachMark=1]="OverflowButtonCoachMark"}(St||(St={}));const ft=(0,re.lazyProperties)({composerArea:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row"}),compositionAreaContainer:()=>n.Styles.createViewStyle({position:"absolute",flexDirection:"row",left:0,right:0,bottom:0}),compositionArea:()=>n.Styles.createViewStyle({paddingLeft:8,flex:1,justifyContent:"center"}),inputArea:()=>n.Styles.createViewStyle({flexDirection:"row"}),expandableArea:()=>n.Styles.createViewStyle({flex:1,maxHeight:96,backgroundColor:Ke.Color.transparent}),expandableAreaWithQuote:()=>n.Styles.createViewStyle({flex:1,maxHeight:48}),composerInner:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginVertical:12,marginHorizontal:16}),rightControlContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),multiQuoteArea:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginTop:15,marginBottom:0,marginLeft:20,marginRight:20}),multiQuoteAreaMessages:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",maxHeight:126,paddingBottom:15,borderBottomWidth:1,borderStyle:"solid"}),multiQuoteAreaMessage:()=>n.Styles.createViewStyle({marginBottom:12}),multiQuoteAreaLastMessage:()=>n.Styles.createViewStyle({marginBottom:0}),multiQuoteAreaClearButton:()=>n.Styles.createButtonStyle({alignSelf:"flex-start"}),quoteTextStyle:()=>n.Styles.createTextStyle({fontStyle:"italic"}),quoteAttributeStyle:()=>n.Styles.createTextStyle({fontSize:Qe.default.controlFontSize.messageStreamQuoteAttributeDesktop,marginTop:0,marginBottom:0}),sendButton:()=>n.Styles.createViewStyle({height:50}),actionButtonWithBackground:()=>n.Styles.createViewStyle({height:40,width:40,borderRadius:20}),actionButtonVerticalCenter:()=>n.Styles.createViewStyle({alignSelf:"center"}),textInputFocusButton:()=>n.Styles.createButtonStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:Ke.Color.transparent}),linkStyle:()=>n.Styles.createTextStyle({fontSize:Qe.default.controlFontSize.body,lineHeight:18,color:Ke.Color.gray400,fontFamily:Qe.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),emoteAuthor:()=>(0,re.lazyProperties)({text:()=>n.Styles.createTextStyle({fontSize:Qe.default.controlFontSize.messageComposerDesktop,marginTop:7,fontStyle:"italic"}),textDesktop:()=>n.Styles.createTextStyle({marginTop:5,marginBottom:3})}),desktopOverrides:()=>(0,re.lazyProperties)({messageComposer:()=>n.Styles.createViewStyle({minHeight:48,justifyContent:"center"}),messageComposerAllRoundCorners:()=>n.Styles.createViewStyle({borderRadius:24}),messageComposerTopFlatCorners:()=>n.Styles.createViewStyle({borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:24,borderBottomRightRadius:24}),compositionAreaContainer:()=>n.Styles.createViewStyle({flexDirection:"column"}),compositionArea:()=>n.Styles.createViewStyle({paddingLeft:12,paddingRight:12}),expandableArea:()=>n.Styles.createViewStyle({maxHeight:175}),expandableAreaWithQuote:()=>n.Styles.createViewStyle({maxHeight:133}),expandableAreaSmallView:()=>n.Styles.createViewStyle({maxHeight:133}),expandableAreaWithQuoteSmallView:()=>n.Styles.createViewStyle({maxHeight:91}),composerInner:()=>n.Styles.createViewStyle({marginVertical:5,marginLeft:2,marginRight:12}),rightControlContainer:()=>n.Styles.createViewStyle({minHeight:48,marginLeft:4,alignItems:"flex-end"}),composerInnerIconWrapper:()=>n.Styles.createViewStyle({alignSelf:"flex-end",height:40,justifyContent:"center"})}),mediaBarWrapper:()=>n.Styles.createViewStyle({flexDirection:"row",height:50,alignItems:"center"}),mirrorText:()=>n.Styles.createTextStyle({color:Ke.Color.transparent}),sharedInputAndMirror:()=>n.Styles.createTextInputStyle({paddingVertical:0,paddingHorizontal:0,margin:0,fontSize:Qe.default.controlFontSize.messageComposerDesktop,font:Qe.default.font.uiDisplayRegular,wordBreak:"break-word",backgroundColor:Ke.Color.transparent,minHeight:22}),textInputContainer:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,flexDirection:"row"}),textInput:()=>n.Styles.createTextInputStyle({flex:1,flexDirection:"row"}),entityText:()=>n.Styles.createTextStyle({flexDirection:"row",alignSelf:"center"}),atMentionText:()=>n.Styles.createTextStyle({borderRadius:4,backgroundColor:Ke.Color.blueOverlay10}),atMentionTextDark:()=>n.Styles.createTextStyle({borderRadius:4,backgroundColor:Ke.Color.blueOverlay30})});let yt=45;class vt extends pt.MessageComposerBase{constructor(){super(...arguments),this._isPostingMessage=!1,this._isComposing=!1,this._inputAreaText="",this._currentSelectionStart=0,this._currentSelectionEnd=0,this._inputTextBeforeInsertion="",this._gotInitialInputAreaHeight=!1,this._inputAreaHeight=yt,this._inputAreaTargetHeight=this._inputAreaHeight,this._inputAreaHeightValue=new n.Animated.Value(this._inputAreaHeight),this._inputAreaHeightStyle=n.Styles.createAnimatedViewStyle({height:this._inputAreaHeightValue}),this._onEmoticonSelected=e=>{this.autoReplaceText(e.text(),"Emoticon",e)},this._onMojiSelected=e=>{this.props.conversationId&&(Fe.default.postMessageFromInput(this.props.conversationId,K.PostSource.MediaPicker,[e],w.MessageTypes.Media_FlikMsg,{name:Ee.ScenarioName.SendMoji},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onStickerSelected=e=>{this.props.conversationId&&(Fe.default.postMessageFromInput(this.props.conversationId,K.PostSource.MediaPicker,[e],w.MessageTypes.RichText,{name:Ee.ScenarioName.SendSticker},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onGifSelected=e=>{this.props.conversationId&&(Fe.default.postMessageFromInput(this.props.conversationId,K.PostSource.MediaPicker,[e],w.MessageTypes.RichText,{name:Ee.ScenarioName.SendGif},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._closePesPickerAndFocusTextInput=()=>{this._closeUnifiedPesPickerDesktop(),this.setTextInputAccessibilityFocus()},this._onSMSInfoLineRef=e=>{this._smsInfoLineRef=e||void 0},this._onClearQuoteButtonPress=()=>{this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0)},this._onPhoneNumberForSmsSelected=e=>{const t=tt.default.newCauseId();se.log(K.LogTraceArea.MessageComposer,"MessageComposer._onPhoneNumberForSmsSelected causeId: "+t),this.state.twoWaySMSCapable?e&&ke.default.navigateToConversation({convId:P.getMriFromPhoneNumber(e),origin:K.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t}):ke.default.navigateToConversation({convId:this.props.conversationId,origin:K.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t})},this._debounceNewTextBeforeInsertionChanged=r.debounce(((e,t)=>{if(this.isComponentMounted()&&this.props.onInputTextChanged){const s=!(r.isEmpty(t)||r.last(t)instanceof ee.UnhandledEntity);this._inputTextBeforeInsertion!==e&&(this._inputTextBeforeInsertion=e,this.props.onInputTextChanged(e,s))}}),100),this._stopComposingDebounced=r.debounce(this._stopComposing,5e3),this._startComposingThrottled=r.throttle((()=>{this._isComposing=!0,Ze.default.setComposingState(!0,this.props.conversationId)}),1e4,{leading:!0}),this._onScroll=(e,t)=>{this.isComponentMounted()&&this.setState({offsetTop:t})},this._onSelectionChanged=(e,t)=>{if(this._textInputRef&&(this._currentSelectionStart=e,this._currentSelectionEnd=t,e===t)){const t=this._inputAreaText.substring(0,e);this._debounceNewTextBeforeInsertionChanged(t,this.state.inputEntities)}},this._onKeyPress=e=>{if(this.props.onKeyPress&&this.props.onKeyPress(e))return e.stopPropagation(),void e.preventDefault();if(e.keyCode!==ne.default.ENTER&&r.defer((()=>{const e=this._textInputRef;if(e){const t=e.getSelectionRange(),s=t.start===t.end?this._inputAreaText.substring(0,t.start):"";this._debounceNewTextBeforeInsertionChanged(s,this.state.inputEntities)}})),e.keyCode===ne.default.ENTER)this._handleEnterCombinations(e);else if(e.keyCode===ne.default.UP&&0===this.state.inputEntities.length)this.props.onEditLastMessage&&(se.log(K.LogTraceArea.MessageComposer,"onEditLastMessage"),this.props.onEditLastMessage()),e.stopPropagation(),e.preventDefault();else if(e.keyCode===ne.default.ESCAPE){if(this.state.selectedMediaBarItem===ue.MediaBarItemKeys.Emoticon||this.state.isShowingUnifiedPesPickerDesktop)return;this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.props.editedMessage&&this.props.onClearEdit&&this._clearTextInput()}else e.keyCode===ne.default.DELETE&&(0===this.state.inputEntities.length||1===this.state.inputEntities.length&&this.state.inputEntities[0]instanceof ee.EmoteEntity)&&(this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit(),F.default.clearMessageInput(this.props.conversationId))},this._onInput=e=>{if(r.defer((()=>{this.isComponentMounted()&&this._afterNextOnInput&&(this._afterNextOnInput(),this._afterNextOnInput=void 0)})),this._inputAreaText===e)return;this._inputAreaText=e;const t=this._textInputRef;if(!t)return;const s=this._updateInputEntities(this.state.inputEntities,e),i=te.getRawText(s.newEntities);if(i!==e||s.insertionAdjustment){const e=t.getSelectionRange().end+s.insertionAdjustment;r.defer((()=>{this.isComponentMounted()&&(t.setValue(i),t.selectRange(e,e))}))}this._debounceNewTextBeforeInsertionChanged(i.substring(0,t.getSelectionRange().end),s.newEntities),this.isComponentMounted()&&this.setState({inputEntities:s.newEntities});0!==e.length&&t.isFocused()?(this._stopComposingDebounced.cancel(),this._startComposingThrottled()):this._stopComposingDebounced()},this._shouldDefaultPaste=e=>!(this.state.pasteAsQuotePreference&&Ce.default.hasContent(e)),this._saveMessage=e=>{if(e&&e.length>0||this._hasQuotes()||this.props.editedMessage){let t,s=De.SavedMessageType.None;this.props.editedMessage?(t=[this.props.editedMessage],s=De.SavedMessageType.Edited):this.props.quotedMessages&&(t=this.props.quotedMessages,s=De.SavedMessageType.Quoted),F.default.saveMessageInput(this.props.conversationId,{messages:t,type:s,inputEntities:e,inputEntitiesDataVersion:this.state.inputEntitiesDataVersion,timestamp:Date.now()})}else F.default.clearMessageInput(this.props.conversationId)},this._onCancelPesSearch=(e,t)=>{e&&F.default.clearMessageInput(this.props.conversationId);const s=F.default.getSavedMessageInput(this.props.conversationId);(!s||s&&r.isEmpty(s.messages))&&(this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit());const i=s?s.inputEntities:[];this._setInputEntityStateDownstream(i,t),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._onClearEditMessageQuote=()=>{this.isComponentMounted()&&this.setState({inputEntities:this.state.inputEntities.slice(1,this.state.inputEntities.length)})},this._renderEmoticonPickerItem=e=>(0,o.jsx)(H.EmoticonPickerItem,Object.assign({},e)),this._renderMojiPickerItem=e=>(0,o.jsx)(Ie.MojiPickerItem,Object.assign({},e)),this._renderSmsItem=e=>(0,o.jsx)(We.SmsItem,Object.assign({},e)),this._renderMediaPickerItem=e=>(0,o.jsx)(Q.default,Object.assign({acceptedFileTypes:Q.AcceptedFileTypes.MediaOnly},e)),this._renderFilePickerItem=e=>(0,o.jsx)(Q.default,Object.assign({acceptedFileTypes:Q.AcceptedFileTypes.All},e)),this._renderCameraItem=e=>(0,o.jsx)(_.CameraItem,Object.assign({},e)),this._renderScheduleCallItem=e=>(0,o.jsx)(Ve.ScheduleCallItem,Object.assign({},e)),this._renderPollItem=e=>(0,o.jsx)(Le.PollItem,Object.assign({},e)),this._renderLocationPickerItem=e=>(0,o.jsx)(le.default,Object.assign({},e)),this._renderContactPickerItem=e=>(0,o.jsx)(R.ContactPickerItem,Object.assign({},e)),this._renderBingSearchItem=e=>(0,o.jsx)(y.BingSearchItem,Object.assign({},e)),this._renderMagicToolboxItem=e=>(0,o.jsx)(gt.MagicBotToolboxItem,Object.assign({},e,{ref:e.ref})),this._renderVideoMessageItem=e=>(0,o.jsx)(st.default,Object.assign({},e)),this._renderPeopleItem=e=>(0,o.jsx)(xe.PeopleItem,Object.assign({},e)),this._renderAudioMessageItem=e=>(0,o.jsx)(S.AudioMessageItem,Object.assign({},e)),this._renderSendCreditItem=e=>(0,o.jsx)(Ue.SendCreditItem,Object.assign({},e)),this._onMediaBarRef=e=>{this._mediaBarRef=e||void 0},this._renderPesPickerPopup=()=>(0,o.jsx)(Re.PesPickerPopup,{ref:this._onPesPickerPopupRef,renderMobileInterface:!1}),this._onPesPickerPopupRef=e=>{this._pesPickerPopup=e||void 0},this._getPesPickerPopupRef=()=>this._pesPickerPopup,this._onCustomKeyboardClose=()=>{this._pesPickerPopup&&this._pesPickerPopup.hide()},this._onLayoutInputArea=e=>{const t=Math.ceil(e.height);this._gotInitialInputAreaHeight?(this._inputAreaTargetHeight=t,this._animateInputAreaToTargetHeight()):(this._inputAreaTargetHeight=t,this._inputAreaHeight=t,this._inputAreaHeightValue.setValue(t),yt=t,this._gotInitialInputAreaHeight=!0)},this._onHandleCustomAction=(e,t)=>{switch(e){case $e.MediaBarCustomAction.LaunchCamera:this.props.onLaunchCamera&&this.props.onLaunchCamera();break;case $e.MediaBarCustomAction.LaunchEmoticon:Oe.EmoticonPickerTelemetry.startOpenScenario(),Oe.EmoticonPickerTelemetry.open(),this._onPickerActive(ue.MediaBarItemKeys.Emoticon);break;case $e.MediaBarCustomAction.LaunchMoji:Oe.MojiPickerTelemetry.open(),this._onPickerActive(ue.MediaBarItemKeys.Moji);break;case $e.MediaBarCustomAction.LaunchSticker:Oe.StickerPickerTelemetry.open(),this._onPickerActive(ue.MediaBarItemKeys.Sticker);break;case $e.MediaBarCustomAction.LaunchGif:Oe.GifPickerTelemetry.open(),this._onPickerActive(ue.MediaBarItemKeys.Gif);break;case $e.MediaBarCustomAction.MentionBing:this._mentionMagicBot();break;default:se.log(K.LogTraceArea.MessageComposer,"_onHandleCustomAction unhandled action: "+e)}},this._mentionMagicBot=()=>{const e=(0,it.getMagicBotId)(),t=j.default.getDisplayableProfile(e),s=t.getShortName(),i=t.getDisplayName();this.replaceText(0,i+" ","@Mention",new ee.AtMentionEntity(i,e,s,i)),se.track(new ot.MagicBotMentionedByClick)},this._onComposerOverflowPress=()=>{se.track(new pe.MediaBarItemPressed(St[St.OverflowButton],!0,this.props.conversationId,he.MediaBarItemOrigin.MessageComposer))},this._onDismissMediaPicker=()=>{d.default.showNativeKeyboard(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onUnifiedPesPickerDesktopPress=()=>{this.state.isShowingUnifiedPesPickerDesktop||(Oe.EmoticonPickerTelemetry.startOpenScenario(),V.default.open(this._getRootViewId()))},this._closeUnifiedPesPickerDesktop=()=>{this.state.isShowingUnifiedPesPickerDesktop&&V.default.close(this._getRootViewId())},this._onPickerActive=e=>{this.isComponentMounted()&&this.setState({selectedMediaBarItem:e})},this._onMediaBarItemSelected=e=>{this.state.selectedMediaBarItem!==e&&(this.isComponentMounted()&&this.setState({selectedMediaBarItem:e===ue.MediaBarItemKeys.Sms?"":e}),this.props.onMediaItemSelected&&this.props.onMediaItemSelected()),e===ue.MediaBarItemKeys.Sms&&(1===this.state.phoneNumbers.length?this._toggleSmsSending(!0,this.state.phoneNumbers[0]):He.default.showNumberSelectionPopup((()=>this._smsInfoLineRef),this._getRootViewId(),this.props.conversationId,this.state.phoneNumbers,!1).then((e=>{this._toggleSmsSending(!0,e)})).catch(r.noop))},this._onCancelEditClick=e=>{e.stopPropagation(),vt._announceForAccessibility(ae.getString("MessageComposer.MessageEditingCanceledLabel")),this._handleAfterPostMessage(this.props.conversationId)},this._onSendButtonClick=e=>{e.stopPropagation(),this._sendMessage()},this._onInputButtonRef=e=>{this._inputButton=e||void 0},this.insertSearchResult=(e,t,s)=>{if(this._announceForAccessibility(e),this._textInputRef){let e=[];const t=F.default.getSavedMessageInput(this.props.conversationId);t&&t.inputEntities&&(e=t.inputEntities),this._appendEntityToList(e,s);const i=te.getRawText(e);this._textInputRef.setValue(i),this._inputAreaText=i,this.isComponentMounted()&&this.setState({inputEntities:e})}Te.default.deactivateInlineSearch()},this.autoReplaceText=(e,t,s)=>{let i=0;const o=this._textInputRef;if(o){const e=o.getSelectionRange();i=e.end-e.start}n.UserInterface.isNavigatingWithKeyboard()&&this.state.selectedMediaBarItem&&ce.MediaBarItem.dismissPopup(this._getRootViewId()),this._announceForAccessibility(e),this.replaceText(i,e,t,s)},this._onPartiallyEnteredMsgStoreUpdated=e=>{if(e===this.props.conversationId){const t=F.default.getSavedMessageInput(e);t&&t.inputEntitiesDataVersion===this.state.inputEntitiesDataVersion&&this._setInputEntityStateUpstream(t.inputEntities)}},this._onCompositionAreaPress=e=>{this.state.hasFocus||this._hasQuotes()||this.requestFocus()},this._onCompositionAreaKeyPress=e=>{e.keyCode===ne.default.ESCAPE&&this.isComponentMounted()&&this._moreButton&&this._moreButton.requestFocus()},this._onFocus=()=>{const e={hasFocus:!0};this.isComponentMounted()&&this.setState(e)},this._onBlur=()=>{const e={hasFocus:!1};this.isComponentMounted()&&this.setState(e),this.props.onBlur&&this.props.onBlur()},this._onPaste=e=>{if(!this._shouldDefaultPaste(e.nativeEvent)&&this.props.onKeyboardPaste)return void this.props.onKeyboardPaste(e);const t=e.nativeEvent;this.props.disableCopyPasteMedia||r.isEmpty((0,J.get)(t,["clipboardData","items"]))||r.some(t.clipboardData.items,(e=>"text/plain"===e.type))||(r.each(t.clipboardData.items,(t=>{if("image/png"===t.type){e.stopPropagation(),e.preventDefault();const s=new FileReader;let i=t.getAsFile();if(i instanceof e.nativeEvent.target.ownerDocument.defaultView.Blob){const e="image_"+(new Date).toISOString().replace(/[:\.\-]/g,"_")+".png",t=r.attempt((t=>new File([t],e,{type:t.type})),i);r.isError(t)||(i=t),s.onload=()=>{if(i&&i.size>0){const e={file:i,extension:$.default.extractFileExtension(i.name)};this._sendFileWithDimensions(e)}},s.readAsDataURL(i)}}})),vt._announceForAccessibility(ae.getString("MessageComposer.FilesSentLabel")))},this._getQuoteEntity=e=>{const t=j.default.getDisplayName(e.creator,!0),s=L.quoteMessage(e,t);return new ee.QuoteEntity(s,t,e,this.props.quotesTriggerType)},this._announceForAccessibilityForMessageSent=()=>{r.defer((()=>{this.isComponentMounted()&&vt._announceForAccessibility(ae.getString("MessageComposer.MessageSentLabel"))}))},this._handleEmoticonBackspacePress=e=>{const t=this._textInputRef;if(t){const s=this._inputAreaText;if(s.length>0){let i="";i=this._currentSelectionStart!==this._currentSelectionEnd?s.substring(0,this._currentSelectionStart)+s.substring(this._currentSelectionEnd,s.length):this._currentSelectionEnd!==s.length?s.substring(0,this._currentSelectionEnd-1)+s.substring(this._currentSelectionEnd,s.length):e?s.substring(0,s.lastIndexOf(" ")):s.substring(0,this._currentSelectionEnd-1);const o=this._updateInputEntities(this.state.inputEntities,i);this._inputAreaText=i,t.setValue(i),this.isComponentMounted()&&this.setState({inputEntities:o.newEntities})}}},this._showFilePicker=(e,t)=>{if(t!==this._getRootViewId())return!1;if(this.state.editable&&b.UICapabilities.desktopFilePickerSupported()&&!P.isPhoneMri(this.props.conversationId)&&!P.isS4BBridgeMri(this.props.conversationId)){const t=e=>{const t=$.default.extractFileExtension(e.file.name),s=this._getRootViewType();if($.default.isVideoExtension(t)){const t={name:Ee.ScenarioName.SendVideo};Fe.default.postVideoWithThumbnail([this.props.conversationId],e,K.PostSource.MediaPicker,!1,t,void 0,void 0,void 0,s).then((()=>{vt._announceForAccessibility(ae.getString("MessageComposer.FileSentLabel"))}))}else if($.default.isImageExtension(t)){const t={name:Ee.ScenarioName.SendPicture};Fe.default.postUpload([this.props.conversationId],e,K.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{vt._announceForAccessibility(ae.getString("MessageComposer.FileSentLabel"))}))}else{const t={name:Ee.ScenarioName.SendFile};Fe.default.postUpload([this.props.conversationId],e,K.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{vt._announceForAccessibility(ae.getString("MessageComposer.FileSentLabel"))}))}this.requestFocus()};X.FilePickerUtils.isDocumentPickerSupported()?X.FilePickerUtils.showDocumentPicker(t,this._getRootViewId()):X.FilePickerUtils.showMultiFilesPicker(t,pe.FilePickerOrigin.MessageComposer,void 0,this._getRootViewId(),e)}return!0},this._editLastMessageKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this._editLastMessage(),!0),this._focusKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this.requestFocus(),!0),this._editLastMessage=()=>{this.props.onEditLastMessage&&this.props.onEditLastMessage()},this._setContent=(e,t)=>{se.log(K.LogTraceArea.MessageComposer,"MessageComposer._setContent"),this._setInputEntityStateDownstream(e,(()=>{t&&this.requestFocus()}))},this.requestFocus=()=>{this._textInputRef&&(a.BrowserEnvironment.isEngineEdgeHTML()&&document.activeElement&&document.activeElement.blur(),this._textInputRef.requestFocus())},this.blur=()=>{this._textInputRef&&this._textInputRef.blur()},this.focusVideoButton=()=>{const e=this._mediaBarRef?this._mediaBarRef.getItemById(ue.MediaBarItemKeys.VideoMessage):void 0;e&&e.requestFocus()},this.focusSendButton=()=>{this._inputButton&&this._inputButton.requestFocus()},this.focusOverflowButton=()=>{},this.setTextInputAccessibilityFocus=()=>{this._textInputRef&&this.props.explicitAccessibilityAnnoucement&&n.Accessibility.announceForAccessibility(this._placeholderText)}}_buildState(e,t){var s;const i=super._buildState(e,t),o=Pe.default.getUserPreferencesLocal(),n=p.default.getS4LMessagingFeatures(),{enableMagicBot:r,enableMagicBotGroupAutoAdd:l,enableMagicBotOneOnOneAutoAdd:d}=n,h=(0,B.default)().getConversation(e.conversationId),u=(0,it.isMagicBotConversation)(e.conversationId),g=(0,it.isMagicBotContainingConversation)(h),m=Object.assign(Object.assign({},i),{enableMagicBot:r,enableMagicBotGroupAutoAdd:l,enableMagicBotOneOnOneAutoAdd:d,isMagicBotConversation:u,isMagicBotContainingConversation:g,conversation:h}),S=this.props,y=this._getRootViewId(),v=p.default.getS4LCommerceFeatures();t&&(m.inputEntities=e.initialInputEntities||[],m.inputEntitiesDataVersion=e.initialInputEntitiesDataVersion||0,m.hasFocus=!1,m.selectedMediaBarItem="",m.offsetTop=0,m.currentNumberOfIconsInMediaBar=this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav?1:3,m.pesPickerKeyboardHeight=276,m.messageComposerPastedContentType=c.PastedTextType.None,e.editedMessage&&(this._inputTextBeforeInsertion=te.getRawText(m.inputEntities),m.rawEditedMessage=this._inputTextBeforeInsertion));const _=P.isOneOnOneConversation(e.conversationId);m.delayedTriggersWaitTime=n.composerAutoCompletionDelay,m.mediaBarMenuOrder=this._mediaBarMenuOrder(!!m.isMagicBotContainingConversation||_,n.enableMagicBotToolboxInBinglessGroups,n.mediaBarMenuOrder),m.isConversationWithPhoneNumber=P.isConversationWithPhoneNumber(e.conversationId),m.enableHandlingHTMLonPaste=n.enableHandlingHTMLonPaste,m.editable=!Ae.default.isAnimationPending()&&!e.disableActionOnMessageComposer,m.isSmallHeightView=Be.default.isSmallDesktopHeightView(y),m.viewportWidth=e.availableWidth||Be.default.getWidth(y),m.showAdditionalMediaBarItems=m.viewportWidth>=360,m.gradientColors=we.default.getGradientColors(),m.emoticons=z.default.getEmoticons(),m.isShowingUnifiedPesPickerDesktop=!e.hideMediaBar&&V.default.shouldShow(y),m.messageStreamFontSize=Pe.default.getMessageStreamFontSize(),m.canUseAddins=T.default.addins().canUseAddins,m.editableEntities=fe.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(m.inputEntities||[],m.emoticons);const{selectedTabType:I,searchQuery:w}=V.default.getPickerSearchProps();m.selectedTabType=I,m.searchQuery=w,m.isEncryptedThreadThread=P.isEncryptedThread(e.conversationId),m.showLocationPicker=!e.hideLocationPickerIcon&&n.enableLocationSharingOnDesktopAndWeb&&!qe.default.isFireOS(),m.showContactPicker=!e.hideContactPickerIcon&&T.default.contacts().canInvitePeople,m.showVideoMessageIcon=!e.hideVideoMessageIcon&&!m.isEncryptedThreadThread&&p.default.isDesktopVIMEnabled()&&(E.default.isAVDeviceReady()||a.BrowserEnvironment.isChrome()),m.phoneNumbers=e.otherPartyMri&&et.default.getFullUserProfileByMri(e.otherPartyMri).phones||[];const k=P.isPhoneMri(e.conversationId);m.isOneOnOneConversation=_,m.creditEntitlement=G.default.getCreditEntitlement(),m.enableOnewaySms=(k||v.smsPromo.unpaidUserEnabled||!!f.getPositiveCreditBalance(m.creditEntitlement)||G.default.userHasSubscriptions())&&(k||_)&&m.phoneNumbers.length>0&&!e.editedMessage&&!e.hideSmsIcon&&!P.isEncryptedThread(e.conversationId),m.quoteTextForSms=this._getQuotedTextForSms(S.quotedMessages,e.quotedMessages),m.disableHighBandwidthOperations=Z.default.isUsingGogoNetwork(),m.isCameraAvailable=b.UICapabilities.cameraSupported()&&M.default.isCameraAvailable(),m.sendMessageWithEnter=o.sendMessageWithEnter,m.pasteAsQuotePreference=o.pasteAsQuotesEnabled,m.twoWaySMSCapable=!!(null===(s=C.default.getCallerIdPrimaryNumber())||void 0===s?void 0:s.smsCapable);let A=e.phoneNumberForSendingSms;if(!A&&P.isPhoneMri(e.conversationId)){const t=P.getPhoneNumberFromMri(e.conversationId);t&&(A={number:t,type:$e.PhoneNumberTypes.Other})}return m.phoneNumberForSendingSms=A,m.isMediaPreviewEnabled=me.default.isMediaPreviewEnabled(e.conversationId),m.hasMediaPreviews=m.isMediaPreviewEnabled&&Se.default.getPreviews(e.conversationId).length>0,m.isSmsFailureScreenEnabled=m.enableOnewaySms&&v.callFailure.smsFailurePrompt.enabled,m.isRegularMemberInModeratedGroup=h&&(0,Me.isRegularMemberInModeratedGroup)(h),m.sendMessageWithEnterEnabled=!!o.sendMessageWithEnter,t&&(je.default.setDefault(),je.default.commitNextFlowId(),this._checkForOutgoingSmsMessagesInConversation(m)),m}componentDidMount(){super.componentDidMount(),n.Modal.isDisplayed()||!this._shouldAutoFocusInput()&&!this.props.shouldAutoFocus||this.props.preventFocusOnMount||this.requestFocus(),this.state.overrideEditable&&this.setState({overrideEditable:void 0});const e=this._getContext().componentVisibilityStatus;e&&(this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{!e&&d.default.isSupported()&&d.default.dismiss()}))),oe.default.addHandler(K.KeyboardShortcut.SendFile,this._showFilePicker),oe.default.addHandler(K.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),oe.default.addHandler(K.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),this._keyboardDismissRegistrationHandle=U.register(this),F.default.onInputEntitiesUpdatedEvent.subscribe(this._onPartiallyEnteredMsgStoreUpdated),this.state.enableMagicBot&&this.state.isMagicBotContainingConversation&&at.default.fetchLocation(),this._contentSetSubscriptionToken=(0,ut.subscribeToContentSetEvent)(this._setContent)}_checkForOutgoingSmsMessagesInConversation(e){e.enableOnewaySms&&I.didUserSendSmsInLast30Days(this.props.conversationId).then((e=>{this.isComponentMounted()&&this.setState({hasOutgoingSmsInConversation:e})}))}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t);let s=!1;const i={};this.props.conversationId&&e.conversationId&&this.props.conversationId===e.conversationId||(s=!0,i.inputEntities=this.props.initialInputEntities||[],i.inputEntitiesDataVersion=this.state.inputEntitiesDataVersion+1,i.hasOutgoingSmsInConversation=!1,i.phoneNumberForSendingSms=void 0,this._checkForOutgoingSmsMessagesInConversation(this.state),this._inputTextBeforeInsertion="");let o=[];if(e.initialInputEntities&&e.initialInputEntities!==this.props.initialInputEntities&&(s=!0,o=e.initialInputEntities),e.editedMessage&&e.editedMessage!==this.props.editedMessage){const t=D.decode(e.editedMessage);o=O.toEntities(t,{supportEmoticons:!0,supportLinkEntity:!0}),s=!0,i.phoneNumberForSendingSms=void 0,this._inputTextBeforeInsertion=te.getRawText(this.state.inputEntities),i.rawEditedMessage=te.getRawText(o)}else e.editedMessage||(i.rawEditedMessage=void 0);this.props.editedMessage&&!e.editedMessage&&(s=!0,i.phoneNumberForSendingSms=void 0,this.state.inputEntities.length&&this.state.inputEntities[0]instanceof ee.EmoteEntity&&(o=[])),s&&(this._setInputEntityStateDownstream(o),this.setState(i))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);let i=this.state.selectedMediaBarItem,o=!1;e&&e.conversationId&&this.props.conversationId&&e.conversationId===this.props.conversationId||(o=this._shouldAutoFocusInput());const n=this._hasQuotes()&&!(0,ie.default)(this.props.quotedMessages,e.quotedMessages),a=this.props.editedMessage&&!(0,ie.default)(this.props.editedMessage,e.editedMessage),l=this.state.hasMediaPreviews&&this.state.hasMediaPreviews!==t.hasMediaPreviews;(0,ie.default)(this.props.quotedMessages,e.quotedMessages)&&(0,ie.default)(this.props.editedMessage,e.editedMessage)&&(0,ie.default)(t.inputEntities,this.state.inputEntities)||this._saveMessage(this.state.inputEntities),o=n||a||l,this._inputAreaText=te.getRawText(this.state.inputEntities),a&&(this._inputAreaText=te.getRawText(this.state.inputEntities)),!e.inlineSearchModeActive&&this.props.inlineSearchModeActive&&(i=""),o&&this.requestFocus(),!t.enableOnewaySms&&this.state.enableOnewaySms&&this._checkForOutgoingSmsMessagesInConversation(this.state),this.state.hasFocus&&!r.isEmpty(this.state.inputEntities)&&k.default.hideCurrentCoachMark(),this.setState({selectedMediaBarItem:i})}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._dataUpdateSubscription&&(this._dataUpdateSubscription.unsubscribe(),this._dataUpdateSubscription=void 0),F.default.commit(this.props.conversationId),p.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&F.default.storeSavedMessage(this.props.conversationId),this._customKeyboardDidHideListener&&(this._customKeyboardDidHideListener.remove(),this._customKeyboardDidHideListener=void 0),this._nativeKeyboardDidHideListener&&(this._nativeKeyboardDidHideListener.remove(),this._nativeKeyboardDidHideListener=void 0),this._customKeyboardSeenListener&&(this._customKeyboardSeenListener.remove(),this._customKeyboardSeenListener=void 0),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),this._contentSetSubscriptionToken&&(this._contentSetSubscriptionToken.unsubscribe(),this._contentSetSubscriptionToken=void 0),this._stopComposing(),d.default.isSupported()&&d.default.dismiss(),oe.default.removeHandler(K.KeyboardShortcut.SendFile,this._showFilePicker),oe.default.removeHandler(K.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),oe.default.removeHandler(K.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),U.unregister(this._keyboardDismissRegistrationHandle),F.default.onInputEntitiesUpdatedEvent.unsubscribe(this._onPartiallyEnteredMsgStoreUpdated),g.default.disableTooltip(m.EngagementTooltipType.ExpressionPicker)}_overflowActions(){return{onItemSelected:this._onMediaBarItemSelected,onCustomAction:this._onHandleCustomAction,mediaBarItems:this._getOverflowItemDescriptors(),onFocus:this.requestFocus,onBlur:this.blur}}render(){return this._renderDesktopComposer()}dismissKeyboard(){}_getQuotedTextForSms(e,t){return t&&e!==t?r.join(t.map((e=>this._getQuoteEntity(e).textForSMS()))):""}_renderQuote(){if(this.props.hideContentInMessageComposer)return;let e,t=this.props.quotedMessages,s=this._onClearQuoteButtonPress;if(r.isEmpty(t)&&this.props.editedMessage){const i=r.first(this.state.inputEntities);i instanceof ee.QuoteEntity&&(t=[this.props.editedMessage],e=te.decodeFromInput([i],!1),s=this._onClearEditMessageQuote)}if(t&&t.length>0){const i=Qe.default.font.uiDisplayBold,r=this.props.showTranslatedMessage||!1,a={linkStyle:this._useDarkTheme()?n.Styles.combine(ft.linkStyle,this._themeStyles.linkTextColorStyle||this._themeStyles.primaryTextColorStyle):ft.linkStyle,disableActions:this.props.disableActionOnMessageComposer,quoteSymbolStyle:{size:Xe.IconSize.size20,color:this._themeColors.primaryTextColor},quotedTextStyle:ft.quoteTextStyle,atMentionStyle:i,atMentionMeOverrideStyle:i,asQuoteInComposer:!0,showTranslatedMessage:r,hasTranslation:r,renderOrigin:W.MessageRenderOrigin.MessageComposerCanvas};if(a.textOverrideStyle=[this._themeStyles.primaryTextColorStyle],a.quoteAttributeStyle=[ft.quoteAttributeStyle,this._themeStyles.secondaryTextColorStyle],this.state.messageStreamFontSize!==be.MessageStreamFontSize.Normal){const e=Qe.default.controlFontSize.messageStreamItemDesktop,t=_e.getStyle(e,this.state.messageStreamFontSize),s=_e.getStyle(Qe.default.controlFontSize.messageStreamQuoteAttributeDesktop,this.state.messageStreamFontSize);a.textOverrideStyle.push(t),a.quoteAttributeStyle.push(s),a.fontSize=_e.getSize(e,this.state.messageStreamFontSize)}const l=t.length-1,d=t.map(((t,s)=>(0,o.jsx)(n.View,Object.assign({style:s===l?ft.multiQuoteAreaLastMessage:ft.multiQuoteAreaMessage},{children:(0,o.jsx)(ve.default,{message:t,preDecodedMessage:e,wrapInQuote:!e,options:a})}),`quote-${s}`)));return{component:(0,o.jsxs)(n.View,Object.assign({style:ft.multiQuoteArea},{children:[(0,o.jsx)(n.View,Object.assign({style:[ft.multiQuoteAreaMessages,this._themeStyles.secondaryDividerBorderStyle]},{children:(0,o.jsx)(n.ScrollView,Object.assign({style:Je.default.flexOne},{children:d}))})),(0,o.jsx)(Y.default,{title:ae.getString("MessageComposer.RemoveQuoteButtonTitle"),style:ft.multiQuoteAreaClearButton,onPress:s,size:Xe.IconSize.size16,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:Xe.SkypeIcon.Cancel,disabled:this.props.disableActionOnMessageComposer},"clearbutton")]})),onClearQuoteHandler:s}}}_renderDesktopComposer(){const e=[ft.composerInner,ft.desktopOverrides.composerInner];let t;t=this.state.isSmallHeightView?this.props.quotedMessages?[ft.expandableAreaWithQuote,ft.desktopOverrides.expandableAreaWithQuoteSmallView]:[ft.expandableArea,ft.desktopOverrides.expandableAreaSmallView]:this.props.quotedMessages?[ft.expandableAreaWithQuote,ft.desktopOverrides.expandableAreaWithQuote]:[ft.expandableArea,ft.desktopOverrides.expandableArea];const s=[Je.default.flexOne,ft.desktopOverrides.messageComposer];this._themeStyles.messageComposerBackgroundStyle&&s.push(this._themeStyles.messageComposerBackgroundStyle),this.state.isShowingUnifiedPesPickerDesktop?s.push(ft.desktopOverrides.messageComposerTopFlatCorners):s.push(ft.desktopOverrides.messageComposerAllRoundCorners);const i=this._renderQuote(),r=this.props.hideContentInMessageComposer?void 0:this._renderTextInput(t,!!i),a=this._getRightIcon()||this._getMediaBar(!0),l=[ft.rightControlContainer,ft.desktopOverrides.rightControlContainer],d=(0,o.jsx)(n.View,Object.assign({style:s,importantForAccessibility:n.Types.ImportantForAccessibility.No,onPress:this._onCompositionAreaPress,onKeyPress:this._onCompositionAreaKeyPress,disableTouchOpacityAnimation:!0},{children:(0,o.jsx)(n.Animated.View,Object.assign({style:this._inputAreaHeightStyle},{children:(0,o.jsxs)(n.View,Object.assign({style:[ft.compositionAreaContainer,ft.desktopOverrides.compositionAreaContainer],onLayout:this._onLayoutInputArea},{children:[i&&i.component,this._getMediaPreviewPanel(),(0,o.jsxs)(n.View,Object.assign({style:e},{children:[this._getEmoticonPickerItem(),(0,o.jsxs)(n.View,Object.assign({style:[ft.compositionArea,ft.desktopOverrides.compositionArea]},{children:[this._renderEmoteAuthor(),r]}))]}))]}),"composition")}))}));return(0,o.jsxs)(n.View,Object.assign({style:ft.composerArea},{children:[(0,o.jsxs)(n.View,Object.assign({style:Je.default.flexOne},{children:[this._renderSmsInfoLine(),this._renderPesPicker(),d]})),(0,o.jsx)(n.View,Object.assign({style:l},{children:a}))]}))}_getRightIcon(){const e=Xe.IconSize.size20;let t;if(this._canCancelEdit(this.state,this.state.rawEditedMessage)){const s=[ft.actionButtonWithBackground,ft.actionButtonVerticalCenter,this._themeStyles.buttonBackgroundColorStyle];return t=this._themeStyles.buttonBackgroundHoverColorStyle,(0,o.jsx)(Y.default,{title:ae.getString("MessageComposer.CancelEditButtonTitle"),ref:this._onInputButtonRef,onPress:this._onCancelEditClick,size:e,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:s,hoverStyle:t,icon:Xe.SkypeIcon.Cancel})}if(this._sendControlEnabled(this.props,this.state,this._hasQuotes())){const t=this.props.disableActionOnMessageComposer||!!this.state.phoneNumberForSendingSms&&r.isEmpty(this.state.inputEntities);return(0,o.jsx)(u.default,{title:ae.getString(this.props.editedMessage?"MessageComposer.EditButtonTitle":"MessageComposer.SendButtonTitle"),ref:this._onInputButtonRef,onPress:this._onSendButtonClick,size:u.ActionButtonSize.Small,iconSize:e,style:ft.sendButton,icon:Xe.SkypeIcon.Send,flipIcon:this._getContext().isRTL,disabled:t})}}_getMediaPreviewPanel(){if(this.state.isMediaPreviewEnabled)return(0,o.jsx)(ge.default,{conversationId:this.props.conversationId})}_renderPesPicker(){if(!this.state.isShowingUnifiedPesPickerDesktop)return;const e=this._isMojiCategoryEnabled();return(0,o.jsxs)(n.View,{children:[(0,o.jsx)(N.default,{showCategorySwitcher:e,availableWidth:this.props.availableWidth,pesPickerPopupRef:this._getPesPickerPopupRef,onEmoticonSelected:this._onEmoticonSelected,onMojiSelected:this._onMojiSelected,onStickerSelected:this._onStickerSelected,onGifSelected:this._onGifSelected,onClose:this._closeUnifiedPesPickerDesktop,selectedTabType:this.state.selectedTabType,searchQuery:this.state.searchQuery}),this._renderPesPickerPopup()]})}_getTextForSms(e){return`${this.state.quoteTextForSms}${te.getRawText(e)}`}_renderSmsInfoLine(){if(this.state.enableOnewaySms)return(0,o.jsx)(ze.default,{rawTextInput:this._getTextForSms(this.state.inputEntities),conversationId:this.props.conversationId,phoneNumbers:this.state.phoneNumbers,onPhoneNumberSelected:this._onPhoneNumberForSmsSelected,selectedPhoneNumber:this.state.phoneNumberForSendingSms,creditEntitlement:this.state.creditEntitlement,ref:this._onSMSInfoLineRef,disabled:this.props.disableActionOnMessageComposer,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isSmsFailureScreenEnabled:this.state.isSmsFailureScreenEnabled})}_isMojiCategoryEnabled(){return!this.props.hideMojiPickerIcon&&!this.state.phoneNumberForSendingSms}_renderEmoteAuthor(){const e=r.head(this.state.inputEntities);if(this.props.editedMessage&&e&&e instanceof ee.EmoteEntity){const t=[ft.emoteAuthor.text];t.push(ft.emoteAuthor.textDesktop),t.push(this._themeStyles.primaryTextColorStyle);const s=e.fallbackText.trim();return(0,o.jsx)(n.View,{children:(0,o.jsx)(n.Text,Object.assign({style:t},{children:s+"…"}))})}}_getDefaultPlaceholderText(){return this.state.phoneNumberForSendingSms?ae.getString("MessageComposer.SmsMessagePlaceholderText"):ae.getString("MessageComposer.MessagePlaceholderShortText")}_renderTextInput(e,t=!1){const s=[ft.sharedInputAndMirror,this._themeStyles.primaryTextColorStyle],i=[ft.sharedInputAndMirror,this._themeStyles.primaryTextColorStyle],r=[te.renderReact(this.state.inputEntities,{defaultStyle:ft.entityText,atMentionStyle:this._useDarkTheme()?ft.atMentionTextDark:ft.atMentionText}),(0,o.jsx)(n.Text,{children:" "},"break")];if(i.push(ft.mirrorText),i.push(n.Styles.createViewStyle({top:-this.state.offsetTop},!1)),s.push(ft.textInput),this.state.messageStreamFontSize!==be.MessageStreamFontSize.Normal){const e=_e.getStyleFromStyle(s,this.state.messageStreamFontSize);s.push(e),i.push(e)}const a=this.state.selectedMediaBarItem===ue.MediaBarItemKeys.MediaPicker||this.state.selectedMediaBarItem===ue.MediaBarItemKeys.Moji||this.state.selectedMediaBarItem===ue.MediaBarItemKeys.Emoticon||this.state.selectedMediaBarItem===ue.MediaBarItemKeys.Gif||this.state.selectedMediaBarItem===ue.MediaBarItemKeys.Sticker?(0,o.jsx)(n.Button,{style:ft.textInputFocusButton,onPress:this._onDismissMediaPicker,importantForAccessibility:n.Types.ImportantForAccessibility.No}):void 0;this._placeholderText=t?"":this._getDefaultPlaceholderText();const l=[ft.textInputContainer],d=(0,o.jsxs)(n.View,Object.assign({style:l},{children:[(0,o.jsx)(n.TextInput,{ref:this._onTextInputRef,autoCorrect:!0,style:s,value:te.getRawText(this.state.inputEntities),maxLength:this.props.maxLength,multiline:!0,onChangeText:this._onInput,onKeyPress:this._onKeyPress,onSelectionChange:this._onSelectionChanged,onFocus:this._onFocus,onBlur:this._onBlur,onScroll:this._onScroll,onPaste:this._onPaste,placeholder:this._placeholderText,placeholderTextColor:this._themeColors.textSecondary,keyboardAppearance:this._useDarkTheme()?"dark":"default",autoCapitalize:"sentences",editable:void 0!==this.state.overrideEditable?this.state.overrideEditable:this.state.editable,clearButtonMode:"never"}),a]}));return(0,o.jsx)(n.View,Object.assign({style:ft.inputArea},{children:(0,o.jsx)(n.Animated.View,Object.assign({style:[...e]},{children:(0,o.jsxs)(n.View,Object.assign({style:Je.default.flexOne},{children:[(0,o.jsx)(n.Text,Object.assign({style:i,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants,textBreakStrategy:"simple"},{children:r})),d]}))}))}))}_stopComposing(){this._startComposingThrottled.cancel(),this._stopComposingDebounced.cancel(),this._isComposing&&(this._isComposing=!1,Ze.default.setComposingState(!1,this.props.conversationId))}_clearTextInput(e=!0){this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit(),e&&F.default.clearMessageInput(this.props.conversationId),this._stopComposing(),this._debounceNewTextBeforeInsertionChanged("",[]),this.isComponentMounted()&&this.setState({inputEntities:[]})}_handleEnterCombinations(e){const t=e.ctrlKey||e.altKey||e.shiftKey;this.state.sendMessageWithEnterEnabled?t?e.shiftKey||this._startNewLine():(e.stopPropagation(),e.preventDefault(),this._sendMessage()):t&&(e.stopPropagation(),e.preventDefault(),this._sendMessage())}_startNewLine(){const e=this._textInputRef;if(e){const t=e.getSelectionRange();this.replaceText(t.end-t.start,"\n","",new ee.UnhandledEntity("\n"))}}_updateInputEntities(e,t,s=-1,i=void 0){const o=[];let n=0,a=0,l=0,d=t;for(s>=0&&(d=d.substring(0,s));l<e.length;){const t=e[l],s=t.text();if(0===d.indexOf(s))this._appendEntityToList(o,r.cloneDeep(t)),d=d.substring(s.length),n+=s.length,l++;else{let t=!1;const s=this._shortenAtMentionEntity(e,l,d);if(s)this._appendEntityToList(o,s.shortenedEntity),d=s.remainingText,a=-s.shortenAmount,t=!0,l++;else{let s=l;for(;s<e.length;){const i=te.getRawText(e,{startIndex:s}),r=d.indexOf(i);if(r>=0){r>0&&(this._appendEntityToList(o,new ee.UnhandledEntity(d.substring(0,r))),n+=r,d=d.substring(r)),t=!0,l=s;break}s++}}if(!t)break}}if(d&&(this._appendEntityToList(o,new ee.UnhandledEntity(d)),n+=d.length),n===s&&(i&&(o.push(i),n+=i.text().length),d=t.substring(n),d)){for(;l<e.length;){const t=te.getRawText(e,{startIndex:l}),s=d.indexOf(t);if(0===s){this._appendEntityToList(o,e[l]);const t=e[l].text().length;n+=t,d=d.substring(t),l++}else{if(!(s>0))break;this._appendEntityToList(o,new ee.UnhandledEntity(d.substring(0,s))),n+=s,d=d.substring(s)}}d&&this._appendEntityToList(o,new ee.UnhandledEntity(d))}return{newEntities:o,insertionAdjustment:a}}_appendEntityToList(e,t){const s=r.last(e);if(s instanceof ee.UnhandledEntity&&t instanceof ee.UnhandledEntity){const i=t.text(),o=e.length>1&&e[e.length-2]instanceof ee.AtMentionEntity;" "===s.text()&&o&&mt.test(i)?e.splice(e.length-1,1,t):s.appendText(i)}else e.push(t)}_shortenAtMentionEntity(e,t,s){let i=0,o=s;if(!(e[t]instanceof ee.AtMentionEntity))return;const n=e[t];if(!n.shortName||!n.displayName)return;if(e[t].text().length<n.displayName.length)return;let r=s.length;if(t<e.length-1){const i=te.getRawText(e,{startIndex:t+1});if(r=s.indexOf(i),r<0)return;if(o=s.substring(0,r),o.length>=n.displayName.length)return}if(0===o.indexOf(n.shortName)){i=r-n.shortName.length;return{shortenedEntity:n.clone(n.shortName),remainingText:s.substring(o.length),shortenAmount:i}}}_getEmoticonPickerItem(){if(this.props.hideEmoticonKeyboardIcon||P.isPhoneMri(this.props.conversationId)||P.isS4BBridgeMri(this.props.conversationId))return;const e=this.state.isShowingUnifiedPesPickerDesktop,t=this._onUnifiedPesPickerDesktopPress,s={id:ue.MediaBarItemKeys.Emoticon,key:"emoticonPicker",active:e,onActive:t,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,onFocus:this.requestFocus,onBlur:this.blur,onInputChange:this.autoReplaceText,onEmoticonSelected:this._onEmoticonSelected,onEmoticonBackspacePress:this._handleEmoticonBackspacePress,pesPickerPopupRef:this._getPesPickerPopupRef,preventAccessibilityFocus:this.props.preventAccessibilityFocus,colorOverride:this._themeColors.primaryTextColor,hoverColorOverride:this._themeColors.secondaryTextColor,iconStyleOverride:void 0,showCategorySwitcher:!1,disabled:this.props.disableActionOnMessageComposer,origin:he.MediaBarItemOrigin.MessageComposer,ref:e=>{g.default.setAnchor(m.EngagementTooltipType.ExpressionPicker,e)}};return(0,o.jsx)(n.View,Object.assign({style:ft.desktopOverrides.composerInnerIconWrapper},{children:(0,o.jsx)(q.ExpressionPickerItem,Object.assign({},s))}))}_hasQuotes(){return!r.isEmpty(this.props.quotedMessages)}_mediaBarItemDescriptor(e){switch(e){case ue.MediaBarItemKeys.Emoticon:const t={onEmoticonSelected:this._onEmoticonSelected,pesPickerPopupRef:this._getPesPickerPopupRef,showCategorySwitcher:!1};return{id:e,render:this._renderEmoticonPickerItem,propOverrides:t};case ue.MediaBarItemKeys.Moji:const s={onMojiSelected:this._onMojiSelected,showCategorySwitcher:!1};return{id:e,render:this._renderMojiPickerItem,getVirtualKeyboard:Ie.MojiPickerItem.getVirtualKeyboard,propOverrides:s};case ue.MediaBarItemKeys.Sms:return{id:e,render:this._renderSmsItem};case ue.MediaBarItemKeys.MediaPicker:return{id:e,render:this._renderMediaPickerItem,disabled:this.state.disableHighBandwidthOperations};case ue.MediaBarItemKeys.FilePicker:return{id:e,render:this._renderFilePickerItem,disabled:this.state.disableHighBandwidthOperations};case ue.MediaBarItemKeys.MagicBotToolbox:return{id:e,render:this._renderMagicToolboxItem};case ue.MediaBarItemKeys.Camera:return{id:e,render:this._renderCameraItem,disabled:this.state.disableHighBandwidthOperations};case ue.MediaBarItemKeys.ScheduleCall:return{id:e,render:this._renderScheduleCallItem};case ue.MediaBarItemKeys.Poll:return{id:e,render:this._renderPollItem};case ue.MediaBarItemKeys.Location:return{id:e,render:this._renderLocationPickerItem,disabled:this.state.disableHighBandwidthOperations};case ue.MediaBarItemKeys.Contact:return{id:e,render:this._renderContactPickerItem};case ue.MediaBarItemKeys.Bing:const i={onBlur:this._onBlur};return{id:e,render:this._renderBingSearchItem,propOverrides:i};case ue.MediaBarItemKeys.VideoMessage:return{id:e,render:this._renderVideoMessageItem,disabled:this.state.disableHighBandwidthOperations};case ue.MediaBarItemKeys.People:return{id:e,render:this._renderPeopleItem};case ue.MediaBarItemKeys.Audio:const o={onPress:this.props.onRecording};return{id:e,render:this._renderAudioMessageItem,propOverrides:o};case ue.MediaBarItemKeys.SendCredit:return{id:e,render:this._renderSendCreditItem,getVirtualKeyboard:Ue.SendCreditItem.getVirtualKeyboard}}se.warn(K.LogTraceArea.MessageComposer,"No media bar descriptor for "+e)}_canShowBingButton(){return this._showBingButton(this.state)}_canShowMagicBotToolboxButton(){return this._showMagicBotToolboxButton(this.state)}_canShowSmsIcon(){return!1}_canShowEmoticonIcon(){return!this.props.hideEmoticonKeyboardIcon}_getItemDescriptors(e,t=!1){const s=t&&this.state.disableHighBandwidthOperations,i=r.map(e,(e=>{switch(e){case ue.MediaBarItemKeys.Bing:if(this._canShowBingButton())return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.MagicBotToolbox:if(this._canShowMagicBotToolboxButton())return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Camera:if(!this.props.hideMediaPickerIcon&&this.state.isCameraAvailable)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Sms:if(this._canShowSmsIcon())return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Emoticon:if(this._canShowEmoticonIcon())return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Location:if(this.state.showLocationPicker&&!s&&t)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Contact:if(this.state.showContactPicker)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.MediaPicker:if(!this.props.hideMediaPickerIcon&&!s&&t)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.FilePicker:if(!this.props.hideFilePicker&&!s)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Moji:if(this._isMojiCategoryEnabled()&&!t)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.ScheduleCall:if(!this.props.hideScheduleCallIcon&&!s&&!this.state.isRegularMemberInModeratedGroup)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Poll:if(!this.props.hidePollIcon)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.People:return this._mediaBarItemDescriptor(e);case ue.MediaBarItemKeys.VideoMessage:if(this.state.showVideoMessageIcon&&!s)return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.Audio:if(this._canShowMicButton(this.props,this.state))return this._mediaBarItemDescriptor(e);break;case ue.MediaBarItemKeys.SendCredit:if(!this.props.hideSendCreditIcon&&!s)return this._mediaBarItemDescriptor(e)}}));return r.compact(i)}_canShowMicButton(e,t){return!(e.hideAudioMessage||!e.onRecording||t.phoneNumberForSendingSms||this._isPresentedInSidebar()||t.disableHighBandwidthOperations)}_getOverflowItemDescriptors(){const e=r.map(this.state.mediaBarMenuOrder,(e=>e)),t=this._getItemDescriptors(r.flatten(e),!0);return r.slice(t,this.state.currentNumberOfIconsInMediaBar)}_getMediaBarItemDescriptors(){if(this.props.hideMediaBar||this._isMediabarDisabled())return[];const e=this._getItemDescriptors(this.state.mediaBarMenuOrder,!0);return r.slice(e,0,this.state.currentNumberOfIconsInMediaBar)}_getMediaBar(e=!0){if(this._getRightIcon()||this.state.isShowingUnifiedPesPickerDesktop)return;const t=this._getMediaBarItemDescriptors();let s;if(this.state.isEncryptedThreadThread||(s=(0,o.jsx)(x.default,{overflowConfig:this.getOverflowConfig(),otherPartyMri:this.props.otherPartyMri,conversationId:this.props.conversationId,onOverflowButtonPress:this._onComposerOverflowPress})),t.length>0){const i=!1;return(0,o.jsxs)(n.View,Object.assign({style:ft.mediaBarWrapper},{children:[(0,o.jsx)(de.MediaBar,{ref:this._onMediaBarRef,activeId:this.state.selectedMediaBarItem,itemDescriptors:t,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isMobileInterface:!1,showIcons:e,onInputChange:this.autoReplaceText,onItemSelected:this._onMediaBarItemSelected,onFocus:this.requestFocus,onBlur:this.blur,onCustomKeyboardClose:this._onCustomKeyboardClose,onBackspace:this._handleEmoticonBackspacePress,onCustomAction:this._onHandleCustomAction,preventAccessibilityFocus:this.props.preventAccessibilityFocus,onMessageSent:this.props.onMessageSent,onCloseSearch:this._onCancelPesSearch,clearEditInChatsComposer:this.props.onClearEdit,autoFocusFirstItem:i,disableActionOnMediaBar:this.props.disableActionOnMessageComposer,focusCustomKeyboardWhenShown:!0,announceForAccessibilityForMessageSent:this._announceForAccessibilityForMessageSent,customKeyboardHeight:this.state.pesPickerKeyboardHeight}),s]}))}}_animateInputAreaToTargetHeight(){this._inputAreaAnimation||this._inputAreaTargetHeight===this._inputAreaHeight||(this._inputAreaHeight=this._inputAreaTargetHeight,this._inputAreaAnimation=Ge.default.easeOut({value:this._inputAreaHeightValue,toValue:this._inputAreaTargetHeight}),this._inputAreaAnimation.start((()=>{this._inputAreaAnimation=void 0,this.isComponentMounted()&&this._animateInputAreaToTargetHeight()})))}_toggleSmsSending(e,t){this._onPhoneNumberForSmsSelected(t),this.isComponentMounted()&&this.setState({smsToggledOn:e})}_sendControlEnabled(e,t,s){return e.showSendControlWhenEmpty||!r.isEmpty(t.inputEntities)||s||!!t.phoneNumberForSendingSms||t.hasMediaPreviews}_canCancelEdit(e,t){return!!t&&(t===this._inputAreaText||r.isEmpty(e.inputEntities))}replaceText(e,t,s,i){const o=this._textInputRef;if(o){const s=o.getSelectionRange(),n=this._inputAreaText;let a=n.substring(0,s.end-e)+t;s.end<n.length&&(a+=n.substring(s.end));const l=this._updateInputEntities(this.state.inputEntities,a,s.end-e,i);this._inputAreaText=a,o.setValue(a);const d=s.end+t.length-e+l.insertionAdjustment;this.isComponentMounted()&&this.setState({inputEntities:l.newEntities}),o.requestFocus(),this._currentSelectionStart!==d&&(this._afterNextOnInput=()=>{this._currentSelectionStart=d,this._currentSelectionEnd=d,o.selectRange(d,d)}),r.defer(this._debounceNewTextBeforeInsertionChanged,"",l.newEntities)}}abortTextAutoCompletion(){this._cancelAutoCompletionIfActive()}_cancelAutoCompletionIfActive(){this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this.props.onInputTextChanged("",!0)}_setInputEntityStateUpstream(e){const t=fe.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this.isComponentMounted()&&this.setState({inputEntities:e,editableEntities:t})}_setInputEntityStateDownstream(e,t){const s=this.state.inputEntitiesDataVersion+1,i=fe.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this.isComponentMounted()&&this.setState({inputEntities:e,inputEntitiesDataVersion:s,editableEntities:i},t)}_sendFileWithDimensions(e){const t=Ye.default.getFileUrl(e);l.default.getImageSize(t).then((t=>{if(t&&(e.dimensions=t),this.state.isMediaPreviewEnabled)return me.default.addPreviews([e],this.props.conversationId,K.PostSource.MessageComposer);const s={name:Ee.ScenarioName.SendPicture};Fe.default.postUpload([this.props.conversationId],e,K.PostSource.MessageComposer,!1,{scenarioInfo:s},this._getRootViewType())}))}_preventSendingSMSMessage(e){return!(!(1===e.length&&e[0]instanceof ee.SmsEntity&&this._smsInfoLineRef)||this._smsInfoLineRef.canSendSMS())&&(this.state.isSmsFailureScreenEnabled?ke.default.navigateToSmsFailurePrompt(this.props.conversationId,this.state.phoneNumberForSendingSms?this.state.phoneNumberForSendingSms.number:"",!1):v.default.open(this._getRootViewId()),!0)}_sendMessage(){return i.__awaiter(this,void 0,void 0,(function*(){if(se.log(K.LogTraceArea.MessageComposer,"sendMessage isPostingMessage: "+this._isPostingMessage),this._isPostingMessage)return;if(!(0,lt.canSendMessageToMagicBot)(this.state.inputEntities,this.state.isMagicBotConversation))return void this.dismissKeyboard();this._isPostingMessage=!0;const e=tt.default.newCauseId();se.log(K.LogTraceArea.MessageComposer,"sendMessage causeId: "+e);let t=[],s=0;if(this.props.quotedMessages&&(t=t.concat(this.props.quotedMessages.map(this._getQuoteEntity)),s=t.length),this.state.inputEntities.length>0&&(t=t.concat(this.state.inputEntities)),this.state.enableOnewaySms&&this.state.phoneNumberForSendingSms&&!r.isEmpty(this.state.inputEntities)&&(t=[new ee.SmsEntity(this._getTextForSms(this.state.inputEntities),this.state.phoneNumberForSendingSms.number)],this._preventSendingSMSMessage(t)))return se.log(K.LogTraceArea.MessageComposer,"sendMessage Message prevented from being send."),void(this._isPostingMessage=!1);try{const i=(0,lt.isMagicBotMentioned)(t);i&&this.state.enableMagicBotGroupAutoAdd&&!this.state.isOneOnOneConversation&&!this.state.isMagicBotContainingConversation&&(yield dt.default.serviceAddMemberToThread(this.props.conversationId,(0,it.getMagicBotId)(),ct.AddMemberToThreadSource.BotAutoAdd,!(0,Me.isModerated)(this.state.conversation)),se.log(K.LogTraceArea.MessageComposer,"sendMessage Magic bot auto-added to conversation because being mentioned."),se.track(new ot.MagicBotAutoAddedByMention));const o=i&&this.state.enableMagicBot&&this.state.enableMagicBotOneOnOneAutoAdd&&this.state.isOneOnOneConversation&&!this.state.isMagicBotConversation;if(this._needsContext(i)&&!(0,ht.isUserInputEmptyOrHasWhitespaceOnly)(t)){const e=yield(0,rt.getContext)(!this.state.isOneOnOneConversation||o,this.state.conversation);t.push(e)}this._sendOneOnOneMagicBotMessageIfNeeded(o,t),yield me.default.sendPreviews(this.props.conversationId,e),s>1?h.all(t.map((e=>this._sendTextMessagePromise([e])))).finally((()=>{this._isPostingMessage=!1})):this._sendTextMessagePromise(t).finally((()=>{this._isPostingMessage=!1}))}finally{this._isPostingMessage=!1,this.state.hasFocus||this.requestFocus()}}))}_needsContext(e){return this.state.enableMagicBot&&nt.default.getConsent()&&(e||this.state.isMagicBotConversation)}_sendTextMessagePromise(e){const t={conversationId:this.props.conversationId,editedMessage:this.props.editedMessage,inputEntities:e,onMessageSent:this.props.onMessageSent,phoneNumberForSendingSms:this.state.phoneNumberForSendingSms,smsInfoLineRef:this._smsInfoLineRef,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,messageComposerPastedContentType:this.state.messageComposerPastedContentType};return vt._sendTextMessage(t).then((e=>{if(e){if(this._handleAfterPostMessage(t.conversationId),se.log(K.LogTraceArea.MessageComposer,"sendMessage Message sent."),t.smsInfoLineRef){const e=t.smsInfoLineRef.getTelemetryEvent();e&&(this.state.phoneNumberForSendingSms?e.setSmsWasSent(!0):e.setSkypeMessageSent(!0))}}else se.log(K.LogTraceArea.MessageComposer,"sendMessage Message not sent.")}))}static _sendTextMessage(e){if((0,ht.isUserInputEmptyOrHasWhitespaceOnly)(e.inputEntities))return e.inputEntities.length?se.log(K.LogTraceArea.MessageComposer,"sendMessage User pressed enter with only whitespace message content."):se.log(K.LogTraceArea.MessageComposer,"sendMessage User pressed enter without entering any message content."),h.Resolved(!1);if(e.onMessageSent(e.inputEntities,ye.convertPastedTextTypeToTelemetry(e.messageComposerPastedContentType))){const t=e.editedMessage?ae.getString("MessageComposer.MessageEditedLabel"):ae.getString("MessageComposer.MessageSentLabel");return vt._announceForAccessibility(t),h.Resolved(!0)}return h.Resolved(!1)}static _announceForAccessibility(e){Ne.default.maybeAnnounceForAccessibility(e,0)}_handleAfterPostMessage(e){if(F.default.getSavedMessageInput(e)&&(0,B.default)().fakeConversationTime(e,Date.now()),F.default.clearMessageInput(e),this.props.conversationId===e){this.state.hasFocus||this.requestFocus(),this._stopComposing(),this._inputAreaText="",this.setTextInputAccessibilityFocus(),this._setInputEntityStateDownstream([]),this._cancelAutoCompletionIfActive(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""}),this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.onClearEdit&&this.props.onClearEdit();const e=this._getRootViewId();ce.MediaBarItem.dismissPopup(e),V.default.close(e)}this._isPostingMessage=!1}_shouldAutoFocusInput(){return this._getRootViewId()!==A.MainRootViewId}_isMediabarDisabled(){return P.isS4BBridgeMri(this.props.conversationId)||!!this.state.phoneNumberForSendingSms||!!this.state.isConversationWithPhoneNumber}_isPresentedInSidebar(){return this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav}_announceForAccessibility(e){Ne.default.maybeAnnounceForAccessibility(e,0)}isFocused(){return this.state.hasFocus}blurIfFocused(){this.state.hasFocus&&this.blur()}getInputEntities(){return h.Resolved(this.state.inputEntities)}getOverflowConfig(){return this._overflowActions()}}t.default=vt},558387:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageComposerBase=void 0;const i=s(889391),o=s(24576),n=s(752869),r=s(491632),a=s(871664),l=s(824841),d=s(516283),c=s(923944),h=s(671830),u=s(785207),p=s(539549),g=s(861253),m=s(849434),S=s(383290),f=s(257780),y=s(609748);class v extends o.default{componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),(0,g.default)(t.inputEntities,this.state.inputEntities)||m.default.setShouldShowToneSuggestionsForConversation(this.props.conversationId,(0,S.isToneRewriteEligibleInput)(this.state.inputEntities))}_buildState(e,t){const s=this._getIsMagicBotEnabledInOneOnOne(e.conversationId),{enableMagicBotToolboxGroup:o,enableMagicBotToolboxInBinglessGroups:n}=i.default.getS4LMessagingFeatures();return{isMagicBotEnabledOneOnOneConversation:s,enableMagicBotToolboxGroup:o,enableMagicBotToolboxInBinglessGroups:n}}_shouldShowBingButton(e){const t=e.isMagicBotContainingConversation||!e.isOneOnOneConversation&&e.enableMagicBotGroupAutoAdd||e.isOneOnOneConversation&&e.enableMagicBotOneOnOneAutoAdd&&!h.isAgent(e.conversation.id);return e.enableMagicBot&&t&&!e.isMagicBotConversation}_showBingButton(e){return this._shouldShowBingButton(e)}_showMagicBotToolboxButton(e){return this._shouldShowBingButton(e)&&e.enableMagicBotToolboxGroup&&!e.isOneOnOneConversation}_mediaBarMenuOrder(e,t,s){let i=[...s];if(t&&!e){i=i.filter((e=>e!==y.MediaBarItemKeys.MagicBotToolbox));const e=i.findIndex((e=>e===y.MediaBarItemKeys.Bing));-1!==e&&i.splice(e,1,y.MediaBarItemKeys.MagicBotToolbox)}return i}_sendOneOnOneMagicBotMessageIfNeeded(e,t){if(e){const e=this.state.conversation.getOtherPartyMri();if(e){if(!this.state.isMagicBotEnabledOneOnOneConversation){r.Instrumentation.log(d.LogTraceArea.MessageComposer,"sendMessage Bing was disabled, enabling it because Magic Bot was mentioned."),r.Instrumentation.track(new n.MagicBotOneOnOneToggle(n.MagicBotOneOnOneToggleOrigin.Message,!0));const e=(0,l.setMagicBotEnabled)(this.state.conversation.id,!0);e&&u.default.postMessage(e)}r.Instrumentation.log(d.LogTraceArea.MessageComposer,"sendMessage Sent message to Magic Bot one on one service because it was mentioned."),r.Instrumentation.track(new n.MagicBotOneOnOneMessageSent),a.default.sendOneOnOne(e,c.encode(t,!1))}}}_getIsMagicBotEnabledInOneOnOne(e){var t;if(!i.default.getS4LMessagingFeatures().enableMagicBotOneOnOneAutoAdd)return!1;if(h.isV2OneToOneThread(e))return!!(null===(t=(0,p.default)().getConversation(e))||void 0===t?void 0:t.isMagicBotEnabled());const s=h.isUserMri(e)&&h.buildOneOnOneThreadId(e);return!!f.default.isMagicBotEnabled(s)}}t.MessageComposerBase=v},757236:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageComposerOverflow=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(889391),a=s(462033),l=s(703110),d=s(496418),c=s(803056),h=s(898278),u=s(587134),p=s(746096),g=s(521063),m=s(765947),S=s(436237),f=s(926448),y=s(915877),v=s(733754),C=s(609748),_=s(59680),b=s(767339),T=s(673319),M=s(672997),I=s(451070),w=(s(536150),s(190631)),P=s(450795),k=s(581760),A=s(711828),x=s(478262),R=s(680837),O=s(24576),L=s(73877);var F;!function(e){e[e.Yes=0]="Yes",e[e.No=1]="No",e[e.Maybe=2]="Maybe"}(F||(F={}));const B=(0,y.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,backgroundColor:k.Color.transparent}),containerStaticHeight:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:k.Color.transparent}),containerHidden:()=>n.Styles.createViewStyle({opacity:0}),contentContainer:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0,top:0,borderTopLeftRadius:h.CustomActionSheetBorderRadius,borderTopRightRadius:h.CustomActionSheetBorderRadius,flexDirection:"column-reverse"}),contentContainerStaticHeight:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0,borderTopLeftRadius:h.CustomActionSheetBorderRadius,borderTopRightRadius:h.CustomActionSheetBorderRadius,flexDirection:"column-reverse"}),backgroundContainer:()=>R.default.absoluteFill,background:()=>n.Styles.createViewStyle({flex:1,backgroundColor:k.Color.blackOverlay50}),scrollView:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),content:()=>n.Styles.createViewStyle({alignSelf:"stretch",paddingTop:0}),divider:()=>n.Styles.createViewStyle({marginBottom:5}),headerShadow:()=>n.Styles.createViewStyle({left:0,right:0,height:1,marginBottom:-1})});class D extends O.default{constructor(){super(...arguments),this._gestureInterest=F.Maybe,this._isDragging=!1,this._contentTransform=0,this._headerOpacityValue=new n.Animated.Value(0),this._headerOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._headerOpacityValue}),this._backgroundOpacityValue=new n.Animated.Value(0),this._backgroundOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._backgroundOpacityValue}),this._contentContainerTransformValue=new n.Animated.Value(n.UserInterface.measureWindow().height),this._contentContainerTransformStyle=n.Styles.createAnimatedViewStyle({transform:[{translateY:this._contentContainerTransformValue}]}),this._headerTopValue=new n.Animated.Value(0),this._headerTopStyle=n.Styles.createAnimatedViewStyle({height:this._headerTopValue}),this._containerHeightValue=new n.Animated.Value(0),this._containerHeightStyle=n.Styles.createAnimatedViewStyle({height:this._containerHeightValue}),this._onHeaderRef=e=>{this._headerView=e||void 0},this._onBackButtonPressed=()=>(this._handleOnDismissCallback(),S.log(p.LogTraceArea.HardwareBackButton,"goBack: true componentId: MessageComposerOverflow"),!0),this._onLayoutChanged=e=>{const t=L.default.measureWindow(this._getRootViewId()),s=o.clone(t);this.state.viewDimensions.height===s.height&&this.state.viewDimensions.width===s.width||this.setState({viewDimensions:s,responsiveWidth:M.default.responsiveWidthForSize(t.width)})},this._onScroll=(e,t)=>{if(!this.isComponentMounted())return;const s=e<=1;s!==this.state.isScrolledToTop&&this.setState({isScrolledToTop:s})},this._onPan=e=>{this._gestureInterest=F.No,e.isComplete&&(this._gestureInterest=F.Maybe,this._isDragging=!1)},this._onPanVertical=e=>{this._gestureInterest===F.Maybe&&(this._gestureInterest=F.Yes);let t=0;if(this._gestureInterest===F.Yes){t=e.pageY-e.initialPageY;let s=this._contentTransform+t;if(s<0&&(s=0),this._contentContainerTransformValue.setValue(s),this.state.statusBarPadding){const e=s/(this.state.viewDimensions.height*this._sheetOffset()),t=this._mapVal(e,this.state.statusBarPadding,0);this._headerTopValue.setValue(t)}this._isDragging||(this._isDragging=!0)}if(e.isComplete){this._contentTransform+=t,this._gestureInterest=F.Maybe;const s=this.state.viewDimensions.height*this._sheetOffset();if(e.velocityY>.1&&this._contentTransform>=s&&this._onDismissCallback)this._handleOnDismissCallback();else{let t=!1;e.velocityY<-.1?t=this.state.expandEnabled:e.velocityY<.1&&(t=this.state.expandEnabled&&this._contentTransform<s),this._expandOrCollapse(t)}}},this._onBlur=()=>{this.state.config&&this.state.config.onBlur&&this.state.config.onBlur(),this._handleOnDismissCallback()},this._onFindComplete=()=>{this.props.onFindComplete&&this.props.onFindComplete(),this._handleOnDismissCallback(),this.props.findPerfScenario&&this.props.findPerfScenario.hasStarted()&&!this.props.findPerfScenario.isResolved()&&this.props.findPerfScenario.finish()},this._onWebViewClose=()=>{this.props.onWebViewClose&&this.props.onWebViewClose(),this._handleOnDismissCallback()},this._onCloseButtonClick=()=>{S.track(new T.MessageOverflowEvent(T.MessageOverflowAction.MessageOverflowCloseButtonClicked)),this._handleOnDismissCallback()},this._onCustomAction=(e,t)=>{if(e===x.MediaBarCustomAction.LaunchSearch){const e=l.default.getSearch();if(e){const t=f.default.transform(e,"");m.default.openIntegration(t,this.props.conversationId,this._getContext(),this._onFindComplete,this._onWebViewClose,void 0)}}else this.state.config&&this.state.config.onCustomAction&&this.state.config.onCustomAction(e,t)},this._onMoveShouldSetResponder=e=>(e.preventDefault(),e.stopPropagation(),!1),this._onScrollViewRef=e=>{this._scrollView=e||void 0}}_buildState(e,t){const s=r.default.getS4LIntegrationsFeatures().findPanelLayout,i={statusBarPadding:I.default.statusBarPadding(),bingSearch:l.default.getSearch(),expandEnabled:!1,safeAreaHorizontalPaddingStyle:I.default.horizontalPaddingStyle(),safeAreaHorizontalInsets:I.default.horizontalInsets(),useOverflowMenuGrid:r.default.getS4LMessagingFeatures().enableOverflowMenuGrid,includeOverflowMenuInFindPanel:s&&s.isFlatList&&s.includeMediaBarItemsInFlatList};if(t){i.hidden=!0,i.isHiding=!1,i.isExpanded=!1,i.isScrolledToTop=!0;const e=L.default.measureWindow(this._getRootViewId());i.viewDimensions={height:e.height,width:e.width},i.responsiveWidth=M.default.responsiveWidthForSize(e.width),i.config=void 0,i.shouldRenderFindPanel=!1}return i}componentDidMount(){super.componentDidMount(),this._containerHeightValue.setValue(this.state.viewDimensions.height)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.hidden!==t.hidden&&(this.state.hidden?(this._dismissContent(!0),a.default.unsubscribe(this._onBackButtonPressed)):(this._presentContent(!0),a.default.subscribe(this._onBackButtonPressed))),this.state.viewDimensions.height===t.viewDimensions.height&&this.state.statusBarPadding===t.statusBarPadding||(this._containerHeightValue.setValue(this.state.viewDimensions.height),this.state.hidden||this._expandOrCollapse(this.state.isExpanded,!0)),this.state.isScrolledToTop!==t.isScrolledToTop&&P.default.easeOut({value:this._headerOpacityValue,toValue:this.state.isScrolledToTop?0:1,useNativeDriver:!0}).start()}showOrHide(e,t,s,i){if(this._onDismissCallback=s,this.isComponentMounted()){const s=!e;this.state.hidden!==s&&(d.default.setCoachMarkEnabled(s),this.setState({hidden:s,config:t,isHiding:s},i))}}_mapVal(e,t,s){return t+(s-t)*e}_presentContent(e){this._expandOrCollapse(!1,e,(()=>{this.isComponentMounted()&&(this._headerView&&this._headerView.requestFocus(),this.setState({shouldRenderFindPanel:!0}))}))}_dismissContent(e){const t=()=>{this._scrollView&&this._scrollView.setScrollTop(0,!1),this.isComponentMounted()&&this.state.hidden&&this.state.isHiding&&this.setState({isHiding:!1,isScrolledToTop:!0,shouldRenderFindPanel:this.state.shouldRenderFindPanel})},s=this.state.expandEnabled?this.state.viewDimensions.height:this.state.viewDimensions.height*(1-this._sheetOffset());e?n.Animated.parallel([P.default.easeOut({value:this._backgroundOpacityValue,toValue:0,useNativeDriver:!0}),P.default.easeOut({value:this._contentContainerTransformValue,toValue:s,useNativeDriver:!0})]).start(t):(this._backgroundOpacityValue.setValue(0),this._contentContainerTransformValue.setValue(s),this._headerTopValue.setValue(0),t())}_expandOrCollapse(e,t=!0,s){if(0===this.state.viewDimensions.height)return;const i=e||!this.state.expandEnabled?0:this.state.viewDimensions.height*this._sheetOffset(),o=e?this.state.statusBarPadding:0,r=()=>{this.isComponentMounted()&&this.setState({isExpanded:e,shouldRenderFindPanel:!0}),s&&s(),this._isDragging=!1};t?(n.Animated.parallel([P.default.easeOut({value:this._backgroundOpacityValue,toValue:1,useNativeDriver:!0}),P.default.easeOut({value:this._contentContainerTransformValue,toValue:i,useNativeDriver:!0})]).start(r),P.default.easeOut({value:this._headerTopValue,toValue:o}).start()):(this._backgroundOpacityValue.setValue(1),this._contentContainerTransformValue.setValue(i),this._headerTopValue.setValue(o),r()),this._contentTransform=i}_sheetOffset(){let e=.5;return this.state.viewDimensions.width>this.state.viewDimensions.height?e=.9:this.state.expandEnabled?this.state.useOverflowMenuGrid&&(e=.6):e=.7,1-e}_handleOnDismissCallback(){this._onDismissCallback&&!this.state.hidden&&this._onDismissCallback()}_renderOverflowItems(){if(!this.state.viewDimensions.width||!this.state.config||this.state.includeOverflowMenuInFindPanel)return;const e=o.filter(this.state.config.mediaBarItems,(e=>e.id!==C.MediaBarItemKeys.Bing||!!this.state.bingSearch)),t={height:this.state.viewDimensions.height,width:this.state.viewDimensions.width-this.state.safeAreaHorizontalInsets.left-this.state.safeAreaHorizontalInsets.right},s={menuItems:e,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,responsiveWidth:this.state.responsiveWidth,onItemSelected:this.state.config.onItemSelected,onCustomAction:this._onCustomAction,onFocus:this.state.config.onFocus,onBlur:this._onBlur,viewDimensions:t};return this.state.useOverflowMenuGrid?(0,i.jsx)(b.default,Object.assign({},s)):(0,i.jsx)(_.default,Object.assign({},s))}render(){const e=this.state.hidden&&!this.state.isHiding,t=this.state.shouldRenderFindPanel?(0,i.jsx)(g.default,{conversationId:this.props.conversationId,isActive:!e,isInline:!0,hideAddInsTitle:!0,perfScenario:this.props.findPerfScenario,onFindComplete:this._onFindComplete,onWebViewClose:this._onWebViewClose,overflowActionConfig:this.state.config}):void 0,s=[B.content];this.state.safeAreaHorizontalPaddingStyle&&s.push(this.state.safeAreaHorizontalPaddingStyle);const o=this._renderOverflowItems(),r=this.state.includeOverflowMenuInFindPanel?void 0:(0,i.jsx)(u.default,{style:B.divider,marginLeft:20,marginRight:20}),a={ref:this._onScrollViewRef,style:B.scrollView,scrollEventThrottle:32,scrollEnabled:!this.state.expandEnabled||this.state.isExpanded,bounces:!1,onScroll:this._onScroll,onMoveShouldSetResponder:this._onMoveShouldSetResponder},l=(0,i.jsx)(n.ScrollView,Object.assign({},a,{children:(0,i.jsxs)(n.GestureView,Object.assign({style:s,onPanVertical:!this.state.expandEnabled||this.state.isExpanded&&!this.state.isScrolledToTop?this._onPan:this._onPanVertical,panPixelThreshold:20,releaseOnRequest:!1,importantForAccessibility:n.Types.ImportantForAccessibility.No},{children:[o,r,t]}))})),d={icon:A.SkypeIcon.ClosePanel,onPress:this._onCloseButtonClick,title:v.getString("Global.CloseButtonTitle")},h=(0,i.jsx)(n.GestureView,Object.assign({onPanVertical:this._onPanVertical,panPixelThreshold:20,releaseOnRequest:!1,importantForAccessibility:n.Types.ImportantForAccessibility.No},{children:(0,i.jsx)(w.SimplePanelHeader,{ref:this._onHeaderRef,panelName:v.getString("MessageComposerOverflow.AddTitle"),leftButton:d,hideBottomBorder:!0,dontFocusOnMount:!0})})),p=[this.state.expandEnabled?B.contentContainer:B.contentContainerStaticHeight,this._contentContainerTransformStyle,this._themeStyles.primaryBackgroundColorStyle];let m;this.state.expandEnabled||p.push(n.Styles.createViewStyle({height:this.state.viewDimensions.height*(1-this._sheetOffset())},!1)),m=e?[B.containerHidden]:this.state.expandEnabled?[B.container,this._containerHeightStyle]:[B.containerStaticHeight];const S=e?n.Types.ImportantForAccessibility.NoHideDescendants:n.Types.ImportantForAccessibility.No,f=e?void 0:(0,i.jsx)(n.Button,Object.assign({style:B.backgroundContainer,onPress:this._onDismissCallback,disableTouchOpacityAnimation:!0,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants},{children:(0,i.jsx)(n.Animated.View,{style:[B.background,this._backgroundOpacityStyle]})}));return(0,i.jsx)(c.default,Object.assign({isPresentedInMobileSheet:!0},{children:(0,i.jsxs)(n.Animated.View,Object.assign({style:m,blockPointerEvents:e,importantForAccessibility:S,onLayout:this._onLayoutChanged},{children:[f,(0,i.jsxs)(n.Animated.View,Object.assign({style:p},{children:[l,(0,i.jsx)(n.Animated.View,{style:[B.headerShadow,this._themeStyles.headerShadowColorStyle,this._headerOpacityStyle]}),h,(0,i.jsx)(n.Animated.View,{style:this._headerTopStyle})]}))]}))}))}}t.MessageComposerOverflow=D,t.default=D},59680:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageComposerOverflowCarousel=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(247409),a=s(765947),l=s(915877),d=s(90284),c=s(798401),h=(0,l.lazyProperties)({overflowMenu:()=>n.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",marginBottom:5}),overflowMenuRTL:()=>n.Styles.createViewStyle({flexDirection:"row-reverse",transform:[{scaleX:-1}]})});class u extends r.default{_elementCount(){return this.props.menuItems.length}_height(){}_renderElements(e){if(!this.props.viewDimensions.width)return;const t=this.props.menuItems.length,s=a.default.columnWidthInfo(this.props.responsiveWidth,this.props.viewDimensions.width,0,0),r=t>s.columnCount,l=r?n.Styles.createViewStyle({width:Math.max(this.props.viewDimensions.width/(s.columnCount+.5),d.OverflowItemSizeInGridOrCarousel)},!1):s.columnWidthStyle;let u=o.map(this.props.menuItems,(e=>c.default.overflowItemForDescriptor(e,this.props,this._themeStyles,l)));const p=[h.overflowMenu];return r&&e&&(p.push(h.overflowMenuRTL),u=o.reverse(u)),{elements:(0,i.jsx)(n.View,Object.assign({style:p},{children:u})),useStaticContainer:!r}}}t.MessageComposerOverflowCarousel=u,t.default=u},767339:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageComposerOverflowGrid=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(765947),a=s(915877),l=s(798401),d=s(24576),c=(0,a.lazyProperties)({overflowMenu:()=>n.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",alignSelf:"stretch"})});class h extends d.default{render(){if(!this.props.viewDimensions.width)return;const e=r.default.columnWidthInfo(this.props.responsiveWidth,this.props.viewDimensions.width,0,0).columnWidthStyle,t=o.map(this.props.menuItems,(t=>l.default.overflowItemForDescriptor(t,this.props,this._themeStyles,e)));return(0,i.jsx)(n.View,Object.assign({style:c.overflowMenu},{children:t}))}}t.MessageComposerOverflowGrid=h,t.default=h},8145:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(785893),n=s(496486),r=s(583367),a=s(809206),l=s(274840),d=s(709133),c=s(54569),h=s(516778),u=s(397691),p=s(4736),g=s(300060),m=s(889391),S=s(739119),f=s(180843),y=s(968894),v=s(578723),C=s(94655),_=s(16625),b=s(148649),T=s(47447),M=s(905531),I=(s(314920),s(614980),s(951267)),w=s(871908),P=s(351077),k=s(671830),A=s(297775),x=s(496418),R=s(911009),O=s(711930),L=s(147204),F=s(208223),B=s(881632),D=s(417677),E=s(820770),V=s(539549),N=s(986374),U=s(884817),j=s(843368),H=s(437490),z=s(952262),W=s(292069),G=s(330757),K=s(82433),q=s(770891),Q=s(904604),X=s(746096),$=s(301014),J=s(529245),Y=s(753559),Z=s(130387),ee=s(913944),te=s(766649),se=s(497174),ie=s(923944),oe=s(436237),ne=s(861253),re=s(710400),ae=s(172490),le=s(547126),de=s(915877),ce=s(20022),he=s(733754),ue=s(88824),pe=s(80372),ge=s(624897),me=s(238915),Se=s(609748),fe=s(318743),ye=s(206286),ve=s(603088),Ce=s(947193),_e=s(961428),be=s(723752),Te=s(371639),Me=s(106658),Ie=s(812056),we=s(540897),Pe=s(844972),ke=s(45532),Ae=s(89808),xe=s(178735),Re=s(104735),Oe=s(330124),Le=s(833348),Fe=s(339159),Be=s(269399),De=s(879348),Ee=s(63584),Ve=s(758962),Ne=s(699070),Ue=s(785207),je=s(29130),He=s(857946),ze=s(415963),We=s(720360),Ge=s(886045),Ke=s(537589),qe=s(615301),Qe=s(149769),Xe=s(807914),$e=s(563080),Je=s(795960),Ye=s(450795),Ze=s(581760),et=s(640363),tt=s(311010),st=s(711828),it=s(478262),ot=s(680837),nt=s(360305),rt=s(912770),at=s(626712),lt=s(273096),dt=s(172758),ct=s(853374),ht=s(56503),ut=s(667024),pt=(s(827357),s(846116)),gt=s(752869),mt=s(69576),St=s(534256),ft=s(559669),yt=s(768696),vt=s(422801),Ct=s(61375),_t=s(372210),bt=s(939848),Tt=s(558387),Mt=s(988140),It=Ze.Color.darkMessageComposerContentBackground,wt=Ze.Color.gray400Overlay10,Pt=st.IconSize.default,kt=st.IconSize.default,At=kt-4,xt=c.unicodeLetterRegex,Rt={instantTriggers:[`^(@[${xt}-]{0,16} ?[${xt}-]{0,16})$`,`.*\\W(@[${xt}]{0,16} ?[${xt}]{0,16})$`,"^(/\\w{0,16})$",".*(\\([a-zA-Z:]{2,16})$",".*(\\([a-zA-Z:]{2,16}:[1-6]?)$"],delayedTriggers:[".*\\b([A-Z][A-Za-z]{2,31})$"]};var Ot;!function(e){e[e.OverflowButton=0]="OverflowButton",e[e.OverflowButtonCoachMark=1]="OverflowButtonCoachMark"}(Ot||(Ot={}));const Lt=(0,de.lazyProperties)({messageComposerNewComposer:()=>h.Styles.createViewStyle({marginBottom:5,paddingLeft:8}),messageComposerNewComposerSmallDevice:()=>h.Styles.createViewStyle({paddingLeft:2}),sendButton:()=>h.Styles.createViewStyle({borderRadius:Pt/2,height:Pt,width:Pt}),micButton:()=>h.Styles.createViewStyle({borderRadius:Pt/2,height:Pt,width:Pt,paddingLeft:6}),sendButtonHover:()=>h.Styles.createButtonStyle({backgroundColor:Ze.Color.blueOverlay70}),compositionAreaContainer:()=>h.Styles.createViewStyle({position:"absolute",flexDirection:"row",left:0,right:0,bottom:0}),compositionArea:()=>h.Styles.createViewStyle({paddingLeft:8,flex:1,justifyContent:"center"}),compositionAreaNewComposer:()=>h.Styles.createViewStyle({paddingLeft:15,justifyContent:"flex-end",overflow:"visible"}),inputArea:()=>h.Styles.createViewStyle({flexDirection:"row"}),expandableArea:()=>h.Styles.createViewStyle({flex:1,maxHeight:96,backgroundColor:Ze.Color.transparent}),expandableAreaNewComposer:()=>h.Styles.createViewStyle({maxHeight:110}),expandableAreaWithQuote:()=>h.Styles.createViewStyle({flex:1,maxHeight:48}),expandableAreaWithQuoteNewComposer:()=>h.Styles.createViewStyle({maxHeight:80}),expandableAreaLandscapeMaxHeight:()=>h.Styles.createViewStyle({maxHeight:48}),composerInner:()=>h.Styles.createViewStyle({flex:1,flexDirection:"row",marginVertical:12,marginHorizontal:16}),composerOuter:()=>h.Styles.createViewStyle({flex:1,flexDirection:"row"}),composerInnerMobile:()=>h.Styles.createViewStyle({marginTop:5,marginBottom:0,marginHorizontal:4}),composerInnerMobileNewComposer:()=>h.Styles.createViewStyle({marginTop:5,marginHorizontal:0}),composerInnerMobileNewComposerExtraPadding:()=>h.Styles.createViewStyle({marginLeft:3}),composerInnerLandscape:()=>h.Styles.createViewStyle({marginTop:4,marginBottom:2}),innerContainerNewComposer:()=>h.Styles.createViewStyle({alignItems:"flex-end"}),innerWrapperNewComposer:()=>h.Styles.createViewStyle({borderRadius:At/2,minHeight:At,alignItems:"center",marginBottom:2,marginHorizontal:3,overflow:"visible"}),innerWrapperNewComposerSmallDevice:()=>h.Styles.createViewStyle({marginHorizontal:0}),rightControlContainer:()=>h.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),quoteArea:()=>h.Styles.createViewStyle({flex:1,paddingTop:6,paddingLeft:12}),quoteAreaNewComposer:()=>h.Styles.createViewStyle({paddingLeft:0,borderBottomWidth:1,marginBottom:5}),quoteTextStyle:()=>h.Styles.createTextStyle({fontStyle:"italic"}),quoteAttributeStyle:()=>h.Styles.createTextStyle({fontSize:tt.default.controlFontSize.messageStreamQuoteAttributeMobile}),attachmentButton:()=>h.Styles.createViewStyle({paddingLeft:12,alignItems:"flex-end"}),cameraButton:()=>h.Styles.createViewStyle({height:Pt,width:Pt}),overflowButton:()=>h.Styles.createViewStyle({height:Pt,width:Pt}),moreButton:()=>h.Styles.createViewStyle({paddingRight:8,alignItems:"flex-end",height:50}),skypeMessageTextInput:()=>h.Styles.createTextStyle({font:tt.default.font.uiDisplayRegular,fontSize:tt.default.controlFontSize.messageComposerMobile,minHeight:23,backgroundColor:Ze.Color.transparent}),textInputFocusButton:()=>h.Styles.createButtonStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:Ze.Color.transparent}),linkStyle:()=>h.Styles.createTextStyle({fontSize:tt.default.controlFontSize.body,lineHeight:18,color:Ze.Color.gray400,fontFamily:tt.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),emoticonIconNewComposer:()=>h.Styles.createButtonStyle({paddingTop:8,paddingLeft:0,paddingRight:8,paddingBottom:8}),emoticonIconWrapper:()=>h.Styles.createViewStyle({alignSelf:"flex-end"}),rightIconContainer:()=>h.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"space-between"}),clearQuoteNewComposer:()=>h.Styles.createButtonStyle({alignSelf:"flex-start",marginTop:6,marginBottom:10,paddingLeft:0,paddingRight:8}),emoteAuthor:()=>(0,de.lazyProperties)({text:()=>h.Styles.createTextStyle({fontSize:tt.default.controlFontSize.messageComposerDesktop,marginTop:7,fontStyle:"italic"})}),mediaBarMargins:()=>h.Styles.createViewStyle({marginHorizontal:10})});let Ft=45;class Bt extends Tt.MessageComposerBase{constructor(){super(...arguments),this._isPostingMessage=!1,this._gotInitialInputAreaHeight=!1,this._inputAreaHeight=Ft,this._inputAreaTargetHeight=this._inputAreaHeight,this._inputAreaHeightValue=new h.Animated.Value(this._inputAreaHeight),this._inputAreaHeightStyle=h.Styles.createAnimatedViewStyle({height:this._inputAreaHeightValue}),this._rightControlsWidthValue=new h.Animated.Value(2*kt),this._rightControlsWidthStyle=h.Styles.createAnimatedViewStyle({width:this._rightControlsWidthValue}),this._rightControlsOpacityValue=new h.Animated.Value(1),this._rightControlsOpacityStyle=h.Styles.createAnimatedViewStyle({opacity:this._rightControlsOpacityValue}),this.insertSearchResult=(e,t,s)=>{Bt._announceForAccessibility(e),this.autoReplaceText(e,t,s),we.default.deactivateInlineSearch()},this.autoReplaceText=(e,t,s)=>{if(h.UserInterface.isNavigatingWithKeyboard()&&this.state.selectedMediaBarItem&&ge.MediaBarItem.dismissPopup(this._getRootViewId()),"Emoticon"===t){const e=he.getString("MessageComposer.AccessibilityAnnouncement_EmoticonInserted");Bt._announceForAccessibility(e)}else Bt._announceForAccessibility(e);if(this._textInputRef){const e=Ce.getEditableEntityFromInputEntityAndConsiderAlternatives(s,this.state.emoticons);this._textInputRef.insertContent(e),this._textInputRef.requestFocus(),this._textInputRef.getContent().then((e=>{this.isComponentMounted()&&this._consumeNewUserInput(e)}))}},this.requestFocus=()=>{this._textInputRef&&(a.BrowserEnvironment.isEngineEdgeHTML()&&document.activeElement&&document.activeElement.blur(),this._textInputRef.requestFocus())},this.blur=()=>{this._textInputRef&&this._textInputRef.blur()},this.focusOverflowButton=()=>{this._overflowButtonRef&&this._overflowButtonRef.requestFocus()},this.focusVideoButton=()=>{const e=this._mediaBarRef?this._mediaBarRef.getItemById(Se.MediaBarItemKeys.VideoMessage):void 0;e&&e.requestFocus()},this.focusSendButton=()=>{this._inputButton&&this._inputButton.requestFocus()},this.setTextInputAccessibilityFocus=()=>{this._textInputRef&&(this._textInputRef.setAccessibilityFocus(),this.props.explicitAccessibilityAnnoucement&&h.Accessibility.announceForAccessibility(this._placeholderText))},this._handleCustomKeyboardHiddenEvent=()=>{this._resetSelectedKeyboard()},this._resetSelectedKeyboard=()=>{this._trimTextInputIfEmpty()},this._onEmoticonSelected=e=>{this.autoReplaceText(e.text(),"Emoticon",e)},this._onMojiSelected=e=>{this.props.conversationId&&(Ue.default.postMessageFromInput(this.props.conversationId,X.PostSource.MediaPicker,[e],P.MessageTypes.Media_FlikMsg,{name:ze.ScenarioName.SendMoji},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onStickerSelected=e=>{this.props.conversationId&&(Ue.default.postMessageFromInput(this.props.conversationId,X.PostSource.MediaPicker,[e],P.MessageTypes.RichText,{name:ze.ScenarioName.SendSticker},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onGifSelected=e=>{this.props.conversationId&&(Ue.default.postMessageFromInput(this.props.conversationId,X.PostSource.MediaPicker,[e],P.MessageTypes.RichText,{name:ze.ScenarioName.SendGif},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._closePesPickerAndFocusTextInput=()=>{this.state.useMobileUI&&this.isComponentMounted()&&this.setState({selectedMediaBarItem:""}),this.setTextInputAccessibilityFocus()},this._onSMSInfoLineRef=e=>{this._smsInfoLineRef=e||void 0},this._onClearQuoteButtonPress=()=>{this.props.onClearQuotedMessage&&(this.props.onClearQuotedMessage(!0),this._saveMessage(this.state.inputEntities,{clearQuoteMessage:!0}))},this._onPhoneNumberForSmsSelected=e=>{const t=ct.default.newCauseId();oe.log(X.LogTraceArea.MessageComposer,"MessageComposer._onPhoneNumberForSmsSelected causeId: "+t),this.state.twoWaySMSCapable?e&&Re.default.navigateToConversation({convId:k.getMriFromPhoneNumber(e),origin:X.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t}):Re.default.navigateToConversation({convId:this.props.conversationId,origin:X.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t})},this._renderMagicToolboxItem=e=>(0,o.jsx)(Mt.MagicBotToolboxItem,Object.assign({},e,{ref:e.ref})),this._saveMessage=(e,t)=>{if(e&&e.length>0||this._hasQuotes()||this.props.editedMessage){let s,i=He.SavedMessageType.None;this.props.editedMessage?(s=[this.props.editedMessage],i=He.SavedMessageType.Edited):!(null==t?void 0:t.clearQuoteMessage)&&this.props.quotedMessages&&(s=this.props.quotedMessages,i=He.SavedMessageType.Quoted),E.default.saveMessageInput(this.props.conversationId,{messages:s,type:i,inputEntities:e,inputEntitiesDataVersion:this.state.inputEntitiesDataVersion,timestamp:Date.now()})}else oe.log(X.LogTraceArea.MessageComposer,"MessageComposer._saveMessage clearMessageInput."),E.default.clearMessageInput(this.props.conversationId)},this._onCancelPesSearch=(e,t)=>{e&&(oe.log(X.LogTraceArea.MessageComposer,"MessageComposer._onCancelPesSearch clearInputText."),E.default.clearMessageInput(this.props.conversationId));const s=E.default.getSavedMessageInput(this.props.conversationId);(!s||s&&!s.messages)&&(this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit());const i=s?s.inputEntities:[];this._setInputEntityStateDownstream(i,t),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onAnimatedViewRef=e=>{this._animatedViewRef=e||void 0},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._onClearEditMessageQuote=()=>{const e=n.head(this.state.inputEntities);this._textInputRef&&e instanceof se.QuoteEntity&&this._textInputRef.getContent().then((e=>{const t=this._consumeNewUserInput(e)||this.state.inputEntities;this._setInputEntityStateDownstream(t.slice(1,t.length))}))},this._renderEmoticonPickerItem=e=>(0,o.jsx)(G.EmoticonPickerItem,Object.assign({},e)),this._renderMojiPickerItem=e=>(0,o.jsx)(ke.MojiPickerItem,Object.assign({},e)),this._renderGifPickerItem=e=>(0,o.jsx)(Z.GifPickerItem,Object.assign({},e)),this._renderStickerPickerItem=e=>(0,o.jsx)(Je.StickerPickerItem,Object.assign({},e)),this._renderSmsItem=e=>(0,o.jsx)($e.SmsItem,Object.assign({},e)),this._renderMediaPickerItem=e=>(0,o.jsx)(J.default,Object.assign({acceptedFileTypes:J.AcceptedFileTypes.MediaOnly},e)),this._renderFilePickerItem=e=>(0,o.jsx)(J.default,Object.assign({acceptedFileTypes:J.AcceptedFileTypes.All},e)),this._renderCameraItem=e=>(0,o.jsx)(b.CameraItem,Object.assign({},e)),this._renderScheduleCallItem=e=>(0,o.jsx)(We.ScheduleCallItem,Object.assign({},e)),this._renderPollItem=e=>(0,o.jsx)(Ne.PollItem,Object.assign({},e)),this._renderLocationPickerItem=e=>(0,o.jsx)(ue.default,Object.assign({},e)),this._renderContactPickerItem=e=>(0,o.jsx)(F.ContactPickerItem,Object.assign({},e)),this._renderBingSearchItem=e=>(0,o.jsx)(v.BingSearchItem,Object.assign({},e)),this._renderVideoMessageItem=e=>(0,o.jsx)(ht.default,Object.assign({},e)),this._renderPeopleItem=e=>(0,o.jsx)(Fe.PeopleItem,Object.assign({},e)),this._renderSendCreditItem=e=>(0,o.jsx)(Ke.SendCreditItem,Object.assign({},e)),this._onOverflowButtonRef=e=>{this._overflowButtonRef=e||void 0},this._onMediaBarRef=e=>{this._mediaBarRef=e||void 0},this._onLaunchCameraFromComposer=()=>{oe.track(new fe.MediaBarItemPressed(Se.MediaBarItemKeys.ComposerCamera,!0,this.props.conversationId,me.MediaBarItemOrigin.MessageComposer)),this.props.onLaunchCamera&&(this._textInputRef&&this._textInputRef.dismissKeyboard(),this.props.onLaunchCamera())},this._getEmoticonPickerKeyboard=(e,t)=>{const s=this._keyboardHeight(),i=[ot.default.overflowVisible];return s?i.push(h.Styles.createViewStyle({height:s},!1)):i.push(ot.default.flexOne),(0,o.jsxs)(h.View,Object.assign({style:i},{children:[G.EmoticonPickerItem.getVirtualKeyboard(e,t),this._renderPesPickerPopup()]}))},this._renderPesPickerPopup=()=>(0,o.jsx)(De.PesPickerPopup,{ref:this._onPesPickerPopupRef,renderMobileInterface:!0}),this._onPesPickerPopupRef=e=>{this._pesPickerPopup=e||void 0},this._getPesPickerPopupRef=()=>this._pesPickerPopup,this._onCustomKeyboardClose=()=>{this._pesPickerPopup&&this._pesPickerPopup.hide()},this._onLayoutInputArea=e=>{const t=Math.ceil(e.height);this._gotInitialInputAreaHeight?(this._inputAreaTargetHeight=t,this._animateInputAreaToTargetHeight()):(this._inputAreaTargetHeight=t,this._animatedViewRef&&(this._inputAreaHeight=t,this._inputAreaHeightValue.setValue(t)),Ft=t,this._gotInitialInputAreaHeight=!0)},this._onHandleCustomAction=(e,t)=>{switch(e){case it.MediaBarCustomAction.LaunchCamera:this.props.onLaunchCamera&&this.props.onLaunchCamera();break;case it.MediaBarCustomAction.LaunchEmoticon:Ee.EmoticonPickerTelemetry.startOpenScenario(),Ee.EmoticonPickerTelemetry.open(),we.default.activatePicker(Ve.TabType.Emoticon),this._onPickerActive(Se.MediaBarItemKeys.Emoticon);break;case it.MediaBarCustomAction.LaunchMoji:Ee.MojiPickerTelemetry.open(),we.default.activatePicker(Ve.TabType.Moji),this._onPickerActive(Se.MediaBarItemKeys.Moji);break;case it.MediaBarCustomAction.LaunchSticker:Ee.StickerPickerTelemetry.open(),we.default.activatePicker(Ve.TabType.ChatSticker),this._onPickerActive(Se.MediaBarItemKeys.Sticker);break;case it.MediaBarCustomAction.LaunchGif:Ee.GifPickerTelemetry.open(),we.default.activatePicker(Ve.TabType.Gif),this._onPickerActive(Se.MediaBarItemKeys.Gif);break;case it.MediaBarCustomAction.MentionBing:this._mentionMagicBot();break;case it.MediaBarCustomAction.LaunchBingToolbox:this._handleMagicBotToolboxOpen();break;default:oe.log(X.LogTraceArea.MessageComposer,"_onHandleCustomAction unhandled action: "+e)}},this._mentionMagicBot=()=>{var e;const t=(0,pt.getMagicBotId)(),s=z.default.getDisplayableProfile(t),i={type:c.EditableEntityType.AtMention,displayText:s.getDisplayName()+" ",userMri:(0,pt.getMagicBotId)(),shortName:s.getShortName(),displayName:s.getDisplayName()};null===(e=this._textInputRef)||void 0===e||e.insertContent(i),oe.track(new gt.MagicBotMentionedByClick)},this._onComposerOverflowPress=()=>{oe.track(new fe.MediaBarItemPressed(Ot[Ot.OverflowButton],!0,this.props.conversationId,me.MediaBarItemOrigin.MessageComposer)),this._onToggleOverflowMenu()},this._onComposerOverflowCoachMarkPress=()=>{oe.track(new fe.MediaBarItemPressed(Ot[Ot.OverflowButtonCoachMark],!0,this.props.conversationId,me.MediaBarItemOrigin.MessageComposer)),this._onToggleOverflowMenu()},this._onToggleOverflowMenu=()=>{if(this.isComponentMounted()){let e=!1;if(this.props.onHandleOverflow&&(e=this.props.onHandleOverflow(this._overflowActions())),!e){const e=!this.state.showOverflowMenu;e&&(d.default.dismiss(),this._textInputRef&&this._textInputRef.dismissKeyboard()),this.isComponentMounted()&&this.setState({showOverflowMenu:e,selectedMediaBarItem:e?"":this.state.selectedMediaBarItem})}}},this._onDismissMediaPicker=()=>{d.default.showNativeKeyboard(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onMoreButtonClick=e=>{this.isComponentMounted()&&this.setState({isCollapsableMediaBarExpanded:!this.state.isCollapsableMediaBarExpanded}),e.stopPropagation()},this._onPickerActive=e=>{this._textInputRef&&this._textInputRef.getContent().then(this._consumeNewUserInput),this.isComponentMounted()&&this.setState({selectedMediaBarItem:e,isCollapsableMediaBarExpanded:!1,showOverflowMenu:!1})},this._handleMagicBotToolboxOpen=()=>{this.isComponentMounted()&&this.setState({isCollapsableMediaBarExpanded:!1,showOverflowMenu:!1})},this._onMediaBarItemSelected=e=>{(this.state.isCollapsableMediaBarExpanded||this.state.selectedMediaBarItem!==e)&&(this.isComponentMounted()&&this.setState({selectedMediaBarItem:e===Se.MediaBarItemKeys.Sms?"":e,isCollapsableMediaBarExpanded:!1,showOverflowMenu:!1}),this.props.onMediaItemSelected&&this.props.onMediaItemSelected()),e===Se.MediaBarItemKeys.Sms&&(1===this.state.phoneNumbers.length?this._toggleSmsSending(!0,this.state.phoneNumbers[0]):Qe.default.showNumberSelectionPopup((()=>this._smsInfoLineRef),this._getRootViewId(),this.props.conversationId,this.state.phoneNumbers,!1).then((e=>{this._toggleSmsSending(!0,e)})).catch(n.noop))},this._onCancelEditClick=e=>{e.stopPropagation();const t=ct.default.newCauseId();ut.default.createOneShotTrackerAndMarkPressTime(t,ze.ScenarioName.ResponsivenessCancelEditMessage,e),Bt._announceForAccessibility(he.getString("MessageComposer.MessageEditingCanceledLabel")),this._handleAfterPostMessage(this.props.conversationId)},this._onSendButtonClick=e=>{e.stopPropagation();const t=ct.default.newCauseId();ut.default.createOneShotTrackerAndMarkPressTime(t,ze.ScenarioName.ResponsivenessSendEditMessage,e),this._textInputRef&&this._textInputRef.getContent().then((e=>{const t=this._consumeNewUserInput(e);t?this._sendMessage(t):this._setInputEntityStateDownstream(this.state.inputEntities)}))},this._onRecordButtonClick=e=>{e.stopPropagation();const t=ct.default.newCauseId();ut.default.createTrackerAndMarkPressTime(t,ze.ScenarioName.ResponsivenessRecordAudio,e),oe.track(new fe.MediaBarItemPressed(Se.MediaBarItemKeys.Audio,!0,this.props.conversationId,me.MediaBarItemOrigin.MessageComposer)),this.props.onRecording&&this.props.onRecording(),ut.default.markActionDoneAndRemoveTracker(t)},this._onInputButtonRef=e=>{this._inputButton=e||void 0},this._trimTextInputIfEmpty=()=>{this.isComponentMounted()&&!ie.getRawText(this.state.inputEntities).match(/\S|^$/)&&this._setInputEntityStateDownstream([])},this._onAutoCompletionRequested=(e,t)=>(this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this._wasRegexTriggered(t)&&(this._pendingMessageTextCompletionPromise=u.Defer(),this.props.onInputTextChanged(e,!1)),this._pendingMessageTextCompletionPromise?this._pendingMessageTextCompletionPromise.promise():u.Rejected()),this._onAutoCompletionRequestAborted=()=>{this._cancelAutoCompletionIfActive()},this._onAutoCompletionNavigationKey=e=>{if(this.props.onKeyPress&&this.props.onKeyPress(e),e.keyCode===le.default.ESCAPE)this._cancelAutoCompletionIfActive()},this._onUserInputActive=()=>{lt.default.setComposingState(!0,this.props.conversationId)},this._onUserInputInactive=()=>{lt.default.setComposingState(!1,this.props.conversationId)},this._onUserInputCommitted=e=>{const t=this._consumeNewUserInput(e);t&&(lt.default.setComposingState(!1,this.props.conversationId),this._sendMessage(t))},this._onPastingText=e=>{this.isComponentMounted()&&this.setState({messageComposerPastedContentType:e})},this._setComposingStateInactiveDebounced=n.debounce((()=>{lt.default.setComposingState(!1,this.props.conversationId)}),300,{leading:!0,trailing:!0}),this._onUserInputAborted=()=>{this.state.selectedMediaBarItem!==Se.MediaBarItemKeys.Emoticon&&(this._setComposingStateInactiveDebounced(),this._hasQuotes()&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.props.editedMessage&&(this.props.onClearEdit&&this.props.onClearEdit(),oe.log(X.LogTraceArea.MessageComposer,"MessageComposer._onUserInputAborted."),E.default.clearMessageInput(this.props.conversationId)),this._cancelAutoCompletionIfActive())},this._onUserInputEmptyIndicationChanged=e=>{this.isComponentMounted()&&this.setState({userInputIsEmpty:e}),this.props.onNativeComposerMessageEmptyStateChanged&&this.props.onNativeComposerMessageEmptyStateChanged()},this._onUserInputUncommittedChangesIndicationChanged=e=>{this.isComponentMounted()&&this.setState({hasUncommittedUserInput:e})},this._onEqualsInitialContentIndicationChanged=e=>{this.isComponentMounted()&&this.setState({equalsInitialContent:e})},this._onUserInputBackspacePressedAtHeadPos=()=>{this._hasQuotes()&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.state.userInputIsEmpty&&this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit()},this._onAccessibilityAnnouncementRequested=e=>{if(e===c.AccessibilityAnnouncement.NewLineAdded)h.Accessibility.announceForAccessibility(he.getString("MessageComposer.AccessibilityAnnouncement_NewlineAdded"))},this._onEmoticonLoadCompleted=e=>{oe.track(new Be.ComposerEmoticonLoaded(e,Oe.default.isUsingStackNavigationContext()))},this._onPartiallyEnteredMsgStoreUpdated=e=>{if(e===this.props.conversationId){const t=E.default.getSavedMessageInput(e);t&&t.inputEntitiesDataVersion===this.state.inputEntitiesDataVersion&&this._setInputEntityStateUpstream(t.inputEntities)}},this._consumeNewUserInput=e=>{let t;return e.downStreamDataVersion>=this.state.inputEntitiesDataVersion&&(t=ie.applyEditableContentToInputEntities(e,this.state.inputEntities),this._setInputEntityStateUpstream(t)),t},this._onFocus=()=>{const e={hasFocus:!0,isCollapsableMediaBarExpanded:!1,showOverflowMenu:!1};this.isComponentMounted()&&this.setState(e)},this._onBlur=()=>{const e={hasFocus:!1};this.isComponentMounted()&&this.setState(e),this.props.onBlur&&this.props.onBlur()},this._onPaste=e=>{const t=e.nativeEvent;!this.props.disableCopyPasteMedia&&t.clipboardData&&t.clipboardData.items&&0!==t.clipboardData.items.length&&(n.some(t.clipboardData.items,(e=>"text/plain"===e.type))||(n.each(t.clipboardData.items,(t=>{if("image/png"===t.type){e.stopPropagation(),e.preventDefault();const s=new FileReader;let i=t.getAsFile();if(i instanceof e.nativeEvent.target.ownerDocument.defaultView.Blob){const e="image_"+(new Date).toISOString().replace(/[:\.\-]/g,"_")+".png",t=n.attempt((t=>new File([t],e,{type:t.type})),i);n.isError(t)||(i=t),s.onload=()=>{if(i&&i.size>0){const e={file:i,extension:Y.default.extractFileExtension(i.name)};this._sendFileWithDimensions(e)}},s.readAsDataURL(i)}}})),Bt._announceForAccessibility(he.getString("MessageComposer.FilesSentLabel"))))},this._onPastePreviewInCaptureComplete=()=>{const e=ct.default.newCauseId();oe.log(X.LogTraceArea.MessageComposer,"MessageComposer._onPastePreviewInCaptureComplete",e),this._pastePreviewCompletionHelper(!1)},this._onPastePreviewInCaptureCancel=()=>{const e=ct.default.newCauseId();oe.log(X.LogTraceArea.MessageComposer,"MessageComposer._onPastePreviewInCaptureCancel",e),this._pastePreviewCompletionHelper(!0)},this._announceForAccessibilityForMessageSent=()=>{n.defer((()=>{this.isComponentMounted()&&Bt._announceForAccessibility(he.getString("MessageComposer.MessageSentLabel"))}))},this._handleEmoticonBackspacePress=e=>{this._textInputRef&&this._textInputRef.notifyBackspacePressedExternally()},this._showFilePicker=(e,t)=>t===this._getRootViewId(),this._editLastMessageKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this._editLastMessage(),!0),this._focusKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this.requestFocus(),!0),this._editLastMessage=()=>{this.props.onEditLastMessage&&this.props.onEditLastMessage()},this._updateAndStoreDraftInputEntitiesFromContent=e=>(oe.log(X.LogTraceArea.MessageComposer,"MessageComposer._updateAndStoreDraftInputEntitiesFromContent causeId: "+e),this._textInputRef?this._textInputRef.getContent().then((e=>E.default.updateInputEntitiesFromContent(this.props.conversationId,e).commit(this.props.conversationId).storeSavedMessage(this.props.conversationId))):u.Resolved()),this._validateUrl=e=>at.default.isUrlValid(e),this._setContent=(e,t)=>{oe.log(X.LogTraceArea.MessageComposer,"MessageComposer._setContent"),this._setInputEntityStateDownstream(e,(()=>{t&&this.requestFocus()}))}}_buildState(e,t){var s;const i=super._buildState(e,t),o=m.default.getS4LMessagingFeatures(),{enableMagicBot:r,enableMagicBotGroupAutoAdd:l,enableMagicBotOneOnOneAutoAdd:d}=o,h=(0,V.default)().getConversation(e.conversationId),u=(0,pt.isMagicBotConversation)(e.conversationId),p=(0,pt.isMagicBotContainingConversation)(h),g=Object.assign(Object.assign({},i),{enableMagicBot:r,enableMagicBotGroupAutoAdd:l,enableMagicBotOneOnOneAutoAdd:d,isMagicBotConversation:u,isMagicBotContainingConversation:p,conversation:h}),f=this.props,y=this._getRootViewId(),v=m.default.getS4LCommerceFeatures();t&&(g.inputEntities=e.initialInputEntities||[],g.inputEntitiesDataVersion=e.initialInputEntitiesDataVersion||0,g.hasFocus=!1,g.isCollapsableMediaBarExpanded=!1,g.selectedMediaBarItem="",g.offsetTop=0,g.showOverflowMenu=!1,g.userInputIsEmpty=n.isEmpty(g.inputEntities),g.hasUncommittedUserInput=!1,g.equalsInitialContent=!0,g.currentNumberOfIconsInMediaBar=g.maxNumberOfIconsInMediaBarForWidth,g.pesPickerKeyboardHeight=276,g.messageComposerPastedContentType=c.PastedTextType.None);const C=Oe.default.isUsingStackNavigationContext();g.useTabletUI=nt.default.isTabletUI(),g.isKeyboardSeen=re.default.isKeyboardSeen(),g.deviceOrientation=je.default.getDeviceOrientation(y),g.isSmallOrTinyScreen=je.default.isSmallOrTinyScreenSize(y),g.useMobileUI=C||g.useTabletUI,g.editable=!Le.default.isAnimationPending()&&!e.disableActionOnMessageComposer,g.isSmallHeightView=je.default.isSmallDesktopHeightView(y),g.viewportWidth=e.availableWidth||je.default.getWidth(y),g.showAdditionalMediaBarItems=g.viewportWidth>=360,g.gradientColors=Ae.default.getGradientColors(),g.delayedTriggersWaitTime=o.composerAutoCompletionDelay,g.emoticons=K.default.getEmoticons(),g.isUsingStackNavigationContext=C,g.messageStreamFontSize=xe.default.getMessageStreamFontSize(),g.canUseAddins=M.default.addins().canUseAddins,g.isMediaPickerInRightControlsForMobile=o.showMediaPickerInRightControlsForMobile,g.editableEntities=Ce.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(g.inputEntities||[],g.emoticons);const{selectedTabType:b,searchQuery:w}=j.default.getPickerSearchProps();g.selectedTabType=b,g.searchQuery=w,t&&!g.editable&&(g.overrideEditable=!0),g.showLocationPicker=!e.hideLocationPickerIcon&&!et.default.isFireOS(),g.showContactPicker=!e.hideContactPickerIcon&&M.default.contacts().canInvitePeople,g.showStickerPicker=!e.hideStickerPickerIcon,g.showGifPicker=!e.hideGifPickerIcon&&o.enablePesGifs,g.showVideoMessageIcon=!e.hideVideoMessageIcon&&!k.isEncryptedThread(e.conversationId)&&m.default.isDesktopVIMEnabled()&&(U.default.isAVDeviceReady()||a.BrowserEnvironment.isChrome());const P=k.isOneOnOneConversation(e.conversationId);g.overflowMenuOrderForMobileUI=this._overflowMenuOrder(g,o),g.mediaBarMenuOrder=this._mediaBarMenuOrder(!!g.isMagicBotContainingConversation||P,o.enableMagicBotToolboxInBinglessGroups,o.mediaBarMenuOrder),g.isSmallDevice=je.default.isSmallDevice(y),g.useCompactLayout=g.useMobileUI||g.isSmallDevice,g.phoneNumbers=e.otherPartyMri&&dt.default.getFullUserProfileByMri(e.otherPartyMri).phones||[];const A=k.isPhoneMri(e.conversationId);g.isOneOnOneConversation=P,g.creditEntitlement=Q.default.getCreditEntitlement(),g.enableOnewaySms=(A||v.smsPromo.unpaidUserEnabled||!!S.getPositiveCreditBalance(g.creditEntitlement)||Q.default.userHasSubscriptions())&&(A||P)&&g.phoneNumbers.length>0&&!e.editedMessage&&!e.hideSmsIcon&&!k.isEncryptedThread(e.conversationId),g.quoteTextForSms=this._getQuotedTextForSms(f.quotedMessages,e.quotedMessages),g.disableHighBandwidthOperations=te.default.isUsingGogoNetwork(),g.isCameraAvailable=T.UICapabilities.cameraSupported()&&I.default.isCameraAvailable(),g.isConversationWithPhoneNumber=k.isConversationWithPhoneNumber(e.conversationId),g.sendMessageWithEnter=!!xe.default.getUserPreferencesLocal().sendMessageWithEnter,g.enableImagePasteMobile=o.enableImagePasteMobile,g.twoWaySMSCapable=!!(null===(s=_.default.getCallerIdPrimaryNumber())||void 0===s?void 0:s.smsCapable);let x=e.phoneNumberForSendingSms;if(!x&&k.isPhoneMri(e.conversationId)){const t=k.getPhoneNumberFromMri(e.conversationId);t&&(x={number:t,type:it.PhoneNumberTypes.Other})}if(g.phoneNumberForSendingSms=x,g.isMobilePesPickerActive=we.default.isPickerActive(),!t&&!this.state.isMobilePesPickerActive&&g.isMobilePesPickerActive&&""===this.state.selectedMediaBarItem){const e=we.default.getActiveTabType();e===Ve.TabType.Gif?g.selectedMediaBarItem=Se.MediaBarItemKeys.Gif:e===Ve.TabType.Moji&&(g.selectedMediaBarItem=Se.MediaBarItemKeys.Moji)}if(g.isMediaPreviewEnabled=ye.default.isMediaPreviewEnabled(e.conversationId),g.hasMediaPreviews=g.isMediaPreviewEnabled&&ve.default.getPreviews(e.conversationId).length>0,g.enableHandlingHTMLonPaste=o.enableHandlingHTMLonPaste,g.isSmsFailureScreenEnabled=g.enableOnewaySms&&v.callFailure.smsFailurePrompt.enabled,g.isRegularMemberInModeratedGroup=h&&(0,Pe.isRegularMemberInModeratedGroup)(h),t){qe.default.setDefault(),qe.default.commitNextFlowId();const t=this._rightControlsLayoutInfo(e,g);this._rightControlsWidthValue.setValue(t.width),this._rightControlsOpacityValue.setValue(t.opacity),this._checkForOutgoingSmsMessagesInConversation(g)}return g}_overflowMenuOrder(e,t){return e.useMobileUI?t.enableMagicBotToolboxInBinglessGroups&&!e.isMagicBotContainingConversation?t.overflowMenuOrder.filter((e=>e!==Se.MediaBarItemKeys.MagicBotToolbox)):t.overflowMenuOrder:[]}componentDidMount(){super.componentDidMount(),this._dataUpdateSubscription=c.dataUpdateReceivedEvent.subscribe((({forCustomContext:e,newContent:t})=>{e===this.props.conversationId&&this._consumeNewUserInput(t)})),m.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&(ce.default.addObserver(ce.LifecycleEventType.ON_EXIT,this._updateAndStoreDraftInputEntitiesFromContent),this._appStateSubscription=g.default.subscribeForChanges("MessageComposerV2",(e=>{if((!this._textInputRef||this._textInputRef.hasUncommittedChanges())&&n.includes([h.Types.AppActivationState.Inactive,h.Types.AppActivationState.Background],e)){const e=ct.default.newCauseId();oe.log(X.LogTraceArea.MessageComposer,"MessageComposer._appStateSubscription causeId: "+e),this._updateAndStoreDraftInputEntitiesFromContent(e).then((()=>{const e=E.default.getConversationsNumber();e>0&&oe.track(new W.DraftMessageAppExitWithDrafts(e))})).catch(n.noop)}}))),this._customKeyboardDidHideListener=d.default.onCustomKeyboardEvent(d.CustomKeyboardEvent.customKeyboardHidden,this._handleCustomKeyboardHiddenEvent),this._nativeKeyboardDidHideListener=d.default.on(d.VirtualKeyboardEvent.keyboardDidHide,this._resetSelectedKeyboard),h.Modal.isDisplayed()||!this.props.shouldAutoFocus||this.props.preventFocusOnMount||this.requestFocus(),this.state.overrideEditable&&this.setState({overrideEditable:void 0}),this._textInputRef&&this.setState({userInputIsEmpty:this._textInputRef.isEmpty(),hasUncommittedUserInput:this._textInputRef.hasUncommittedChanges(),equalsInitialContent:this._textInputRef.equalsInitialContent()});const e=this._getContext().componentVisibilityStatus;e&&(this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{!e&&d.default.isSupported()&&d.default.dismiss()}))),ae.default.addHandler(X.KeyboardShortcut.SendFile,this._showFilePicker),ae.default.addHandler(X.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),ae.default.addHandler(X.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),this._setAndroidCustomKeyboardHeight(),this._keyboardDismissRegistrationHandle=H.register(this),E.default.onInputEntitiesUpdatedEvent.subscribe(this._onPartiallyEnteredMsgStoreUpdated),this.state.enableMagicBot&&this.state.isMagicBotContainingConversation&&ft.default.fetchLocation(),this._contentSetSubscriptionToken=(0,bt.subscribeToContentSetEvent)(this._setContent)}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t);let s=!1;const i={};this.props.conversationId&&e.conversationId&&this.props.conversationId===e.conversationId||(s=!0,i.inputEntities=this.props.initialInputEntities||[],i.inputEntitiesDataVersion=this.state.inputEntitiesDataVersion+1,i.hasOutgoingSmsInConversation=!1,i.phoneNumberForSendingSms=void 0,this._checkForOutgoingSmsMessagesInConversation(this.state));let o=[];if(e.editedMessage&&e.editedMessage!==this.props.editedMessage){const t=N.decode(e.editedMessage);o=B.toEntities(t,{supportEmoticons:!0,supportLinkEntity:!0}),s=!0,i.phoneNumberForSendingSms=void 0}if(this.props.editedMessage&&!e.editedMessage&&(s=!0,i.phoneNumberForSendingSms=void 0,this.state.inputEntities.length&&this.state.inputEntities[0]instanceof se.EmoteEntity&&(o=[])),e.initialInputEntities&&e.initialInputEntities[0]){const t=this.props.initialInputEntities&&this.props.initialInputEntities[0]?this.props.initialInputEntities[0].text():"",s=e.initialInputEntities[0].text(),i=E.default.getSavedMessageInput(e.conversationId);s!==t?this._setInputEntityStateDownstream(e.initialInputEntities):i&&0===this.state.editableEntities.length&&this._setInputEntityStateDownstream(i.inputEntities)}s&&(this._setInputEntityStateDownstream(o),this.setState(i))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);let i=this.state.selectedMediaBarItem,o=this.state.showOverflowMenu;const n=this._hasQuotes()&&!(0,ne.default)(this.props.quotedMessages,e.quotedMessages),r=this.props.editedMessage&&!(0,ne.default)(this.props.editedMessage,e.editedMessage),a=this.state.hasMediaPreviews&&this.state.hasMediaPreviews!==t.hasMediaPreviews;(0,ne.default)(this.props.quotedMessages,e.quotedMessages)&&(0,ne.default)(this.props.editedMessage,e.editedMessage)&&(0,ne.default)(t.inputEntities,this.state.inputEntities)||this._saveMessage(this.state.inputEntities);const l=n||r||a;if(!e.inlineSearchModeActive&&this.props.inlineSearchModeActive&&(i=""),l&&this.requestFocus(),!t.enableOnewaySms&&this.state.enableOnewaySms&&this._checkForOutgoingSmsMessagesInConversation(this.state),this.state.userInputIsEmpty&&this.state.hasUncommittedUserInput){const e=E.default.getSavedMessageInput(this.props.conversationId);e&&e.type===He.SavedMessageType.None&&(oe.track(new W.DraftMessageDeleted(e.timestamp)),oe.log(X.LogTraceArea.MessageComposer,"MessageComposer.componentDidUpdate clear invalid draft."),E.default.clearMessageInput(this.props.conversationId))}if(this.state.useMobileUI){this.props.onShowOverflow&&this.state.showOverflowMenu!==t.showOverflowMenu&&this.props.onShowOverflow(!!this.state.showOverflowMenu,this._overflowActions(),this._onToggleOverflowMenu);const s=this._rightControlsLayoutInfo(this.props,this.state),i=this._rightControlsLayoutInfo(e,t);(0,ne.default)(s,i)||(this._rightControlsWidthValue.setValue(s.width),this._rightControlsOpacityValue.setValue(s.opacity),!s.isShowing&&this.state.showOverflowMenu&&(o=!1))}this.state.hasFocus&&x.default.hideCurrentCoachMark(),this.state.deviceOrientation===t.deviceOrientation&&this.props.headerHeightAndroid===e.headerHeightAndroid||(this._setAndroidCustomKeyboardHeight(),this._pesPickerPopup&&this._pesPickerPopup.hide()),e.conversationId!==this.props.conversationId&&this._updateAndStoreDraftInputEntitiesFromContent(ct.default.newCauseId()),this.setState({showOverflowMenu:o,selectedMediaBarItem:i})}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._dataUpdateSubscription&&(this._dataUpdateSubscription.unsubscribe(),this._dataUpdateSubscription=void 0),E.default.commit(this.props.conversationId),m.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&E.default.storeSavedMessage(this.props.conversationId),ce.default.removeObserver(ce.LifecycleEventType.ON_EXIT,this._updateAndStoreDraftInputEntitiesFromContent),this._customKeyboardDidHideListener&&(this._customKeyboardDidHideListener.remove(),this._customKeyboardDidHideListener=void 0),this._nativeKeyboardDidHideListener&&(this._nativeKeyboardDidHideListener.remove(),this._nativeKeyboardDidHideListener=void 0),this._customKeyboardSeenListener&&(this._customKeyboardSeenListener.remove(),this._customKeyboardSeenListener=void 0),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),this._contentSetSubscriptionToken&&(this._contentSetSubscriptionToken.unsubscribe(),this._contentSetSubscriptionToken=void 0),d.default.isSupported()&&d.default.dismiss(),this._textInputRef&&this._textInputRef.dismissKeyboard(),re.default.setCustomKeyboardFixHeightAndroid(0),ae.default.removeHandler(X.KeyboardShortcut.SendFile,this._showFilePicker),ae.default.removeHandler(X.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),ae.default.removeHandler(X.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),H.unregister(this._keyboardDismissRegistrationHandle),E.default.onInputEntitiesUpdatedEvent.unsubscribe(this._onPartiallyEnteredMsgStoreUpdated),f.default.disableTooltip(y.EngagementTooltipType.ExpressionPicker)}render(){const e=[Lt.composerInner,Lt.composerInnerMobile],t=[Lt.composerOuter],s=[ot.default.flexOne],i=[this._hasQuotes()?Lt.expandableAreaWithQuote:Lt.expandableArea];this.state.useMobileUI&&(s.push(Lt.messageComposerNewComposer),e.push(Lt.innerContainerNewComposer),t.push([Lt.innerWrapperNewComposer,this._themeStyles.buttonBackgroundColorStyle]),this.state.useCompactLayout&&(s.push(Lt.messageComposerNewComposerSmallDevice),t.push(Lt.innerWrapperNewComposerSmallDevice)),i.push(this._hasQuotes()?Lt.expandableAreaWithQuoteNewComposer:Lt.expandableAreaNewComposer)),t.push(h.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfaceSecondary},!1)),this._getContext().mode.isAccessible&&t.push(h.Styles.createViewStyle({borderWidth:1,borderColor:this._getContext().themeColors.dividerPrimary},!1));const a=this.state.deviceOrientation===r.DeviceOrientation.Landscape&&this.state.isUsingStackNavigationContext&&this.state.useMobileUI;a&&(i.push(Lt.expandableAreaLandscapeMaxHeight),e.push(Lt.composerInnerLandscape)),this.state.useMobileUI&&e.push(Lt.composerInnerMobileNewComposer);const l=this._sendControlEnabled(this.props,this.state,this._hasQuotes()),d=this._canCancelEdit(this.state,this.props.editedMessage);let c,u,g,m,S,f,y;if(a){if(this.state.useMobileUI){const e=l||d||this.state.disableHighBandwidthOperations||this.props.disableActionOnMessageComposer;c=this.state.isMediaPickerInRightControlsForMobile?n.compact([this._getMediaPickerButton(!0,e),this._getCameraButton(e),this._getLocationPickerButton(!0,e),this._getBingButton(e),this._getMagicBotToolboxButton(e)]):n.compact([this._getCameraButton(e),this._getMediaPickerButton(!0,e),this._getLocationPickerButton(!0,e),this._getBingButton(e),this._getMagicBotToolboxButton(e)]);const t=this._showRightControls(this.props,this.state,l);g=this._getOverflowMenuButton(t&&!this.state.isKeyboardSeen)}else c=this._getEmoticonPickerItem(!0);this.state.useMobileUI?m=this._getEmoticonPickerItem(!0):g=(0,o.jsx)(ee.default,{title:he.getString("MessageComposer.AttachementButton"),onPress:this._onMoreButtonClick,size:st.IconSize.size24,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:Lt.attachmentButton,icon:this.state.isCollapsableMediaBarExpanded?st.SkypeIcon.Cancel:st.SkypeIcon.Clippy,disabled:this.props.disableActionOnMessageComposer},"attachmentButton"),u=this._getMediaBar(!0,!this.state.useMobileUI&&this.state.isCollapsableMediaBarExpanded)}else{if(this.state.useMobileUI){m=this._getEmoticonPickerItem(!0);const e=l||d||!!this.state.phoneNumberForSendingSms||this.state.disableHighBandwidthOperations||this.props.disableActionOnMessageComposer;c=this.state.isMediaPickerInRightControlsForMobile?n.compact([this._getMediaPickerButton(!0,e),this._getCameraButton(e),this._getLocationPickerButton(!0,e),this._getBingButton(e),this._getMagicBotToolboxButton(e)]):n.compact([this._getCameraButton(e),this._getMediaPickerButton(!0,e),this._getLocationPickerButton(!0,e),this._getBingButton(e),this._getMagicBotToolboxButton(e)]);const t=this._showRightControls(this.props,this.state,l);g=this._getOverflowMenuButton(t&&!this.state.isKeyboardSeen)}u=this._getMediaBar(!0,!this.state.useMobileUI)}let v,C=st.SkypeIcon.Blank,_=!!this.props.disableActionOnMessageComposer,b=!1,T=!1;d?(S=he.getString("MessageComposer.CancelEditButtonTitle"),y=this._onCancelEditClick,C=st.SkypeIcon.Cancel):l?(S=he.getString(this.props.editedMessage?"MessageComposer.EditButtonTitle":"MessageComposer.SendButtonTitle"),y=this._onSendButtonClick,C=st.SkypeIcon.Send,_=this.state.userInputIsEmpty&&(!!this.state.phoneNumberForSendingSms||k.isS4BBridgeMri(this.props.conversationId)),b=this._getContext().isRTL,T=!0):this._showMicButton(this.props,this.state)&&(S=he.getString("MessageComposer.RecordButtonTitle"),f=O.default.combinedAccessibilityLabel(S,he.getString("MessageComposer.RecordButtonMobileAccessibilityHint")),y=this._onRecordButtonClick,C=st.SkypeIcon.Microphone);const M=this.props.preventAccessibilityFocus?h.Types.ImportantForAccessibility.NoHideDescendants:void 0;S?v=this.state.useMobileUI&&T?(0,o.jsx)(p.default,{size:this.state.useCompactLayout?p.ActionButtonSize.Tiny:p.ActionButtonSize.Small,title:S,accessibilityLabel:f||S,ref:this._onInputButtonRef,onPress:y,style:Lt.sendButton,icon:C,disabled:_,importantForAccessibility:M,flipIcon:b,hideBorder:!0,useSmallIcon:!0}):(0,o.jsx)(ee.default,{title:S,accessibilityLabel:f||S,ref:this._onInputButtonRef,onPress:y,size:st.IconSize.size24,color:l?this._themeColors.headerIconColor:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:Lt.micButton,hoverStyle:Lt.sendButtonHover,icon:C,disabled:_,importantForAccessibility:M,flipIcon:b}):this.state.useMobileUI||(v=(0,o.jsx)(h.View,{style:Lt.sendButton}));const I=this._renderQuote(),w=I&&this.state.useMobileUI?(0,o.jsx)(ee.default,{style:Lt.clearQuoteNewComposer,title:he.getString("MessageComposer.RemoveQuoteButtonTitle"),onPress:I.onClearQuoteHandler,size:st.IconSize.size16,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:st.SkypeIcon.Cancel,disabled:this.props.disableActionOnMessageComposer},"clearbutton"):void 0,P=m&&w?(0,o.jsxs)(h.View,Object.assign({style:Lt.rightIconContainer},{children:[w,m]}),"rightIconContainer"):m||w,A=[Lt.compositionArea];this.state.useMobileUI&&A.push(Lt.compositionAreaNewComposer);const x=[Lt.skypeMessageTextInput,this._themeStyles.primaryTextColorStyle];let R;x.push(a?Lt.expandableAreaLandscapeMaxHeight:this._hasQuotes()?Lt.expandableAreaWithQuoteNewComposer:Lt.expandableAreaNewComposer);const L=this.props.hideContentInMessageComposer?void 0:this._renderTextInput(i,x,!!I);if(this.state.useMobileUI){const s=[Lt.rightControlContainer,this._rightControlsWidthStyle];g||e.push(Lt.composerInnerMobileNewComposerExtraPadding),R=(0,o.jsxs)(h.View,Object.assign({style:e},{children:[g,(0,o.jsxs)(h.View,Object.assign({style:t},{children:[(0,o.jsxs)(h.View,Object.assign({style:A,importantForAccessibility:M},{children:[I&&I.component,this._renderEmoteAuthor(),L]})),P]})),(0,o.jsxs)(h.Animated.View,Object.assign({style:s},{children:[v,c]}))]}))}else R=(0,o.jsxs)(h.View,Object.assign({style:e},{children:[g,(0,o.jsxs)(h.View,Object.assign({style:A,importantForAccessibility:M},{children:[I&&I.component,L]})),w,m,(0,o.jsxs)(h.View,Object.assign({style:Lt.rightControlContainer},{children:[c,v]}))]}));return(0,o.jsxs)(h.View,Object.assign({style:ot.default.flexOne,importantForAccessibility:h.Types.ImportantForAccessibility.No},{children:[(0,o.jsxs)(h.View,Object.assign({style:s},{children:[this._renderSmsInfoLine(!0),(0,o.jsx)(h.Animated.View,Object.assign({style:this._inputAreaHeightStyle,ref:this._onAnimatedViewRef},{children:(0,o.jsx)(h.View,Object.assign({style:Lt.compositionAreaContainer,onLayout:this._onLayoutInputArea},{children:R}),"composition")}))]})),u]}))}dismissKeyboard(){this._textInputRef&&this._textInputRef.dismissKeyboard()}replaceText(e,t,s,i){if(this.requestFocus(),this._pendingMessageTextCompletionPromise){const e=Ce.getEditableEntityFromInputEntityAndConsiderAlternatives(i,this.state.emoticons);this._pendingMessageTextCompletionPromise.resolve(e),this._pendingMessageTextCompletionPromise=void 0}this._cancelAutoCompletionIfActive()}abortTextAutoCompletion(){this._cancelAutoCompletionIfActive()}isFocused(){return this.state.hasFocus}blurIfFocused(){this.state.hasFocus&&this.blur()}getInputEntities(){return this._textInputRef?this._textInputRef.getContent().then((e=>this._consumeNewUserInput(e)||this.state.inputEntities)):u.Resolved(this.state.inputEntities)}getOverflowConfig(){return this._overflowActions()}_getQuotedTextForSms(e,t){return t&&e!==t?n.join(t.map((e=>this._getQuoteEntity(e).textForSMS()))):""}_hasQuotes(){return!n.isEmpty(this.props.quotedMessages)}_checkForOutgoingSmsMessagesInConversation(e){e.enableOnewaySms&&w.didUserSendSmsInLast30Days(this.props.conversationId).then((e=>{this.isComponentMounted()&&this.setState({hasOutgoingSmsInConversation:e})}))}_setAndroidCustomKeyboardHeight(){}_overflowActions(){return{onItemSelected:this._onMediaBarItemSelected,onCustomAction:this._onHandleCustomAction,mediaBarItems:this._getOverflowItemDescriptors(),onFocus:this.requestFocus,onBlur:this.blur}}_renderQuote(){if(this.props.hideContentInMessageComposer)return;let e,t=n.first(this.props.quotedMessages),s=this._onClearQuoteButtonPress;if(!t&&this.props.editedMessage){const i=n.head(this.state.inputEntities);i instanceof se.QuoteEntity&&(t=this.props.editedMessage,e=ie.decodeFromInput([i],!1),s=this._onClearEditMessageQuote)}if(t){const i={onClearQuote:this.state.useMobileUI?void 0:s,linkStyle:Lt.linkStyle,disableActions:this.props.disableActionOnMessageComposer,renderOrigin:q.MessageRenderOrigin.MessageComposerCanvas,asQuoteInComposer:!0},n=[Lt.quoteArea],r=[this._themeStyles.primaryTextColorStyle],a=tt.default.font.uiDisplayBold;return this._useDarkTheme()&&(i.linkStyle=h.Styles.combine(Lt.linkStyle,this._themeStyles.linkTextColorStyle||this._themeStyles.primaryTextColorStyle)),i.quoteAttributeStyle=[Lt.quoteAttributeStyle,this._themeStyles.secondaryTextColorStyle],i.quoteSymbolStyle={size:st.IconSize.size20,color:this._themeColors.primaryTextColor},i.quotedTextStyle=Lt.quoteTextStyle,i.textOverrideStyle=r,i.atMentionMeOverrideStyle=a,i.atMentionStyle=a,i.showTranslatedMessage=!!this.props.showTranslatedMessage,this.state.useMobileUI&&n.push([Lt.quoteAreaNewComposer,this._themeStyles.secondaryDividerBorderStyle]),{component:(0,o.jsx)(h.View,Object.assign({style:n},{children:(0,o.jsx)(be.default,{message:t,preDecodedMessage:e,wrapInQuote:!e,options:i})})),onClearQuoteHandler:s}}}_getTextForSms(e){return`${this.state.quoteTextForSms}${ie.getRawText(e)}`}_renderSmsInfoLine(e=!1){const t=!!this.state.phoneNumberForSendingSms||!!this.state.hasOutgoingSmsInConversation||!!this.state.smsToggledOn;if(this.state.enableOnewaySms&&(!e||t))return(0,o.jsx)(Xe.default,{rawTextInput:this._getTextForSms(this.state.inputEntities),conversationId:this.props.conversationId,phoneNumbers:this.state.phoneNumbers,onPhoneNumberSelected:this._onPhoneNumberForSmsSelected,selectedPhoneNumber:this.state.phoneNumberForSendingSms,useMobileLayout:e,creditEntitlement:this.state.creditEntitlement,ref:this._onSMSInfoLineRef,disabled:this.props.disableActionOnMessageComposer,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isSmsFailureScreenEnabled:this.state.isSmsFailureScreenEnabled})}_isMojiCategoryEnabled(){return!this.props.hideMojiPickerIcon&&!this.state.phoneNumberForSendingSms}_isStickerCategoryEnabled(){return this.state.showStickerPicker&&!this.state.phoneNumberForSendingSms}_isGifCategoryEnabled(){return this.state.showGifPicker&&!this.state.phoneNumberForSendingSms}_renderEmoteAuthor(){const e=n.head(this.state.inputEntities);if(this.props.editedMessage&&e&&e instanceof se.EmoteEntity){const t=[Lt.emoteAuthor.text];t.push(this._themeStyles.primaryTextColorStyle);const s=e.fallbackText.trim();return(0,o.jsx)(h.View,{children:(0,o.jsx)(h.Text,Object.assign({style:t},{children:s+"…"}))})}}_getDefaultPlaceholderText(){return this.state.useMobileUI?this.state.phoneNumberForSendingSms?he.getString("MessageComposer.SmsMessagePlaceholderShortText"):he.getString("MessageComposer.MessagePlaceholderShortText"):this.state.phoneNumberForSendingSms?he.getString("MessageComposer.SmsMessagePlaceholderText"):he.getString("MessageComposer.MessagePlaceholderText")}_renderTextInput(e,t,s=!1){const i=this.state.selectedMediaBarItem===Se.MediaBarItemKeys.MediaPicker||this.state.selectedMediaBarItem===Se.MediaBarItemKeys.Moji||this.state.selectedMediaBarItem===Se.MediaBarItemKeys.Emoticon||this.state.selectedMediaBarItem===Se.MediaBarItemKeys.Gif||this.state.selectedMediaBarItem===Se.MediaBarItemKeys.Sticker?(0,o.jsx)(h.Button,{style:Lt.textInputFocusButton,onPress:this._onDismissMediaPicker,importantForAccessibility:h.Types.ImportantForAccessibility.No}):void 0;this._placeholderText=s?"":this._getDefaultPlaceholderText();let r=tt.default.controlFontSize.messageComposerMobile;this.state.messageStreamFontSize!==Me.MessageStreamFontSize.Normal&&(r=Te.getSize(r,this.state.messageStreamFontSize));const a=this.props.disableCopyPasteMedia;return(0,o.jsx)(h.View,Object.assign({style:Lt.inputArea},{children:(0,o.jsxs)(h.Animated.View,Object.assign({style:[...e]},{children:[(0,o.jsx)(c.default,{ref:this._onTextInputRef,importantForAccessibility:"yes",accessibilityLabel:this._getDefaultPlaceholderText(),style:t,agnosticContentBackgroundColor:this._useDarkTheme()?It:wt,atMentionBackgroundColor:this._useDarkTheme()?Ze.Color.blueOverlay30:Ze.Color.blueOverlay10,linkTextColor:this._themeColors.primaryTextColor,lineHeight:Math.round(1.2*r),maxLength:this.props.maxLength,onFocus:this._onFocus,onBlur:this._onBlur,onPaste:this._onPaste,placeholder:this._placeholderText,placeholderTextColor:this._themeColors.textSecondary,keyboardAppearance:this._useDarkTheme()?"dark":"default",useGraphicalEmoticons:!0,enterKeyOnExtKeyboardSendsMessage:this.state.sendMessageWithEnter,editable:void 0!==this.state.overrideEditable?this.state.overrideEditable:this.state.editable,initialContent:Ce.getEditableContentFromEditableEntities(this.state.editableEntities,this.state.inputEntitiesDataVersion),customContext:this.props.conversationId,intermediateContentUpdatedEventInterval:500,onNewContentCommitted:this._onUserInputCommitted,onNewContentAborted:this._onUserInputAborted,onEmptyIndicationChanged:this._onUserInputEmptyIndicationChanged,onUncommittedChangesIndicationChanged:this._onUserInputUncommittedChangesIndicationChanged,onEqualsInitialContentChanged:this._onEqualsInitialContentIndicationChanged,onEditLastMessageRequested:this._editLastMessage,onAccessibilityAnnouncementRequested:this._onAccessibilityAnnouncementRequested,onComposingActive:this._onUserInputActive,onComposingInactive:this._onUserInputInactive,onBackspacePressedAtHeadPosition:this._onUserInputBackspacePressedAtHeadPos,onEmoticonLoadCompleted:this._onEmoticonLoadCompleted,autoCompletionTriggers:Rt,onAutoCompletionRequested:this._onAutoCompletionRequested,onAutoCompletionRequestAborted:this._onAutoCompletionRequestAborted,onAutoCompletionNavigationKey:this._onAutoCompletionNavigationKey,delayedTriggersWaitTime:this.state.delayedTriggersWaitTime,convenienceSpaceReplacingChars:",.;:?!'",disableCopyPasteMedia:a,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,onPastingText:this._onPastingText,validateUrl:this._validateUrl,shouldDefaultPaste:n.constant(!0)}),i]}))}))}_getEmoticonPickerItem(e){if(this.props.hideEmoticonKeyboardIcon||this.state.useMobileUI&&this.props.hideMediaBar||k.isPhoneMri(this.props.conversationId)||k.isS4BBridgeMri(this.props.conversationId))return;const t=this.state.selectedMediaBarItem===Se.MediaBarItemKeys.Emoticon||this.state.useMobileUI&&this.state.selectedMediaBarItem===Se.MediaBarItemKeys.Moji||this.state.useMobileUI&&this.state.selectedMediaBarItem===Se.MediaBarItemKeys.Sticker||this.state.useMobileUI&&this.state.selectedMediaBarItem===Se.MediaBarItemKeys.Gif,s={id:Se.MediaBarItemKeys.Emoticon,key:"emoticonPicker",active:t,onActive:this._onPickerActive,isMobileInterface:e,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,onFocus:this.requestFocus,onBlur:this.blur,onInputChange:this.autoReplaceText,onEmoticonSelected:this._onEmoticonSelected,onEmoticonBackspacePress:this._handleEmoticonBackspacePress,pesPickerPopupRef:this._getPesPickerPopupRef,preventAccessibilityFocus:this.props.preventAccessibilityFocus,iconStyleOverride:this.state.useMobileUI?Lt.emoticonIconNewComposer:void 0,showCategorySwitcher:this.state.useMobileUI&&(this._isMojiCategoryEnabled()||this._isStickerCategoryEnabled()),disabled:this.props.disableActionOnMessageComposer,origin:me.MediaBarItemOrigin.MessageComposer,ref:e=>{f.default.setAnchor(y.EngagementTooltipType.ExpressionPicker,e)}},i=[Lt.emoticonIconWrapper];return this.state.useMobileUI?(0,o.jsx)(h.View,Object.assign({style:i},{children:(0,o.jsx)($.ExpressionPickerItem,Object.assign({},s))})):(0,o.jsx)($.ExpressionPickerItem,Object.assign({},s))}_keyboardHeight(){return this.state.isSmallDevice?void 0:(this.state.isUsingStackNavigationContext,this.state.pesPickerKeyboardHeight)}_mediaBarItemDescriptor(e){const t=this._keyboardHeight();switch(e){case Se.MediaBarItemKeys.Emoticon:const s={onEmoticonSelected:this._onEmoticonSelected,pesPickerPopupRef:this._getPesPickerPopupRef,showCategorySwitcher:this.state.useMobileUI&&(this._isMojiCategoryEnabled()||this._isStickerCategoryEnabled())};return{id:e,render:this._renderEmoticonPickerItem,getVirtualKeyboard:this._getEmoticonPickerKeyboard,propOverrides:s,keyboardHeight:t};case Se.MediaBarItemKeys.Moji:const i={onMojiSelected:this._onMojiSelected,showCategorySwitcher:this.state.useMobileUI&&(!this.props.hideEmoticonKeyboardIcon||this._isStickerCategoryEnabled())};return{id:e,render:this._renderMojiPickerItem,getVirtualKeyboard:ke.MojiPickerItem.getVirtualKeyboard,propOverrides:i,keyboardHeight:t};case Se.MediaBarItemKeys.Gif:const o={onGifSelected:this._onGifSelected,showCategorySwitcher:this.state.useMobileUI&&(!this.props.hideEmoticonKeyboardIcon||this._isGifCategoryEnabled())};return{id:e,render:this._renderGifPickerItem,getVirtualKeyboard:Z.GifPickerItem.getVirtualKeyboard,propOverrides:o,keyboardHeight:t};case Se.MediaBarItemKeys.Sticker:const n={onStickerSelected:this._onStickerSelected,showCategorySwitcher:this.state.useMobileUI&&(!this.props.hideEmoticonKeyboardIcon||this._isMojiCategoryEnabled())};return{id:e,render:this._renderStickerPickerItem,getVirtualKeyboard:Je.StickerPickerItem.getVirtualKeyboard,propOverrides:n,keyboardHeight:t};case Se.MediaBarItemKeys.Sms:return{id:e,render:this._renderSmsItem,getVirtualKeyboard:$e.SmsItem.getVirtualKeyboard};case Se.MediaBarItemKeys.MediaPicker:return{id:e,render:this._renderMediaPickerItem,getVirtualKeyboard:J.default.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case Se.MediaBarItemKeys.FilePicker:return{id:e,render:this._renderFilePickerItem,getVirtualKeyboard:J.default.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case Se.MediaBarItemKeys.Camera:return{id:e,render:this._renderCameraItem,getVirtualKeyboard:b.CameraItem.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case Se.MediaBarItemKeys.ScheduleCall:return{id:e,render:this._renderScheduleCallItem,getVirtualKeyboard:We.ScheduleCallItem.getVirtualKeyboard};case Se.MediaBarItemKeys.Poll:return{id:e,render:this._renderPollItem,getVirtualKeyboard:Ne.PollItem.getVirtualKeyboard};case Se.MediaBarItemKeys.Location:return{id:e,render:this._renderLocationPickerItem,getVirtualKeyboard:ue.default.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case Se.MediaBarItemKeys.Contact:return{id:e,render:this._renderContactPickerItem,getVirtualKeyboard:F.ContactPickerItem.getVirtualKeyboard};case Se.MediaBarItemKeys.Bing:const r={onBlur:this._onBlur};return{id:e,render:this._renderBingSearchItem,getVirtualKeyboard:v.BingSearchItem.getVirtualKeyboard,propOverrides:r};case Se.MediaBarItemKeys.MagicBotToolbox:return{id:e,render:this._renderMagicToolboxItem};case Se.MediaBarItemKeys.VideoMessage:return{id:e,render:this._renderVideoMessageItem,getVirtualKeyboard:ht.default.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case Se.MediaBarItemKeys.People:return{id:e,render:this._renderPeopleItem,getVirtualKeyboard:Fe.PeopleItem.getVirtualKeyboard};case Se.MediaBarItemKeys.SendCredit:return{id:e,render:this._renderSendCreditItem,getVirtualKeyboard:Ke.SendCreditItem.getVirtualKeyboard}}oe.warn(X.LogTraceArea.MessageComposer,"No media bar descriptor for "+e)}_canShowSmsIcon(){return!this.props.hideSmsIcon&&this.state.enableOnewaySms&&this.state.phoneNumbers.length>0&&this.state.useMobileUI}_getItemDescriptors(e,t=!1){const s=t&&this.state.disableHighBandwidthOperations,i=n.map(e,(e=>{switch(e){case Se.MediaBarItemKeys.Bing:return this.state.enableMagicBot&&this.state.isMagicBotContainingConversation&&!this.state.isMagicBotConversation?this._mediaBarItemDescriptor(e):void 0;case Se.MediaBarItemKeys.MagicBotToolbox:if(super._showMagicBotToolboxButton(this.state))return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.Camera:if(!this.props.hideMediaPickerIcon&&this.state.isCameraAvailable)return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.Sms:if(this._canShowSmsIcon())return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.Emoticon:if(!this.props.hideEmoticonKeyboardIcon)return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.Location:if(this.state.showLocationPicker&&!s&&(t||!this.state.useTabletUI||this.state.useTabletUI&&this.props.isInCall))return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.Contact:if(this.state.showContactPicker)return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.MediaPicker:if(this._shouldShowMediaItem(s,t))return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.FilePicker:if(!this.props.hideFilePicker&&!s)return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.Moji:if(this._isMojiCategoryEnabled())return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.Sticker:if(this._isStickerCategoryEnabled()&&(!t||!this.props.hideStickerPickerIcon))return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.Gif:if(this._isGifCategoryEnabled())return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.ScheduleCall:if(!this.props.hideScheduleCallIcon&&!s&&!this.state.isRegularMemberInModeratedGroup)return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.Poll:if(!this.props.hidePollIcon)return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.People:return this._mediaBarItemDescriptor(e);case Se.MediaBarItemKeys.VideoMessage:if(this.state.showVideoMessageIcon&&!s)return this._mediaBarItemDescriptor(e);break;case Se.MediaBarItemKeys.SendCredit:if(!this.props.hideSendCreditIcon&&!s)return this._mediaBarItemDescriptor(e)}}));return n.compact(i)}_shouldShowMediaItem(e,t=!1){return!this.props.hideMediaPickerIcon&&!e&&(t||!this.state.isMediaPickerInRightControlsForMobile||this.state.isSmallDevice||this.state.useTabletUI&&this.props.isInCall)}_getOverflowItemDescriptors(){const e=n.map(this.state.overflowMenuOrderForMobileUI,(e=>e));return this._getItemDescriptors(n.flatten(e))}_getMediaBarItemDescriptors(){return this.props.hideMediaBar||this._isMediabarDisabled()?[]:this._getItemDescriptors(this.state.mediaBarMenuOrder,!0)}_getOverflowMenuButton(e=!0){if(this.props.hideOverflowMenu||this.props.hideMediaBar||this.state.phoneNumberForSendingSms||k.isS4BBridgeMri(this.props.conversationId)||this.state.disableHighBandwidthOperations||!this.state.canUseAddins)return;const t=this.props.preventAccessibilityFocus?h.Types.ImportantForAccessibility.NoHideDescendants:void 0,s={size:this.state.useCompactLayout?p.ActionButtonSize.Tiny:p.ActionButtonSize.Small,title:he.getString("MessageComposerOverflow.AddTitle"),accessibilityLabel:he.getString("MessageComposerOverflow.AddTitle"),onPress:this._onComposerOverflowPress,style:Lt.overflowButton,icon:st.SkypeIcon.Plus,deselected:!e,hideBorder:!0,useSmallIcon:!0,disabled:this.props.disableActionOnMessageComposer,importantForAccessibility:t};return this.state.useMobileUI?(0,o.jsx)(A.default.ActionButton,Object.assign({},s,{positions:[R.PopupAnchorPositon.Top,R.PopupAnchorPositon.Right],coachMarkType:R.CoachMarkType.ChatPlus,anchorAccessibilityLabel:he.getString("MessageComposerOverflow.AddTitle"),onAnchorPress:this._onComposerOverflowCoachMarkPress,anchorRef:this._onOverflowButtonRef})):(0,o.jsx)(p.default,Object.assign({},s,{ref:this._onOverflowButtonRef}))}_getCameraButton(e=!1){const t=this.props.preventAccessibilityFocus?h.Types.ImportantForAccessibility.NoHideDescendants:void 0;return this._showCameraButton(this.props,this.state)?(0,o.jsx)(h.Animated.View,Object.assign({style:this._rightControlsOpacityStyle},{children:(0,o.jsx)(ee.default,{title:he.getString("MediaBar.CameraButtonTitle"),onPress:this._onLaunchCameraFromComposer,size:st.IconSize.size24,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:Lt.cameraButton,icon:st.SkypeIcon.Camera,disabled:e,importantForAccessibility:t})}),Se.MediaBarItemKeys.Camera):void 0}_getMediaPickerButton(e,t=!1){if(!this._showMediaPickerButton(this.props,this.state))return;const s=this.props.preventAccessibilityFocus?h.Types.ImportantForAccessibility.NoHideDescendants:void 0,i={id:Se.MediaBarItemKeys.MediaPicker,active:this.state.selectedMediaBarItem===Se.MediaBarItemKeys.MediaPicker,onActive:this._onPickerActive,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isMobileInterface:e,isMediaPickerInRightControlsForMobile:this.state.isMediaPickerInRightControlsForMobile,onFocus:this.requestFocus,onBlur:this.blur,onCustomAction:this._onHandleCustomAction,origin:me.MediaBarItemOrigin.MessageComposer};return(0,o.jsx)(h.Animated.View,Object.assign({style:this._rightControlsOpacityStyle,importantForAccessibility:s},{children:(0,o.jsx)(h.View,Object.assign({style:Lt.emoticonIconWrapper},{children:(0,o.jsx)(J.default,Object.assign({acceptedFileTypes:J.AcceptedFileTypes.MediaOnly},i))}))}),Se.MediaBarItemKeys.MediaPicker)}_getLocationPickerButton(e,t=!1){if(!this._showLocationButton(this.props,this.state))return;const s=this.props.preventAccessibilityFocus?h.Types.ImportantForAccessibility.NoHideDescendants:void 0,i={id:Se.MediaBarItemKeys.Location,active:this.state.selectedMediaBarItem===Se.MediaBarItemKeys.Location,onActive:this._onPickerActive,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isMobileInterface:e,onFocus:this.requestFocus,onBlur:this.blur,onCustomAction:this._onHandleCustomAction,origin:me.MediaBarItemOrigin.MessageComposer};return(0,o.jsx)(h.Animated.View,Object.assign({style:this._rightControlsOpacityStyle,importantForAccessibility:s},{children:(0,o.jsx)(ue.default,Object.assign({},i))}),Se.MediaBarItemKeys.Location)}_getBingButton(e=!1){if(!this._showBingButtonMobileUI(this.state))return;const t=this.props.preventAccessibilityFocus?h.Types.ImportantForAccessibility.NoHideDescendants:void 0,s={id:Se.MediaBarItemKeys.Bing,active:this.state.selectedMediaBarItem===Se.MediaBarItemKeys.Bing,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isMobileInterface:!0,onBlur:this.requestFocus,onCustomAction:this._onHandleCustomAction,origin:me.MediaBarItemOrigin.MessageComposer,iconStyleOverride:Lt.cameraButton};return(0,o.jsx)(h.Animated.View,Object.assign({style:this._rightControlsOpacityStyle,importantForAccessibility:t},{children:(0,o.jsx)(v.BingSearchItem,Object.assign({},s))}),Se.MediaBarItemKeys.Bing)}_getMagicBotToolboxButton(e=!1){if(!this._showMagicBotToolboxButtonMobileUI(this.state))return;const t=this.props.preventAccessibilityFocus?h.Types.ImportantForAccessibility.NoHideDescendants:void 0,s={id:Se.MediaBarItemKeys.MagicBotToolbox,active:this.state.selectedMediaBarItem===Se.MediaBarItemKeys.MagicBotToolbox,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isMobileInterface:!0,onBlur:this.requestFocus,onCustomAction:this._onHandleCustomAction,origin:me.MediaBarItemOrigin.MessageComposer,iconStyleOverride:Lt.cameraButton};return(0,o.jsx)(h.Animated.View,Object.assign({style:this._rightControlsOpacityStyle,importantForAccessibility:t},{children:(0,o.jsx)(Mt.MagicBotToolboxItem,Object.assign({},s,{ref:s.ref}))}),Se.MediaBarItemKeys.MagicBotToolbox)}_getMediaBar(e,t=!0){const s=this._getMediaBarItemDescriptors();if(s.length>0){const i=!h.Modal.isDisplayed()&&!!this._textInputRef&&!e&&!this.state.hasFocus&&this.state.isCollapsableMediaBarExpanded;return(0,o.jsx)(pe.MediaBar,{ref:this._onMediaBarRef,activeId:this.state.selectedMediaBarItem,itemDescriptors:s,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isMobileInterface:e,showIcons:t,onInputChange:this.autoReplaceText,onItemSelected:this._onMediaBarItemSelected,onFocus:this.requestFocus,onBlur:this.blur,onCustomKeyboardClose:this._onCustomKeyboardClose,onBackspace:this._handleEmoticonBackspacePress,onCustomAction:this._onHandleCustomAction,preventAccessibilityFocus:this.props.preventAccessibilityFocus,onMessageSent:this.props.onMessageSent,onCloseSearch:this._onCancelPesSearch,clearEditInChatsComposer:this.props.onClearEdit,autoFocusFirstItem:i,disableActionOnMediaBar:this.props.disableActionOnMessageComposer,focusCustomKeyboardWhenShown:!0,announceForAccessibilityForMessageSent:this._announceForAccessibilityForMessageSent,customKeyboardHeight:this.state.pesPickerKeyboardHeight})}}_animateInputAreaToTargetHeight(){this._inputAreaAnimation||this._inputAreaTargetHeight===this._inputAreaHeight||(this._inputAreaHeight=this._inputAreaTargetHeight,this._inputAreaAnimation=Ye.default.easeOut({value:this._inputAreaHeightValue,toValue:this._inputAreaTargetHeight}),this._inputAreaAnimation.start((()=>{this._inputAreaAnimation=void 0,this.isComponentMounted()&&this._animateInputAreaToTargetHeight()})))}_toggleSmsSending(e,t){this._onPhoneNumberForSmsSelected(t),this.isComponentMounted()&&this.setState({smsToggledOn:e})}_rightControlsLayoutInfo(e,t){const s=this._showRightControls(e,t,void 0);let i,o=0;return s&&!this._showMicButton(e,t)||(o=1),s&&(this._showCameraButton(e,t)&&o++,this._showMediaPickerButton(e,t)&&o++,this._showLocationButton(e,t)&&o++,this._showBingButtonMobileUI(t)&&o++,this._showMagicBotToolboxButtonMobileUI(t)&&o++),i=o?s?kt*o:kt+(t.useCompactLayout?0:5):5,{width:i,opacity:s?1:0,isShowing:s}}_showMicButton(e,t){return!(!e.onRecording||t.phoneNumberForSendingSms||t.disableHighBandwidthOperations||k.isS4BBridgeMri(e.conversationId))}_showCameraButton(e,t){return t.isCameraAvailable&&this._showCameraOrMediaButtonCommon(e,t)}_showMediaPickerButton(e,t){return t.showAdditionalMediaBarItems&&(!t.isUsingStackNavigationContext||t.isMediaPickerInRightControlsForMobile)&&this._showCameraOrMediaButtonCommon(e,t)}_showCameraOrMediaButtonCommon(e,t){return!(e.hideMediaPickerIcon||e.hideMediaBar||t.phoneNumberForSendingSms||t.disableHighBandwidthOperations||k.isS4BBridgeMri(e.conversationId))}_showLocationButton(e,t){return!t.isUsingStackNavigationContext&&t.showAdditionalMediaBarItems&&!e.hideLocationPickerIcon&&!e.hideMediaBar&&!t.phoneNumberForSendingSms&&!t.disableHighBandwidthOperations&&!k.isS4BBridgeMri(e.conversationId)&&!et.default.isFireOS()}_showBingButtonMobileUI(e){return super._showBingButton(e)&&e.useMobileUI&&(e.isMagicBotContainingConversation||e.isOneOnOneConversation||!e.enableMagicBotToolboxInBinglessGroups||!e.enableMagicBotToolboxGroup)}_showMagicBotToolboxButtonMobileUI(e){return this._showMagicBotToolboxButton(e)&&e.useMobileUI&&!e.isMagicBotContainingConversation&&e.enableMagicBotToolboxInBinglessGroups}_showRightControls(e,t,s){const i=n.isUndefined(s)?this._sendControlEnabled(e,t,!!e.quotedMessages):s,o=this._canCancelEdit(t,e.editedMessage);return!i&&!o&&!t.phoneNumberForSendingSms}_sendControlEnabled(e,t,s){return e.showSendControlWhenEmpty||!t.userInputIsEmpty||s||!!t.phoneNumberForSendingSms||t.hasMediaPreviews||k.isS4BBridgeMri(e.conversationId)}_canCancelEdit(e,t){if(!t)return!1;const s=N.decode(t),i=B.toEntities(s,{supportEmoticons:!0,supportLinkEntity:!0});return i.length>0?i.length===e.inputEntities.length&&i.every(((t,s)=>i[s].text()===e.inputEntities[s].text())):!e.hasUncommittedUserInput||e.userInputIsEmpty||e.equalsInitialContent}_wasRegexTriggered(e){return n.includes(Rt.instantTriggers,e)||n.includes(Rt.delayedTriggers,e)}_cancelAutoCompletionIfActive(){this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this.props.onInputTextChanged("",!0)}_setInputEntityStateUpstream(e){const t=Ce.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this.isComponentMounted()&&(oe.log(X.LogTraceArea.MessageComposer,"MessageComposer._setInputEntityStateUpstream set inputEntities.length: "+(null==e?void 0:e.length)),this.setState({inputEntities:e,editableEntities:t}))}_setInputEntityStateDownstream(e,t){const s=this.state.inputEntitiesDataVersion+1,i=Ce.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this._textInputRef&&this._textInputRef.setContent(Ce.getEditableContentFromEditableEntities(i,s)),this.isComponentMounted()&&(oe.log(X.LogTraceArea.MessageComposer,"MessageComposer._setInputEntityStateDownstream inputEntities.length: "+(null==e?void 0:e.length)),this.setState({inputEntities:e,inputEntitiesDataVersion:s,editableEntities:i},t))}_pastePreviewCompletionHelper(e){L.default.dismissModal("PastePreviewModal",this._getRootViewId()),oe.track(new Ie.MessageComposerTelemetry(this.props.conversationId,e,Ie.MessageComposerAction.Paste))}_sendFileWithDimensions(e){const t=at.default.getFileUrl(e);l.default.getImageSize(t).then((t=>{if(t&&(e.dimensions=t),this.state.isMediaPreviewEnabled)return ye.default.addPreviews([e],this.props.conversationId,X.PostSource.MessageComposer);const s={name:ze.ScenarioName.SendPicture};Ue.default.postUpload([this.props.conversationId],e,X.PostSource.MessageComposer,!1,{scenarioInfo:s},this._getRootViewType())}))}_preventSendingSMSMessage(e){return!(!(1===e.length&&e[0]instanceof se.SmsEntity&&this._smsInfoLineRef)||this._smsInfoLineRef.canSendSMS())&&(this.state.isSmsFailureScreenEnabled?Re.default.navigateToSmsFailurePrompt(this.props.conversationId,this.state.phoneNumberForSendingSms?this.state.phoneNumberForSendingSms.number:"",!1):C.default.open(this._getRootViewId()),!0)}_getQuoteEntity(e){const t=z.default.getDisplayName(e.creator,!0),s=D.quoteMessage(e,t);return new se.QuoteEntity(s,t,e,this.props.quotesTriggerType)}_sendMessage(e){return i.__awaiter(this,void 0,void 0,(function*(){if(oe.log(X.LogTraceArea.MessageComposer,"sendMessage isPostingMessage: "+this._isPostingMessage),this._isPostingMessage)return;if(!(0,yt.canSendMessageToMagicBot)(e,this.state.isMagicBotConversation))return void this.dismissKeyboard();this._isPostingMessage=!0;const t=ct.default.newCauseId();oe.log(X.LogTraceArea.MessageComposer,"sendMessage causeId: "+t);let s=[];if(this.props.quotedMessages&&this.props.quotedMessages.map((e=>s.push(this._getQuoteEntity(e)))),e.length>0&&(s=s.concat(e)),this.state.enableOnewaySms&&this.state.phoneNumberForSendingSms&&!this.state.userInputIsEmpty&&(s=[new se.SmsEntity(this._getTextForSms(e),this.state.phoneNumberForSendingSms.number)],this._preventSendingSMSMessage(s)))return oe.log(X.LogTraceArea.MessageComposer,"sendMessage Message prevented from being send."),void(this._isPostingMessage=!1);try{const e=(0,yt.isMagicBotMentioned)(s);e&&this.state.enableMagicBotGroupAutoAdd&&!this.state.isOneOnOneConversation&&!this.state.isMagicBotContainingConversation&&(yield vt.default.serviceAddMemberToThread(this.props.conversationId,(0,pt.getMagicBotId)(),Ct.AddMemberToThreadSource.BotAutoAdd,!(0,Pe.isModerated)(this.state.conversation)),oe.log(X.LogTraceArea.MessageComposer,"sendMessage Magic bot auto-added to conversation because being mentioned."),oe.track(new gt.MagicBotAutoAddedByMention));const i=e&&this.state.enableMagicBot&&this.state.enableMagicBotOneOnOneAutoAdd&&this.state.isOneOnOneConversation&&!this.state.isMagicBotConversation;if(this._needsContext(e)&&!(0,_t.isUserInputEmptyOrHasWhitespaceOnly)(s)){const e=yield(0,St.getContext)(!this.state.isOneOnOneConversation||i,this.state.conversation);s.push(e)}this._sendOneOnOneMagicBotMessageIfNeeded(i,s),yield ye.default.sendPreviews(this.props.conversationId,t);try{const e={conversationId:this.props.conversationId,editedMessage:this.props.editedMessage,inputEntities:s,onMessageSent:this.props.onMessageSent,phoneNumberForSendingSms:this.state.phoneNumberForSendingSms,smsInfoLineRef:this._smsInfoLineRef,textInputRef:this._textInputRef,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,messageComposerPastedContentType:this.state.messageComposerPastedContentType};if(yield Bt._sendTextMessage(e)){if(this._handleAfterPostMessage(e.conversationId),oe.log(X.LogTraceArea.MessageComposer,"sendMessage Message sent."),e.smsInfoLineRef){const t=e.smsInfoLineRef.getTelemetryEvent();t&&(this.state.phoneNumberForSendingSms?t.setSmsWasSent(!0):t.setSkypeMessageSent(!0))}}else oe.log(X.LogTraceArea.MessageComposer,"sendMessage Message not sent.")}finally{this._isPostingMessage=!1}}finally{this.state.hasFocus||this.requestFocus()}}))}_needsContext(e){return this.state.enableMagicBot&&mt.default.getConsent()&&(e||this.state.isMagicBotConversation)}static _sendTextMessage(e){if((0,_t.isUserInputEmptyOrHasWhitespaceOnly)(e.inputEntities))return e.inputEntities.length?oe.log(X.LogTraceArea.MessageComposer,"sendMessage User pressed enter with only whitespace message content."):oe.log(X.LogTraceArea.MessageComposer,"sendMessage User pressed enter without entering any message content."),u.Resolved(!1);if(e.onMessageSent(e.inputEntities,_e.convertPastedTextTypeToTelemetry(e.messageComposerPastedContentType))){const t=E.default.getSavedMessageInput(e.conversationId);if(t){const s=e.textInputRef&&!e.textInputRef.equalsInitialContent()||!1;oe.track(new W.DraftMessageWasSent(s,t.timestamp))}const s=e.editedMessage?he.getString("MessageComposer.MessageEditedLabel"):he.getString("MessageComposer.MessageSentLabel");return Bt._announceForAccessibility(s),Ge.default.isMobileScreenReaderEnabled()?rt.default.sleep(1e3).then((()=>!0)):u.Resolved(!0)}return u.Resolved(!1)}static _announceForAccessibility(e){Ge.default.maybeAnnounceForAccessibility(e,0)}_handleAfterPostMessage(e){if(E.default.getSavedMessageInput(e)&&(0,V.default)().fakeConversationTime(e,Date.now()),oe.log(X.LogTraceArea.MessageComposer,"MessageComposer._handleAfterPostMessage"),E.default.clearMessageInput(e),this.props.conversationId===e){this.state.hasFocus||this.requestFocus(),this.setTextInputAccessibilityFocus(),this._setInputEntityStateDownstream([]),this._cancelAutoCompletionIfActive(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:"",inputEntities:[],editableEntities:[]}),this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.onClearEdit&&this.props.onClearEdit();const e=this._getRootViewId();ge.MediaBarItem.dismissPopup(e),j.default.close(e)}this._isPostingMessage=!1}_isMediabarDisabled(){return k.isS4BBridgeMri(this.props.conversationId)||!!this.state.isConversationWithPhoneNumber}}t.default=Bt},771540:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(785893),n=s(496486),r=s(809206),a=s(274840),l=s(709133),d=s(54569),c=s(516778),h=s(397691),u=s(4736),p=s(300060),g=s(889391),m=s(180843),S=s(968894),f=s(296082),y=s(739119),v=s(578723),C=s(94655),_=s(16625),b=s(148649),T=s(47447),M=s(905531),I=s(951267),w=s(871908),P=s(351077),k=s(671830),A=s(496418),x=s(898278),R=s(154549),O=s(208223),L=s(881632),F=s(417677),B=s(820770),D=s(539549),E=s(986374),V=s(884817),N=s(843368),U=s(110547),j=s(437490),H=s(952262),z=s(292069),W=s(330757),G=s(82433),K=s(904604),q=s(746096),Q=s(301014),X=s(529245),$=s(761317),J=s(753559),Y=s(480469),Z=s(130387),ee=s(913944),te=s(766649),se=s(497174),ie=s(923944),oe=s(436237),ne=s(861253),re=s(172490),ae=s(547126),le=s(915877),de=s(20022),ce=s(733754),he=s(88824),ue=s(80372),pe=s(624897),ge=s(238915),me=s(609748),Se=s(318743),fe=s(264862),ye=s(206286),ve=s(603088),Ce=s(947193),_e=s(961428),be=s(422929),Te=s(371639),Me=s(106658),Ie=s(844972),we=s(45532),Pe=s(89808),ke=s(178735),Ae=s(104735),xe=s(330124),Re=s(833348),Oe=s(339159),Le=s(269399),Fe=s(879348),Be=s(63584),De=s(699070),Ee=s(785207),Ve=s(29130),Ne=s(781571),Ue=s(857946),je=s(415963),He=s(720360),ze=s(886045),We=s(537589),Ge=s(615301),Ke=s(149769),qe=s(807914),Qe=s(563080),Xe=s(795960),$e=s(450795),Je=s(581760),Ye=s(640363),Ze=s(311010),et=s(711828),tt=s(478262),st=s(938185),it=s(680837),ot=s(626712),nt=s(273096),rt=s(172758),at=s(853374),lt=s(56503),dt=s(23474),ct=s(866559),ht=s(846116),ut=s(752869),pt=s(69576),gt=s(534256),mt=s(559669),St=s(768696),ft=s(422801),yt=s(61375),vt=s(372210),Ct=s(939848),_t=s(558387),bt=s(849434),Tt=s(9613),Mt=s(84839),It=s(988140),wt=Je.Color.darkMessageComposerContentBackground,Pt=Je.Color.gray400Overlay10,kt=d.unicodeLetterRegex,At={instantTriggers:[`^(@[${kt}-]{0,16} ?[${kt}-]{0,16})$`,`.*\\W(@[${kt}]{0,16} ?[${kt}]{0,16})$`,"^(/\\w{0,16})$",".*(\\([a-zA-Z:]{2,16})$",".*(\\([a-zA-Z:]{2,16}:[1-6]?)$"],delayedTriggers:[".*\\b([A-Z][A-Za-z]{2,31})$"]};var xt;!function(e){e[e.OverflowButton=0]="OverflowButton",e[e.OverflowButtonCoachMark=1]="OverflowButtonCoachMark"}(xt||(xt={}));const Rt=(0,le.lazyProperties)({composerArea:()=>c.Styles.createViewStyle({flex:1,flexDirection:"row"}),compositionAreaContainer:()=>c.Styles.createViewStyle({position:"absolute",flexDirection:"row",left:0,right:0,bottom:0}),compositionArea:()=>c.Styles.createViewStyle({flex:1,justifyContent:"center"}),inputArea:()=>c.Styles.createViewStyle({flexDirection:"row"}),expandableArea:()=>c.Styles.createViewStyle({flex:1,maxHeight:96,backgroundColor:Je.Color.transparent}),expandableAreaWithQuote:()=>c.Styles.createViewStyle({flex:1,maxHeight:48}),composerInner:()=>c.Styles.createViewStyle({flex:1,flexDirection:"row",marginVertical:12,marginHorizontal:16}),rightControlContainer:()=>c.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),quoteArea:()=>c.Styles.createViewStyle({flex:1,paddingTop:6,paddingLeft:12}),multiQuoteArea:()=>c.Styles.createViewStyle({flex:1,flexDirection:"row",marginTop:15,marginBottom:0,marginLeft:20,marginRight:20}),multiQuoteAreaMessages:()=>c.Styles.createViewStyle({flex:1,flexDirection:"row",maxHeight:126,paddingBottom:15,borderBottomWidth:1,borderStyle:"solid"}),multiQuoteAreaMessage:()=>c.Styles.createViewStyle({marginBottom:12}),multiQuoteAreaLastMessage:()=>c.Styles.createViewStyle({marginBottom:0}),multiQuoteAreaClearButton:()=>c.Styles.createButtonStyle({alignSelf:"flex-start"}),quoteTextStyle:()=>c.Styles.createTextStyle({fontStyle:"italic"}),quoteAttributeStyle:()=>c.Styles.createTextStyle({fontSize:Ze.default.controlFontSize.messageStreamQuoteAttributeDesktop,marginTop:0,marginBottom:0}),sendButton:()=>c.Styles.createViewStyle({height:50}),actionButtonWithBackground:()=>c.Styles.createViewStyle({height:40,width:40,borderRadius:20}),actionButtonVerticalCenter:()=>c.Styles.createViewStyle({alignSelf:"center"}),skypeMessageTextInput:()=>c.Styles.createTextStyle({font:Ze.default.font.uiDisplayRegular,fontSize:Ze.default.controlFontSize.messageComposerDesktop,minHeight:23,backgroundColor:Je.Color.transparent}),textInputFocusButton:()=>c.Styles.createButtonStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:Je.Color.transparent}),linkStyle:()=>c.Styles.createTextStyle({fontSize:Ze.default.controlFontSize.body,lineHeight:18,color:Je.Color.gray400,fontFamily:Ze.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),emoteAuthor:()=>(0,le.lazyProperties)({text:()=>c.Styles.createTextStyle({fontSize:Ze.default.controlFontSize.messageComposerDesktop,marginTop:7,fontStyle:"italic"}),textDesktop:()=>c.Styles.createTextStyle({marginTop:5,marginBottom:3})}),desktopOverrides:()=>(0,le.lazyProperties)({messageComposer:()=>c.Styles.createViewStyle({minHeight:48,justifyContent:"center"}),messageComposerAllRoundCorners:()=>c.Styles.createViewStyle({borderRadius:24}),messageComposerTopFlatCorners:()=>c.Styles.createViewStyle({borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:24,borderBottomRightRadius:24}),compositionAreaContainer:()=>c.Styles.createViewStyle({flexDirection:"column"}),quoteArea:()=>c.Styles.createViewStyle({flex:1,paddingTop:15,paddingBottom:0,paddingLeft:20,paddingRight:20}),compositionAreaNoPesPicker:()=>c.Styles.createViewStyle({paddingLeft:21}),compositionAreaNoRichTextEditor:()=>c.Styles.createViewStyle({paddingRight:21}),expandableArea:()=>c.Styles.createViewStyle({maxHeight:175}),expandableAreaWithQuote:()=>c.Styles.createViewStyle({maxHeight:133}),expandableAreaSmallView:()=>c.Styles.createViewStyle({maxHeight:133}),expandableAreaWithQuoteSmallView:()=>c.Styles.createViewStyle({maxHeight:91}),composerInner:()=>c.Styles.createViewStyle({marginVertical:5,marginHorizontal:2}),rightControlContainer:()=>c.Styles.createViewStyle({minHeight:48,marginLeft:4,alignItems:"flex-end"}),composerInnerIconWrapper:()=>c.Styles.createViewStyle({alignSelf:"flex-end",height:40,justifyContent:"center"})}),mediaBarWrapper:()=>c.Styles.createViewStyle({flexDirection:"row",height:50,alignItems:"center"})});let Ot=45;class Lt extends _t.MessageComposerBase{constructor(){super(...arguments),this._isPostingMessage=!1,this._gotInitialInputAreaHeight=!1,this._inputAreaHeight=Ot,this._inputAreaTargetHeight=this._inputAreaHeight,this._inputAreaHeightValue=new c.Animated.Value(this._inputAreaHeight),this._inputAreaHeightStyle=c.Styles.createAnimatedViewStyle({height:this._inputAreaHeightValue}),this._onEmoticonSelected=e=>{this.autoReplaceText(e.text(),"Emoticon",e)},this._onMojiSelected=e=>{this.props.conversationId&&(Ee.default.postMessageFromInput(this.props.conversationId,q.PostSource.MediaPicker,[e],P.MessageTypes.Media_FlikMsg,{name:je.ScenarioName.SendMoji},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onStickerSelected=e=>{this.props.conversationId&&(Ee.default.postMessageFromInput(this.props.conversationId,q.PostSource.MediaPicker,[e],P.MessageTypes.RichText,{name:je.ScenarioName.SendSticker},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onGifSelected=e=>{this.props.conversationId&&(Ee.default.postMessageFromInput(this.props.conversationId,q.PostSource.MediaPicker,[e],P.MessageTypes.RichText,{name:je.ScenarioName.SendGif},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._closePesPickerAndFocusTextInput=()=>{this._closeUnifiedPesPickerDesktop(),this.setTextInputAccessibilityFocus()},this._onSMSInfoLineRef=e=>{this._smsInfoLineRef=e||void 0},this._onPhoneNumberForSmsSelected=e=>{const t=at.default.newCauseId();oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._onPhoneNumberForSmsSelected causeId: "+t),this.state.twoWaySMSCapable?e&&Ae.default.navigateToConversation({convId:k.getMriFromPhoneNumber(e),origin:q.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t}):Ae.default.navigateToConversation({convId:this.props.conversationId,origin:q.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t})},this._onVisibleSelectionRect=e=>{},this._shouldDefaultPaste=e=>!(this.state.pasteAsQuotePreference&&be.default.hasContent(e)),this._saveMessage=e=>{if(e&&e.length>0||this._hasQuotes()||this.props.editedMessage){let t,s=Ue.SavedMessageType.None;this.props.editedMessage?(t=[this.props.editedMessage],s=Ue.SavedMessageType.Edited):this.props.quotedMessages&&(t=this.props.quotedMessages,s=Ue.SavedMessageType.Quoted),B.default.saveMessageInput(this.props.conversationId,{messages:t,type:s,inputEntities:e,inputEntitiesDataVersion:this.state.inputEntitiesDataVersion,timestamp:Date.now()})}else oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._saveMessage clearMessageInput."),B.default.clearMessageInput(this.props.conversationId)},this._onCancelPesSearch=(e,t)=>{e&&(oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._onCancelPesSearch clearInputText."),B.default.clearMessageInput(this.props.conversationId));const s=B.default.getSavedMessageInput(this.props.conversationId);(!s||s&&n.isEmpty(s.messages))&&(this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit());const i=s?s.inputEntities:[];this._setInputEntityStateDownstream(i,t),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._onClearEditMessageQuote=()=>{const e=n.head(this.state.inputEntities);this._textInputRef&&e instanceof se.QuoteEntity&&this._textInputRef.getContent().then((e=>{const t=this._consumeNewUserInput(e)||this.state.inputEntities;this._setInputEntityStateDownstream(t.slice(1,t.length))}))},this._renderEmoticonPickerItem=e=>(0,o.jsx)(W.EmoticonPickerItem,Object.assign({},e)),this._renderMojiPickerItem=e=>(0,o.jsx)(we.MojiPickerItem,Object.assign({},e)),this._renderGifPickerItem=e=>(0,o.jsx)(Z.GifPickerItem,Object.assign({},e)),this._renderStickerPickerItem=e=>(0,o.jsx)(Xe.StickerPickerItem,Object.assign({},e)),this._renderSmsItem=e=>(0,o.jsx)(Qe.SmsItem,Object.assign({},e)),this._renderMediaPickerItem=e=>(0,o.jsx)(X.default,Object.assign({acceptedFileTypes:X.AcceptedFileTypes.MediaOnly},e)),this._renderFilePickerItem=e=>(0,o.jsx)(X.default,Object.assign({acceptedFileTypes:X.AcceptedFileTypes.All},e)),this._renderCameraItem=e=>(0,o.jsx)(b.CameraItem,Object.assign({},e)),this._renderScheduleCallItem=e=>(0,o.jsx)(He.ScheduleCallItem,Object.assign({},e)),this._renderPollItem=e=>(0,o.jsx)(De.PollItem,Object.assign({},e)),this._renderLocationPickerItem=e=>(0,o.jsx)(he.default,Object.assign({},e)),this._renderContactPickerItem=e=>(0,o.jsx)(O.ContactPickerItem,Object.assign({},e)),this._renderBingSearchItem=e=>(0,o.jsx)(v.BingSearchItem,Object.assign({},e)),this._renderMagicToolboxItem=e=>(0,o.jsx)(It.MagicBotToolboxItem,Object.assign({},e,{ref:e.ref})),this._renderVideoMessageItem=e=>(0,o.jsx)(lt.default,Object.assign({},e)),this._renderSkypeClipsRecordItem=e=>(0,o.jsx)(Tt.default,Object.assign({},e)),this._renderPeopleItem=e=>(0,o.jsx)(Oe.PeopleItem,Object.assign({},e)),this._renderAudioMessageItem=e=>Ye.default.isEdgeShoreline()?(0,o.jsx)(f.AudioMessageItem,Object.assign({},e,{onPress:this.props.onRecording})):(0,o.jsx)(f.AudioMessageItem,Object.assign({},e)),this._renderSendCreditItem=e=>(0,o.jsx)(We.SendCreditItem,Object.assign({},e)),this._onMediaBarRef=e=>{this._mediaBarRef=e||void 0},this._renderPesPickerPopup=()=>(0,o.jsx)(Fe.PesPickerPopup,{ref:this._onPesPickerPopupRef,renderMobileInterface:!1}),this._onPesPickerPopupRef=e=>{this._pesPickerPopup=e||void 0},this._getPesPickerPopupRef=()=>this._pesPickerPopup,this._onCustomKeyboardClose=()=>{this._pesPickerPopup&&this._pesPickerPopup.hide()},this._onLayoutInputArea=e=>{const t=Math.ceil(e.height);this._gotInitialInputAreaHeight?(this._inputAreaTargetHeight=t,this._animateInputAreaToTargetHeight()):(this._inputAreaTargetHeight=t,this._inputAreaHeight=t,this._inputAreaHeightValue.setValue(t),Ot=t,this._gotInitialInputAreaHeight=!0)},this._onHandleCustomAction=(e,t)=>{switch(e){case tt.MediaBarCustomAction.LaunchCamera:this.props.onLaunchCamera&&this.props.onLaunchCamera();break;case tt.MediaBarCustomAction.LaunchEmoticon:Be.EmoticonPickerTelemetry.startOpenScenario(),Be.EmoticonPickerTelemetry.open(),this._onPickerActive(me.MediaBarItemKeys.Emoticon);break;case tt.MediaBarCustomAction.LaunchMoji:Be.MojiPickerTelemetry.open(),this._onPickerActive(me.MediaBarItemKeys.Moji);break;case tt.MediaBarCustomAction.LaunchSticker:Be.StickerPickerTelemetry.open(),this._onPickerActive(me.MediaBarItemKeys.Sticker);break;case tt.MediaBarCustomAction.LaunchGif:Be.GifPickerTelemetry.open(),this._onPickerActive(me.MediaBarItemKeys.Gif);break;case tt.MediaBarCustomAction.MentionBing:this._mentionMagicBot();break;default:oe.log(q.LogTraceArea.MessageComposer,"_onHandleCustomAction unhandled action: "+e)}},this._onComposerOverflowPress=()=>{oe.track(new Se.MediaBarItemPressed(xt[xt.OverflowButton],!0,this.props.conversationId,ge.MediaBarItemOrigin.MessageComposer))},this._onDismissMediaPicker=()=>{l.default.showNativeKeyboard(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._mentionMagicBot=()=>{const e=(0,ht.getMagicBotId)(),t=H.default.getDisplayableProfile(e),s={type:d.EditableEntityType.AtMention,displayText:t.getDisplayName(),userMri:(0,ht.getMagicBotId)(),shortName:t.getShortName(),displayName:t.getDisplayName()};this._textInputRef&&this._textInputRef.insertContent(s),oe.track(new ut.MagicBotMentionedByClick)},this._onUnifiedPesPickerDesktopPress=()=>{this.state.isShowingUnifiedPesPickerDesktop||(Be.EmoticonPickerTelemetry.startOpenScenario(),N.default.open(this._getRootViewId()))},this._closeUnifiedPesPickerDesktop=()=>{this.state.isShowingUnifiedPesPickerDesktop&&N.default.close(this._getRootViewId())},this._onPickerActive=e=>{this._textInputRef&&this._textInputRef.getContent().then(this._consumeNewUserInput),this.isComponentMounted()&&this.setState({selectedMediaBarItem:e})},this._onEditorActive=()=>{this._textInputRef&&this._textInputRef.getContent().then(this._consumeNewUserInput),this.isComponentMounted()&&Ne.default.setVisibility(this.props.conversationId,!1)},this._onMediaBarItemSelected=e=>{this.state.selectedMediaBarItem!==e&&(this.isComponentMounted()&&this.setState({selectedMediaBarItem:e===me.MediaBarItemKeys.Sms?"":e}),this.props.onMediaItemSelected&&this.props.onMediaItemSelected()),e===me.MediaBarItemKeys.Sms&&(1===this.state.phoneNumbers.length?this._toggleSmsSending(!0,this.state.phoneNumbers[0]):Ke.default.showNumberSelectionPopup((()=>this._smsInfoLineRef),this._getRootViewId(),this.props.conversationId,this.state.phoneNumbers,!1).then((e=>{this._toggleSmsSending(!0,e)})).catch(n.noop))},this._onCancelEditClick=e=>{e.stopPropagation(),Lt._announceForAccessibility(ce.getString("MessageComposer.MessageEditingCanceledLabel")),this._handleAfterPostMessage(this.props.conversationId)},this._onSendButtonClick=e=>{e.stopPropagation(),this._textInputRef&&this._textInputRef.getContent().then((e=>{const t=this._consumeNewUserInput(e);t?this._sendMessage(t):this._setInputEntityStateDownstream(this.state.inputEntities)}))},this._onInputButtonRef=e=>{this._inputButton=e||void 0},this.insertSearchResult=(e,t,s)=>{Lt._announceForAccessibility(e),this.autoReplaceText(e,t,s)},this.autoReplaceText=(e,t,s)=>{if(c.UserInterface.isNavigatingWithKeyboard()&&this.state.selectedMediaBarItem&&pe.MediaBarItem.dismissPopup(this._getRootViewId()),"Emoticon"===t){const e=ce.getString("MessageComposer.AccessibilityAnnouncement_EmoticonInserted");Lt._announceForAccessibility(e)}else Lt._announceForAccessibility(e);if(this._textInputRef){const e=Ce.getEditableEntityFromInputEntityAndConsiderAlternatives(s,this.state.emoticons);this._textInputRef.insertContent(e),this._textInputRef.requestFocus(),this._textInputRef.getContent().then((e=>{this.isComponentMounted()&&this._consumeNewUserInput(e)}))}},this._onAutoCompletionRequested=(e,t)=>(this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this._wasRegexTriggered(t)&&(this._pendingMessageTextCompletionPromise=h.Defer(),this.props.onInputTextChanged(e,!1)),this._pendingMessageTextCompletionPromise?this._pendingMessageTextCompletionPromise.promise():h.Rejected()),this._onAutoCompletionRequestAborted=()=>{this._cancelAutoCompletionIfActive()},this._onAutoCompletionNavigationKey=e=>{if(this.props.onKeyPress&&this.props.onKeyPress(e),e.keyCode===ae.default.ESCAPE)this._cancelAutoCompletionIfActive()},this._onUserInputActive=()=>{nt.default.setComposingState(!0,this.props.conversationId)},this._onUserInputInactive=()=>{nt.default.setComposingState(!1,this.props.conversationId)},this._onUserInputCommitted=e=>{const t=this._consumeNewUserInput(e);t&&(nt.default.setComposingState(!1,this.props.conversationId),this._sendMessage(t))},this._onPastingText=e=>{this.isComponentMounted()&&this.setState({messageComposerPastedContentType:e})},this._setComposingStateInactiveDebounced=n.debounce((()=>{nt.default.setComposingState(!1,this.props.conversationId)}),300,{leading:!0,trailing:!0}),this._onUserInputAborted=()=>{this.state.selectedMediaBarItem===me.MediaBarItemKeys.Emoticon||this.state.isShowingUnifiedPesPickerDesktop||(this._setComposingStateInactiveDebounced(),this._hasQuotes()&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.props.editedMessage&&(this.props.onClearEdit&&this.props.onClearEdit(),oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._onUserInputAborted."),B.default.clearMessageInput(this.props.conversationId)),this._cancelAutoCompletionIfActive())},this._onUserInputEmptyIndicationChanged=e=>{this.isComponentMounted()&&this.setState({userInputIsEmpty:e}),this.props.onNativeComposerMessageEmptyStateChanged&&this.props.onNativeComposerMessageEmptyStateChanged()},this._onUserInputUncommittedChangesIndicationChanged=e=>{this.isComponentMounted()&&this.setState({hasUncommittedUserInput:e})},this._onEqualsInitialContentIndicationChanged=e=>{this.isComponentMounted()&&this.setState({equalsInitialContent:e})},this._onUserInputBackspacePressedAtHeadPos=()=>{this._hasQuotes()&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.state.userInputIsEmpty&&this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit()},this._onAccessibilityAnnouncementRequested=e=>{if(e===d.AccessibilityAnnouncement.NewLineAdded)c.Accessibility.announceForAccessibility(ce.getString("MessageComposer.AccessibilityAnnouncement_NewlineAdded"))},this._onEmoticonLoadCompleted=e=>{oe.track(new Le.ComposerEmoticonLoaded(e,xe.default.isUsingStackNavigationContext()))},this._onPartiallyEnteredMsgStoreUpdated=e=>{if(e===this.props.conversationId){const t=B.default.getSavedMessageInput(e);t&&t.inputEntitiesDataVersion===this.state.inputEntitiesDataVersion&&this._setInputEntityStateUpstream(t.inputEntities)}},this._consumeNewUserInput=e=>{let t;return e.downStreamDataVersion===this.state.inputEntitiesDataVersion&&(t=ie.applyEditableContentToInputEntities(e,this.state.inputEntities),this._setInputEntityStateUpstream(t)),t},this._onCompositionAreaPress=e=>{this.state.hasFocus||this._hasQuotes()||this.requestFocus()},this._onCompositionAreaKeyPress=e=>{e.keyCode===ae.default.ESCAPE&&this.isComponentMounted()&&this._moreButton&&this._moreButton.requestFocus()},this._onFocus=()=>{const e={hasFocus:!0};this.isComponentMounted()&&this.setState(e)},this._onBlur=()=>{const e={hasFocus:!1};this.isComponentMounted()&&this.setState(e),this.props.onBlur&&this.props.onBlur()},this._onPaste=e=>{if(!this._shouldDefaultPaste(e.nativeEvent)&&this.props.onKeyboardPaste)return void this.props.onKeyboardPaste(e);const t=e.nativeEvent;this.props.disableCopyPasteMedia||n.isEmpty((0,Y.get)(t,["clipboardData","items"]))||n.some(t.clipboardData.items,(e=>"text/plain"===e.type))||(n.each(t.clipboardData.items,(t=>{if("image/png"===t.type){e.stopPropagation(),e.preventDefault();const s=new FileReader;let i=t.getAsFile();if(i instanceof e.nativeEvent.target.ownerDocument.defaultView.Blob){const e="image_"+(new Date).toISOString().replace(/[:\.\-]/g,"_")+".png",t=n.attempt((t=>new File([t],e,{type:t.type})),i);n.isError(t)||(i=t),s.onload=()=>{if(i&&i.size>0){const e={file:i,extension:J.default.extractFileExtension(i.name)};this._sendFileWithDimensions(e)}},s.readAsDataURL(i)}}})),Lt._announceForAccessibility(ce.getString("MessageComposer.FilesSentLabel")))},this._getQuoteEntity=e=>{const t=H.default.getDisplayName(e.creator,!0),s=F.quoteMessage(e,t);return new se.QuoteEntity(s,t,e,this.props.quotesTriggerType)},this._announceForAccessibilityForMessageSent=()=>{n.defer((()=>{this.isComponentMounted()&&Lt._announceForAccessibility(ce.getString("MessageComposer.MessageSentLabel"))}))},this._handleEmoticonBackspacePress=e=>{this._textInputRef&&this._textInputRef.notifyBackspacePressedExternally()},this._showFilePicker=(e,t)=>{if(t!==this._getRootViewId())return!1;if(this.state.editable&&T.UICapabilities.desktopFilePickerSupported()&&!k.isPhoneMri(this.props.conversationId)&&!k.isS4BBridgeMri(this.props.conversationId)){const t=e=>{const t=J.default.extractFileExtension(e.file.name),s=this._getRootViewType();if(J.default.isVideoExtension(t)){const t={name:je.ScenarioName.SendVideo};Ee.default.postVideoWithThumbnail([this.props.conversationId],e,q.PostSource.MediaPicker,!1,t,void 0,void 0,void 0,s).then((()=>{Lt._announceForAccessibility(ce.getString("MessageComposer.FileSentLabel"))}))}else if(J.default.isImageExtension(t)){const t={name:je.ScenarioName.SendPicture};Ee.default.postUpload([this.props.conversationId],e,q.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{Lt._announceForAccessibility(ce.getString("MessageComposer.FileSentLabel"))}))}else{const t={name:je.ScenarioName.SendFile};Ee.default.postUpload([this.props.conversationId],e,q.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{Lt._announceForAccessibility(ce.getString("MessageComposer.FileSentLabel"))}))}this.requestFocus()};$.FilePickerUtils.isDocumentPickerSupported()?$.FilePickerUtils.showDocumentPicker(t,this._getRootViewId()):$.FilePickerUtils.showMultiFilesPicker(t,Se.FilePickerOrigin.MessageComposer,void 0,this._getRootViewId(),e)}return!0},this._editLastMessageKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this._editLastMessage(),!0),this._focusKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this.requestFocus(),!0),this._editLastMessage=()=>{this.props.onEditLastMessage&&this.props.onEditLastMessage()},this._updateAndStoreDraftInputEntitiesFromContent=e=>(oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._updateAndStoreDraftInputEntitiesFromContent causeId: "+e),this._textInputRef?this._textInputRef.getContent().then((e=>B.default.updateInputEntitiesFromContent(this.props.conversationId,e).commit(this.props.conversationId).storeSavedMessage(this.props.conversationId))):h.Resolved()),this._validateUrl=e=>ot.default.isUrlValid(e),this._setContent=(e,t)=>{oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._setContent, inputEntities length: "+(null==e?void 0:e.length)),this._setInputEntityStateDownstream(e,(()=>{t&&this.requestFocus()}))},this.requestFocus=()=>{this._textInputRef&&(r.BrowserEnvironment.isEngineEdgeHTML()&&document.activeElement&&document.activeElement.blur(),this._textInputRef.requestFocus())},this.blur=()=>{this._textInputRef&&this._textInputRef.blur()},this.focusVideoButton=()=>{const e=this._mediaBarRef?this._mediaBarRef.getItemById(me.MediaBarItemKeys.VideoMessage):void 0;e&&e.requestFocus()},this.focusSendButton=()=>{this._inputButton&&this._inputButton.requestFocus()},this.focusOverflowButton=()=>{},this.setTextInputAccessibilityFocus=()=>{this._textInputRef&&(this.state.isSmallOrTinyScreen||this._textInputRef.setAccessibilityFocus(),this.props.explicitAccessibilityAnnoucement&&c.Accessibility.announceForAccessibility(this._placeholderText))}}_buildState(e,t){var s,i;const o=super._buildState(e,t),a=ke.default.getUserPreferencesLocal(),l=g.default.getS4LMessagingFeatures(),c=(0,D.default)().getConversation(e.conversationId),{enableMagicBot:h,enableMagicBotGroupAutoAdd:u,enableMagicBotOneOnOneAutoAdd:p}=l,m=(0,ht.isMagicBotConversation)(e.conversationId),S=(0,ht.isMagicBotContainingConversation)(c),f=Object.assign(Object.assign({},o),{enableMagicBot:h,enableMagicBotGroupAutoAdd:u,enableMagicBotOneOnOneAutoAdd:p,isMagicBotConversation:m,isMagicBotContainingConversation:S,conversation:c}),v=this.props,C=this._getRootViewId(),b=g.default.getS4LCommerceFeatures();t&&(f.inputEntities=e.initialInputEntities||[],f.inputEntitiesDataVersion=e.initialInputEntitiesDataVersion||0,f.hasFocus=!1,f.selectedMediaBarItem="",f.offsetTop=0,f.userInputIsEmpty=n.isEmpty(f.inputEntities),f.hasUncommittedUserInput=!1,f.equalsInitialContent=!0,f.currentNumberOfIconsInMediaBar=this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav||Ye.default.isEdgeShoreline()?1:3,f.pesPickerKeyboardHeight=276,f.messageComposerPastedContentType=null!==(s=e.pastedTextType)&&void 0!==s?s:d.PastedTextType.None);const w=k.isOneOnOneConversation(e.conversationId);f.delayedTriggersWaitTime=l.composerAutoCompletionDelay,f.mediaBarMenuOrder=this._mediaBarMenuOrder(!!f.isMagicBotContainingConversation||w,l.enableMagicBotToolboxInBinglessGroups,l.enableSkypeClipsRecord&&-1===l.mediaBarMenuOrder.indexOf(me.MediaBarItemKeys.SkypeClipsRecord)?[...l.mediaBarMenuOrder,me.MediaBarItemKeys.SkypeClipsRecord]:l.mediaBarMenuOrder),f.isConversationWithPhoneNumber=k.isConversationWithPhoneNumber(e.conversationId),f.enableHandlingHTMLonPaste=l.enableHandlingHTMLonPaste,f.isSmallOrTinyScreen=Ve.default.isSmallOrTinyScreenSize(C)||r.EnvironmentInfo.isMobile(),f.editable=!Re.default.isAnimationPending()&&!e.disableActionOnMessageComposer,f.isSmallHeightView=Ve.default.isSmallDesktopHeightView(C),f.viewportWidth=e.availableWidth||Ve.default.getWidth(C),f.showAdditionalMediaBarItems=f.viewportWidth>=360,f.gradientColors=Pe.default.getGradientColors(),f.emoticons=G.default.getEmoticons(),f.isShowingUnifiedPesPickerDesktop=!e.hideMediaBar&&N.default.shouldShow(C),f.messageStreamFontSize=ke.default.getMessageStreamFontSize(),f.canUseAddins=M.default.addins().canUseAddins,f.editableEntities=Ce.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(f.inputEntities||[],f.emoticons);const{selectedTabType:P,searchQuery:A}=N.default.getPickerSearchProps();f.selectedTabType=P,f.searchQuery=A,f.isEncryptedThreadThread=k.isEncryptedThread(e.conversationId),f.showLocationPicker=!e.hideLocationPickerIcon&&l.enableLocationSharingOnDesktopAndWeb&&!Ye.default.isFireOS(),f.showContactPicker=!e.hideContactPickerIcon&&M.default.contacts().canInvitePeople,f.showVideoMessageIcon=!e.hideVideoMessageIcon&&!f.isEncryptedThreadThread&&g.default.isDesktopVIMEnabled()&&(V.default.isAVDeviceReady()||r.BrowserEnvironment.isChrome()),f.phoneNumbers=e.otherPartyMri&&rt.default.getFullUserProfileByMri(e.otherPartyMri).phones||[];const x=k.isPhoneMri(e.conversationId);f.creditEntitlement=K.default.getCreditEntitlement(),f.isOneOnOneConversation=w,f.enableOnewaySms=(x||b.smsPromo.unpaidUserEnabled||!!y.getPositiveCreditBalance(f.creditEntitlement)||K.default.userHasSubscriptions())&&(x||w)&&f.phoneNumbers.length>0&&!e.editedMessage&&!e.hideSmsIcon&&!k.isEncryptedThread(e.conversationId),f.quoteTextForSms=this._getQuotedTextForSms(v.quotedMessages,e.quotedMessages),f.disableHighBandwidthOperations=te.default.isUsingGogoNetwork(),f.isCameraAvailable=T.UICapabilities.cameraSupported()&&I.default.isCameraAvailable(),f.sendMessageWithEnter=a.sendMessageWithEnter,f.pasteAsQuotePreference=a.pasteAsQuotesEnabled,f.twoWaySMSCapable=!!(null===(i=_.default.getCallerIdPrimaryNumber())||void 0===i?void 0:i.smsCapable);let R=e.phoneNumberForSendingSms;if(!R&&k.isPhoneMri(e.conversationId)){const t=k.getPhoneNumberFromMri(e.conversationId);t&&(R={number:t,type:tt.PhoneNumberTypes.Other})}return f.phoneNumberForSendingSms=R,f.isMediaPreviewEnabled=ye.default.isMediaPreviewEnabled(e.conversationId),f.hasMediaPreviews=f.isMediaPreviewEnabled&&ve.default.getPreviews(e.conversationId).length>0,f.isSmsFailureScreenEnabled=f.enableOnewaySms&&b.callFailure.smsFailurePrompt.enabled,f.isRegularMemberInModeratedGroup=c&&(0,Ie.isRegularMemberInModeratedGroup)(c),f.richTextEditorVisible=Ne.default.panelOpened(e.conversationId),f.isToneRewritePanelOpen=bt.default.isPanelOpen(),t&&(Ge.default.setDefault(),Ge.default.commitNextFlowId(),this._checkForOutgoingSmsMessagesInConversation(f)),f}componentDidMount(){super.componentDidMount(),this._dataUpdateSubscription=d.dataUpdateReceivedEvent.subscribe((({forCustomContext:e,newContent:t})=>{e===this.props.conversationId&&this._consumeNewUserInput(t)})),g.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&(de.default.addObserver(de.LifecycleEventType.ON_EXIT,this._updateAndStoreDraftInputEntitiesFromContent),this._appStateSubscription=p.default.subscribeForChanges("MessageComposerWithPopup",(e=>{if((!this._textInputRef||this._textInputRef.hasUncommittedChanges())&&n.includes([c.Types.AppActivationState.Inactive,c.Types.AppActivationState.Background],e)){const e=at.default.newCauseId();oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._appStateSubscription causeId: "+e),this._updateAndStoreDraftInputEntitiesFromContent(e).then((()=>{const e=B.default.getConversationsNumber();e>0&&oe.track(new z.DraftMessageAppExitWithDrafts(e))})).catch(n.noop)}}))),c.Modal.isDisplayed()||!this._shouldAutoFocusInput()&&!this.props.shouldAutoFocus||this.props.preventFocusOnMount||this.requestFocus(),this.state.overrideEditable&&this.setState({overrideEditable:void 0}),this._textInputRef&&this.setState({userInputIsEmpty:this._textInputRef.isEmpty(),hasUncommittedUserInput:this._textInputRef.hasUncommittedChanges(),equalsInitialContent:this._textInputRef.equalsInitialContent()});const e=this._getContext().componentVisibilityStatus;e&&(this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{!e&&l.default.isSupported()&&l.default.dismiss()}))),re.default.addHandler(q.KeyboardShortcut.SendFile,this._showFilePicker),re.default.addHandler(q.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),re.default.addHandler(q.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),this._keyboardDismissRegistrationHandle=j.register(this),B.default.onInputEntitiesUpdatedEvent.subscribe(this._onPartiallyEnteredMsgStoreUpdated),this.state.enableMagicBot&&this.state.isMagicBotContainingConversation&&mt.default.fetchLocation(),this._contentSetSubscriptionToken=(0,Ct.subscribeToContentSetEvent)(this._setContent)}_checkForOutgoingSmsMessagesInConversation(e){e.enableOnewaySms&&w.didUserSendSmsInLast30Days(this.props.conversationId).then((e=>{this.isComponentMounted()&&this.setState({hasOutgoingSmsInConversation:e})}))}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t);let s=!1;const i={};this.props.conversationId&&e.conversationId&&this.props.conversationId===e.conversationId||(s=!0,i.inputEntities=this.props.initialInputEntities||[],i.inputEntitiesDataVersion=this.state.inputEntitiesDataVersion+1,i.hasOutgoingSmsInConversation=!1,i.phoneNumberForSendingSms=void 0,this._checkForOutgoingSmsMessagesInConversation(this.state));let o=[];if(e.initialInputEntities&&e.initialInputEntities!==this.props.initialInputEntities&&(s=!0,o=e.initialInputEntities),e.editedMessage&&e.editedMessage!==this.props.editedMessage){const t=E.decode(e.editedMessage);o=L.toEntities(t,{supportEmoticons:!0,supportLinkEntity:!0}),s=!0,i.phoneNumberForSendingSms=void 0}this.props.editedMessage&&!e.editedMessage&&(s=!0,i.phoneNumberForSendingSms=void 0,this.state.inputEntities.length&&this.state.inputEntities[0]instanceof se.EmoteEntity&&(o=[])),s&&(this._setInputEntityStateDownstream(o),this.setState(i))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);let i=this.state.selectedMediaBarItem,o=!1;e&&e.conversationId&&this.props.conversationId&&e.conversationId===this.props.conversationId||(o=this._shouldAutoFocusInput());const n=this._hasQuotes()&&!(0,ne.default)(this.props.quotedMessages,e.quotedMessages),r=this.props.editedMessage&&!(0,ne.default)(this.props.editedMessage,e.editedMessage),a=this.state.hasMediaPreviews&&this.state.hasMediaPreviews!==t.hasMediaPreviews;if((0,ne.default)(this.props.quotedMessages,e.quotedMessages)&&(0,ne.default)(this.props.editedMessage,e.editedMessage)&&(0,ne.default)(t.inputEntities,this.state.inputEntities)||this._saveMessage(this.state.inputEntities),o=n||r||a,!e.inlineSearchModeActive&&this.props.inlineSearchModeActive&&(i=""),o&&this.requestFocus(),!t.enableOnewaySms&&this.state.enableOnewaySms&&this._checkForOutgoingSmsMessagesInConversation(this.state),this.state.userInputIsEmpty&&this.state.hasUncommittedUserInput){const e=B.default.getSavedMessageInput(this.props.conversationId);e&&e.type===Ue.SavedMessageType.None&&(oe.track(new z.DraftMessageDeleted(e.timestamp)),oe.log(q.LogTraceArea.MessageComposer,"MessageComposer.componentDidUpdate clear invalid draft."),B.default.clearMessageInput(this.props.conversationId))}this.state.hasFocus&&!this.state.userInputIsEmpty&&A.default.hideCurrentCoachMark(),this.setState({selectedMediaBarItem:i}),e.conversationId!==this.props.conversationId&&this._updateAndStoreDraftInputEntitiesFromContent(at.default.newCauseId()),!t.isShowingUnifiedPesPickerDesktop&&this.state.isShowingUnifiedPesPickerDesktop&&bt.default.closePanel(),!t.isToneRewritePanelOpen&&this.state.isToneRewritePanelOpen&&N.default.close(this._getRootViewId())}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._dataUpdateSubscription&&(this._dataUpdateSubscription.unsubscribe(),this._dataUpdateSubscription=void 0),B.default.commit(this.props.conversationId),g.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&B.default.storeSavedMessage(this.props.conversationId),de.default.removeObserver(de.LifecycleEventType.ON_EXIT,this._updateAndStoreDraftInputEntitiesFromContent),this._customKeyboardDidHideListener&&(this._customKeyboardDidHideListener.remove(),this._customKeyboardDidHideListener=void 0),this._nativeKeyboardDidHideListener&&(this._nativeKeyboardDidHideListener.remove(),this._nativeKeyboardDidHideListener=void 0),this._customKeyboardSeenListener&&(this._customKeyboardSeenListener.remove(),this._customKeyboardSeenListener=void 0),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),this._contentSetSubscriptionToken&&(this._contentSetSubscriptionToken.unsubscribe(),this._contentSetSubscriptionToken=void 0),l.default.isSupported()&&l.default.dismiss(),this._textInputRef&&this._textInputRef.dismissKeyboard(),re.default.removeHandler(q.KeyboardShortcut.SendFile,this._showFilePicker),re.default.removeHandler(q.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),re.default.removeHandler(q.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),j.unregister(this._keyboardDismissRegistrationHandle),B.default.onInputEntitiesUpdatedEvent.unsubscribe(this._onPartiallyEnteredMsgStoreUpdated),m.default.disableTooltip(S.EngagementTooltipType.ExpressionPicker)}_overflowActions(){return{onItemSelected:this._onMediaBarItemSelected,onCustomAction:this._onHandleCustomAction,mediaBarItems:this._getOverflowItemDescriptors(),onFocus:this.requestFocus,onBlur:this.blur}}render(){const e=[Rt.composerInner,Rt.desktopOverrides.composerInner];let t;const s=[Rt.skypeMessageTextInput,this._themeStyles.primaryTextColorStyle];this.state.isSmallHeightView?(t=this.props.quotedMessages?[Rt.expandableAreaWithQuote,Rt.desktopOverrides.expandableAreaWithQuoteSmallView]:[Rt.expandableArea,Rt.desktopOverrides.expandableAreaSmallView],s.push(this.props.quotedMessages?Rt.desktopOverrides.expandableAreaWithQuoteSmallView:Rt.desktopOverrides.expandableAreaSmallView)):(t=this.props.quotedMessages?[Rt.expandableAreaWithQuote,Rt.desktopOverrides.expandableAreaWithQuote]:[Rt.expandableArea,Rt.desktopOverrides.expandableArea],s.push(this.props.quotedMessages?Rt.desktopOverrides.expandableAreaWithQuote:Rt.desktopOverrides.expandableArea));const i=[it.default.flexOne,Rt.desktopOverrides.messageComposer];if(this._themeStyles.messageComposerBackgroundStyle&&i.push(this._themeStyles.messageComposerBackgroundStyle),this.state.isShowingUnifiedPesPickerDesktop||this.state.isToneRewritePanelOpen?i.push(Rt.desktopOverrides.messageComposerTopFlatCorners):i.push(Rt.desktopOverrides.messageComposerAllRoundCorners),i.push(c.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfaceSecondary},!1)),this._getContext().mode.isAccessible&&i.push(c.Styles.createViewStyle({borderWidth:1,borderColor:this._getContext().themeColors.dividerPrimary},!1)),this.state.messageStreamFontSize!==Me.MessageStreamFontSize.Normal){const e=Te.getStyleFromStyle(s,this.state.messageStreamFontSize);s.push(e)}const n=!!this.props.quotedMessages&&this.props.quotedMessages.length>0&&!this.props.hideContentInMessageComposer,r=this.props.hideContentInMessageComposer?void 0:this._renderTextInput(t,s,n),a=this._getRightIcon()||this._getMediaBar(!0),l=[Rt.rightControlContainer,Rt.desktopOverrides.rightControlContainer],d=this._getEmoticonPickerItem(),h=this._getContext().isPresentedByMobileStackNavigator?void 0:this._getRichtextEditorItem(),u=[Rt.compositionArea,d?void 0:Rt.desktopOverrides.compositionAreaNoPesPicker,h?void 0:Rt.desktopOverrides.compositionAreaNoRichTextEditor],p=(0,o.jsxs)(c.View,Object.assign({style:u},{children:[this._renderEmoteAuthor(),r]})),g=(0,o.jsx)(c.View,Object.assign({style:i,importantForAccessibility:c.Types.ImportantForAccessibility.No,onPress:this._onCompositionAreaPress,onKeyPress:this._onCompositionAreaKeyPress,disableTouchOpacityAnimation:!0},{children:(0,o.jsx)(c.Animated.View,Object.assign({style:this._inputAreaHeightStyle},{children:(0,o.jsxs)(c.View,Object.assign({style:[Rt.compositionAreaContainer,Rt.desktopOverrides.compositionAreaContainer],onLayout:this._onLayoutInputArea},{children:[this._renderRichtextEditor(),n&&this._renderQuoteArea(),this._getMediaPreviewPanel(),(0,o.jsxs)(c.View,Object.assign({style:e},{children:[d,p,h]}))]}),"composition")}))}));return(0,o.jsxs)(c.View,Object.assign({style:Rt.composerArea},{children:[(0,o.jsxs)(c.View,Object.assign({style:it.default.flexOne},{children:[this._renderSmsInfoLine(),this._renderToneRewritePanel(),this._renderPesPicker(),g]})),(0,o.jsx)(c.View,Object.assign({style:l},{children:a}))]}))}dismissKeyboard(){this._textInputRef&&this._textInputRef.dismissKeyboard()}_getQuotedTextForSms(e,t){return t&&e!==t?n.join(t.map((e=>this._getQuoteEntity(e).textForSMS()))):""}_renderQuoteArea(){return(0,o.jsx)(ct.default,{quotedMessages:this.props.quotedMessages,onClearQuotedMessage:this.props.onClearQuotedMessage,onClearEditMessageQuote:this._onClearEditMessageQuote,showTranslatedMessage:this.props.showTranslatedMessage,disableActions:this.props.disableActionOnMessageComposer,editedMessage:this.props.editedMessage,inputEntities:this.state.inputEntities,messageStreamFontSize:this.state.messageStreamFontSize})}_getRightIcon(){const e=et.IconSize.size20;let t;if(this._canCancelEdit(this.state,this.props.editedMessage)){const s=[Rt.actionButtonWithBackground,Rt.actionButtonVerticalCenter,this._themeStyles.buttonBackgroundColorStyle];return t=this._themeStyles.buttonBackgroundHoverColorStyle,(0,o.jsx)(ee.default,{title:ce.getString("MessageComposer.CancelEditButtonTitle"),ref:this._onInputButtonRef,onPress:this._onCancelEditClick,size:e,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:s,hoverStyle:t,icon:et.SkypeIcon.Cancel})}if(this._sendControlEnabled(this.props,this.state,this._hasQuotes())){const t=this.props.disableActionOnMessageComposer||!!this.state.phoneNumberForSendingSms&&this.state.userInputIsEmpty;return(0,o.jsx)(u.default,{title:ce.getString(this.props.editedMessage?"MessageComposer.EditButtonTitle":"MessageComposer.SendButtonTitle"),ref:this._onInputButtonRef,onPress:this._onSendButtonClick,size:u.ActionButtonSize.Small,iconSize:e,style:Rt.sendButton,icon:et.SkypeIcon.Send,flipIcon:this._getContext().isRTL,disabled:t})}}_getMediaPreviewPanel(){if(this.state.isMediaPreviewEnabled)return(0,o.jsx)(fe.default,{conversationId:this.props.conversationId})}_renderPesPicker(){if(!this.state.isShowingUnifiedPesPickerDesktop)return;const e=this._isMojiCategoryEnabled();return(0,o.jsxs)(c.View,{children:[(0,o.jsx)(U.default,{showCategorySwitcher:e,availableWidth:this.props.availableWidth,pesPickerPopupRef:this._getPesPickerPopupRef,onEmoticonSelected:this._onEmoticonSelected,onMojiSelected:this._onMojiSelected,onStickerSelected:this._onStickerSelected,onGifSelected:this._onGifSelected,onClose:this._closeUnifiedPesPickerDesktop,selectedTabType:this.state.selectedTabType,searchQuery:this.state.searchQuery}),this._renderPesPickerPopup()]})}_renderRichtextEditor(){return this.state.richTextEditorVisible?(0,o.jsx)(dt.default,{conversationId:this.props.conversationId,textInputRef:this._textInputRef,isTopPanel:!this.state.isShowingUnifiedPesPickerDesktop&&!this.state.isToneRewritePanelOpen}):void 0}_renderToneRewritePanel(){return this.state.isToneRewritePanelOpen?(0,o.jsx)(Mt.ToneRewriteComposerPanel,{}):void 0}_getTextForSms(e){return`${this.state.quoteTextForSms}${ie.getRawText(e)}`}_renderSmsInfoLine(){if(this.state.enableOnewaySms)return(0,o.jsx)(qe.default,{rawTextInput:this._getTextForSms(this.state.inputEntities),conversationId:this.props.conversationId,phoneNumbers:this.state.phoneNumbers,onPhoneNumberSelected:this._onPhoneNumberForSmsSelected,selectedPhoneNumber:this.state.phoneNumberForSendingSms,creditEntitlement:this.state.creditEntitlement,ref:this._onSMSInfoLineRef,disabled:this.props.disableActionOnMessageComposer,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isSmsFailureScreenEnabled:this.state.isSmsFailureScreenEnabled})}_isMojiCategoryEnabled(){return!this.props.hideMojiPickerIcon&&!this.state.phoneNumberForSendingSms}_renderEmoteAuthor(){const e=n.head(this.state.inputEntities);if(this.props.editedMessage&&e instanceof se.EmoteEntity){const t=[Rt.emoteAuthor.text,Rt.emoteAuthor.textDesktop,this._themeStyles.primaryTextColorStyle],s=e.fallbackText.trim();return(0,o.jsx)(c.View,{children:(0,o.jsx)(c.Text,Object.assign({style:t},{children:s+"…"}))})}}_getDefaultPlaceholderText(){return this.state.phoneNumberForSendingSms?ce.getString("MessageComposer.SmsMessagePlaceholderText"):ce.getString("MessageComposer.MessagePlaceholderShortText")}_renderTextInput(e,t,s=!1){const i=this.state.selectedMediaBarItem===me.MediaBarItemKeys.MediaPicker||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Moji||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Emoticon||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Gif||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Sticker||this.state.selectedMediaBarItem===me.MediaBarItemKeys.Richtext?(0,o.jsx)(c.Button,{style:Rt.textInputFocusButton,onPress:this._onDismissMediaPicker,importantForAccessibility:c.Types.ImportantForAccessibility.No}):void 0;this._placeholderText=s?"":this._getDefaultPlaceholderText();let n=Ze.default.controlFontSize.messageComposerDesktop;return this.state.messageStreamFontSize!==Me.MessageStreamFontSize.Normal&&(n=Te.getSize(n,this.state.messageStreamFontSize)),(0,o.jsx)(c.View,Object.assign({style:Rt.inputArea},{children:(0,o.jsxs)(c.Animated.View,Object.assign({style:[...e]},{children:[(0,o.jsx)(d.default,{ref:this._onTextInputRef,importantForAccessibility:"yes",onVisibleSelectionRect:this._onVisibleSelectionRect,accessibilityLabel:this._getDefaultPlaceholderText(),style:t,agnosticContentBackgroundColor:this._useDarkTheme()?wt:Pt,atMentionBackgroundColor:this._useDarkTheme()?Je.Color.blueOverlay30:Je.Color.blueOverlay10,linkTextColor:this._themeColors.primaryTextColor,lineHeight:Math.round(1.2*n),maxLength:this.props.maxLength,onFocus:this._onFocus,onBlur:this._onBlur,onPaste:this._onPaste,placeholder:this._placeholderText,placeholderTextColor:this._themeColors.textSecondary,keyboardAppearance:this._useDarkTheme()?"dark":"default",useGraphicalEmoticons:!0,enterKeyOnExtKeyboardSendsMessage:this.state.sendMessageWithEnter,editable:void 0!==this.state.overrideEditable?this.state.overrideEditable:this.state.editable,initialContent:Ce.getEditableContentFromEditableEntities(this.state.editableEntities,this.state.inputEntitiesDataVersion),customContext:this.props.conversationId,intermediateContentUpdatedEventInterval:500,onNewContentCommitted:this._onUserInputCommitted,onNewContentAborted:this._onUserInputAborted,onEmptyIndicationChanged:this._onUserInputEmptyIndicationChanged,onUncommittedChangesIndicationChanged:this._onUserInputUncommittedChangesIndicationChanged,onEqualsInitialContentChanged:this._onEqualsInitialContentIndicationChanged,onEditLastMessageRequested:this._editLastMessage,onAccessibilityAnnouncementRequested:this._onAccessibilityAnnouncementRequested,onComposingActive:this._onUserInputActive,onComposingInactive:this._onUserInputInactive,onBackspacePressedAtHeadPosition:this._onUserInputBackspacePressedAtHeadPos,onEmoticonLoadCompleted:this._onEmoticonLoadCompleted,autoCompletionTriggers:At,onAutoCompletionRequested:this._onAutoCompletionRequested,onAutoCompletionRequestAborted:this._onAutoCompletionRequestAborted,onAutoCompletionNavigationKey:this._onAutoCompletionNavigationKey,delayedTriggersWaitTime:this.state.delayedTriggersWaitTime,convenienceSpaceReplacingChars:",.;:?!'",disableCopyPasteMedia:this.props.disableCopyPasteMedia,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,onPastingText:this._onPastingText,validateUrl:this._validateUrl,shouldDefaultPaste:this._shouldDefaultPaste}),i]}))}))}_getEmoticonPickerItem(){if(this.props.hideEmoticonKeyboardIcon||k.isPhoneMri(this.props.conversationId)||k.isS4BBridgeMri(this.props.conversationId))return;const e={id:me.MediaBarItemKeys.Emoticon,key:"emoticonPicker",active:this.state.isShowingUnifiedPesPickerDesktop,onActive:this._onUnifiedPesPickerDesktopPress,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,onFocus:this.requestFocus,onBlur:this.blur,onInputChange:this.autoReplaceText,onEmoticonSelected:this._onEmoticonSelected,onEmoticonBackspacePress:this._handleEmoticonBackspacePress,pesPickerPopupRef:this._getPesPickerPopupRef,preventAccessibilityFocus:this.props.preventAccessibilityFocus,colorOverride:this._themeColors.primaryTextColor,hoverColorOverride:this._themeColors.secondaryTextColor,iconStyleOverride:void 0,showCategorySwitcher:!1,disabled:this.props.disableActionOnMessageComposer,origin:ge.MediaBarItemOrigin.MessageComposer,ref:e=>{m.default.setAnchor(S.EngagementTooltipType.ExpressionPicker,e)}};return(0,o.jsx)(c.View,Object.assign({style:Rt.desktopOverrides.composerInnerIconWrapper},{children:(0,o.jsx)(Q.ExpressionPickerItem,Object.assign({},e))}))}_getRichtextEditorItem(){if(k.isPhoneMri(this.props.conversationId)||k.isS4BBridgeMri(this.props.conversationId))return;const e={id:me.MediaBarItemKeys.Richtext,key:"richtextPicker",active:this.state.selectedMediaBarItem===me.MediaBarItemKeys.Richtext,onActive:this._onEditorActive,onFocus:this.requestFocus,onBlur:this.blur,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,origin:ge.MediaBarItemOrigin.MessageComposer};return(0,o.jsx)(c.View,Object.assign({style:Rt.desktopOverrides.composerInnerIconWrapper},{children:(0,o.jsx)(st.RichtextEditorItem,Object.assign({},e))}))}_hasQuotes(){return!n.isEmpty(this.props.quotedMessages)}_mediaBarItemDescriptor(e){switch(e){case me.MediaBarItemKeys.Emoticon:const t={onEmoticonSelected:this._onEmoticonSelected,pesPickerPopupRef:this._getPesPickerPopupRef,showCategorySwitcher:!1};return{id:e,render:this._renderEmoticonPickerItem,propOverrides:t};case me.MediaBarItemKeys.Moji:const s={onMojiSelected:this._onMojiSelected,showCategorySwitcher:!1};return{id:e,render:this._renderMojiPickerItem,getVirtualKeyboard:we.MojiPickerItem.getVirtualKeyboard,propOverrides:s};case me.MediaBarItemKeys.Gif:const i={onGifSelected:this._onGifSelected,showCategorySwitcher:!1};return{id:e,render:this._renderGifPickerItem,propOverrides:i};case me.MediaBarItemKeys.Sticker:const o={onStickerSelected:this._onStickerSelected,showCategorySwitcher:!1};return{id:e,render:this._renderStickerPickerItem,propOverrides:o};case me.MediaBarItemKeys.Sms:return{id:e,render:this._renderSmsItem};case me.MediaBarItemKeys.MediaPicker:return{id:e,render:this._renderMediaPickerItem,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.FilePicker:return{id:e,render:this._renderFilePickerItem,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.Camera:return{id:e,render:this._renderCameraItem,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.ScheduleCall:return{id:e,render:this._renderScheduleCallItem};case me.MediaBarItemKeys.Poll:return{id:e,render:this._renderPollItem};case me.MediaBarItemKeys.Location:return{id:e,render:this._renderLocationPickerItem,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.Contact:return{id:e,render:this._renderContactPickerItem};case me.MediaBarItemKeys.Bing:const n={onBlur:this._onBlur};return{id:e,render:this._renderBingSearchItem,propOverrides:n};case me.MediaBarItemKeys.MagicBotToolbox:return{id:e,render:this._renderMagicToolboxItem};case me.MediaBarItemKeys.VideoMessage:return{id:e,render:this._renderVideoMessageItem,disabled:this.state.disableHighBandwidthOperations};case me.MediaBarItemKeys.People:return{id:e,render:this._renderPeopleItem};case me.MediaBarItemKeys.Audio:const r={onPress:this.props.onRecording};return{id:e,render:this._renderAudioMessageItem,propOverrides:r};case me.MediaBarItemKeys.SendCredit:return{id:e,render:this._renderSendCreditItem,getVirtualKeyboard:We.SendCreditItem.getVirtualKeyboard};case me.MediaBarItemKeys.SkypeClipsRecord:return{id:e,render:this._renderSkypeClipsRecordItem,disabled:this.state.disableHighBandwidthOperations}}oe.warn(q.LogTraceArea.MessageComposer,"No media bar descriptor for "+e)}_canShowBingButton(){return this._showBingButton(this.state)}_canShowMagicBotToolboxButton(){return this._showMagicBotToolboxButton(this.state)}_canShowSmsIcon(){return!1}_canShowEmoticonIcon(){return!this.props.hideEmoticonKeyboardIcon}_getItemDescriptors(e,t=!1){const s=t&&this.state.disableHighBandwidthOperations,i=n.map(e,(e=>{switch(e){case me.MediaBarItemKeys.Bing:if(this._canShowBingButton())return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.MagicBotToolbox:if(this._canShowMagicBotToolboxButton())return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Camera:if(!this.props.hideMediaPickerIcon&&this.state.isCameraAvailable)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Sms:if(this._canShowSmsIcon())return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Emoticon:if(this._canShowEmoticonIcon())return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Location:if(this.state.showLocationPicker&&!s&&t)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Contact:if(this.state.showContactPicker)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.MediaPicker:if(!this.props.hideMediaPickerIcon&&!s&&t)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.FilePicker:if(!this.props.hideFilePicker&&!s)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Moji:if(this._isMojiCategoryEnabled()&&!t)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Sticker:if(!t||!this.props.hideStickerPickerIcon)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Gif:break;case me.MediaBarItemKeys.ScheduleCall:if(!this.props.hideScheduleCallIcon&&!s&&!this.state.isRegularMemberInModeratedGroup)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Poll:if(!this.props.hidePollIcon)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.People:return this._mediaBarItemDescriptor(e);case me.MediaBarItemKeys.VideoMessage:if(this.state.showVideoMessageIcon&&!s)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.Audio:if(this._canShowMicButton(this.props,this.state))return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.SendCredit:if(!this.props.hideSendCreditIcon&&!s)return this._mediaBarItemDescriptor(e);break;case me.MediaBarItemKeys.SkypeClipsRecord:if(this.state.showVideoMessageIcon&&!s)return this._mediaBarItemDescriptor(e)}}));return n.compact(i)}_canShowMicButton(e,t){return!(e.hideAudioMessage||!e.onRecording||t.phoneNumberForSendingSms||this._isPresentedInSidebar()||t.disableHighBandwidthOperations)}_getOverflowItemDescriptors(){const e=n.map(this.state.mediaBarMenuOrder,(e=>e)),t=this._getItemDescriptors(n.flatten(e),!0);return n.slice(t,this.state.currentNumberOfIconsInMediaBar)}_getMediaBarItemDescriptors(){if(this.props.hideMediaBar||this._isMediabarDisabled())return[];const e=this._getItemDescriptors(this.state.mediaBarMenuOrder,!0);return n.slice(e,0,this.state.currentNumberOfIconsInMediaBar)}_getMediaBar(e=!0){if(this._getRightIcon()||this.state.isShowingUnifiedPesPickerDesktop||this.state.isToneRewritePanelOpen)return;const t=this._getMediaBarItemDescriptors();let s;if(this.state.isEncryptedThreadThread||(s=(0,o.jsx)(R.default,{overflowConfig:this.getOverflowConfig(),otherPartyMri:this.props.otherPartyMri,conversationId:this.props.conversationId,onOverflowButtonPress:this._onComposerOverflowPress})),t.length>0){const i=!1;return(0,o.jsxs)(c.View,Object.assign({style:Rt.mediaBarWrapper},{children:[(0,o.jsx)(ue.MediaBar,{ref:this._onMediaBarRef,activeId:this.state.selectedMediaBarItem,itemDescriptors:t,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isMobileInterface:!1,showIcons:e,onInputChange:this.autoReplaceText,onItemSelected:this._onMediaBarItemSelected,onFocus:this.requestFocus,onBlur:this.blur,onCustomKeyboardClose:this._onCustomKeyboardClose,onBackspace:this._handleEmoticonBackspacePress,onCustomAction:this._onHandleCustomAction,preventAccessibilityFocus:this.props.preventAccessibilityFocus,onMessageSent:this.props.onMessageSent,onCloseSearch:this._onCancelPesSearch,clearEditInChatsComposer:this.props.onClearEdit,autoFocusFirstItem:i,disableActionOnMediaBar:this.props.disableActionOnMessageComposer,focusCustomKeyboardWhenShown:!0,announceForAccessibilityForMessageSent:this._announceForAccessibilityForMessageSent,customKeyboardHeight:this.state.pesPickerKeyboardHeight}),s]}))}}_animateInputAreaToTargetHeight(){this._inputAreaAnimation||this._inputAreaTargetHeight===this._inputAreaHeight||(this._inputAreaHeight=this._inputAreaTargetHeight,this._inputAreaAnimation=$e.default.easeOut({value:this._inputAreaHeightValue,toValue:this._inputAreaTargetHeight}),this._inputAreaAnimation.start((()=>{this._inputAreaAnimation=void 0,this.isComponentMounted()&&this._animateInputAreaToTargetHeight()})))}_toggleSmsSending(e,t){this._onPhoneNumberForSmsSelected(t),this.isComponentMounted()&&this.setState({smsToggledOn:e})}_sendControlEnabled(e,t,s){return e.showSendControlWhenEmpty||!t.userInputIsEmpty||s||!!t.phoneNumberForSendingSms||t.hasMediaPreviews}_canCancelEdit(e,t){return!!t&&(!e.hasUncommittedUserInput||e.userInputIsEmpty||e.equalsInitialContent)}replaceText(e,t,s,i){if(this.requestFocus(),this._pendingMessageTextCompletionPromise){const e=Ce.getEditableEntityFromInputEntityAndConsiderAlternatives(i,this.state.emoticons);this._pendingMessageTextCompletionPromise.resolve(e),this._pendingMessageTextCompletionPromise=void 0}this._cancelAutoCompletionIfActive()}abortTextAutoCompletion(){this._cancelAutoCompletionIfActive()}_wasRegexTriggered(e){return n.includes(At.instantTriggers,e)||n.includes(At.delayedTriggers,e)}_cancelAutoCompletionIfActive(){this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this.props.onInputTextChanged("",!0)}_setInputEntityStateUpstream(e){const t=Ce.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this.isComponentMounted()&&(oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._setInputEntityStateUpstream set inputEntities.length: "+(null==e?void 0:e.length)),this.setState({inputEntities:e,editableEntities:t}))}_setInputEntityStateDownstream(e,t){const s=this.state.inputEntitiesDataVersion+1,i=Ce.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this._textInputRef&&this._textInputRef.setContent(Ce.getEditableContentFromEditableEntities(i,s)),this.isComponentMounted()&&(oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._setInputEntityStateDownstream inputEntities.length: "+(null==e?void 0:e.length)),this.setState({inputEntities:e,inputEntitiesDataVersion:s,editableEntities:i},t))}_sendFileWithDimensions(e){const t=ot.default.getFileUrl(e);a.default.getImageSize(t).then((t=>{if(t&&(e.dimensions=t),this.state.isMediaPreviewEnabled)return ye.default.addPreviews([e],this.props.conversationId,q.PostSource.MessageComposer);const s={name:je.ScenarioName.SendPicture};Ee.default.postUpload([this.props.conversationId],e,q.PostSource.MessageComposer,!1,{scenarioInfo:s},this._getRootViewType())}))}_preventSendingSMSMessage(e){return!(!(1===e.length&&e[0]instanceof se.SmsEntity&&this._smsInfoLineRef)||this._smsInfoLineRef.canSendSMS())&&(this.state.isSmsFailureScreenEnabled?Ae.default.navigateToSmsFailurePrompt(this.props.conversationId,this.state.phoneNumberForSendingSms?this.state.phoneNumberForSendingSms.number:"",!1):C.default.open(this._getRootViewId()),!0)}_sendMessage(e){return i.__awaiter(this,void 0,void 0,(function*(){if(oe.log(q.LogTraceArea.MessageComposer,"sendMessage isPostingMessage: "+this._isPostingMessage),this._isPostingMessage)return;if(!(0,St.canSendMessageToMagicBot)(e,this.state.isMagicBotConversation))return void this.dismissKeyboard();this._isPostingMessage=!0;const t=at.default.newCauseId();oe.log(q.LogTraceArea.MessageComposer,"sendMessage causeId: "+t);let s=[],i=0;if(this.props.quotedMessages&&(s=s.concat(this.props.quotedMessages.map(this._getQuoteEntity)),i=s.length),e.length>0&&(s=s.concat(e)),this.state.enableOnewaySms&&this.state.phoneNumberForSendingSms&&!this.state.userInputIsEmpty&&(s=[new se.SmsEntity(this._getTextForSms(e),this.state.phoneNumberForSendingSms.number)],this._preventSendingSMSMessage(s)))return oe.log(q.LogTraceArea.MessageComposer,"sendMessage Message prevented from being send."),void(this._isPostingMessage=!1);try{const e=(0,St.isMagicBotMentioned)(s);e&&this.state.enableMagicBotGroupAutoAdd&&!this.state.isOneOnOneConversation&&!this.state.isMagicBotContainingConversation&&(yield ft.default.serviceAddMemberToThread(this.props.conversationId,(0,ht.getMagicBotId)(),yt.AddMemberToThreadSource.BotAutoAdd,!(0,Ie.isModerated)(this.state.conversation)),oe.log(q.LogTraceArea.MessageComposer,"sendMessage Magic bot auto-added to conversation because being mentioned."),oe.track(new ut.MagicBotAutoAddedByMention));const o=e&&this.state.enableMagicBot&&this.state.enableMagicBotOneOnOneAutoAdd&&this.state.isOneOnOneConversation&&!this.state.isMagicBotConversation;if(this._needsContext(e)&&!(0,vt.isUserInputEmptyOrHasWhitespaceOnly)(s)){const e=yield(0,gt.getContext)(!this.state.isOneOnOneConversation||o,this.state.conversation);s.push(e)}this._sendOneOnOneMagicBotMessageIfNeeded(o,s),yield ye.default.sendPreviews(this.props.conversationId,t),i>1?h.all(s.map((e=>this._sendTextMessagePromise([e])))).finally((()=>{this._isPostingMessage=!1})):this._sendTextMessagePromise(s).finally((()=>{this._isPostingMessage=!1}))}finally{this._isPostingMessage=!1,this.state.hasFocus||this.requestFocus()}}))}_needsContext(e){return this.state.enableMagicBot&&pt.default.getConsent()&&(e||this.state.isMagicBotConversation)}_sendTextMessagePromise(e){const t={conversationId:this.props.conversationId,editedMessage:this.props.editedMessage,inputEntities:e,onMessageSent:this.props.onMessageSent,phoneNumberForSendingSms:this.state.phoneNumberForSendingSms,smsInfoLineRef:this._smsInfoLineRef,textInputRef:this._textInputRef,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,messageComposerPastedContentType:this.state.messageComposerPastedContentType};return Lt._sendTextMessage(t).then((e=>{if(e){if(this._handleAfterPostMessage(t.conversationId),oe.log(q.LogTraceArea.MessageComposer,"sendMessage Message sent."),t.smsInfoLineRef){const e=t.smsInfoLineRef.getTelemetryEvent();e&&(this.state.phoneNumberForSendingSms?e.setSmsWasSent(!0):e.setSkypeMessageSent(!0))}}else oe.log(q.LogTraceArea.MessageComposer,"sendMessage Message not sent.")}))}static _sendTextMessage(e){if((0,vt.isUserInputEmptyOrHasWhitespaceOnly)(e.inputEntities))return e.inputEntities.length?oe.log(q.LogTraceArea.MessageComposer,"sendMessage User pressed enter with only whitespace message content."):oe.log(q.LogTraceArea.MessageComposer,"sendMessage User pressed enter without entering any message content."),h.Resolved(!1);if(e.onMessageSent(e.inputEntities,_e.convertPastedTextTypeToTelemetry(e.messageComposerPastedContentType))){const t=e.editedMessage?ce.getString("MessageComposer.MessageEditedLabel"):ce.getString("MessageComposer.MessageSentLabel");Lt._announceForAccessibility(t);const s=B.default.getSavedMessageInput(e.conversationId);if(s){const t=e.textInputRef&&!e.textInputRef.equalsInitialContent()||!1;oe.track(new z.DraftMessageWasSent(t,s.timestamp))}return h.Resolved(!0)}return h.Resolved(!1)}static _announceForAccessibility(e){ze.default.maybeAnnounceForAccessibility(e,0)}_handleAfterPostMessage(e){if(B.default.getSavedMessageInput(e)&&(0,D.default)().fakeConversationTime(e,Date.now()),oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._handleAfterPostMessage"),B.default.clearMessageInput(e),this.props.conversationId===e){this.state.hasFocus||this.requestFocus(),this.setTextInputAccessibilityFocus(),this._setInputEntityStateDownstream([]),this._cancelAutoCompletionIfActive(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""}),this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.onClearEdit&&this.props.onClearEdit();const e=this._getRootViewId();pe.MediaBarItem.dismissPopup(e),N.default.close(e),bt.default.closePanel()}this._isPostingMessage=!1}_shouldAutoFocusInput(){return!this.state.isSmallOrTinyScreen||this._getRootViewId()!==x.MainRootViewId}_isMediabarDisabled(){return k.isS4BBridgeMri(this.props.conversationId)||!!this.state.phoneNumberForSendingSms||!!this.state.isConversationWithPhoneNumber}_isPresentedInSidebar(){return this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav}isFocused(){return this.state.hasFocus}blurIfFocused(){this.state.hasFocus&&this.blur()}getInputEntities(){return this._textInputRef?this._textInputRef.getContent().then((e=>this._consumeNewUserInput(e)||this.state.inputEntities)):h.Resolved(this.state.inputEntities)}getOverflowConfig(){return this._overflowActions()}onDragDropText(e){var t;null===(t=this._textInputRef)||void 0===t||t.onDragDropText(e)}}t.default=Lt},609413:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageTextCompletion=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(934339),a=s(889391),l=s(671830),d=s(539549),c=s(952262),h=s(82433),u=s(110117),p=s(497174),g=s(915877),m=s(733754),S=s(846116),f=s(353743),y=s(18078),v=s(308420),C=s(404057),_=s(581760),b=s(311010),T=s(711828),M=s(282481),I=s(619675),w=s(24576),P=s(702301),k=s(567977),A=b.default.fontSize.size13Deprecated,x=T.IconSize.size20,R=k.UserIconSize.Size24,O=(0,g.lazyProperties)({textCompletionMenuItem:()=>n.Styles.createTextStyle({fontSize:A,font:b.default.font.uiDisplayRegular}),textCompletionMenuItemSelected:()=>n.Styles.createTextStyle({color:_.Color.blue}),atMentionMenu:()=>(0,g.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),iconContainer:()=>n.Styles.createViewStyle({flexDirection:"row",marginRight:8}),name:()=>n.Styles.createTextStyle({fontSize:A,font:b.default.font.uiDisplayRegular}),nameDimmed:()=>n.Styles.createTextStyle({fontSize:A,font:b.default.font.uiDisplayRegular}),nameSelected:()=>n.Styles.createTextStyle({color:_.Color.blue}),nameDimmedSelected:()=>n.Styles.createTextStyle({color:_.Color.blueOverlay70}),allIcon:()=>n.Styles.createViewStyle({marginRight:8,padding:2})}),slashCommandMenu:()=>(0,g.lazyProperties)({container:()=>n.Styles.createTextStyle({alignItems:"center"}),commandName:()=>n.Styles.createTextStyle({fontSize:A,font:b.default.font.uiDisplayBold}),usageHint:()=>n.Styles.createTextStyle({fontSize:b.default.fontSize.size13Deprecated,font:b.default.font.uiDisplayRegular}),textSelected:()=>n.Styles.createTextStyle({color:_.Color.blue}),descriptionSelected:()=>n.Styles.createTextStyle({color:_.Color.blueOverlay70})}),emoticonMenuItem:()=>(0,g.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),emoticonContainer:()=>n.Styles.createViewStyle({flexDirection:"row",marginRight:8})})});class L extends w.default{constructor(){super(...arguments),this._preventDoubleTextReplacement=!1,this._onEntityDeectors=()=>this._entityDetectors,this._onReplaceText=(e,t,s,i)=>{this._preventDoubleTextReplacement||(this.props.onReplaceText(e,t,s,i),this._preventDoubleTextReplacement=!0)},this._onTextCompletionRef=e=>{this._textCompletion=e||void 0}}_buildState(e,t){const s={},i=(0,d.default)().getConversation(e.conversationId),{enableMagicBot:o,enableMagicBotGroupAutoAdd:n,enableMagicBotOneOnOneAutoAdd:r}=a.default.getS4LMessagingFeatures();s.userAtMentionInfo=this._buildAtMentionInfo(i,n,o&&r),this._entityDetectors=this._getEntityDetectors(i);const l=this.props,c=t||l.conversationId!==e.conversationId;return(c||l.showSlashCommands!==e.showSlashCommands)&&e.showSlashCommands&&c&&(s.slashCommands=v.getVisibleCommands(e.conversationId)),t&&(s.inputText=""),s}setInputText(e,t){this.setState({inputText:e,forceHide:t}),this._preventDoubleTextReplacement=!1}render(){const e=this.state.forceHide?"":this.state.inputText;return(0,i.jsx)(M.TextCompletion,{ref:this._onTextCompletionRef,style:this.props.style,entityDetectors:this._onEntityDeectors,inputText:e,onReplaceText:this._onReplaceText,onTextReplacementCandidatesShown:this.props.onTextReplacementCandidatesShown,candidatesToDisplay:8,maxMenuHeight:this.props.maxMenuHeight,leftOffset:this.props.leftOffset})}_buildAtMentionInfo(e,t,s){const i={};if(!e||!e.isThread()&&!l.isSkypeIdMri(e.id)||e.isEncryptedThread())return i;const n={};let r=e?o.map(e.getThreadMembers(),(e=>e.id)):[];const a=(0,S.getMagicBotId)();if(l.isSkypeIdMri(e.id)){const t=e.getOtherPartyMri();t&&(r=[t]),s&&r.splice(0,0,a)}else t&&!r.includes(a)&&r.splice(0,0,a);return o.each(r,(e=>{if(y.default.isMyMri(e))return;const t=c.default.getDisplayableProfile(e);if(!i[e]){const s=t.getDisplayName(void 0,!0),o=t.getShortName(!0),r=o?C.default.deburrLowerCase(o):void 0;i[e]={shortName:o,shortNameNormalized:r,displayName:s,displayNameNormalized:s?C.default.deburrLowerCase(s):void 0,sharesShortName:!1,isAgent:l.isAgent(e)},o&&r&&(n[r]?(i[n[r]].sharesShortName=!0,i[e].sharesShortName=!0):n[r]=e)}})),i}_escapeForRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}_getEntityDetectors(e){const t="(("+this._escapeForRegExp(o.values(h.default.getEmoticonFirstLetterMap()).join(" ")).split(" ").join("|")+")"+h.default.getValidEmoticonCharactersPattern()+"{2,})$",s=[{entityType:"@Mention",match:/\B@([^@?!\n[\]{}|\/<>]*)$/i,search:(e,t,s)=>{const i=e.toLowerCase(),o=this._getCandidatesForAtMention(e,!1,1,!1),n=(0,d.default)().getConversation(this.props.conversationId);if(n&&!n.isOneOnOne()){const t=m.getString("MessageComposer.QouteAll");0===t.indexOf(i)&&o.splice(0,0,{entity:new p.AtMentionEntity(t,"*"),charsToReplace:e.length+1,replacementText:t,priority:1})}return o},render:(e,t)=>this._renderAtMentionMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.MentionSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:250},{entityType:"@Mention",match:/([^?!\n[\]{}|\/<>]{3,})$/i,search:(e,t,s)=>this._getCandidatesForAtMention(e,t,0,!0),render:(e,t)=>this._renderAtMentionMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.MentionSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:250},{entityType:"SlashCommand",match:/^\/(\w*)$/i,search:(e,t,s)=>{const i=[];if(this.props.showSlashCommands){const t=o.filter(this.state.slashCommands,(t=>0===t.command.indexOf(e)));o.each(t,(t=>{const s=new p.CommandEntity("/"+t.command+" ",t.command,t.usageHint||"",t.description);i.push({entity:s,charsToReplace:e.length+1,replacementText:"/"+t.command+" "})}))}return i},render:(e,t)=>this._renderSlashCommandMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.CommandSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:400},{entityType:"Emoticon",match:new RegExp(t,"i"),search:(e,t,s)=>(0,f.GetEmoticonSuggestions)(e,t,s),render:(e,t)=>this._renderEmoticonMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.EmoticonSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:170}];return e&&o.find(e.getThreadMembers(),(e=>"28:dd02eb70-197a-4dbc-8591-e4e88a5093a0"===e.id))&&s.push({entityType:"@Mention",match:/(zo)$/i,search:(e,t,s)=>this._getCandidatesForAtMention(e,t,0,!0,2),render:(e,t)=>this._renderAtMentionMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.MentionSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:250}),s}_getCandidatesForAtMention(e,t,s,i,n=3){const r=[],a=C.default.deburr(e),l=[];if(i){const e=a.split(" ");let s=1;const i=t?0:1;for(let t=e.length-1;t>=i&&s<=4;t--){const i=e.slice(t,t+s).join(" "),o=i.toLowerCase();i.length>=n&&i[0]!==o[0]&&l.push(o),s++}}else l.push(a.toLowerCase());return l.length>0&&o.each(this.state.userAtMentionInfo,((e,t)=>{o.each(l,(i=>{const n=e.shortNameNormalized&&e.shortNameNormalized.length>=i.length&&e.shortNameNormalized.substring(0,i.length)===i,a=e.displayNameNormalized&&e.displayNameNormalized.length>=i.length&&e.displayNameNormalized.substring(0,i.length)===i;if(n||a){let l=e.shortName;(!n||e.sharesShortName||e.isAgent)&&(l=e.displayName);const d={entity:new p.AtMentionEntity(l,t,e.shortName,e.displayName),charsToReplace:i.length+s,replacementText:l,uniqueKey:t,priority:n||e.sharesShortName&&a?2:3},c=o.findIndex(r,(e=>e.uniqueKey===t));if(c>=0){const e=r[c].priority||0;d.priority<e&&r.splice(c,1,d)}else r.push(d)}}))})),r}_renderAtMentionMenuItem(e,t){const s=e.text();let r,a;if(s===e.shortName&&o.startsWith(e.displayName,s)){const o=[O.atMentionMenu.nameDimmed,this._themeStyles.secondaryTextColorStyle];t&&o.push(O.atMentionMenu.nameDimmedSelected),r=(0,i.jsx)(n.Text,Object.assign({style:o,numberOfLines:1},{children:e.displayName.substring(s.length)}))}e.userMri&&(a="*"===e.userMri?(0,i.jsx)(u.default,{icon:T.SkypeIcon.ContactGroup,size:x,color:t?_.Color.blue:_.Color.gray300,style:O.atMentionMenu.allIcon}):(0,i.jsx)(n.View,Object.assign({style:O.atMentionMenu.iconContainer},{children:(0,i.jsx)(P.UserIcon,{userMri:l.sanitizeMri(e.userMri,l.Namespaces.SkypeId),size:R})})));const d=[O.atMentionMenu.name,this._themeStyles.primaryTextColorStyle];return t&&d.push(O.atMentionMenu.nameSelected),(0,i.jsxs)(n.View,Object.assign({style:O.atMentionMenu.container},{children:[a,(0,i.jsx)(n.Text,Object.assign({style:d,numberOfLines:1},{children:s})),r]}))}_renderSlashCommandMenuItem(e,t){let s;const o=[O.slashCommandMenu.commandName,this._themeStyles.primaryTextColorStyle],r=[O.slashCommandMenu.usageHint,this._themeStyles.primaryTextColorStyle],a=t?O.slashCommandMenu.textSelected:void 0;if(a&&(o.push(a),r.push(a)),e.description){const o=[this._themeStyles.tertiaryTextColorStyle],n=t?O.slashCommandMenu.descriptionSelected:void 0;n&&o.push(n),s=(0,i.jsx)(I.Caption,Object.assign({style:o,numberOfLines:1},{children:e.description}))}return(0,i.jsxs)(n.View,{children:[(0,i.jsxs)(n.Text,Object.assign({style:O.slashCommandMenu.container,numberOfLines:1},{children:[(0,i.jsx)(n.Text,Object.assign({style:o,numberOfLines:1},{children:e.commandName})),(0,i.jsx)(n.Text,Object.assign({style:r,numberOfLines:1},{children:" "+e.usageHint}))]})),s]})}_renderEmoticonMenuItem(e,t){const s=[O.textCompletionMenuItem,this._themeStyles.primaryTextColorStyle];return t&&s.push(O.textCompletionMenuItemSelected),(0,i.jsxs)(n.View,Object.assign({style:O.emoticonMenuItem.container},{children:[(0,i.jsx)(n.View,Object.assign({style:O.emoticonMenuItem.emoticonContainer},{children:(0,i.jsx)(r.AnimatedEmoticon,{innerText:e.text(),emoticonName:e.emoticonName,size:r.Size.Small,isStatic:!1,tone:e.tone})})),(0,i.jsx)(n.Text,Object.assign({style:s,numberOfLines:1},{children:"  "+e.text()}))]}))}_createSuggestionItemAccessibilityLabel(e,t,s,i){return m.getString(e,{name:t,itemIndex:s,itemsCount:i})}handleKeyDown(e){return!!this._textCompletion&&this._textCompletion.handleKeyDown(e)}}t.MessageTextCompletion=L,t.default=L},127878:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(244770),r=s(705465),a=s(667294),l=s(733754),d=s(915877),c=s(31280),h=s(600212),u=s(512193),p=s(311010),g=r.StyleSheet.create({container:{flex:1,alignItems:"center",justifyContent:"center",paddingHorizontal:30}}),m=(0,d.lazyProperties)({image:()=>o.Styles.createLinkStyle({width:"80%",height:310,maxWidth:600}),paragraph:()=>o.Styles.createTextStyle({paddingBottom:28,paddingTop:8})});t.default=function({onInitialRenderComplete:e}){const{mode:{isDark:t}}=(0,h.useSkypeTheme)(),{paragraphCommon:s}=(0,u.useRXStyles)((({themeColors:e})=>({paragraphCommon:o.Styles.createTextStyle({textAlign:"center",color:e.textOnAccent,fontSize:24,lineHeight:32,font:p.default.font.uiDisplayBold},!1)})),[]),{secondParagraphCommon:d}=(0,u.useRXStyles)((({themeColors:e})=>({secondParagraphCommon:o.Styles.createTextStyle({textAlign:"center",color:e.engagementBannerTextColor,fontSize:16,lineHeight:20},!1)})),[]);(0,a.useEffect)((()=>{e()}),[]);const S=t?n.Collection.MYBOT_EMPTY_STATE_DARK:n.Collection.MYBOT_EMPTY_STATE;return(0,i.jsxs)(r.View,Object.assign({style:g.container},{children:[(0,i.jsx)(c.BodyText,Object.assign({style:s},{children:l.getString("MyBotConversation.FirstParagraph")})),(0,i.jsx)(c.BodyText,Object.assign({style:[d,m.paragraph]},{children:l.getString("MyBotConversation.SecondParagraphDesktop")})),(0,i.jsx)(o.Image,{style:m.image,source:S})]}))}},730452:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(705465),n=s(516778),r=s(244770),a=s(667294),l=s(733754),d=s(913944),c=s(711828),h=s(581760),u=s(640363),p=s(31280),g=s(619675),m=s(600212),S=s(512193),f=s(915877),y=s(818882),v=s(311010),C=s(445472),_=s(491632),b=o.StyleSheet.create({leftPanel:{flexGrow:1,flexShrink:1,marginRight:"auto",paddingTop:10,paddingBottom:10,paddingRight:8},rightPanel:{flexGrow:0,flexShrink:0,marginLeft:"auto",marginRight:10,display:"flex",flexDirection:"row",alignItems:"center"},qrContainer:{padding:4},closeButton:{marginRight:6,width:24,height:24,borderRadius:12,backgroundColor:h.Color.transparent}}),T=(0,f.lazyProperties)({image:()=>n.Styles.createImageStyle({width:53,height:53,marginRight:10,marginTop:4,marginBottom:4})});t.default=function(e){const[t,s]=(0,a.useState)(!1),{pinNormalContainer:h}=(0,S.useSkypeStyles)((({themeColors:e})=>({pinNormalContainer:{position:"absolute",top:0,left:0,right:0,alignItems:"center",justifyContent:"center",paddingLeft:10,display:"flex",flexDirection:"row",backgroundColor:e.surfacePrimary,color:e.textSecondary,borderBottomColor:e.surfaceSecondary,borderBottomWidth:1}})),[]),{linkStyle:f}=(0,S.useRXStyles)((({themeColors:e})=>({linkStyle:n.Styles.createTextStyle({textDecorationLine:"underline",color:e.textPrimary},!1)})),[]),{titleStyle:M}=(0,S.useRXStyles)((({themeColors:e})=>({titleStyle:n.Styles.createTextStyle({fontSize:15,lineHeight:20,color:e.textPrimary,font:v.default.font.uiDisplayBold},!1)})),[]),{contentStyle:I}=(0,S.useRXStyles)((({themeColors:e})=>({contentStyle:n.Styles.createTextStyle({fontWeight:"400",fontSize:14,lineHeight:18,color:e.textPrimary},!1)})),[]),{themeColors:{iconPrimary:w}}=(0,m.useSkypeTheme)();return t?null:(0,i.jsxs)(o.View,Object.assign({style:h},{children:[(0,i.jsx)(n.Image,{style:T.image,source:r.Collection.MYBOT_QR_CODE}),(0,i.jsxs)(o.View,Object.assign({style:b.leftPanel},{children:[(0,i.jsx)(g.RowTitle,Object.assign({style:M},{children:l.getString("MyBotConversation.FRETitleDesktop")})),(0,i.jsx)(p.BodyText,Object.assign({style:I},{children:l.getString("MyBotConversation.FREContentDesktop")}))]})),(0,i.jsx)(o.View,Object.assign({style:b.rightPanel},{children:(0,i.jsx)(d.default,{icon:c.SkypeIcon.ClosePanel,color:w,hoverColor:w,size:c.IconSize.size14,style:[b.closeButton],onPress:()=>{_.Instrumentation.track(new C.MyBotFreHeadClose(e.isNoMessage)),y.LocalStorage.setItem(y.StorageKeys.FreBuildVersion,u.default.getAppVersion()),s(!0)},title:l.getString("Global.CloseButtonTitle")})}))]}))}},510756:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesInlineSearchContainer=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(4736),a=s(443106),l=s(915877),d=s(733754),c=s(540897),h=s(526424),u=s(79096),p=s(960621),g=s(602295),m=s(758962),S=s(581760),f=s(311010),y=s(711828),v=s(24576),C=y.IconSize.default,_=C-4,b=(0,l.lazyProperties)({searchTextInput:()=>n.Styles.createTextInputStyle({flex:1,borderWidth:0,fontSize:f.default.controlFontSize.messageComposerMobile,font:f.default.font.uiDisplayRegular,backgroundColor:S.Color.transparent,minHeight:25}),container:()=>n.Styles.createViewStyle({flex:0,paddingVertical:5}),cancelButton:()=>n.Styles.createViewStyle({height:C,width:C}),textInputContainer:()=>n.Styles.createViewStyle({flexDirection:"row"}),innerWrapper:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",borderRadius:_/2,minHeight:_,alignItems:"center",marginBottom:2,marginHorizontal:3,overflow:"visible",paddingLeft:15})});class T extends v.default{constructor(){super(...arguments),this._switchPesSearchTabType=e=>{c.default.setInlineSearchType(e)},this._onClearSearchPress=()=>{c.default.deactivateInlineSearch(),p.MojiPreviewService.closePesPreview(),p.GifPreviewService.closePesPreview(),a.default.setSearchParams("")},this._insertSearchResult=(e,t,s,i)=>{this.props.insertSearchResultToComposer(t,s,i)},this._onSearchInputRef=e=>{this._searchInputRef=e||void 0},this._onSearchResultsRef=e=>{this._searchResults=e||void 0},this._onInputTextChange=e=>{this.isComponentMounted()&&(""===e?(p.MojiPreviewService.closePesPreview(),p.GifPreviewService.closePesPreview()):this.props.pesTabType===m.TabType.Gif&&e.length<h.GifMinSearchChars&&this.state.lastInputText&&this.state.lastInputText.length>e.length&&p.GifPreviewService.closePesPreview(),this.setState({lastInputText:e})),this._searchResults&&(this.props.pesTabType===m.TabType.Gif?this._debounceGifSearchResultsInput(e):this._debounceSearchResultsInput(e))},this._debounceSearchResultsInput=o.debounce((e=>{this._setSearchResultInput(e)}),100),this._debounceGifSearchResultsInput=o.debounce((e=>{this._setSearchResultInput(e)}),h.GifSearchDebounceMs)}_buildState(e,t){if(t){return{lastInputText:c.default.getInitialSearch()||""}}return{}}componentDidMount(){super.componentDidMount(),o.defer((()=>{this._searchInputRef&&this._searchInputRef.requestFocus()}))}componentWillUnmount(){super.componentWillUnmount(),c.default.deactivateInlineSearch()}render(){const e=this._getPesSearchResultsCarousal(),t=[b.searchTextInput,this._themeStyles.primaryTextColorStyle],s=[b.innerWrapper,this._themeStyles.buttonBackgroundColorStyle],o=this._getOptionalPlaceHolder(),r=(0,i.jsx)(n.TextInput,{style:t,accessibilityTraits:[n.Types.AccessibilityTrait.Search],accessibilityLabel:o,ref:this._onSearchInputRef,value:this.state.lastInputText,onChangeText:this._onInputTextChange,returnKeyType:"search",placeholder:o,placeholderTextColor:this._themeColors.secondaryTextColor,disableFullscreenUI:!0,editable:!0,allowFontScaling:!1,keyboardAppearance:this._useDarkTheme()?"dark":void 0,autoFocus:!0,clearButtonMode:"never",blurOnSubmit:!0}),a=this._getCancelSearchButton(),l=this._getOptionalCategorySwitcher();return(0,i.jsxs)(n.View,Object.assign({style:b.container},{children:[e,(0,i.jsxs)(n.View,Object.assign({style:b.textInputContainer},{children:[a,(0,i.jsx)(n.View,Object.assign({style:s},{children:r}))]})),l]}))}_getPesSearchResultsCarousal(){return(0,i.jsx)(g.default,{ref:this._onSearchResultsRef,conversationId:this.props.conversationId,onReplaceText:this._insertSearchResult,containerWidth:this.props.containerWidth})}_getCancelSearchButton(){return(0,i.jsx)(r.default,{size:r.ActionButtonSize.Tiny,title:d.getString("MessageComposerOverflow.CloseSearch"),accessibilityLabel:d.getString("MessageComposerOverflow.CloseSearch"),onPress:this._onClearSearchPress,style:b.cancelButton,icon:y.SkypeIcon.Cancel,hideBorder:!0,useSmallIcon:!1,deselected:!0})}_getOptionalCategorySwitcher(){if(this.props.showPesCategorySwitcher)return(0,i.jsx)(u.default,{currentTabType:this.props.pesTabType||m.TabType.Emoticon,onSwitchPesTabType:this._switchPesSearchTabType,showInLandscape:this.props.showInLandscape})}_setSearchResultInput(e){this._searchResults&&this._searchResults.setInputText(e)}_getOptionalPlaceHolder(){switch(this.props.pesTabType){case m.TabType.ChatSticker:return d.getString("MessageComposer.SearchStickersPlaceholder");case m.TabType.Moji:return d.getString("MessageComposer.SearchMojisPlaceholder");case m.TabType.Emoticon:return d.getString("MessageComposer.SearchEmoticonsPlaceholder");case m.TabType.Gif:return d.getString("MessageComposer.SearchGifsPlaceholder");case void 0:return}}}t.PesInlineSearchContainer=T},715521:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GifInlineSearchPreview=t.EmoticonInlineSearchPreview=t.MojiInlineSearchPreview=t.StickerInlineSearchPreview=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(934339),a=s(889391),l=s(351077),d=s(746096),c=s(423790),h=s(497174),u=s(915877),p=s(540897),g=s(331298),m=s(783294),S=s(758962),f=s(785207),y=s(931847),v=s(711828),C=s(24576),_=(0,u.lazyProperties)({suggestionButton:()=>n.Styles.createButtonStyle({height:v.IconSize.size60,width:v.IconSize.size60,borderRadius:10,alignItems:"center",marginHorizontal:5}),gifPreviewButton:()=>n.Styles.createViewStyle({marginHorizontal:3,padding:0})});class b extends C.default{_buildState(e,t){}_getButtonStyle(){return _.suggestionButton}render(){return(0,i.jsx)(n.Button,Object.assign({style:[this._getButtonStyle(),this._themeStyles.buttonBackgroundColorStyle],onPress:this.onPress},{children:this.renderPreview()}))}}t.StickerInlineSearchPreview=class extends b{constructor(){super(...arguments),this._abstractSearchType=S.TabType.ChatSticker,this.onPress=()=>{const e=new h.StickerEntity(this.props.entity.id,this.props.entity.baseUrl,this.props.entity.baseUrl,this.props.entity.name);f.default.postMessageFromInput(this.props.conversationId,d.PostSource.StickerSearch,[e],l.MessageTypes.RichText),p.default.deactivateInlineSearch(),this.props.onPressPreview&&this.props.onPressPreview(this.props.entity.id,!0,1)}}renderPreview(){return(0,i.jsx)(y.default,{src:this.props.entity.baseUrl,etag:this.props.entity.etag,showPlaceholder:!0,dimension:S.frameHeights.stickers.Size50,name:this.props.entity.name},this.props.entity.id)}};t.MojiInlineSearchPreview=class extends b{constructor(){super(...arguments),this._abstractSearchType=S.TabType.Moji,this.onPress=()=>{const e=a.default.getConfigSettings().pes,t=e.xmmFallbackUrl+e.xmmFallbackUrlParams+this.props.entity.id,s=new h.MojiEntity(this.props.entity.id,this.props.entity.baseUrl,this.props.entity.baseUrl+"/views/thumbnail","Video.1/Flik.1",t,"","Moji",this.props.entity.description||"");f.default.postMessageFromInput(this.props.conversationId,d.PostSource.MojiSearch,[s],l.MessageTypes.Media_FlikMsg),p.default.deactivateInlineSearch(),this.props.onPressPreview&&this.props.onPressPreview(this.props.entity.id,!0,1)}}renderPreview(){return(0,i.jsx)(g.MojiItem,{id:this.props.entity.id,info:this.props.entity,isSelected:!1,renderMobileInterface:!0,onSelected:this.onPress,dimension:60,showPlaceholder:!0,showMojiPreviewAsFullScreenModal:!1,hideTitle:!0,sendOnFirstTapIfScreenReaderActive:!0},this.props.entity.id)}};t.EmoticonInlineSearchPreview=class extends b{constructor(){super(...arguments),this._abstractSearchType=S.TabType.Emoticon,this.onPress=()=>{const e=o.head(this.props.entity.shortcuts),t=new h.EmoticonEntity(e,this.props.entity.id,this.props.entity.tone);this.props.onReplaceText(0,o.head(this.props.entity.shortcuts),"Emoticon",t),this.props.onPressPreview&&this.props.onPressPreview(this.props.entity.id,!1,1)}}renderPreview(){return(0,i.jsx)(r.AnimatedEmoticon,{innerText:o.head(this.props.entity.shortcuts),description:this.props.entity.description,emoticonName:this.props.entity.id,size:r.Size.Medium,isStatic:!1,tone:this.props.entity.tone})}};t.GifInlineSearchPreview=class extends b{constructor(){super(...arguments),this._abstractSearchType=S.TabType.Gif,this.onPress=()=>{const e=m.getGifSwiftMessage(this.props.entity),t=new h.SwiftUriObjectEntity(e,this.props.conversationId,!0);f.default.postMessageFromInput(this.props.conversationId,d.PostSource.GifSearch,[t],l.MessageTypes.Media_Card),p.default.deactivateInlineSearch(),this.props.onPressPreview&&this.props.onPressPreview(this.props.entity.id,!0,1)}}_getButtonStyle(){return _.gifPreviewButton}renderPreview(){const e=m.getInlineSearchPreviewDimensions(this.props.deviceOrientation,this.props.isUsingStackNavigation);return(0,i.jsx)(c.GifItem,{id:this.props.entity.id,info:this.props.entity,src:this.props.entity.asmImageProxySmall,isSelected:!1,renderMobileInterface:!0,width:e,height:e,showPlaceholder:!0,onSelected:this.onPress,isUsedForSearch:!0},this.props.entity.id)}}},602295:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesSearchResultsCarousel=void 0;const i=s(785893),o=s(496486),n=s(583367),r=s(516778),a=s(889391),l=s(247409),d=s(898278),c=s(677381),h=s(82433),u=s(443106),p=s(915877),g=s(733754),m=s(540897),S=s(572666),f=s(330124),y=s(715521),v=s(743855),C=s(526424),_=s(696168),b=s(141067),T=s(783294),M=s(617707),I=s(758962),w=s(29130),P=s(451070),k=s(713130),A=s(404057),x=s(24576),R=s(853374),O=(0,p.lazyProperties)({buttonContainer:()=>r.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",paddingBottom:5}),gifScrollViewContainer:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",height:C.PesCarouselGifSizePortrait})});class L extends l.CarouselScrollViewBase{constructor(){super(...arguments),this._keyboardShouldPersistTaps=!0,this._maxNumCarouselItems=20}_height(){return 80}_elementCount(){return o.isEmpty(this.props.items)?0:o.isUndefined(this._maxNumCarouselItems)?this.props.items.length:Math.max(this.props.items.length,this._maxNumCarouselItems)}_renderElements(e){const t=o.isUndefined(this._maxNumCarouselItems)?o.map(this.props.items,this.props.renderItem):o.slice(this.props.items,0,this._maxNumCarouselItems).map(this.props.renderItem);return{elements:(0,i.jsx)(r.View,Object.assign({style:O.buttonContainer},{children:t}))}}_renderEmptyStateElement(){return(0,i.jsx)(r.Text,Object.assign({style:this._themeStyles.secondaryTextColorStyle},{children:this.props.getEmptyStateLabel()}))}}class F extends L{constructor(){super(...arguments),this._maxNumCarouselItems=void 0,this._onScroll=(e,t)=>{if(this._scrollTop=e,this._scrollLeft=t,this.props.nextBatchThreshold&&t>this.props.nextBatchThreshold&&!u.default.isSearching())return this.props.onGetNextBatch()}}_height(){return this.props.isUsingStackNavigation&&this.props.deviceOrientation===n.DeviceOrientation.Landscape?C.PesCarouselGifSizeLandscape:C.PesCarouselGifSizePortrait}_marginTop(){return 0}_enableOnScroll(){return!0}render(){return 0===this.props.nextOffset&&this.props.isSearching?(0,i.jsx)(r.View,Object.assign({style:O.gifScrollViewContainer},{children:(0,i.jsx)(v.default,{})})):super.render()}}class B extends x.default{_buildState(e,t){const s={},i=this.getTabs();return t&&(s.items=this._getItems(e.input,i)),s.tabs=i,s}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),o.isUndefined(this.state.tabs)||e.input===this.props.input&&e.activeTabType===this.props.activeTabType)return;const i=this._getItems(this.props.input,this.state.tabs);0===i.length&&e.input!==this.props.input&&this.props.onNoResults&&this.props.onNoResults(),this._announceSearchResults(i.length),this.setState({items:i})}componentDidMount(){super.componentDidMount(),this._announceSearchResults(this.state.items.length)}_announceSearchResults(e){const t=T.getSearchResultsAnnouncementKey(this.props.activeTabType),s=g.getString(t,{count:e});r.Accessibility.announceForAccessibility(s)}_getItems(e,t){if(o.isEmpty(e))return[];const s=[],i={},n=this.getFilteredPesItemsFromTabs(t,e);return o.each(n,(e=>{o.each(e.packs,(e=>{o.each(e.items,(e=>{const t=this.getPesItem(e);t&&(i[t.id]=t)}))}))})),o.each(i,(e=>{s.push(e)})),s}render(){return(0,i.jsx)(L,{items:this.state.items,renderItem:this.renderItem,getEmptyStateLabel:this.getEmptyStateLabel,preventBubblingOnSwipe:!1})}}class D extends B{constructor(){super(...arguments),this.renderItem=e=>(0,i.jsx)(y.StickerInlineSearchPreview,Object.assign({entity:e},this.props),e.id),this.getEmptyStateLabel=()=>g.getString("PesSearch.StickerPickerNoResultsSearchText")}getPesItem(e){return k.default.getSticker(e)}getTabs(){return _.default.getChatStickerTabs()}getFilteredPesItemsFromTabs(e,t){return T.searchInPackDescriptionAndItemMetadata(e,t)}}class E extends B{constructor(){super(...arguments),this.renderItem=e=>(0,i.jsx)(y.MojiInlineSearchPreview,Object.assign({entity:e},this.props),e.id),this.getEmptyStateLabel=()=>g.getString("PesSearch.MojiPickerNoResultsSearchText")}getPesItem(e){return S.default.getMoji(e)}getTabs(){return _.default.getMojiTabs()}getFilteredPesItemsFromTabs(e,t){return T.searchInPackTitleAndDescription(e,t)}}class V extends B{constructor(){super(...arguments),this.renderItem=e=>(0,i.jsx)(y.EmoticonInlineSearchPreview,Object.assign({entity:e},this.props),e.id),this.getEmptyStateLabel=()=>g.getString("PesSearch.EmoticonPickerNoResultsSearchText")}getPesItem(e){return h.default.getEmoticonByName(e)}getTabs(){return _.default.getEmoticonTabs()}getFilteredPesItemsFromTabs(e,t){return T.searchInPackTitleAndItemKeyword(e,t)}}class N extends c.default{constructor(){super(...arguments),this._renderItem=e=>(0,i.jsx)(y.GifInlineSearchPreview,Object.assign({entity:e,deviceOrientation:this.state.deviceOrientation,isUsingStackNavigation:this.state.isUsingStackNavigation},this.props),e.id),this._getEmptyStateLabel=()=>g.getString("PesSearch.GifPickerNoResultsSearchText"),this._onGetNextBatch=()=>{const e=C.GifSearchMaxResultsCount,t=this._numberOfGifsToRequest();this.state.nextOffset<=e-t&&M.default.getGifsForSearchTerm(this.props.input,t,this.state.nextOffset)}}_numberOfGifsToRequest(e=!1){const t=e?n.DeviceOrientation.Landscape:this.state.deviceOrientation,s=T.getInlineSearchPreviewDimensions(t,this.state.isUsingStackNavigation);if(e){const e=this.state.deviceOrientation===n.DeviceOrientation.Landscape?this.props.containerWidth:2*this.props.containerWidth;return Math.round(e/s)+1}{const e=Math.round(this.props.containerWidth/s);return e>10?10:e}}_getThreshold(e,t){let s;return o.isEmpty(e)||(s=.5*(this._scrollWidth(e,t)-this.props.containerWidth)),s}_scrollWidth(e,t){let s=0;return o.isEmpty(e)||(o.each(e,(e=>{s+=T.getInlineSearchPreviewDimensions(t,this.state.isUsingStackNavigation)})),s+=2*e.length*C.PesCarouselGifHorizontalMarginWidth),s}_buildState(e,t){const s=this._getRootViewId(),i=w.default.getDeviceOrientation(s),n=a.default.getS4LMessagingFeatures().enablePesGifPagination,r=u.default.getGifsForSearch(),l=u.default.isSearching();let d=n&&(t||o.isUndefined(r.nextOffset))?[]:r.gifItems;const c=t?0:this._getThreshold(d,i);let h=r.nextOffset;return!t&&n&&r.searchQuery!==e.input&&(d=[],h=0),{items:d,nextBatchThreshold:c,nextOffset:h,deviceOrientation:i,isSearching:l,isUsingStackNavigation:f.default.isUsingStackNavigationContext()}}componentDidMount(){super.componentDidMount(),this.props.input&&M.default.getGifsForSearchTerm(this.props.input,this._numberOfGifsToRequest(!0))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.input!==this.props.input?M.default.getGifsForSearchTerm(this.props.input,this._numberOfGifsToRequest(!0)):u.default.setSearchParams("")}componentWillUnmount(){super.componentWillUnmount(),u.default.resetSearchGifs(),u.default.setSearchParams("")}render(){return(0,i.jsx)(F,{items:this.state.items,renderItem:this._renderItem,getEmptyStateLabel:this._getEmptyStateLabel,onGetNextBatch:this._onGetNextBatch,nextBatchThreshold:this.state.nextBatchThreshold,nextOffset:this.state.nextOffset,deviceOrientation:this.state.deviceOrientation,isSearching:this.state.isSearching,preventBubblingOnSwipe:!1,isUsingStackNavigation:this.state.isUsingStackNavigation})}}class U extends x.default{constructor(){super(...arguments),this._onPesItemPressed=(e,t,s)=>{this._pesSearchSession&&(this._pesSearchSession.sendSuccessTelemetryEvent(e,this._getQueryLength(),t,s),this._pesSearchSession=void 0)},this._onEmptySearchResultsReturned=()=>{this._pesSearchSession&&this._pesSearchSession.trackNoResultsInSearch()}}_buildState(e,t){let s={};return t&&(s={inputText:m.default.getInitialSearch()}),s.activeTabType=m.default.getActiveTabType(),s.safeAreaHorizontalPaddingStyle=P.default.horizontalPaddingStyle(d.HorizontalInsetDefault),this._pesSearchSession||(this._pesSearchSession=new b.default(!0,s.activeTabType)),s}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.inputText===this.state.inputText&&t.activeTabType===this.state.activeTabType||this._pesSearchSession&&(o.isUndefined(this.state.activeTabType)||t.activeTabType===this.state.activeTabType||(this._pesSearchSession.cancelSessionTelemetryEvent(this._getQueryLength(),!0),this._pesSearchSession=new b.default(!0,this.state.activeTabType)))}render(){if(!this.state.inputText||this.state.activeTabType===I.TabType.Gif&&this.state.inputText.length<C.GifMinSearchChars)return null;let e;const t=Object.assign({input:this.state.inputText||"",activeTabType:this.state.activeTabType,onPressPreview:this._onPesItemPressed,onNoResults:this._onEmptySearchResultsReturned},this.props);switch(this.state.activeTabType){case I.TabType.Emoticon:e=(0,i.jsx)(V,Object.assign({},t));break;case I.TabType.Moji:e=(0,i.jsx)(E,Object.assign({},t));break;case I.TabType.ChatSticker:e=(0,i.jsx)(D,Object.assign({},t));break;case I.TabType.Gif:e=(0,i.jsx)(N,Object.assign({},t));break;default:R.default.switchStatementExhaustiveChecking(this.state.activeTabType)}return(0,i.jsx)(r.Animated.View,Object.assign({style:this.state.safeAreaHorizontalPaddingStyle},{children:e}))}setInputText(e){if(this.isComponentMounted()){const t=A.default.deburrLowerCase(e.trim());this.setState({inputText:t})}}setSearchType(e){this.isComponentMounted()&&this.setState({activeTabType:e})}componentWillUnmount(){super.componentWillUnmount(),this._pesSearchSession&&(this._pesSearchSession.cancelSessionTelemetryEvent(this._getQueryLength(),!1),this._pesSearchSession=void 0)}_getQueryLength(){return o.isUndefined(this.state.inputText)?0:this.state.inputText.length}}t.PesSearchResultsCarousel=U,t.default=U},866559:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(770891),a=s(371639),l=s(733754),d=s(497174),c=s(923944),h=s(915877),u=s(24576),p=s(311010),g=s(723752),m=s(913944),S=s(711828),f=s(106658),y=s(581760),v=s(680837),C=(0,h.lazyProperties)({linkStyle:()=>n.Styles.createTextStyle({fontSize:p.default.controlFontSize.body,lineHeight:18,color:y.Color.gray400,fontFamily:p.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),quoteTextStyle:()=>n.Styles.createTextStyle({fontStyle:"italic"}),quoteAttributeStyle:()=>n.Styles.createTextStyle({fontSize:p.default.controlFontSize.messageStreamQuoteAttributeDesktop,marginTop:0,marginBottom:0}),multiQuoteAreaLastMessage:()=>n.Styles.createViewStyle({marginBottom:0}),multiQuoteArea:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginTop:15,marginBottom:0,marginLeft:20,marginRight:20}),multiQuoteAreaMessages:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",maxHeight:200,paddingBottom:15,borderBottomWidth:1,borderStyle:"solid"}),multiQuoteAreaMessage:()=>n.Styles.createViewStyle({marginBottom:12}),multiQuoteAreaClearButton:()=>n.Styles.createButtonStyle({alignSelf:"flex-start"})});class _ extends u.default{constructor(){super(...arguments),this._onClearQuoteButtonPress=()=>{this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0)}}render(){let e,t=this.props.quotedMessages,s=this._onClearQuoteButtonPress;if(o.isEmpty(t)&&this.props.editedMessage){const i=o.first(this.props.inputEntities);i instanceof d.QuoteEntity&&(t=[this.props.editedMessage],e=c.decodeFromInput([i],!1),s=this.props.onClearEditMessageQuote)}if(t&&t.length>0){const o=p.default.font.uiDisplayBold,d=this.props.showTranslatedMessage||!1,c={linkStyle:this._useDarkTheme()?n.Styles.combine(C.linkStyle,this._themeStyles.linkTextColorStyle||this._themeStyles.primaryTextColorStyle):C.linkStyle,disableActions:this.props.disableActions,quoteSymbolStyle:{size:S.IconSize.size20,color:this._themeColors.primaryTextColor},quotedTextStyle:C.quoteTextStyle,atMentionStyle:o,atMentionMeOverrideStyle:o,showTranslatedMessage:d,hasTranslation:d,renderOrigin:r.MessageRenderOrigin.MessageComposerCanvas,asQuoteInComposer:!0};if(c.textOverrideStyle=[this._themeStyles.primaryTextColorStyle],c.quoteAttributeStyle=[C.quoteAttributeStyle,this._themeStyles.secondaryTextColorStyle],this.props.messageStreamFontSize!==f.MessageStreamFontSize.Normal){const e=p.default.controlFontSize.messageStreamItemDesktop,t=a.getStyle(e,this.props.messageStreamFontSize),s=a.getStyle(p.default.controlFontSize.messageStreamQuoteAttributeDesktop,this.props.messageStreamFontSize);c.textOverrideStyle.push(t),c.quoteAttributeStyle.push(s),c.fontSize=a.getSize(e,this.props.messageStreamFontSize)}const h=t.length-1,u=t.map(((t,s)=>(0,i.jsx)(n.View,Object.assign({style:s===h?C.multiQuoteAreaLastMessage:C.multiQuoteAreaMessage},{children:(0,i.jsx)(g.default,{message:t,preDecodedMessage:e,wrapInQuote:!e,options:c})}),`quote-${s}`)));return(0,i.jsxs)(n.View,Object.assign({style:C.multiQuoteArea},{children:[(0,i.jsx)(n.View,Object.assign({style:[C.multiQuoteAreaMessages,this._themeStyles.secondaryDividerBorderStyle]},{children:(0,i.jsx)(n.ScrollView,Object.assign({style:v.default.flexOne},{children:u}))})),(0,i.jsx)(m.default,{title:l.getString("MessageComposer.RemoveQuoteButtonTitle"),style:C.multiQuoteAreaClearButton,onPress:s,size:S.IconSize.size16,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconHoverColor,icon:S.SkypeIcon.Cancel,disabled:this.props.disableActions},"clearbutton")]}))}}}t.default=_},23474:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(54569),a=s(913944),l=s(915877),d=s(733754),c=s(24576),h=s(711828),u=s(581760),p=s(626712),g=s(910265),m=s(147204),S=s(898278),f=s(547126),y=s(190631),v=s(680837),C=s(587134),_=s(724067),b=s(850488),T=345,M=(0,l.lazyProperties)({linkModal:()=>(0,l.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column"}),textInput:()=>n.Styles.createTextInputStyle({flex:1,paddingVertical:19,lineHeight:22,backgroundColor:u.Color.transparent}),contentContainer:()=>n.Styles.createViewStyle({flexGrow:1,marginHorizontal:20})}),container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start",padding:10,borderTopWidth:1,borderLeftWidth:1,borderRightWidth:1}),containerRoundedCorners:()=>n.Styles.createViewStyle({borderTopLeftRadius:24,borderTopRightRadius:24}),iconButton:()=>n.Styles.createButtonStyle({width:h.IconSize.size32,height:h.IconSize.size32,alignSelf:"center"})});class I extends c.default{constructor(){super(...arguments),this._onPress=e=>{e.preventDefault(),this.props.onDone({textToDisplay:this.state.textToDisplay||this.state.linkHref,linkHref:this.state.linkHref}),this._dismissDialog()},this._dismissDialog=()=>{m.default.dismissModal("linkModal",this._getRootViewId())},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._onLinkInputRef=e=>{this._linkInputRef=e||void 0},this.requestTextInputFocus=()=>{var e;null===(e=this._textInputRef)||void 0===e||e.requestFocus()},this.requestLinkInputFocus=()=>{var e;null===(e=this._linkInputRef)||void 0===e||e.requestFocus()},this._onKeyDown=e=>!(e.keyCode!==f.default.ENTER||!p.default.isUrlValid(this.state.linkHref))&&(this._onPress(e),!0),this._dismissModal=()=>{m.default.dismissModal("linkModal",this._getRootViewId())}}_buildState(e,t){if(t){const t=p.default.isUrlValid(e.initialSelection);return{textToDisplay:t?"":e.initialSelection,linkHref:t?e.initialSelection:""}}return{}}componentDidMount(){super.componentDidMount(),n.Input.keyDownEvent.subscribe(this._onKeyDown),this.state.textToDisplay?this.requestLinkInputFocus():this.requestTextInputFocus()}componentWillUnmount(){super.componentWillUnmount(),n.Input.keyDownEvent.unsubscribe(this._onKeyDown)}render(){const e={text:d.getString("LinkCreation.DialogConfirmationButton"),onPress:this._onPress,disabled:!p.default.isUrlValid(this.state.linkHref)},t=n.Styles.createTextInputStyle({color:this._useDarkTheme()?u.Color.white:u.Color.black},!1);return(0,i.jsxs)(g.default,Object.assign({dialogId:"linkModal",closeOnClickOutside:!0,maxWidth:T,fullScreen:!1,useFullSizeContainer:!0,containerStyle:this._themeStyles.primaryBackgroundColorStyle},{children:[(0,i.jsx)(y.SimplePanelHeader,{panelName:d.getString("LinkCreation.Header"),leftButton:{closeButtonType:y.CloseButtonType.Close,onPress:this._dismissModal},useCenteredControls:!0}),(0,i.jsx)(n.View,Object.assign({style:M.linkModal.container},{children:(0,i.jsx)(n.View,Object.assign({style:[v.default.flexOne]},{children:(0,i.jsxs)(n.View,Object.assign({style:M.linkModal.contentContainer},{children:[(0,i.jsx)(n.TextInput,{style:[M.linkModal.textInput,t],placeholder:d.getString("LinkCreation.TextToDisplayPlaceholder"),value:this.state.textToDisplay,onChangeText:e=>this.setState({textToDisplay:e}),ref:this._onTextInputRef}),(0,i.jsx)(C.default,{}),(0,i.jsx)(n.TextInput,{style:[M.linkModal.textInput,t],placeholder:d.getString("LinkCreation.LinkAddressPlaceholder"),value:this.state.linkHref,onChangeText:e=>this.setState({linkHref:e}),ref:this._onLinkInputRef}),(0,i.jsx)(C.default,{})]}))}))})),(0,i.jsx)(_.default,{button:e})]}))}}class w extends c.default{constructor(){super(...arguments),this._makeLink=e=>({type:r.EditableEntityType.PlainText,displayText:`[${null==e?void 0:e.textToDisplay}](${null==e?void 0:e.linkHref})`}),this._getSelectedText=()=>{let e="";if(this.props.textInputRef){const t=this.props.textInputRef.getEditorState(),s=t.getSelection(),i=t.getCurrentContent().getPlainText(),o=s.getAnchorOffset(),n=s.getFocusOffset();e=i.substring(o,n)}return e},this._createEntityType=(e,t)=>{if(this.props.textInputRef){const s=this.props.textInputRef.getEditorState().getSelection(),i=this._getSelectedText(),n=e===b.FormatterTypes.Link?this._makeLink(t):{type:r.EditableEntityType.PlainText,displayText:`${e}${i}${e}`};if(this.props.textInputRef.insertContent(n,s),0===i.length&&e!==b.FormatterTypes.Link){const t=this._getCaretPosition();if(o.isUndefined(t))return;const s=t+e.length;o.defer((()=>{this.props.textInputRef&&this.props.textInputRef.setCaretPosition(s)}))}}},this._renderBoldButton=()=>(0,i.jsx)(a.default,{style:M.iconButton,icon:h.SkypeIcon.Bold,size:h.IconSize.size16,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconHoverColor,title:d.getString("Formatting.Bold"),accessibilityLabel:d.getString("Formatting.Bold"),onPress:this._onBoldButtonClick,autoFocus:!0}),this._onBoldButtonClick=()=>{this._createEntityType(b.FormatterTypes.Bold)},this._renderItalicButton=()=>(0,i.jsx)(a.default,{style:M.iconButton,icon:h.SkypeIcon.Italic,size:h.IconSize.size16,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconHoverColor,title:d.getString("Formatting.Italic"),accessibilityLabel:d.getString("Formatting.Italic"),onPress:this._onItalicButtonClick}),this._onItalicButtonClick=()=>{this._createEntityType(b.FormatterTypes.Italic)},this._renderStrikeButton=()=>(0,i.jsx)(a.default,{style:M.iconButton,icon:h.SkypeIcon.Strikethrough,size:h.IconSize.size16,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconHoverColor,title:d.getString("Formatting.StrikeThrough"),accessibilityLabel:d.getString("Formatting.StrikeThrough"),onPress:this._onStrikeButtonClick}),this._onStrikeButtonClick=()=>{this._createEntityType(b.FormatterTypes.StrikeThrough)},this._renderCodeButton=()=>(0,i.jsx)(a.default,{style:M.iconButton,icon:h.SkypeIcon.CodeSnippet,size:h.IconSize.size16,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconHoverColor,title:d.getString("Formatting.Code"),accessibilityLabel:d.getString("Formatting.Code"),onPress:this._onCodeButtonClick}),this._onCodeButtonClick=()=>{this._createEntityType(b.FormatterTypes.Code)},this._renderHyperlinkButton=()=>(0,i.jsx)(a.default,{style:M.iconButton,icon:h.SkypeIcon.Link,size:h.IconSize.size16,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconHoverColor,title:d.getString("Formatting.Hyperlink"),accessibilityLabel:d.getString("Formatting.Hyperlink"),onPress:this._onHyperlinkButtonClick}),this._onHyperlinkButtonClick=()=>{const e=(0,i.jsx)(I,{initialSelection:this._getSelectedText(),onDone:e=>{this._createEntityType(b.FormatterTypes.Link,e)}});m.default.showModal(e,"linkModal",{rootViewId:S.MainRootViewId})}}_getCaretPosition(){if(this.props.textInputRef){return this.props.textInputRef.getEditorState().getSelection().getAnchorOffset()}}render(){const e=n.Styles.createViewStyle({backgroundColor:this._useDarkTheme()?u.Color.darkThemeSecondaryBackground:this._themeColors.surfacePrimary,borderColor:this._themeColors.dividerPrimary},!1),t=[M.container,e];return this.props.isTopPanel&&w&&t.push(M.containerRoundedCorners),(0,i.jsxs)(n.View,Object.assign({style:t},{children:[this._renderBoldButton(),this._renderItalicButton(),this._renderStrikeButton(),this._renderCodeButton(),this._renderHyperlinkButton()]}))}}t.default=w},965988:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(934339),r=s(898278),a=s(915877),l=s(733754),d=s(29130),c=s(22222),h=s(24576),u=(0,a.lazyProperties)({container:()=>o.Styles.createViewStyle({alignItems:"center",padding:20,marginTop:15,marginRight:15,marginLeft:15,marginBottom:5,borderStyle:"solid",borderBottomWidth:1}),row:()=>o.Styles.createViewStyle({marginBottom:20}),noBorder:()=>o.Styles.createViewStyle({borderTopWidth:0,borderBottomWidth:0})});class p extends h.default{_buildState(e,t){let s=!0;{const t=this._getRootViewId(),i=d.default.getHeight(t),o=d.default.getWidth(t);(i<700||o<1e3)&&(s=!!e.alwaysForceEmoticon)}return{showEmoticon:s}}render(){if(!this.props.displayName)return null;const e=void 0===this.props.showBorder||this.props.showBorder;let t;return this.state.showEmoticon&&(t=(0,i.jsx)(o.View,Object.assign({style:u.row},{children:(0,i.jsx)(n.AnimatedEmoticon,{size:n.Size.ExtraLarge,emoticonName:"hi"})}))),(0,i.jsxs)(o.View,Object.assign({style:[this._themeStyles.dividerBorderColorStyle,u.container,e?{}:u.noBorder]},{children:[t,(0,i.jsx)(o.View,{children:(0,i.jsx)(c.default,{buttonSize:r.SXButtonSize.Small,title:l.getString("MessageStream.WaveButton"),allowTextWrap:!1,onPress:this.props.onGreet})})]}))}}t.default=p},42036:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(47282),n=s(550785),r=s(117619),a=s(397691),l=s(219784),d=s(720603),c=s(225638),h=s(265976),u=s(871908),p=s(351077),g=s(297297),m=s(681959),S=s(882261),f=s(816402),y=s(437490),v=s(952262),C=s(606452),_=s(770891),b=s(746096),T=s(907234),M=s(462937),I=s(469382),w=s(211276),P=s(436237),k=s(733754),A=s(518606),x=s(714597),R=s(764387),O=s(312762),L=s(50353),F=s(812056),B=s(10909),D=s(104735),E=s(822669),V=s(680457),N=s(785207),U=s(699097),j=s(746096),H=s(914976),z=s(933825),W=s(404057),G=(s(626712),s(400451));t.default=new class{deleteMessage(e,t,s,i){const o=R.default.isMediaItem(e);let n=s?s.title:"",r=s?s.body:"";if(!s){let t="Global.RemoveMessage",s="Global.RemoveMessageContent";const i=p.getMessageTypeGroup(e);i===p.MessageTypeGroups.Picture?(t="Global.RemovePhoto",s="Global.RemoveMessagePhotoContent"):i===p.MessageTypeGroups.Video?(t="Global.RemoveVideo",s="Global.RemoveMessageVideoContent"):(o||e.isAlbum())&&(t="Global.RemoveMedia",s="Global.RemoveMessageMediaContent"),n=k.getString(t),r=k.getString(s)}const a=[{text:k.getString("Global.CancelLabel"),isCancel:!0},{text:k.getString("Global.RemoveLabel"),onPress:()=>this._delete(e,i),style:"destructive",isSubmit:!0}];l.default.showWithOptions({title:n,dialogAccessibilityTitle:r,message:r,buttons:a,rootViewId:t})}deleteMultipleMessages(e,t,s){const o=k.getString("Global.RemoveMultipleMessages",{count:e.length}),n=k.getString("Global.RemoveMultipleMessagesContent",{count:e.length}),r=[{text:k.getString("Global.CancelLabel"),isCancel:!0},{text:k.getString("Global.RemoveLabel"),onPress:()=>{i.each(e,(e=>{this._delete(e)})),s()},style:"destructive",isSubmit:!0}];l.default.showWithOptions({title:o,dialogAccessibilityTitle:n,message:n,buttons:r,rootViewId:t})}cancelFailedSend(e){const{conversationId:t,createdTime:s}=e;N.default.cancelFailedPost(e);const i=new F.MessageActionTelemetry(t,e,s,F.MessageActionOrigin.StreamItem,F.MessageActionType.CancelRejected);P.track(i)}retryFailedSend(e){const t=e.getSendRetryInfo();if(t&&N.default.canRetry(t)){const s=this._getDocId(e);N.default.retry(t,s);const i=new F.MessageActionTelemetry(e.conversationId,e,e.createdTime,F.MessageActionOrigin.StreamItem,F.MessageActionType.RetryFailed,s);P.track(i)}else P.warn(b.LogTraceArea.MessageOptionsHelper,"StreamItem: Cannot retry failed send with this info, but we gave the option to retry")}_getDocId(e){const t=e.getSendRetryInfo();if(t&&t.kind===V.PostUploadInfoKind)return i.first(t.messagesForPosting[e.conversationId].amsreferences)}_delete(e,t){e.hasAlbumId()?this._deleteAlbumMessage(e):N.default.deleteMessage(e,b.PostSource.MessageOptionsDelete),t&&t()}_deleteAlbumMessage(e){const t=e.getAlbumId();if(e.isAlbum())return void this._deleteAlbum(e);const s=A.default.getAlbumMessage(t);s&&1===A.default.getAllMediaMessagesForAlbum(t).length?this._deleteAlbum(s):N.default.deleteMessage(e,b.PostSource.MessageOptionsDelete)}_deleteAlbum(e){const t=e.getAlbumId(),s=A.default.getAllMediaMessagesForAlbum(t);N.default.deleteMessage(e,b.PostSource.MessageOptionsDelete),i.each(s,(e=>N.default.deleteMessage(e,b.PostSource.MessageOptionsDelete)))}cancelMessageSend(e,t){if(R.default.isVideo(e)){const s=k.getString("VideoNode.CancelSendTitle"),i=k.getString("VideoNode.CancelSendBody"),o=[{text:k.getString("Global.YesLabel"),onPress:()=>this._cancelMessageSend(e,F.MessageActionOrigin.StreamItem),style:"destructive",isSubmit:!0},{text:k.getString("Global.NoLabel"),isCancel:!0}];l.default.showWithOptions({title:s,dialogAccessibilityTitle:i,message:i,buttons:o,rootViewId:t})}else this._cancelMessageSend(e,F.MessageActionOrigin.StreamItem)}_cancelMessageSend(e,t){const s=e,{conversationId:o,createdTime:n}=s;i.each(s.getUnacknowledgedClientMessageIds(),(e=>{N.default.cancelPostMessage(o,e)}));const r=this._getDocId(e),a=new F.MessageActionTelemetry(o,s,n,t,F.MessageActionType.Cancel,r);P.track(a)}_getReportContextForMessage(e){switch(p.getMessageTypeGroup(e)){case p.MessageTypeGroups.UriFile:return j.ReportContextListOptions.FileMessage;case p.MessageTypeGroups.Picture:return j.ReportContextListOptions.PictureMessage;case p.MessageTypeGroups.Audio:return j.ReportContextListOptions.AudioMessage;case p.MessageTypeGroups.Video:return j.ReportContextListOptions.VideoMessage;default:return j.ReportContextListOptions.Message}}reportMessage(e,t){y.dismissAll();const s={mriToBlock:e.creator,rootViewId:t,content:e,reportContext:this._getReportContextForMessage(e),isBlockingDialog:!1};D.default.navigateToReportConcernModal(s)}showReportedMessage(e){u.markMessageReported(e,!1);const{conversationId:t,createdTime:s}=e,i=new F.MessageActionTelemetry(t,e,s,F.MessageActionOrigin.StreamItem,F.MessageActionType.ShowReportedMessage);P.track(i)}_copyTextToClipboard(e,t,s){let i,o;s?i=s:z.isTextSelected()?i=z.getSelectedText():(i=m.renderText(t,{message:e,processing:_.ProcessingDefaults.Stripped}),t.hasHtmlContent()&&(o=g.renderHtml(t))),o?r.default.setHtml(o,i):i&&G.default.writeText(i)}copyMultipleMessages(e,t){let s="";i.each(e,(e=>{const t=v.default.getMemberShortNameForConversation(e.message.conversationId,e.message.creator),i=f.default.getDisplayTimeString(e.message.createdTime),o=k.getString("MessageStream.CopyMetadata",{displayName:t,time:i}),n=m.renderText(e.node,{message:e.message,processing:_.ProcessingDefaults.Stripped})+"\r\r";s=s+o+"\r"+n})),s&&G.default.writeText(s.trim()),B.default.scheduleTextMessage(k.getString("MessageStream.MessageCopied"),void 0,t)}copyMessage(e,t,s,i){this._copyTextToClipboard(e,t,i);const o=new F.MessageActionTelemetry(e.conversationId,e,e.createdTime,F.MessageActionOrigin.StreamItem,F.MessageActionType.Copy);B.default.scheduleTextMessage(k.getString("MessageStream.MessageCopied"),void 0,s),P.track(o)}copyLinkMessage(e,t){G.default.writeText(e);const s=new F.MessageActionTelemetry(t.conversationId,t,t.createdTime,F.MessageActionOrigin.StreamItem,F.MessageActionType.CopyLink);P.track(s)}copyLocationMessage(e,t){this._copyTextToClipboard(e,t,void 0);const s=new F.MessageActionTelemetry(e.conversationId,e,e.createdTime,F.MessageActionOrigin.StreamItem,F.MessageActionType.Copy);P.track(s)}viewLink(e,t){e&&l.default.showOKAlert("",e,t,!0)}copyImageFromMessage(e){const t=R.default.getMediaDescriptorForItem(e);if(t&&t.mediaType===E.PictureViewer.MediaType){this.copyImage(t.fullResolutionUrl);const s=new F.MessageActionTelemetry(e.conversationId,e,e.createdTime,F.MessageActionOrigin.StreamItem,F.MessageActionType.Copy);P.track(s)}else P.warn(b.LogTraceArea.MessageOptionsHelper,"Trying to copy message that is not an image as an image.")}copyImage(e){w.copyImageToClipboard(e)}markMessageUnread(e,t){const{conversationId:s,createdTime:i}=e,o=new F.MessageActionTelemetry(s,e,i,F.MessageActionOrigin.StreamItem,F.MessageActionType.MarkMessageUnread);P.track(o),u.markMessageUnreadFromGivenMessage(e).then((e=>{t&&t(e)})).catch((e=>{P.warn(b.LogTraceArea.MessageOptionsHelper,"StreamItem could not set consumption horizon")}))}openOnDesktop(e,t,s,i,o,n){return!1}openMediaLocationOnDesktop(e){this._openFileLocation(h.getFileCacheKeyMedia(e,!0))}openFileLocationOnDesktop(e){const t=e.getFirstUriObjectChild(O.UriObjectFileNode);if(!t)return;const s=new c.default(t.getFileContentUrlSanitized()).getDocumentId();s&&this._openFileLocation(s)}_openFileLocation(e){const t=M.default.getLocalUri(e);t&&I.openFileLocation(t)}_trackDownload(e,t,s,i,o){const n=C.default.downloadUpdated.subscribe((r=>{if(r.key!==e||!r.isFinished)return;const a=r.amsGetStatusTransfer&&r.amsGetStatusTransfer.success,l=r.downloadTransfer&&r.downloadTransfer.success;(a||l)&&r.downloadTempLocalUri?o?o(e,r.downloadTempLocalUri):this._downloadSuccess(e,r.downloadTempLocalUri,t,s,i):(i&&s.hasAlbumId()&&A.default.markAlbumMessageDownloadCompleted(s.getAlbumId(),s.cuid),B.default.scheduleTextMessage(k.getString("MediaViewer.SaveFailure"),void 0,t)),B.default.removeToastMessage(`${e}-downloading`),n.unsubscribe()}));i&&s.hasAlbumId()&&!A.default.isDownloadingAlbum(s.getAlbumId())&&A.default.startAlbumDownload(s.getAlbumId()),this._showDownloadingToast(`${e}-downloading`,t)}_downloadSuccess(e,t,s,i,o){let n=k.getString("MediaViewer.SaveSuccess");if(o&&i.hasAlbumId()){const e=i.getAlbumId();if(A.default.markAlbumMessageDownloadCompleted(e,i.cuid),A.default.isDownloadingAlbum(e))return;A.default.getAllMediaMessagesForAlbum(e).length>1&&(n=k.getString("MediaViewer.SaveAllSuccess"))}B.default.scheduleMessage({key:e,textMessage:n,onPress:()=>I.openFile(t),rootViewId:s})}_handleFileFromCache(e,t){if(T.default.isLocalCacheSupported()&&T.default.isKnown(e)){const s=T.default.getLocalUri(e);if(s)return t(s),!0}return!1}saveToDesktop(e,t,s,o,r,l,d){{const o=p.getMessageTypeGroup(e);i.isEmpty(s)&&(o===p.MessageTypeGroups.Picture?s=k.getString("StreamItem.SavePictureFileName"):o===p.MessageTypeGroups.Video&&(s=k.getString("StreamItem.SaveVideoFileName"))),n.default.saveFile(t,s)}return this._checkFileStatusAvailabilityAsync(t).then((()=>!0)).fail((e=>(P.error(b.LogTraceArea.MessageOptionsHelper,`saveToDesktop failed: ${W.default.errorAsString(e)}`),B.default.scheduleTextMessage(k.getString("MediaViewer.SaveFailure"),void 0,l),a.Resolved(!1))))}desktopSaveAs(e,t,s,i,o,n,r){}_checkFileStatusAvailabilityAsync(e){const t=new c.default(e),s=t.getDocumentId(),i=t.getViewId();return s&&i?d.default.getStatusAsync(s,i).then((e=>e?a.Resolved():a.Rejected(`Check file status availability async failed. StatusInfo:  ${W.default.errorAsString(e)}`))):a.Rejected("Check file status availability async failed, amsObjectId missing.")}downloadToCameraRoll(e,t,s,i,o,n,r){const a=h.getFileCacheKeyMedia(e,!0);this.saveToDesktop(e,t,s,a,i,o,n).then((a=>{if(a)return;const l=h.getFileCacheKeyMedia(e,!0),d=T.default.getLocalUri(l);d?this.saveToCameraRoll(e,d,o,n,r):x.default.isQueued(l)||U.default.requestCameraRollPermission().then((a=>{if(P.log(b.LogTraceArea.MessageOptionsHelper,"downloadToCameraRoll: Access allowed?",a?"yes":"no"),a){const a=new x.QueueItem(l,t,s,"streamItem",Date.now()+36e5,T.CacheEvictionKind.UserInvolved,Date.now());x.default.add(a,i).then((s=>{s.cancelled?P.log(b.LogTraceArea.StreamItem,"Media prefetching cancelled for: ",H.dev_unknownOmit(l),H.dev_unknownOmit(t)):this.saveToCameraRoll(e,s.url,o,n,r)})).catch((e=>{P.error(b.LogTraceArea.MessageOptionsHelper,"Something went wrong in prefetching media to cache: ",l,H.dev_unknownOmit(t),W.default.errorAsString(e))}))}}))}))}saveToCameraRoll(e,t,s,i,n){const r="downloading";U.default.requestCameraRollPermission().then((a=>{if(P.log(b.LogTraceArea.MessageOptionsHelper,"CameraRoll: Access allowed?",a?"yes":"no"),a){const a=p.getMessageTypeGroup(e);let l="photo";a===p.MessageTypeGroups.Video?l="video":a===p.MessageTypeGroups.Audio&&(l="audio");const d="audio"===l?void 0:l;i&&e.hasAlbumId()?A.default.isDownloadingAlbum(e.getAlbumId())||(A.default.startAlbumDownload(e.getAlbumId()),this._showDownloadingToast(r,s)):this._showDownloadingToast(r,s),o.default.saveToCameraRoll(t,d).then((o=>{P.log(b.LogTraceArea.MessageOptionsHelper,"Saved successfully to the CameraRoll",H.dev_unknownOmit(t)),I.addMediaToSkypeAlbum(o).fail((()=>{P.warn(b.LogTraceArea.MessageOptionsHelper,"CameraRoll: failed to add media to Skype album")})).always((()=>{this._onCameraRollSave(l,s,e.getAlbumId(),i)})),n&&n(!0)})).catch((e=>{let t;P.error(b.LogTraceArea.MessageOptionsHelper,"Error saving to the CameraRoll.",W.default.errorAsString(e)),t="photo"===l?k.getString("MessageActionMenu.PhotoSaveFailNotification"):"audio"===l?k.getString("MessageActionMenu.AudioSaveFailNotification"):k.getString("MessageActionMenu.VideoSaveFailNotification"),t&&B.default.scheduleTextMessage(t,void 0,s),n&&n(!1)})).finally((()=>{i&&e.hasAlbumId()&&(A.default.markAlbumMessageDownloadCompleted(e.getAlbumId(),e.cuid),A.default.isDownloadingAlbum(e.getAlbumId()))||B.default.removeToastMessage(r)}))}}))}_onCameraRollSave(e,t,s,i){let o;switch(e){case"photo":o=k.getString("MessageActionMenu.PhotoSavedNotification");break;case"audio":o=k.getString("MessageActionMenu.AudioSavedNotification");break;case"video":o=k.getString("MessageActionMenu.VideoSavedNotification");break;default:o=k.getString("MediaViewer.SaveAsSuccess")}if(i&&s){if(A.default.isDownloadingAlbum(s))return;A.default.getAllMediaMessagesForAlbum(s).length>1&&(o=k.getString("MediaViewer.SaveAllSuccess"))}B.default.scheduleTextMessage(o,void 0,t)}_showDownloadingToast(e,t){B.default.scheduleMessage({key:e,duration:3e5,textMessage:k.getString("MediaViewer.Downloading"),rootViewId:t})}dumpMessage(e,t){const s=JSON.stringify(e,null,t?4:void 0),i=S.createMessageInfoFromEscapedText(e.conversationId,b.PostSource.StreamItemCommand,s);L.default.cachedStoreFor(e.conversationId,void 0).feedEphemeralMessage(i)}}},980760:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StatusPillView=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(746096),a=s(139285),l=s(436237),d=s(915877),c=s(733754),h=s(886045),u=s(344352),p=s(450795),g=s(581760),m=s(182146),S=s(359405),f=s(680837),y=s(619675),v=s(24576),C=s(912770),_=s(619675),b=s(104735),T=s(110117),M=s(711828),I=s(124221),w=(0,d.lazyProperties)({stickyStreamDividerContainer:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,flexDirection:"row",justifyContent:"center",alignItems:"flex-end",overflow:"hidden"}),textStyle:()=>(0,d.lazyProperties)({default:()=>n.Styles.createTextStyle({color:g.Color.gray400}),white:()=>n.Styles.createTextStyle({color:g.Color.white}),whiteSearch:()=>n.Styles.createTextStyle({flexDirection:"row",color:g.Color.white,alignItems:"center",justifyContent:"center"}),searchButtons:()=>n.Styles.createTextStyle({fontSize:12})}),pill:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",minHeight:30,borderRadius:15,paddingHorizontal:25,backgroundColor:g.Color.gray100Overlay80}),pillStyle:()=>(0,d.lazyProperties)({default:()=>n.Styles.createViewStyle({backgroundColor:g.Color.gray100Overlay80}),darkGreyBg:()=>n.Styles.createViewStyle({backgroundColor:g.Color.gray300}),blackBg:()=>n.Styles.createViewStyle({backgroundColor:g.Color.black}),blueBg:()=>n.Styles.createViewStyle({backgroundColor:g.Color.blue}),searchHistoryButtons:()=>n.Styles.createViewStyle({flexDirection:"row",paddingLeft:8})}),relativePosition:()=>n.Styles.createViewStyle({position:"relative"}),searchButton:()=>n.Styles.createViewStyle({flexDirection:"row",paddingLeft:8,alignItems:"center"}),icons:()=>n.Styles.createViewStyle({flexDirection:"row",paddingRight:3})}),P=e=>{l.log(r.LogTraceArea.ConnectivityStatusBar,e)},k=e=>o.isUndefined(e.status)?void 0:u.PillStatus[e.status];class A extends v.default{constructor(){super(...arguments),this._verticalAnimatedValue=new n.Animated.Value(-40.7),this._verticalAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{translateY:this._verticalAnimatedValue}]}),this.touch=()=>{this.state.content?(this._hiding&&this._animation&&(P("touch: currently hiding, stopping animation"),this._animation.stop()),this.state.shown||this._showing||(P("touch: hidden, start the animation"),this._animation=p.default.easeOut({value:this._verticalAnimatedValue,toValue:0}),this._showing=!0,this._animation.start((()=>{P("touch: show animation finished"),this.isComponentMounted()&&(this._showing=!1,this.setState({shown:!0}),this._scheduleHide())}))),this._hideTimeout&&(P("touch: hide timer exists, cleaning and scheduling new one"),C.default.clearTimeout(this._hideTimeout),this._hideTimeout=void 0,this._scheduleHide())):P("touch: returning, no content")},this.handleMouseEnter=()=>{this.state.status===u.PillStatus.SEARCH&&this._hideTimeout&&(P("touch: hide timer exists, cleaning because user is hovering over the pill"),C.default.clearTimeout(this._hideTimeout),this._hideTimeout=void 0)},this.handleMouseLeave=()=>{this.state.status===u.PillStatus.SEARCH&&this._scheduleHide(3e3)},this._scheduleHide=(e=5e3)=>{var t,s;if(!this._shouldAutoHide(this.state))return void P("scheduleHide: early return, _shouldAutoHide returned false. NOT scheduling timer");let i;P("scheduleHide: scheduling hide"),i=this.state.status===u.PillStatus.SEARCH?e:null!==(s=null===(t=this.props.customAutoHideBehaviour)||void 0===t?void 0:t.customAutoHideTimeout)&&void 0!==s?s:1500,this._hideTimeout=C.default.setTimeout(this._dangerouslyHideWithoutTimer,i)},this._dangerouslyHideWithoutTimer=()=>{!this._hiding&&this.state.shown&&(this._hideTimeout&&(C.default.clearTimeout(this._hideTimeout),this._hideTimeout=void 0),this._animation=p.default.easeOut({value:this._verticalAnimatedValue,toValue:-40.7}),this._hiding=!0,P("scheduleHide: starting hide animation"),this._animation.start((()=>{var e,t;P("scheduleHide: hide animation finished"),this.isComponentMounted()&&(this._hiding=!1,this.setState({shown:!1}),null===(t=null===(e=this.props.customAutoHideBehaviour)||void 0===e?void 0:e.onAutoHidden)||void 0===t||t.call(e),this.state.status===u.PillStatus.SEARCH&&this.props.statusPillInstance.enableSearchPill(!1))})))},this._onPress=e=>{var t,s;e.stopPropagation(),this._dangerouslyHideWithoutTimer(),null===(s=(t=this.props).onClickOverride)||void 0===s||s.call(t)},this._getLastImageSent=e=>{e.stopPropagation(),this.props.conversationId&&(l.track(new I.EnhancedHistorySearchEvent(I.EnhancedHistorySearchActionType.QuickLastImage)),this._revealInConversation(this.state.lastMediaInConversation))},this._getLastLinkSent=e=>{e.stopPropagation(),this.props.conversationId&&(l.track(new I.EnhancedHistorySearchEvent(I.EnhancedHistorySearchActionType.QuickLastLink)),this._revealInConversation(this.state.lastLinkInConversation))},this._revealInConversation=o.debounce((e=>{e&&(0,S.getGalleryItemTimestamp)(e.cuid,e.conversationId,Number(e.getOriginalServerId())).then((t=>{this.isComponentMounted&&(this._scheduleHide(0),this.props.statusPillInstance.enableSearchPill(!1),b.default.navigateToMessageFromSearchMessagePanel((null==t?void 0:t.timestamp)||e.createdTime,e.conversationId,this._getRootViewId()))}))}),300)}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this.props.statusPillInstance.setMessageStreamStore(this.props.messageStreamStore)}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),this.props.statusPillInstance.setMessageStreamStore(e.messageStreamStore)}_shouldAutoHide(e){var t,s;return null!==(s=!(null===(t=this.props.customAutoHideBehaviour)||void 0===t?void 0:t.autoHideDisabled))&&void 0!==s?s:!o.includes([u.PillStatus.NO_CONNECTION,u.PillStatus.CONNECTING,u.PillStatus.UPDATING],e.status)}_shouldDisableClickEvents(e){return this._shouldAutoHide(e)&&void 0===this.props.onClickOverride}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.content!==t.content&&(P(`The content changed: ${k(t)} -> ${k(this.state)}, calling touch().`),this.touch(),this._announceUpdatedStateForA11y(this.state,t)),!this._shouldAutoHide(t)&&this._shouldAutoHide(this.state)&&(P("ShouldAutoHide changed from false to true, calling _scheduleHide()."),this._scheduleHide())}componentWillUnmount(){super.componentWillUnmount(),this.props.statusPillInstance.setMessageStreamStore(void 0),this._hideTimeout&&(C.default.clearTimeout(this._hideTimeout),this._hideTimeout=void 0)}componentDidMount(){super.componentDidMount(),this._shouldAutoHide(this.state)||(P(`Just mounted, displaying content that shouldn't be auto hidden: ${k(this.state)} `),this.touch())}_buildState(e,t){var s;const i=void 0!==e.connectionStatusOnly&&e.connectionStatusOnly,o=e.customContent?u.PillStatus.INFO:e.statusPillInstance.getPillStatus(),n={showAsUnread:e.statusPillInstance.showAsUnread(),content:null!==(s=e.customContent)&&void 0!==s?s:e.statusPillInstance.getContent(i,e.conversationId),status:o,accentColor:this._getContext().userColor.primaryAccent};return e.conversationId&&(n.lastMediaInConversation=m.default.getMediaForConversation(e.conversationId,Date.now(),1,t,!0,void 0)[0],n.lastLinkInConversation=m.default.getLinksForConversation(e.conversationId,Date.now(),1,t,!0)[0]),t&&(n.shown=!1,n.enabledForInfo=void 0!==e.customContent),n}_getPillStyle(){const e=this._getAccentColor(),t=n.Styles.createViewStyle({backgroundColor:this._themeColors.surfaceInteractive},!1),s=n.Styles.createTextStyle({color:this._themeColors.textOnColor},!1);return{[u.PillStatus.NO_CONNECTION]:[w.pillStyle.blackBg,w.textStyle.white],[u.PillStatus.CAPTIVE_PORTAL]:[w.pillStyle.blackBg,w.textStyle.white],[u.PillStatus.CONNECTING]:[w.pillStyle.darkGreyBg,w.textStyle.white],[u.PillStatus.UPDATING]:[t,s],[u.PillStatus.SEARCH]:[n.Styles.createViewStyle({backgroundColor:e.backgroundColor},!1),w.textStyle.white],[u.PillStatus.INFO]:this.props.shouldRespectAccentColor?[n.Styles.createViewStyle({backgroundColor:e.backgroundColor},!1),n.Styles.createTextInputStyle({color:e.textColor},!1)]:this.state.showAsUnread?[w.pillStyle.blueBg,w.textStyle.white]:[w.pillStyle.default,w.textStyle.default]}[this.state.status]||[w.pillStyle.default,w.textStyle.default]}render(){if(!this.state.content)return P("rendering empty content, returning null"),null;if(this.state.status===u.PillStatus.INFO&&!this.state.enabledForInfo)return null;if(this.state.status===u.PillStatus.CAPTIVE_PORTAL||this.state.status===u.PillStatus.NO_CONNECTION)return null;const[e,t]=this._getPillStyle(),s=this.props.maxWidth?n.Styles.createViewStyle({maxWidth:this.props.maxWidth},!1):void 0,o=this.props.customContent?n.Styles.createViewStyle({paddingHorizontal:16,paddingVertical:4},!1):void 0,r=[w.pill,this._verticalAnimatedStyle,e,s,o],l=void 0===this.props.customContent?n.Styles.createViewStyle({height:37},!1):void 0,d=[(this.state.status,u.PillStatus.SEARCH,w.stickyStreamDividerContainer),f.default.noncollapsibleView,l];let h;return this.props.disableAbsolutePosition&&d.push(w.relativePosition),h=this.state.status===u.PillStatus.SEARCH&&(this.state.lastLinkInConversation||this.state.lastMediaInConversation)?(0,i.jsxs)(n.View,Object.assign({style:w.textStyle.whiteSearch},{children:[(0,i.jsx)(y.Caption,Object.assign({style:t},{children:c.getString("RevealMedia.StatusPillTitle")})),(0,i.jsxs)(n.View,Object.assign({style:w.pillStyle.searchHistoryButtons},{children:[this.state.lastMediaInConversation&&(0,i.jsxs)(n.Button,Object.assign({style:w.searchButton,onPress:this._getLastImageSent},{children:[(0,i.jsx)(T.default,{icon:M.SkypeIcon.Gallery1,size:M.IconSize.size16,color:g.Color.white,style:w.icons}),(0,i.jsx)(_.Subtitle,Object.assign({style:[t,w.textStyle.searchButtons]},{children:c.getString("RevealMedia.StatusPillLastImage")}))]})),this.state.lastLinkInConversation&&(0,i.jsxs)(n.Button,Object.assign({style:w.searchButton,onPress:this._getLastLinkSent},{children:[(0,i.jsx)(T.default,{icon:M.SkypeIcon.Link,size:M.IconSize.size16,color:g.Color.white,style:w.icons}),(0,i.jsx)(_.Subtitle,Object.assign({style:[t,w.textStyle.searchButtons]},{children:c.getString("RevealMedia.StatusPillLastLink")}))]}))]}))]})):(0,i.jsx)(n.Button,Object.assign({onPress:this._onPress,disabled:this._shouldDisableClickEvents(this.state),disabledOpacity:1},{children:(0,i.jsx)(y.Caption,Object.assign({style:[t,void 0===this.props.customContent?void 0:{flexWrap:"wrap",wordBreak:"break-word"}],numberOfLines:void 0===this.props.customContent?1:void 0,messageStreamFontSize:this.props.messageStreamFontSize},{children:this.state.content}))})),(0,i.jsx)(a.default,Object.assign({ignorePointerEvents:this.state.status!==u.PillStatus.SEARCH,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,style:d},{children:(0,i.jsx)(n.Animated.View,Object.assign({style:r,ignorePointerEvents:!0},{children:h}))}),"statusPill")}_announceUpdatedStateForA11y(e,t){if(h.default.shouldAnnounceForAccessibility())return t.status===u.PillStatus.CONNECTING&&e.status!==u.PillStatus.CONNECTING?n.Accessibility.announceForAccessibility(c.getString("ConnectivityStatusBar.Connected")):e.status===u.PillStatus.CONNECTING?n.Accessibility.announceForAccessibility(c.getString("ConnectivityStatusBar.Connecting")):e.status===u.PillStatus.UPDATING?n.Accessibility.announceForAccessibility(c.getString("ConnectivityStatusBar.UpdatingConversation")):void 0}_getAccentColor(){return this._useAccessibleTheme()?{backgroundColor:this._themeColors.primaryTextColor,textColor:this._themeColors.primaryBackgroundColor}:{backgroundColor:this._themeColors.textOnAccent,textColor:this._themeColors.surfaceAccent}}setEnabledForInfo(e){return this.isComponentMounted()&&e&&this.setState({enabledForInfo:e}),this}}t.StatusPillView=A},163979:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallGalleryEmptyViewer=void 0;const i=s(785893),o=s(516778),n=s(397691),r=s(898278),a=s(746096),l=s(436237),d=s(915877),c=s(733754),h=s(7580),u=s(945983),p=s(451070),g=s(22222),m=s(581760),S=s(619675),f=(0,d.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center"}),bodyContainer:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,alignItems:"center",justifyContent:"center",backgroundColor:m.Color.black}),bodyTextStyle:()=>o.Styles.createTextStyle({color:m.Color.white,backgroundColor:m.Color.transparent,marginHorizontal:16,marginBottom:30,textAlign:"center"}),buttonStyle:()=>o.Styles.createViewStyle({alignSelf:"stretch",marginHorizontal:20})});class y extends h.MediaViewer{constructor(){super(...arguments),this._contentAnimatedOpacityValue=new o.Animated.Value(0),this._contentAnimatedStyle=o.Styles.createAnimatedViewStyle({opacity:this._contentAnimatedOpacityValue}),this._showContent=()=>{o.Animated.timing(this._contentAnimatedOpacityValue,{toValue:1,duration:300,delay:500,easing:o.Animated.Easing.Out()}).start()}}_buildState(e,t){return{safeAreaHorizontalPaddingStyle:p.default.horizontalPaddingStyle({left:10,right:10})}}render(){const e=c.getString("CallPanel.GalleryEmptyTitle"),t=c.getString("QuickCapturePanel.CaptureTitle"),s=[f.bodyContainer,this._contentAnimatedStyle];return this.state.safeAreaHorizontalPaddingStyle&&s.push(this.state.safeAreaHorizontalPaddingStyle),(0,i.jsx)(o.View,Object.assign({style:f.container},{children:(0,i.jsxs)(o.Animated.View,Object.assign({style:s},{children:[(0,i.jsx)(S.BodyText,Object.assign({bold:!0,style:f.bodyTextStyle},{children:e})),(0,i.jsx)(g.default,{style:f.buttonStyle,buttonStyle:r.SXButtonStyle.LightFill,title:t,onPress:this.props.media.launchCamera})]}))}))}animateOpen(e){return super.animateOpen(e).then(this._showContent)}animateClose(e){return n.Resolved()}presentMedia(e,t,s,i){super.presentMedia(e,t,s,i),this._showContent()}getCloseButtonAccLabel(){return c.getString("Global.CloseButtonTitle")}_handleCaching(e,t){super._handleCaching(e,t),l.log(a.LogTraceArea.PictureViewer,"CallGalleryEmptyViewer.handleCaching, causeId: "+t)}}y.MediaType=u.MediaViewerTypes.CallGalleryEmpty,t.CallGalleryEmptyViewer=y},531772:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(285788),r=s(583367),a=s(516778),l=s(300060),d=s(38566),c=s(746096),h=s(436237),u=s(915877),p=s(733754),g=s(265822),m=s(945983),S=s(404057),f=s(581760),y=s(680837),v=s(24576),C=s(853374),_=s(516718),b=s(54288),T=s(803729),M=(0,u.lazyProperties)({viewerContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"center",alignItems:"center",justifyContent:"center"}),playerContainer:()=>a.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center"}),overlayContainerBackground:()=>a.Styles.createViewStyle({backgroundColor:f.Color.blackOverlay10})});class I extends v.default{constructor(){super(...arguments),this._audioManagerClient=new d.default(d.AudioManagerSource.VideoViewer),this._videoPausedBeforeLoad=!1,this._showControls=!0,this._onAppStateChange=e=>{0},this._onVideoPlayerRef=e=>{this._videoPlayerRef=e||void 0},this._toggleVideoControls=e=>{this._showControls=e,this._controlsStore.setPlayPauseButtonState(e),this._controlsStore.setScrubberControlsVisibility(e)},this._playOrPauseVideo=()=>{this._controlsStore.getVideoPlayState()===b.VideoPlayState.Playing?this._controlsStore.pause():this._controlsStore.play()},this._onEnded=()=>{this.isComponentMounted()&&(h.log(c.LogTraceArea.LocalVideoViewer,`LocalVideoViewer(${this._id}).onEnded`),this._toggleVideoControls(!0),this.setState({isPlaying:!1}))},this._onLoadedData=e=>{this.isComponentMounted()&&e.duration&&(h.log(c.LogTraceArea.LocalVideoViewer,`LocalVideoViewer(${this._id}).onLoadedData duration=${e.duration}`),this.setState({videoDuration:e.duration}))},this._onProgress=e=>{this._controlsStore.setVideoPlayProgress({current:e.currentTime,duration:this.state.videoDuration})},this._onSeek=e=>{this._controlsStore&&!this._videoPausedBeforeLoad&&this._controlsStore.setVideoPlayProgress({current:e.currentTime,duration:this.state.videoDuration})}}_buildState(e,t){const s={};t&&(this._id=C.default.newCauseId(),s.isPlaying=!1,s.videoDuration=0,this._controlsStore=new b.VideoViewerControlsStore(!1),this._controlsStore.registerViewerCallbacks({onPlay:()=>{this.setState({isPlaying:!0})},onPause:()=>{this.setState({isPlaying:!1})},onSeekTo:e=>{this._onSeekTo(e)},onMute:e=>{this._muteVideo(e)}}));const i=g.default.getActivePlayerToken();return!t&&this._playerToken!==i&&this.state.isPlaying&&(s.isPlaying=!1),s}componentDidMount(){super.componentDidMount(),this._playerToken=g.default.registerAsPlayer(),this._activationSubToken=l.default.subscribeForChanges("LocalVideoViewer",this._onAppStateChange),this._playVideo(),o.delay((()=>{this._toggleVideoControls(!0)}),300),h.log(c.LogTraceArea.LocalVideoViewer,`LocalVideoViewer(${this._id}).componentDidMount`)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=C.default.newCauseId();h.log(c.LogTraceArea.LocalVideoViewer,`LocalVideoViewer(${this._id}).componentDidUpdate causeId:${i}`),!t.isPlaying&&this.state.isPlaying?this._audioManagerClient.requestMode(n.AudioModes.VideoPlayback,i).then((e=>{e&&this.isComponentMounted()&&(g.default.setAsActive(this._playerToken),this._playVideo())})):t.isPlaying&&!this.state.isPlaying&&(this._pauseVideo(),this._audioManagerClient.release(i)),this._controlsStore.setVideoPlayState(this.state.isPlaying?b.VideoPlayState.Playing:b.VideoPlayState.Paused)}componentWillUnmount(){super.componentWillUnmount();const e=C.default.newCauseId();h.log(c.LogTraceArea.LocalVideoViewer,"LocalVideoViewer("+this._id+").componentWillUnmount causeId: "+e),this._audioManagerClient.release(e),this._toggleVideoControls(!1),this._onToggleAllowScreenLock(!0),this._activationSubToken.unsubscribe()}render(){const e=this.state.isPlaying?p.getString("MediaViewer.Pause"):p.getString("MediaViewer.Play");return(0,i.jsxs)(a.GestureView,Object.assign({style:[y.default.absoluteFill,M.viewerContainer],accessibilityLabel:e,accessibilityTraits:a.Types.AccessibilityTrait.Button,onTap:()=>this._toggleVideoControls(!this._showControls)},{children:[(0,i.jsxs)(a.View,Object.assign({style:[M.playerContainer,this.props.style]},{children:[(0,i.jsx)(a.View,{style:[M.overlayContainerBackground,y.default.absoluteFill]}),(0,i.jsx)(T.default,{origin:"LocalVideoViewer",ref:this._onVideoPlayerRef,style:this.props.style,source:this.props.videoUrl,loop:!1,onEnded:this._onEnded,onLoadedData:this._onLoadedData,onProgress:this._onProgress,onSeek:this._onSeek,resizeMode:"contain",shouldRedirectForAndroidHLS:!1,resumeAfterForeground:!0},"local-video-player")]})),(0,i.jsx)(_.VideoViewerControls,{controlsStore:this._controlsStore,onPlayOrPause:this._playOrPauseVideo,progressBarStyle:this.props.progressBarStyle})]}))}_onToggleAllowScreenLock(e){e?r.default.allowScreenLock().catch((e=>{h.warn(c.LogTraceArea.LocalVideoViewer,`LocalVideoViewer(${this._id}) allowScreenLock failed: ${S.default.errorAsString(e)}`)})):r.default.blockScreenLock().catch((e=>{h.warn(c.LogTraceArea.LocalVideoViewer,`LocalVideoViewer(${this._id}) blockScreenLock failed: ${S.default.errorAsString(e)}`)}))}_playVideo(){this._videoPlayerRef&&(this._videoPlayerRef.play(),this._onToggleAllowScreenLock(!1),this.setState({isPlaying:!0}),a.Accessibility.announceForAccessibility(p.getString("MediaViewer.PlayingVideo")))}_pauseVideo(){this._videoPlayerRef&&(this._videoPlayerRef.pause(),this._onToggleAllowScreenLock(!0),this.setState({isPlaying:!1}),a.Accessibility.announceForAccessibility(p.getString("MediaViewer.VideoPaused")))}_onSeekTo(e){this._videoPlayerRef&&this._videoPlayerRef.seekPercent(e)}_muteVideo(e){this._videoPlayerRef&&this._videoPlayerRef.mute(e)}}I.MediaType=m.MediaViewerTypes.Video,t.default=I},7580:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaViewer=t.AnimationDuration=void 0;const i=s(516778),o=s(397691),n=s(677381),r=s(746096),a=s(907234),l=s(436237),d=s(861253),c=s(714597),h=s(945983),u=s(914976),p=s(853374);t.AnimationDuration=250;class g extends n.default{constructor(){super(...arguments),this._containerWidth=0,this._containerHeight=0,this._nonZoomModeTranslateX=0,this._nonZoomModeTranslateY=0,this._currentTranslateX=0,this._currentTranslateY=0,this._currentScale=1,this._defaultScale=1,this._viewerBounds={width:0,height:0},this._viewerHasFocus=!1,this._slowDownFactor=1,this._openCloseAnimationDuration=t.AnimationDuration*this._slowDownFactor,this._fadeToFullSizeDuration=t.AnimationDuration*this._slowDownFactor,this._containerAnimatedWidthValue=new i.Animated.Value(0),this._containerAnimatedHeightValue=new i.Animated.Value(0),this._containerAnimatedOpacityValue=new i.Animated.Value(0),this._containerAnimatedTranslateXValue=new i.Animated.Value(0),this._containerAnimatedXStyle=i.Styles.createAnimatedViewStyle({width:this._containerAnimatedWidthValue,height:this._containerAnimatedHeightValue,opacity:this._containerAnimatedOpacityValue,transform:[{translateX:this._containerAnimatedTranslateXValue}]}),this._containerAnimatedTranslateYValue=new i.Animated.Value(0),this._containerAnimatedYStyle=i.Styles.createAnimatedViewStyle({transform:[{translateY:this._containerAnimatedTranslateYValue}]}),this._containerAnimatedScaleValue=new i.Animated.Value(1),this._containerAnimatedStyle=i.Styles.createAnimatedViewStyle({transform:[{scale:this._containerAnimatedScaleValue}]}),this._animate=()=>{this._completeOpenAnimation&&this._completeOpenAnimation()}}_buildState(e,t){}_animateZoom(e,t,s,o,n){this._currentScale=s,this._currentTranslateX=e,this._currentTranslateY=t;const r=o||i.Animated.Easing.InOut();i.Animated.parallel([i.Animated.timing(this._containerAnimatedTranslateXValue,{toValue:e,duration:this._openCloseAnimationDuration,easing:r}),i.Animated.timing(this._containerAnimatedTranslateYValue,{toValue:t,duration:this._openCloseAnimationDuration,easing:r}),i.Animated.timing(this._containerAnimatedScaleValue,{toValue:s,duration:this._openCloseAnimationDuration,easing:r}),i.Animated.timing(this.props.backgroundOpacityValue,{toValue:1,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.Linear()})]).start(n)}_calcAnimateFromLocation(e){return e}_getDestinationDimensions(){return this._viewerBounds}_fitToContainerSafe(e){return e}_onCompleteOpen(){}_handleCaching(e,t){l.log(r.LogTraceArea.MediaViewer,"MediaViewer.handleCaching, hasFocus:"+e+" causeId: "+t)}_onFocusChanged(e,t){l.log(r.LogTraceArea.MediaViewer,"onFocusChanged, hasFocus:"+e+" causeId: "+t)}presentMedia(e,t,s,i){l.log(r.LogTraceArea.MediaViewer,"presentMedia, causeId: "+i),this._handleCaching(t,i),this._viewerHasFocus!==t&&(this._onFocusChanged(t,i),t?(this.props.onPauseAutoAdvance(),this.props.controller.onHideMedia&&this.props.controller.onHideMedia(this.props.media)):this.props.controller.onShowMedia&&this.props.controller.onShowMedia(this.props.media)),(0,d.default)(this._viewerBounds,e)||(this._currentScale=this._defaultScale,this._viewerBounds=e,this._currentTranslateX=0,this._currentTranslateY=0,this._nonZoomModeTranslateX=0,this._nonZoomModeTranslateY=0,this._containerAnimatedWidthValue.setValue(this._viewerBounds.width),this._containerAnimatedHeightValue.setValue(this._viewerBounds.height),this._containerWidth=this._viewerBounds.width,this._containerHeight=this._viewerBounds.height,this._containerAnimatedTranslateXValue.setValue(0),this._containerAnimatedTranslateYValue.setValue(0),this._containerAnimatedScaleValue.setValue(this._defaultScale)),this._containerAnimatedOpacityValue.setValue(1),this.props.backgroundOpacityValue.setValue(1),s&&this._onCompleteOpen()}canAnimateOpenClose(){return!1}animateOpen(e){const t=o.Defer();this._viewerBounds={width:e.width,height:e.height},this._viewerHasFocus=!0,this.props.onPauseAutoAdvance();const s=this._fitToContainerSafe(this._viewerBounds);this._containerAnimatedWidthValue.setValue(this._viewerBounds.width),this._containerAnimatedHeightValue.setValue(this._viewerBounds.height),this._containerWidth=this._viewerBounds.width,this._containerHeight=this._viewerBounds.height,this._currentScale=this._defaultScale,this._currentTranslateX=0,this._currentTranslateY=0,this._nonZoomModeTranslateX=0,this._nonZoomModeTranslateY=0;let n=o.Resolved(void 0);return this.props.controller.getInitFromComponentPosition?n=this.props.controller.getInitFromComponentPosition():this.props.controller.getMediaLocationInWindow&&(n=this.props.controller.getMediaLocationInWindow(this.props.media)),n.then((e=>{const o=this._calcAnimateFromLocation(e),n=o.width?o.width/s.width:this._currentScale,r=o.x?o.x-(1-n)*this._viewerBounds.width/2-n*(this._viewerBounds.width-s.width)/2:this._currentTranslateX,a=o.y?o.y-(1-n)*this._viewerBounds.height/2-n*(this._viewerBounds.height-s.height)/2:this._currentTranslateY;this._containerAnimatedScaleValue.setValue(n),this._containerAnimatedTranslateXValue.setValue(r),this._containerAnimatedTranslateYValue.setValue(a),this._containerAnimatedOpacityValue.setValue(1),this.props.backgroundOpacityValue.setValue(0),this._completeOpenAnimation=()=>{this.props.controller.onHideMedia&&this.props.controller.onHideMedia(this.props.media),this._animateZoom(0,0,this._defaultScale,i.Animated.Easing.Out(),(()=>{this._onCompleteOpen(),t.resolve(void 0)})),this._completeOpenAnimation=void 0},this._animate()})).fail((()=>{this._containerAnimatedScaleValue.setValue(this._defaultScale),this._containerAnimatedTranslateXValue.setValue(0),this._containerAnimatedTranslateYValue.setValue(0),this._containerAnimatedOpacityValue.setValue(1),this._onCompleteOpen(),t.resolve(void 0)})),t.promise()}animateClose(e,t){const s=o.Defer();if(this.canAnimateOpenClose()){this._viewerBounds||(this._viewerBounds={width:0,height:0});const o=[i.Animated.timing(this.props.backgroundOpacityValue,{toValue:0,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.Linear()})];if(e){const t=this._calcAnimateFromLocation(e),s=this._fitToContainerSafe(this._viewerBounds),n=t.width?t.width/s.width:this._currentScale,r=t.x-(1-n)*this._viewerBounds.width/2-n*(this._viewerBounds.width-s.width)/2,a=t.y-(1-n)*this._viewerBounds.height/2-n*(this._viewerBounds.height-s.height)/2;o.push(i.Animated.timing(this._containerAnimatedScaleValue,{toValue:n,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.In()})),o.push(i.Animated.timing(this._containerAnimatedTranslateXValue,{toValue:r,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.In()})),o.push(i.Animated.timing(this._containerAnimatedTranslateYValue,{toValue:a,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.In()}))}else t===h.DismissAnimationType.Vertical?o.push(i.Animated.timing(this._containerAnimatedTranslateYValue,{toValue:this._viewerBounds.height,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.Out()})):t===h.DismissAnimationType.Horizontal&&o.push(i.Animated.timing(this._containerAnimatedTranslateXValue,{toValue:-1*this._viewerBounds.width,duration:this._openCloseAnimationDuration,easing:i.Animated.Easing.Out()}));i.Animated.parallel(o).start((()=>{this.isComponentMounted()&&this.props.controller.onShowMedia&&this.props.controller.onShowMedia(this.props.media),s.resolve(void 0)}))}else this.close(),s.resolve(void 0);return s.promise()}close(){this.props.backgroundOpacityValue.setValue(0),this.props.controller.onShowMedia&&this.props.controller.onShowMedia(this.props.media)}prefetchMediaToCacheIfSupported(e,t,s,i){const n=p.default.newCauseId();if(l.log(r.LogTraceArea.MediaViewer,"prefetchMediaToCacheIfSupported, causeId: "+n),a.default.isLocalCacheSupported()){const d=Date.now()+i,h=a.default.getLocalUri(e);if(h||!s)return o.Resolved(h||t);const p=new c.QueueItem(e,t,s,"mediaViewer",d,a.CacheEvictionKind.Preview,Date.now());return c.default.add(p,n).then((s=>{if(!s.cancelled)return s.url;l.log(r.LogTraceArea.MediaViewer,"Media prefetching cancelled for:",e,u.dev_unknownOmit(t))})).catch((s=>{l.error(r.LogTraceArea.MediaViewer,"Something went wrong in prefetching media to cache: "+e+" "+u.dev_unknownOmit(t))}))}return o.Resolved(t)}cancelPrefetchIfPending(e,t){a.default.isLocalCacheSupported()&&e&&c.default.resetTag("mediaViewer",e,t)}}t.MediaViewer=g},449636:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaViewerFactory=void 0;const i=s(785893),o=s(163979),n=s(822669),r=s(379467),a=s(54288);t.MediaViewerFactory=class{static allocateMediaViewerControlsStore(e){switch(e.mediaType){case n.PictureViewer.MediaType:return null;case r.VideoViewer.MediaType:const t=e;return new a.VideoViewerControlsStore(t.useGlobalMute);default:return null}}static renderViewer(e,t){switch(e.mediaType){case n.PictureViewer.MediaType:return(0,i.jsx)(n.PictureViewer,Object.assign({media:e},t));case r.VideoViewer.MediaType:return(0,i.jsx)(r.VideoViewer,Object.assign({media:e},t));case o.CallGalleryEmptyViewer.MediaType:return(0,i.jsx)(o.CallGalleryEmptyViewer,Object.assign({media:e},t));default:return null}}}},342653:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FooterContainerSize=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(934339),a=s(297775),l=s(677381),d=s(887399),c=s(913944),h=s(915877),u=s(733754),p=s(570561),g=s(18078),m=s(699097),S=s(502989),f=s(638693),y=s(581760),v=s(711828),C=s(734528);t.FooterContainerSize=48;const _=(0,h.lazyProperties)({footerContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row"}),share:()=>(0,h.lazyProperties)({container:()=>n.Styles.createViewStyle({height:t.FooterContainerSize,width:t.FooterContainerSize,alignItems:"center",justifyContent:"center"}),button:()=>n.Styles.createTextStyle({height:t.FooterContainerSize,width:t.FooterContainerSize})}),centerControl:()=>(0,h.lazyProperties)({wrapper:()=>n.Styles.createViewStyle({flex:1,height:t.FooterContainerSize,paddingHorizontal:10}),container:()=>n.Styles.createViewStyle({paddingVertical:10,flexDirection:"row",alignItems:"flex-end"}),containerRTL:()=>n.Styles.createViewStyle({flexDirection:"row-reverse"})}),react:()=>(0,h.lazyProperties)({container:()=>n.Styles.createViewStyle({height:t.FooterContainerSize,flexDirection:"row",alignItems:"center",justifyContent:"center"}),button:()=>n.Styles.createTextStyle({height:t.FooterContainerSize,width:t.FooterContainerSize,justifyContent:"center"})}),scrollViewRTL:()=>n.Styles.createViewStyle({flexDirection:"row-reverse",transform:[{scaleX:-1}]}),flippedView:()=>n.Styles.createViewStyle({transform:[{scaleX:-1}]})});class b extends l.default{constructor(){super(...arguments),this._androidFileToBeDeletedOnUnmount=[],this._onMediaViewerOptionComplete=(e,t,s)=>{t===p.MenuOptions.Delete&&this.props.onDelete&&this.props.onDelete(),s&&this._androidFileToBeDeletedOnUnmount.push(s)},this._onActionMenuPress=e=>{let t;p.default.showWithConfig({message:this.props.message,mediaDescriptor:this.props.mediaDescriptor,componentContext:this._getContext(),anchor:()=>this._actionMenuButton,onComplete:this._onMediaViewerOptionComplete,onDownloadDelay:t,invokingEvent:e})},this._getCurrentMessage=()=>this.props.message,this._showSpinnerDelayShare=e=>{this.props.onShowSpinnerDelayShare&&this.props.onShowSpinnerDelayShare(e)},this._onActionMenuButtonRef=e=>{this._actionMenuButton=e||void 0}}_buildState(e,t){return{isMriBlocked:d.isConversationBlocked(e.message.conversationId)}}_renderLeftButton(){let e;if(!this.props.hideLeftButton){const t=this.props.leftButton&&this.props.leftButton.coachMarkType?(0,i.jsx)(a.default.IconButton,{anchorRef:this._onActionMenuButtonRef,size:v.IconSize.size24,style:_.share.button,onPress:this.props.leftButton.onPress,color:y.Color.white,hoverColor:y.Color.gray300,icon:this.props.leftButton.icon,title:this.props.leftButton.title,coachMarkType:this.props.leftButton.coachMarkType,anchorAccessibilityLabel:this.props.leftButton.title}):(0,i.jsx)(c.default,{ref:this._onActionMenuButtonRef,size:v.IconSize.size24,style:_.share.button,onPress:this.props.leftButton?this.props.leftButton.onPress:this._onActionMenuPress,color:y.Color.white,hoverColor:y.Color.gray300,icon:this.props.leftButton?this.props.leftButton.icon:C.shareIcon(),title:this.props.leftButton?this.props.leftButton.title:u.getString("MediaViewer.ShareButtonTitle")});e=(0,i.jsx)(n.View,Object.assign({style:_.share.container},{children:t}))}return e}_renderCenterControl(){let e;if(!this.props.hideReactionPills&&!this.state.isMriBlocked)if(this.props.middleComponent)e=this.props.middleComponent;else if(!o.isEmpty(this.props.message.getReactions())){const t=this._getContext().isRTL;e=(0,i.jsx)(n.ScrollView,Object.assign({style:t?_.scrollViewRTL:void 0,horizontal:!0,vertical:!1,showsHorizontalScrollIndicator:!1,showsVerticalScrollIndicator:!1},{children:(0,i.jsx)(S.default,{style:[_.centerControl.container,t?_.centerControl.containerRTL:void 0],message:this.props.message,reactionSize:r.Size.Small,itemStyle:t?_.flippedView:void 0})}),this.props.message?this.props.message.cuid:void 0)}return(0,i.jsx)(n.View,Object.assign({style:_.centerControl.wrapper},{children:e}))}_renderRightButton(){let e,t,s;if(this.props.hideRightReactionButton||g.default.isMyMri(this.props.message.creator)||this.state.isMriBlocked||(t=(0,i.jsx)(f.default,{message:this._getCurrentMessage,isMessageKnownByServer:this.props.message.isAnyVersionKnownByServer(),style:_.react.button,colorOverride:y.Color.white,sizeOverride:v.IconSize.size24,hideAlternateReactionPacks:this.props.hideAlternateReactionPacks,keepOpenAfterReactionSelected:this.props.keepOpenAfterReactionSelected,onReactionSelected:this.props.onReactionSelected,coachMarkType:this.props.reactionButtonCoachmarkType})),this.props.additionalRightButton){const e={size:v.IconSize.size24,style:_.react.button,onPress:this.props.additionalRightButton.onPress,color:y.Color.white,hoverColor:y.Color.gray300,icon:this.props.additionalRightButton.icon,title:this.props.additionalRightButton.title};s=this.props.additionalRightButton.coachMarkType?(0,i.jsx)(a.default.IconButton,Object.assign({},e,{coachMarkType:this.props.additionalRightButton.coachMarkType,anchorAccessibilityLabel:this.props.additionalRightButton.title})):(0,i.jsx)(c.default,Object.assign({},e))}return(t||s)&&(e=(0,i.jsxs)(n.View,Object.assign({style:_.react.container},{children:[t,s]}))),e}componentWillUnmount(){super.componentWillUnmount(),this._androidFileToBeDeletedOnUnmount.length>0&&o.each(this._androidFileToBeDeletedOnUnmount,(e=>{m.default.androidRemoveFromPublicFolder(e).finally((()=>{this._androidFileToBeDeletedOnUnmount=[]}))}))}render(){const e=this._renderLeftButton(),t=this._renderCenterControl(),s=this._renderRightButton();return(0,i.jsxs)(n.View,Object.assign({style:_.footerContainer},{children:[e,t,s]}))}}t.default=b},570561:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MenuOptions=void 0;const i=s(900515),o=s(362520),n=s(219784),r=s(889391),a=s(265976),l=s(671830),d=s(147204),c=s(898278),h=s(986374),u=s(866957),p=(s(606452),s(746096)),g=s(907234),m=s(753559),S=s(319596),f=s(766649),y=s(436237),v=s(733754),C=s(987946),_=(s(714597),s(183503)),b=s(764387),T=s(42036),M=s(812056),I=s(10909),w=s(178735),P=s(18078),k=s(104735),A=s(822669),x=(s(699097),s(404057)),R=s(293194),O=s(640363),L=(s(626712),s(853374)),F=s(379467);var B;!function(e){e[e.Save=0]="Save",e[e.SaveAs=1]="SaveAs",e[e.Open=2]="Open",e[e.OpenMediaLocation=3]="OpenMediaLocation",e[e.Copy=4]="Copy",e[e.Share=5]="Share",e[e.Delete=6]="Delete",e[e.Report=7]="Report",e[e.ViewProfile=8]="ViewProfile",e[e.Unfollow=9]="Unfollow",e[e.Forward=10]="Forward",e[e.Hide=11]="Hide"}(B=t.MenuOptions||(t.MenuOptions={}));const D=R.default.menuId();t.default=new class{showWithConfig(e){this._show(e.message,e.componentContext,e.invokingEvent,e.mediaDescriptor,e.onComplete,e.deleteConfirmationDialogTitle,e.deleteConfirmationDialogContent,e.onDownloadDelay,e.anchor,e.reportContextType,e.hideConfirmationDialogTitle,e.hideConfirmationDialogContent)}_show(e,t,s,i,o,n,r,a,l,d,c,h){const u=this.getMediaViewerOptions(e,i);if(!u.length)return;const p=this.createMenuCallback(e,t,i,o,n,r,a,d,c,h),g={anchor:()=>l?l():void 0,useTheme:!0,popupDisableContextMenu:!0,positionPriorities:["bottom","left","right","top"],popupBeakSize:{height:0,width:0}};R.default.showWithOptions({id:D,config:g,getMenuItems:()=>u,handleMenuCommand:p,delay:1,maintainAnchor:!0,rootViewId:t.rootViewId,invokingEvent:s})}getMediaViewerOptions(e,t){const s=P.default.isMyMri(e.creator),i=[];if(!f.default.isUsingGogoNetwork()){const t=_.getSaveToDirectoryLocalizationKeys(e);i.push({text:v.getString(t.key,t.params),command:B[B.Save],icon:t.icon})}return t||(i.push({text:v.getString("MessageActionMenu.ShareMenuForward"),command:B[B.Forward],icon:c.SXMenuIcon.Forward}),s&&!l.isBookmarkConversation(e.conversationId)&&i.push({text:v.getString("MessageActionMenu.ShareMenuRemove"),command:B[B.Delete],icon:c.SXMenuIcon.Delete})),i}createMenuCallbackWithConfig(e){return this.createMenuCallback(e.message,e.componentContext,e.mediaDescriptor,e.onComplete,e.deleteConfirmationDialogTitle,e.deleteConfirmationDialogContent,e.onDownloadDelay,e.reportContextType,e.hideConfirmationDialogTitle,e.hideConfirmationDialogContent,e.view)}createMenuCallback(e,t,s,i,o,n,r,a,l,d,c){return h=>this._onActionPressCommand(e,h,t,o,n,i,r,s,a,l,d,c)}_onActionPressCommand(e,t,s,i,o,n=((e,t,s)=>{}),r=(e=>{}),a,l,c,g,m){const f=L.default.newCauseId();y.log(p.LogTraceArea.MessageActionMenu,"onActionPressCommand, causeId: "+f),d.default.dismissPopup(D,s.rootViewId);const v=B[t];if(t&&"cancel"===t.toLowerCase())n&&n(!0,v);else switch(v){case B.Delete:let t;i&&o&&(t={title:i,body:o}),T.default.deleteMessage(e,s.rootViewId,t,(()=>n&&n(!0,v)));break;case B.Copy:this._copyImage(e,a);break;case B.SaveAs:this._saveAs(e,a,f,m,s.rootViewId);break;case B.OpenMediaLocation:this._openMediaLocation(e);break;case B.Open:case B.Save:case B.Share:this._downloadFileAndHandleCommand(e,a,v,s.rootViewId,f,n,r);break;case B.Report:const d={mriToBlock:e.creator,rootViewId:s.rootViewId,content:e,reportContext:l,isBlockingDialog:!1};k.default.navigateToReportConcernModal(d);break;case B.ViewProfile:const p=u.DetailsPanelOrigin.Unknown;k.default.showDetailsPanelWithParams({mri:e.creator,rootViewId:s.rootViewId,origin:p,causeId:f});break;case B.Forward:const y={message:e,node:h.decode(e)};S.forwardMessages([y],M.MessageActionOrigin.StreamItemDesktopContextMenu,e.conversationId,void 0,s);break;case B.Hide:this._hideConfirmationAlert(e,s.rootViewId,c,g,n);break;default:n&&n(!0,v)}}_hideConfirmationAlert(e,t,s,i,o){const r=s||"",a=i||"",l=[{text:v.getString("Global.CancelLabel"),isCancel:!0},{text:v.getString("Global.HideLabel"),isSubmit:!0}];n.default.showWithOptions({title:r,dialogAccessibilityTitle:a||r,message:a,buttons:l,rootViewId:t})}_downloadFileAndHandleCommand(e,t,s,i,o,n,r){let l="",d="";const c=t&&t.id||a.getFileCacheKeyMedia(e,!0);switch((t=t||b.default.getMediaDescriptorForItem(e))&&t.mediaType){case A.PictureViewer.MediaType:l=t.downloadFileName,d=t.fullResolutionUrl;break;case F.VideoViewer.MediaType:l=t.downloadFileName,d=t.videoUrl;break;default:return}l&&this._handleUri(e,s,d,l,c,i,o,n)}_openMediaLocation(e){T.default.openMediaLocationOnDesktop(e)}_saveAs(e,t,s,i,o){let n="",r="";switch((t=t||b.default.getMediaDescriptorForItem(e))&&t.mediaType){case A.PictureViewer.MediaType:n=t.downloadFileName,r=t.fullResolutionUrl;break;case F.VideoViewer.MediaType:n=t.downloadFileName,r=t.videoUrl;break;default:return}const l=a.getFileCacheKeyMedia(e,!0);T.default.desktopSaveAs(l,n,r,s,e,o,i),t&&t.mediaType===A.PictureViewer.MediaType&&y.track(new C.MediaDownloadTelemetryEvent(e,C.MediaDownloadActionOrigin.MediaViewer,C.MediaDownloadReason.SaveAs,m.default.extractFileExtension(n)))}_copyImage(e,t){t||b.default.getMediaDescriptorForItem(e)}_handleUri(e,t,s,i,n,a,l,d){if(t===B.Save){const t=r.default.getS4LMessagingFeaturesNoSubscription().enableCustomFileDownloadLocation,d=w.default.getUserPreferencesLocal(),c=t&&d.fileDownloadPathDesktop?o.join(d.fileDownloadPathDesktop,i):i;T.default.saveToDesktop(e,s,c,n,l,a,!1),y.track(new C.MediaDownloadTelemetryEvent(e,C.MediaDownloadActionOrigin.MediaViewer,C.MediaDownloadReason.SaveToDownloads,m.default.extractFileExtension(i)))}else B.Open,0}_share(e,t,s){const o={url:e,action:O.default.getPlatformType()===p.PlatformType.Android?"send":void 0};i.default.show(o,(e=>{y.error(p.LogTraceArea.MessageActionMenu,x.default.errorAsString(e)),s&&s(!1,t)}),((e,i)=>{y.log(p.LogTraceArea.MessageActionMenu,"Succesfully share to "+i),s&&s(e,t)}))}_onFileDownloadUpdate(e,t,s,i,o,n,r,a,l,d,c){if(i.isFinished&&o===i.key){if(i.isCached){const e=g.default.getLocalUri(o);if(!e)return void y.warn(p.LogTraceArea.MessageActionMenu,"The file finish downloading but the localURI is not valid.",o);this._handleUri(t,s,e,r,o,n,l,d)}else this._showToastOnError(s,a),y.error(p.LogTraceArea.MessageActionMenu,"The file download finish with an error.");c&&c(!1),e.unsubscribe()}}_showToastOnError(e,t){let s;e===B.Save?s=t===A.PictureViewer.MediaType?"MessageActionMenu.PhotoSaveFailNotification":"MessageActionMenu.VideoSaveFailNotification":e===B.Share&&(s=t===A.PictureViewer.MediaType?"MessageActionMenu.PhotoShareFailNotification":"MessageActionMenu.VideoShareFailNotification"),s&&I.default.scheduleTextMessage(v.getString(s),void 0,c.MainRootViewId)}}},5795:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(244770),a=s(397691),l=s(889391),d=s(251577),c=s(996074),h=s(351077),u=s(803056),p=s(898278),g=s(273145),m=s(746096),S=s(907234),f=s(913944),y=s(436237),v=s(861253),C=s(172490),_=s(547126),b=s(915877),T=s(733754),M=s(7580),I=s(449636),w=s(945983),P=s(570561),k=s(706250),A=s(330124),x=s(340395),R=s(451070),O=s(681115),L=s(536150),F=s(581760),B=s(640363),D=s(711828),E=s(734528),V=s(360305),N=s(912770),U=s(853374),j=s(379467),H="viewerPaused",z="advanceMedia",W="optionalPanel",G=M.AnimationDuration,K="viewer-",q=1e4,Q=D.IconSize.default,X=(0,b.lazyProperties)({viewerContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",justifyContent:"flex-start",alignItems:"center",overflow:"visible"}),viewerBackground:()=>n.Styles.createViewStyle({position:"absolute",left:-1e4,right:-1e4,top:-1e4,bottom:-1e4,overflow:"visible",backgroundColor:F.Color.black,alignItems:"center",justifyContent:"center"}),viewerBackgroundDesktop:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:F.Color.black,alignItems:"center",justifyContent:"center"}),stageContainer:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,overflow:"visible"}),controlBarContainer:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,flexDirection:"row",alignItems:"center",justifyContent:"flex-start"}),previousButtonContainer:()=>n.Styles.createViewStyle({position:"absolute",left:-Q,top:0,bottom:0,justifyContent:"center",overflow:"visible"}),navigationButtonBase:()=>n.Styles.createViewStyle({paddingVertical:35,backgroundColor:F.Color.blackOverlay65}),previousButton:()=>n.Styles.createViewStyle({left:Q,paddingLeft:14}),nextButtonContainer:()=>n.Styles.createViewStyle({position:"absolute",right:-Q,top:0,bottom:0,justifyContent:"center",overflow:"visible"}),nextButton:()=>n.Styles.createViewStyle({right:Q,paddingRight:14}),gradientImage:()=>n.Styles.createImageStyle({position:"absolute",top:0,bottom:0,right:0,left:0,backgroundColor:F.Color.transparent}),gradientImageFlipped:()=>n.Styles.createImageStyle({transform:[{scaleY:-1}]}),overlayControlsContainer:()=>n.Styles.createViewStyle({bottom:0}),customHeaderContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"stretch",alignItems:"flex-start"}),customHeaderIconFontContainer:()=>n.Styles.createButtonStyle({width:48,height:48}),mobilePreviousButtonContainer:()=>n.Styles.createViewStyle({position:"absolute",left:0,top:0,bottom:0,justifyContent:"center",overflow:"visible"}),mobileNextButtonContainer:()=>n.Styles.createViewStyle({position:"absolute",right:0,top:0,bottom:0,justifyContent:"center",overflow:"visible"}),mobileNextButton:()=>n.Styles.createViewStyle({right:0,paddingVertical:10,paddingRight:14,paddingLeft:0,backgroundColor:F.Color.blackOverlay50}),mobilePreviousButton:()=>n.Styles.createViewStyle({left:0,paddingVertical:10,paddingRight:0,paddingLeft:14,backgroundColor:F.Color.blackOverlay50})});class $ extends c.default{constructor(e){super(e),this._isFirstLayout=!0,this._controlsShown=!1,this._headerFooterShown=!1,this._isClosing=!1,this._currentTranslateY=0,this._isAnimatingOpen=!0,this._shouldDismissOverlay=!1,this._overlayShown=!1,this._showControlsOnMobile=!0,this._autoHideHeaderFooter=!1,this._overrideShowMouseControls=!1,this._disableGestureForContextMenu=!1,this._isClosingOnSwipeDown=!1,this._advanceToNext=!1,this._advanceToPrevious=!1,this._pauseAutoAdvanceReasons={},this._backgroundOpacityAnimatedValue=new n.Animated.Value(0),this._backgroundOpacityAnimatedStyle=n.Styles.createAnimatedViewStyle({opacity:this._backgroundOpacityAnimatedValue}),this._stageContainerXOffsetValue=new n.Animated.Value(0),this._stageContainerXOffsetStyle=n.Styles.createAnimatedViewStyle({transform:[{translateX:this._stageContainerXOffsetValue}]}),this._mouseControlsOpacityLeftValue=new n.Animated.Value(0),this._mouseControlsOpacityLeftStyle=n.Styles.createAnimatedViewStyle({opacity:this._mouseControlsOpacityLeftValue}),this._mouseControlsOpacityRightValue=new n.Animated.Value(0),this._mouseControlsOpacityRightStyle=n.Styles.createAnimatedViewStyle({opacity:this._mouseControlsOpacityRightValue}),this._topControlBarAnimatedOpacityValue=new n.Animated.Value(0),this._topControlBarAnimatedStyle=n.Styles.createAnimatedViewStyle({opacity:this._topControlBarAnimatedOpacityValue}),this._bottomControlBarAnimatedOpacityValue=new n.Animated.Value(0),this._bottomControlBarAnimatedStyle=n.Styles.createAnimatedViewStyle({opacity:this._bottomControlBarAnimatedOpacityValue}),this._mediaViewerRefsMap=new k.default,this._containerRefsMap=new k.default,this._contextMenuRefsMap=new k.default,this._onCloseIconButtonRef=e=>{this._closeIconButton=e||void 0},this._onPreviousIconButtonRef=e=>{this._previousIconButton=e||void 0},this._onNextIconButtonRef=e=>{this._nextIconButton=e||void 0},this._onMainViewRef=e=>{this._mainView=e||void 0},this._setOverrideShowMouseControls=e=>{this._overrideShowMouseControls=!!e,e||this._startAutoHideControlsTimer()},this._toggleAllControlsOnMobileOnTap=e=>{this._isMobileOrTablet()&&(this._showControlsOnMobile=void 0!==e?e:!this._showControlsOnMobile,this._showHideScrubberControlForVideo(this._showControlsOnMobile),this._maybeToggleHeaderFooter(this._showControlsOnMobile),this._clearAutoHideControlsTimer(),this._showControlsOnMobile&&this._autoHideHeaderFooter&&this._startAutoHideControlsTimer())},this._onVideoEnded=()=>{const e=this._getVideoViewer();this._syncControlsVisibility(),this._onShowHideControls(!0),e&&e.setPauseButtonVisibility(!0)},this._autoHideHeaderFooterControls=e=>{this._autoHideHeaderFooter=e,e?this._showControlsOnMobile&&this._startAutoHideControlsTimer():this._clearAutoHideControlsTimer()},this._keyboardNavigationStateChanged=e=>{this._onShowHideControls(e),this._onShowHideHeaderFooter(e)},this._getCloseButtonAccessibilityLabel=()=>{const e=this._getCurrentViewer();return e?e.getCloseButtonAccLabel():""},this._invalidateCache=()=>{const e=this._getCurrentMediaInfo();if(1!==this.state.viewers.length||!e||0!==e.visualIndex){const t=[];t.push(e);const s=this.props.controller.getNextMedia?this.props.controller.getNextMedia(e.mediaDescriptor):void 0;s&&t.push($._allocateMediaViewerInfo(s,e.visualIndex+1,this._viewerBounds.width));const i=this.props.controller.getPreviousMedia?this.props.controller.getPreviousMedia(e.mediaDescriptor):void 0;i&&t.push($._allocateMediaViewerInfo(i,e.visualIndex-1,this._viewerBounds.width)),this._stageContainerXOffsetValue.setValue(0),this._clearAllPauseAutoAdvanceReasons(),this.setState({viewers:t})}const t=o.find(this.state.viewers,(e=>0===e.visualIndex));t&&this.props.controller.onMediaIsInFocus&&this.props.controller.onMediaIsInFocus(t.mediaDescriptor)},this._onMouseMove=e=>{this._controlsShown?this._previousMousePosition=void 0:(this._previousMousePosition&&(Math.abs(this._previousMousePosition.x-e.pageX)>2||Math.abs(this._previousMousePosition.y-e.pageY)>2)&&this._showControls(),this._previousMousePosition={x:e.pageX,y:e.pageY})},this.showPrevious=()=>{this._setPauseAutoAdvanceReason(z),this._onAdvanceMedia(!1)},this.showNext=()=>{this._setPauseAutoAdvanceReason(z),this._onAdvanceMedia(!0)},this._onKeyUp=e=>{if(!this.props.controller.getOptions().disableSwipeLeftRight){if(!0===e.ctrlKey||!0===e.altKey||!0===e.metaKey)return!1;if(e.keyCode===_.default.LEFT)return this.showPrevious(),!0;if(e.keyCode===_.default.RIGHT)return this.showNext(),!0}return!1},this._onEscape=()=>(this._close(),!0),this._onLayoutViewer=e=>{const t=this._viewerBounds&&(this._viewerBounds.width!==e.width||this._viewerBounds.height!==e.height);this._viewerBounds={width:e.width,height:e.height};const s=U.default.newCauseId();y.log(m.LogTraceArea.MediaViewer,"_onLayoutViewer, causeId: "+s),o.each(this.state.viewers,(t=>{this._updateViewerXOffset(t);const i=this._mediaViewerRefsMap.ref(K+t.mediaDescriptor.id);this._isFirstLayout&&this._canAnimateOpenClose()?i?i.animateOpen(e).then(this._performPostMediaOpenTasks):this._performPostMediaOpenTasks():(i&&i.presentMedia(this._viewerBounds,0===t.visualIndex,this._isFirstLayout,s),this._isFirstLayout&&this._performPostMediaOpenTasks())})),this._isFirstLayout=!1,t&&!this._isClosing&&this.isComponentMounted()&&this.forceUpdate()},this._performPostMediaOpenTasks=()=>{const e=U.default.newCauseId();y.log(m.LogTraceArea.MediaViewerPanel,"_performPostMediaOpenTasks, causeId: "+e),this._isAnimatingOpen=!1,this.props.onOpen&&this.props.onOpen(),this._maybeToggleHeaderFooter(!1,!0),this._showControls(),this._loadPreviousAndNext(),this._presentMediaForAllViewers(!0,e),this.isComponentMounted()&&this.forceUpdate(),this._onViewerRendered()},this._onShowHideControls=e=>{this._controlsShown!==e&&this._toggleControls()},this._onShowHideHeaderFooter=e=>{this._headerFooterShown!==e&&this._maybeToggleHeaderFooter()},this._maybeToggleHeaderFooter=(e=!1,t=!1)=>{this.props.disableHeaderFooterAutoDismiss&&!t||this._animateHeaderFooter(e)},this._animateHeaderFooter=e=>{var t,s;this._headerFooterAnimation&&this._headerFooterAnimation.stop(),this._headerFooterShown=!!this.state.isMobileScreenReaderEnabled||(e||!this._headerFooterShown),this._addRemoveHeaderFooterFromView(!0),this._isMobileOrTablet()&&(null===(s=(t=this.props).onToggleControls)||void 0===s||s.call(t,this._headerFooterShown));const i=this._headerFooterShown?1:0;this._headerFooterAnimation=n.Animated.parallel([n.Animated.timing(this._topControlBarAnimatedOpacityValue,{toValue:i,duration:G,easing:n.Animated.Easing.InOut()}),n.Animated.timing(this._bottomControlBarAnimatedOpacityValue,{toValue:i,duration:G,easing:n.Animated.Easing.InOut()})]),this._headerFooterAnimation.start((e=>{e.finished&&this.isComponentMounted()&&(this._headerFooterAnimation=void 0),this._addRemoveHeaderFooterFromView(this._headerFooterShown)}))},this._toggleControls=()=>{if(this.isComponentMounted()){this._controlsAnimation&&this._controlsAnimation.stop(),this._controlsShown=!this._controlsShown;const e=this._controlsShown?1:0;this._controlsAnimation=n.Animated.parallel([n.Animated.timing(this._mouseControlsOpacityLeftValue,{toValue:e,duration:500,easing:n.Animated.Easing.InOut()}),n.Animated.timing(this._mouseControlsOpacityRightValue,{toValue:e,duration:500,easing:n.Animated.Easing.InOut()})]);const t=this._getVideoViewer();this._isMobileOrTablet()||(this._maybeToggleHeaderFooter(this._controlsShown),t&&t.setScrubberControlsVisibility(this._controlsShown)),this._isClosingOnSwipeDown?t&&t.setPauseButtonVisibility(this._controlsShown):this._controlsAnimation.start((e=>{e.finished&&this.isComponentMounted()&&(this._controlsAnimation=void 0,t&&t.setPauseButtonVisibility(this._controlsShown))})),this._clearAutoHideControlsTimer(),this._controlsShown&&this._startAutoHideControlsTimer()}},this._isMediaVideo=()=>{const e=this.getCurrentMediaDescriptor();return(null==e?void 0:e.mediaType)===j.VideoViewer.MediaType},this._onPauseAutoAdvance=()=>{this._setPauseAutoAdvanceReason(H),this._autoAdvanceTimer&&(N.default.clearTimeout(this._autoAdvanceTimer),this._autoAdvanceTimer=void 0)},this._onResumeAutoAdvance=e=>{this._clearPauseAutoAdvanceReason(H,e)},this._onViewerRendered=()=>{N.default.setTimeout((()=>{this._closeIconButton&&this._closeIconButton.requestFocus()}),1e3)},this._onTap=e=>{if(this.props.controller.onTap&&(this._overlayShown=this.props.controller.onTap(e)===w.AnimateOverlayState.ShowOverlay,this._overlayShown))return this.props.controller.animateOverlayPanel&&this.props.controller.animateOverlayPanel(),void(this._overlayShown=!1)},this._onContextMenu=(e,t)=>{const s=this._contextMenuRefsMap.ref(e);this._disableGestureForContextMenu=!0,s&&s.showOnTap(t)},this._syncControlsVisibility=()=>{this._isMobileOrTablet()&&(this._showHideScrubberControlForVideo(this._showControlsOnMobile),this._autoHideHeaderFooterControls(!0))},this._onPanHorizontal=e=>{if(this._currentTranslateY<0)return;if(e.isComplete&&this._disableGestureForContextMenu)return void(this._disableGestureForContextMenu=!1);const t=e.pageX-e.initialPageX,s=Math.abs(t);if(this._stageContainerXOffsetValue.setValue(t),this._setPauseAutoAdvanceReason(z),this.props.controller.getOptions().animateOpenClose&&this.props.closeOnLastItemSwipe)if(t<0){if(!o.find(this.state.viewers,(e=>1===e.visualIndex))){const e=Math.min(this._viewerBounds.width/2,300),t=Math.max(e-s,0)/e;this._backgroundOpacityAnimatedValue.setValue(t),this._onShowHideHeaderFooter(!1)}}else this._backgroundOpacityAnimatedValue.setValue(1),this._onShowHideHeaderFooter(!0);if(e.isComplete){this.props.controller.onPanHorizontalComplete&&this.props.controller.onPanHorizontalComplete();const i=Math.min(this._viewerBounds.width/2,300),o=Math.abs(e.velocityX)>.1,r=s>i/2;this._clearPauseAutoAdvanceReason(z);let a=!0;if(r&&!o)a=!this._onAdvanceMedia(t<0);else if(o&&!r)a=!this._onAdvanceMedia(e.velocityX<0,!0);else{const s=t<0;s===e.velocityX<0&&(a=!this._onAdvanceMedia(s,!0))}a&&(this._onShowHideHeaderFooter(!0),n.Animated.parallel([n.Animated.timing(this._stageContainerXOffsetValue,{toValue:0,duration:M.AnimationDuration,easing:o?n.Animated.Easing.Out():n.Animated.Easing.InOut()})]).start())}},this._onPanVertical=e=>{if(this._isClosing)return;if(e.isComplete&&this._disableGestureForContextMenu)return void(this._disableGestureForContextMenu=!1);const t=this._getCurrentMediaInfo(),s=e.pageY-e.initialPageY;let i=!1;this._onPauseAutoAdvance(),this._setPauseAutoAdvanceReason(W);const o=s<0&&this.props.controller.getOptions().showOverlayPanel;let r=!1;if(o&&(!this._autoHideHeaderFooter||this._controlsShown)){const e=this.props.controller.animateOverlayPanel?this.props.controller.animateOverlayPanel(s):void 0;this._shouldDismissOverlay=this._shouldDismissOverlay||e===w.AnimateOverlayState.HideOverlay,this._overlayShown=e!==w.AnimateOverlayState.ShowOverlay,r=e!==w.AnimateOverlayState.None}!r&&s>0&&!this._shouldDismissOverlay&&(this._isClosingOnSwipeDown=!0,this._onShowHideControls(!1),this._onShowHideHeaderFooter(!1),t.yOffsetValue.setValue(this._currentTranslateY+s));const a=Math.abs(s),l=Math.min(this._viewerBounds.height/2,300),d=o?1:Math.max(l-s,0)/l;this.props.controller.getOptions().animateOpenClose&&this._backgroundOpacityAnimatedValue.setValue(d),i=!!this.props.onDidClose&&(a>l/2||Math.abs(e.velocityY)>.35),e.isComplete&&(i&&s>0&&!this._shouldDismissOverlay?(this.props.controller.getOptions().animateOpenClose&&n.Animated.timing(t.yOffsetValue,{toValue:0,duration:M.AnimationDuration,easing:n.Animated.Easing.InOut()}).start(),this._isClosingOnSwipeDown=!0,this._close()):(this._isClosingOnSwipeDown=!1,this.setState({isAnimatingViewers:!0}),this._onResumeAutoAdvance(!1),this._clearPauseAutoAdvanceReason(W),this._currentTranslateY=0,this._onShowHideHeaderFooter(!0),this._onShowHideControls(!0),n.Animated.sequence([n.Animated.timing(t.yOffsetValue,{toValue:0,duration:M.AnimationDuration,easing:n.Animated.Easing.InOut()}),n.Animated.timing(this._backgroundOpacityAnimatedValue,{toValue:1,duration:M.AnimationDuration,easing:n.Animated.Easing.InOut()})]).start((()=>{this.isComponentMounted()&&this.setState({isAnimatingViewers:!1})}))),this._shouldDismissOverlay=!1)},this._onAdvanceMedia=(e,t=!1)=>{var s;const i=e?1:-1,r=o.find(this.state.viewers,(e=>e.visualIndex===i));if(y.log(m.LogTraceArea.MediaViewerPanel,"_onAdvanceMedia() mediaIndexToShow: "+i+" mediaToShow: "+(r&&r.mediaDescriptor?r.mediaDescriptor.id:"none")),!r){let e=!1;return 1===i?(this.props.closeOnLastItemSwipe&&(e=!0,this.close(w.DismissAnimationType.Horizontal)),this.props.onRightBoundSwipe&&(e=!0,this.props.onRightBoundSwipe())):-1===i&&this.props.onLeftBoundSwipe&&(e=!0,this.props.onLeftBoundSwipe()),e}const a=r;if(this.state.isAnimatingViewers)return!1;this.setState({isAnimatingViewers:!0});const l=(null===(s=a.mediaDescriptor)||void 0===s?void 0:s.mediaType)===j.VideoViewer.MediaType;e?n.Accessibility.announceForAccessibility(T.getString(l?"MediaViewer.OpeningNextVideo":"MediaViewer.OpeningNextImage")):n.Accessibility.announceForAccessibility(T.getString(l?"MediaViewer.OpeningPreviousVideo":"MediaViewer.OpeningPreviouseImage"));const d=this._viewerBounds.width+20;return n.Animated.parallel([n.Animated.timing(this._stageContainerXOffsetValue,{toValue:e?-d:d,duration:M.AnimationDuration,easing:t?n.Animated.Easing.Out():n.Animated.Easing.InOut()})]).start((()=>{if(this.isComponentMounted()){let t=[];const s=e?-1:1;if(o.each(this.state.viewers,(e=>{e.visualIndex+=s,this._updateViewerXOffset(e),e.visualIndex>=-1&&e.visualIndex<=1&&t.push(e)})),t=o.sortBy(t,(e=>e.visualIndex)),e){const e=o.last(t);if(!this.props.controller.getOptions().disableSwipeLeftRight&&this.props.controller.getNextMedia){const s=this._advanceToNext?void 0:this.props.controller.getNextMedia(e.mediaDescriptor);s?(this._advanceToNext=!1,this._advanceToPrevious=!1,t.push($._allocateMediaViewerInfo(s,e.visualIndex+1,this._viewerBounds.width))):(y.log(m.LogTraceArea.MediaViewerPanel,"_onAdvanceMedia() no media to advance to next"),o.delay((()=>{this._previousIconButton&&this._previousIconButton.requestFocus()}),700))}}else{const e=o.head(t);if(!this.props.controller.getOptions().disableSwipeLeftRight&&this.props.controller.getPreviousMedia){const s=this._advanceToPrevious?void 0:this.props.controller.getPreviousMedia(e.mediaDescriptor);s?(this._advanceToPrevious=!1,this._advanceToNext=!1,t.push($._allocateMediaViewerInfo(s,e.visualIndex-1,this._viewerBounds.width))):(y.log(m.LogTraceArea.MediaViewerPanel,"_onAdvanceMedia() no media to advance to previous"),o.delay((()=>{this._nextIconButton&&this._nextIconButton.requestFocus()}),700))}}this._stageContainerXOffsetValue.setValue(0),this._clearAllPauseAutoAdvanceReasons(),this.props.controller.onMediaIsInFocus&&this.props.controller.onMediaIsInFocus(a.mediaDescriptor),this.setState({viewers:t,isAnimatingViewers:!1})}})),!0},this._goBack=e=>(y.log(m.LogTraceArea.MediaViewerPanel,"MediaViewerPanel._goBack,  causeId: "+e),this._getContext().isPresentedByMobileStackNavigator?super._goBack(e):!this._getContext().isPresentedInDesktopContentPanel&&this._showCloseIcon()?(this._closeViewer(),!0):super._goBack(e)),this._close=()=>{this.props.onClose?this.props.onClose():this.close()},this.close=(e=w.DismissAnimationType.Default)=>!!this.props.onDidClose&&(this._closeViewer(!1,e),!0),this.showSpinnerForDelayShare=e=>{this.isComponentMounted()&&this.setState({showSpinner:e})},this._viewerBounds={width:q,height:q}}_buildState(e,t){const s={},i=R.default.keepStatusBarVisible()?R.default.statusBarPadding():0,o=R.default.bottomSafeAreaInset(p.BottomInsetDefault),n=R.default.horizontalInsets(p.HorizontalInsetDefault);s.safeAreaInsets=Object.assign(Object.assign({},n),{top:i,bottom:o}),s.isUsingStackNavigationContext=A.default.isUsingStackNavigationContext(),s.streamVideo=l.default.getS4LCMCFeatures().enableStreamVideo,s.isMobileScreenReaderEnabled=L.default.isMobileScreenReaderEnabled(),s.isTablet=V.default.isTablet(),t&&(s.isAnimatingViewers=!1,s.showHeaderFooter=!0);const r=this.props;return(t||r.initialMedia&&e.initialMedia.id!==r.initialMedia.id)&&(y.log(m.LogTraceArea.MediaViewerPanel,"_buildState updating initialMedia "+e.initialMedia.id),s.viewers=[$._allocateMediaViewerInfo(e.initialMedia,0,q)]),s}componentDidMount(){super.componentDidMount();const e=U.default.newCauseId();y.log(m.LogTraceArea.MediaViewerPanel,"componentDidMount causeId: "+e),n.Input.keyUpEvent.subscribe(this._onKeyUp),C.default.addEscapeHandler(this._onEscape),n.UserInterface.keyboardNavigationEvent.subscribe(this._keyboardNavigationStateChanged),this.props.controller.onMediaViewerMounted&&this.props.controller.onMediaViewerMounted()}componentWillUnmount(){super.componentWillUnmount();const e=U.default.newCauseId();y.log(m.LogTraceArea.MediaViewerPanel,"componentWillUnmount causeId: "+e),n.Input.keyUpEvent.unsubscribe(this._onKeyUp),C.default.removeEscapeHandler(this._onEscape),n.UserInterface.keyboardNavigationEvent.unsubscribe(this._keyboardNavigationStateChanged),this._autoAdvanceTimer&&(N.default.clearTimeout(this._autoAdvanceTimer),this._autoAdvanceTimer=void 0),this._clearAutoHideControlsTimer()}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),!this._isAnimatingOpen){this.props.totalMedia===e.totalMedia&&(0,v.default)(e.initialMedia,this.props.initialMedia)||this._loadPreviousAndNext();const s=U.default.newCauseId();y.log(m.LogTraceArea.MediaViewer,"componentDidUpdate, causeId: "+s),this._presentMediaForAllViewers(!(0,v.default)(e.initialMedia,this.props.initialMedia),s),this._advanceToNext&&(y.log(m.LogTraceArea.MediaViewerPanel,"componentDidUpdate() Advancing to next"),this._onAdvanceMedia(!0,!0)),this._advanceToPrevious&&(y.log(m.LogTraceArea.MediaViewerPanel,"componentDidUpdate() Advancing to previous"),this._onAdvanceMedia(!1,!0)),!t.isMobileScreenReaderEnabled&&this.state.isMobileScreenReaderEnabled&&this._maybeToggleHeaderFooter()}}mediaViewerRef(e){return this._mediaViewerRefsMap.ref(e)}render(){const e=n.Styles.createViewStyle({width:this._viewerBounds.width,height:this._viewerBounds.height},!1),t=o.map(this.state.viewers,(t=>{var s,o;const r="viewerContainer-"+((null===(s=t.mediaDescriptor)||void 0===s?void 0:s.mediaType)||"")+((null===(o=t.mediaDescriptor)||void 0===o?void 0:o.id)||"");return(0,i.jsxs)(u.default,Object.assign({goBack:this._goBack},{children:[(0,i.jsx)(x.default,{statusBarKey:"MediaViewerPanel",backgroundColor:F.Color.black,barStyle:x.BarStyle.LIGHT_CONTENT,hidden:!R.default.keepStatusBarVisibleNoSubscription(),animated:!0}),(0,i.jsx)(n.Animated.View,Object.assign({style:[X.stageContainer,t.xOffsetStyle],ref:this._containerRefsMap.onComponentRef(r)},{children:(0,i.jsx)(n.Animated.View,Object.assign({style:[X.stageContainer,t.yOffsetStyle]},{children:(0,i.jsx)(n.View,Object.assign({style:e},{children:this._renderViewer(t)}),"viewerContainer")}))}),r)]}))}));y.log(m.LogTraceArea.MediaViewerPanel,`Rendering viewers: ${JSON.stringify(this.state.viewers.map((e=>{var t,s;return`${null===(t=e.mediaDescriptor)||void 0===t?void 0:t.mediaType}-${null===(s=e.mediaDescriptor)||void 0===s?void 0:s.id} (${e.visualIndex})`})))}`);const s=[];let a,d,c,h=Q;this.props.mouseControlsSize&&(h=this.props.mouseControlsSize),this.props.controller.getOptions().disableSwipeLeftRight||(o.find(this.state.viewers,(e=>-1===e.visualIndex))&&s.push((0,i.jsx)(n.Animated.View,Object.assign({style:[X.previousButtonContainer,this._mouseControlsOpacityLeftStyle]},{children:(0,i.jsx)(f.default,{ref:this._onPreviousIconButtonRef,size:h,style:[X.navigationButtonBase,X.previousButton],onPress:this.showPrevious,color:F.Color.gray200,hoverColor:F.Color.white,onHover:this._setOverrideShowMouseControls,icon:D.SkypeIcon.NavigationBack,title:T.getString("Global.PreviousButtonTitle")})}),"mouseControlsLeft")),o.find(this.state.viewers,(e=>1===e.visualIndex))&&s.push((0,i.jsx)(n.Animated.View,Object.assign({style:[X.nextButtonContainer,this._mouseControlsOpacityRightStyle]},{children:(0,i.jsx)(f.default,{ref:this._onNextIconButtonRef,size:h,style:[X.navigationButtonBase,X.nextButton],onPress:this.showNext,onHover:this._setOverrideShowMouseControls,color:F.Color.gray200,hoverColor:F.Color.white,icon:D.SkypeIcon.NavigationForward,title:T.getString("Global.NextButtonTitle")})}),"mouseControlsRight")));const p=this._getCurrentMediaInfo();p&&(this.props.controller.getOptions().showCustomHeader&&this.props.controller.renderCustomHeader&&(a=this.props.controller.renderCustomHeader(p.mediaDescriptor,this._invalidateCache)),this.props.controller.getOptions().showCustomFooter&&this.props.controller.renderCustomFooter&&(d=this.props.controller.renderCustomFooter(p.mediaDescriptor)),this.props.controller.getOptions().showOverlayPanel&&this.props.controller.renderOverlayPanel&&(c=this.props.controller.renderOverlayPanel(p.mediaDescriptor)));const g=O.default.hasHorizontalSafeAreas(this.state.safeAreaInsets)?O.default.horizontalPaddingStyle(this.state.safeAreaInsets):void 0,S=(0,i.jsx)(n.Image,{style:X.gradientImage,resizeMode:"stretch",source:r.Collection.PHOTO_SHIM}),v=(0,i.jsx)(n.Image,{style:[X.gradientImage,X.gradientImageFlipped],resizeMode:"stretch",source:r.Collection.PHOTO_SHIM});let C,_,b,M;if(d&&this.state.showHeaderFooter){const e=[X.controlBarContainer,X.overlayControlsContainer,this._bottomControlBarAnimatedStyle];g&&e.push(g),C=(0,i.jsxs)(n.Animated.View,Object.assign({style:e},{children:[v,d]}),"footer")}if(this.props.onDidClose&&this._showCloseIcon()){const e=this._getCloseButtonAccessibilityLabel();_=(0,i.jsx)(f.default,{style:X.customHeaderIconFontContainer,ref:this._onCloseIconButtonRef,size:D.IconSize.size24,onPress:this._close,color:F.Color.white,hoverColor:F.Color.gray300,icon:this._getContext().isPresentedInDesktopContentPanel?E.backIcon():E.closeIcon(),title:T.getString("Global.CloseButtonTitle"),importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityLabel:e})}if(b=X.viewerBackgroundDesktop,this.state.showHeaderFooter){const e=[X.controlBarContainer,this._topControlBarAnimatedStyle];g&&e.push(g);const t=B.default.isWindowCloseOnRight()&&l.default.getS4LUiFeaturesNoSubscription().enableWindowRightClose;M=(0,i.jsxs)(n.Animated.View,Object.assign({style:e},{children:[S,(0,i.jsxs)(n.View,Object.assign({style:X.customHeaderContainer},{children:[t?void 0:_,a,t?_:void 0]}))]}),"header")}const I=[X.viewerContainer];return this.state.safeAreaInsets.top&&I.push(O.default.marginTopStyle(this.state.safeAreaInsets.top)),this.state.safeAreaInsets.bottom&&!this.props.noBottomSpacing&&I.push(O.default.marginBottomStyle(this.state.safeAreaInsets.bottom)),(0,i.jsx)(u.default,Object.assign({goBack:this._goBack},{children:(0,i.jsxs)(n.View,Object.assign({ref:this._onMainViewRef,style:I,onLayout:this._onLayoutViewer,onMouseMove:this._onMouseMove,restrictFocusWithin:!this.props.noFocusRestriction&&!this._getContext().isPresentedInDesktopContentPanel},{children:[(0,i.jsx)(n.Animated.View,{style:[b,this._backgroundOpacityAnimatedStyle]},"background"),(0,i.jsx)(n.Animated.View,Object.assign({style:[X.stageContainer,this._stageContainerXOffsetStyle]},{children:t}),"viewers"),s,M,C,c]}))}))}_showHideScrubberControlForVideo(e){const t=this._getVideoViewer();t&&t.setScrubberControlsVisibility(e)}getViewerInfoPrefix(){return K}_presentMediaForAllViewers(e,t){y.log(m.LogTraceArea.MediaViewer,"_presentMediaForAllViewers, causeId: "+t),o.each(this.state.viewers,(s=>{const i=this._mediaViewerRefsMap.ref(K+s.mediaDescriptor.id);if(i){const o=0===s.visualIndex;this.props.controller.onMediaIsInFocus&&e&&o&&this.props.controller.onMediaIsInFocus(s.mediaDescriptor),this._isClosing||i.presentMedia(this._viewerBounds,o,!!e,t)}}))}_addRemoveHeaderFooterFromView(e){this._isMobileOrTablet()&&e===this._headerFooterShown&&this.isComponentMounted()&&this.setState({showHeaderFooter:this._headerFooterShown})}_getVideoViewer(){if(this._isMediaVideo()){return this._getCurrentViewer()}}_setPauseAutoAdvanceReason(e){this._pauseAutoAdvanceReasons[e]=e,this._autoAdvanceTimer&&(N.default.clearTimeout(this._autoAdvanceTimer),this._autoAdvanceTimer=void 0)}_clearAllPauseAutoAdvanceReasons(){this._pauseAutoAdvanceReasons={},this._clearPauseAutoAdvanceCommon(!1)}_clearPauseAutoAdvanceReason(e,t=!1){delete this._pauseAutoAdvanceReasons[e],this._clearPauseAutoAdvanceCommon(t)}_clearPauseAutoAdvanceCommon(e){if(this._autoAdvanceTimer&&(N.default.clearTimeout(this._autoAdvanceTimer),this._autoAdvanceTimer=void 0),!this._isAutoAdvancePaused()){const t=this.props.controller.getOptions().autoAdvanceDuration||0;t>0&&(e?this._performAutoAdvance():this._autoAdvanceTimer=N.default.setTimeout((()=>{this._performAutoAdvance()}),1e3*t))}}_isAutoAdvancePaused(){return 0!==o.keys(this._pauseAutoAdvanceReasons).length}_performAutoAdvance(){this._autoAdvanceTimer&&(N.default.clearTimeout(this._autoAdvanceTimer),this._autoAdvanceTimer=void 0),this._onAdvanceMedia(!0)}_renderViewer(e){const t=this.props.controller.getOptions(),s=K+e.mediaDescriptor.id,n=!t.disableSwipeLeftRight&&!this._isAnimatingOpen,r=(!!this.props.onDidClose||t.showOverlayPanel)&&!this._isAnimatingOpen,a=this.props.controller.getCurrentMessageForMedia?this.props.controller.getCurrentMessageForMedia(e.mediaDescriptor):void 0;let l=this.props.cacheMode;o.isUndefined(l)&&(S.default.isLocalCacheSupported()&&a?(l=w.CacheMode.FileCacheWithPrefetching,this._shouldStreamVideo(a,e)&&(l=w.CacheMode.FileCacheWithNetFallback)):l=w.CacheMode.Disabled);const c=this.props.cacheMode!==w.CacheMode.Disabled&&a?(0,d.getCacheKeyFullResOrDisplayable)(a):void 0,h={ref:this._mediaViewerRefsMap.onComponentRef(s),controller:this.props.controller,controlsStore:e.viewerControlsStore,backgroundOpacityValue:this._backgroundOpacityAnimatedValue,onClose:this._close,onTap:this._onTap,onPanHorizontal:n?this._onPanHorizontal:null,onPanVertical:r?this._onPanVertical:null,onPinchZoomClose:this._close,onShowHideControls:this._onShowHideControls,onPauseAutoAdvance:this._onPauseAutoAdvance,onResumeAutoAdvance:this._onResumeAutoAdvance,onContextMenu:e=>this._onContextMenu(s,e),showSpinnerForDelayShare:this.state.showSpinner,customFooterHeight:t.customFooterHeight?t.customFooterHeight:null,cacheMode:l,cacheId:c,isAnimating:this.state.isAnimatingViewers,viewMediaIntentScenario:this.props.viewMediaIntentScenario,viewerBounds:this._viewerBounds,onPlayVideo:this._syncControlsVisibility,autoHideHeaderFooterControls:this._autoHideHeaderFooterControls,onVideoEnded:this._onVideoEnded,isShowingCloseIcon:this._showCloseIcon(),messagetype:null==a?void 0:a.messagetype,isMobileScreenReaderEnabled:this.state.isMobileScreenReaderEnabled};let u=I.MediaViewerFactory.renderViewer(e.mediaDescriptor,h);if(a){const t=P.default.createMenuCallbackWithConfig({message:a,mediaDescriptor:e.mediaDescriptor,componentContext:this._getContext(),view:()=>this._mainView});u=(0,i.jsx)(g.default,Object.assign({ref:this._contextMenuRefsMap.onComponentRef(s),wrapperOnly:!0,getMenuItems:()=>P.default.getMediaViewerOptions(a),onItemSelected:t},{children:u}))}return u}_shouldStreamVideo(e,t){var s;return(null===(s=t.mediaDescriptor)||void 0===s?void 0:s.mediaType)===j.VideoViewer.MediaType&&(void 0!==e&&(!(!this.state.streamVideo||e.messagetype!==h.MessageTypes.Media_Video)||e.messagetype===h.MessageTypes.CastRecording))}_isMobileOrTablet(){return this.state.isUsingStackNavigationContext||this.state.isTablet}_canAnimateOpenClose(){const e=this._getCurrentViewer();return!!(e&&this.props.controller&&this.props.controller.getOptions().animateOpenClose)&&e.canAnimateOpenClose()}_startAutoHideControlsTimer(){this._autoHideControlsTimer&&this._clearAutoHideControlsTimer(),this._autoHideControlsTimer=N.default.setTimeout((()=>{this._clearAutoHideControlsTimer(),n.UserInterface.isNavigatingWithKeyboard()||this._overrideShowMouseControls||(this._onShowHideControls(!1),this._isMediaVideo()&&this._toggleAllControlsOnMobileOnTap(!1))}),2e3)}_clearAutoHideControlsTimer(){this._autoHideControlsTimer&&(N.default.clearTimeout(this._autoHideControlsTimer),this._autoHideControlsTimer=void 0)}_componentId(){return"MediaViewerPanel"}_closeViewer(e=!1,t=w.DismissAnimationType.Default){if(!this._isClosing){this._isClosing=!0;const s=t||this.props.controller.getOptions().dismissAnimationType;if(!e&&this._canAnimateOpenClose())if(this._onShowHideHeaderFooter(!1),s===w.DismissAnimationType.Vertical||s===w.DismissAnimationType.Horizontal)this._completeClose(e,void 0,s);else{let t=a.Resolved(void 0);this.props.controller.getCloseToComponentPosition?t=this.props.controller.getCloseToComponentPosition():this.props.controller.getMediaLocationInWindow&&(t=this.props.controller.getMediaLocationInWindow(this.getCurrentMediaDescriptor())),t.then((t=>{this._completeClose(e,t)})).fail((()=>{this._completeClose(e)}))}else this._completeClose(e,void 0,s)}}_onViewerClosed(e){y.log(m.LogTraceArea.MediaViewerPanel,`Viewer closed: ${null==e?void 0:e.mediaType}-${null==e?void 0:e.id}`),this.props.onDidClose&&this.props.onDidClose()}_completeClose(e,t,s=w.DismissAnimationType.Default){this._onShowHideControls(!1);const i=this._getCurrentViewer(),o=this.getCurrentMediaDescriptor();this.props.onWillClose&&this.props.onWillClose(),i?((null==o?void 0:o.mediaType)===j.VideoViewer.MediaType&&i.stopVideo(),e?(i.close(),this._onViewerClosed(o)):i.animateClose(t,s).then((()=>{this._onViewerClosed(o)}))):this._onViewerClosed(o)}_loadPreviousAndNext(){if(!this.isComponentMounted())return;const e=this.getCurrentMediaDescriptor();let t=e,s=e;const i=[this._getCurrentMediaInfo()];for(let e=1;e<=1;e++)t&&(t=this.props.controller.getNextMedia?this.props.controller.getNextMedia(t):void 0,t&&i.push($._allocateMediaViewerInfo(t,e,this._viewerBounds.width))),s&&(s=this.props.controller.getPreviousMedia?this.props.controller.getPreviousMedia(s):void 0,s&&i.push($._allocateMediaViewerInfo(s,-e,this._viewerBounds.width)));this.setState({viewers:i})}_getCurrentViewer(){const e=this.getCurrentMediaDescriptor();if(e)return this._mediaViewerRefsMap.ref(K+e.id)}getCurrentMediaDescriptor(){const e=this._getCurrentMediaInfo();return e&&e.mediaDescriptor}_getCurrentMediaInfo(){return o.find(this.state.viewers,(e=>0===e.visualIndex))}_showCloseIcon(){return o.isUndefined(this.props.showCloseIcon)||this.props.showCloseIcon}static _allocateMediaViewerInfo(e,t,s){const i=t*(s+20),o=new n.Animated.Value(i),r=n.Styles.createAnimatedViewStyle({transform:[{translateX:o}]}),a=new n.Animated.Value(0),l=n.Styles.createAnimatedViewStyle({transform:[{translateY:a}]});return y.log(m.LogTraceArea.MediaViewerPanel,`New MediaViewerInfo id: ${e.id} index: ${t} offset: ${i}`),{mediaDescriptor:e,viewerControlsStore:I.MediaViewerFactory.allocateMediaViewerControlsStore(e),visualIndex:t,xOffsetValue:o,xOffsetStyle:r,yOffsetValue:a,yOffsetStyle:l}}_showControls(){this._controlsShown||this._toggleControls()}_updateViewerXOffset(e){const t=e.visualIndex*(this._viewerBounds.width+20);y.log(m.LogTraceArea.MediaViewer,`Viewer offset update: ${e.mediaDescriptor.id} index: ${e.visualIndex} offset: ${t}`),e.xOffsetValue.setValue(t)}}t.default=$},268080:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(147204),n=s(5795),r=s(656397),a=s(104735),l=s(827357),d=s(853374),c="mediaViewer";class h{static showWithConfig(e){h._show(e.initialMedia,e.controller,e.rootViewId,e.onClose,e.totalMedia)}static showWithMessageConfig(e){if(l.default.isUsingStackReactNavigationNoSubscription()){const t=d.default.newCauseId();a.default.navigateToConversationMediaViewer({conversationMri:e.initialMessage.conversationId,initialMessage:e.initialMessage,animateOpenClose:!1,reverseOrder:e.reverseOrder,viewMediaIntentScenario:e.viewMediaIntentScenario,getContentNode:e.getContentNode,origin:e.origin,defaultToLastItem:e.defaultToLastItem,emptyMediaDescriptor:e.emptyMediaDescriptor},t,e.rootViewId)}else{const t=(0,i.jsx)(r.default,{initialMessage:e.initialMessage,conversationMri:e.initialMessage.conversationId,animateOpenClose:e.animateOpenClose,initFromComponent:e.initFromComponent,closeToComponent:e.closeToComponent,reverseOrder:e.reverseOrder,defaultToLastItem:e.defaultToLastItem,viewMediaIntentScenario:e.viewMediaIntentScenario,emptyMediaDescriptor:e.emptyMediaDescriptor,onClose:()=>{this._onClose(e.onClose,e.rootViewId)},getContentNode:e.getContentNode,origin:e.origin});o.default.showModal(t,c,{rootViewId:e.rootViewId,useScopedModalId:!0})}}static _show(e,t,s,r=void 0,d=1){if(l.default.isUsingStackReactNavigationNoSubscription())a.default.navigateToMediaViewerPanel({initialMedia:e,controller:t,totalMedia:d});else{const a=(0,i.jsx)(n.default,{initialMedia:e,controller:t,totalMedia:d,onDidClose:()=>{this._onClose(r,s)}});o.default.showModal(a,c,{rootViewId:s,useScopedModalId:!0})}}}h._onClose=(e,t)=>{l.default.isUsingStackReactNavigationNoSubscription()||(o.default.dismissModal(c,t,!0),e&&e())},t.default=h},656397:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaViewerPanelModalComponent=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(217041),a=s(397691),l=s(996074),d=s(671830),c=s(662602),h=s(182146),u=s(952262),p=s(746096),g=s(913944),m=s(436237),S=s(861253),f=s(915877),y=s(733754),v=s(342653),C=s(570561),_=s(5795),b=s(415178),T=s(764387),M=s(520751),I=s(18078),w=s(638693),P=s(581760),k=s(711828),A=s(734528),x=s(619675),R=s(853374),O=s(7580),L=(0,f.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",overflow:"visible"}),opaqueContainer:()=>n.Styles.createViewStyle({backgroundColor:P.Color.black}),headerContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",backgroundColor:P.Color.transparent}),userName:()=>n.Styles.createTextStyle({color:P.Color.white,flex:1,textAlign:"center",paddingTop:16,textAlignVertical:"top"}),more:()=>(0,f.lazyProperties)({container:()=>n.Styles.createViewStyle({height:48,alignItems:"center",justifyContent:"center",flexDirection:"row"}),button:()=>n.Styles.createTextStyle({height:48,width:48})}),reaction:()=>(0,f.lazyProperties)({button:()=>n.Styles.createTextStyle({height:v.FooterContainerSize,width:v.FooterContainerSize,justifyContent:"center"})})}),F={mediaType:"EmptyMedia",id:"emptymedia"};class B extends l.default{constructor(){super(...arguments),this._cuidToCreatorName={},this._promiseAfterOpen=a.Defer(),this._galleryPreviewAnimatedOpacityValue=new n.Animated.Value(1),this._galleryPreviewAnimatedStyle=n.Styles.createAnimatedViewStyle({opacity:this._galleryPreviewAnimatedOpacityValue}),this._getMediaViewerController=()=>{const e={getOptions:()=>({animateOpenClose:this.props.animateOpenClose,showCustomFooter:!0,showCustomHeader:!0,customFooterHeight:v.FooterContainerSize}),getMediaLocationInWindow:e=>{const t=e.id?this._getMountedMediaNode(e.id):void 0;return t&&this.isComponentMounted()?c.default.measureLayoutRelativeToWindow((()=>t)):a.Rejected()},onMediaIsInFocus:e=>{const t=o.findIndex(this.state.messages,(t=>t.cuid===e.id));-1!==t?(this._setSelectedMessage(this.state.messages[t]),m.log(p.LogTraceArea.MediaViewerPanelModal,"controller.onMediaIsInFocus "+t+" / "+(this.state.messages.length-1))):m.log(p.LogTraceArea.MediaViewerPanelModal,"controller.onMediaIsInFocus item not found")},onShowMedia:e=>{const t=e.id?this._getMediaNode(e.id):void 0;t&&t.showNode()},onHideMedia:e=>{},getPreviousMedia:e=>{const t=this._getMediaItemIndex(e);if(!(t<=0))return T.default.getMediaDescriptorForItem(this.state.messages[t-1])},getNextMedia:e=>{const t=this._getMediaItemIndex(e);if(!(t<0||t+1>=this.state.messages.length))return T.default.getMediaDescriptorForItem(this.state.messages[t+1])},renderCustomHeader:(e,t)=>{const s=e.id&&this._cuidToCreatorName?this._cuidToCreatorName[e.id]:void 0;let o=null;o=(0,i.jsx)(g.default,{ref:this._setMoreButtonRef,size:k.IconSize.size24,style:L.more.button,onPress:t=>this._showMoreMenu(t,e),color:P.Color.white,hoverColor:P.Color.gray300,icon:A.moreIcon(),title:y.getString("Global.MoreOptions")});const{conversationMri:r}=this.state,a=!(r&&d.isAgent(r)||d.isBookmarkConversation(r))&&this._renderReactionButton(e);return(0,i.jsxs)(n.View,Object.assign({style:L.headerContainer},{children:[(0,i.jsx)(x.BodyText,Object.assign({size:x.BodyTextSize.SmallDeprecated,style:L.userName,accessibilityHidden:!0},{children:s})),(0,i.jsxs)(n.View,Object.assign({style:L.more.container},{children:[a,o]}))]}))},renderCustomFooter:e=>{const t=this._getCurrentMessage(e);return t?(0,i.jsx)(v.default,{hideLeftButton:!0,hideRightReactionButton:!0,message:t,mediaDescriptor:e,onDelete:this._onDelete,onShowSpinnerDelayShare:this._showSpinnerDelayShare}):void 0},getCurrentMessageForMedia:e=>this._getCurrentMessage(e)};return this.props.closeToComponent&&(e.getCloseToComponentPosition=()=>this.props.closeToComponent?c.default.measureLayoutRelativeToWindow(this.props.closeToComponent):a.Rejected()),this.props.initFromComponent&&(e.getInitFromComponentPosition=()=>this.props.initFromComponent?c.default.measureLayoutRelativeToWindow(this.props.initFromComponent):a.Rejected()),e},this._setMoreButtonRef=e=>{this._moreButton=e||void 0},this._getCurrentMessage=e=>{!e&&this._refMediaViewerPanel&&(e=this._refMediaViewerPanel.getCurrentMediaDescriptor());const t=o.find(this.state.messages,(t=>t.cuid===e.id));return this.state.initialMediaCuid!==e.id||t&&!(0,S.default)(this.props.initialMessage,t)?t:this.props.initialMessage},this._showSpinnerDelayShare=e=>{this._refMediaViewerPanel&&this._refMediaViewerPanel.showSpinnerForDelayShare(e)},this._onDelete=()=>{this._refMediaViewerPanel&&(this.state.messages.length,this._refMediaViewerPanel.close())},this._onClose=()=>{if(this._cuidToCreatorName=void 0,this._refMediaViewerPanel=void 0,this._refMediaViewerThumbnailList=void 0,this.props.onClose)this.props.onClose();else if(this._getContext().isPresentedByMobileStackNavigator){const e=R.default.newCauseId();m.warn(p.LogTraceArea.MediaViewerPanelModal,"MediaViewerPanelModalComponent._goBack, causeId: "+e),super._goBack(e)}},this._onOpen=()=>{this._promiseAfterOpen.resolve(void 0),this.setState({isOpening:!1})},this._onToggleControls=e=>{this._galleryPreviewAnimation&&this._galleryPreviewAnimation.stop();const t=e?1:0;this._galleryPreviewAnimation=n.Animated.timing(this._galleryPreviewAnimatedOpacityValue,{toValue:t,duration:O.AnimationDuration,easing:n.Animated.Easing.InOut()}),this._galleryPreviewAnimation.start((t=>{t.finished&&this.isComponentMounted()&&(this._galleryPreviewAnimation=void 0,this.setState({showGalleryPreview:e}))}))},this._onMediaViewerPanelRef=e=>{this._refMediaViewerPanel=e||void 0},this._onMediaViewerThumbnailListRef=e=>{this._refMediaViewerThumbnailList=e||void 0},this._onMediaItemPress=e=>{if(!this.state.showGalleryPreview)return;const t=this.props.emptyMediaDescriptor||F;this.setState({initialMediaCuid:e.cuid,initialMedia:T.default.getMediaDescriptorForItem(e)||t})},this._renderGalleryPreview=()=>{const{conversationMri:e,messages:t,isOpening:s,isLoading:o}=this.state,{initialMessage:r}=this.props;if(!(!r||!e||t.length<=1||s||o))return(0,i.jsx)(n.Animated.View,Object.assign({style:[this._galleryPreviewAnimatedStyle]},{children:(0,i.jsx)(b.default,{ref:this._onMediaViewerThumbnailListRef,conversationId:e,onMediaItemPress:this._onMediaItemPress,initialMessage:r,messages:t})}),"galleryPreview")},this._setSelectedMessage=e=>{this._refMediaViewerThumbnailList&&this._refMediaViewerThumbnailList.setSelectedMessage(e)},this._renderReactionButton=e=>{const t=this._getCurrentMessage(e);return t&&!I.default.isMyMri(t.creator)?(0,i.jsx)(w.default,{message:()=>t,isMessageKnownByServer:t.isAnyVersionKnownByServer(),style:L.reaction.button,colorOverride:P.Color.white,sizeOverride:k.IconSize.size24,hideAlternateReactionPacks:!0,keepOpenAfterReactionSelected:!1}):void 0}}_buildState(e,t){const s={};s.conversationMri=e.conversationMri||(e.initialMessage?e.initialMessage.conversationId:void 0);const i=e.emptyMediaDescriptor||F;if(s.conversationMri){s.messages=h.default.getMediaForConversation(s.conversationMri,e.initialMessage?e.initialMessage.createdTime:Date.now(),25,t&&e.origin!==p.NavigationMediaViewerOrigin.Gallery,e.reverseOrder,this._promiseAfterOpen.promise()),s.isLoading=h.default.isPopulatingOfSurroundMediaInProgressForConversation(s.conversationMri);const o=e.initialMessage||(s.messages.length>0?s.messages[e.defaultToLastItem?s.messages.length-1:0]:void 0);if(m.log(p.LogTraceArea.MediaViewerPanelModal,"message "+(o?o.cuid:"none")),o){this.state&&this.state.initialMedia&&this.state.initialMedia!==i||(m.log(p.LogTraceArea.MediaViewerPanelModal,"Setting initial media "+o.cuid),s.initialMediaCuid=o.cuid,s.initialMedia=T.default.getMediaDescriptorForItem(o)||i)}else s.initialMedia=i}else s.messages=[],s.initialMedia=i,s.initialMediaCuid="";return t&&(s.isOpening=!0,s.showGalleryPreview=!0,m.log(p.LogTraceArea.MediaViewerPanelModal,"componentDidMount"),this._associateCuidToCreatorName(s)),s}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this._associateCuidToCreatorName(this.state,t.messages)}componentWillUnmount(){super.componentWillUnmount(),this._cuidToCreatorName=void 0,this._refMediaViewerPanel=void 0,this._refMediaViewerThumbnailList=void 0}_associateCuidToCreatorName(e,t){this._cuidToCreatorName={},t=t||e.messages;const s=y.getString("DisplayInfoStore.ListMyName");o.each(t,(e=>{this._cuidToCreatorName&&(this._cuidToCreatorName[e.cuid]=I.default.isMyMri(e.creator)?s:u.default.getDisplayName(e.creator))}))}_getMediaItemIndex(e){return o.findIndex(this.state.messages,(t=>t.cuid===e.id&&T.default.isMediaItem(t)))}_getMountedMediaNode(e){return this._intGetMediaNode(e,!0)}_getMediaNode(e){return this._intGetMediaNode(e,!1)}_contentNode(e){if(this.props.getContentNode)return this.props.getContentNode(e)}_intGetMediaNode(e,t){const s=this._contentNode(e);if(s){const i=s.component;return t?i instanceof r.ComponentBase&&i.isComponentMounted()?i:void m.warn(p.LogTraceArea.MediaViewerPanelModal,"Component is unnmounted or is not a ComponentBase, cuid: "+e):i}}_showMoreMenu(e,t){const s=this._getCurrentMessage(t);s&&C.default.showWithConfig({message:s,mediaDescriptor:t,componentContext:this._getContext(),anchor:()=>this._moreButton,onDownloadDelay:this._showSpinnerDelayShare,invokingEvent:e})}render(){const e=(0,i.jsx)(_.default,{ref:this._onMediaViewerPanelRef,initialMedia:this.state.initialMedia,controller:this._getMediaViewerController(),totalMedia:o.isEmpty(this.state.messages)?1:this.state.messages.length,onDidClose:this._onClose,onOpen:this._onOpen,onToggleControls:this._onToggleControls,viewMediaIntentScenario:this.props.viewMediaIntentScenario,noFocusRestriction:!0,noBottomSpacing:!0}),t=[L.container];return this.props.useOpaqueBackground&&t.push(L.opaqueContainer),(0,i.jsxs)(n.View,Object.assign({style:t,restrictFocusWithin:!this._getContext().isPresentedInDesktopContentPanel},{children:[e,this._renderGalleryPreview(),(0,i.jsx)(M.default,{})]}))}}t.MediaViewerPanelModalComponent=B,t.default=B},415178:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(898278),a=s(677381),l=s(915877),d=s(223284),c=s(29130),h=s(451070),u=s(681115),p=s(581760),g=s(711828),m=s(680837),S=(0,l.lazyProperties)({containerStyle:()=>n.Styles.createViewStyle({backgroundColor:p.Color.black}),panel:()=>n.Styles.createViewStyle({flexDirection:"row",flexWrap:"nowrap",overflow:"visible"}),mediaWrapper:()=>n.Styles.createViewStyle({borderWidth:2,borderColor:p.Color.transparent,marginHorizontal:2,marginVertical:4,borderRadius:4,overflow:"hidden",width:94,height:94}),mediaWrapperSelected:()=>n.Styles.createViewStyle({borderColor:p.Color.white})});class f extends a.default{constructor(){super(...arguments),this.setSelectedMessage=e=>{this.setState({selectedMessage:e})},this._renderTiles=()=>this.state.messages.map((e=>this._renderMediaTile(e))),this._scrollViewRefCallback=e=>{this._scrollView=e},this._scrollToSelectedMessage=()=>{if(!this._scrollView||!this.isComponentMounted()||!this.state.selectedMessage)return;const{screenWidth:e}=this.state,t=this._getMessageIndex(this.state.selectedMessage);if(98*t-1<=e/2)return void this._scrollView.setScrollLeft(0,!0);let s=98*t-e/2+49;this._scrollView.setScrollLeft(s,!0)},this._onLayout=e=>{this._scrollToSelectedMessage()},this._onScrollViewContentSizeChanged=(e,t)=>{this._scrollToSelectedMessage()},this._getMessageIndex=e=>{if(0===this.state.messages.length||!e)return 0;const t=o.findIndex(this.state.messages,(t=>(t&&t.cuid)===e.cuid));return-1!==t?t:0},this._onThumbnailPress=e=>{this.props.onMediaItemPress(e)}}_buildState(e,t){const s=this._getRootViewId(),i=h.default.bottomSafeAreaInset(r.BottomInsetDefault),n=h.default.horizontalInsets(r.HorizontalInsetDefault),a={messages:o.compact(e.messages),screenWidth:c.default.getWidth(s),safeAreaInsets:Object.assign(Object.assign({},n),{bottom:i})};return t&&(a.selectedMessage=e.initialMessage),a}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.selectedMessage!==this.state.selectedMessage&&this._scrollToSelectedMessage()}render(){const e=[S.containerStyle];return this.state.safeAreaInsets.bottom&&e.push(u.default.marginBottomStyle(this.state.safeAreaInsets.bottom)),(this.state.safeAreaInsets.left||this.state.safeAreaInsets.right)&&e.push(u.default.horizontalMarginStyle(this.state.safeAreaInsets)),(0,i.jsx)(n.View,Object.assign({style:e},{children:(0,i.jsx)(n.ScrollView,Object.assign({horizontal:!0,vertical:!1,ref:this._scrollViewRefCallback,keyboardShouldPersistTaps:!1,showsHorizontalScrollIndicator:!1,style:m.default.flexOne,overScrollMode:"never",onLayout:this._onLayout,onContentSizeChange:this._onScrollViewContentSizeChanged},{children:(0,i.jsx)(n.View,Object.assign({style:S.panel},{children:this._renderTiles()}))}))}))}_renderMediaTile(e){const t=[S.mediaWrapper];return this.state.selectedMessage&&this.state.selectedMessage.cuid===e.cuid&&t.push(S.mediaWrapperSelected),(0,i.jsx)(n.View,Object.assign({style:t},{children:(0,i.jsx)(d.default,{message:e,height:90,width:90,showVideoMediaTypeIcon:!0,showOverlay:!0,showCreator:!1,onThumbnailPress:this._onThumbnailPress,shouldUseMessageAccessibilityLabel:!0,borderRadius:4,thumbnailIconsSize:g.IconSize.size32})}),e.cuid)}}t.default=f},822669:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PictureViewer=void 0;const i=s(785893),o=s(174958),n=s(496486),r=s(665768),a=s(516778),l=s(889391),d=s(898278),c=s(35566),h=s(952262),u=s(746096),p=s(139889),g=s(839821),m=s(110117),S=s(211276),f=s(436237),y=s(861253),v=s(916724),C=s(915877),_=s(733754),b=s(945983),T=s(874636),M=s(914976),I=s(915415),w=s(581760),P=s(711828),k=s(782176),A=s(167660),x=s(626712),R=(0,C.lazyProperties)({viewerContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",overflow:"visible"}),imageContainer:()=>a.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,overflow:"visible"}),imageGestureView:()=>a.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:w.Color.transparent,overflow:"visible"}),image:()=>a.Styles.createImageStyle({position:"absolute",left:0,right:0,top:0,bottom:0,alignItems:"stretch"}),spinnerContainer:()=>a.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,alignItems:"center",justifyContent:"center"}),alternateViewContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",backgroundColor:w.Color.black}),thumbnailPlaceholderText:()=>a.Styles.createViewStyle({flex:0,flexDirection:"row",backgroundColor:w.Color.transparent,padding:P.IconSize.size96/4})});class O extends A.ThumbnailMediaViewer{constructor(){super(...arguments),this._copyImage=()=>{this._viewerHasFocus&&this.state.fullSizeUri&&S.copyImageToClipboard(this.state.fullSizeUri)},this._onAnimatedFullSizedContainer=e=>{this._animatedFullSizedContainer=e},this._onPinchZoom=e=>{const t=e.distance/e.initialDistance;let s=1;this._prePinchZoomScale||(this._prePinchZoomScale=this._currentScale);let i=this._prePinchZoomScale*t;i>3?i=3+Math.sqrt(i-3):i<1&&(i=.5+.5*i,s=i,this.props.backgroundOpacityValue.setValue(s));const o=this._calcNewTranslationForScale(1===this._defaultScale?e.centerClientX:e.centerPageX,1===this._defaultScale?e.centerClientY:e.centerPageY,this._currentScale,i,this._currentTranslateX,this._currentTranslateY);if(this._containerAnimatedScaleValue.setValue(i),this._containerAnimatedTranslateXValue.setValue(o.x),this._containerAnimatedTranslateYValue.setValue(o.y),this._currentScale=i,this._currentTranslateX=o.x,this._currentTranslateY=o.y,e.isComplete){if(i<.75)this.props.onPinchZoomClose?this.props.onPinchZoomClose():this._leaveZoomMode();else if(i<1.25)this._leaveZoomMode();else if(this._setZoomModeActive(!0),i>3){const t=this._calcNewTranslationForScale(1===this._defaultScale?e.centerClientX:e.centerPageX,1===this._defaultScale?e.centerClientY:e.centerPageY,i,3,this._currentTranslateX,this._currentTranslateY);this._animateZoom(t.x,t.y,3,void 0,(()=>{this._animateImageBackOnScreen()}))}this._prePinchZoomScale=void 0}},this._onTap=e=>{this._isTapInImage(e)||!this.props.isShowingCloseIcon?this.props.onTap(e):this.props.onClose()},this._isTapInImage=e=>{if(!this.props.media.originalSize||!e)return!1;const t=this.props.viewerBounds.width/this.props.viewerBounds.height>(this.props.media.originalSize?this.props.media.originalSize.width/this.props.media.originalSize.height:0),s=(t?this.props.viewerBounds.height/this.props.media.originalSize.height:this.props.viewerBounds.width/this.props.media.originalSize.width)*(t?this.props.media.originalSize.width:this.props.media.originalSize.height),i=((t?this.props.viewerBounds.width:this.props.viewerBounds.height)-s)/2,o=i+s,n=t?e.clientX:e.clientY;return!!(n>i&&n<o||this.state.isZoomModeActive)},this._onDoubleTap=e=>{if(this.state.isZoomModeActive)this._leaveZoomMode();else{const t=this._calcNewTranslationForScale(1===this._defaultScale?e.clientX:e.pageX,1===this._defaultScale?e.clientY:e.pageY,this._currentScale,3,this._currentTranslateX,this._currentTranslateY);this._animateZoom(t.x,t.y,3,void 0,(()=>{this._animateImageBackOnScreen()})),this._setZoomModeActive(!0)}},this._onPan=e=>{const t=e.pageX-e.initialPageX,s=e.pageY-e.initialPageY;let i=this._constrainToOnScreen(this._currentTranslateX+t,this._currentTranslateY+s,!0);this._containerAnimatedTranslateXValue.setValue(i.translateX),this._containerAnimatedTranslateYValue.setValue(i.translateY),e.isComplete&&(i=this._constrainToOnScreen(this._currentTranslateX+t+50*e.velocityX,this._currentTranslateY+s+50*e.velocityY,!0),this._animateZoom(i.translateX,i.translateY,this._currentScale,a.Animated.Easing.Out(),(()=>{this._animateImageBackOnScreen()})))},this._onLoadThumbnail=e=>{this.isComponentMounted()&&(this.props.media.id&&T.pictureViewerThumbnailLoaded(this.props.media.id),this._markTrackerStepIfUnmarked("ThumbnailLoad"),this.setState({thumbnailLoaded:!0,thumbnailLoadFailed:!1}),this.props.controller.onThumbnailLoaded&&this._viewerHasFocus&&this.props.controller.onThumbnailLoaded(this.props.media,!0),this._completeOpenAnimation&&this._completeOpenAnimation())},this._onLoadFullSize=e=>{this.isComponentMounted()&&(this.props.media.id&&T.pictureViewerFullLoaded(this.props.media.id),this.setState({fullSizeLoadSucceeded:!0,fullSizeLoadFailed:!1,fullSizeDimensions:e}),this.props.controller.onFullLoaded&&this._viewerHasFocus&&this.props.controller.onFullLoaded(this.props.media,!0),this._animatedFullSizedContainer&&this._animatedFullSizedContainer.fadeIn(),this._markTrackerStepIfUnmarked("FullSizeLoad"),this._callbackIfTrackerUnresolved((e=>e.finish())),this._telemetryEvent&&(this._telemetryEvent.endDownload(),this._telemetryEvent.setSuccess(!0,u.MessagingFailureReason.None),f.track(this._telemetryEvent),this._telemetryEvent=void 0),this.state.displayName||a.Accessibility.announceForAccessibility(_.getString("MediaViewer.OpenedPictureUnknownAuthor")),this.props.onResumeAutoAdvance(!1))},this._onErrorFullSize=()=>{this.isComponentMounted()&&(this.setState({fullSizeLoadFailed:!0}),this.props.controller.onFullLoaded&&this._viewerHasFocus&&this.props.controller.onFullLoaded(this.props.media,!1),this._telemetryEvent&&(this._telemetryEvent.endDownload(),this._telemetryEvent.setSuccess(!1,u.MessagingFailureReason.AMSFailure),f.track(this._telemetryEvent),f.log(u.LogTraceArea.PictureViewer,"Full image load failed",this._telemetryEvent),this._telemetryEvent=void 0),this.props.onResumeAutoAdvance(!1))},this._onErrorThumbnail=()=>{this.isComponentMounted()&&this._viewerHasFocus&&(this.setState({renderFullSize:!0,thumbnailLoadFailed:!0}),this.props.controller.onThumbnailLoaded&&this._viewerHasFocus&&this.props.controller.onThumbnailLoaded(this.props.media,!1))}}_buildState(e,t){const s={},i=this.props,r=t||!(0,y.default)(e.media,i.media);if(r?(this._telemetryEvent=e.media.displayResolutionUrl?new v.FileReceived(o.pii.Omit(e.media.displayResolutionUrl),e.media.originalSizeInBytes,k.default.extractExtensionForTelemetry(e.media.downloadFileName)):void 0,s.renderFullSize=!1,s.thumbnailLoaded=!1,s.fullSizeUri=void 0,s.fullSizeLoadSucceeded=!1,s.fullSizeLoadFailed=!1,s.isZoomModeActive=!1,s.isSwitchingViews=!1):this.state.isSwitchingViews?s.isSwitchingViews=e.isAnimating:s.isSwitchingViews=!i.isAnimating&&e.isAnimating&&!this.state.fullSizeLoadSucceeded,e.cacheMode===b.CacheMode.Disabled)s.fullSizeUri=e.media.displayResolutionUrl,f.log(u.LogTraceArea.PictureViewer,"Cache is disabled hence loading full image from network "+e.media.id);else if(r||!this.state.fullSizeLoadSucceeded){const t=e.cacheId?g.default.getLocalUri(e.cacheId):void 0;t?(s.fullSizeUri=t,f.log(u.LogTraceArea.PictureViewer,"Loading full image from cache "+e.media.id)):e.cacheMode===b.CacheMode.FileCacheWithNetFallback&&(s.fullSizeUri=e.media.displayResolutionUrl,f.log(u.LogTraceArea.PictureViewer,"Loading full image from network "+e.media.id))}let a;const l={CacheMode:b.CacheMode[e.cacheMode]};if(e.controller.getCurrentMessageForMedia){const t=e.controller.getCurrentMessageForMedia(e.media);t&&(a=h.default.getDisplayName(t.creator),t.amsreferences&&(l.AmsDocumentIds=n.join(t.amsreferences,", ")))}return s.displayName=a,s.postedTime=undefined,s.telemetryProperties=l,s}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this.props.media.id&&T.pictureViewerOpening(this.props.media.id)}componentDidMount(){super.componentDidMount(),this.props.controller.onMediaDescriptorMounted&&this.props.controller.onMediaDescriptorMounted()}componentWillUnmount(){super.componentWillUnmount()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),!this._telemetryEvent||t.renderFullSize||this.state.fullSizeLoadSucceeded||this.state.fullSizeLoadFailed||!this.state.renderFullSize||(this._telemetryEvent.setMediaProfile(k.default.currentMediaProfile()),this._telemetryEvent.setIntent(u.MediaDownloadIntent.PictureViewer),this._telemetryEvent.startDownload())}render(){let e,t,s;this.state.thumbnailLoadFailed&&!this.state.fullSizeLoadSucceeded&&(e=(0,i.jsx)(a.View,Object.assign({style:R.alternateViewContainer},{children:(0,i.jsx)(m.default,{icon:P.SkypeIcon.Warning,color:w.Color.white,size:P.IconSize.size96,style:R.thumbnailPlaceholderText})}))),this.state.renderFullSize&&this.state.fullSizeUri&&!this.state.isSwitchingViews&&(f.log(u.LogTraceArea.PictureViewer,`Rendering full size image: ${this.props.media.id} uri: ${o.pii.Omit(this.state.fullSizeUri)}`),t=(0,i.jsx)(p.default,{origin:"PictureViewerFullRes",style:R.image,containerStyle:R.imageContainer,source:this.state.fullSizeUri,resizeMode:"contain",onLoad:this._onLoadFullSize,onError:this._onErrorFullSize,shouldInstrument:!0,telemetryProperties:this.state.telemetryProperties})),(this.state.thumbnailLoaded||this.state.thumbnailLoadFailed||this.state.fullSizeLoadSucceeded||this.state.isSwitchingViews)&&!this.props.showSpinnerForDelayShare||(s=(0,i.jsx)(a.View,Object.assign({style:R.spinnerContainer},{children:(0,i.jsx)(I.default,{size:d.SXActivityIndicatorSize.Medium,tintColor:w.Color.white})})));const n=this.state.displayName&&_.getString("MediaViewer.OpenedPicture",{senderName:this.state.displayName});return f.log(u.LogTraceArea.PictureViewer,`Rendering image with thumbnail: ${this.props.media.id} uri: ${o.pii.Omit(this.props.media.thumbnailUrl||"")}`),(0,i.jsx)(a.Animated.View,Object.assign({autoFocus:!1,style:R.viewerContainer,accessibilityLabel:n,importantForAccessibility:this.props.isMobileScreenReaderEnabled?a.Types.ImportantForAccessibility.No:void 0},{children:(0,i.jsxs)(a.GestureView,Object.assign({style:R.imageGestureView,onTap:this._onTap,onDoubleTap:this._onDoubleTap,onPinchZoom:this._onPinchZoom,onPan:this.state.isZoomModeActive?this._onPan:void 0,onPanVertical:this.state.isZoomModeActive?void 0:this.props.onPanVertical,onPanHorizontal:this.state.isZoomModeActive?void 0:this.props.onPanHorizontal,preferredPan:a.Types.PreferredPanGesture.Horizontal,onContextMenu:this.props.onContextMenu,importantForAccessibility:this.props.isMobileScreenReaderEnabled?a.Types.ImportantForAccessibility.No:a.Types.ImportantForAccessibility.Yes},{children:[(0,i.jsx)(a.Animated.View,Object.assign({style:[R.imageContainer,this._containerAnimatedXStyle]},{children:(0,i.jsx)(a.Animated.View,Object.assign({style:[R.imageContainer,this._containerAnimatedYStyle]},{children:(0,i.jsxs)(a.Animated.View,Object.assign({style:[R.imageContainer,this._containerAnimatedStyle]},{children:[(0,i.jsx)(p.default,{origin:"PictureViewerThumbnail",style:R.image,containerStyle:R.imageContainer,source:this.props.media.thumbnailUrl,resizeMode:"contain",errorView:e,onLoad:this._onLoadThumbnail,onError:this._onErrorThumbnail,telemetryProperties:this.state.telemetryProperties}),(0,i.jsx)(r.View,Object.assign({ref:this._onAnimatedFullSizedContainer,style:R.image,opacity:0},{children:t}))]}))}))})),s]}))}))}_calcNewTranslationForScale(e,t,s,i,o,n){const r=this._convertDisplayPointToImagePoint(e,t,this._currentScale,this._currentTranslateX,this._currentTranslateY),a=this._convertDisplayPointToImagePoint(e,t,i,this._currentTranslateX,this._currentTranslateY);return{x:this._currentTranslateX+(a.x-r.x)*i,y:this._currentTranslateY+(a.y-r.y)*i}}_convertDisplayPointToImagePoint(e,t,s,i,o){return{x:(e-i-this._containerWidth/2)/s+this._containerWidth/2,y:(t-o-this._containerHeight/2)/s+this._containerHeight/2}}_leaveZoomMode(){this._currentTranslateX=this._nonZoomModeTranslateX,this._currentTranslateY=this._nonZoomModeTranslateY,this._currentScale=this._defaultScale,a.Animated.parallel([a.Animated.timing(this._containerAnimatedScaleValue,{toValue:this._currentScale,duration:this._openCloseAnimationDuration,easing:a.Animated.Easing.InOut()}),a.Animated.timing(this._containerAnimatedTranslateXValue,{toValue:this._currentTranslateX,duration:this._openCloseAnimationDuration,easing:a.Animated.Easing.InOut()}),a.Animated.timing(this._containerAnimatedTranslateYValue,{toValue:this._currentTranslateY,duration:this._openCloseAnimationDuration,easing:a.Animated.Easing.InOut()}),a.Animated.timing(this.props.backgroundOpacityValue,{toValue:1,duration:this._openCloseAnimationDuration,easing:a.Animated.Easing.Linear()})]).start(),this._setZoomModeActive(!1)}_animateImageBackOnScreen(){const e=this._constrainToOnScreen(this._currentTranslateX,this._currentTranslateY,!1);e.translateX===this._currentTranslateX&&e.translateY===this._currentTranslateY||this._animateZoom(e.translateX,e.translateY,this._currentScale,a.Animated.Easing.In())}_constrainToOnScreen(e,t,s){const i=this._fitToContainerSafe(this._viewerBounds);let o=0,n=0;1===this._defaultScale?(o=i.width*this._currentScale,n=i.height*this._currentScale):(n=i.width*this._currentScale,o=i.height*this._currentScale);const r=Math.max((o-this._viewerBounds.width)/2,0),a=Math.max((n-this._viewerBounds.height)/2,0),l=s?.75:1,d=e-this._nonZoomModeTranslateX,c=t-this._nonZoomModeTranslateY;return d<-r?e+=(-d-r)*l:d>r&&(e-=(d-r)*l),c<-a?t+=(-c-a)*l:c>a&&(t-=(c-a)*l),{translateX:e,translateY:t}}_getFullScaleDimensions(){return this.state.fullSizeDimensions&&this.state.fullSizeDimensions.width>0&&this.state.fullSizeDimensions.height>0?this.state.fullSizeDimensions:this.props.media.originalSize&&this.props.media.originalSize.width>0&&this.props.media.originalSize.height>0?this.props.media.originalSize:this.props.media.thumbnailSize&&this.props.media.thumbnailSize.width>0&&this.props.media.thumbnailSize.height>0?this.props.media.thumbnailSize:this._viewerBounds}_setZoomModeActive(e){this.state.isZoomModeActive!==e&&(this.setState({isZoomModeActive:e}),e?this.props.onPauseAutoAdvance():this.props.onResumeAutoAdvance(!1))}_fitToContainerSafe(e){const t=!this.props.media.originalSize||1!==this._currentScale,s=this._getFullScaleDimensions();return c.default.fitToContainer(s,e,t)}_onCompleteOpen(){this.isComponentMounted()&&this._viewerHasFocus&&this.setState({renderFullSize:!0}),this._markTrackerStepIfUnmarked("AnimationComplete")}_markTrackerStepIfUnmarked(e){this._callbackIfTrackerUnresolved((t=>{t.isStepMarked(e)||t.markStepCompleted(e)}))}_callbackIfTrackerUnresolved(e){this.props.viewMediaIntentScenario&&!this.props.viewMediaIntentScenario.isResolved()&&e(this.props.viewMediaIntentScenario)}_calcAnimateFromLocation(e){const t=this._getSize();if(!t)return e;const s=n.clone(e),i=e.width/e.height,o=t.width/t.height;if(Math.abs(i-o)>.1)if(i<o){const t=e.height*o;s.width=t,s.x-=(t-e.width)/2}else if(i>o){const t=e.width/o;s.height=t,s.y-=(t-e.height)/2}return s}_onFocusChanged(e,t){super._onFocusChanged(e,t),this._viewerHasFocus=e,!e&&this.state.renderFullSize?this.setState({renderFullSize:!1}):e&&this.setState({renderFullSize:!0})}_handleCaching(e,t){super._handleCaching(e,t);const s=!!this.props.media;if(f.log(u.LogTraceArea.PictureViewer,"handleCaching, has media: "+s+" mediaId: "+(s?this.props.media.id:"none")+" cacheMode: "+this.props.cacheMode+" cacheId: "+M.mriOrId(this.props.cacheId)+" causeId: "+t),this.props.media&&this.props.media.displayResolutionUrl&&!x.default.isFileOrBlob(this.props.media.displayResolutionUrl)&&this.props.cacheMode===b.CacheMode.FileCacheWithPrefetching&&this.props.cacheId)if(e){f.log(u.LogTraceArea.PictureViewer,"handleCaching prefetching media for "+this.props.media.id+" causeId: "+t);const e=1e3*l.default.getS4LCMCFeaturesNoSubscription().picturePrefetchCacheExpiryTimeSec;this.prefetchMediaToCacheIfSupported(this.props.cacheId,this.props.media.displayResolutionUrl,this.props.media.downloadFileName,e).then(n.noop)}else f.log(u.LogTraceArea.PictureViewer,"handleCaching cancelling prefetching for "+this.props.media.id+" causeId: "+t),this.cancelPrefetchIfPending(this.props.cacheId,t)}getCloseButtonAccLabel(){return _.getString("MediaViewer.CloseButtonAccLabelImage")}}O.MediaType=b.MediaViewerTypes.Picture,t.PictureViewer=O},167660:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ThumbnailMediaViewer=void 0;const i=s(496486),o=s(35566),n=s(7580);class r extends n.MediaViewer{constructor(){super(...arguments),this._animate=()=>{this.state.thumbnailLoaded||this.state.thumbnailLoadFailed?this._completeOpenAnimation&&this._completeOpenAnimation():i.delay((()=>{this._completeOpenAnimation&&this._completeOpenAnimation()}),500)},this._getSize=()=>this.props.media.originalSize||this.props.media.thumbnailSize,this._allowUpscale=()=>!this.props.media.originalSize}canAnimateOpenClose(){if(!this.props.controller.getOptions().animateOpenClose)return!1;const e=this._getSize();return!!e&&e.width>0&&e.height>0}_calcAnimateFromLocation(e){const t=this._getSize();if(!t)return e;const s=i.clone(e),o=e.width/e.height,n=t.width/t.height;if(Math.abs(o-n)>.1)if(o<n){const t=e.height*n;s.width=t,s.x-=(t-e.width)/2}else if(o>n){const t=e.width/n;s.height=t,s.y-=(t-e.height)/2}return s}_fitToContainerSafe(e){const t=this._allowUpscale(),s=this._getSize();return s?o.default.fitToContainer(s,e,t):{width:0,height:0}}}t.ThumbnailMediaViewer=r},379467:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VideoViewer=t.VideoDownloadActions=void 0;const i=s(785893),o=s(496486),n=s(285788),r=s(583367),a=s(516778),l=s(397691),d=s(300060),c=s(889391),h=s(38566),u=s(734581),p=s(898278),g=s(273145),m=s(35566),S=s(952262),f=s(770891),y=s(746096),v=s(139889),C=s(839821),_=s(139285),b=s(110117),T=s(436237),M=s(861253),I=s(915877),w=s(733754),P=s(265822),k=s(971349),A=s(945983),x=s(192210),R=s(914976),O=s(886045),L=s(404057),F=s(293194),B=s(915415),D=s(581760),E=s(711828),V=s(680837),N=s(782176),U=s(167660),j=s(994214),H=s(815188),z=s(378194),W=s(626712),G=s(853374),K=s(516718),q=s(54288),Q=s(803729);var X;!function(e){e.PauseDownload="pauseDownloadCommand",e.ResumeDownload="resumeDownloadCommand"}(X=t.VideoDownloadActions||(t.VideoDownloadActions={}));const $=(0,I.lazyProperties)({viewerContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",overflow:"visible"}),videoOverflow:()=>[V.default.absoluteFill,V.default.overflowVisible],thumbnail:()=>a.Styles.createImageStyle({flex:1,alignSelf:"stretch"}),centeredContainer:()=>a.Styles.createViewStyle({alignItems:"center",justifyContent:"center",backgroundColor:D.Color.transparent}),progressText:()=>a.Styles.createViewStyle({alignItems:"center",justifyContent:"flex-end",marginBottom:14}),alternateViewContainer:()=>a.Styles.createViewStyle({backgroundColor:D.Color.black}),thumbnailPlaceholderText:()=>a.Styles.createViewStyle({flex:0,flexDirection:"row",backgroundColor:D.Color.transparent,padding:E.IconSize.size96/4}),overlayContainerBackground:()=>a.Styles.createViewStyle({backgroundColor:D.Color.blackOverlay10})});class J extends U.ThumbnailMediaViewer{constructor(){super(...arguments),this._audioManagerClient=new h.default(h.AudioManagerSource.VideoViewer),this._videoPausedBeforeLoad=!1,this._accessibilityAnnouncementPlayed=!1,this._cachingTimerStarted=!1,this._cachingStartTime=0,this._cachingDuration=0,this._cachingSuccess=!1,this._videoContainerAnimatedXStyle=a.Styles.createAnimatedViewStyle({width:this._containerAnimatedWidthValue,height:this._containerAnimatedHeightValue,opacity:this._containerAnimatedOpacityValue,transform:[{translateX:this._containerAnimatedTranslateXValue}]}),this._videoContainerAnimatedYStyle=a.Styles.createAnimatedViewStyle({transform:[{translateY:this._containerAnimatedTranslateYValue}]}),this._videoContainerAnimatedStyle=a.Styles.createAnimatedViewStyle({transform:[{scale:this._containerAnimatedScaleValue}]}),this._onAppStateChange=e=>{0},this._handlePauseOrResumeDownloadCommand=e=>{const t=G.default.newCauseId();switch(T.log(y.LogTraceArea.MediaViewer,"Media _pauseOrResumeDownload, causeId: "+t),e){case X.PauseDownload:a.Accessibility.announceForAccessibility(w.getString("MediaViewer.DownloadPaused")),this._cancelPrefetching(t),this.isComponentMounted()&&this.setState({isDownloadPaused:!0});break;case X.ResumeDownload:a.Accessibility.announceForAccessibility(w.getString("MediaViewer.Downloading")),this._startPrefetching(),this.isComponentMounted()&&this.setState({isDownloadPaused:!1});case F.SXActionMenuCancel:}},this._onLongPress=e=>{const t={anchor:()=>this.isComponentMounted()?this:void 0,buttons:this._getPauseDownloadMenuItems()};F.default.showWithActionMenuConfig({options:t,callback:this._handlePauseOrResumeDownloadCommand,rootViewId:this._getRootViewId(),invokingEvent:e})},this._onPress=()=>this._handlePauseOrResumeDownloadCommand(X.ResumeDownload),this._getPauseDownloadMenuItems=()=>{const e=[];return e.push({text:w.getString("MediaViewer.PauseDownload"),command:X.PauseDownload}),e},this._onContextMenuRef=e=>{this._contextMenu=e||void 0},this._onContextMenu=e=>{this._contextMenu&&this._contextMenu.show(e)},this._onVideoPlayerRef=e=>{this._videoPlayerRef=e||void 0},this.playOrPauseVideo=()=>{this.props.controlsStore.getVideoPlayState()===q.VideoPlayState.Playing?(this.props.controlsStore.pause(),this.props.autoHideHeaderFooterControls&&this.props.autoHideHeaderFooterControls(!1)):(this.props.controlsStore.play(),this.props.autoHideHeaderFooterControls&&this.props.autoHideHeaderFooterControls(!0))},this.isFocused=()=>this._viewerHasFocus,this.displayControlsWhenVideoFocused=()=>{this._viewerHasFocus&&this.props.autoHideHeaderFooterControls&&this.props.autoHideHeaderFooterControls(!1)},this._onEnded=()=>{this.isComponentMounted()&&(T.log(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onEnded"),this.setState({isPlaying:!1}),this.props.onVideoEnded&&this.props.onVideoEnded(),this.props.autoHideHeaderFooterControls&&this.props.autoHideHeaderFooterControls(!1),this.props.onResumeAutoAdvance(!1),this.props.media.onVideoComplete&&this.props.media.onVideoComplete())},this._onWaiting=()=>{T.log(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onWaiting"),this.isComponentMounted()&&this.setState({isVideoPausedOnBuffering:!0})},this._onPlaying=()=>{T.log(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onPlaying"),this.isComponentMounted()&&this.setState({isVideoPausedOnBuffering:!1})},this._onLoadedData=e=>{this.isComponentMounted()&&e.duration&&(T.log(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onLoadedData duration="+e.duration),this.setState({videoDuration:e.duration}))},this._onCanPlay=()=>{this.isComponentMounted()&&!this.state.isVideoLoaded&&(T.log(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onCanPlay videoPausedBeforeLoad="+this._videoPausedBeforeLoad),this.setState({isVideoLoaded:!0,videoLoadFailed:!1,isPlaying:!this._videoPausedBeforeLoad}),this.props.controller.onFullLoaded&&this._viewerHasFocus&&this.props.controller.onFullLoaded(this.props.media,!0))},this._onVideoLoadError=()=>{this.isComponentMounted()&&(T.log(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onVideoLoadError"),this.setState({videoLoadFailed:!0}),this.props.controller.onFullLoaded&&this._viewerHasFocus&&this.props.controller.onFullLoaded(this.props.media,!1))},this._onProgress=e=>{if(this._viewerHasFocus&&this.props.controlsStore&&!this._videoPausedBeforeLoad){const t=this.props.controlsStore.getVideoPlayProgress();!this.state.isPlaying&&e.currentTime>0&&0===t.current&&t.duration>=0?this.isComponentMounted()&&this.setState({isPlaying:!0}):this.state.isPlaying||T.log(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").onProgress while video is not playing"),this.props.controlsStore.setVideoPlayProgress({current:e.currentTime,duration:this.state.videoDuration}),this.props.media.onVideoProgress&&this.props.media.onVideoProgress(e.currentTime,this.state.videoDuration,this.state.isPlaying)}},this._onSeek=e=>{this._viewerHasFocus&&this.props.controlsStore&&!this._videoPausedBeforeLoad&&this.props.controlsStore.setVideoPlayProgress({current:e.currentTime,duration:this.state.videoDuration})},this._onLoad=e=>{this.isComponentMounted()&&(this.setState({thumbnailLoaded:!0}),this.props.controller.onThumbnailLoaded&&this._viewerHasFocus&&this.props.controller.onThumbnailLoaded(this.props.media,!0),this._completeOpenAnimation&&this._completeOpenAnimation())},this._onError=()=>{this.isComponentMounted()&&(this.setState({thumbnailLoadFailed:!0}),this.props.controller.onThumbnailLoaded&&this._viewerHasFocus&&this.props.controller.onThumbnailLoaded(this.props.media,!1),this.props.onResumeAutoAdvance(!1))},this._playAccAnnouncementIfNeeded=()=>{if(!O.default.isMobileScreenReaderEnabled()||this._accessibilityAnnouncementPlayed)return;let e;this.state.displayName||(e=w.getString("MediaViewer.OpenedVideoUnknownAuthor")),this._isPrefetching()&&(e=w.getString("MediaViewer.Downloading")),e&&a.Accessibility.announceForAccessibility(e),this._accessibilityAnnouncementPlayed=!0}}_buildState(e,t){const s={mediaProfile:N.default.currentMediaProfile()};t&&(this._id=G.default.newCauseId());const i=this.props,o=t||!(0,M.default)(e.media,i.media);if(o&&(s.thumbnailLoaded=!1,s.thumbnailLoadFailed=!1,s.isPlaying=!1,s.videoDuration=0,s.isVideoLoaded=!1,s.videoLoadFailed=!1,s.showVideoPlayer=!1,s.isAuthTokenLoaded=!0,this._videoPausedBeforeLoad=!1),e.media.videoProvider===f.MediaProvider.AMS&&(s.authToken=j.default.getRawSkypeToken(),s.isAuthTokenLoaded=!0),e.cacheMode===A.CacheMode.Disabled||e.media.videoProvider===f.MediaProvider.AzureMS)s.videoUrl=e.media.videoUrl,s.videoProvider=e.media.videoProvider,T.log(y.LogTraceArea.VideoViewer,"Cache is disabled hence loading full video from network "+e.media.id);else if(o||!this.state.isVideoLoaded){const t=e.cacheId?C.default.getLocalUri(e.cacheId):void 0;t?(s.videoUrl=t,s.videoProvider=f.MediaProvider.FileCache,T.log(y.LogTraceArea.VideoViewer,"Loading full video from cache "+e.media.id)):e.cacheMode===A.CacheMode.FileCacheWithNetFallback&&(s.videoUrl=e.media.videoUrl,s.videoProvider=e.media.videoProvider,T.log(y.LogTraceArea.VideoViewer,"Loading full video from network "+e.media.id))}const n=P.default.getActivePlayerToken();if(!t&&this._playerToken!==n&&this.state.isPlaying&&(s.isPlaying=!1),e.controller.getCurrentMessageForMedia){const t=e.controller.getCurrentMessageForMedia(e.media);t&&(s.displayName=S.default.getDisplayName(t.creator))}return s}_specializeInstrumentation(){this.props.viewMediaIntentScenario&&this.props.viewMediaIntentScenario.renameScenario(x.ScenarioName.PlayVideoIntent)}componentDidMount(){super.componentDidMount(),this._playerToken=P.default.registerAsPlayer(),this.state.isAuthTokenLoaded||u.default.getAuthToken().then((e=>{this.isComponentMounted()&&this.setState({authToken:e,isAuthTokenLoaded:!0})})),this._activationSubToken=d.default.subscribeForChanges("VideoViewer",this._onAppStateChange),this.props.controller.onMediaDescriptorMounted&&this.props.controller.onMediaDescriptorMounted(),T.log(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").componentDidMount"),this._specializeInstrumentation()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._viewerHasFocus&&this._playAccAnnouncementIfNeeded();const i=G.default.newCauseId();T.log(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").componentDidUpdate causeId: "+i),(t.isVideoLoaded&&!this.state.isVideoLoaded||t.isPlaying&&!this.state.isPlaying)&&(T.log(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+") pausing video. prevState.isVideoLoaded="+t.isVideoLoaded+" state.isVideoLoaded="+this.state.isVideoLoaded+" prevState.isPlaying="+t.isPlaying+" state.isPlaying="+this.state.isPlaying),this.pauseVideo()),this._viewerHasFocus&&((!this._videoPausedBeforeLoad&&!t.isVideoLoaded&&this.state.isVideoLoaded||!t.isPlaying&&this.state.isPlaying)&&this.isComponentMounted()&&(this._audioManagerClient.hasToken()?this.playVideo():this._audioManagerClient.requestMode(n.AudioModes.VideoPlayback,i).then((e=>{e&&this.isComponentMounted()&&(P.default.setAsActive(this._playerToken),this.playVideo())}))),this.state.isVideoLoaded&&this.state.isAuthTokenLoaded&&(this.props.controlsStore.setVideoPlayState(this.state.isPlaying?q.VideoPlayState.Playing:q.VideoPlayState.Paused),this.props.controlsStore.registerViewerCallbacks({onPlay:()=>{this.isComponentMounted()&&this.setState({isPlaying:!0})},onPause:()=>{this.isComponentMounted()&&this.setState({isPlaying:!1})},onSeekTo:e=>{this._onSeekTo(e)},onMute:e=>{this._muteVideo(e)}})),this._muteVideo(this.props.controlsStore.isMuted()))}_onToggleAllowScreenLock(e){e?r.default.allowScreenLock().catch((e=>{T.warn(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+") allowScreenLock failed: "+L.default.errorAsString(e))})):r.default.blockScreenLock().catch((e=>{T.warn(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+") blockScreenLock failed: "+L.default.errorAsString(e))}))}componentWillUnmount(){super.componentWillUnmount();const e=G.default.newCauseId();if(T.log(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").componentWillUnmount causeId: "+e),this._cachingTimerStarted&&!this._cachingSuccess){this._cachingDuration=Date.now()-this._cachingStartTime,T.log(y.LogTraceArea.VideoViewer,`VideoViewer(${this._id}).componentWithUnmount tracking incomplete file caching cachingDuration: ${this._cachingDuration} causeId: ${e}`);const t=new k.VideoPlayback(this.props.media.videoUrl,this.props.media.videoProvider,this.props.media.originalSize,"VideoViewer",this.props.media.amsReferences,this.props.messagetype);t.setCachingStatus(this._cachingSuccess,this.props.cacheMode,this._cachingDuration),T.track(t)}this._audioManagerClient.release(e),this._onToggleAllowScreenLock(!0),this._accessibilityAnnouncementPlayed=!1,this._activationSubToken.unsubscribe()}render(){let e,t,s,o,n,r;if(this.state.videoLoadFailed&&(e=(0,i.jsx)(a.View,Object.assign({style:[V.default.absoluteFill,$.centeredContainer,$.alternateViewContainer]},{children:(0,i.jsx)(b.default,{icon:E.SkypeIcon.Warning,size:E.IconSize.size96,color:D.Color.white,style:$.thumbnailPlaceholderText})}))),this.state.showVideoPlayer&&this.state.videoUrl&&(t=(0,i.jsx)(_.default,Object.assign({style:$.videoOverflow},{children:(0,i.jsx)(Q.default,{origin:"VideoViewer",ref:this._onVideoPlayerRef,style:V.default.absoluteFill,source:this.state.videoUrl,authToken:this.state.authToken,mediaProvider:this.state.videoProvider,loop:this.props.media.loop,amsReferences:this.props.media.amsReferences,onEnded:this._onEnded,onLoadedData:this._onLoadedData,onCanPlay:this._onCanPlay,onError:this._onVideoLoadError,onProgress:this._onProgress,onSeek:this._onSeek,onWaiting:this._onWaiting,onPlaying:this._onPlaying,resizeMode:"contain",shouldRedirectForAndroidHLS:this._shouldRedirectForAndroidHLS(),resumeAfterForeground:this._shouldResumeAfterForeground(),playbackIntentScenario:this.props.viewMediaIntentScenario,size:this.props.media.originalSize,cacheMode:this.props.cacheMode,cachingDuration:this._cachingDuration,sizeInBytes:this.props.media.originalSizeInBytes,messagetype:this.props.messagetype,mediaProfile:this.state.mediaProfile},"video-player")})),s=(0,i.jsx)(K.VideoViewerControls,{controlsStore:this.props.controlsStore,autoHideHeaderFooterControls:this.props.autoHideHeaderFooterControls,onPlayOrPause:this.playOrPauseVideo})),(this.state.showVideoPlayer&&(!this.state.isVideoLoaded||!this.state.isAuthTokenLoaded||this.state.isVideoPausedOnBuffering||!this.state.videoUrl)||this.props.showSpinnerForDelayShare)&&!this.state.videoLoadFailed&&this.state.videoProvider!==f.MediaProvider.FileCache)if(this._isPrefetching()){const e=this._isMobile()?this._onLongPress:this._onContextMenu,t=this._isMobile()?void 0:this._onContextMenu,s=(0,i.jsx)(_.default,Object.assign({style:[V.default.absoluteFill,$.centeredContainer],onLongPress:this.state.isDownloadPaused?void 0:e,onContextMenu:this.state.isDownloadPaused?void 0:t,onPress:this.state.isDownloadPaused?this._onPress:void 0},{children:(0,i.jsx)(H.default,{contentUrls:[this.props.media.videoUrl],strokeColor:D.Color.white,size:E.IconSize.size60,showFiniteProgressIndicatorUI:!0,isDownloadPaused:this.state.isDownloadPaused,isDownload:!0})}));o=(0,i.jsx)(g.default,Object.assign({getMenuItems:this._getPauseDownloadMenuItems,onItemSelected:this._handlePauseOrResumeDownloadCommand,ref:this._onContextMenuRef,wrapperOnly:!0},{children:s})),n=(0,i.jsx)(_.default,Object.assign({style:[V.default.absoluteFill,$.progressText]},{children:(0,i.jsx)(z.default,{showShadow:!0,contentUrl:this.props.media.videoUrl,fileSizeInBytes:this.props.media.originalSizeInBytes,isDownload:!0,isDownloadPaused:this.state.isDownloadPaused})}))}else o=(0,i.jsx)(a.View,Object.assign({style:[V.default.absoluteFill,$.centeredContainer]},{children:(0,i.jsx)(B.default,{size:p.SXActivityIndicatorSize.Medium,tintColor:D.Color.white})}));this.props.media.thumbnailUrl&&(r=(0,i.jsx)(v.default,{origin:"VideoViewerThumbnail",style:$.thumbnail,containerStyle:$.viewerContainer,source:this.props.media.thumbnailUrl,resizeMode:"contain",onLoad:this._onLoad,onError:this._onError,shouldInstrument:!1}));let l,d,c=this.state.isPlaying?w.getString("MediaViewer.Pause"):w.getString("MediaViewer.Play");l=this.state.isPlaying?w.getString("MediaViewer.PauseVideo"):this.state.displayName?w.getString("MediaViewer.PlaySomeonesVideo",{senderName:this.state.displayName}):w.getString("MediaViewer.PlayVideo"),this._isPrefetching()?(this.state.isDownloadPaused?(c=w.getString("MediaViewer.ResumeDownload"),l=w.getString("MediaViewer.ResumeDownload")):(c=w.getString("MediaViewer.PauseDownload"),l=w.getString("MediaViewer.PauseDownload")),this.props.autoHideHeaderFooterControls&&this.props.autoHideHeaderFooterControls(!1)):d=this._isMobile()?this.props.onTap:void 0;const h=(0,i.jsx)(a.View,{style:[$.overlayContainerBackground,V.default.absoluteFill]});return(0,i.jsx)(a.View,Object.assign({style:$.viewerContainer,accessibilityLabel:this.props.isMobileScreenReaderEnabled?void 0:c,importantForAccessibility:this.props.isMobileScreenReaderEnabled?a.Types.ImportantForAccessibility.No:void 0,accessibilityTraits:this.props.isMobileScreenReaderEnabled?void 0:a.Types.AccessibilityTrait.Button},{children:(0,i.jsxs)(a.GestureView,Object.assign({style:$.videoOverflow,onPanVertical:this.props.onPanVertical,onPanHorizontal:this.props.onPanHorizontal,preferredPan:a.Types.PreferredPanGesture.Horizontal,accessibilityLabel:this.props.isMobileScreenReaderEnabled?void 0:l,onTap:d},{children:[(0,i.jsx)(a.Animated.View,Object.assign({style:[$.videoOverflow,this._videoContainerAnimatedXStyle]},{children:(0,i.jsx)(a.Animated.View,Object.assign({style:[$.videoOverflow,this._videoContainerAnimatedYStyle]},{children:(0,i.jsxs)(a.Animated.View,Object.assign({style:[$.videoOverflow,this._videoContainerAnimatedStyle]},{children:[r,h,t,e,this._showVideoControlsWithProgressBar()?void 0:s]}))}))})),this._showVideoControlsWithProgressBar()?s:void 0,n,o]}))}))}_isMobile(){return!1}_showVideoControlsWithProgressBar(){return this._isMobile()}_shouldRedirectForAndroidHLS(){return!!this.props.media&&this.props.media.videoProvider===f.MediaProvider.AzureMS&&!1}setPauseButtonVisibility(e){this.props.controlsStore.setPlayPauseButtonState(e)}setScrubberControlsVisibility(e){this.props.controlsStore.setScrubberControlsVisibility(e)}playVideo(){this._videoPlayerRef&&(this._videoPlayerRef.play(),a.Accessibility.announceForAccessibility(w.getString("MediaViewer.PlayingVideo")),this.props.onPauseAutoAdvance(),this._onToggleAllowScreenLock(!1),this._isMobile()&&this.props.onPlayVideo&&this.props.onPlayVideo()),this.state.isVideoLoaded||(this._videoPausedBeforeLoad=!1)}stopVideo(){this._videoPlayerRef&&(this._videoPlayerRef.stop(),this.props.onPauseAutoAdvance(),this._onToggleAllowScreenLock(!0)),this.state.isVideoLoaded||(this._videoPausedBeforeLoad=!0)}pauseVideo(){this._videoPlayerRef&&(this._videoPlayerRef.pause(),a.Accessibility.announceForAccessibility(w.getString("MediaViewer.VideoPaused")),this.props.onPauseAutoAdvance(),this.state.isVideoPausedOnBuffering&&this.isComponentMounted()&&this.setState({isVideoPausedOnBuffering:!1}),this._onToggleAllowScreenLock(!0)),this.state.isVideoLoaded||(this._videoPausedBeforeLoad=!0)}_onSeekTo(e){this._videoPlayerRef&&(this._videoPlayerRef.seekPercent(e),this.props.onPauseAutoAdvance(),this.props.onShowHideControls(!0))}_muteVideo(e){this._videoPlayerRef&&this._videoPlayerRef.mute(e)}_onCompleteOpen(){this.isComponentMounted()&&this.setState({showVideoPlayer:!0})}_calcAnimateFromLocation(e){const t=this.props.media.thumbnailSize;if(!t)return e;const s=o.clone(e),i=e.width/e.height,n=t.width/t.height;if(Math.abs(i-n)>.1)if(i<n){const t=e.height*n;s.width=t,s.x-=(t-e.width)/2}else if(i>n){const t=e.width/n;s.height=t,s.y-=(t-e.height)/2}return s}_shouldResumeAfterForeground(){return!!this.props.resumeAfterForeground}canAnimateOpenClose(){return!!this.props.controller.getOptions().animateOpenClose&&this.hasValidMediaSize()}hasValidMediaSize(){const e=this.props.media.originalSize||this.props.media.thumbnailSize;return!!e&&e.width>0&&e.height>0}animateOpen(e){const t=l.Defer();this._viewerBounds={width:e.width,height:e.height},this._viewerHasFocus=!0,this.props.onPauseAutoAdvance();const s=this.props.media.originalSize||this.props.media.thumbnailSize,i=s?m.default.fitToContainer(s,this._viewerBounds,!0):this._viewerBounds,n=(this._viewerBounds.width-i.width)/2,r=(this._viewerBounds.height-i.height)/2;this._containerAnimatedWidthValue.setValue(i.width),this._containerAnimatedHeightValue.setValue(i.height),this._currentScale=this._defaultScale,this._currentTranslateX=n,this._currentTranslateY=r;const d=()=>{this._containerAnimatedScaleValue.setValue(this._defaultScale),this._containerAnimatedTranslateXValue.setValue(n),this._containerAnimatedTranslateYValue.setValue(r),this._containerAnimatedOpacityValue.setValue(1),this._onCompleteOpen(),t.resolve(void 0)};return this.props.controller.getMediaLocationInWindow?this.props.controller.getMediaLocationInWindow(this.props.media).then((e=>{const s=this._calcAnimateFromLocation(e),l=s.width?s.width/i.width:this._currentScale,d=s.x?s.x-(1-l)*i.width/2:this._currentTranslateX,c=s.y?s.y-(1-l)*i.height/2:this._currentTranslateY;this._containerAnimatedScaleValue.setValue(l),this._containerAnimatedTranslateXValue.setValue(this._getContext().isRTL?-d:d),this._containerAnimatedTranslateYValue.setValue(c),this._containerAnimatedOpacityValue.setValue(1),this._completeOpenAnimation=()=>{this.props.controller.onHideMedia&&this.props.controller.onHideMedia(this.props.media),this._animateZoom(n,r,this._defaultScale,a.Animated.Easing.Out(),(()=>{this._onCompleteOpen(),t.resolve(void 0)})),this._completeOpenAnimation=void 0},this.state.thumbnailLoaded||this.state.thumbnailLoadFailed?this._completeOpenAnimation():o.delay((()=>{this._completeOpenAnimation&&this._completeOpenAnimation()}),500)})).fail(d):d(),t.promise()}animateClose(e,t){const s=l.Defer();if(this.canAnimateOpenClose()){this._viewerBounds||(this._viewerBounds={width:0,height:0});const i=[a.Animated.timing(this.props.backgroundOpacityValue,{toValue:0,duration:this._openCloseAnimationDuration,easing:a.Animated.Easing.Linear()})];if(e){const t=this.props.media.originalSize||this.props.media.thumbnailSize,s=t?m.default.fitToContainer(t,this._viewerBounds,!0):this._viewerBounds,o=e.width?e.width/s.width:this._currentScale,n=e.x?e.x-(1-o)*s.width/2:this._currentTranslateX,r=e.y?e.y-(1-o)*s.height/2:this._currentTranslateY;i.push(a.Animated.timing(this._containerAnimatedScaleValue,{toValue:o,duration:this._openCloseAnimationDuration,easing:a.Animated.Easing.In()})),i.push(a.Animated.timing(this._containerAnimatedTranslateXValue,{toValue:n,duration:this._openCloseAnimationDuration,easing:a.Animated.Easing.In()})),i.push(a.Animated.timing(this._containerAnimatedTranslateYValue,{toValue:r,duration:this._openCloseAnimationDuration,easing:a.Animated.Easing.In()}))}else t===A.DismissAnimationType.Vertical?i.push(a.Animated.timing(this._containerAnimatedTranslateYValue,{toValue:this._viewerBounds.height,duration:this._openCloseAnimationDuration,easing:a.Animated.Easing.Out()})):t===A.DismissAnimationType.Horizontal&&i.push(a.Animated.timing(this._containerAnimatedTranslateXValue,{toValue:-1*this._viewerBounds.width,duration:this._openCloseAnimationDuration,easing:a.Animated.Easing.Out()}));a.Animated.parallel(i).start((()=>{this.isComponentMounted()&&this.props.controller.onShowMedia&&this.props.controller.onShowMedia(this.props.media),s.resolve(void 0)}))}else this.props.backgroundOpacityValue.setValue(0),this.props.controller.onShowMedia&&this.props.controller.onShowMedia(this.props.media),s.resolve(void 0);return s.promise()}_handleCaching(e,t){super._handleCaching(e,t);const s=!!this.props.media;T.log(y.LogTraceArea.VideoViewer,"handleCaching, has media: "+s+" mediaId: "+(s?this.props.media.id:"none")+" cacheMode: "+this.props.cacheMode+" cacheId: "+this.props.cacheId+" causeId: "+t),this._isPrefetchingSupported()&&(e&&!this.state.isDownloadPaused?this._startPrefetching():this._cancelPrefetching(t))}presentMedia(e,t,s){this._viewerBounds=e;const i=G.default.newCauseId();T.log(y.LogTraceArea.MediaViewer,"Media presentMedia, causeId: "+i),this._handleCaching(t,i),this._viewerHasFocus!==t&&(this._viewerHasFocus=t,t?(this.props.onPauseAutoAdvance(),this.props.controller.onHideMedia&&this.props.controller.onHideMedia(this.props.media),this.props.controlsStore&&(this.props.controlsStore.setVideoPlayProgress({current:0,duration:0}),this.props.controlsStore.setVideoPlayState(q.VideoPlayState.NotLoaded)),this.isComponentMounted()&&this.setState({showVideoPlayer:!!this.props.media.videoUrl,videoLoadFailed:!this.props.media.videoUrl,isPlaying:this.state.isVideoLoaded}),this._videoPausedBeforeLoad=!1):(this.props.controller.onShowMedia&&this.props.controller.onShowMedia(this.props.media),this.props.controlsStore&&this.props.controlsStore.setVideoPlayState(q.VideoPlayState.Paused),this.isComponentMounted()&&this.setState({showVideoPlayer:!1,videoLoadFailed:!1,isVideoLoaded:!1,isPlaying:!1}),this._videoPausedBeforeLoad=!1));let o=this._viewerBounds;if(this.hasValidMediaSize()){const e=this.props.media.originalSize||this.props.media.thumbnailSize;e&&(o=m.default.fitToContainer(e,this._viewerBounds,!0))}this._currentScale=this._defaultScale;const n=(this._viewerBounds.width-o.width)/2,r=(this._viewerBounds.height-o.height)/2;this._currentTranslateX=n,this._currentTranslateY=r,this._containerAnimatedWidthValue.setValue(o.width),this._containerAnimatedHeightValue.setValue(o.height),this._containerAnimatedTranslateXValue.setValue(this._getContext().isRTL?-n:n),this._containerAnimatedTranslateYValue.setValue(r),this._containerAnimatedScaleValue.setValue(this._defaultScale),this._containerAnimatedOpacityValue.setValue(1),this.props.backgroundOpacityValue.setValue(1),s&&t&&this._onCompleteOpen()}getCloseButtonAccLabel(){return w.getString("MediaViewer.CloseButtonAccLabelVideo")}_isPrefetchingSupported(){return!(!this.props.media||!this.props.media.videoUrl||W.default.isFileOrBlob(this.props.media.videoUrl)||this.props.media.videoProvider===f.MediaProvider.AzureMS||this.props.cacheMode!==A.CacheMode.FileCacheWithPrefetching)}_isPrefetching(){return!this.state.isVideoLoaded&&this._isPrefetchingSupported()}_startPrefetching(){if(this.props.cacheId){T.log(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").handleCaching prefetching media for "+this.props.media.id),this._cachingTimerStarted||(this._cachingTimerStarted=!0,this._cachingStartTime=Date.now(),this._cachingSuccess=!1,T.log(y.LogTraceArea.VideoViewer,`VideoViewer(${this._id}).handleCaching cachingStartTime: ${this._cachingStartTime} cacheId: ${this.props.cacheId} videoUrl: ${R.dev_unknownOmit(this.props.media.videoUrl)}`));const e=1e3*c.default.getS4LCMCFeaturesNoSubscription().videoPrefetchCacheExpiryTimeSec;this.prefetchMediaToCacheIfSupported(this.props.cacheId,this.props.media.videoUrl,this.props.media.downloadFileName,e).then((e=>{e&&this._cachingTimerStarted&&(this._cachingDuration=Date.now()-this._cachingStartTime,this._cachingSuccess=!0,T.log(y.LogTraceArea.VideoViewer,`VideoViewer(${this._id}).handleCaching cachingDuration: ${this._cachingDuration} cacheId: ${this.props.cacheId} videoUrl: ${R.dev_unknownOmit(this.props.media.videoUrl)} value: ${e}`))}))}}_cancelPrefetching(e){this.props.cacheId&&(T.log(y.LogTraceArea.VideoViewer,"VideoViewer("+this._id+").handleCaching cancelling prefetching for "+this.props.media.id+" causeId: "+e),this.cancelPrefetchIfPending(this.props.cacheId,e))}}J.MediaType=A.MediaViewerTypes.Video,t.VideoViewer=J},516718:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VideoViewerControls=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(217041),a=s(662602),l=s(816402),d=s(746096),c=s(110117),h=s(436237),u=s(915877),p=s(733754),g=s(404057),m=s(581760),S=s(311010),f=s(711828),y=s(680837),v=s(54288),C=16,_=(0,u.lazyProperties)({container:()=>y.default.absoluteFill,progressBar:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,backgroundColor:m.Color.white}),buttonContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",justifyContent:"center",alignItems:"center",opacity:.75}),playButtonContainer:()=>n.Styles.createViewStyle({backgroundColor:m.Color.blackOverlay10,borderColor:m.Color.white,borderWidth:2,height:60,width:60,borderRadius:60,alignItems:"center",justifyContent:"center"}),progressBarWithScrubberContainer:()=>n.Styles.createViewStyle({flex:-1,flexDirection:"row",height:48,margin:4,position:"absolute",bottom:40,left:0,right:0,alignItems:"center",justifyContent:"flex-end",paddingLeft:5,paddingRight:5}),progressBarWithScrubberContainerCompact:()=>n.Styles.createViewStyle({height:34,bottom:0}),gestureView:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",flexDirection:"row",alignItems:"center",backgroundColor:m.Color.transparent,paddingLeft:5,paddingRight:5}),propgressBarWithScrubber:()=>n.Styles.createViewStyle({flex:1,alignSelf:"center",height:2,borderRadius:4,backgroundColor:m.Color.whiteOverlay50}),progressBarWithScrubberDesktop:()=>n.Styles.createViewStyle({height:4}),scrubberThumb:()=>n.Styles.createViewStyle({position:"absolute",bottom:0,backgroundColor:m.Color.white}),scrubberThumbRegular:()=>n.Styles.createViewStyle({top:16,width:C,height:C,borderRadius:8}),scrubberThumbEnlarged:()=>n.Styles.createViewStyle({top:8,width:32,height:32,borderRadius:16}),scrubberCompactThumbRegular:()=>n.Styles.createViewStyle({top:9}),scrubberCompactThumbEnlarged:()=>n.Styles.createViewStyle({top:1}),timeText:()=>n.Styles.createTextStyle({color:m.Color.white,flex:-1,textAlign:"center",fontSize:S.default.fontSize.size13Deprecated}),timeTextDesktop:()=>n.Styles.createTextStyle({fontSize:S.default.controlFontSize.bodySmallDeprecated}),hoverBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:m.Color.blackOverlay20})});class b extends r.ComponentBase{constructor(){super(...arguments),this._currentScrubberThumbDiameter=C,this._progressBarAnimatedWidth=new n.Animated.Value(0),this._progressBarAnimatedWidthStyle=n.Styles.createAnimatedViewStyle({width:this._progressBarAnimatedWidth}),this._scrubberThumbLeftValue=new n.Animated.Value(0),this._scrubberThumbLeftStyle=n.Styles.createAnimatedViewStyle({left:this._scrubberThumbLeftValue}),this._videoControlsAnimatedOpacityValue=new n.Animated.Value(0),this._videoControlsOpacityAnimatedStyle=n.Styles.createAnimatedViewStyle({opacity:this._videoControlsAnimatedOpacityValue}),this._overrideShowControlsValue=!1,this._onProgressBarHoverStart=()=>{this._overrideShowControls(!0)},this._onProgressBarHoverEnd=()=>{this._overrideShowControls(!1)},this._onScrubberRef=e=>{this._scrubberRef=e||void 0},this._onPan=e=>{this._onScrub(e,!e.isComplete)},this._onScrub=(e,t=!1)=>{this._scrubberRef&&a.default.measureLayoutRelativeToWindow((()=>this._scrubberRef)).then((s=>{if(this.isComponentMounted()){const i=(this._progressBarWidth||0)-this._currentScrubberThumbDiameter,o=e.pageX-s.x-this._currentScrubberThumbDiameter/2;let n=i>0?o/i:0;n=Math.max(n,0),n=Math.min(n,1),this.props.controlsStore.seekTo(n,t)}}),(e=>{h.warn(d.LogTraceArea.VideoViewer,"Scrubber component not measured: "+g.default.errorAsString(e))}))},this._overrideShowControls=e=>{this._overrideShowControlsValue=e,this.isComponentMounted()&&(this._overrideShowControlsValue?this.setState({showScrubberControls:!0,showScrubberThumb:!0}):this.setState({showScrubberThumb:!1}))},this._onLayout=e=>{this._progressBarWidth=e.width,this._recalcProgressBarWidth()},this._onPausePlay=e=>{this.props.onPlayOrPause(),e.stopPropagation()}}_buildState(e,t){const s={playState:e.controlsStore.getVideoPlayState(),playPauseButtonShown:e.controlsStore.isPlayPauseButtonShown(),showScrubberControls:e.controlsStore.isScrubberShown()},i=this.props;return(t||e.controlsStore!==i.controlsStore)&&(s.playbackProgress=e.controlsStore.getVideoPlayProgress(),e.controlsStore.subscribeForViewerControlsChanges((()=>this._onViewerControlsChanged())),this._videoControlsAnimatedOpacityValue.setValue(e.controlsStore.isScrubberShown()?1:0)),s}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._recalcProgressBarWidth(),t.showScrubberControls!==this.state.showScrubberControls&&this._animateShowOrHideControls()}render(){const e=this.state.playbackProgress.duration>0,t=e&&this.state.playState===v.VideoPlayState.Paused,s=[_.container];let r,a,d;if(e){s.push(_.hoverBackgroundStyle),t||s.push(this._videoControlsOpacityAnimatedStyle);const e=t?f.SkypeIcon.Play:this.state.showScrubberControls?f.SkypeIcon.Pause:void 0,o=e?(0,i.jsx)(c.default,{icon:e,size:f.IconSize.size24,color:m.Color.white}):void 0;r=(t||this.state.playState===v.VideoPlayState.Playing&&this.state.showScrubberControls)&&this.state.playPauseButtonShown?(0,i.jsx)(n.View,Object.assign({style:_.playButtonContainer,onPress:void 0,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityLabel:p.getString("MediaViewer.PlayVideo")},{children:o})):void 0}a=(0,i.jsx)(n.Button,Object.assign({style:_.buttonContainer,onPress:this._onPausePlay},{children:r}));const h=[_.progressBar,this._progressBarAnimatedWidthStyle],u=(0,i.jsx)(n.Animated.View,{style:h});if(o.isFinite(this.state.playbackProgress.duration)&&this.state.playbackProgress.duration){const e=l.default.getElapsedTimeStringFromS(this.state.playbackProgress.current),s=l.default.getElapsedTimeStringFromS(this.state.playbackProgress.duration),o=[_.timeText];o.push(_.timeTextDesktop);const r=[_.progressBarWithScrubberContainer];this.props.useCompactLayout&&r.push(_.progressBarWithScrubberContainerCompact),t&&r.push(this._videoControlsOpacityAnimatedStyle),this.props.progressBarStyle&&r.push(this.props.progressBarStyle);const a=[_.propgressBarWithScrubber];a.push(_.progressBarWithScrubberDesktop),d=(0,i.jsxs)(n.Animated.View,Object.assign({style:r,onMouseEnter:this._onProgressBarHoverStart,onMouseLeave:this._onProgressBarHoverEnd},{children:[(0,i.jsx)(n.Text,Object.assign({style:o},{children:e})),(0,i.jsxs)(n.GestureView,Object.assign({ref:this._onScrubberRef,style:_.gestureView,onTap:this._onScrub,onPan:this._onPan,preferredPan:n.Types.PreferredPanGesture.Horizontal,mouseOverCursor:n.Types.GestureMouseCursor.Pointer},{children:[(0,i.jsx)(n.View,Object.assign({style:a,onLayout:this._onLayout},{children:u})),this.state.showScrubberThumb&&this._renderScrubberThumb()]})),(0,i.jsx)(n.Text,Object.assign({style:o},{children:s}))]}))}return(0,i.jsxs)(n.Animated.View,Object.assign({style:s},{children:[a,d]}))}_renderScrubberThumb(){const e=[_.scrubberThumb,this._scrubberThumbLeftStyle,_.scrubberThumbRegular];return this.props.useCompactLayout&&e.push(_.scrubberCompactThumbRegular),(0,i.jsx)(n.Animated.View,{style:e})}_animateShowOrHideControls(){const e=this.state.showScrubberControls?1:0;n.Animated.timing(this._videoControlsAnimatedOpacityValue,{toValue:e,duration:200,easing:n.Animated.Easing.InOut()}).start()}_onViewerControlsChanged(){if(!this.isComponentMounted())return;const e=this.props.controlsStore,t=e.getVideoPlayState();let s=this.state.playState;t===s||t===v.VideoPlayState.Paused&&s===v.VideoPlayState.NotLoaded||(s=t);const i={playState:s,playPauseButtonShown:e.isPlayPauseButtonShown(),playbackProgress:e.getVideoPlayProgress(),showScrubberControls:e.isScrubberShown()||this._overrideShowControlsValue};this.setState(i)}_recalcProgressBarWidth(){const{playbackProgress:e,showScrubberThumb:t}=this.state,s=e.duration?(this._progressBarWidth||0)*e.current/e.duration:0;this._progressBarAnimatedWidth.setValue(s),t&&this._scrubberThumbLeftValue.setValue(s>this._currentScrubberThumbDiameter?s-this._currentScrubberThumbDiameter/2:this._currentScrubberThumbDiameter/4)}}t.VideoViewerControls=b},54288:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VideoViewerControlsStore=t.VideoPlayState=void 0;const i=s(861253);var o;!function(e){e[e.NotLoaded=0]="NotLoaded",e[e.Paused=1]="Paused",e[e.Playing=2]="Playing"}(o=t.VideoPlayState||(t.VideoPlayState={}));class n{constructor(e=!0){this._playState=o.NotLoaded,this._playPauseButtonShown=!1,this._scrubberShown=!1,this._playProgress={current:0,duration:0},this._isMutedLocal=!1,this._useGlobalMute=!0,this._useGlobalMute=e,this._playState=o.NotLoaded}subscribeForViewerControlsChanges(e){this._onViewerControlsChanged=e}getVideoPlayState(){return this._playState}getVideoPlayProgress(){return this._playProgress}isMuted(){return this._useGlobalMute?n._isMutedGlobal:this._isMutedLocal}isPlayPauseButtonShown(){return this._playPauseButtonShown}isScrubberShown(){return this._scrubberShown}play(){this._videoViewerCallbacks&&this._videoViewerCallbacks.onPlay()}pause(){this._videoViewerCallbacks&&this._videoViewerCallbacks.onPause()}seekTo(e,t){this._videoViewerCallbacks&&this._videoViewerCallbacks.onSeekTo(e,t)}mute(e){this._setMute(e),this._videoViewerCallbacks&&this._videoViewerCallbacks.onMute&&this._videoViewerCallbacks.onMute(e),this._onViewerControlsChanged&&this._onViewerControlsChanged()}registerViewerCallbacks(e){this._videoViewerCallbacks=e}setPlayPauseButtonState(e){(0,i.default)(this._playPauseButtonShown,e)||(this._playPauseButtonShown=e,this._onViewerControlsChanged&&this._onViewerControlsChanged())}setScrubberControlsVisibility(e){(0,i.default)(this._scrubberShown,e)||(this._scrubberShown=e,this._onViewerControlsChanged&&this._onViewerControlsChanged())}setVideoPlayState(e){this._playState!==e&&(this._playState=e,this._onViewerControlsChanged&&this._onViewerControlsChanged())}setVideoPlayProgress(e){this._playProgress=e,this._onViewerControlsChanged&&this._onViewerControlsChanged()}_setMute(e){this._useGlobalMute?n._isMutedGlobal=e:this._isMutedLocal=e}}n._isMutedGlobal=!1,t.VideoViewerControlsStore=n},23095:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AltMsgView=void 0;const i=s(785893),o=s(516778),n=s(210827),r=s(77388),a=s(680837);class l extends o.Component{constructor(e){super(e),this._dynamicList=null,this._observableListSubscription=null,this._onDynamicListRef=e=>{this._dynamicList=e,this._observableListSubscription&&this._observableListSubscription.unsubscribe(),this._dynamicList&&(this._dynamicList.onDataChanged(0,Number.MAX_VALUE,0,this.props.observableList.getItemList()),this._observableListSubscription=this.props.observableList.listChanged.subscribe(this._onDataChanged))},this._onDataChanged=e=>{if(this._dynamicList){let t=0,s=0;e.type!==r.ListModificationType.RemoveItems&&e.type!==r.ListModificationType.ReplaceItems&&e.type!==r.ListModificationType.MoveItems||void 0!==e.removeIndex&&e.count&&(t=e.removeIndex,s=e.count);let i=0,o=[];e.type!==r.ListModificationType.AddItems&&e.type!==r.ListModificationType.ReplaceItems&&e.type!==r.ListModificationType.MoveItems||void 0!==e.insertIndex&&e.items&&(i=e.insertIndex,o=e.items),this._dynamicList.onDataChanged(t,s,i,o)}},this._onLayout=e=>{this.props.onLayout&&this.props.onLayout(e),this.setState({isListVisible:!0})},this._onListViewportChange=e=>{if(this.props.onVisibleRangeChanged&&e.itemsInViewport){const t=e.itemsInViewport.first,s=e.itemsInViewport.last,i=e.itemsFullyInViewport?e.itemsFullyInViewport.first:t,o=e.itemsFullyInViewport?e.itemsFullyInViewport.last:i;this.props.onVisibleRangeChanged(t,s,i,o)}},this.state={isListVisible:!1}}render(){return(0,i.jsx)(o.View,Object.assign({style:a.default.flexOne,onLayout:this._onLayout},{children:this.state.isListVisible&&(0,i.jsx)(n.default,{ref:this._onDynamicListRef,renderItem:this.props.renderItem,onViewportChange:this._onListViewportChange,initialScrollIndex:this.props.initialScrollIndex})}))}scrollToBottom(){this._dynamicList&&this._dynamicList.scrollToEnd()}scrollToPosition(e,t,s=!1){this._dynamicList&&this._dynamicList.scrollToPosition(e)}focusMessage(e){}}t.AltMsgView=l},223284:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(244770),r=s(251577),a=s(265976),l=s(351077),d=s(898278),c=s(429791),h=s(23293),u=s(986374),p=s(273145),g=s(952262),m=s(746096),S=s(139889),f=s(839821),y=s(110117),v=s(436237),C=s(915877),_=s(733754),b=s(312762),T=s(89808),M=s(18078),I=s(914976),w=s(681115),P=s(546529),k=s(915415),A=s(581760),x=s(311010),R=s(711828),O=s(680837),L=s(24576),F=s(675865),B=(0,C.lazyProperties)({pictureContainer:()=>o.Styles.createViewStyle({flex:1,alignItems:"stretch",backgroundColor:A.Color.gray300}),videoInfoContainer:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:A.Color.transparent}),creatorInfoContainer:()=>o.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:10,flexDirection:"row",backgroundColor:A.Color.transparent,alignItems:"center"}),creatorTextStyle:()=>o.Styles.createTextStyle({color:A.Color.white,marginRight:10}),alternateViewContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center"}),overlayTextCenter:()=>o.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),loadingContainer:()=>o.Styles.createViewStyle({justifyContent:"center",alignItems:"center",position:"absolute",left:0,right:0,top:0,bottom:0}),overlay:()=>o.Styles.createViewStyle({justifyContent:"center",alignItems:"center",position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:A.Color.blackOverlay20}),actionButtonBorderStyle:()=>o.Styles.createViewStyle({backgroundColor:A.Color.blackOverlay10,borderStyle:"solid",borderWidth:1,borderColor:A.Color.white,alignItems:"center",justifyContent:"center"})});class D extends L.default{constructor(){super(...arguments),this._opacityValue=new o.Animated.Value(1),this._opacityStyle=o.Styles.createAnimatedViewStyle({opacity:this._opacityValue}),this._buttonOpacityValue=new o.Animated.Value(1),this._buttonOpacityStyle=o.Styles.createAnimatedViewStyle({opacity:this._buttonOpacityValue}),this._getReactionMenuAnchor=()=>this._contentRef,this._onContentRef=e=>{this._contentRef=e||void 0},this._onButtonRef=e=>{this._buttonRef=e||void 0},this._getContextMenuItems=()=>this.props.messageActions?this._commandManager.getSXMenuItems(this._getCommandManagerOptions(),this.props.messageActions.actionMenuCommands):[],this._onPress=e=>{e.stopPropagation(),this.props.onThumbnailPress&&this.props.onThumbnailPress(this.props.message)},this._onPressIn=e=>{e.stopPropagation(),this._buttonOpacityValue.setValue(.8)},this._onPressOut=e=>{e.stopPropagation(),this._buttonOpacityValue.setValue(1)},this._showContextMenuOnMobile=e=>{e.stopPropagation(),this._commandManager&&this.props.messageActions&&this._commandManager.showActionMenu(this._getCommandManagerOptions(),(()=>this.isComponentMounted()?this:void 0),this._getRootViewId(),"messageActionMenu",this.props.messageActions.actionMenuTitle,this.props.messageActions.actionMenuCommands,e)},this._onStreamItemCommandSelected=(e,t)=>{this._intOnCommandSelected(e,t.rootViewId)},this._onCommandSelected=e=>{this._intOnCommandSelected(e,this._getRootViewId())},this._onThumbnailLoaded=()=>{this.isComponentMounted()&&this.setState({thumbnailLoaded:!0})},this._onThumbnailError=e=>{this.state.isNetworkUrl?(v.error(m.LogTraceArea.GenericUnsafe,"MediaThumbnail failed to load image from network: "+this.state.thumbnailUrl),!this.state.networkThumbnailHasFailed&&this._canUseFullMediaUrl(this.props.message)&&this.isComponentMounted()&&this.setState({thumbnailUrl:this._getFullMediaNetworkUrl(this.props.message),networkThumbnailHasFailed:!0})):(v.error(m.LogTraceArea.GenericUnsafe,"MediaThumbnail failed to load image from file cache: "+this.state.thumbnailUrl),this.isComponentMounted()&&this.setState({thumbnailUrl:this._getThumbnailNetworkUrl(this.props.message),isNetworkUrl:!0,fileCacheThumbnailHasFailed:!0}))}}_buildState(e,t){const s=this.props;(t||s.message!==e.message)&&(this._decodedNode=u.decode(e.message)),this._commandManager||(this._commandManager=new P.StreamItemCommandManager(this._onStreamItemCommandSelected));const i={messageGroup:l.getMessageTypeGroup(e.message),displayInfo:e.showCreator&&e.message.creator?g.default.getDisplayableProfile(e.message.creator):void 0};return t||s.message.cuid!==e.message.cuid?(i.isNetworkUrl=void 0,i.networkThumbnailHasFailed=void 0,i.thumbnailLoaded=void 0,i.thumbnailUrl=void 0,i.fileCacheThumbnailHasFailed=void 0):(i.isNetworkUrl=this.state.isNetworkUrl,i.networkThumbnailHasFailed=this.state.networkThumbnailHasFailed,i.thumbnailLoaded=this.state.thumbnailLoaded,i.thumbnailUrl=this.state.thumbnailUrl,i.fileCacheThumbnailHasFailed=this.state.fileCacheThumbnailHasFailed),i.thumbnailLoaded||(e.useFileCache&&!i.fileCacheThumbnailHasFailed&&(i.thumbnailUrl=f.default.getLocalUri(a.getFileCacheKeyMediaThumb(e.message)),i.thumbnailUrl&&v.log(m.LogTraceArea.MediaThumbnail,"Thumbnail image is from file cache "+I.dev_unknownOmit(i.thumbnailUrl)),!i.thumbnailUrl&&this._canUseFullMediaUrl(e.message)&&(0,r.isDisplayableOrFullResImageCached)(e.message)&&(i.thumbnailUrl=(0,r.getLocalDisplayableOrFullResUri)(e.message),i.thumbnailUrl&&v.log(m.LogTraceArea.MediaThumbnail,"Full image is from file cache "+I.dev_unknownOmit(i.thumbnailUrl)))),i.thumbnailUrl||(i.networkThumbnailHasFailed?(i.thumbnailUrl=this._getFullMediaNetworkUrl(e.message),v.log(m.LogTraceArea.MediaThumbnail,"Full image is from network "+I.dev_unknownOmit(i.thumbnailUrl))):(i.thumbnailUrl=this._getThumbnailNetworkUrl(e.message),v.log(m.LogTraceArea.MediaThumbnail,"Thumbnail image is from network "+I.dev_unknownOmit(i.thumbnailUrl))))),i.messageAccessibilityLabel=e.shouldUseMessageAccessibilityLabel?c.toAccessibilityLabel(u.decode(e.message),{message:e.message}):void 0,i}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._borderRadiusStyle=this._getBorderRadiusStyle(this.props.borderRadius),this._backgroundColorStyle=this._getBackgroundColorStyle()}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.props.borderRadius!==e.borderRadius&&(this._borderRadiusStyle=this._getBorderRadiusStyle(this.props.borderRadius)),this.props.message.creator!==e.message.creator&&(this._backgroundColorStyle=this._getBackgroundColorStyle())}requestFocus(){this._buttonRef?this._buttonRef.requestFocus():this._contentRef&&this._contentRef.requestFocus()}render(){const e=o.Styles.createViewStyle({height:this.props.height,width:this.props.width},!1),t=this._getThumbnailErrorView(),s=this._getThumbnailAlternateView(),n=[e,this._getImageViewBackgroundStyle()],r=[e];this._borderRadiusStyle&&(n.push(this._borderRadiusStyle),r.push(this._borderRadiusStyle));const a=(0,i.jsx)(o.Animated.View,Object.assign({style:this._buttonOpacityStyle},{children:(0,i.jsx)(S.default,{origin:"mediaThumbnail",style:r,containerStyle:n,source:this.state.thumbnailUrl,altView:s,errorView:t,resizeMode:"cover",shouldInstrument:!0,onLoad:this._onThumbnailLoaded,onError:this._onThumbnailError,noRetryOnError:!this.state.isNetworkUrl})})),l=this._getCreatorView(),c=this._getVideoMediaTypeIconView(),h=this._getUnreadBadgeView(),u=this.props.showOverlay&&this.state.thumbnailLoaded?(0,i.jsx)(o.View,{style:B.overlay}):void 0,g=this.props.onThumbnailPress||this.props.messageActions;let m;const f=[this.state.messageAccessibilityLabel,this.props.accessibilityLabel].join(", ");let y;m=g?(0,i.jsxs)(o.Button,Object.assign({ref:this._onButtonRef,style:e,onPress:this._onPress,onPressIn:this._onPressIn,onPressOut:this._onPressOut,onLongPress:this.props.messageActions?this._showContextMenuOnMobile:void 0,disableTouchOpacityAnimation:!0,accessibilityLabel:f,tabIndex:this.props.tabIndex},{children:[a,u,l,h,c]})):(0,i.jsxs)(o.View,Object.assign({style:e,accessibilityLabel:f},{children:[a,u,l,h,c]})),this.props.showLoading&&(y=(0,i.jsx)(o.View,Object.assign({style:B.loadingContainer},{children:(0,i.jsx)(k.default,{size:d.SXActivityIndicatorSize.Medium})})));let v=(0,i.jsxs)(o.Animated.View,Object.assign({ref:this._onContentRef,style:[e,this._opacityStyle,this.props.style],shouldRasterizeIOS:!0},{children:[m,y]}));return this.props.messageActions&&(v=(0,i.jsx)(p.default,Object.assign({wrapperStyle:O.default.flexZero,getMenuItems:this._getContextMenuItems,onItemSelected:this._onCommandSelected},{children:v}))),v}_getCommandManagerOptions(){return{message:this.props.message,decodedNode:this._decodedNode,renderOrigin:this.props.renderOrigin,getReactionMenuPopupAnchor:this._getReactionMenuAnchor,componentContext:this._getContext(),getRootWindowComponent:this._getReactionMenuAnchor}}_getImageViewBackgroundStyle(){return B.pictureContainer}_getThumbnailAlternateView(){let e;const t=this.props.thumbnailIconsSize?this.props.thumbnailIconsSize:R.IconSize.size60,s=this.props.useLoadingImage?(0,i.jsx)(o.Image,{style:O.default.absoluteFill,resizeMode:"contain",source:n.Collection.WIGGLE_PATTERN_350}):void 0,r=this._useAccessibleTheme()?this._themeColors.primaryIconColor:A.Color.gray200;if(this.props.useLoadingImage){const t=[B.alternateViewContainer,this._backgroundColorStyle];this._borderRadiusStyle&&t.push(this._borderRadiusStyle),e=(0,i.jsx)(o.View,Object.assign({style:t},{children:s}))}else e=(0,i.jsxs)(o.View,Object.assign({style:B.alternateViewContainer},{children:[s,(0,i.jsx)(y.default,{icon:R.SkypeIcon.Picture,size:t,color:r})]}));return e}_getThumbnailErrorView(){const e=this.props.thumbnailIconsSize?this.props.thumbnailIconsSize:R.IconSize.size60,t=this.props.useLoadingImage?(0,i.jsx)(o.Image,{style:O.default.absoluteFill,resizeMode:"contain",source:n.Collection.WIGGLE_PATTERN_350}):void 0,s=this._useAccessibleTheme()?this._themeColors.primaryIconColor:A.Color.gray200;return(0,i.jsxs)(o.View,Object.assign({style:B.alternateViewContainer},{children:[t,(0,i.jsx)(y.default,{icon:R.SkypeIcon.Warning,size:e,color:s})]}))}_getCreatorView(){if(this.props.showCreator){const e=[x.default.fontStyle.subtitle],t=_.getString("ConversationsListItem.UnknownConversationName"),s=this.state.displayInfo?this.state.displayInfo.getDisplayName(t):t,n=[B.creatorInfoContainer];return e.push(B.creatorTextStyle),this.props.horizontalInsets&&(this.props.horizontalInsets.left||this.props.horizontalInsets.right)&&n.push(w.default.horizontalPaddingStyle(this.props.horizontalInsets)),(0,i.jsx)(o.View,Object.assign({style:n},{children:(0,i.jsx)(o.Text,Object.assign({style:e,numberOfLines:1},{children:s}))}))}}_getVideoMediaTypeIconView(){if(this.props.showVideoMediaTypeIcon&&this.state.thumbnailLoaded&&this.state.messageGroup===l.MessageTypeGroups.Video){const e=this.props.thumbnailIconsSize?this.props.thumbnailIconsSize:R.IconSize.size60,t=[B.videoInfoContainer,B.overlayTextCenter,o.Styles.createTextStyle({paddingLeft:Math.floor(e/15)},!1)],s=[B.actionButtonBorderStyle,o.Styles.createViewStyle({width:e,height:e,borderRadius:e/2})];return(0,i.jsx)(o.View,Object.assign({style:t},{children:(0,i.jsx)(o.View,Object.assign({style:s},{children:(0,i.jsx)(y.default,{icon:R.SkypeIcon.Play,size:e/2,color:A.Color.white})}))}))}}_getUnreadBadgeView(){}_intOnCommandSelected(e,t){this._commandManager.dismissSXPopup("media-thumbnail-sx-popup",t),this._commandManager.onActionMenuOptionSelected(this._getCommandManagerOptions(),e)}_getBorderRadiusStyle(e){if(e&&e>0)return o.Styles.createViewStyle({borderRadius:e},!1)}_getBackgroundColorStyle(){let e;return e=M.default.isMyMri(this.props.message.creator)?T.default.getPrimaryColor():h.default.getPrimaryColor(this.props.message.creator),o.Styles.createViewStyle({backgroundColor:e},!1)}_getThumbnailNetworkUrl(e){return F.default.getAuthenticatedUrl(this._getThumbnailUrlForMediaMessage(e))}_getFullMediaNetworkUrl(e){return F.default.getAuthenticatedUrl(this._getFullUrlForMediaMessage(e))}_canUseFullMediaUrl(e){return l.getMessageTypeGroup(e)===l.MessageTypeGroups.Picture}_getThumbnailUrlForMediaMessage(e){const t=this._getMediaNode(e);return t&&t.getDisplayThumbnailUrlSanitized()}_getFullUrlForMediaMessage(e){const t=this._getMediaNode(e);return t&&t.getDisplayUrlSanitized()}_getMediaNode(e){return u.decode(e).getFirstUriObjectChild(b.DisplayableMediaWithThumbnail)}showNode(){this.isComponentMounted()&&this._opacityValue.setValue(1)}hideNode(){this.isComponentMounted()&&this._opacityValue.setValue(0)}getOriginalDimensions(){if(this.props.height&&this.props.width)return{height:this.props.height,width:this.props.width}}}t.default=D},815188:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(217041),a=(s(889391),s(110117)),l=s(915877),d=s(89808),c=s(113034),h=s(411397),u=s(581760),p=s(711828),g=s(626612),m=(0,l.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,justifyContent:"center",alignItems:"center",overflow:"visible"}),progressIndicator:()=>n.Styles.createImageStyle({backgroundColor:u.Color.transparent,overflow:"visible"})});class S extends r.ComponentBase{constructor(){super(...arguments),this._transferProgresses={}}_buildState(e,t){(t||o.isEmpty(this._transferProgresses))&&o.each(e.contentUrls,(e=>this._transferProgresses[e]={progress:0,success:!1,finished:!1})),o.each(e.contentUrls,(e=>{const t=e?g.default.getTransferProgressForUrl(e):void 0,s=this._transferProgresses[e];t&&s&&(t.progress>s.progress&&(s.progress=t.progress),t.success&&!s.success&&(s.success=!0),t.finished&&!s.finished&&(s.finished=!0))}));return{progress:o.sumBy(o.values(this._transferProgresses),(e=>e.progress))/o.values(this._transferProgresses).length,finished:o.every(this._transferProgresses,(e=>e.finished)),strokeColor:d.default.getPrimaryColor()||u.Color.blue,jsonAnimationEnabled:!1}}render(){var e;if(!this.props.showFiniteProgressIndicatorUI&&(this.state.finished||this.state.progress<=0))return null;if(this.state.jsonAnimationEnabled&&!this.props.showFiniteProgressIndicatorUI){const e=n.Styles.createViewStyle({width:this.props.size,height:this.props.size},!1);return(0,i.jsx)(n.View,Object.assign({style:m.container},{children:(0,i.jsx)(n.View,Object.assign({style:e},{children:(0,i.jsx)(c.default,{progress:this.state.progress,sizeToFit:!0,tintColor:this.props.strokeColor})}))}))}const t=n.Styles.createImageStyle({width:this.props.size,height:this.props.size},!1);let s,o,r={strokeColor:this.props.strokeColor||u.Color.whiteOverlay90,fillColor:u.Color.transparent,fillOpacity:0,strokeOpacity:1,strokeWidth:null!==(e=this.props.strokeWidth)&&void 0!==e?e:4};return this.props.showFiniteProgressIndicatorUI&&(r={strokeWidth:2,strokeColor:this.state.strokeColor,fillColor:u.Color.transparent,fillOpacity:0},s={strokeWidth:2,strokeColor:u.Color.white,fillColor:this.props.showShadow?u.Color.gray400:u.Color.transparent,fillOpacity:this.props.showShadow?.2:0},this.props.isDownload&&this.props.isDownloadPaused&&(o=(0,i.jsx)(n.View,Object.assign({style:m.container},{children:(0,i.jsx)(a.default,{icon:p.SkypeIcon.Download,size:this.props.size/2.5,color:this.props.strokeColor})})))),(0,i.jsxs)(n.View,Object.assign({style:m.container},{children:[(0,i.jsx)(h.default,{style:[m.progressIndicator,t],progress:this.state.progress,size:this.props.size,backgroundCircleProperties:s,progressStrokeProperties:r,showCircleBackground:this.props.showFiniteProgressIndicatorUI}),o]}))}}t.default=S},378194:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(552115),a=s(915877),l=s(733754),d=s(581760),c=s(311010),h=s(619675),u=s(24576),p=s(626612),g=(0,a.lazyProperties)({uploadText:()=>n.Styles.createTextStyle({lineHeight:16}),downloadText:()=>n.Styles.createTextStyle({fontSize:c.default.controlFontSize.tabHeaderSmall,lineHeight:15,color:d.Color.white}),downloadContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"flex-end"}),textShadow:()=>n.Styles.createTextStyle({overflow:"visible",shadowColor:d.Color.blackOverlay50,shadowRadius:2,shadowOffset:{height:1,width:0}})});class m extends u.default{_buildState(e,t){const s=e.contentUrl?p.default.getTransferProgressForUrl(e.contentUrl):void 0;let i;const n=s&&s.totalSize||e.fileSizeInBytes,a=this.state;let d;n&&(t||a.totalSize&&a.totalSize.value!==n)&&(i=r.default.formatFileSize(n,0)),d=e.isDownload?e.isDownloadPaused?l.getString("MediaViewer.DownloadPaused"):l.getString("MediaViewer.Downloading"):l.getString("StreamItem.Sending");return{progress:s?o.ceil(100*s.progress):0,totalSize:i,progressLabel:d}}render(){const e=this.props.showShadow?g.textShadow:void 0;let t="";if(this.state.totalSize&&(t=this.state.totalSize.formattedString),t+=(t?" (":"(")+this.state.progress+"%)",this.props.isDownload){const s=t?(0,i.jsx)(n.Text,Object.assign({style:[e,g.downloadText]},{children:t})):void 0;return(0,i.jsxs)(n.View,Object.assign({style:g.downloadContainer},{children:[(0,i.jsx)(n.Text,Object.assign({style:[e,g.downloadText]},{children:this.state.progressLabel})),s]}))}return(0,i.jsx)(h.Caption,Object.assign({style:[e,g.uploadText,this._themeStyles.secondaryTextColorStyle]},{children:t?this.state.progressLabel+" "+t:this.state.progressLabel}))}}t.default=m},169015:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VirtualMessageView=void 0;const i=s(785893),o=s(496486),n=(s(401540),s(396265)),r=s(665768),a=s(516778),l=s(77388),d=s(746096),c=s(436237),h=s(861253),u=s(710400),p=s(547126),g=s(915877),m=s(833348),S=s(536150),f=s(867241),y=s(280490),v=s(450795),C=s(680837),_=y.SwiftSuggestionStyles.suggestionsBarHeight,b=!1,T=(0,g.lazyProperties)({scrollOuterContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch",overflow:"visible"}),scrollInnerContainer:()=>a.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0}),scrollView:()=>a.Styles.createScrollViewStyle({flex:1,alignSelf:"stretch",flexDirection:"column"}),staticContainer:()=>a.Styles.createViewStyle({flex:-1,opacity:1,flexDirection:"column"}),compositeItemsListContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row"})}),M={},I={};var w,P;!function(e){e[e.UnmeasuredAbove=0]="UnmeasuredAbove",e[e.UnmeasuredBelow=1]="UnmeasuredBelow",e[e.UnmeasuredInside=2]="UnmeasuredInside",e[e.UnmeasuredInsideNoAnimation=3]="UnmeasuredInsideNoAnimation",e[e.Measured=4]="Measured"}(w||(w={})),function(e){e[e.Undefined=0]="Undefined",e[e.WaitingForScroll=1]="WaitingForScroll"}(P||(P={}));class k{constructor(){this._average=0,this._count=0}input(e){const t=1/(this._count+1),s=t*this._count;this._average=e*t+this._average*s,this._count++}correct(e){this._average+=e/this._count}getAverage(){return Math.round(this._average)}}class A extends a.Component{constructor(e){super(e),this._lastScrollTop=0,this._lastScrollTopSetByUser=0,this._lastScrollLeft=0,this._viewportHeight=0,this._oldViewportHeight=0,this._viewportWidth=0,this._lastContainerLayoutTime=0,this._virtualListCells={},this._virtualListCellRefCallbacks={},this._scrollOuterContainerHeight=0,this._contentWidth=-1,this._isMounted=!1,this._containerHeight=0,this._containerHeightValue=new a.Animated.Value(this._containerHeight),this._containerAnimatedStyle=a.Styles.createAnimatedViewStyle({height:this._containerHeightValue}),this._isInitialInnerScrollContainerHeightMeasured=!1,this._innerScrollContainerHeight=0,this._innerScrollContainerHeightValue=new a.Animated.Value(this._innerScrollContainerHeight),this._scrollInnerContainerStyle=a.Styles.createAnimatedViewStyle({height:this._innerScrollContainerHeightValue}),this._itemList=[],this._itemMap={},this._isRenderDirty=!1,this._itemListChangedSinceLastVisibleRangeChange=!1,this._heightAboveRenderBlockEstimate=0,this._heightAboveRenderBlockCorrection=0,this._heightOfRenderBlock=0,this._heightBelowRenderBlockEstimate=0,this._heightBelowRenderBlockCorrection=0,this._itemsAboveRenderBlock=0,this._itemsInRenderBlock=0,this._itemsBelowRenderBlock=0,this._pendingMeasures={},this._pendingMounts={},this._pendingAnimations={},this._filledViewableScreen=!1,this._heightCache={},this._renderInfoCache={},this._lastPartialTopVisibleItem=-1,this._lastPartialBottomVisibleItem=-1,this._lastWholeTopVisibleItem=-1,this._lastWholeBottomVisibleItem=-1,this._onListChangedQueue=[],this._onLayoutItemQueue=[],this._onAnimateStartStopItemQueue=[],this._currentAverageHeight=0,this._averageHeightCounter=new k,this._isScreenReaderEnabled=!1,this._onLayoutOuterScrollContainer=e=>{if(c.log(d.LogTraceArea.VirtualMessageView,"onLayoutOuterScrollContainer: width "+e.width+" height "+e.height),!this._isMounted)return;const t=0!==u.default.getUpdateInfo().height;if(!this.props.allowKeyboardLayoutUpdates&&t&&this._isInitialInnerScrollContainerHeightMeasured)return void c.log(d.LogTraceArea.VirtualMessageViewDebug,"onLayoutOuterScrollContainer: ignoring event because keyboard is shown, height: "+Math.round(e.height));const s=Math.round(e.height);0!==s?(t||(this._isInitialInnerScrollContainerHeightMeasured=!0),this._scrollOuterContainerHeight=s,0===this._innerScrollContainerHeight?(this._innerScrollContainerHeight=s,this._innerScrollContainerHeightValue.setValue(s),this._currentState.onLayoutListContainer(e,!0)):this._currentState.onLayoutListContainer(e,!1)):c.log(d.LogTraceArea.VirtualMessageViewDebug,"onLayoutOuterScrollContainer: height is 0 - probably transient event during rotation")},this._onScroll=(e,t)=>{this._onScrollHandler(e,t)},this._onScrollHandlerDebounced=o.debounce(this._onScrollHandler,100),this._onReportUserScrollEvent=()=>{this._reportUserScrollEvent&&(this._reportUserScrollEvent=!1,this.props.onUserScroll&&this.props.onUserScroll(this._lastScrollTop,this._lastScrollLeft))},this._onAnimateStartStopItem=(e,t)=>{this._isMounted&&(t?this._pendingAnimations[e]=e:delete this._pendingAnimations[e])},this._onKeyPress=e=>{if(e.keyCode!==p.default.UP&&e.keyCode!==p.default.DOWN||!this._renderedItemKeys||!this._focusedItemKey)return;if(e.altKey||e.ctrlKey||e.shiftKey)return;const t=this._renderedItemKeys.filter((e=>e!==f.ItemListKey.Composing)),s=t.indexOf(this._focusedItemKey);let i,o,n,r;s>=0&&(i=this._virtualListCells[this._focusedItemKey]),s>=0&&(r=s+(e.keyCode===p.default.UP?-1:1),o=t[r]),o||(r=this._renderedItemKeys.length-1,o=t[r]),o&&(n=this._virtualListCells[o]),n&&i!==n&&(i&&i.setFocusLimited(!0),n.setFocusLimited(!1),this._focusedItemKey=o,n.focusCell(),e.preventDefault(),e.stopPropagation(),n.props.focusable||this._onKeyPress(e))},this._onCellFocus=e=>{this._isFocused=!!e},this._stateOnLayoutListContainer=e=>{this._currentState&&this._currentState.onLayoutListContainer(e,!0)},this._stateOnScroll=(e,t)=>{this._currentState&&this._currentState.onScroll(e,t)},this._onScrollBeginDrag=()=>{c.log(d.LogTraceArea.VirtualMessageViewDebug,"onScrollBeginDrag"),this._isDragging=!0},this._onScrollEndDrag=()=>{c.log(d.LogTraceArea.VirtualMessageViewDebug,"onScrollEndDrag"),this._isDragging=!1,this._currentState&&this._currentState.onScrollEndDrag()},this._stateOnLayoutItem=(e,t)=>{var s;null===(s=this._currentState)||void 0===s||s.onLayoutItem(e,t)},this._stateOnAnimateStartStopItem=(e,t)=>{this._currentState&&this._currentState.onAnimateStartStopItem(e,t)},this._stateControllerScrollPositionSet=()=>{this._currentState&&this._currentState.onControllerScrollPositionSet()},this._stateOnListChanged=(e,t)=>{this._currentState&&(this._itemListChangedSinceLastVisibleRangeChange=!0,this._currentState.onListChanged(e,t))},this._vmvControllerRefCallback=e=>{this._vmvController=e},this._scrollViewRefCallback=e=>{this._scrollView=e},e.observableList.listChanged.subscribe(this._stateOnListChanged),this._screenReaderDetectionStoreToken=S.default.subscribe((()=>{this._isScreenReaderEnabled=S.default.isMobileScreenReaderEnabled(),this._isScreenReaderEnabled})),this._isScreenReaderEnabled=S.default.isMobileScreenReaderEnabled(),this.setCurrentState(new A.Initialization(this),e)}setCurrentState(e,t){this._currentState=e,this._currentState.init(t||this.props)}UNSAFE_componentWillReceiveProps(e,t){(0,h.default)(this.props,e)||(this.props.contentMaxWidth,e.contentMaxWidth,this.props.observableList,e.observableList,this.props.leftSpacerWidth===e.leftSpacerWidth&&this.props.rightSpacerWidth===e.rightSpacerWidth&&this.props.useWideLayout===e.useWideLayout||this._resizeAllItems(e))}_getBottomSpacerHeight(){return this.props.canShowSuggestions?_:0}_initItemList(e,t){this._renderInfoCache={},this._pendingMeasures={},this._pendingMounts={},this._pendingAnimations={},this._itemListChangedSinceLastVisibleRangeChange=!0,c.log(d.LogTraceArea.VirtualMessageView,"_initItemList: New count: "+e.length);const s={};o.each(e,((e,t)=>{s[e.key]=t})),this._filledViewableScreen=!1;const i=this._calcHeightOfItems(e,0,e.length-1);this._itemsAboveRenderBlock=e.length,this._itemsInRenderBlock=0,this._itemsBelowRenderBlock=0,this._heightAboveRenderBlockCorrection=i,this._heightAboveRenderBlockEstimate=0,this._heightOfRenderBlock=0,this._heightBelowRenderBlockCorrection=0,this._heightBelowRenderBlockEstimate=0,this._itemMap=s,this._itemList=e,this._initialScrollIndex=t.initialScrollIndex}_isAndroidScreenReaderEnabled(){return this._isScreenReaderEnabled&&b}_itemsMoved(e,t){this._itemMap=this._regenerateItemMap(e);const s={type:l.ListModificationType.RemoveItems,removeIndex:t.removeIndex,count:t.count};this._processItemsRemoved(this._itemList,s);const i=o.map(this._itemList,(e=>e));i.splice(t.removeIndex,t.count),this._itemList=i;const n=[];for(let s=t.insertIndex;s<t.insertIndex+t.count;s++)n.push(e[s]);const r={type:l.ListModificationType.AddItems,insertIndex:t.insertIndex,items:n};this._processItemsAdded(this._itemList,e,r),this._itemList=e}_regenerateItemMap(e){const t={};return o.each(e,((e,s)=>{t[e.key]=s})),t}_itemsAdded(e,t){this._itemMap=this._regenerateItemMap(e),this._processItemsAdded(this._itemList,e,t),this._itemList=e}_processItemsAdded(e,t,s){const i=s.insertIndex,n=s.items,r=this._itemsAboveRenderBlock+this._itemsInRenderBlock,a=this._getMaxPendingMounts()-o.size(this._pendingMounts),l=s.options&&!1===s.options.animateFromBottom;if(i<=this._itemsAboveRenderBlock&&0!==this._itemsInRenderBlock)this._heightAboveRenderBlockCorrection+=this._calcHeightOfItems(t,i,i+n.length-1),this._itemsAboveRenderBlock+=n.length,c.log(d.LogTraceArea.VirtualMessageViewDebug,"_processItemsAdded adding "+n.length+" above render block");else if((i>r||i===r&&n.length>a&&l)&&0!==this._itemsInRenderBlock)this._itemsBelowRenderBlock+=n.length,this._heightBelowRenderBlockCorrection+=this._calcHeightOfItems(t,i,i+n.length-1),c.log(d.LogTraceArea.VirtualMessageViewDebug,"_processItemsAdded adding "+n.length+" below render block");else{const t=this._calcHeightOfItems(e,i,e.length-1),s=this._containerHeight-this._getBottomSpacerHeight()-t;o.each(n,(e=>{const t=this._getHeightOfItem(e),i=l?w.UnmeasuredInsideNoAnimation:w.UnmeasuredInside;this._allocateRenderBlockItem(e,i,t,s)}))}}_itemsReplaced(e,t){this._itemMap=this._regenerateItemMap(e),this._processItemsRemoved(this._itemList,t);const s=o.map(this._itemList,(e=>e));s.splice(t.removeIndex,t.count),this._itemList=s,this._processItemsAdded(this._itemList,e,t),this._itemList=e}_itemsRemoved(e,t){this._itemMap=this._regenerateItemMap(e),this._processItemsRemoved(this._itemList,t),this._itemList=e}_processItemsRemoved(e,t){const s=t.removeIndex,i=t.removeIndex+t.count-1,o=this._itemsAboveRenderBlock,n=this._itemsInRenderBlock;c.log(d.LogTraceArea.VirtualMessageViewDebug,"_processItemsRemoved _itemsAboveRenderBlock "+this._itemsAboveRenderBlock+" _itemsInRenderBlock "+this._itemsInRenderBlock+" _itemsBelowRenderBlock "+this._itemsBelowRenderBlock);for(let t=s;t<o&&t<=i;t++){const s=e[t];c.log(d.LogTraceArea.VirtualMessageViewDebug,"_processItemsRemoved removing item #"+t+" with key "+s.key+" above render block"),this._heightAboveRenderBlockCorrection-=this._getHeightOfItem(s),this._itemsAboveRenderBlock--,this._deleteItemFromCaches(s.key,!0)}const r=o+n-1,a=this._getViewportBottom();for(let t=Math.max(s,o);t<=r&&t<=i;t++){const s=e[t];c.log(d.LogTraceArea.VirtualMessageViewDebug,"_processItemsRemoved removing item #"+t+" with key "+s.key+" from render block"),this._itemsInRenderBlock--;const i=this._getHeightOfItem(s);this._heightOfRenderBlock-=i;const o=this._renderInfoCache[s.key];this._isRenderDirty=!0,this._makeCellInvisibleDeferred(s.key),this._deleteItemFromCaches(s.key,!0),o&&(o.top+i<=a+30?this._adjustScrollPositionAfterReconcile(-i):this._adjustScrollPositionUntilReconcile(-i))}for(let t=Math.max(s,r+1);t<=i;t++){const s=e[t];c.log(d.LogTraceArea.VirtualMessageViewDebug,"_processItemsRemoved removing item #"+t+" with key "+s.key+" below render block"),this._heightBelowRenderBlockCorrection-=this._getHeightOfItem(s),this._itemsBelowRenderBlock--,this._deleteItemFromCaches(s.key,!0)}}_deleteItemFromCaches(e,t=!1){t&&delete this._heightCache[e],delete this._renderInfoCache[e],delete this._pendingMeasures[e],delete this._pendingMounts[e]}_updateViewportWidth(e){e!==this._viewportWidth&&(c.log(d.LogTraceArea.VirtualMessageView,"New viewport width: "+e),this._viewportWidth=e,this._resizeAllItems(this.props))}_updateViewportHeight(e){e!==this._viewportHeight&&(c.log(d.LogTraceArea.VirtualMessageView,"New viewport height: "+e),this._viewportHeight=e)}_onLayoutListContainer(e){let t=Math.round(e.width);const s=Math.round(e.height);this._isMounted&&0!==t&&0!==s&&(this.props.horizontalPadding&&(t-=this.props.horizontalPadding.left+this.props.horizontalPadding.right),this._lastContainerLayoutTime=Date.now().valueOf(),this._updateViewportWidth(t),this._updateViewportHeight(s),this._renderIfDirty(),this.props.onLayout&&this.props.onLayout(e))}_onLayoutItem(e,t){if(!this._isMounted)return!1;const s=this._itemMap[e];if(void 0===s||void 0===this._renderInfoCache[e])return c.log(d.LogTraceArea.VirtualMessageViewDebug,"onLayout: unexpected event for item "+e),!1;delete this._pendingMeasures[e],delete this._pendingMounts[e],t=Math.round(t);const i=this._itemList[s],o=this._getHeightOfItem(i),n=t-o;if(this._isHeightOfItemKnown(i)&&Math.abs(n)<=1)return!1;i.height||(this._isHeightOfItemKnown(i)?this._averageHeightCounter.correct(n):this._averageHeightCounter.input(t)),this._heightCache[e]=t;const r=this._renderInfoCache[e];return 0===n&&r.measureState===w.Measured||(c.log(d.LogTraceArea.VirtualMessageViewDebug,"onLayout: Item Height Changed: "+e+" - Old: "+o+", New: "+t+", measureState: "+w[r.measureState]),s<this._itemsAboveRenderBlock?this._heightAboveRenderBlockCorrection+=n:s>=this._itemsAboveRenderBlock+this._itemsInRenderBlock?this._heightBelowRenderBlockCorrection-=n:(this._heightOfRenderBlock+=n,r.measureState===w.UnmeasuredAbove?this._adjustScrollPositionAfterReconcile(n):r.measureState===w.UnmeasuredBelow?this._adjustScrollPositionUntilReconcile(n):r.measureState===w.UnmeasuredInside?r.top<=this._getViewportBottom()+30?this._adjustScrollPositionAfterReconcile(t):this._adjustScrollPositionUntilReconcile(t):r.measureState===w.UnmeasuredInsideNoAnimation?this._adjustScrollPositionUntilReconcile(t):r.measureState===w.Measured&&(r.top+o<=this._getViewportBottom()?this._adjustScrollPositionAfterReconcile(n):this._adjustScrollPositionUntilReconcile(n))),r.measureState=w.Measured),0!==n}_adjustScrollPositionAfterReconcile(e){c.log(d.LogTraceArea.VirtualMessageViewDebug,"_adjustScrollPositionAfterReconcile "+e),this._heightAboveRenderBlockCorrection+=e,this._heightAboveRenderBlockEstimate-=e}_adjustScrollPositionUntilReconcile(e){c.log(d.LogTraceArea.VirtualMessageViewDebug,"_adjustScrollPositionUntilReconcile "+e),this._heightBelowRenderBlockCorrection+=e,this._heightBelowRenderBlockEstimate-=e}_onScrollHandler(e,t){e=Math.round(e),t=Math.round(t),this._lastScrollTop!==e&&(this._lastScrollTopSetByUser===e&&this._lastScrollTop!==e||(this._reportUserScrollEvent=!0,this._lastScrollTopSetByUser=e,this._lastScrollTop=e,this._lastScrollLeft=t,this._onReportUserScrollEvent()))}_allocateRenderBlockItem(e,t,s,i){this._pendingMounts[e.key]=e.key,this._isHeightOfItemKnown(e)?t=w.Measured:this._pendingMeasures[e.key]=e.key;const o=this._shouldShowItem(e);this._renderInfoCache[e.key]={top:i,measureState:t,isVisible:o,shouldUpdate:!0},this._isRenderDirty=!0,this._itemsInRenderBlock++,this._heightOfRenderBlock+=s,c.log(d.LogTraceArea.VirtualMessageViewDebug,"Allocating new render block item for "+e.key+" H="+s+" Y="+i," V="+o),this._forceUpdateCell(e.key)}_forceUpdateCell(e){this._virtualListCells[e]&&o.defer((()=>{const t=this._virtualListCells[e];t&&this._isMounted&&t.forceUpdate()}))}_getEffectiveScrollTop(){return 0===this._containerHeight?-this._viewportHeight:this._lastScrollTop}_removeItemsFromRenderBlock(){const e=this._getEffectiveScrollTop(),t=Math.max(6*this._viewportHeight,3072),s=e-t,i=e+this._viewportHeight+t;let o=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate,n=o-this._heightOfRenderBlock;for(;this._itemsInRenderBlock>0;){const e=this._itemsAboveRenderBlock,t=this._itemList[e];if(!this._isHeightOfItemKnown(t))break;const i=this._getHeightOfItem(t);if(n+i>=s)break;this._isRenderDirty=!0,this._itemsInRenderBlock--,this._heightOfRenderBlock-=i,this._itemsAboveRenderBlock++,this._heightAboveRenderBlockEstimate+=i,n+=i,this._deleteItemFromCaches(t.key),c.log(d.LogTraceArea.VirtualMessageViewDebug,"Culled Item From Top: "+t.key)}for(;this._itemsInRenderBlock>0;){const e=this._itemsAboveRenderBlock+this._itemsInRenderBlock-1,t=this._itemList[e];if(!this._isHeightOfItemKnown(t))break;const s=this._getHeightOfItem(t);if(o-s<=i)break;this._isRenderDirty=!0,this._itemsInRenderBlock--,this._heightOfRenderBlock-=s,this._itemsBelowRenderBlock++,this._heightBelowRenderBlockEstimate+=s,o-=s,this._deleteItemFromCaches(t.key),c.log(d.LogTraceArea.VirtualMessageViewDebug,"Culled Item From Bottom: "+t.key)}}_addInitialItemToRenderBlock(){let e=!1,t=0,s=this._itemList.length-1;if(void 0!==this._initialScrollIndex)s=this._initialScrollIndex,e=!this._filledViewableScreen,t=this._getEffectiveScrollTop()+Math.floor(.25*this._viewportHeight);else if(this._filledViewableScreen){let i=this._containerHeight-this._getBottomSpacerHeight();const o=this._getEffectiveScrollTop()+this._viewportHeight;for(;i>=o&&s>0;){const e=this._itemList[s];i-=this._getHeightOfItem(e),s--}e=!0,t=this._getEffectiveScrollTop()+this._viewportHeight-this._getHeightOfItem(this._itemList[s])}c.log(d.LogTraceArea.VirtualMessageView,"_addInitialItemToRenderBlock referenceIndex: "+s+" out of "+this._itemList.length);const i=this._itemList[s];this.props.shouldFocusInitialItem&&(this._itemKeyToFocus=i.key),this.props.isMessageSearchPanelVisible&&void 0!==this._initialScrollIndex&&this._itemKeyToFocusNext(i.key);const o=this._getHeightOfItem(i);this._heightAboveRenderBlockEstimate-=o,this._itemsInRenderBlock=0,this._heightOfRenderBlock=0,this._itemsAboveRenderBlock=s;const n=this._calcHeightOfItems(this._itemList,0,s-1);this._heightAboveRenderBlockCorrection=n-this._heightAboveRenderBlockEstimate,this._itemsBelowRenderBlock=this._itemList.length-this._itemsAboveRenderBlock-1;const r=this._calcHeightOfItems(this._itemList,s+1,this._itemList.length-1);if(this._heightBelowRenderBlockCorrection=r-this._heightBelowRenderBlockEstimate,e){const e=t-this._heightAboveRenderBlockEstimate;this._adjustScrollPositionAfterReconcile(-e),this._adjustScrollPositionUntilReconcile(e)}const a=e?w.UnmeasuredBelow:w.UnmeasuredAbove;this._allocateRenderBlockItem(i,a,o,this._heightAboveRenderBlockEstimate-this._getBottomSpacerHeight()),c.log(d.LogTraceArea.VirtualMessageView,"New item count above: "+this._itemsAboveRenderBlock)}_getMaxPendingMounts(){return m.default.isAnimationPending()?1:10}_expandRenderBlock(e,t){const s=this._getEffectiveScrollTop(),i=s-e,n=s+this._viewportHeight+t,r=this._getMaxPendingMounts();let a=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate,l=a-this._heightOfRenderBlock;for(;this._itemsBelowRenderBlock>0&&a<n;){if(o.size(this._pendingMounts)>=r)return;const e=this._itemList[this._itemsAboveRenderBlock+this._itemsInRenderBlock],t=this._getHeightOfItem(e);this._allocateRenderBlockItem(e,w.UnmeasuredBelow,t,a),a+=t,this._itemsBelowRenderBlock--,this._heightBelowRenderBlockEstimate-=t}for(;this._itemsAboveRenderBlock>0&&l>i;){if(o.size(this._pendingMounts)>=r)return;const e=this._itemList[this._itemsAboveRenderBlock-1],t=this._getHeightOfItem(e);this._allocateRenderBlockItem(e,w.UnmeasuredAbove,t,l-t),l-=t,this._itemsAboveRenderBlock--,this._heightAboveRenderBlockEstimate-=t}}_calcNewRenderedItemState(e=!0,t=!0){if(0===this._itemList.length)return;this._removeItemsFromRenderBlock();const s=0===this._itemsInRenderBlock;s&&this._itemList.length>0&&this._addInitialItemToRenderBlock();const i=e&&this._filledViewableScreen&&Date.now().valueOf()-this._lastContainerLayoutTime>500;this._repositionCells({animate:i});const o=t&&!s&&this._filledViewableScreen?Math.min(Math.max(5*this._viewportHeight,2048),4096):0;this._expandRenderBlock(o,o)}_getViewportBottom(){return this._lastScrollTop+this._viewportHeight-this._getBottomSpacerHeight()}_checkAndReportVisibleRangeChanges(){if(this.props.onVisibleRangeChanged&&this._isMounted&&this._filledViewableScreen){const e=this._lastScrollTop,t=this._getViewportBottom();let s=-1,i=-1,o=-1,n=-1;const r=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate,a=r-this._heightOfRenderBlock;if(a<t||r>e){let l=a;for(let t=0;t<this._itemsInRenderBlock;t++){const i=this._getHeightOfItem(this._itemList[t+this._itemsAboveRenderBlock]);if(l>=e&&-1===o&&(o=t+this._itemsAboveRenderBlock),l+=i,l>e&&-1===s&&(s=t+this._itemsAboveRenderBlock),-1!==s&&-1!==o)break}l=r;for(let e=this._itemsInRenderBlock-1;e>=0;e--){const s=this._getHeightOfItem(this._itemList[e+this._itemsAboveRenderBlock]);if(l<=t&&-1===n&&(n=e+this._itemsAboveRenderBlock),l-=s,l<t&&-1===i&&(i=e+this._itemsAboveRenderBlock),-1!==i&&-1!==n)break}}(this._itemListChangedSinceLastVisibleRangeChange||this._lastPartialTopVisibleItem!==s||this._lastPartialBottomVisibleItem!==i||this._lastWholeTopVisibleItem!==o||this._lastWholeBottomVisibleItem!==n)&&(this._itemListChangedSinceLastVisibleRangeChange=!1,this._lastPartialTopVisibleItem=s,this._lastPartialBottomVisibleItem=i,this._lastWholeTopVisibleItem=o,this._lastWholeBottomVisibleItem=n,c.log(d.LogTraceArea.VirtualMessageViewDebug,"Visible Range Changed: Partial: "+this._lastPartialTopVisibleItem+"-"+this._lastPartialBottomVisibleItem+", Whole: "+this._lastWholeTopVisibleItem+"-"+this._lastWholeBottomVisibleItem),this.props.onVisibleRangeChanged(this._lastPartialTopVisibleItem,this._lastPartialBottomVisibleItem,this._lastWholeTopVisibleItem,this._lastWholeBottomVisibleItem))}}_setContainerHeight(e){return this._containerHeight!==e&&(c.log(d.LogTraceArea.VirtualMessageView,"setContainerHeight Old: "+this._containerHeight+" New: "+e),this._containerHeight=e,this._containerHeightValue.setValue(e),!0)}_getNewContainerHeight(){const e=this._heightAboveRenderBlockEstimate+this._heightAboveRenderBlockCorrection+this._heightOfRenderBlock+this._heightBelowRenderBlockEstimate+this._heightBelowRenderBlockCorrection+this._getBottomSpacerHeight();return Math.max(e,this._viewportHeight)}_reconcileCorrections(e){if(0===this._itemList.length)return!1;let t=!1;this._oldViewportHeight=this._viewportHeight;Math.abs(this._scrollOuterContainerHeight-this._innerScrollContainerHeight)>1&&(c.log(d.LogTraceArea.VirtualMessageView,"Forcing recalculations because viewport size changed, old _viewportHeight: "+this._viewportHeight+" new _viewportHeight: "+this._scrollOuterContainerHeight),this._innerScrollContainerHeight=this._scrollOuterContainerHeight,this._viewportHeight=this._scrollOuterContainerHeight,this._innerScrollContainerHeightValue.setValue(this._scrollOuterContainerHeight),t=!0);let s=this._getNewContainerHeight();if(0===this._heightAboveRenderBlockCorrection&&0===this._heightBelowRenderBlockCorrection&&this._containerHeight===s||(t=!0,c.log(d.LogTraceArea.VirtualMessageView,"Forcing recalculations because container size changed, _heightAboveRenderBlockCorrection: "+this._heightAboveRenderBlockCorrection+" _heightBelowRenderBlockCorrection: "+this._heightBelowRenderBlockCorrection+" _containerHeight: "+this._containerHeight+" newContainerHeight: "+s)),t){this._applyNewAverageToEstimates(),s=this._getNewContainerHeight();const t=this._setContainerHeight(s);return this._completeReconcileCorrections(e,t)}return!1}_applyNewAverageToEstimates(){const e=this._averageHeightCounter.getAverage();if(this._currentAverageHeight===e)return;const t=e-this._currentAverageHeight,s=t*this._calcUnknownHeightItemsCount(this._itemList,0,this._itemsAboveRenderBlock-1);this._heightAboveRenderBlockCorrection+=s;const i=t*this._calcUnknownHeightItemsCount(this._itemList,this._itemsAboveRenderBlock+this._itemsInRenderBlock,this._itemList.length-1);this._heightBelowRenderBlockCorrection+=i,c.log(d.LogTraceArea.VirtualMessageViewDebug," applyNewAverageToEstimates currentAverageHeight: "+this._currentAverageHeight+", newAverageHeight "+e+", aboveHeightAdjustment "+s+", belowHeightAdjustment "+i),this._currentAverageHeight=e}_completeReconcileCorrections(e,t){const s=this._viewportHeight-this._oldViewportHeight;let i=this._heightAboveRenderBlockCorrection-s;if(c.log(d.LogTraceArea.VirtualMessageView,"_reconcileCorrections: initial="+e+" A="+this._heightAboveRenderBlockCorrection+" B="+this._heightBelowRenderBlockCorrection+" viewPortHeightDelta="+s),this._heightAboveRenderBlockEstimate+=this._heightAboveRenderBlockCorrection,this._heightAboveRenderBlockCorrection=0,this._heightBelowRenderBlockEstimate+=this._heightBelowRenderBlockCorrection,this._heightBelowRenderBlockCorrection=0,e&&!o.isUndefined(this._initialScrollIndex)&&this._initialScrollIndex>=0){if(this._initialScrollIndex>=this._itemsAboveRenderBlock&&this._initialScrollIndex<=this._itemsAboveRenderBlock+this._itemsInRenderBlock){let e=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate-this._heightOfRenderBlock;for(let t=this._itemsAboveRenderBlock;t<this._initialScrollIndex;t++)e+=this._getHeightOfItem(this._itemList[t]);i=e-Math.floor(.25*this._viewportHeight)}this._initialScrollIndex=void 0}return this._setNewScrollTop(this._lastScrollTop+i,!1),this._repositionCells({}),!1}_setNewScrollTop(e,t){e=Math.round(e),e=Math.min(e,this._containerHeight-this._viewportHeight),(e=Math.max(e,0))!==this._lastScrollTop&&(c.log(d.LogTraceArea.VirtualMessageViewDebug,"Setting scroll top: "+e),this._lastScrollTop=e,this._scrollView&&(delete this._pendingSetScrollTop,this._setScrollTop(e,t)))}_adjustScrollTopAndRepositionCells(e,t){if(e=Math.round(e),e=Math.min(e,this._containerHeight-this._viewportHeight-this._lastScrollTop),0!==(e=Math.max(e,-this._lastScrollTop))){if(this._lastScrollTop+=e,c.log(d.LogTraceArea.VirtualMessageViewDebug,"Adjusting scroll top: "+e+" (absolute value "+this._lastScrollTop+")"),this._vmvController){const t=this._repositionCells({sendToNative:!1});return this._vmvController.scrollBy(e,t,this._isAndroidScreenReaderEnabled()),!0}this._scrollView&&(t?this._pendingSetScrollTop=this._lastScrollTop:this._setScrollTop(this._lastScrollTop,!1),this._repositionCells({}))}return!1}_validateHeightInvariants(e=!0){c.log(d.LogTraceArea.VirtualMessageViewDebug," AE:"+this._heightAboveRenderBlockEstimate+" AC:"+this._heightAboveRenderBlockCorrection+" RB:"+this._heightOfRenderBlock+" BE:"+this._heightBelowRenderBlockEstimate+" BC:"+this._heightBelowRenderBlockCorrection);this._calcHeightOfItems(this._itemList,0,this._itemsAboveRenderBlock-1),this._calcHeightOfItems(this._itemList,this._itemsAboveRenderBlock+this._itemsInRenderBlock,this._itemList.length-1),this._calcHeightOfItems(this._itemList,this._itemsAboveRenderBlock,this._itemsAboveRenderBlock+this._itemsInRenderBlock-1),this._itemsAboveRenderBlock,this._itemsBelowRenderBlock,this._itemsInRenderBlock;if(this._containerHeight>0&&e){const e=this._heightAboveRenderBlockEstimate+this._heightOfRenderBlock+this._heightBelowRenderBlockEstimate+this._getBottomSpacerHeight();Math.max(e,this._viewportHeight)}return!0}_popInvisibleIntoView(){this._filledViewableScreen=!0;for(let e=0;e<this._itemsInRenderBlock;e++){const t=this._itemList[this._itemsAboveRenderBlock+e],s=this._renderInfoCache[t.key];s.isVisible||(s.isVisible=!0)}this._repositionCells({dissallowVisibilityChanges:!1}),this.props.onInitialRenderComplete&&this.props.onInitialRenderComplete()}_repositionCells(e){const t=!!e.staggerAnimations,s=!!o.isUndefined(e.sendToNative)||e.sendToNative,i=[],n=[],r=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate;let a=r,l=0;for(let o=this._itemsInRenderBlock-1;o>=0;o--){const h=this._itemList[this._itemsAboveRenderBlock+o];a-=this._getHeightOfItem(h),t&&(l=Math.floor(.1*(r-a)));const u=this._renderInfoCache[h.key];if(!u){c.error(d.LogTraceArea.VirtualMessageViewDebug,"Missing renderInfo for "+h.key);continue}const p=this._virtualListCells[h.key];if(p&&i.push({component:p,yPosition:a}),s){const t=e.dissallowVisibilityChanges?u.isVisible:this._shouldShowItem(h);this._setCellTopAndVisibility(h.key,t,a,l,e)&&n.push({key:h.key,yPosition:a,visibility:t})}}return s&&o.size(n)>0&&c.log(d.LogTraceArea.VirtualMessageViewDebug,"_repositionCells: "+o.reduce(n,((e,t)=>e+"("+t.key+","+t.yPosition+","+(t.visibility?"Y":"N")+")"),"")),i}_setCellTopAndVisibility(e,t,s,i,o){const n=!!o.animate,a=this._renderInfoCache[e];if(!a)return c.error(d.LogTraceArea.VirtualMessageViewDebug,"Missing renderInfo for "+e),!1;const l=n&&a.isVisible&&!this._isAndroidScreenReaderEnabled();a.isVisible=t,a.top=s;const h=this._virtualListCells[e];let u=!1;return h&&this._filledViewableScreen&&(h.getTop()!==s&&(h.setTop({top:s,animate:l,animationDelay:i,animationEasingFunction:r.Easing.SkypeEaseOut,animationDuration:v.AnimationDuration.Short}),u=!0),h.isVisible()!==t&&(h.setVisibility(t),u=!0)),u}_makeCellInvisibleDeferred(e){o.defer((()=>{const t=this._virtualListCells[e],s=this._renderInfoCache[e];t&&!s&&t.setVisibility(!1)}))}_resizeAllItems(e){if(this._viewportWidth<=0)return;const t=this._viewportWidth-(e.leftSpacerWidth||0)-(e.rightSpacerWidth||0),s=e.contentMaxWidth&&t>e.contentMaxWidth?e.contentMaxWidth:t;s>0&&this._contentWidth!==s&&(this._contentWidth=s,this._itemsInRenderBlock>0&&(this._isRenderDirty=!0))}_renderIfDirty(){this._isRenderDirty&&this._isMounted&&this.forceUpdate()}_focusCellIfNeeded(){if(this._itemKeyToFocus){const e=this._virtualListCells[this._itemKeyToFocus];e&&(e.focusCell(),this._itemKeyToFocus=void 0)}}render(){const e=[];c.log(d.LogTraceArea.VirtualMessageViewDebug,"Rendering "+this._itemsInRenderBlock+" items starting at "+this._itemsAboveRenderBlock),this._renderedItemKeys=[];for(let t=0;t<this._itemsInRenderBlock;t++){const s=this._itemList[this._itemsAboveRenderBlock+t],o=this._renderInfoCache[s.key],r=this._isAndroidScreenReaderEnabled()?"ac_"+s.key:s.key;this._renderedItemKeys.push(s.key),e.push((0,i.jsx)(n.VirtualListCell,{ref:this._getVirtualListCellRefCallback(s.key),onLayout:this._stateOnLayoutItem,itemKey:s.key,item:s,width:this._contentWidth,top:o?o.top:0,isVisible:!!o&&o.isVisible,isActive:!0,isFocused:!1,onAnimateStartStop:this._stateOnAnimateStartStopItem,useTransformOptimization:!this._isAndroidScreenReaderEnabled(),shouldUpdate:!o||o.shouldUpdate,renderItem:this.props.renderItem,focusable:s.focusable,onCellFocus:this._onCellFocus,limitFocusWithin:a.Types.LimitFocusType.Accessible},r)),o&&(o.shouldUpdate=!1)}c.log(d.LogTraceArea.VirtualMessageViewDebug,"Item Render Complete");const t=[T.staticContainer,this.props.style,this._containerAnimatedStyle,this._getItemContainerStyle(this.props.contentMaxWidth)];this.props.showOverflow&&t.push(C.default.overflowVisible),this.props.horizontalPadding&&this.props.horizontalPadding.left&&t.push(a.Styles.createViewStyle({marginLeft:this.props.horizontalPadding.left},!1));let s=(0,i.jsx)(a.Animated.View,Object.assign({style:o.compact(t),onLayout:e=>{if(Math.trunc(e.height)===Math.trunc(this._containerHeight)){const e=this._pendingSetScrollTop;delete this._pendingSetScrollTop,e&&this._scrollView&&this._setScrollTop(e,!1)}}},{children:e}));return this.props.useWideLayout&&(s=(0,i.jsxs)(a.View,Object.assign({style:T.compositeItemsListContainer},{children:[(0,i.jsx)(a.View,{style:this._getSpacerStyle(this.props.leftSpacerWidth)}),s,(0,i.jsx)(a.View,{style:this._getSpacerStyle(this.props.rightSpacerWidth)})]}))),(0,i.jsx)(a.View,Object.assign({style:T.scrollOuterContainer,onLayout:this._onLayoutOuterScrollContainer},{children:(0,i.jsx)(a.Animated.View,Object.assign({style:[T.scrollInnerContainer,this._scrollInnerContainerStyle]},{children:(0,i.jsxs)(a.ScrollView,Object.assign({onLayout:this._stateOnLayoutListContainer,onScroll:this._stateOnScroll,keyboardDismissMode:this.props.keyboardDismissMode,keyboardShouldPersistTaps:this.props.keyboardShouldPersistTaps,ref:this._scrollViewRefCallback,scrollEventThrottle:32,style:T.scrollView,scrollsToTop:this.props.scrollsToTop,scrollEnabled:this.props.scrollEnabled,overScrollMode:"never",onScrollBeginDrag:this._onScrollBeginDrag,onScrollEndDrag:this._onScrollEndDrag,onKeyPress:this._onKeyPress},{children:[null,s]}))}))}))}_setScrollTop(e,t){var s;null===(s=this._scrollView)||void 0===s||s.setScrollTop(e,t)}_getSpacerStyle(e){return M[e]||(M[e]=a.Styles.createViewStyle({flex:1,minWidth:e})),M[e]}_getItemContainerStyle(e){return I[e]||(I[e]=a.Styles.createViewStyle({width:e})),I[e]}_getVirtualListCellRefCallback(e){return this._virtualListCellRefCallbacks[e]||(this._virtualListCellRefCallbacks[e]=t=>{t?this._virtualListCells[e]=t:(delete this._virtualListCells[e],delete this._virtualListCellRefCallbacks[e])}),this._virtualListCellRefCallbacks[e]}componentDidMount(){this._isMounted=!0,this._componentDidRender()}componentWillUnmount(){this._currentState=void 0,this._isMounted=!1,S.default.unsubscribe(this._screenReaderDetectionStoreToken)}componentDidUpdate(e,t,s){this._componentDidRender()}_componentDidRender(){if(c.log(d.LogTraceArea.VirtualMessageViewDebug,"Component Did Render"),this._isRenderDirty=!1,this._renderedItemKeys){let e;const t=this._renderedItemKeys.filter((e=>e!==f.ItemListKey.Composing));if(this._focusedItemKey){if(e=t.indexOf(this._focusedItemKey),e<0||!this._isFocused)if(e>=0){const s=this._virtualListCells[t[e]];s&&s.setFocusLimited(!0)}else e=t.length-1}else e=t.length-1;if(this._focusedItemKey=t[e],this._focusedItemKey){const e=this._virtualListCells[this._focusedItemKey];e&&e.setFocusLimited(!1)}}}scrollToBottom(){this._currentState&&this._currentState.onScrollToPosition(-1,!1)}scrollToPosition(e,t,s=!1){this._currentState&&(this._currentState.onScrollToPosition(e,s),this._itemKeyToFocusNext(t))}focusMessage(e){let t;o.eachRight(this._virtualListCells,(s=>{s.props.item&&o.endsWith(s.props.item.key,e)&&(t=s)})),t&&t.focusCell()}_itemKeyToFocusNext(e){const t=this._virtualListCells[e],s=this._virtualListCells[this._focusedItemKey];t&&(t.setFocusLimited(!1),s&&s.setFocusLimited(!0)),this._focusedItemKey=e}_shouldShowItem(e){return this._filledViewableScreen&&this._isHeightOfItemKnown(e)&&0===o.size(this._pendingMeasures)}_calcHeightOfItems(e,t,s){let i=0;for(let o=t;o<=s;o++)i+=this._getHeightOfItem(e[o]);return i}_calcUnknownHeightItemsCount(e,t,s){let i=0;for(let o=t;o<=s;o++){const t=e[o];i+=t.height||this._isHeightOfItemKnown(t)?0:1}return i}_isHeightOfItemKnown(e){return void 0!==this._heightCache[e.key]}_getHeightOfItem(e){return e?void 0!==this._heightCache[e.key]?this._heightCache[e.key]:e.height?e.height:this._currentAverageHeight:0}}A.Initialization=class{constructor(e){this.view=e,this._initializationState=P.Undefined}init(e){c.log(d.LogTraceArea.VirtualMessageViewDebug,"Initialization","init"),this.view._initItemList(e.observableList.getItemList(),e)}onLayoutListContainer(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"Initialization","onLayoutListContainer"),t&&this.view._onLayoutListContainer(e),this._moveToNextIfReady()}onListChanged(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"Initialization","onListChanged"),this.view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){this.view._onScrollToPositionEvent=e}onScroll(e,t){}onLayoutItem(e,t){this.view._onLayoutItem(e,t),this._moveToNextIfReady()}onAnimateStartStopItem(e,t){}onControllerScrollPositionSet(){c.log(d.LogTraceArea.VirtualMessageViewDebug,"Initialization","onControllerScrollPositionSet"),this._finishInitialization()}onScrollEndDrag(){}_canMoveNext(){return 0===o.size(this.view._pendingMeasures)&&this._initializationState!==P.WaitingForScroll&&0!==this.view._viewportHeight}_moveToNextIfReady(){if(this._canMoveNext()){if(0===this.view._itemList.length)return this.view._filledViewableScreen=!0,void this.view.setCurrentState(new A.Idle(this.view));this.view._calcNewRenderedItemState(!1),this.view._renderIfDirty(),this._canMoveNext()&&(c.log(d.LogTraceArea.VirtualMessageViewDebug,"Initialization","starting reconcileCorrections"),this.view._reconcileCorrections(!0),this._finishInitialization())}}_finishInitialization(){c.log(d.LogTraceArea.VirtualMessageViewDebug,"Initialization","starting popInvisibleIntoView"),this.view._popInvisibleIntoView(),this.view._scrollView&&this.view._setScrollTop(this.view._lastScrollTop,!1),this.view.setCurrentState(new A.Wait(this.view,100))}},A.Idle=class{constructor(e){this.view=e,this._needsReconcilation=!1,this._reconcileCorrectionsDebounced=o.debounce((()=>{if(this.view._isMounted){if(o.size(this.view._pendingMeasures)>0||o.size(this.view._pendingAnimations)>0||this.view._isDragging)return void this._reconcileCorrectionsDebounced();this._reconcileCorrections()}}),1e3)}init(e){for(c.log(d.LogTraceArea.VirtualMessageViewDebug,"Idle","init"),o.each(this.view._onAnimateStartStopItemQueue,(e=>{c.log(d.LogTraceArea.VirtualMessageViewDebug,"Idle","processing queued onAnimateStartStopItem for "+e.itemKey),this.view._onAnimateStartStopItem(e.itemKey,e.animateStart)})),this.view._onAnimateStartStopItemQueue=[],o.each(this.view._onLayoutItemQueue,(e=>{this.view._onLayoutItem(e.itemKey,e.newHeight)})),this.view._onLayoutItemQueue=[],this.view._onLayoutListContainerEvent&&(c.log(d.LogTraceArea.VirtualMessageViewDebug,"Idle","processing queued onLayoutListContainer"),this.view._onLayoutListContainer(this.view._onLayoutListContainerEvent)),this.view._onLayoutListContainerEvent=void 0,this.view._reportUserScrollEvent&&(c.log(d.LogTraceArea.VirtualMessageViewDebug,"Idle","processing queued reportUserScrollEvent"),this.view._onReportUserScrollEvent());o.size(this.view._onListChangedQueue)>0;){const e=this.view._onListChangedQueue.splice(0,1)[0];if(c.log(d.LogTraceArea.VirtualMessageView,"Idle","processing queued onListChanged"+JSON.stringify(o.omit(e.listModification,["items"]))+", "+o.map(e.listModification.items,(e=>e.key))),this._processOnListChanged(e.listModification,e.updatedList))return}this._processPendingOnScrollToPosition(),this._finishEventProcessing()}_processPendingOnScrollToPosition(){o.isUndefined(this.view._onScrollToPositionEvent)||(c.log(d.LogTraceArea.VirtualMessageViewDebug,"processing queued onScrollToPosition"),this._processOnScrollToPosition(this.view._onScrollToPositionEvent,!1),this.view._onScrollToPositionEvent=void 0)}onLayoutListContainer(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"Idle","onLayoutListContainer"),t&&this.view._onLayoutListContainer(e),this._finishEventProcessing()}_finishEventProcessing(e=!1){if(!this._needsReconcilation){const t=this.view._lastScrollTop<=0||this.view._lastScrollTop>=this.view._containerHeight-this.view._viewportHeight;this._needsReconcilation=t&&e}if(o.size(this.view._pendingAnimations)>0)return this._reconcileCorrectionsDebounced.cancel(),void this.view.setCurrentState(new A.WaitForAnimation(this.view));if(o.size(this.view._pendingMeasures)>0)return;if(this._needsReconcilation&&!this.view._isDragging)return void this._reconcileCorrections();const t=!this._needsReconcilation;this.view._checkAndReportVisibleRangeChanges(),this.view._calcNewRenderedItemState(!0,t),this.view._renderIfDirty(),this.view._focusCellIfNeeded(),this._reconcileCorrectionsDebounced()}_reconcileCorrections(){return this._needsReconcilation=!1,this.view._repositionCells({animate:!1}),this.view._reconcileCorrections(!1),this._processPendingOnScrollToPosition(),this.view._checkAndReportVisibleRangeChanges(),this.view._calcNewRenderedItemState(),this.view._renderIfDirty(),!1}onListChanged(e,t){c.log(d.LogTraceArea.VirtualMessageView,"Idle","onListChanged "+JSON.stringify(o.omit(e,["items"]))+", "+o.map(e.items,(e=>e.key))),this._processOnListChanged(e,t)||(this.view._renderIfDirty(),this._finishEventProcessing())}_processOnListChanged(e,t){if(o.each(t,(e=>{const t=this.view._renderInfoCache[e.key];if(t&&!t.shouldUpdate){const s=this.view._itemMap[e.key],i=this.view._itemList[s];t.shouldUpdate=this.view.props.shouldUpdateItem(i,e)}})),e.type===l.ListModificationType.AddItems){if(this.view._itemsAdded(t,e),o.size(this.view._pendingMeasures)>0)return this._reconcileCorrectionsDebounced.cancel(),this.view.setCurrentState(new A.WaitForModifiedItemsRender(this.view,e)),this.view._renderIfDirty(),!0}else if(e.type===l.ListModificationType.RemoveItems)this.view._itemsRemoved(t,e),this.view._repositionCells({animate:!0});else if(e.type===l.ListModificationType.ReplaceItems){if(this.view._itemsReplaced(t,e),o.size(this.view._pendingMeasures)>0)return this._reconcileCorrectionsDebounced.cancel(),this.view.setCurrentState(new A.WaitForModifiedItemsRender(this.view,e)),this.view._renderIfDirty(),!0}else e.type===l.ListModificationType.MoveItems&&this.view._itemsMoved(t,e);return this.view._isRenderDirty=!0,!1}onScrollToPosition(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"Idle","onScrollToPosition");if(o.size(this.view._pendingMeasures)>0||o.size(this.view._pendingAnimations)>0)return this.view._onScrollToPositionEvent=e,void(this._needsReconcilation=!0);this._reconcileCorrections()?this.view._onScrollToPositionEvent=e:(this._processOnScrollToPosition(e,t),this._finishEventProcessing())}_processOnScrollToPosition(e,t){const s=this.view._containerHeight-this.view._viewportHeight;if(-1===e)this.view._setNewScrollTop(s,t);else{const i=this.view._itemList,o=this.view._getHeightOfItem(this.view._itemList[e]);let n=this.view._calcHeightOfItems(i,0,e)-o-Math.floor(.25*this.view._viewportHeight);n=n>s?s:n,this.view._setNewScrollTop(n,t)}}onScroll(e,t){this.view._onScroll(e,t),this._finishEventProcessing(!0)}onLayoutItem(e,t){(this.view._onLayoutItem(e,t)||0===o.size(this.view._pendingMounts))&&this._finishEventProcessing(!0)}onAnimateStartStopItem(e,t){this.view._onAnimateStartStopItem(e,t),this._finishEventProcessing()}onControllerScrollPositionSet(){c.warn(d.LogTraceArea.VirtualMessageView,"Idle - onControllerScrollPositionSet - Unexpected event")}onScrollEndDrag(){this._finishEventProcessing(!0)}},A.WaitForModifiedItemsRender=class{constructor(e,t){this._view=e,this._listModification=t}init(e){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","init")}onLayoutListContainer(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","onLayoutListContainer"),t&&(this._view._onLayoutListContainerEvent=e)}onListChanged(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","onListChanged"),this._view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","onScrollToPosition"),this._view._onScrollToPositionEvent=e}onScroll(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","onScroll"),this._view._onScroll(e,t)}onLayoutItem(e,t){if(this._view._onLayoutItem(e,t),0===o.size(this._view._pendingMeasures)){if(this._listModification.type===l.ListModificationType.AddItems){const t=this._listModification.options&&this._listModification.options.animateFromBottom,s=this._view._renderInfoCache[e].top;if(s<=this._view._getViewportBottom()+30&&s>=this._view._lastScrollTop){if(this._view._repositionCells({animate:!0,dissallowVisibilityChanges:!0}),t){const e=this._view._containerHeight-this._view._getBottomSpacerHeight()-this._view._heightBelowRenderBlockEstimate,t={animate:!1};o.each(this._listModification.items,(s=>{this._view._renderInfoCache[s.key]&&this._view._setCellTopAndVisibility(s.key,!0,e,0,t)}))}this._view._repositionCells({animate:!0,staggerAnimations:true})}}else this._view._repositionCells({animate:!0});o.size(this._view._pendingAnimations)>0?this._view.setCurrentState(new A.WaitForAnimation(this._view)):this._view.setCurrentState(new A.Idle(this._view))}}onAnimateStartStopItem(e,t){this._view._onAnimateStartStopItem(e,t)}onControllerScrollPositionSet(){c.warn(d.LogTraceArea.VirtualMessageView,"WaitForModifiedItemsRender - onControllerScrollPositionSet - Unexpected event")}onScrollEndDrag(){}},A.Wait=class{constructor(e,t){this._view=e,o.delay((()=>{this._view._isMounted&&this._view.setCurrentState(new A.Idle(this._view))}),t)}init(e){c.log(d.LogTraceArea.VirtualMessageViewDebug,"Wait","init")}onLayoutListContainer(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"Wait","onLayoutListContainer"),t&&(this._view._onLayoutListContainerEvent=e)}onListChanged(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"Wait","onListChanged"),this._view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"Wait","onScrollToPosition"),this._view._onScrollToPositionEvent=e}onScroll(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"Wait","onScroll"),this._view._onScroll(e,t)}onLayoutItem(e,t){this._view._onLayoutItemQueue.push({itemKey:e,newHeight:t})}onAnimateStartStopItem(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"Wait","onAnimateStartStopItem"),this._view._onAnimateStartStopItem(e,t)}onControllerScrollPositionSet(){c.warn(d.LogTraceArea.VirtualMessageView,"Wait - onControllerScrollPositionSet - Unexpected event")}onScrollEndDrag(){}},A.WaitForAnimation=class{constructor(e){this._view=e}init(e){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","init")}onLayoutListContainer(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onLayoutListContainer"),t&&(this._view._onLayoutListContainerEvent=e)}onListChanged(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onListChanged"),this._view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onScrollToPosition"),this._view._onScrollToPositionEvent=e}onScroll(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onScroll"),this._view._onScroll(e,t)}onLayoutItem(e,t){this._view._onLayoutItemQueue.push({itemKey:e,newHeight:t})}onAnimateStartStopItem(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onAnimateStartStopItem"),this._view._onAnimateStartStopItem(e,t),0===o.size(this._view._pendingAnimations)&&this._view.setCurrentState(new A.Idle(this._view))}onControllerScrollPositionSet(){c.warn(d.LogTraceArea.VirtualMessageView,"WaitForAnimation - onControllerScrollPositionSet - Unexpected event")}onScrollEndDrag(){}},A.WaitForScrollPositionSet=class{constructor(e){this._view=e}init(e){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","init")}onLayoutListContainer(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onLayoutListContainer"),t&&(this._view._onLayoutListContainerEvent=e)}onListChanged(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onListChanged"),this._view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onScrollToPosition"),this._view._onScrollToPositionEvent=e}onScroll(e,t){}onLayoutItem(e,t){this._view._onLayoutItemQueue.push({itemKey:e,newHeight:t})}onAnimateStartStopItem(e,t){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onAnimateStartStopItem"),this._view._onAnimateStartStopItem(e,t)}onControllerScrollPositionSet(){c.log(d.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onControllerScrollPositionSet"),this._view._repositionCells({}),this._view.setCurrentState(new A.Idle(this._view))}onScrollEndDrag(){}},t.VirtualMessageView=A},980556:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(23656),n=s(970332);t.default=function({conversationId:e,onPress:t,Title:s,accessibilityLabel:r}){return(0,i.jsx)(n.default,{AvatarSlot:(0,i.jsx)(o.ConversationAvatar,{id:e,size:"md"},"avatar"),TitleSlot:s,onPress:t,accessibilityLabel:r})}},563377:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(281878),n=s(705465);t.default=function({BackButton:e,ConversationControls:t,CardControl:s}){return(0,i.jsx)(o.Row,Object.assign({paddingX:"5",alignItems:"flex-end",marginY:"2"},{children:(0,i.jsxs)(o.Row,Object.assign({flex:"1",alignContent:"space-between",alignItems:"center"},{children:[(0,i.jsxs)(o.Row,Object.assign({alignItems:"center",flexGrow:1,flexShrink:1},{children:[e?(0,i.jsx)(o.Box,Object.assign({style:r.backContainer},{children:e})):null,s]})),(0,i.jsx)(o.Box,Object.assign({flexShrink:0,marginLeft:"5"},{children:t}))]}))}))};const r=n.StyleSheet.create({backContainer:{paddingRight:20}})},416155:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationTitle=void 0;const i=s(785893),o=s(217041),n=s(952262),r=s(231820);class a extends o.ComponentBase{_buildState(e){var t;const s=n.default.getDisplayName(e.id);return e.onConversationNameChange&&s&&(void 0===this.state||s!==(null===(t=this.state)||void 0===t?void 0:t.conversationName))&&e.onConversationNameChange(s),{conversationName:s}}render(){return(0,i.jsx)(r.EntityTitle,{name:this.state.conversationName,Subtitle:this.props.Subtitle,isVerified:this.props.isVerified})}}t.ConversationTitle=a},845148:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MyBotConversationControls=void 0;const i=s(785893),o=s(320373);t.MyBotConversationControls=function(e){return(0,i.jsx)(o.default,{conversationId:e.conversationId,isGalleryEnabled:e.isGalleryEnabled,otherPartyMri:e.otherPartyMri,hasActiveCall:e.hasActiveCall,onGalleryPressed:e.onGalleryPressed})}},843511:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MyBotHeaderTitle=void 0;const i=s(785893),o=s(667294),n=s(416155),r=s(733754),a=s(702301),l=s(567977),d=s(31280);t.MyBotHeaderTitle=function({conversationId:e,onPress:t}){const[s,c]=(0,o.useState)("");return(0,i.jsx)(d.EntityCard,{AvatarSlot:(0,i.jsx)(a.default,{userMri:e,size:l.UserIconSize.Size40}),TitleSlot:(0,i.jsx)(n.ConversationTitle,{id:e,onConversationNameChange:c}),onPress:t,accessibilityLabel:`${s}  ${(0,r.getString)("UserProfilePanel.ViewProfileLabel")}`})}},146851:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NewsChannelConversationControls=void 0;const i=s(785893),o=s(667294),n=s(913944),r=s(711828),a=s(600212),l=s(436237),d=s(746096);t.NewsChannelConversationControls=function(){const{themeColors:{textPrimary:e}}=(0,a.useSkypeTheme)(),t=(0,o.useCallback)((()=>{(0,l.log)(d.LogTraceArea.GenericUnsafe,"onNotificationsPress")}),[]);return(0,i.jsx)(n.default,{icon:r.SkypeIcon.Alert,size:r.IconSize.size24,color:e,onPress:t})}},96732:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NewsChannelHeaderTitle=void 0;const i=s(785893),o=s(980556),n=s(416155);t.NewsChannelHeaderTitle=function({conversationId:e}){return(0,i.jsx)(o.default,{Title:(0,i.jsx)(n.ConversationTitle,{isVerified:!0,id:e}),conversationId:e})}},825577:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NewsChannelConversationControls=t.NewsChannelHeaderTitle=t.ConversationHeader=void 0;var i=s(563377);Object.defineProperty(t,"ConversationHeader",{enumerable:!0,get:function(){return i.default}});var o=s(96732);Object.defineProperty(t,"NewsChannelHeaderTitle",{enumerable:!0,get:function(){return o.NewsChannelHeaderTitle}});var n=s(146851);Object.defineProperty(t,"NewsChannelConversationControls",{enumerable:!0,get:function(){return n.NewsChannelConversationControls}})},822854:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationIcon=void 0;const i=s(785893),o=s(516778),n=s(217041),r=s(967593),a=s(343632),l=s(671830),d=s(23293),c=s(952262),h=s(139889),u=s(110117),p=s(915877),g=s(866127),m=s(581760),S=s(311010),f=s(711828),y=s(680837),v=s(418037),C=s(897634),_=s(994214),b=s(675865),T=s(702301),M=s(388117),I=s(567977),w=s(172758),P=I.UserIconSize.Size20,k=I.UserIconSize.Size20,A=P+2,x=k+2,R=(0,p.lazyProperties)({convIconDefault:()=>o.Styles.createViewStyle({backgroundColor:m.Color.gray400,alignItems:"center",justifyContent:"center"}),meetNowIcon:()=>o.Styles.createViewStyle({backgroundColor:m.Color.blue}),meetNowIconDarkHightContrast:()=>o.Styles.createViewStyle({backgroundColor:m.Color.gray50}),meetNowIconLightHightContrast:()=>o.Styles.createViewStyle({backgroundColor:m.Color.gray400}),container:()=>o.Styles.createViewStyle({borderRadius:0,overflow:"visible"}),messageAuthorAvatarContainer:()=>o.Styles.createViewStyle({position:"absolute",justifyContent:"center",bottom:-4,right:-4,width:A,height:A,borderRadius:A/2,alignItems:"center"}),messageAuthorAvatarContainerModernize:()=>o.Styles.createViewStyle({position:"absolute",justifyContent:"center",bottom:-4,right:-4,width:x,height:x,borderRadius:x/2,alignItems:"center"}),borderOverlayStyle:()=>o.Styles.createViewStyle({position:"absolute",left:0,right:0})}),O={convIconSizes:(0,p.lazyProperties)({size24:()=>({dimensionsStyles:o.Styles.createViewStyle({width:I.ConversationIconSize.Size24,height:I.ConversationIconSize.Size24,borderRadius:I.ConversationIconSize.Size24/2}),size:f.IconSize.size16,color:m.Color.white}),size28:()=>({dimensionsStyles:o.Styles.createViewStyle({width:I.ConversationIconSize.Size28,height:I.ConversationIconSize.Size28,borderRadius:I.ConversationIconSize.Size28/2}),size:f.IconSize.size16,color:m.Color.white}),size30:()=>({dimensionsStyles:o.Styles.createViewStyle({width:I.ConversationIconSize.Size30,height:I.ConversationIconSize.Size30,borderRadius:I.ConversationIconSize.Size30/2}),size:f.IconSize.size16,color:m.Color.white}),size36:()=>({dimensionsStyles:o.Styles.createViewStyle({width:I.ConversationIconSize.Size36,height:I.ConversationIconSize.Size36,borderRadius:I.ConversationIconSize.Size36/2}),size:f.IconSize.size20,color:m.Color.white}),size40:()=>({dimensionsStyles:o.Styles.createViewStyle({width:I.ConversationIconSize.Size40,height:I.ConversationIconSize.Size40,borderRadius:I.ConversationIconSize.Size40/2}),size:f.IconSize.size20,color:m.Color.white}),size44:()=>({dimensionsStyles:o.Styles.createViewStyle({width:I.ConversationIconSize.Size44,height:I.ConversationIconSize.Size44,borderRadius:I.ConversationIconSize.Size44/2}),size:f.IconSize.size28,color:m.Color.white}),size50:()=>({dimensionsStyles:o.Styles.createViewStyle({width:I.ConversationIconSize.Size50,height:I.ConversationIconSize.Size50,borderRadius:I.ConversationIconSize.Size50/2}),size:f.IconSize.size24,color:m.Color.white}),size60:()=>({dimensionsStyles:o.Styles.createViewStyle({width:I.ConversationIconSize.Size60,height:I.ConversationIconSize.Size60,borderRadius:I.ConversationIconSize.Size60/2}),size:f.IconSize.size24,color:m.Color.white}),size64:()=>({dimensionsStyles:o.Styles.createViewStyle({width:I.ConversationIconSize.Size64,height:I.ConversationIconSize.Size64,borderRadius:I.ConversationIconSize.Size64/2}),size:f.IconSize.size28,color:m.Color.white}),size100:()=>({dimensionsStyles:o.Styles.createViewStyle({width:I.ConversationIconSize.Size100,height:I.ConversationIconSize.Size100,borderRadius:I.ConversationIconSize.Size100/2}),size:f.IconSize.size48,color:m.Color.white}),size120:()=>({dimensionsStyles:o.Styles.createViewStyle({width:I.ConversationIconSize.Size120,height:I.ConversationIconSize.Size120,borderRadius:I.ConversationIconSize.Size120/2}),size:f.IconSize.size48,color:m.Color.white}),size160:()=>({dimensionsStyles:o.Styles.createViewStyle({width:I.ConversationIconSize.Size160,height:I.ConversationIconSize.Size160,borderRadius:I.ConversationIconSize.Size160/2}),size:f.IconSize.size48,color:m.Color.white}),botBorderRadius:()=>o.Styles.createViewStyle({borderRadius:7})})};class L extends n.ComponentBase{_buildState(e,t){const s=e.conversationId?c.default.getDisplayableProfile(e.conversationId):void 0,i=v.default.shouldUseInitialsForConversationIcon(),o=v.default.isAccessibleTheme()?m.Color.white:void 0,n=e.conversationId?d.default.getPrimaryColor(e.conversationId):void 0,r=v.default.isDarkTheme(),l=v.default.isAccessibleTheme();let h,u;if(e.conversationId){const{background:t,textColor:s}=(0,a.getAvatarColorsFromMri)(e.conversationId);h=t,u=this._getIconFontColor(l,r,s)}else h=[m.Color.blue,m.Color.white],u=this._getIconFontColor(l,r);return{conversationImageUrl:s?b.default.getAuthenticatedUrl(s.getAvatarUrl()):void 0,skypeToken:_.default.getSkypeToken(),primaryColor:o||n,conversationNameInitials:i&&s?s.getUpperCaseInitials():void 0,lastMessageAuthorDisplayName:e.lastMessageAuthorMri?w.default.getDisplayableUserByMri(e.lastMessageAuthorMri).displayName:void 0,conversationGradientColors:h,conversationIconFontColor:u,useInitialsForConvIcon:i,useDarkTheme:r,useAccessibleTheme:l,modernizeConversationList:g.default.canModernizeConversationList()}}render(){const e=this.state.conversationImageUrl,t=this.props.altName,s=this._getIconStyleInfo(),n=this.state.conversationIconFontColor,a=[R.convIconDefault,M.default.getCachedBackgroundColorStyle(M.default.getIconBackgroundColor(this.state.primaryColor,this.state.useAccessibleTheme,this.state.useDarkTheme),this.props.colorThemeOverride?C.isDarkTheme(this.props.colorThemeOverride):this.state.useDarkTheme),s.dimensionsStyles],d=this._getAvatarBorderColor(),c=M.default.getCachedBorderColorStyle(d);let p;if(this.state.useInitialsForConvIcon&&this.state.conversationNameInitials){const e=[...L._getFontSizeStyles(this.props.size,n),y.default.transparentBackground];p=(0,i.jsx)(o.Text,Object.assign({style:e,numberOfLines:1,allowFontScaling:!1,importantForAccessibility:o.Types.ImportantForAccessibility.NoHideDescendants},{children:this.state.conversationNameInitials}))}else{const e=f.SkypeIcon.ContactGroupTwoPersonas;p=(0,i.jsx)(u.default,{icon:e,color:this.state.conversationIconFontColor,size:s.size,style:y.default.transparentBackground})}const g=[R.convIconDefault,a],m=this.state.useAccessibleTheme?(0,i.jsx)(o.View,Object.assign({style:a},{children:p})):(0,i.jsx)(r.GradientView,Object.assign({style:g,colors:this.state.conversationGradientColors,direction:r.GradientDirection.BOTTOM_RIGHT},{children:p})),S="ConversationIcon; MRINamespace:"+(this.props.conversationId?l.Namespaces[l.getMriNamespace(this.props.conversationId)]:"null");return(0,i.jsxs)(h.default,Object.assign({origin:S,source:e,skypeToken:this.state.skypeToken,altView:m,title:t,containerStyle:[s.dimensionsStyles,R.container],style:s.dimensionsStyles,resizeMode:"cover",importantForAccessibility:this.props.importantForAccessibility,blockUntrustedDomains:!0,onPress:this.props.onPress,accessibilityLabel:this.props.accessibilityLabel},{children:[this._renderBorderOverlay(c,s.dimensionsStyles),this.props.showLastMessageAuthor?this._getLastMessageAuthorAvatar():void 0]}))}_renderBorderOverlay(e,t){if(e)return(0,i.jsx)(o.View,{style:[e,t,R.borderOverlayStyle]})}_getLastMessageAuthorAvatar(){const e=[this.state.modernizeConversationList?R.messageAuthorAvatarContainerModernize:R.messageAuthorAvatarContainer];e.push(o.Styles.createViewStyle({backgroundColor:this._getAvatarBorderColor(this.props.statusBorderColor)},!1));const t=(this.state.modernizeConversationList,I.UserIconSize.Size20);return(0,i.jsx)(o.View,Object.assign({style:e},{children:(0,i.jsx)(T.default,{size:t,userMri:this.props.lastMessageAuthorMri,title:this.state.lastMessageAuthorDisplayName,showTitleOnHover:!0,borderRadiusOverride:t/2,hideBorder:!0})}))}_getIconStyleInfo(){switch(this.props.size){case I.ConversationIconSize.Size24:return O.convIconSizes.size24;case I.ConversationIconSize.Size28:return O.convIconSizes.size28;case I.ConversationIconSize.Size30:return O.convIconSizes.size30;case I.ConversationIconSize.Size36:return O.convIconSizes.size36;case I.ConversationIconSize.Size40:return O.convIconSizes.size40;case I.ConversationIconSize.Size44:return O.convIconSizes.size44;case I.ConversationIconSize.Size50:return O.convIconSizes.size50;case I.ConversationIconSize.Size60:return O.convIconSizes.size60;case I.ConversationIconSize.Size64:return O.convIconSizes.size64;case I.ConversationIconSize.Size100:return O.convIconSizes.size100;case I.ConversationIconSize.Size120:return O.convIconSizes.size120;case I.ConversationIconSize.Size160:return O.convIconSizes.size160;default:return O.convIconSizes.size40}}static _getFontSizeStyles(e,t){const s=Math.ceil(e/(e<=I.ConversationIconSize.Size40?3:4)),i=t+s;let n=L._cachedFontSizeStyles[i];return n||(n=o.Styles.createTextStyle({fontSize:s,font:S.default.font.uiDisplayBold,color:t||m.Color.white}),L._cachedFontSizeStyles[i]=n),[n]}_getIconFontColor(e,t,s){return e?t?m.Color.black:m.Color.white:s||m.Color.white}_getAvatarBorderColor(e){return e||(this.state.useAccessibleTheme?this.state.useDarkTheme?m.Color.gray100:m.Color.gray400:this.state.useDarkTheme?m.Color.whiteOverlay40:m.Color.blackOverlay10)}}L._cachedFontSizeStyles={},t.ConversationIcon=L,t.default=L},497036:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(906262),n=s(795691),r=s(210541),a=s(853374),l=s(292729),d=s(713873),c=s(731761),h=s(436237),u=s(746096),p=s(677381),g=s(31280),m=s(293194),S=s(257538),f=s(844285);class y extends p.default{constructor(){super(...arguments),this._getConfig=()=>({anchor:()=>this,positionPriorities:["bottom","right"],popupBeakSize:{width:0,height:0}}),this._getMenuItems=()=>(0,l.getCreateMenuItems)({hasSMS:this.state.hasSMS}),this._handleMenuCommand=e=>{const t=a.default.newCauseId();switch((0,h.log)(u.LogTraceArea.Navigation,`[CreateMenu] handle menu command, causeId: ${t}`),(0,h.track)(new d.HubPlusButtonEvent(e)),e){case S.MeetNowButtonActionCommands.CreateMeetNow:case S.MeetNowButtonActionCommands.JoinMeetNow:const t=e===S.MeetNowButtonActionCommands.CreateMeetNow?S.MeetNowOrigin.RecentChatsHubDesktop:S.MeetNowOrigin.JoinLobby;f.MeetNowHelpers.handleMeetNowActionMenuCommand(e,t);break;case l.ADD_CONVERSATION_MODERATED_GROUP_COMMAND:new c.default({navigationOrigin:u.NavigationConversationOrigin.NewModeratedGroup,peopleType:r.PeopleType.All,filterPeopleType:r.FilterType.GroupCapable}).start(this._getRootViewId());break;case l.ADD_CONVERSATION_GROUP_COMMAND:new c.default({navigationOrigin:u.NavigationConversationOrigin.NewGroup,peopleType:r.PeopleType.All,filterPeopleType:r.FilterType.GroupCapable}).start(this._getRootViewId());break;case l.ADD_CONVERSATION_1ON1_COMMAND:new c.default({creating1on1Conversation:!0,peopleType:r.PeopleType.All,filterPeopleType:r.FilterType.None,isSingleContactSelect:!0,navigationOrigin:u.NavigationConversationOrigin.NewChat,wizardSteps:[n.WizardSteps.setConvParticipants]}).start(this._getRootViewId());break;case l.ADD_CONVERSATION_PRIVATE_COMMAND:new c.default({creating1on1Conversation:!0,peopleType:r.PeopleType.AllExcludingBots,filterPeopleType:r.FilterType.None,isSingleContactSelect:!0,navigationOrigin:u.NavigationConversationOrigin.NewPrivateChat,wizardSteps:[n.WizardSteps.setConvParticipants]}).start(this._getRootViewId());break;case l.ADD_CELLULAR_SMS_CONVERSATION_COMMAND:new c.default({creating1on1Conversation:!0,peopleType:r.PeopleType.AllWithPhoneNumbers,filterPeopleType:r.FilterType.CallCapable,isSingleContactSelect:!0,navigationOrigin:u.NavigationConversationOrigin.NewChat,wizardSteps:[n.WizardSteps.setConvParticipants],createCellularSmsConversation:!0}).start(this._getRootViewId());case m.SXActionMenuCancel:}}}_buildState(){return{hasSMS:o.default.isPaidUser()}}render(){return(0,i.jsx)(g.ContextMenu,{id:"create_menu",variant:"flat",config:this._getConfig(),items:this._getMenuItems(),onCommand:this._handleMenuCommand,trigger:this.props.trigger})}}t.default=y},766970:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(281878),n=s(600212),r=s(711828),a=s(497036),l=s(489873),d=s(46375),c=s(480707),h=s(677381),u=s(27621),p=s(733754);function g({selectedFilter:e,onFilterChange:t}){const s=(0,l.useRecentFilterPills)(),{themeColors:{surfacePrimary:d,iconPrimary:c}}=(0,n.useSkypeTheme)();return(0,i.jsx)(o.Row,{children:(0,i.jsxs)(o.Row,Object.assign({flex:"1",paddingX:"4",paddingY:"1",height:"10",space:"2",justifyContent:"space-between",flexWrap:"nowrap",backgroundColor:d},{children:[(0,i.jsx)(o.SegmentedControl,{variant:"segmented",onSelectionChange:t,items:s,selectedId:e}),(0,i.jsx)(a.default,{trigger:e=>(0,i.jsx)(o.Button,{variant:"ghost",accessibilityLabel:(0,p.getString)("Hub.New1on1ChatLabel"),onPress:e,PrefixSlot:(0,r.getIcon)(r.SkypeIcon.Compose,r.IconSize.size20,c)})})]}))})}class m extends h.default{constructor(){super(...arguments),this._store=(0,d.getConversationsListStore)(),this._contentChannelsFREStore=new u.FRESuggestionsStore,this._handleFreDismiss=()=>{this._store.setFilterMode("all")},this._handleFilterChange=e=>{var t;this._store.setFilterMode(e),"channels"!==e||(null===(t=this._contentChannelsFREStore)||void 0===t?void 0:t.isCompleted())||0!==this._store.getShownConversations().length||(0,c.navigateToChannelsFRE)(this._getRootViewId(),this._handleFreDismiss)}}_buildState(){return{selectedFilter:this._store.getFilterMode()}}render(){return(0,i.jsx)(g,{selectedFilter:this.state.selectedFilter,onFilterChange:this._handleFilterChange})}}t.default=m},518190:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RecentsActionBar=void 0;var i=s(766970);Object.defineProperty(t,"RecentsActionBar",{enumerable:!0,get:function(){return i.default}})},577926:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(915877),r=s(24576),a=(0,n.lazyProperties)({container:()=>o.Styles.createButtonStyle({overflow:"visible",height:8,alignItems:"center",justifyContent:"center"}),divider:()=>o.Styles.createViewStyle({height:1,alignSelf:"stretch"})});class l extends r.default{render(){let e;return this.props.suppressBaseDivider||(e=(0,i.jsx)(o.View,{style:[a.divider,this._themeStyles.dividerColorStyle]})),(0,i.jsx)(o.View,Object.assign({style:[a.container,this.props.style],ignorePointerEvents:!0},{children:e}))}}t.default=l},154464:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationsListItem=void 0;const i=s(785893),o=s(496486),n=s(477517),r=s(967593),a=s(516778),l=s(281878),d=s(244770),c=s(994224),h=s(536699),u=s(164723),p=s(560787),g=s(220187),m=s(37034),S=s(805581),f=s(598925),y=s(480200),v=s(741660),C=s(273145),_=s(77605),b=s(403782),T=s(913944),M=s(110117),I=s(293194),w=s(22222),P=s(656810),k=s(619675),A=s(31280),x=s(451072),R=s(607499),O=s(680837),L=s(24576),F=s(679481),B=(s(219784),s(388117)),D=s(80468),E=s(734537),V=s(18078),N=s(954543),U=s(318743),j=s(865788),H=s(901246),z=s(735370),W=s(47447),G=s(311010),K=s(886045),q=s(889391),Q=s(360305),X=s(878364),$=s(104735),J=s(952262),Y=s(89808),Z=s(178735),ee=s(46929),te=s(330124),se=s(827357),ie=s(816402),oe=s(436237),ne=s(733754),re=s(10909),ae=s(914976),le=s(898278),de=s(746096),ce=s(793003),he=s(581760),ue=s(711828),pe=s(1706),ge=s(338173),me=s(417826),Se=s(871664),fe=s(846116),ye=s(473600),ve=s(314572),Ce=s(866127),_e=s(603088),be=s(366355),Te=s(702301),Me=s(234196),Ie=s(204381),we=s(312381),Pe=s(380622),ke=s(62781),Ae=s(286259),xe=s(400984),Re=s(899686),Oe=s(721788),Le=s(172758),Fe=s(567977),Be=s(211375),De=s(915877),Ee=s(853374),Ve=s(861253),Ne=s(986374),Ue=s(351077),je=s(671830),He=s(422801),ze=s(476621),We=s(581697),Ge=s(871908),Ke=s(557102),qe=s(882261),Qe=s(103291),Xe=s(153338),$e=s(926459),Je=s(125793),Ye=s(700842),Ze=s(475760),et=s(331751),tt=s(820770),st=s(539549),it=s(341706),ot=s(423353),nt=s(106658),rt=s(61375),at=s(770891),lt=s(822854),dt=s(723752),ct=s(637324),ht=s(429791),ut=s(891114),pt=s(882052),gt=s(502278),mt=s(512952),St=s(436303),ft=s(480707),yt=nt.messageTextLineHeight,vt=ue.IconSize.size16,Ct=ue.IconSize.size10,_t=ue.IconSize.size12,bt=ue.IconSize.size20,Tt=(0,De.lazyProperties)({row:()=>a.Styles.createViewStyle({flexDirection:"row"}),noLeftPadding:()=>a.Styles.createViewStyle({paddingLeft:0}),listItemWrapper:()=>a.Styles.createViewStyle({overflow:"visible",backgroundColor:he.Color.transparent}),listItemBaseForChats:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),listItemBaseForBing:()=>a.Styles.createViewStyle({flexDirection:"column",justifyContent:"center"}),listItemBase:()=>a.Styles.createViewStyle({flex:1,paddingTop:10,paddingBottom:10,overflow:"visible"}),listItemBaseHorizontalPaddingClassic:()=>a.Styles.createViewStyle({paddingLeft:le.RowPaddingClassic.left,paddingRight:le.RowPaddingClassic.right,paddingBottom:le.RowPaddingClassic.bottom,paddingTop:le.RowPaddingClassic.top}),listItemBaseHorizontalPaddingModernize:()=>a.Styles.createViewStyle({paddingLeft:le.RowPaddingModernize.leftDesktop,paddingRight:le.RowPaddingModernize.rightDesktop,paddingBottom:le.RowPaddingModernize.bottom,paddingTop:le.RowPaddingModernize.top}),listItemBaseHorizontalPaddingModernizeMobile:()=>a.Styles.createViewStyle({paddingLeft:le.RowPaddingModernize.left,paddingRight:le.RowPaddingModernize.right}),listItemSmall:()=>a.Styles.createViewStyle({paddingTop:6,paddingBottom:8}),modernizedListItemSmall:()=>a.Styles.createViewStyle({paddingTop:6,paddingBottom:6}),listItemCompact:()=>a.Styles.createViewStyle({paddingTop:0,paddingBottom:0}),infoSection:()=>a.Styles.createViewStyle({alignItems:"flex-end",alignSelf:"stretch",marginLeft:4,marginTop:10}),linkText:()=>a.Styles.createTextStyle({flex:-1,fontSize:G.default.controlFontSize.cardTitle,marginBottom:3}),linkTextUnreadSelected:()=>a.Styles.createTextStyle({font:G.default.font.uiDisplayBold}),accessoryIcon:()=>a.Styles.createTextStyle({alignSelf:"flex-end",marginLeft:4}),accessoryIconMobile:()=>a.Styles.createViewStyle({alignItems:"center",justifyContent:"center",marginTop:4}),accessoryIconMobileCompact:()=>a.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),lastMessageTimeText:()=>a.Styles.createTextInputStyle({marginVertical:5}),lastMessageText:()=>a.Styles.createTextStyle({flex:1,lineHeight:yt}),infoSectionRN:()=>a.Styles.createViewStyle({paddingTop:5,marginTop:0}),cardContentBase:()=>a.Styles.createViewStyle({flex:1,alignItems:"flex-start",alignSelf:"stretch",justifyContent:"center"}),cardContentCompact:()=>a.Styles.createViewStyle({marginLeft:10}),cardContentSmall:()=>a.Styles.createViewStyle({marginLeft:12}),displayName:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),displayNameBase:()=>a.Styles.createViewStyle({alignSelf:"stretch",paddingRight:6}),lastMessageAccessoryIcon:()=>a.Styles.createViewStyle({flexShrink:0,flexGrow:0,paddingRight:4,paddingTop:3,height:yt}),lastMessageContainer:()=>a.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",alignItems:"center",overflow:"visible",flex:1}),lastMessageContainerWeb:()=>a.Styles.createViewStyle({height:yt,overflow:"hidden"}),typingIndicatorContainer:()=>a.Styles.createViewStyle({paddingVertical:2,height:22}),callButtonsContainer:()=>a.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",overflow:"visible"}),joinButtonStyle:()=>a.Styles.createViewStyle({marginRight:-5,overflow:"visible"}),joinButtonStyleModernize:()=>a.Styles.createViewStyle({overflow:"visible"}),endCallControls:()=>a.Styles.createViewStyle({marginRight:-5}),endCallControlsModernize:()=>a.Styles.createViewStyle({}),optionalButton:()=>a.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10,backgroundColor:he.Color.transparent}),optionalAccessoryButton:()=>a.Styles.createViewStyle({alignItems:"center",marginLeft:15,backgroundColor:he.Color.transparent}),badgeView:()=>a.Styles.createViewStyle({marginLeft:4}),categoryIconView:()=>a.Styles.createViewStyle({marginLeft:4}),categoryIconViewCompact:()=>a.Styles.createViewStyle({marginLeft:9}),categoryIconViewCommon:()=>a.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),staticDivider:()=>a.Styles.createViewStyle({height:1,bottom:0,alignSelf:"stretch"}),indicatorImage:()=>a.Styles.createImageStyle({width:30,height:15}),inlineIndicatorImage:()=>a.Styles.createImageStyle({position:"absolute",top:4}),compositeNav:()=>(0,De.lazyProperties)({listItemBase:()=>a.Styles.createViewStyle({paddingTop:0,paddingBottom:3}),listItemBaseHorizontalPaddingClassic:()=>a.Styles.createViewStyle({paddingLeft:le.RowPaddingClassic.leftDesktop,paddingRight:le.RowPaddingClassic.rightDesktop}),listItemBaseHorizontalPaddingModernize:()=>a.Styles.createViewStyle({paddingLeft:le.RowPaddingModernize.leftDesktop,paddingRight:le.RowPaddingModernize.rightDesktop}),listItemBaseCompact:()=>a.Styles.createViewStyle({paddingTop:0,paddingBottom:0}),listItemBaseCompactHorizontalPaddingClassic:()=>a.Styles.createViewStyle({paddingLeft:le.RowPaddingClassic.leftDesktop,paddingRight:le.RowPaddingClassic.rightDesktop}),listItemBaseCompactHorizontalPaddingModernize:()=>a.Styles.createViewStyle({paddingLeft:le.RowPaddingModernize.leftDesktop,paddingRight:le.RowPaddingModernize.rightDesktop}),infoSectionExtraPadding:()=>a.Styles.createViewStyle({marginTop:6}),infoSectionLeftNav:()=>a.Styles.createViewStyle({marginTop:4}),infoSectionCompact:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",overflow:"visible"}),accessoryViewCompact:()=>a.Styles.createViewStyle({marginLeft:5,overflow:"visible"}),linkText:()=>a.Styles.createTextStyle({fontSize:G.default.controlFontSize.body,font:G.default.font.uiDisplayRegular,marginBottom:0}),linkTextExtraCompact:()=>a.Styles.createTextStyle({fontSize:G.default.controlFontSize.bodySmallDeprecated}),inlineText:()=>a.Styles.createTextStyle({fontSize:G.default.controlFontSize.body,lineHeight:19}),accessoryIcon:()=>a.Styles.createTextStyle({marginTop:2}),itemDivider:()=>a.Styles.createViewStyle({left:55,right:15,bottom:-13,height:27,marginRight:0}),itemDividerCompact:()=>a.Styles.createViewStyle({left:40,right:15,bottom:-13,height:27,marginRight:0}),lastMessageTimeText:()=>a.Styles.createTextInputStyle({marginVertical:6}),darkThemeRead:()=>a.Styles.createViewStyle({opacity:.8}),lastMessageText:()=>a.Styles.createTextStyle({fontSize:G.default.controlFontSize.body})}),itemDivider:()=>a.Styles.createViewStyle({position:"absolute",left:85,right:0,bottom:-3,marginRight:15,alignItems:"stretch",overflow:"visible"}),itemDividerSmall:()=>a.Styles.createViewStyle({left:82,marginRight:10}),itemDividerCompact:()=>a.Styles.createViewStyle({left:60,marginRight:10}),itemDividerInner:()=>a.Styles.createViewStyle({flex:1,overflow:"visible"}),itemDividerInnerCompositveNavShort:()=>a.Styles.createViewStyle({bottom:4,marginRight:80,overflow:"hidden"}),itemDividerInnerCompositveNav:()=>a.Styles.createViewStyle({bottom:4}),cardContent:()=>a.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch"}),errorSymbolContainer:()=>a.Styles.createViewStyle({alignItems:"center",justifyContent:"center",marginBottom:2,width:vt+6,height:vt}),errorSymbol:()=>a.Styles.createViewStyle({paddingRight:6}),reducedHighlight:()=>a.Styles.createViewStyle({opacity:.5}),swipeActionsBackground:()=>a.Styles.createViewStyle({top:-.5,bottom:1}),userPresenceIndicator:()=>a.Styles.createViewStyle({width:Ct,height:Ct,borderRadius:Ct/2,marginHorizontal:1,marginLeft:5}),modernizeUserPresenceIndicator:()=>a.Styles.createViewStyle({width:Ct,height:Ct,borderRadius:Ct/2,marginHorizontal:5}),mobileCertifiedIconWrapper:()=>a.Styles.createViewStyle({position:"relative",bottom:1}),bingIconForCompactView:()=>a.Styles.createViewStyle({justifyContent:"center"})});class Mt extends L.default{constructor(){super(...arguments),this._cardContentAndDividerTransformValue=new a.Animated.Value(0),this._cardContentOpacityValue=new a.Animated.Value(1),this._conversationSwipeActionForCommand=e=>{const t=ct.default.conversationSwipeActionForCommand(e,this.props.conversationId,this._currentTheme,this._useCompactLayout(),this._onHandleMoreMenuCommand);return t&&(t.backgroundColor=this._getContext().themeColors.surfaceInteractive,t.iconColor=this._getContext().themeColors.iconOnColor),t},this._onDropStarted=()=>{const e=this._container;if(!e)return;if(!this.state.allUserConversations||0===this.state.allUserConversations.length)return void e.onDragDropContinue(this.props.conversationId);const t=Ke.ConversationUtils.getConversationForGivenType(this.state.allUserConversations,ot.ConversationUIType.OneOnOneSkype),s=Ke.ConversationUtils.getConversationForGivenType(this.state.allUserConversations,ot.ConversationUIType.Private),i=t&&t.id;s&&s.id;i&&e.onDragDropContinue(i)},this._containerRefCallback=e=>{this._container=e||void 0},this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHovering:!1})},this._onAccessibilityAction=e=>{const t=e.nativeEvent;if(t&&!o.isEmpty(t.actionName)){const e=o.filter(this._getMoreMenuItems().items,(e=>(0,Ve.default)(e.text,t.actionName)));this._onHandleMoreMenuCommand(e[0].command)}},this._onHandleContextMenu=e=>{C.default.showContextMenu(e,this._getRootViewId(),{getMenuGroups:this._getContextMenuGroups,onItemSelected:this._onHandleMoreMenuCommand})},this._onHandleLongPress=e=>{0},this._onArchiveConversation=()=>{R.default.showIfRequired(this._getRootViewId()).then((()=>{this._archiveConversation()}))},this._getContextMenuGroups=()=>ct.default.getMenuSections(Object.assign({},this._getMenuItems())),this._onHandleMoreMenuCommand=e=>{const t=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"ConversationsListItem._onHandleMoreMenuCommand, conversationId: "+ae.mriOrId(this.props.conversationId)+", command: "+e+", causeId: "+t);const s=je.isOneOnOneConversation(this.props.conversationId)&&q.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations&&!je.isMyBotConversation(this.props.conversationId);switch(e){case ct.ConversationCommands.AudioCall:this._startCall(f.StartCallOrMaybePromptUserIntent.Audio,t);break;case ct.ConversationCommands.Call:this._startCall(f.StartCallOrMaybePromptUserIntent.Generic,t);break;case ct.ConversationCommands.ManageGroup:$.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:t});break;case ct.ConversationCommands.CopyLink:ye.default.getConversationJoinLink(this.props.conversationId).then((e=>{we.default.shareToClipboard(e),this._sendConfiramtionToast(ne.getString("MeetNow.LinkCopied")),this._trackMeetNowClick(u.MeetNowClickType.ClickCopyLink)})).fail((()=>{this._sendConfiramtionToast(ne.getString("MeetNow.GenericErrorTitle")),this._trackMeetNowClick(u.MeetNowClickType.CopyLinkFailed)}));break;case ct.ConversationCommands.Profile:$.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:t});break;case ct.ConversationCommands.Favorite:s?et.default.addToFavorites(this.props.conversationId):ke.default.addConversation(this.props.conversationId);break;case ct.ConversationCommands.Unfavorite:s?et.default.removeFromFavorites(this.props.conversationId):ke.default.removeConversation(this.props.conversationId);break;case ct.ConversationCommands.MagicBotPin:(0,fe.pinMagicBotConvListTop)();break;case ct.ConversationCommands.MagicBotUnpin:(0,fe.unpinMagicBotConvListTop)();break;case ct.ConversationCommands.LeaveConversation:this._handleLeaveConversation();break;case ct.ConversationCommands.ClearConversation:case ct.ConversationCommands.DeleteConversation:(0,X.deleteConversationGroup)(this.props.conversationId,(()=>this._container),this.context,"ConversationListItem",rt.DeleteConversationSource.ConversationListItem);break;case ct.ConversationCommands.MarkRead:s?et.default.markGroupAsRead(this.props.conversationId):Ge.markConversationRead(this.props.conversationId);break;case ct.ConversationCommands.MarkUnread:Ge.markMessageUnread(this.props.conversationId);break;case ct.ConversationCommands.AddBotToContacts:ge.default.addAgentAsContact(je.stripMriNamespace(this.props.conversationId)).then((()=>{ze.default.ensureConversationLoadedOrFaked(this.props.conversationId).then((()=>{$.default.navigateToConversation({convId:this.props.conversationId,origin:de.NavigationConversationOrigin.Recents,causeId:t,isNewConversation:!0})}))}));break;case ct.ConversationCommands.DeleteBotFromContacts:(0,X.deleteConversation)(this.props.conversationId,(()=>this._container),this.context,"ConversationListItem",rt.DeleteConversationSource.ConversationListItem);break;case ct.ConversationCommands.BlockContact:const e={mriToBlock:this.state.otherPartyMri||this.props.conversationId,rootViewId:this._getRootViewId(),reportContext:de.ReportContextListOptions.BlockContact,isBlockingDialog:!0},o={onCancelPress:void 0};$.default.navigateToReportConcernModal(e,o,rt.BlockConversationSource.ConversationListItem);break;case ct.ConversationCommands.Unblock:const n=this.state.otherPartyMri||this.props.conversationId;this.state.isOneOnOne&&this.state.isRecipientBlocked&&xe.default.unblockContact(n,rt.BlockConversationSource.ConversationListItem).then((()=>{(0,fe.isMagicBotConversation)(n)&&Se.default.giveConsent()}));break;case ct.ConversationCommands.Archive:this._onArchiveConversation();break;case ct.ConversationCommands.Unarchive:this._intOnUnarchiveConversation(t);break;case ct.ConversationCommands.More:this._onHandleLongPress();break;case ct.ConversationCommands.Mute:He.default.setConversationSubscription(this.props.conversationId,je.SubscriptionTypes.Muted).then((()=>{oe.track(new H.ChatNotificationsToggleSetting(!1,void 0,this.props.conversationId,je.SubscriptionTypes.Muted,be.NotificationsSource.ConversationListItem,i))}));break;case ct.ConversationCommands.Unmute:He.default.setConversationSubscription(this.props.conversationId,"").then((()=>{oe.track(new H.ChatNotificationsToggleSetting(!0,void 0,this.props.conversationId,"",be.NotificationsSource.ConversationListItem,i))}));break;case St.ContentChannelsCommands.Unfollow:(0,ft.handleUnfollow)(this.props.conversationId);case I.SXActionMenuCancel:}const i=z.getConversationTypeForTelemetry(this.props.conversationId);oe.track(new ut.ConversationListItemClicked(this.props.conversationId,e,void 0,i))},this._requestFocusWithDelay=()=>{o.delay((()=>{this.isComponentMounted()&&this.requestFocus()}),200)},this._onMarkConversationUnread=()=>{this.isComponentMounted()&&this.setState({markAsUnreadShowUnreadCount:!0})},this._archiveConversation=()=>{const e=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"_archiveConversation, causeId: "+e),Ge.setConversationSubscription(this.props.conversationId,je.SubscriptionTypes.Muted),Xe.default.archiveConversation(this.props.conversationId,de.ArchiveConversationOrigin.ContextMenu,this._getRootViewId()),$.default.navigateAfterArchivingConversation(this.props.conversationId,e,this._getContext())},this._unarchiveConversation=()=>{const e=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"_unarchiveConversation, causeId: "+e),Ge.setConversationSubscription(this.props.conversationId,je.SubscriptionTypes.Normal),Xe.default.unarchiveConversation(this.props.conversationId,de.UnarchiveConversationOrigin.ContextMenu)},this._onCallButtonPress=e=>{e.stopPropagation();const t=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"_onCallButtonPress, causeId: "+t),this._startCall(f.StartCallOrMaybePromptUserIntent.Audio,t)},this._onVideoCallButtonPress=e=>{e.stopPropagation();const t=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"_onVideoCallButtonPress, causeId: "+t),this._startCall(f.StartCallOrMaybePromptUserIntent.Video,t)},this._onJoinCallButtonPress=e=>{e.stopPropagation();const t=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"_onJoinCallButtonPress, causeId: "+t),this._startCall(f.StartCallOrMaybePromptUserIntent.Generic,t)},this._onEndCallButtonPress=e=>{if(e.stopPropagation(),this.state.callId){const e=Ee.default.newCauseId();gt.default.trackHangUpButtonClick(this.state.callId,e),new g.EndCallCommand(this.state.callId).execute()}},this._onConversationAudioButtonRef=e=>{this._conversationAudioButtonRef=e||void 0},this._onDragStartContact=e=>{Qe.default.addDragAndDropContactInformation(e,this.state.ownerConversationId,this.state.conversationDisplayName,N.DragOrigin.RecentConversations)},this._onPress=e=>{this._completeOnPress(this.props.origin)},this._completeOnPress=e=>{const t=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"ConversationsListItem._onPress, causeId: "+t),a.UserInterface.isNavigatingWithKeyboard()&&K.default.maybeAnnounceForAccessibility(ne.getString("Global.EnteringChatAnnouncement",{chatName:this.state.conversationDisplayName})),this.props.isSelected?a.UserInterface.isNavigatingWithKeyboard()&&Be.setFocus(Be.FocusEvent.RefreshConversation):!this.state.isUsingStackNav&&this.state.callId&&this.state.hasActiveCall&&this.state.activeCallStatus===y.ActiveCallStatus.Connected?c.default.CallNavigationHelper.rejoinCall(this.props.conversationId,this.state.callId,t,de.NavigationCallOrigin.ConversationListItem,!0):$.default.navigateToConversation({convId:this.props.conversationId,origin:e,causeId:t}),mt.default.setShowMyBotFloatToolTip(!1)}}_buildState(e,t){const{enableMagicBot:s,enableGroupedConversations:i,enableMediaPreviewDrafts:n,enableMagicBotSuggestionsOnChatListPanel:r,hideConversationsListSectionHeaders:a,enableConversationsCategoriesIcon:l,enableMagicBotChatlistSuggestionsDebouncing:d,magicBotSuggestionshDebounceTimeout:h}=q.default.getS4LMessagingFeatures(),{enableJoinerCallPreview:u,enableMessageTranslation:p,twinCamEnabled:g}=q.default.getS4LCMCFeatures(),m=Ze.default.getMessageCountsForConversation(e.conversationId,!0),f=(0,st.default)(),C=f.getConversation(e.conversationId);C||oe.warn(de.LogTraceArea.ConversationsListItem,"ConversationsListItem: _buildState, conversation "+ae.mriOrId(e.conversationId)+" doesn't exist");const _=!!C&&C.isOneOnOne(),b=_&&C?C.getOtherPartyMri():void 0;let T;C&&this._shouldDisplayLastMessage(C)&&(T=f.getFakeLastMessageFallback(e.conversationId)||C.lastMessage);const M=Ye.default.getComposingUsers(e.conversationId),I=te.default.isUsingStackNavigationContext(),w=this.props,P=Re.default.isCurrentUserActive();let k=!!this.state&&this.state.markAsUnreadShowUnreadCount;this.state&&this.state.markAsUnreadShowUnreadCount&&(!e.isSelected&&w.isSelected||this.state.unreadCount>0&&0===m.unreadCount)&&(k=!1);const A=t||!e.isSelected||this.state.displayedUnreadCount||!P||k,x=je.isMyBotConversation(e.conversationId),R=_&&i&&!x?et.default.isGroupMarkedAsFavorite(e.conversationId):!!C&&C.isFavorite(),O=je.isEncryptedThread(e.conversationId),L=b||e.conversationId,F=Le.default.getConversationOwner(L),B=J.default.getDisplayName(F)||"",D=J.default.getShortDisplayName(F)||"",V=b?Pe.getCustomStatusFromMri(b):void 0,N=T&&T.hasAlbumId()&&!T.isSendRejected(),U=_e.default.getDraftPreviews(e.conversationId),j=q.default.getEngagementFeatures().conciergeBotSettings.enableVisibility&&je.isConciergeBotMri(e.conversationId),H=!!b&&je.isAgent(b),z=Ce.default.canModernizeConversationList(),W=pt.default.shouldShowCategories(),G={conversationTimestamp:this._getConversationTimestamp(C,n),conversationLastMessage:T,conversationDisplayName:B,conversationShortDisplayName:D,colorInfo:Y.default.getColorInfo(),isFavorite:R,isMuted:!!C&&C.isMuted(),markAsUnreadShowUnreadCount:k,highPriorityUnreadCount:m.highPriorityUnreadCount,unreadCount:m.unreadCount,displayedUnreadCount:A?m.unreadCount:0,unreadCountOverflowed:m.unreadCountOverflowed,isMriAContact:!!b&&xe.default.isContact(Le.default.getConversationOwner(b)),isMriAnAgent:H,isEngagementBot:j,isMyBot:x,isJoinEnabled:null==C?void 0:C.isJoinEnabled(),isCallingAllowed:c.default.CallNavigationHelper.isCallingAllowed(e.conversationId),isRecipientBlocked:f.isConversationBlocked(C),isEncrypted:O,isTeamsUser:je.isS4BBridgeMri(e.conversationId),isNewsChannel:(0,v.isContentChannel)(C),isNewsBot:(0,v.isTodayBot)(null==C?void 0:C.id),useMobileUI:I||!z&&Q.default.isTabletUI(),otherPartyMri:b,isUsingStackNav:I,isOneOnOne:_,iOSAccessibilityActionEnabled:!1,addAccessibilityHint:!0,enableJoinerCallPreview:u&&je.isGroupConversation(e.conversationId),isLastMessageCallEvent:T&&Ue.isCallMessageType(T),displayBlockButton:C&&this._shouldDisplayBlockOption(C),allUserConversations:et.default.getDisplayableConversationsForUser(F),ownerConversationId:F,isArchived:!!C&&C.isArchived(),draft:tt.default.getSavedMessageInput(e.conversationId),mood:V&&V.mood,moodEmoticonType:V&&V.moodEmoticonType,moodEmoticonTone:V&&V.moodEmoticonTone,moodAccessibilityLabel:V&&V.mood&&V.moodEmoticonType&&Pe.getAccessibilityTitle(V.mood),enableMediaPreviewDrafts:n,mediaDraft:o.first(U),isLastMessageFromAlbum:N,isTranslated:p&&S.default.isConversationTranslated(e.conversationId),lastMessageAuthorAvatarSwitchedOn:Z.default.getLastMessageAuthorAvatarSwitchedOn(),alwaysNavigateToLobby:null==C?void 0:C.isGroupConversation(),isTrustedAgent:H&&pe.default.isTrustedAgent(e.conversationId),modernizeConversationList:z,isStackNavAndNotArchived:I&&!(null==C?void 0:C.isArchived()),badgeColorStyle:E.default.getBadgeColorStyle(),enableMagicBot:s,magicBotUnpin:!!(0,fe.isMagicBotConversation)(e.conversationId)&&ee.default.getMagicBotConvListUnpin(),enableMagicBotSuggestions:r&&(0,fe.isMagicBotConversation)(e.conversationId),hideConversationsListSectionHeaders:a,enableConversationsCategoriesIcon:l,showCategories:W,enableMagicBotChatlistSuggestionsDebouncing:d,magicBotSuggestionshDebounceTimeout:h,fakeDraftMessage:void 0};if(G.draft?G.fakeDraftMessage=qe.createFakeDraftMessage(e.conversationId,G.draft):G.enableMediaPreviewDrafts&&G.mediaDraft&&(G.fakeDraftMessage=qe.createFakeMediaDraftMessage(e.conversationId,G.mediaDraft,_e.default.getDraftPreviewTimestamp(e.conversationId))),b)if(je.isMriWithUserMetadata(b)&&xe.default.isConversationAccepted(e.conversationId))G.mriForUserPresence=b;else{const e=o.find(G.allUserConversations,(e=>je.isMriWithUserMetadata(e.id)&&xe.default.isConversationAccepted(e.id)));e&&(G.mriForUserPresence=e.id)}this._activityIndicatorOffset=G.useMobileUI?-25:-22,C&&C.isThread()&&We.default.prioritizeConversation(C.id,!1,!0);const K=c.default.ActiveCallUIHelper.getActiveCallId(e.conversationId);G.callId=K,G.showTwinCam=!!K&&(g&&c.default.CallingStore.getConnectedEndpoints(K).length>0),G.hasActiveCall=c.default.ActiveCallUIHelper.hasActiveCall(e.conversationId),G.allowOutboundVideo=c.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:c.default.CallingStore.isPSTNCallWithNullCheck(G.callId,e.conversationId),isEncryptedCall:O,conversationMri:e.conversationId}),G.activeCallStatus=c.default.ActiveCallUIHelper.activeCallStatus(e.conversationId),G.activeCallDuration=this._getCallDuration(G.callId);const X=t||e.conversationId!==w.conversationId,$=!o.isEmpty(M);if(X&&(G.isHovering=!1),G.conversationLastMessage?(t||G.conversationLastMessage!==this.state.conversationLastMessage)&&(this._cachedLastMessageLabel=this._getLastMessageAccessibilityLabel(G.conversationLastMessage)):this._cachedLastMessageLabel="",G.allUserConversations){const e=Ke.ConversationUtils.getConversationForGivenType(G.allUserConversations,ot.ConversationUIType.Private);G.isPrivateConversationHandshakeCompleted=!!e&&it.default.getHandshakeState(e.id)===Je.SecureHandshakeState.Completed}if(G.showTypingState=!e.isSelected&&!G.isMuted&&$&&(!G.isEncrypted||it.default.getHandshakeState(e.conversationId)===Je.SecureHandshakeState.Completed),C&&e.conversationId===w.conversationId&&this.state&&G.unreadCount&&G.unreadCount>this.state.unreadCount&&$e.default.setPreviousConsumptionHorizon(e.conversationId,C.getConsumptionHorizon()),G.mriForUserPresence){G.statusTypes=Ae.contactAllowedStatuses();let t=Oe.default.getUserStatusWithOptions(G.mriForUserPresence,G.statusTypes);t&&(t=Ae.maskedUserStatus(t)),G.userPresence=o.clone(Oe.default.getCachedUserPresence(G.mriForUserPresence)),G.userStatus=e.rowSize===ce.RowSize.ExtraCompact?t:void 0}else G.statusTypes=void 0,G.userStatus=void 0;return G.shouldRenderJoinButtonForActiveCall=G.enableJoinerCallPreview&&G.hasActiveCall&&G.activeCallStatus!==y.ActiveCallStatus.Connected&&!(G.callId&&c.default.CallingStore.isCallIncoming(G.callId)),G}componentWillUnmount(){super.componentWillUnmount(),this._onMarkConversationUnreadToken&&this._onMarkConversationUnreadToken.unsubscribe()}componentDidMount(){super.componentDidMount();const e=this._isTyping(this.props,this.state),t=this._indicatorInfo(e,this.state.hasActiveCall);this._cardContentAndDividerTransformValue.setValue(t.offset),this._cardContentOpacityValue.setValue(t.contentOpacity),this._onMarkConversationUnreadToken=$e.default.markConversationUnreadCallback(this.props.conversationId,this._onMarkConversationUnread),this.state.isMyBot&&this.state.isFavorite&&!Z.default.isMyBotTooltipVisibleNoSubscription()&&this.props.rowSize!==ce.RowSize.ExtraCompact&&mt.default.setMyBotItemReady()}_shouldComponentUpdate(e,t,s,i,o,n){return e?this.state.showTypingState!==s.showTypingState||this.state.hasActiveCall!==s.hasActiveCall||this.state.unreadCount!==s.unreadCount||this.state.conversationLastMessage!==s.conversationLastMessage:super._shouldComponentUpdate(e,t,s,i,o,n)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._pauseWhenNotVisible()||this._intComponentDidUpdate(e,t)}_componentDidUpdate(e,t,s){super._componentDidUpdate(e,t,s),this._intComponentDidUpdate(e,t)}_getCallDuration(e){return e?c.default.CallDurationStore.getCallDurationInSeconds(e):0}_intComponentDidUpdate(e,t){const s=this._isTyping(this.props,this.state),i=this._isTyping(e,t),o=this._indicatorInfo(s,this.state.hasActiveCall);this._cardContentAndDividerTransformValue.setValue(o.offset),s===i&&this.state.hasActiveCall===t.hasActiveCall||(this._cardContentAndDividerAnimation&&this._cardContentAndDividerAnimation.stop(),this._cardContentAndDividerAnimation=a.Animated.parallel([a.Animated.timing(this._cardContentAndDividerTransformValue,{toValue:o.offset,duration:150,easing:a.Animated.Easing.Out()}),a.Animated.timing(this._cardContentOpacityValue,{toValue:o.contentOpacity,duration:200,delay:o.contentOpacity?100:0,easing:a.Animated.Easing.Out()})]),this._cardContentAndDividerAnimation.start())}_indicatorInfo(e,t){return e&&!t?{offset:this._activityIndicatorOffset,contentOpacity:0}:t&&!this._useCompactLayout()&&this._isPresentedInDesktopLeftNav()?{offset:-8,contentOpacity:0}:{offset:0,contentOpacity:1}}_renderDivider(e){if(this.state.isStackNavAndNotArchived||this._isPresentedInDesktopLeftNav()||this.state.modernizeConversationList&&this._isPresentedInTabletLeftNav())return;const t=this._useCompactLayout(),s=[Tt.itemDivider],o=[Tt.itemDividerInner];return this.state.useMobileUI?s.push(t?Tt.itemDividerCompact:Tt.itemDividerSmall):(t?s.push(Tt.compositeNav.itemDividerCompact):s.push(Tt.compositeNav.itemDivider),(this.state.hasActiveCall||e&&t)&&(this.state.shouldRenderJoinButtonForActiveCall?o.push(Tt.itemDividerInnerCompositveNavShort):o.push(Tt.itemDividerInnerCompositveNav))),(0,i.jsx)(a.View,{style:[s,Tt.staticDivider,this._themeStyles.dividerColorStyle]})}_renderMobileBackgroundView(){if(!this.state.isUsingStackNav&&(this.state.isHovering||this.props.isSelected)){const e=[O.default.absoluteFill],t=this._isPresentedInDesktopLeftNav();return this.state.modernizeConversationList&&(t||this._isPresentedInTabletLeftNav())||(e.push(this._backgroundColorStyles()),e.push(Tt.reducedHighlight)),(0,i.jsx)(a.View,{style:e,ignorePointerEvents:!0})}}_backgroundColorStyles(){if(!this.state.isUsingStackNav&&(this.state.isHovering||this.props.isSelected||this.state.modernizeConversationList)){const e=this._isPresentedInDesktopLeftNav(),t=[];return this.state.modernizeConversationList&&(e||this._isPresentedInTabletLeftNav())?t.push(E.default.getItemBackgroundStyle(this._useDarkTheme(),this.props.isSelected,this.state.isHovering,this._useAccessibleTheme(),this._themeStyles,this.state.colorInfo)):this.props.isSelected?t.push(e?this._themeStyles.secondaryRowHighlightViewStyle:this._themeStyles.rowHighlightViewStyle):this.state.isHovering&&t.push(e?this._themeStyles.secondaryRowHoverViewStyle:this._themeStyles.rowHoverViewStyle),(this.state.isHovering||this.props.isSelected)&&t.push(a.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimaryAccent},!1)),t}}_renderCallButtons(){return this.state.shouldRenderJoinButtonForActiveCall?this._renderJoinCallControls():this.state.activeCallStatus===y.ActiveCallStatus.Connected?this._renderEndCallControls():this._renderAcceptCallControls()}requestFocus(){this._container&&this._container.requestFocus()}_renderJoinCallControls(){const e={textColor:he.Color.white},t={buttonStyle:le.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:he.AgnosticGradientFillButtonColors.green,gradientDirection:r.GradientDirection.BOTTOM_RIGHT};return(0,i.jsx)(w.default,Object.assign({buttonSize:le.SXButtonSize.Small,style:this.state.modernizeConversationList?Tt.joinButtonStyleModernize:Tt.joinButtonStyle,title:ne.getString("CallBanner.JoinLiveCallMessage"),onPress:this._onJoinCallButtonPress,disabled:this._isJoinCallButtonDisabled(),buttonConfig:e},t))}_renderEndCallControls(){return(0,i.jsx)(a.View,Object.assign({style:[Tt.callButtonsContainer,this.state.modernizeConversationList?Tt.endCallControlsModernize:Tt.endCallControls]},{children:(0,i.jsx)(p.CallButton,{title:ne.getString("CallControls.CallButtonEndCall"),accessibilityLabel:ne.getString("CallControls.CallButtonEndCall"),onPress:this._onEndCallButtonPress,icon:ue.SkypeIcon.CallEnd,size:p.CallButtonSize.ExtraSmall,isToggledOn:!1,isCallEndButton:!0,backgroundStyle:p.CallButtonBackgroundStyle.Solid,spacing:p.CallButtonSpacing.None})}))}_renderAcceptCallControls(){const e=this._useCompactLayout()&&this.state.hasActiveCall,t=e&&!this.state.useMobileUI||this._isPresentedInDesktopLeftNav(),s=this._themeColors.iconHoverColor,o=this._themeColors.primaryIconColor,n=t?ue.IconSize.size16:ue.IconSize.size24,r=e||t?Tt.optionalAccessoryButton:Tt.optionalButton,l=this.state.activeCallStatus===y.ActiveCallStatus.OnHold,d=l?ne.getString("OngoingCall.OngoingCallOnHoldTitle"):ne.getString("CallControls.CallButtonAudioLabel",{conversationName:this.state.conversationDisplayName}),c=(0,i.jsx)(T.default,{ref:this._onConversationAudioButtonRef,size:n,onPress:this._onCallButtonPress,color:o,hoverColor:s,icon:this._getAcceptCallAudioButtonIcon(l),style:r,title:d,accessibilityLabel:d});if(this.state.allowOutboundVideo){const e=ne.getString("CallControls.CallButtonVideoLabel",{conversationName:this.state.conversationDisplayName}),t=(0,i.jsx)(T.default,{size:n,onPress:this._onVideoCallButtonPress,color:o,hoverColor:s,icon:ue.SkypeIcon.Video,style:r,title:e,accessibilityLabel:e});return(0,i.jsxs)(a.View,Object.assign({style:Tt.callButtonsContainer},{children:[t,c]}))}return c}_getAcceptCallAudioButtonIcon(e){return e?ue.SkypeIcon.Pause:this.state.isEncrypted?ue.SkypeIcon.PrivateCallFill:ue.SkypeIcon.CallStart}_getMessageContentOptions(e,t){const s=this._useAccessibleTheme()&&(this.state.isHovering||this.props.isSelected)?this._themeColors.textOnColor:this._themeColors.textPrimary;return{processing:at.ProcessingDefaults.Preview,renderMedia:!1,mediaPlaceholderIconColor:s,allowLargeEmoticons:!1,trimToFirstLine:!0,forceLayoutInRTL:!0,numberOfLines:1,textOverrideStyle:e,renderLocation:!0,forceStaticAnimatedEmoticons:!0,fontSize:this._themeColors.bubbleFontSize,allowTextFallbackEmoticons:!0,showPlaceholderEmoticons:!1,placeholderBackgroundColor:he.Color.transparent,atMentionStyle:e,atMentionMeOverrideStyle:e,renderSimpleAtMentions:!0}}render(){const e=this._useCompactLayout(),t=this._isTyping(this.props,this.state),s=this.state.displayedUnreadCount>0;let r,d;this._useCompactLayout()||(r=this._getOptionalLastMessageContent(t),this.state.hasActiveCall&&(d=this._renderCallButtons()));const c=this.state.iOSAccessibilityActionEnabled?o.map(this._getMoreMenuItems().items,(e=>({name:e.text,label:e.text}))):void 0,h=ct.default.getAccessibilityLabel({conversationDisplayName:this.state.conversationDisplayName,isOneOnOne:this.state.isOneOnOne,presence:this.state.userPresence,isRecipientBlocked:this.state.isRecipientBlocked,isFavorite:this.state.isFavorite,lastMessageLabel:this._cachedLastMessageLabel,lastMessageTime:this._getLastMessageTime(!0),hasActiveCall:this.state.hasActiveCall,activeCallStatus:this.state.activeCallStatus,isTyping:t,isMuted:this.state.isMuted,displayedUnreadCount:this.state.displayedUnreadCount,addAccessibilityHint:this.state.addAccessibilityHint,isSelected:this.props.isSelected,isAgent:je.isAgent(this.props.conversationId),moodAccessibilityLabel:this.state.moodAccessibilityLabel}),u=this._onHandleContextMenu;let p;const g=[Tt.listItemBase,this.state.enableMagicBotSuggestions?Tt.listItemBaseForBing:Tt.listItemBaseForChats,this.state.modernizeConversationList?Tt.listItemBaseHorizontalPaddingModernize:this.state.isStackNavAndNotArchived?Tt.listItemBaseHorizontalPaddingModernizeMobile:Tt.listItemBaseHorizontalPaddingClassic];this.state.useMobileUI?p=this._renderMobileBackgroundView():(g.push(e?Tt.compositeNav.listItemBaseCompact:Tt.compositeNav.listItemBase,this.state.modernizeConversationList?e?Tt.compositeNav.listItemBaseCompactHorizontalPaddingModernize:Tt.compositeNav.listItemBaseHorizontalPaddingModernize:e?Tt.compositeNav.listItemBaseCompactHorizontalPaddingClassic:Tt.compositeNav.listItemBaseHorizontalPaddingClassic,O.default.pointerCursor),g.push(this._backgroundColorStyles())),this.state.useMobileUI&&(this.state.modernizeConversationList&&g.push(this._backgroundColorStyles()),g.push(e?Tt.listItemCompact:this.state.isStackNavAndNotArchived?Tt.modernizedListItemSmall:Tt.listItemSmall));const m=this._getItemHeightStyle();m&&g.push(m);const S=this._isDraggable(),f=ct.default.rowDecorator({conversationId:this.props.conversationId,useExtraCompactLayout:this.props.rowSize===ce.RowSize.ExtraCompact,userStatus:this.state.userStatus,hasActiveCall:this.state.hasActiveCall,isEncrypted:this.state.isEncrypted,isOneOnOne:this.state.isOneOnOne,isTranslated:this.state.isTranslated,isTeamsUser:this.state.isTeamsUser});let y;switch(f.type){case ct.RowDecoratorType.Avatar:y=this._renderIcon();break;case ct.RowDecoratorType.Icon:y=this._renderCompactDecoratorIcon(f.icon);break;case ct.RowDecoratorType.Status:y=o.isUndefined(this.state.userStatus)?this._renderCompactDecoratorSpacer():B.default.getPresenceIcon(this.state.userStatus,this.state.isStackNavAndNotArchived?Tt.modernizeUserPresenceIndicator:Tt.userPresenceIndicator,Ct,void 0,void 0);break;default:case ct.RowDecoratorType.None:y=this._renderCompactDecoratorSpacer()}const v=(0,i.jsx)(x.default.View,Object.assign({style:g,accessibilityTraits:[a.Types.AccessibilityTrait.Button,a.Types.AccessibilityTrait.MenuItem],accessibilityLabel:h,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,onPress:this._onPress,onLongPress:u,onContextMenu:u,activeOpacity:.7,importantForAccessibility:a.Types.ImportantForAccessibility.Yes},{children:this.state.enableMagicBotSuggestions?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(l.Row,{children:[p,y,this._renderConversationCard(r,s),this._renderInfoSection(),d,this._renderDivider(t)]}),this._renderSuggestionsForBing()]}):(0,i.jsxs)(i.Fragment,{children:[p,y,this._renderConversationCard(r,s),this._renderInfoSection(),d,this._renderDivider(t)]})}));let C;if(W.UICapabilities.dragAndDropSupported()&&this._allowsUpload())C=(0,i.jsx)(b.default,Object.assign({ref:this._containerRefCallback,style:Tt.listItemWrapper,origin:U.FilePickerOrigin.DragAndDropToRecentConversationsLists,conversationId:this.props.conversationId,onDragEnter:this._onHoverStart,onDragLeave:this._onHoverEnd,onDropStarted:this._onDropStarted,dropTargetSource:Qe.DropTargetOrigin.ConversationListItem},{children:S?(0,i.jsx)(n.DragDroppableView,Object.assign({style:Tt.listItemWrapper,useChildrenThumbnail:!0,useThumbnailExplicitMaxWidth:!0,onDragStart:this._onDragStartContact},{children:v})):v}));else{const e={accessibilityActions:c,onAccessibilityAction:c?this._onAccessibilityAction:void 0};if(this.props.enableSwipeActions){const t=ct.default.getSwipeActions(this.state.isArchived,this.state.hasActiveCall,this.state.displayedUnreadCount>0,this.state.isMuted,this.state.isNewsChannel),s=o.map(t.rightActions,this._conversationSwipeActionForCommand),n=t.leftActions?o.map(t.leftActions,this._conversationSwipeActionForCommand):void 0,r=[];t.overScrollRight&&r.push(P.SwipableItemActionSide.Right),t.overScrollLeft&&r.push(P.SwipableItemActionSide.Left),C=(0,i.jsx)(P.default,Object.assign({ref:this._containerRefCallback,itemId:this.props.conversationId,style:Tt.listItemWrapper,layoutType:P.SwipeActionLayout.Reveal,rightActions:o.compact(s),leftActions:o.compact(n),overscrollSides:r,onSwiping:this.props.onSwiping,dragThreshold:30,swipeDistanceThreshold:t.overScrollDistance,backgroundStyle:Tt.swipeActionsBackground,numberOfLines:2},e,{children:v}))}else C=(0,i.jsx)(a.View,Object.assign({ref:this._containerRefCallback,style:Tt.listItemWrapper},e,{children:v}))}return C}_getOptionalLastMessageContent(e){let t;const s=this._themeColors.secondaryTextColor,o=[Tt.lastMessageContainer];o.push(Tt.lastMessageContainerWeb);const n=[G.default.fontStyle.body,Tt.lastMessageText,this._useDarkTheme()?this._themeStyles.secondaryTextColorStyle:this._themeStyles.primaryTextColorStyle];if(this.state.useMobileUI||n.push([Tt.compositeNav.lastMessageText,this._themeStyles.secondaryTextColorStyle]),this.state.modernizeConversationList&&n.push(E.default.getItemSubtitleTextStyle(this._useDarkTheme(),this.props.isSelected,this._useAccessibleTheme(),this._themeStyles)),this.state.isStackNavAndNotArchived&&n.push(E.default.getItemSubtitleTextStyle(this._useDarkTheme(),this.props.isSelected,this._useAccessibleTheme(),this._themeStyles,!0)),n.push(a.Styles.createTextStyle({color:this._refreshedPaletteAwareAccessibleTextColor(this._themeColors.textPrimary)},!1)),this.state.hasActiveCall){let e;this._isPresentedInDesktopLeftNav()||this.state.activeCallStatus===y.ActiveCallStatus.OnHold&&(e=ne.getString("CallPanel.OnHoldHeader")),this.state.activeCallStatus===y.ActiveCallStatus.Connected&&this.state.activeCallDuration>0&&(e=ie.default.getElapsedTimeStringFromS(this.state.activeCallDuration)),e&&(t=(0,i.jsx)(a.View,Object.assign({style:o},{children:(0,i.jsx)(a.Text,Object.assign({style:n,numberOfLines:1},{children:e}))})))}else if(e){o.push(Tt.typingIndicatorContainer);const e=this._renderNewTypingIndicator(Tt.indicatorImage,[Tt.inlineIndicatorImage,Tt.indicatorImage]);t=(0,i.jsxs)(a.View,Object.assign({style:o},{children:[(0,i.jsx)(a.Text,Object.assign({style:n,numberOfLines:1},{children:""})),e]}))}else if(this._canDisplayDraft()&&this.state.fakeDraftMessage){const e=this.state.isEncrypted?(0,i.jsx)(a.Text,Object.assign({style:n,numberOfLines:1},{children:ne.getString("MessageComposer.DraftDecorator")+" "+(q.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations?ne.getString("ConversationsListItem.PrivateMessage"):ne.getString("ConversationsListItem.PrivateConversationLabel"))})):(0,i.jsx)(dt.default,{message:this.state.fakeDraftMessage,options:this._getMessageContentOptions(n,s)});t=(0,i.jsx)(a.View,Object.assign({style:o},{children:e}))}else if(this.state.isEncrypted&&!this.state.isLastMessageCallEvent)t=(0,i.jsx)(a.View,Object.assign({style:o},{children:(0,i.jsx)(a.Text,Object.assign({style:n,numberOfLines:1},{children:q.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations?ne.getString("ConversationsListItem.PrivateMessage"):ne.getString("ConversationsListItem.PrivateConversationLabel")}))}));else if(this.state.conversationLastMessage){let e;if(this.state.isLastMessageFromAlbum)return(0,i.jsx)(a.View,Object.assign({style:o},{children:(0,i.jsx)(a.Text,Object.assign({style:n,numberOfLines:1},{children:ne.getString("ConversationsListItem.MediaAlbumItems")}))}));this.state.conversationLastMessage.isSendRejected()&&(e=(0,i.jsx)(a.View,Object.assign({style:Tt.errorSymbolContainer},{children:(0,i.jsx)(M.default,{icon:ue.SkypeIcon.Error,size:vt,color:this._themeColors.destructiveTextColor,style:Tt.errorSymbol})}))),t=(0,i.jsxs)(a.View,Object.assign({style:o},{children:[e,(0,i.jsx)(dt.default,{message:this.state.conversationLastMessage,options:this._getMessageContentOptions(n,s)})]}))}return t}_renderCompactDecoratorSpacer(){return(0,i.jsx)(a.View,{style:this.state.isStackNavAndNotArchived?Tt.modernizeUserPresenceIndicator:Tt.userPresenceIndicator})}_renderCompactDecoratorIcon(e){if(e)return(0,i.jsx)(M.default,{icon:e,size:this.state.isStackNavAndNotArchived?bt:_t,style:this.state.enableMagicBotSuggestions?Tt.bingIconForCompactView:void 0,color:this._useDarkTheme()?this._themeColors.secondaryTextColor:this._themeColors.primaryIconColor})}_triggerFileUpload(e){const t=this._container;t&&t.onDragDropContinue(e)}_allowsUpload(){if(this.state.allUserConversations&&this.state.allUserConversations.length>0){const e=Ke.ConversationUtils.getConversationForGivenType(this.state.allUserConversations,ot.ConversationUIType.OneOnOneSkype),t=Ke.ConversationUtils.getConversationForGivenType(this.state.allUserConversations,ot.ConversationUIType.Private);if(!e&&!t)return!1;if(t&&!e)return!1}return!0}_renderIcon(){var e;if(this.state.isNewsChannel)return(0,i.jsx)(A.ConversationAvatar,{id:this.props.conversationId,size:It(this.props.conversationIconSize)});let t;const s=this._isPresentedInDesktopLeftNav(),o=B.default.getIconSize(this.props.conversationIconSize),n=!this.state.isUsingStackNav&&this.props.isSelected,r=!n||s&&!this._useDarkTheme()?void 0:this._themeColors.primaryBackgroundColor,l=je.getHoverTitle(this.state.userPresence);let d;if(d=s?n?this._themeColors.secondaryRowHighlightColor:this._themeColors.secondaryBackgroundColor:n?this._themeColors.rowHighlightColor:this._themeColors.primaryBackgroundColor,this.state.isOneOnOne)t=(0,i.jsx)(Te.UserIcon,{userMri:this.state.otherPartyMri,size:o.user,title:l,backgroundColor:r,statusTypes:this.state.statusTypes,statusBorderColor:d,importantForAccessibility:a.Types.ImportantForAccessibility.NoHideDescendants});else{let s,n;this.state.conversationLastMessage&&(s=Ue.isThreadActivityType(this.state.conversationLastMessage.messagetype)?ve.getMessageInitiator(this.state.conversationLastMessage):null===(e=this.state.conversationLastMessage)||void 0===e?void 0:e.creator,n=!this._useCompactLayout()&&this.state.lastMessageAuthorAvatarSwitchedOn&&!Ue.isEventCallEndedMessageType(this.state.conversationLastMessage)),t=(0,i.jsx)(lt.ConversationIcon,{conversationId:this.props.conversationId,altName:this.state.conversationDisplayName,size:o.conversation,backgroundColor:r,statusBorderColor:d,lastMessageAuthorMri:s,showLastMessageAuthor:n,importantForAccessibility:a.Types.ImportantForAccessibility.NoHideDescendants})}return t}_renderConversationCard(e,t){const s=[Tt.cardContentBase];let o;if(this.state.useMobileUI&&!this._useCompactLayout()?s.push(Tt.cardContentSmall):s.push(Tt.cardContentCompact),t||this.props.isSelected||this.state.useMobileUI||!this._useDarkTheme()||s.push(Tt.compositeNav.darkThemeRead),e){const t=this.state.isLastMessageCallEvent?void 0:this._renderOptionalMessageTypeIcon();o=(0,i.jsxs)(a.Animated.View,Object.assign({style:Tt.cardContent},{children:[t,e]}))}const n=[Tt.displayNameBase,Tt.displayName],r=this._getDisplayNameStyle();let l;if(this._useCompactLayout()&&this._canDisplayDraft()){const e=[r,this._themeStyles.secondaryTextColorStyle,O.default.flexZero];e.push(a.Styles.createTextStyle({color:this._themeColors.textSecondary},!1)),l=(0,i.jsx)(a.Text,Object.assign({style:e,numberOfLines:1},{children:ne.getString("MessageComposer.DraftDecorator")+" "}))}const d=this.state.mood&&this.state.moodEmoticonType?(0,i.jsx)(Ie.default,{mood:this.state.mood,moodEmoticonType:this.state.moodEmoticonType,moodEmoticonTone:this.state.moodEmoticonTone}):void 0,c=this.state.isTrustedAgent||this.state.isNewsChannel?this._getOptionalCertifiedIcon():void 0;return(0,i.jsxs)(a.View,Object.assign({style:s},{children:[(0,i.jsxs)(a.View,Object.assign({style:n},{children:[l,(0,i.jsx)(a.Text,Object.assign({style:r,numberOfLines:1},{children:this.state.conversationDisplayName})),d,c]})),o]}))}_renderSuggestionsForBing(){return(0,i.jsx)(me.BingConversationSuggestion,{conversationId:this.props.conversationId,debounceTimeout:this.state.magicBotSuggestionshDebounceTimeout,enableDebouncing:this.state.enableMagicBotChatlistSuggestionsDebouncing})}_canDisplayDraft(){return this.state.draft&&!this.state.unreadCount||this.state.enableMediaPreviewDrafts&&this.state.mediaDraft&&!this.state.unreadCount}_optionalMessageTypeIcon(){return ct.default.optionalMessageTypeIcon(this.props.rowSize===ce.RowSize.ExtraCompact,this.state.isEncrypted,this.state.isTranslated,this.props.conversationId,this.state.isLastMessageFromAlbum)}_renderOptionalMessageTypeIcon(){if(this.props.rowSize===ce.RowSize.ExtraCompact)return;const e=this._optionalMessageTypeIcon();return e?this._getMessageTypeIcon(e):void 0}_getOptionalCertifiedIcon(){return(0,i.jsx)(Me.default,{botMri:this.props.conversationId,style:undefined})}_getMessageTypeIcon(e){let t=this._useDarkTheme()?this._themeColors.secondaryTextColor:this._themeColors.primaryTextColor;return this.state.useMobileUI||(t=this._themeColors.secondaryTextColor),t=this._refreshedPaletteAwareAccessibleTextColor(this._themeColors.textPrimary),(0,i.jsx)(M.default,{icon:e,size:ue.IconSize.size15,color:t,style:Tt.lastMessageAccessoryIcon})}_renderNewTypingIndicator(e,t){const s=[e];let o;!this.state.isUsingStackNav&&t&&s.push(t),o=this._useAccessibleTheme()?this._useDarkTheme()?this.state.isHovering||this.props.isSelected?d.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_LIGHT:d.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_DARK:this.state.isHovering||this.props.isSelected?d.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_DARK:d.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_LIGHT:this._useDarkTheme()?d.Collection.TYPING_INDICATOR_NEXT_DARK:d.Collection.TYPING_INDICATOR_NEXT_LIGHT;const n=(0,i.jsx)(a.Image,{style:s,source:o,resizeMode:"contain"},"typing");return this.state.isUsingStackNav?(0,i.jsx)(F.default,Object.assign({style:t},{children:n}),"typing"):n}_renderInfoSection(){const e=this._useCompactLayout(),t=this._isTyping(this.props,this.state),s=[Tt.lastMessageTimeText];this.state.isUsingStackNav||s.push(Tt.compositeNav.lastMessageTimeText),s.push(a.Styles.createTextStyle({color:this._refreshedPaletteAwareAccessibleTextColor(this._themeColors.textSecondary)},!1));const o=e&&t?this._renderNewTypingIndicator(Tt.indicatorImage,s):void 0;let n;const r=(0,fe.isMagicBotConversation)(this.props.conversationId),l=this.state.showCategories&&this.state.enableConversationsCategoriesIcon&&(this.state.isFavorite||r);let d;this.state.hasActiveCall||o||(n=(0,i.jsx)(k.Caption,Object.assign({style:s,numberOfLines:1,selected:this.state.modernizeConversationList&&this.props.isSelected,modernizeConversationList:this.state.modernizeConversationList},{children:this._getLastMessageTime()}))),e?d=[Tt.compositeNav.infoSectionCompact]:(d=[Tt.infoSection],this.state.useMobileUI||d.push(this._isPresentedInDesktopLeftNav()?Tt.compositeNav.infoSectionLeftNav:Tt.compositeNav.infoSectionExtraPadding));const c=this._renderAccessoryView();return n||o||c?(0,i.jsxs)(a.View,Object.assign({style:d},{children:[o,(0,i.jsxs)(a.View,Object.assign({style:Tt.row},{children:[n,l?this._renderCategoryIcon(this.state.isFavorite,r):null]})),c]})):void 0}_renderCategoryIcon(e,t){let s;return t&&!this.state.magicBotUnpin?s=ue.SkypeIcon.Pin:e&&(s=ue.SkypeIcon.Favourite),s?(0,i.jsx)(M.default,{style:[Tt.categoryIconViewCommon,this._useCompactLayout()?Tt.categoryIconViewCompact:Tt.categoryIconView],size:ue.IconSize.size16,color:this._themeColors.iconSecondary,icon:s}):null}_renderAccessoryView(){let e;const t=this._useCompactLayout();if(!this.state.hasActiveCall||t){if(t&&this.state.hasActiveCall)e=this._renderCallButtons();else if(this.state.isMuted)e=(0,i.jsx)(M.default,Object.assign({icon:ue.SkypeIcon.NotificationOff},this._accessoryStyleInfo()));else if(this.state.displayedUnreadCount){const s=this.state.displayedUnreadCount;let o=s.toString();s&&this.state.unreadCountOverflowed&&(o=ne.getString("Global.CountOverflow",{count:o}));const n=this.state.isOneOnOne||!!this.state.highPriorityUnreadCount,r=this.state.useMobileUI&&t?_.BadgeSize.Desktop:_.BadgeSize.Default,l=this._useAccessibleTheme()&&(this.state.isHovering||this.props.isSelected);e=(0,i.jsx)(_.default,{style:Tt.badgeView,count:o,rawCount:s,colorStyle:l?a.Styles.createViewStyle({backgroundColor:this._themeColors.surfacePrimary},!1):this.state.badgeColorStyle,isHighPriority:n,badgeSize:r,themeOverride:l})}e&&t&&(e=(0,i.jsx)(a.View,Object.assign({style:Tt.compositeNav.accessoryViewCompact},{children:e})))}return e}_accessoryStyleInfo(){const e=[Tt.accessoryIcon];return this._useCompactLayout()?e.push(Tt.accessoryIconMobileCompact):this.state.useMobileUI?e.push(Tt.accessoryIconMobile):e.push(Tt.compositeNav.accessoryIcon),{style:e,size:this.state.useMobileUI?ue.IconSize.size16:ue.IconSize.size14,color:this._themeColors.secondaryTextColor}}_getItemHeightStyle(){if(!this.props.itemHeight)return;let e=Mt._heightStyleCache[this.props.itemHeight];return e||(e=a.Styles.createViewStyle({height:this.props.itemHeight}),Mt._heightStyleCache[this.props.itemHeight]=e),e}_isTyping(e,t){return t.showTypingState&&!t.hasActiveCall&&!t.isEncrypted}_getDisplayNameStyle(){const e=[Tt.linkText,this._themeStyles.primaryTextColorStyle];return this.state.useMobileUI?(this._useCompactLayout()&&e.push(G.default.fontStyle.body),(this.props.isSelected||this.state.displayedUnreadCount)&&e.push(Tt.linkTextUnreadSelected)):(e.push(Tt.compositeNav.linkText,Tt.compositeNav.inlineText),this.props.rowSize===ce.RowSize.ExtraCompact&&e.push(Tt.compositeNav.linkTextExtraCompact),this.state.displayedUnreadCount&&e.push(Tt.linkTextUnreadSelected)),this.state.modernizeConversationList&&e.push(E.default.getItemTitleTextStyle(this.props.isSelected,this.state.displayedUnreadCount>0,this._themeStyles)),this.state.isStackNavAndNotArchived&&e.push(E.default.getItemTitleTextStyle(this.props.isSelected,this.state.displayedUnreadCount>0,this._themeStyles,!0)),e.push(a.Styles.createTextStyle({color:this._refreshedPaletteAwareAccessibleTextColor(this._themeColors.textPrimary)},!1)),e}_getLastMessageTime(e=!1){return this.state.conversationTimestamp?ie.default.getDisplayDateTimeMixedString(this.state.conversationTimestamp,e):""}_intOnUnarchiveConversation(e){oe.log(de.LogTraceArea.ConversationsListItem,"ConversationsListItem._intOnUnarchiveConversation, causeId: "+e),this._unarchiveConversation(),this.props.isSelected&&!this.state.isUsingStackNav&&$.default.navigateAfterUnarchivingConversation(this.state.otherPartyMri||this.props.conversationId,e,this._getContext())}_getMoreMenuItems(){return ct.default.getMenuItems(Object.assign({},this._getMenuItems()))}_getMenuItems(){return{conversationId:this.props.conversationId,conversationShortDisplayName:this.state.conversationShortDisplayName,isFavorite:this.state.isFavorite,isOneOnOne:this.state.isOneOnOne,isMriAnAgent:this.state.isMriAnAgent,isMriAContact:this.state.isMriAContact,isRecipientBlocked:this.state.isRecipientBlocked,isCallingAllowed:this.state.isCallingAllowed,hasActiveCall:this.state.hasActiveCall,displayedUnreadCount:this.state.displayedUnreadCount,displayBlockButton:this.state.displayBlockButton,isArchived:this.state.isArchived,isEngagementBot:this.state.isEngagementBot,isMyBot:this.state.isMyBot,isJoinEnabled:this.state.isJoinEnabled,magicBotEnabled:this.state.enableMagicBot,magicBotUnpin:this.state.magicBotUnpin,isMuted:this.state.isMuted,isNewsBot:this.state.isNewsBot,isNewsChannel:this.state.isNewsChannel}}_trackMeetNowClick(e){oe.track(new j.MeetNowClickEvent(void 0,{origin:u.MeetNowOrigin.ConversationListContextMenu},e))}_sendConfiramtionToast(e){const t={duration:5e3,textMessage:e,key:"copied_link_copied",rootViewId:this._getRootViewId(),accessibilityLabel:e};re.default.scheduleMessage(t)}_getLastMessageAccessibilityLabel(e){const t=Ne.decode(e);return ht.toAccessibilityLabel(t,{message:e,includeSenderInformationInAccessibilityLabel:!1,includeReactionInformationInAccessibilityLabel:!1})}_handleLeaveConversation(){const e=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"_handleLeaveConversation, causeId: "+e);const t=this._getRootViewId();(0,D.default)(this.props.conversationId,(()=>{this.state.isUsingStackNav||se.default.getActiveConversationId(t)!==this.props.conversationId||$.default.navigateToDesktopRecents(e)}),t,rt.RemoveMemberFromThreadSource.ConversationListItem)}_isJoinCallButtonDisabled(){return!this.state.alwaysNavigateToLobby&&!this.state.isCallingAllowed}_startCall(e,t){oe.log(de.LogTraceArea.ConversationsListItem,"_startCall, causeId: "+t),this.state.isOneOnOne||this.state.showTwinCam||h.default.beginTrackingJoinMeetNow(u.MeetNowOrigin.ConversationsListPanel),m.default.startCallOrMaybePrompt((()=>this._conversationAudioButtonRef||(this.isComponentMounted()?this:void 0)),this._getRootViewId(),{skypeMri:this.props.conversationId,userIntent:e,showSmsOption:!1,callOrigin:de.NavigationCallOrigin.ConversationListItem,inviteOrigin:de.ContactInviteOrigin.Unknown,showCallPreview:this.state.enableJoinerCallPreview},t)}_useCompactLayout(){return this.props.rowSize===ce.RowSize.Compact||this.props.rowSize===ce.RowSize.ExtraCompact}_pauseWhenNotVisible(){return this.state.isUsingStackNav}_shouldDisplayLastMessage(e){return!(e.getTimestamp()<14926392e5||e.isThread()&&e.isDeleted())}_shouldDisplayBlockOption(e){return!(e.lastMessage&&!Ue.isCallOrSmsMessageType(e.lastMessage)&&V.default.isMyMri(e.lastMessage.creator))}_isDraggable(){return Qe.default.isDragAndDropContactsEnabled()&&this.state.isOneOnOne&&!je.isAgent(this.props.conversationId)}click(e){this._completeOnPress(e)}_getConversationTimestamp(e,t){if(!e)return;const s=Math.max(tt.default.getDraftTimestampForConversation(e.id)||0,t&&_e.default.getDraftPreviewTimestamp(e.id)||0,(0,st.default)().getFakeTimestamp(e.id)||0,e.getTimestamp()||0);return s||void 0}_refreshedPaletteAwareAccessibleTextColor(e){return this._useAccessibleTheme()&&(this.state.isHovering||this.props.isSelected)?this._themeColors.textOnColor:e}}function It(e){switch(e){case Fe.AvatarIconSize.Size64:return"lg";case Fe.AvatarIconSize.Size24:return"sm";default:return"md"}}Mt._heightStyleCache={},t.ConversationsListItem=Mt,t.default=Mt},528805:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(396265),r=s(516778),a=s(244770),l=s(809206),d=s(281878),c=s(77340),h=(s(300060),s(889391)),u=s(780128),p=s(898278),g=s(63060),m=s(475760),S=s(331751),f=s(975861),y=s(262813),v=s(145083),C=s(96539),_=s(154464),b=s(948734),T=s(192758),M=s(539549),I=s(30010),w=s(224631),P=s(72822),k=s(956280),A=(s(310167),s(235251)),x=s(789029),R=s(746096),O=s(360088),L=s(211375),F=s(913944),B=s(110117),D=s(436237),E=s(710400),V=s(172490),N=s(915877),U=s(733754),j=s(866127),H=s(734537),z=s(706250),W=s(593486),G=s(178735),K=s(104735),q=s(330124),Q=s(827357),X=s(446068),$=s(853154),J=s(887226),Y=s(328377),Z=s(882052),ee=s(793003),te=s(29130),se=s(681115),ie=s(536150),oe=s(704101),ne=s(699948),re=s(22222),ae=s(581760),le=s(311010),de=s(711828),ce=s(680837),he=s(360305),ue=s(619675),pe=s(24576),ge=s(567977),me=s(853374),Se=s(661239),fe=s(130583),ye=s(345187),ve=s(980734),Ce=s(474728),_e=s(631409),be=s(46929),Te=s(782729),Me=s(257308),Ie=s(760860),we=s(109106),Pe=s(383290),ke=s(102102),Ae=s(671830),xe=s(256886),Re=s(480707),Oe=s(27621),Le=s(582916),Fe=s(46375),Be=s(702437),De=s(67865),Ee=s(512952),Ve=s(587134),Ne=s(276065),Ue=s(432319),je=s(147204),He=s(408466),ze=s(172146),We=s(666927),Ge=(0,N.lazyProperties)({panel:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",backgroundColor:ae.Color.transparent}),filterButtonContainer:()=>r.Styles.createViewStyle({width:44,alignItems:"center",justifyContent:"center"}),filterButtonContainerModernized:()=>r.Styles.createViewStyle({width:32,marginRight:16,alignItems:"center",justifyContent:"center",borderRadius:10,marginVertical:4}),icon:()=>r.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",width:de.IconSize.default,height:de.IconSize.default}),iconModernized:()=>r.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",width:de.IconSize.size32,flex:1}),ipadChatListContainer:()=>r.Styles.createViewStyle({paddingTop:xe.COLLAPSIBLE_HEADER_SEARCH_MAX_HEIGHT}),emptyStateContainer:()=>r.Styles.createViewStyle({flex:1,paddingVertical:10,paddingHorizontal:10,justifyContent:"center",alignItems:"stretch"}),emptyStateContainerItemsAtTop:()=>r.Styles.createViewStyle({justifyContent:"flex-start"}),emptyStateContainerTopPadding:()=>r.Styles.createViewStyle({paddingTop:20}),emptyStateText:()=>r.Styles.createTextStyle({textAlign:"center"}),emptyStateTextSecondLine:()=>r.Styles.createTextStyle({paddingTop:5,textAlign:"center"}),emptyStateTextSecondLineV2:()=>r.Styles.createTextStyle({marginHorizontal:30}),emptyStateTextsContainer:()=>r.Styles.createViewStyle({alignItems:"flex-start",alignSelf:"center",marginHorizontal:35}),emptyStateTextWithIconContainer:()=>r.Styles.createViewStyle({marginTop:10,flexDirection:"row",alignItems:"flex-start",flex:1}),emptyStateTextWithIconContainerV2:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",flex:1}),emptyStateTextWithIcon:()=>r.Styles.createTextStyle({textAlign:"left",flex:1}),emptyStateTextIcon:()=>r.Styles.createViewStyle({marginRight:10}),emptyStateImageV1:()=>r.Styles.createImageStyle({height:130,width:130,alignSelf:"center"}),emptyStateImageV2:()=>r.Styles.createImageStyle({width:280,height:176,marginBottom:20,alignSelf:"center"}),syncContactsButton:()=>r.Styles.createButtonStyle({alignSelf:"center",marginTop:20,marginHorizontal:40}),syncContactsButtonV2:()=>r.Styles.createButtonStyle({marginTop:40,width:180,borderRadius:30,paddingVertical:10}),syncContactsButtonV2Small:()=>r.Styles.createButtonStyle({marginTop:20}),textStyleOverride:()=>r.Styles.createTextStyle({fontWeight:p.FontWeight.bold,fontSize:le.default.controlFontSize.button}),emptyStateSyncContactImage:()=>r.Styles.createImageStyle({height:152,width:200,marginBottom:20,alignSelf:"center"}),emptyStateSyncContactImageSmall:()=>r.Styles.createImageStyle({marginBottom:0}),learnMoreButton:()=>r.Styles.createTextStyle({fontSize:le.default.controlFontSize.button})}),Ke={flexGrow:1,flexShrink:0,marginTop:6};class qe extends pe.default{constructor(){super(...arguments),this._currentScrollTop=0,this._currentSwipeScrollTop=0,this._shadowVisible=!1,this._conversationItemRefs=new z.default,this._shadowOpacityValue=new r.Animated.Value(0),this._shadowOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._shadowOpacityValue}),this._onAppStateChange=e=>{this._closeCurrentSwipeView(),this._maybeShowSayHiPopup(e)},this._debouncedClickOnConversationListItem=o.debounce((e=>{e.click(R.NavigationConversationOrigin.KeyboardShortcutRecents)}),50),this._onNavigateToPreviousConversation=()=>{if(this.state.currentConversationIndex>0){const e=o.findLast(this.state.itemList,(e=>!!e.isNavigable),this.state.currentConversationIndex-1);e&&this._clickOnConversation(e.key)}return!0},this._onNavigateToNextConversation=()=>{const e=o.find(this.state.itemList,(e=>!!e.isNavigable),this.state.currentConversationIndex+1);return e&&this._clickOnConversation(e.key),!0},this.handleFocusEvent=e=>{D.log(R.LogTraceArea.GenericUnsafe,"ConversationsListPanel.handleFocusEvent");const t=this.state.activeConversationId&&(0,M.default)().isClearApplicableAndKeepInRecents(this.state.activeConversationId);return!(e!==L.FocusEvent.Recent&&e!==L.FocusEvent.ConversationDeleted||t||!this.focusFirst())||!(e!==L.FocusEvent.CancelMobileSearch||!this._searchInputButton)&&(this._searchInputButton.focusButton(),!0)},this._handleFreDismiss=()=>{this._store.setFilterMode("all")},this._onListFilterChange=e=>{var t;this._store.setFilterMode(e),"channels"!==e||(null===(t=this._contentChannelsFREStore)||void 0===t?void 0:t.isCompleted())||0!==this._store.getShownConversations().length||(0,Re.navigateToChannelsFRE)(this._getRootViewId(),this._handleFreDismiss)},this._getConversationPanelContainerStyles=()=>[Ge.panel,r.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1)],this._renderAdBanner=e=>{if(!e)return null;const t=this.state.modernizeConversationList?H.default.getBannerBackgroundColorStyle(this._useDarkTheme(),this._useAccessibleTheme(),this._themeStyles):void 0;return(0,i.jsx)(v.default,{adsGuid:e.adsGuid,adGuid:e.adGuid,isLastItem:e.isLastItem,dimensions:e.dimensions,placementId:e.placementId,canHide:e.canHide,provider:e.provider,style:t})},this._onInitialRenderComplete=()=>{ne.default.recentsRendered()},this._onLayoutVlvContainer=e=>{this.isComponentMounted()&&(this.state.listItemContainerHeight===e.height&&this.state.listItemContainerWidth===e.width||this.setState({listItemContainerHeight:e.height,listItemContainerScreenAvailableHeight:this._getItemContainerHeightDisregardingKeyboard(e.height,this.state),listItemContainerWidth:e.width}))},this._onLayoutEmptyState=e=>{this.isComponentMounted()&&this.setState({emptyStateHeight:e.height})},this._onScrollViewRef=e=>{this._scrollView=e||void 0},this._debouncedOnEndReached=o.debounce((()=>{D.log(R.LogTraceArea.ConversationsListItem,"ConversationsListPanel._debouncedOnEndReached LoadMoreConversations"),this._store.loadMoreConversations()}),200),this._onEndReached=()=>{D.log(R.LogTraceArea.ConversationsListItem,"ConversationsListPanel._onEndReached"),this._debouncedOnEndReached()},this._updateScrollYValue=e=>{!this.state.enableCollapsibleHeaderSearch||this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav()||this.setState({vlvScrollY:e})},this._onScroll=(e,t)=>{var s,i;if(this._updateScrollYValue(e),null===(i=(s=this.props).onScroll)||void 0===i||i.call(s,e,this._currentScrollTop),!this.state.isUsingStackNavigationOrMobileView){const t=e>0;this._shadowVisible!==t&&(this._shadowOpacityValue.setValue(t?.5:0),this._shadowVisible=t)}(e>this._currentSwipeScrollTop+40||e<this._currentSwipeScrollTop-40)&&this._closeCurrentSwipeView(),this._currentScrollTop=e},this._closeCurrentSwipeView=()=>{if(this._currentSwipableItemRef){const e=this._currentSwipableItemRef.ref();e&&e.close()&&(this._currentSwipableItemRef=void 0)}},this._onPressLearnMore=()=>{D.track(new J.ClickedLearnMoreOnEmptyStateCta),Se.default.showDialog({isSmallDevice:this.state.deviceSize===te.DeviceSize.Small,isUsingStackNavigationContext:this.state.isUsingStackNavigationOrMobileView,onCancel:()=>{}},this._getRootViewId())},this._shouldRenderEmptyStateImage=e=>!0,this._renderItem=(e,t)=>{if(!e)return(0,i.jsx)(r.View,{});if(e.key===Le.ConversationListItemNames.searchBar){const t=e,s=this._themeColors.iconSecondary,o=this._themeColors.iconSecondary;let n;t.safeAreaHorizontalInsets&&se.default.hasHorizontalSafeAreas(t.safeAreaHorizontalInsets)&&(n=se.default.horizontalPaddingStyle(t.safeAreaHorizontalInsets));const a=(0,i.jsx)(oe.default,{ref:this._onSearchInputButtonRef,buttonOnly:!0,placeholderText:this.state.isMobile?U.getString("SearchInputControl.PlaceHolderTextShort"):U.getString("ConversationsListPanel.SearchPeopleGroupsMessagesButtonTitle"),accessibilityLabel:U.getString("HubHeaderPanel.SearchHubAccessibilityLabel"),useIOSStyles:!this.state.isMobile&&t.useIOSSearchStyles,safeAreaPaddingStyle:n,onPress:this._handleMobileSearchButtonClick,showSearchIcon:this.state.isMobile},"search");if(!t.showFilterIcon)return a;const l=this._constructContainerStyles(t),d=this._constructFilterButtonStyles(t),c=(0,i.jsx)(F.default,{ref:this._onFilterButtonRef,size:this.state.isMobile?de.IconSize.size20:de.IconSize.size16,style:this.state.isMobile?Ge.iconModernized:Ge.icon,onPress:this._onFilterButtonClick,color:s,hoverColor:o,icon:this.state.isMobile?de.SkypeIcon.FilterMenu:de.SkypeIcon.Filter,title:U.getString("MobileRecentsFilter.ManageChats"),autoFocus:!0});return(0,i.jsxs)(r.View,Object.assign({style:l},{children:[a,(0,i.jsx)(r.View,Object.assign({style:d},{children:c}))]}))}if(e.key===Le.ConversationListItemNames.topSpacer)return(0,i.jsx)(r.View,{},"topSpacer");if(e.key===Le.ConversationListItemNames.divider){const t=[r.Styles.createViewStyle({height:null==e?void 0:e.height},!1)];return(0,i.jsx)(Ve.default,{style:t})}if(e.key.startsWith(Le.ConversationListItemNames.itemSpacer))return(0,i.jsx)(r.View,{style:r.Styles.createViewStyle({height:e.height},!1)},e.key);if(e.key===Le.ConversationListItemNames.bottomSpacer)return(0,i.jsx)(r.View,{},"bottomSpacer");if(e.key.substring(0,Le.ConversationListItemNames.header.length)===Le.ConversationListItemNames.header){const t=e;return(0,i.jsx)(b.default,{title:t.title})}if(e.key===Le.ConversationListItemNames.notificationsPrompt)return(0,i.jsx)(X.default,{});if(e.key===Le.ConversationListItemNames.finishSetupPrompt)return(0,i.jsx)(O.default,{});if(e.key===Le.ConversationListItemNames.emptyState){const t=e;return this._renderEmptyStateListItem(t)}if(e.key===Le.ConversationListItemNames.nativeAd){const t=e,s={adsGuid:t.adsGuid,adGuid:t.adGuid,dimensions:t.dimensions,placementId:t.placementId,canHide:t.canHide,provider:t.provider};return t.adType===k.AdsType.ListItemNarrow?(0,i.jsx)(f.default,Object.assign({},s)):(0,i.jsx)(y.default,Object.assign({},s))}if(e.key===Le.ConversationListItemNames.loadingIndicator)return c.ActivityIndicatorHelper.renderItem(e,this._themeColors.secondaryTextColor);if(e.key===Le.ConversationListItemNames.conversationsListBanner)return(0,Me.getBannerComponent)(this.state.conversationsListBanner)||(0,i.jsx)(i.Fragment,{});const s=e,n=this._getIconSize(s.rowSize,s.useMobileView,s.isUsingStackNavigationContext,s.useCompactIcon);if(e.key===Le.ConversationListItemNames.engagementBanner){const t=e.template,s=C.ConversationsListHelper.getEngagementBannerProps(t,this._getContext());if(C.ConversationsListHelper.isEngagementBannerConfigModernizedType(s))return(0,i.jsx)(fe.EngagementBannerModernized,Object.assign({},s));if(!o.isUndefined(s))return(0,i.jsx)(x.EngagementBanner,Object.assign({},s))}const a=this.state.viewType===Le.ConversationsListMode.ArchivedConversations?R.NavigationConversationOrigin.ArchivedConversations:R.NavigationConversationOrigin.Recents;return(0,i.jsx)(_.ConversationsListItem,{ref:this._conversationItemRefs.onComponentRef(s.key),itemHeight:s.height,conversationId:s.key,isSelected:s.isSelected,conversationIconSize:n,rowSize:s.rowSize,origin:a,enableSwipeActions:this.state.enableSwipeActions,onSwiping:this.state.enableSwipeActions?this._onSwiping:void 0},"convItem")},this._headerPanelRef=e=>{this._mybotRef=e||void 0},this.getMyBotRef=()=>this._mybotRef,this._getIconSize=(e,t,s,i)=>e===ee.RowSize.Compact||e===ee.RowSize.ExtraCompact||i?s?this.state.isUsingStackNavigationContext?ge.AvatarIconSize.Size44:ge.AvatarIconSize.Size40:ge.AvatarIconSize.Size24:this.state.isUsingStackNavigationContext?ge.AvatarIconSize.Size64:t&&!this.state.modernizeConversationList?ge.AvatarIconSize.Size60:ge.AvatarIconSize.Size40,this._onSwiping=(e,t,s,i,o)=>{e&&(this._currentSwipeScrollTop=Math.max(this._currentScrollTop,0)),this.isComponentMounted()&&this.state.isSwiping!==e&&this.setState({isSwiping:e}),s&&this._currentScrollTop!==this._currentSwipeScrollTop&&this._scrollView&&this._scrollView.scrollToTop(!0,this._currentSwipeScrollTop),this._currentSwipableItemRef&&this._currentSwipableItemRef.itemId===i.itemId||o||(this._closeCurrentSwipeView(),t&&(this._currentSwipableItemRef=i))},this._handleMobileSearchButtonClick=e=>{const t=me.default.newCauseId();D.log(R.LogTraceArea.ConversationsListItem,"ConversationListPanel._handleMobileSearchButtonClick, causeId: "+t),e&&e.stopPropagation(),D.track(new we.PressAction(we.PressScenario.SearchNavigation,R.SearchPanelInitiator.RecentsListSearchButton)),K.default.navigateToSearch({searchOrigin:R.SearchPanelInitiator.RecentsListSearchButton},t)},this._onFilterButtonRef=e=>{this._filterButton=e||void 0},this._onSearchInputButtonRef=e=>{this._searchInputButton=e||void 0},this._onFilterButtonClick=e=>{D.track(new we.PressAction(we.PressScenario.SearchAccessory,R.SearchAccessoryOrigin.ConversationList,"Filter")),Z.default.showOptionsMenu((()=>this._filterButton),this._getRootViewId(),e)},this._onSyncContactsClick=()=>{C.ConversationsListHelper.syncContactsClickHandler(this._getRootViewId(),P.DialogNavOrigin.ChatsEmptyState)}}_buildState(e,t){const s=this._getRootViewId(),i=h.default.getS4LMessagingFeatures(),n=h.default.getOnboardingFeatures(),{enableRecentChatsSwipeActions:r,enableCollapsibleHeaderSearch:a,enableRecentsFilterPills:d}=h.default.getS4LUiFeatures(),c=W.default.isChildOrMinor(),p=d&&!c;(t||this.state.enableRecentsFilterPills!==p)&&(this._store=p?(0,Fe.getConversationsListStore)():T.default,this._contentChannelsFREStore=p?new Oe.FRESuggestionsStore:void 0);const g=j.default.canModernizeConversationList(),f=q.default.isUsingStackNavigationContext(),y=f||e.useMobileView,v=Q.default.getActiveConversationId(s),_=G.default.getUserPreferencesLocal().recentsSortedBy||ee.RecentsSortBy.Time,b=qe._getRecentsViewModeType(e,y);let I=0;const w=this._getContext(),P=new C.ConversationsListHelper(s,!!y,w.isPresentedInDesktopLeftNav);let k;if(_===ee.RecentsSortBy.Unread&&!y){const e=m.default.getConversationsWithUnreadCounts();v&&v in e&&(k=v)}const A=this.state?this.state.emptyStateHeight:void 0,x=this.state?this.state.listItemContainerHeight:void 0,O=this.state?this.state.itemList.length:0,L=this.state&&this.state.listItemContainerScreenAvailableHeight?this.state.listItemContainerScreenAvailableHeight:void 0,F=this.state&&this.state.listItemContainerWidth?this.state.listItemContainerWidth:void 0,B=be.default.getMagicBotConvListUnpin(),V=p?this._store.getFilterMode():"all",N=this._store.getShownConversations();"all"!==V&&"chats"!==V||((0,Pe.maybeAddMagicBotToRecents)(N,i.enableMagicBot,B),(0,ke.maybeAddMyBotToRecents)(N,i.enableMyBot));const U="channels"!==V?Te.default.getBannerPlacement(Ie.BannerPlacement.ConversationList):null,H=P.getConversationsItemsList(N,e.topInset,U,e,t,A,x,O,k,_,L,F,v,this._isPresentedInDesktopLeftNav(),this._isPresentedInTabletLeftNav(),this._getContext().language,i.modernizeIllustrations&&P.shouldContainEmptyStateItem(),i.enableMagicBot,B,i.enableMyBot,V),z=P.getConversationAdBanner(e.useMobileView,F,g),K=ie.default.isMobileScreenReaderEnabled();let X=0;b===Le.ConversationsListMode.AllConversations&&(I=P.getFavoritesCount(),X=P.getShownConversationsCount()-I,D.log(R.LogTraceArea.ConversationsListItem,"ConversationsListPanel._buildState user has "+I+"favorites conversationand shown non-favorites conversation"+X));const $=b!==Le.ConversationsListMode.AllConversations&&P.isAnyConversationArchived(),Z=te.default.isMobileScreenSize(s)&&!he.default.isTabletUI(),se=i.enableKeyboardNavigationBetweenConversations&&!w.isPresentedInSplitView,oe=i.modernizeIllustrations,ne=i.emoticonForEmptyChatsTab,re={favoritesCount:I,displayEmptyStateScreen:i.modernizeIllustrations&&P.shouldContainEmptyStateItem(),isMobileScreenSize:Z,isMobileScreenReaderEnabled:K,isUsingStackNavigationOrMobileView:y,useIOSSearchStyles:u.default.shouldUseIOSSearchStyles(),safeAreaHorizontalInsets:P.getSafeAreaHorizontalInsets(f||g),renderDesktopFilter:!y&&(!Z||e.useDesktopUtilityBar),viewType:b,hasArchivedConversations:$,enableSwipeActions:r,enableKeyboardNavigationBetweenConversations:se,recentConversationsIncrementor:i.recentConversationsIncrementor,shownConvsCount:X,showEmptyState:P.getShownConversationsCount()<2,itemList:H,keyboardHeight:E.default.getUpdateInfo().height,canLoadConversationsFromMemory:(0,M.default)().canPossiblyShowMoreRecentConversations(),nativeAdBanner:z,emptyStateDesignV2:n.conversationsListEmptyStateDesignV2,enableEmptyStateCTADesignV2:n.enableEmptyStateCTADesignV2,emptyStateBanner:n.features.emptyStateBanner,deviceSize:te.default.deviceSize(s),screenWidth:te.default.getWidth(this._getRootViewId()),modernizeConversationList:g,modernizeEmptyListAndIllustration:oe,isUsingStackNavigationContext:f&&!$,isMobile:l.default.isMobile(),isChild:W.default.isChild(),activeConversationId:v,enableCollapsibleHeaderSearch:a,renderEmptyStateOnDemand:Ce.default.getRecentsEmpty(),emptyStateModernizedEmoticon:ne,magicBotUnpin:B,conversationsListBanner:U,enableRecentsFilterPills:p&&b===Le.ConversationsListMode.AllConversations,selectedFilterPill:V,isBotItemReady:Ee.default.isMyBotItemReady()},ae=h.default.getS4LMessagingFeatures().enableRecyclerListViewUseCases;re.enabledRecyclerView=ae.indexOf("MainScreen.Tabs.Chat")>-1;const le=v?S.default.getAllSiblingConversations(v):[];return re.currentConversationIndex=se?o.findIndex(H,(e=>e.key===v||!!o.find(le,(t=>t.id===e.key)))):void 0,re.myBotConversationIndex=i.enableMyBot&&i.enableShowFloatTooltips?o.findIndex(H,(e=>e.key===Ae.getMyBotId())):0,t&&(re.isSwiping=!1,b===Le.ConversationsListMode.ArchivedConversations||this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav()||(re.vlvScrollY=0)),re.currentConversationIndex=se?o.findIndex(H,(e=>e.key===v||!!o.find(le,(t=>t.id===e.key)))):void 0,t||this.state.trackedEmptyStateEvent||!re.showEmptyState||b!==Le.ConversationsListMode.AllConversations||Y.default.getSyncAddressBookPrivacySetting()||(re.trackedEmptyStateEvent=!0,D.track(new J.DisplayedEmptyStateCta(J.EmptyStateOrigin.NoRecentConversations))),re.shouldShowSayHiPopup=e.isActiveTab&&We.default.shouldShowSayHiPopup(),re}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),ne.default.recentsWillMount()}componentDidMount(){if(super.componentDidMount(),L.register(this._focusEvents(),this),ne.default.conversationListPanelRendered(),this.state.enableKeyboardNavigationBetweenConversations&&(V.default.addHandler(R.KeyboardShortcut.NavigateToPreviousConversation,this._onNavigateToPreviousConversation),V.default.addHandler(R.KeyboardShortcut.NavigateToNextConversation,this._onNavigateToNextConversation)),this.state.enableSwipeActions){const e=this._getContext().componentVisibilityStatus;e&&(this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{e||this._closeCurrentSwipeView()})))}}_maybeShowSayHiPopup(e){if(e===r.Types.AppActivationState.Active&&this.state.shouldShowSayHiPopup){const{skypeContactsLength:e,shortCircuitContactsLength:t}=We.default.getSayHiPeopleListLengthNoSubscribe();D.track(new He.SayHiPopupTelemetryEvent(He.SayHiPopupAction.ShouldShow,ze.default.isStartupNewUser(),e,t));const s="SayHiPopup",o=()=>{je.default.dismissModal(s,this._getRootViewId())};je.default.showModal((0,i.jsx)(Ue.SayHiPopup,{dialogId:s,handlePopupDissmiss:o}),s,{rootViewId:this._getRootViewId()})}}_focusEvents(){const e=[L.FocusEvent.Recent];return this.state.isUsingStackNavigationOrMobileView||e.push(L.FocusEvent.ConversationDeleted),this._isPresentedInTabletLeftNav()&&e.push(L.FocusEvent.CancelMobileSearch),e}_clickOnConversation(e){const t=this._conversationItemRefs.ref(e);this._scrollView&&t&&this.state.viewType===Le.ConversationsListMode.AllConversations&&(this._scrollView.scrollToItem(e,!1),this._debouncedClickOnConversationListItem(t))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);if(!(this.state.viewType===Le.ConversationsListMode.ArchivedConversations)||this.state.isUsingStackNavigationOrMobileView||this.state.hasArchivedConversations||T.default.setConversationsListMode(Le.ConversationsListMode.AllConversations),!this.props.isActiveTab&&e.isActiveTab&&this._closeCurrentSwipeView(),this._loadMoreConversationsIfNeeded(),this.state.isBotItemReady){const e=this._conversationItemRefs.ref(Ae.getMyBotId());e&&this._headerPanelRef(e),Ee.default.setShowMyBotFloatToolTip(!0),Ee.default.setMyBotItemIndex(this.state.myBotConversationIndex)}this.props.isActiveTab&&this._maybeShowSayHiPopup(r.Types.AppActivationState.Active)}componentWillUnmount(){super.componentWillUnmount(),L.unregister(this._focusEvents(),this),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),this._activationSubToken&&(this._activationSubToken.unsubscribe(),this._activationSubToken=void 0),this.state.enableKeyboardNavigationBetweenConversations&&(V.default.removeHandler(R.KeyboardShortcut.NavigateToPreviousConversation,this._onNavigateToPreviousConversation),V.default.removeHandler(R.KeyboardShortcut.NavigateToNextConversation,this._onNavigateToNextConversation))}render(){const e=this.props.topInset?{top:this.props.topInset,left:0,bottom:0,right:0}:void 0,t=this._renderOptionalModernizedEmptyState(),s=t?void 0:this._renderOptionalHubDesktopPicker(),o=s?this._renderShadow():void 0,a=this.props.onScroll||!this.state.isUsingStackNavigationOrMobileView||this.state.enableSwipeActions?this._onScroll:this._updateScrollYValue;let c=(0,i.jsx)(n.VirtualListView,{ref:this._onScrollViewRef,itemList:this.state.itemList,renderItem:this._renderItem,scrollsToTop:this.props.isScrollToTopTarget,animateChanges:!this.props.disableChangeAnimation,skipRenderIfItemUnchanged:!this.state.showEmptyState,keyboardDismissMode:this._getContext().isPresentedInDesktopLeftNav?"on-drag":void 0,showOverflow:se.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets),scrollIndicatorInsets:e,horizontalPadding:this.state.safeAreaHorizontalInsets,onScroll:a,onInitialRenderComplete:this._onInitialRenderComplete,accessibilityLabel:U.getString("ConversationsListPanel.ConversationsList"),disableScrolling:this.state.isSwiping,onEndReached:this._isRecentsView()?this._onEndReached:void 0,endReachedThreshold:100,screenWidth:this.state.screenWidth,enabledRecyclerView:this.state.enabledRecyclerView,style:this.state.displayEmptyStateScreen?_e.styles.panelWrapperStyle:void 0});o&&(c=(0,i.jsxs)(r.View,Object.assign({style:ce.default.flexOne},{children:[c,o]}))),this.state.renderEmptyStateOnDemand&&(c=null);const h=l.BrowserEnvironment.isMobile(),u=(0,i.jsxs)(i.Fragment,{children:[t?(0,i.jsxs)(d.ScrollView,Object.assign({contentContainerStyle:Ke},{children:[c,t]})):c,this.state.conversationsListBanner&&!h&&!this.state.showEmptyState&&(0,Me.getBannerComponent)(this.state.conversationsListBanner),this.state.renderEmptyStateOnDemand?null:this._renderAdBanner(this.state.nativeAdBanner)]}),p=!this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav()?(0,i.jsx)(De.default,{maxScrollY:50,scrollY:this.state.vlvScrollY,conversationListFilterMode:this.state.selectedFilterPill,filterButtonRef:this._onFilterButtonRef,onListFilterChange:this._onListFilterChange,onFilterButtonPress:this._onFilterButtonClick,onSearchPress:this._handleMobileSearchButtonClick}):null,g=this.state.enableRecentsFilterPills?(0,i.jsx)(Be.ChannelsTab,{top:Ne.FILTERS_HEIGHT,scrollY:this.state.vlvScrollY,maxScrollY:50,ContentSlot:u}):null;return(0,i.jsxs)(r.View,Object.assign({style:this._getConversationPanelContainerStyles(),onLayout:this._onLayoutVlvContainer},{children:[this.state.renderEmptyStateOnDemand?null:s,p,"channels"===this.state.selectedFilterPill?g:u]}))}focusFirst(){return!!this._scrollView&&(this._scrollView.scrollToTop(!1),this._scrollView.focus(!0),!0)}scrollToTop(){this._scrollView&&this._scrollView.scrollToTop(!0)}_getConversationItems(e){return o.filter(e,(e=>!o.includes(Le.ConversationListItemNames,e.key)))}_getItemContainerHeightDisregardingKeyboard(e,t){return t.keyboardHeight<=0?e:t.listItemContainerScreenAvailableHeight?t.listItemContainerScreenAvailableHeight:t.listItemContainerHeight?t.listItemContainerHeight:e}_shouldComponentUpdate(e,t,s,i,o,n){return e?!g.default.comparator(s.itemList,o.itemList):super._shouldComponentUpdate(e,t,s,i,o,n)}_getEmptyStateListItemHeight(e,t,s){const i=t-o.sumBy(e,(e=>e.key===Le.ConversationListItemNames.emptyState?0:e.height));return s<=i?i:s}_isRecentsView(){return this.props.viewType===Le.ConversationsListMode.AllConversations||this.state.viewType===Le.ConversationsListMode.AllConversations}_renderOptionalHubDesktopPicker(){return this.state.renderDesktopFilter?(0,i.jsx)(I.default,{newActionPickerContext:this.props.newActionPickerContext}):void 0}_renderOptionalModernizedEmptyState(){if(this.state.displayEmptyStateScreen&&this.state.emptyStateModernizedEmoticon||this.state.renderEmptyStateOnDemand)return(0,i.jsx)(ye.default,{emoticon:this.state.emptyStateModernizedEmoticon,topSlot:(0,i.jsx)(ve.default,{headerText:U.getString("ConversationsListPanelEmptyState.EmptyChatsHeaderAlternative"),bodyText:this._getEmptyStateTextWithIcon("ConversationsListPanelEmptyState.EmptyChatsText",de.SkypeIcon.Search,this._themeColors.secondaryTextColor,de.IconSize.size18),useThemeHeaderColor:!0})},"noChatsItem")}_renderShadow(){return(0,i.jsx)(w.default,{opacityStyle:this._shadowOpacityStyle})}_getEmptyStateContainerStyles(e){const t=[Ge.emptyStateContainer];if(this.state.listItemContainerHeight&&this.state.emptyStateHeight){const s=1===e.height?this._getEmptyStateListItemHeight(this.state.itemList,this.state.listItemContainerHeight,this.state.emptyStateHeight):e.height;t.push(r.Styles.createViewStyle({height:s},!1))}else this.state.modernizeEmptyListAndIllustration||t.push(r.Styles.createViewStyle({opacity:0},!1));return t.push(Ge.emptyStateContainerItemsAtTop),this.state.isMobileScreenSize||t.push(Ge.emptyStateContainerTopPadding),t}_renderEmptyStateListItem(e){const t=this._getEmptyStateContainerStyles(e);let s;this._shouldRenderEmptyStateImage(e)&&(s=(0,i.jsx)(r.Image,{style:Ge.emptyStateImageV1,source:a.Collection.ONBOARDING_CHATS_EMPTYSTATE_V1}));let o=U.getString("ConversationsListPanelEmptyState.NotSyncedHeaderAlternative"),n=U.getString("ConversationsListPanelEmptyState.NotSyncedFirstTextAlternative");const l=U.getString("ConversationsListPanelEmptyState.NotSyncedSecondTextAlternative"),d=U.getString("ConversationsListPanelEmptyState.SyncAddressBookButtonAlternative");let c;if(e.hideSyncAddressBookCta){const e=void 0;o=U.getString("ConversationsListPanelEmptyState.EmptyChatsHeaderAlternative"),n=U.getString("ConversationsListPanelEmptyState.SearchCTATextAlternative"),c=(0,i.jsxs)(r.View,Object.assign({style:Ge.emptyStateTextsContainer},{children:[(0,i.jsxs)(r.View,Object.assign({style:Ge.emptyStateTextWithIconContainerV2},{children:[(0,i.jsx)(B.default,{icon:de.SkypeIcon.Search,size:de.IconSize.size16,color:this._themeColors.secondaryTextColor,style:Ge.emptyStateTextIcon},"searchIcon"),(0,i.jsx)(ue.BodyText,Object.assign({style:Ge.emptyStateTextWithIcon,textThemeColor:ue.TextThemeColor.Secondary},{children:n}))]})),e]}))}else if(this.state.isChild)c=null;else{if(this.state.enableEmptyStateCTADesignV2)return this._getEmptyStateCTADesignV2(t);c=(0,i.jsxs)(r.View,{children:[(0,i.jsx)(ue.BodyText,Object.assign({style:Ge.emptyStateText,textThemeColor:ue.TextThemeColor.Secondary},{children:n})),(0,i.jsx)(ue.BodyText,Object.assign({style:Ge.emptyStateTextSecondLine,textThemeColor:ue.TextThemeColor.Secondary},{children:l})),(0,i.jsx)(re.default,{style:Ge.syncContactsButton,buttonSize:p.SXButtonSize.Medium,onPress:this._onSyncContactsClick,title:d,allowTextWrap:!0})]})}return(0,i.jsxs)(r.View,Object.assign({style:t,ignorePointerEvents:!0,onLayout:this._onLayoutEmptyState},{children:[s,(0,i.jsx)(A.default,{headerText:o}),c]}))}_getEmptyStateCTADesignV2(e){const t=U.getString("ConversationsListPanelEmptyState.SyncAddressBookButtonAlternative"),s=this.state.deviceSize===te.DeviceSize.Small,o=[Ge.syncContactsButton,Ge.syncContactsButtonV2,s?Ge.syncContactsButtonV2Small:void 0],n=[Ge.emptyStateSyncContactImage,s?Ge.emptyStateSyncContactImageSmall:void 0];return(0,i.jsxs)(r.View,Object.assign({style:e,ignorePointerEvents:!0,onLayout:this._onLayoutEmptyState},{children:[(0,i.jsx)(r.Image,{style:n,source:a.Collection.ONBOARDING_SYNC_CONTACTS_V2}),(0,i.jsx)(A.default,{headerText:U.getString("ConversationsListPanelEmptyState.EmptyChatsHeaderAlternative")}),(0,i.jsx)(ue.BodyText,Object.assign({style:[Ge.emptyStateTextSecondLine,Ge.emptyStateTextSecondLineV2],textThemeColor:ue.TextThemeColor.Secondary},{children:U.getString("ConversationsListPanelEmptyState.NotSyncedSecondTextAlternative")})),(0,i.jsx)(re.default,{style:o,textStyleOverride:[Ge.textStyleOverride],buttonSize:p.SXButtonSize.Medium,onPress:this._onSyncContactsClick,title:t,accessibilityLabel:t,allowTextWrap:!1,icon:void 0,iconSize:de.IconSize.size18,iconPositon:p.SXButtonIconPosition.End}),(0,i.jsx)(re.default,{onPress:this._onPressLearnMore,buttonStyle:p.SXButtonStyle.Custom,buttonConfig:{textColor:ae.Color.blue,backgroundColor:ae.Color.transparent},textStyleOverride:[Ge.learnMoreButton],buttonSize:p.SXButtonSize.Small,title:U.getString("UserSettingsPanel.HotkeysLearnMoreLink")})]}))}_renderMobileEmptyStateListItemV2(e){const t=this._getEmptyStateContainerStyles(e);let s,o,n,l=this.state.emptyStateDesignV2.backgroundVariant;switch(this.state.isChild&&(l=$.ChatsEmptyStateBackground.MeetNow),l){case $.ChatsEmptyStateBackground.MeetNow:s=a.Collection.ONBOARDING_CHATS_EMPTYSTATE_V2_MEETNOW,o="ConversationsListPanelEmptyState.EmptyChatsCTATextMeetNow",n=de.SkypeIcon.MeetNow;break;case $.ChatsEmptyStateBackground.Search:s=a.Collection.ONBOARDING_CHATS_EMPTYSTATE_V2_SEARCH,o="ConversationsListPanelEmptyState.EmptyChatsCTATextSearch",n=de.SkypeIcon.Search;break;case $.ChatsEmptyStateBackground.Chat:default:s=a.Collection.ONBOARDING_CHATS_EMPTYSTATE_V2_CHAT,o="ConversationsListPanelEmptyState.EmptyChatsCTATextChat",n=de.SkypeIcon.Topic}const d=this._getEmptyStateTextWithIcon(o,n,this._themeColors.primaryTextColor,de.IconSize.size18),c=(0,i.jsx)(ue.BodyText,Object.assign({style:Ge.emptyStateText,textThemeColor:ue.TextThemeColor.Primary},{children:d}));return(0,i.jsxs)(r.View,Object.assign({style:t,ignorePointerEvents:!0,onLayout:this._onLayoutEmptyState},{children:[(0,i.jsx)(r.Image,{style:Ge.emptyStateImageV2,source:s}),(0,i.jsx)(r.View,Object.assign({style:Ge.emptyStateTextsContainer},{children:(0,i.jsx)(r.View,Object.assign({style:Ge.emptyStateTextWithIconContainerV2},{children:c}))}))]}))}_getEmptyStateTextWithIcon(e,t,s,o){const n=_e.styles.bodyIconStyle;return U.getParts(e,{icon:(0,i.jsx)(r.Text,{children:(0,i.jsx)(B.default,{icon:t,size:o,color:s,style:n})},"searchIcon")})}_renderContactsCta(e,t,s){return(0,i.jsxs)(r.View,Object.assign({style:Ge.emptyStateTextWithIconContainer},{children:[(0,i.jsx)(B.default,{icon:de.SkypeIcon.Contact,size:e,color:t,style:s},"contactsIcon"),(0,i.jsx)(ue.BodyText,Object.assign({style:Ge.emptyStateTextWithIcon,textThemeColor:ue.TextThemeColor.Secondary},{children:U.getString("ConversationsListPanelEmptyState.ContactsCTATextAlternative")}))]}))}_constructFilterButtonStyles(e){var t;const s=[];return s.push(...this.state.isMobile?[Ge.filterButtonContainerModernized,this._themeStyles.searchModernizeColorStyle,this._useAccessibleTheme()?this._themeStyles.searchBorderModernizeColorStyle:void 0]:[Ge.filterButtonContainer]),(null===(t=e.safeAreaHorizontalInsets)||void 0===t?void 0:t.right)&&s.push(r.Styles.createViewStyle({right:e.safeAreaHorizontalInsets.right},!1)),s.push(r.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfaceOnAccent},!1)),s}_constructContainerStyles(e){const t=[ce.default.flexRow];return e.safeAreaHorizontalInsets&&t.push(r.Styles.createViewStyle({marginLeft:-1*e.safeAreaHorizontalInsets.left,marginRight:-1*e.safeAreaHorizontalInsets.right},!1)),t.push(r.Styles.createViewStyle({paddingBottom:8,backgroundColor:this._getContext().themeColors.surfaceAccent},!1)),t}_pauseWhenNotVisible(){return q.default.isUsingStackNavigationContextNoSubscription()}static _getRecentsViewModeType(e,t){let s=Le.ConversationsListMode.AllConversations;return t?e.viewType&&(s=e.viewType):s=T.default.getConversationsListMode(),s}_loadMoreConversationsIfNeeded(){if(this.state.canLoadConversationsFromMemory&&!this.state.isUsingStackNavigationOrMobileView&&this.state.listItemContainerHeight&&this.state.itemList){const e=new C.ConversationsListHelper(this._getRootViewId(),!1,this._isPresentedInDesktopLeftNav()).getNumberOfConversationsToFit(this.state.listItemContainerHeight,this.state.modernizeConversationList),t=this._getConversationItems(this.state.itemList).length,s=e-t;e>=t&&(D.log(R.LogTraceArea.ConversationsListItem,"LoadMoreConversations Increasing the limit to show more conversations, screen can fit "+e+", conversations shown: ",t),this._store.loadMoreConversations(s))}}}t.default=qe},67865:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(809206),n=s(217041),r=s(889391),a=s(256886),l=s(990933),d=s(783715),c=s(593486);function h({mobileUX:e,scrollY:t,maxScrollY:s=0,conversationListFilterMode:o,filterButtonRef:n,onListFilterChange:r,onFilterButtonPress:c,onSearchPress:h,enableRecentsFilterPills:u}){const p=u?(0,i.jsx)(l.default,{ref:n,selectedFilter:o,onFilerMenuPress:c,onChange:r,top:a.COLLAPSIBLE_HEADER_SEARCH_MAX_HEIGHT,scrollY:t,maxScrollY:s}):null;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.default,{ref:n,scrollY:t,mobileUX:e,maxScrollY:s,onSearchPress:h,onFilterButtonPress:c,enableRecentsFilterPills:u}),p]})}class u extends n.ComponentBase{_buildState(){const{enableRecentsFilterPills:e}=r.default.getS4LUiFeatures(),t=c.default.isChildOrMinor();return{enableRecentsFilterPills:e&&!t,mobileUX:o.default.isMobile()}}render(){return(0,i.jsx)(h,{filterButtonRef:this.props.filterButtonRef,mobileUX:this.state.mobileUX,scrollY:this.props.scrollY,maxScrollY:this.props.maxScrollY,enableRecentsFilterPills:this.state.enableRecentsFilterPills,conversationListFilterMode:this.props.conversationListFilterMode,onListFilterChange:this.props.onListFilterChange,onFilterButtonPress:this.props.onFilterButtonPress,onSearchPress:this.props.onSearchPress})}}t.default=u},948734:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(677381),r=s(915877),a=(s(733754),s(619675)),l=s(866127),d=s(330124),c=(0,r.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:-1,flexDirection:"row",alignItems:"center",paddingTop:20,paddingBottom:6,paddingHorizontal:10}),containerPaddingModernize:()=>o.Styles.createViewStyle({paddingHorizontal:16,paddingTop:6,paddingBottom:6}),containerPaddingModernizeMobile:()=>o.Styles.createViewStyle({paddingHorizontal:16,paddingTop:8,paddingBottom:8}),containerSmall:()=>o.Styles.createViewStyle({paddingTop:10}),sectionTitleText:()=>o.Styles.createTextStyle({flex:-1,flexDirection:"row"})});class h extends n.default{_buildState(e,t){return{modernizeConversationList:l.default.canModernizeConversationList(),isUsingStackNavigationContext:d.default.isUsingStackNavigationContext()}}render(){const e=!1,t=o.Types.ImportantForAccessibility.NoHideDescendants;let s;const n=[c.container];this._isPresentedInDesktopLeftNav()&&n.push(c.containerSmall),this.state.modernizeConversationList&&n.push(c.containerPaddingModernize),this.state.isUsingStackNavigationContext&&n.push(c.containerPaddingModernizeMobile),this.props.style&&n.push(this.props.style),n.push(o.Styles.createTextStyle({color:this.context.themeColors.textSecondary},!1));const r={style:c.sectionTitleText,numberOfLines:1,accessibilityHidden:!0,useMobileUI:this.state.isUsingStackNavigationContext},l=this.props.title,d=this.state.modernizeConversationList||this.state.isUsingStackNavigationContext?(0,i.jsx)(a.SubtitleModernize,Object.assign({},r,{children:l})):(0,i.jsx)(a.Subtitle,Object.assign({},r,{children:l}));return(0,i.jsx)(o.View,Object.assign({style:n,importantForAccessibility:t,accessibilityTraits:undefined,accessibilityLabel:s},{children:d}))}}t.default=h},990933:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(281878),n=s(667294),r=s(166454),a=s(600212),l=s(711828),d=s(489873),c=s(276065),h=s(733754),u=(0,n.forwardRef)((({top:e,scrollY:t,maxScrollY:s,selectedFilter:n,onChange:u,onFilerMenuPress:p},g)=>{const m=(0,d.useRecentFilterPills)(),{themeColors:{surfacePrimary:S,iconPrimary:f}}=(0,a.useSkypeTheme)(),y=(0,i.jsxs)(o.Row,Object.assign({paddingX:"5",paddingTop:"2",paddingBottom:"3",height:c.FILTERS_HEIGHT,space:"2",justifyContent:"space-between",flexWrap:"nowrap",backgroundColor:S},{children:[(0,i.jsx)(o.SegmentedControl,{variant:"segmented",onSelectionChange:u,items:m,selectedId:n}),(0,i.jsx)(o.Button,{ref:g,variant:"ghost",accessibilityLabel:(0,h.getString)("MobileRecentsFilter.ManageChats"),onPress:p,PrefixSlot:(0,l.getIcon)(l.SkypeIcon.FilterMenu,l.IconSize.size20,f)})]}));return void 0!==t?(0,i.jsx)(r.Sliding,Object.assign({value:t,valueFrom:0,valueTo:s,minSlideValue:e,maxSlideValue:0},{children:y})):y}));t.default=u},783715:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(667294),r=s(913944),a=s(600212),l=s(512193),d=s(733754),c=s(711828),h=s(539474),u=(0,n.forwardRef)((({mobileUX:e,scrollY:t,maxScrollY:s,onSearchPress:n,onFilterButtonPress:u,enableRecentsFilterPills:p},g)=>{const{themeColors:{iconSecondary:m}}=(0,a.useSkypeTheme)(),{iconStyle:S}=(0,l.useRXStyles)((()=>({iconStyle:o.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",width:e?c.IconSize.size32:c.IconSize.default,height:e?void 0:c.IconSize.default,flex:e?1:void 0})})),[e]),f=p?void 0:(0,i.jsx)(r.default,{ref:g,size:e?c.IconSize.size20:c.IconSize.size16,style:S,onPress:u,color:m,hoverColor:m,icon:e?c.SkypeIcon.FilterMenu:c.SkypeIcon.Filter,title:(0,d.getString)("MobileRecentsFilter.ManageChats"),autoFocus:!0});return void 0!==t?(0,i.jsx)(h.CollapsibleHeaderSearch,{value:t,valueFrom:0,valueTo:s,placeholder:(0,d.getString)(e?"SearchInputControl.PlaceHolderTextShort":"ConversationsListPanel.SearchPeopleGroupsMessagesButtonTitle"),onPress:n,accessory:f}):(0,i.jsx)(h.HeaderSearch,{accessory:f,placeholder:(0,d.getString)(e?"SearchInputControl.PlaceHolderTextShort":"ConversationsListPanel.SearchPeopleGroupsMessagesButtonTitle"),onPress:n})}));t.default=u},276065:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FILTERS_HEIGHT=t.STORE_ENTRY_HEIGHT=void 0,t.STORE_ENTRY_HEIGHT=52,t.FILTERS_HEIGHT=52},595106:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=(s(496486),s(516778)),n=s(397691),r=s(671830),a=s(562141),l=s(218083),d=s(539549),c=s(816402),h=s(952262),u=s(770891),p=s(746096),g=s(353026),m=s(436237),S=s(915877),f=s(733754),y=s(734537),v=s(451072),C=s(723752),_=s(866127),b=s(106658),T=s(18078),M=s(89808),I=s(104735),w=s(914976),P=s(404057),k=s(581760),A=s(311010),x=s(619675),R=s(24576),O=s(912770),L=s(702301),F=s(567977),B=s(853374),D=s(1706),E=s(234196),V=s(741660),N=b.messageTextLineHeight,U=(0,S.lazyProperties)({card:()=>o.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center",paddingVertical:8}),cardHorizontalPaddingClassic:()=>o.Styles.createViewStyle({paddingHorizontal:12}),cardHorizontalPaddingModernize:()=>o.Styles.createViewStyle({paddingHorizontal:8}),iconAndContentContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",marginRight:4}),cardContentContainer:()=>o.Styles.createViewStyle({marginBottom:2}),cardContentContainerWeb:()=>o.Styles.createViewStyle({maxHeight:3*N}),cardContentText:()=>o.Styles.createTextStyle({lineHeight:N}),userIcon:()=>o.Styles.createViewStyle({flexDirection:"row",marginRight:12,alignSelf:"flex-start"}),contentContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),title:()=>o.Styles.createTextStyle({flexShrink:1,alignItems:"center",flexDirection:"row"}),footer:()=>o.Styles.createTextStyle({flexShrink:1})});class j extends R.default{constructor(){super(...arguments),this._onContainerRef=e=>{this._containerRef=e||void 0},this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHovering:!1})},this._onPress=()=>{if(this.props.searchResult.ConversationId){const e=this.props.searchResult.ConversationId,t=this.props.searchResult.MessageId,s=this.props.searchResult.ServerMessageId?Number(this.props.searchResult.ServerMessageId):void 0;let i;i=t?a.default.getMessageByCuid(e,t).then((e=>e?e.createdTime:n.Rejected(void 0))).catch((i=>(m.log(p.LogTraceArea.Search,"ContentSearchMessageResult could not fetch message conversationId="+w.mriOrId(e)+" cuid="+t+" id="+s+(i?" err="+P.default.errorAsString(i):"")),s))):n.Resolved(s),i.then((s=>{this._navigateToConversation(s,e,t)})),this.props.onSearchMessagePress&&this.props.onSearchMessagePress(this,t)}}}_buildState(e,t){const s=(0,d.default)().getConversation(e.searchResult.ConversationId),i=s&&(!s.isOneOnOne()||T.default.isMyMri(e.searchResult.From)),o=D.default.getAgentDescriptionForMri(e.searchResult.From).isTrusted;return{isHovering:!1,creatorName:h.default.getDisplayName(e.searchResult.From),formattedTimestamp:this._getElapsedTimeAndUpdateTimer(e),conversationName:i?h.default.getDisplayName(e.searchResult.ConversationId):"",modernizeConversationList:_.default.canModernizeConversationList(),userColor:M.default.getColorInfo(),isTrustedAgent:o,isNewsChannel:(0,V.isContentChannel)(s)}}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}_getOptionalModernizeTitleStyle(){if(this.state.modernizeConversationList)return y.default.getItemTitleTextStyle(!1,!1,this._themeStyles)}_getOptionalModernizeSubtitleStyle(){if(this.state.modernizeConversationList)return y.default.getItemSubtitleTextStyle(this._useDarkTheme(),!1,this._useAccessibleTheme(),this._themeStyles)}render(){let e="";const t=this.props.searchResult,s=t.From;r.isMri(s)&&(e=this.state.creatorName);const n=[A.default.fontStyle.body,this._themeStyles.secondaryTextColorStyle,U.cardContentText,this._getOptionalModernizeSubtitleStyle()],a=this._getOptionalModernizeTitleStyle(),d=this.state.isTrustedAgent||this.state.isNewsChannel?this.props.searchResult.From:void 0,c=e?(0,i.jsxs)(o.View,Object.assign({style:U.title},{children:[(0,i.jsx)(x.RowTitle,Object.assign({style:a,numberOfLines:1},{children:e.split("\n",1)})),d?(0,i.jsx)(E.default,{botMri:d}):void 0]})):void 0,h=Object.assign(Object.assign({},u.ProcessingDefaults.Preview),{atMentions:u.ProcessingLevel.Full}),p=[n,A.default.font.uiDisplayBold],g={processing:h,renderMedia:!1,mediaPlaceholderIconColor:k.Color.gray200,allowLargeEmoticons:!1,numberOfLines:3,textOverrideStyle:n,atMentionStyle:p,atMentionMeOverrideStyle:p,renderSimpleAtMentions:!0,isGlobalSearch:!0},m=l.default.simulateFullMessage(t,"");if(!m)return null;const S=[U.cardContentContainer];S.push(U.cardContentContainerWeb);const f=[U.card,this.state.modernizeConversationList?U.cardHorizontalPaddingModernize:U.cardHorizontalPaddingClassic],_=!(!this.state.isHovering&&!this.props.isPseudoFocused);this.state.modernizeConversationList&&(this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav())?f.push(y.default.getItemBackgroundStyle(this._useDarkTheme(),!1,_,this._useAccessibleTheme(),this._themeStyles,this.state.userColor)):_&&f.push(this._isPresentedInDesktopLeftNav()?this._themeStyles.secondaryRowHoverViewStyle:this._themeStyles.rowHoverViewStyle);const b=this.state.formattedTimestamp.value+" "+this.state.conversationName,T=this.state.formattedTimestamp.valueAccessible+" "+this.state.conversationName,M=(0,i.jsxs)(o.View,Object.assign({style:U.iconAndContentContainer},{children:[(0,i.jsx)(o.View,Object.assign({style:U.userIcon},{children:(0,i.jsx)(L.UserIcon,{size:F.UserIconSize.Size40,userMri:s})})),(0,i.jsxs)(o.View,Object.assign({style:U.contentContainer},{children:[c,(0,i.jsx)(o.View,Object.assign({style:S},{children:(0,i.jsx)(C.default,{message:m,rawSearchQuery:this.props.rawSearchQuery,options:g})})),(0,i.jsx)(o.View,Object.assign({accessibilityLabel:T},{children:(0,i.jsx)(x.Caption,Object.assign({style:U.footer,numberOfLines:1,modernizeConversationList:this.state.modernizeConversationList},{children:b.split("\n",1)}))}))]}))]})),I={ref:this._onContainerRef};return(0,i.jsx)(v.default.View,Object.assign({},I,{style:f,onPress:this._onPress,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,importantForAccessibility:undefined,accessibilityTraits:[o.Types.AccessibilityTrait.Button,o.Types.AccessibilityTrait.MenuItem]},{children:M}))}_getElapsedTimeAndUpdateTimer(e){const t=new Date(e.searchResult.CreationDate).valueOf(),s=Date.now()-t;if(s>=36e5){const e=c.default.getDisplayDateTimeString(t);return{value:e,valueAccessible:e}}{const e=6e4-Math.floor(s%6e4);if(O.default.setTimeout((()=>{this._updateTimeState()}),e),s>=6e4){const e=Math.floor(s/6e4).toString();return{value:f.getString("SearchResultsList.ElapsedTimeMinutes",{minutes:e}),valueAccessible:f.getString("SearchResultsList.ElapsedTimeMinutesAccessible",{minutes:e})}}return{value:f.getString("SearchResultsList.ElapsedTimeOneMinute"),valueAccessible:f.getString("SearchResultsList.ElapsedTimeOneMinuteAccessible")}}}_updateTimeState(){this.isComponentMounted()&&this.setState({formattedTimestamp:this._getElapsedTimeAndUpdateTimer(this.props)})}_navigateToConversation(e,t,s){const i=B.default.newCauseId();this.props.rawSearchQuery&&g.default.setSearchQuery({query:this.props.rawSearchQuery,conversationId:t,messageId:s,sessionId:i}),I.default.navigateToConversationFromSearch({convId:t,scrollToTimestamp:e,causeId:i})}}t.default=j},489873:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useRecentFilterPills=void 0;const i=s(667294),o=s(359753),n=s(733754);t.useRecentFilterPills=function(){const{language:e}=(0,o.useLocalization)();return(0,i.useMemo)((()=>[{id:"all",label:(0,n.getString)("ConversationsListPanel.ViewModeAll")},{id:"chats",label:(0,n.getString)("ConversationsListPanel.ViewModeChats")},{id:"channels",label:(0,n.getString)("ConversationsListPanel.ViewModeChannels")}]),[e])}},347121:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(217041);class r extends n.ComponentBase{constructor(){super(...arguments),this._onPress=e=>{this.props.onPress(e,this.props.name)}}render(){return(0,i.jsx)(o.Button,Object.assign({style:this.props.style,title:this.props.title,onPress:this._onPress},{children:this.props.children}),"album"+this.props.name)}}t.default=r},549096:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaAlbumPicker=void 0;const i=s(785893),o=s(496486),n=s(930640),r=s(516778),a=s(217041),l=s(347121),d=s(462033),c=s(301065),h=s(711930),u=s(746096),p=s(139889),g=s(110117),m=s(436237),S=s(172490),f=s(915877),y=s(733754),v=s(451070),C=s(681115),_=s(190631),b=s(404057),T=s(581760),M=(s(640363),s(711828)),I=s(680837),w=s(619675),P=(0,f.lazyProperties)({overlayInner:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,bottom:0,right:0,backgroundColor:T.Color.gray400}),containerOpaque:()=>r.Styles.createViewStyle({backgroundColor:T.Color.black}),header:()=>(0,f.lazyProperties)({container:()=>r.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",paddingHorizontal:16,paddingTop:4,paddingBottom:6,height:48}),title:()=>r.Styles.createTextStyle({color:T.Color.white}),headerControlWrap:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center"})}),itemContainer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",paddingRight:12}),itemImage:()=>r.Styles.createViewStyle({width:80,height:80}),itemImageContainer:()=>r.Styles.createViewStyle({width:80,height:80}),itemImageContainerMargin:()=>r.Styles.createViewStyle({marginBottom:1}),itemInfo:()=>r.Styles.createViewStyle({flexDirection:"column",alignItems:"flex-start",justifyContent:"center",marginLeft:12,paddingVertical:10,flex:1}),itemInfoBorder:()=>r.Styles.createViewStyle({borderColor:T.Color.gray300,borderTopWidth:1,borderStyle:"solid"}),itemInfoName:()=>r.Styles.createTextStyle({color:T.Color.white}),itemInfoCount:()=>r.Styles.createTextStyle({color:T.Color.gray100}),thumbnailPlaceholderText:()=>r.Styles.createViewStyle({flex:0,flexDirection:"row"}),failureContainer:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,bottom:0,right:0,justifyContent:"center",alignItems:"center"}),errortext:()=>r.Styles.createTextStyle({color:T.Color.white,paddingHorizontal:40})});class k extends a.ComponentBase{constructor(){super(...arguments),this._onHeaderCenterRef=e=>{e&&o.defer((()=>{e.requestFocus()}))},this._onAlbumPress=(e,t)=>{e.stopPropagation(),this.props.onClose(t)},this._onBack=()=>(this.props.onClose(void 0),m.log(u.LogTraceArea.HardwareBackButton,"goBack: true componentId: MediaAlbumPicker"),!0),this._onKeyUp=()=>(this.props.onClose(void 0),!0)}_buildState(e,t){const s={statusBarHeight:v.default.statusBarHeight(),safeAreaHorizontalPaddingStyle:v.default.horizontalPaddingStyle()};return t&&(s.isLoading=!0,s.failed=!1),s}componentDidMount(){super.componentDidMount(),d.default.subscribe(this._onBack),S.default.addEscapeHandler(this._onKeyUp),this._mediaPickerToken?this._loadAlbums():n.default.open().then((e=>{this._mediaPickerToken=e,this._loadAlbums()}))}componentWillUnmount(){super.componentWillUnmount(),d.default.unsubscribe(this._onBack),S.default.removeEscapeHandler(this._onKeyUp),this._mediaPickerToken&&n.default.close(this._mediaPickerToken)}_loadAlbums(){this._mediaPickerToken&&n.default.getAlbums(this._mediaPickerToken,{photoOnly:this.props.mediaType===c.MediaType.PhotoOnly,disableGifs:this.props.disableGifs}).then((e=>{this.isComponentMounted()&&this.setState({albums:e,isLoading:!1,failed:!1})})).catch((e=>{m.error(u.LogTraceArea.MediaPickerPanel,"Failed to retrieve albums from the device"+b.default.errorAsString(e)),this.isComponentMounted()&&this.setState({failed:!0,isLoading:!1})}))}render(){const e=[P.overlayInner,this.props.style];e.push(P.containerOpaque);const t=[P.header.container];let s,n;if(this.state.statusBarHeight&&(t.push(C.default.paddingTopStyle(this.state.statusBarHeight)),t.push(C.default.heightStyle(this.state.statusBarHeight+48))),this.state.failed)s=(0,i.jsxs)(r.View,Object.assign({style:P.failureContainer},{children:[(0,i.jsx)(g.default,{icon:M.SkypeIcon.Warning,size:M.IconSize.size60,color:T.Color.gray100}),(0,i.jsx)(w.BodyText,Object.assign({style:P.errortext},{children:y.getString("MediaAlbumPicker.FailedToLoad")}))]}));else{const e=(0,i.jsx)(g.default,{icon:M.SkypeIcon.Picture,size:M.IconSize.size32,color:T.Color.gray100,style:P.thumbnailPlaceholderText}),t=(0,i.jsx)(g.default,{icon:M.SkypeIcon.Warning,size:M.IconSize.size32,color:T.Color.gray100,style:P.thumbnailPlaceholderText}),s=[I.default.flexOne];this.state.safeAreaHorizontalPaddingStyle&&s.push(this.state.safeAreaHorizontalPaddingStyle),n=(0,i.jsx)(r.ScrollView,Object.assign({style:s,keyboardShouldPersistTaps:!0},{children:o.map(this.state.albums,((s,o)=>{const n=[P.itemInfo],a=[P.itemImageContainer];return o>0&&(n.push(P.itemInfoBorder),a.push(P.itemImageContainerMargin)),(0,i.jsxs)(l.default,Object.assign({name:s.name,title:y.getString("MediaAlbumPicker.ItemTitle",{albumName:s.name,numItems:s.count}),onPress:this._onAlbumPress,style:P.itemContainer},{children:[(0,i.jsx)(p.default,{origin:"MediaAlbumPicker",style:P.itemImage,containerStyle:a,source:s.thumbnailUri,altView:e,errorView:t,resizeMode:"cover"},"albumImage"+o),(0,i.jsxs)(r.View,Object.assign({style:n},{children:[(0,i.jsx)(w.RowTitle,Object.assign({style:P.itemInfoName},{children:s.name})),(0,i.jsx)(w.Caption,Object.assign({style:P.itemInfoCount},{children:s.count}))]}))]}),"album"+o)}))}))}const a={color:T.Color.white,closeButtonType:_.CloseButtonType.Close,onPress:this._onBack,title:y.getString("Global.CloseButtonTitle")};return(0,i.jsxs)(r.View,Object.assign({style:e},{children:[(0,i.jsx)(_.SimplePanelHeader,{titleView:this._getHeaderCenterControls(),leftButton:a,useTransparentBackground:!0}),s,n]}))}_getHeaderCenterControls(){const e=y.getString("MediaAlbumPicker.Title"),t=h.default.headerAccessibilityInfo(e);return(0,i.jsx)(r.View,Object.assign({style:P.header.headerControlWrap,ref:this._onHeaderCenterRef,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,accessibilityLabel:t.accessibilityLabel,accessibilityTraits:t.accessibilityTraits},{children:(0,i.jsx)(w.PanelHeader,Object.assign({style:P.header.title,numberOfLines:1,accessibilityHidden:!0},{children:e}))}))}}t.MediaAlbumPicker=k,t.default=k},572071:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaPickerPanel=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(219784),a=s(889391),l=s(996074),d=s(301065),c=s(711930),h=s(746096),u=s(110117),p=s(436237),g=s(861253),m=s(915877),S=s(733754),f=s(549096),y=s(381157),v=s(821101),C=s(206286),_=s(971349),b=s(445026),T=s(104735),M=s(451070),I=s(681115),w=s(536150),P=s(190631),k=s(581760),A=s(711828),x=s(734528),R=s(478262),O=s(680837),L=s(619675),F=s(853374),B=s(340395),D=P.HeaderHeight,E=D,V=(0,m.lazyProperties)({panel:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",backgroundColor:k.Color.gray400}),panelInline:()=>n.Styles.createViewStyle({backgroundColor:k.Color.transparent}),gestureOverlay:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:k.Color.transparent}),header:()=>(0,m.lazyProperties)({innerContainer:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center"}),headerControlWrap:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center"}),container:()=>n.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch",backgroundColor:k.Color.gray400,height:D}),title:()=>n.Styles.createTextStyle({color:k.Color.white,marginRight:5})}),modal:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:k.Color.transparent,overflow:"visible"}),emptyViewWrapper:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,padding:20,backgroundColor:k.Color.gray400,alignItems:"center",justifyContent:"center"}),emptyViewWrapperFullHeight:()=>n.Styles.createViewStyle({bottom:0}),emptyViewText:()=>n.Styles.createTextStyle({color:k.Color.white,textAlign:"center"})});class N extends l.default{constructor(){super(...arguments),this._hasShownAlbum=!1,this._isDragging=!1,this._contentTransform=0,this._headerAnimatedTransfromValue=new n.Animated.Value(-120),this._headerAnimatedTransfromStyle=n.Styles.createAnimatedViewStyle({transform:[{translateY:this._headerAnimatedTransfromValue}]}),this._contentAnimatedTransfromValue=new n.Animated.Value(n.UserInterface.measureWindow().height),this._contentAnimatedOpacityValue=new n.Animated.Value(1),this._contentAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{translateY:this._contentAnimatedTransfromValue}]}),this._contentAnimatedOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._contentAnimatedOpacityValue}),this._emptyViewAnimatedHeightValue=new n.Animated.Value(100),this._emptyViewAnimatedHeightStyle=n.Styles.createAnimatedViewStyle({height:this._emptyViewAnimatedHeightValue}),this._onPan=e=>{this._interestedInGesture=!1,e.isComplete&&(this._interestedInGesture=void 0,this._isDragging=!1)},this._onPanVertical=e=>{void 0===this._interestedInGesture&&(this._interestedInGesture=!0);let t=0;if(this._interestedInGesture){t=e.pageY-e.initialPageY;let s=this._contentTransform+t;s<0&&(s=0),this._contentAnimatedTransfromValue.setValue(s);const i=E+this.state.statusBarPadding,o=this.state.viewDimensions.height-i-s;this.props.mediaPickerMode===d.MediaPickerMode.InlinePeekaboo&&this._emptyViewAnimatedHeightValue.setValue(o),this._isDragging||(this._contentAnimatedOpacityValue.setValue(1),this._isDragging=!0)}if(e.isComplete){this._contentTransform+=t;let s=!1;e.velocityY<-.1?s=!0:e.velocityY<.1&&(s=this._contentTransform<this.state.viewDimensions.height/2),this._expandOrCollapse(s),this._interestedInGesture=void 0}},this._onScrolledToTop=e=>{this.isComponentMounted()&&this.setState({isScrolledToTop:e})},this._onPhotosLoaded=e=>{const t=e>0;this.isComponentMounted()&&this.state.hasPhotos!==t&&this.setState({hasPhotos:t})},this._onLayoutChanged=e=>{const t={height:e.height,width:e.width};(0,g.default)(this.state.viewDimensions,t)||this.setState({viewDimensions:t})},this._onAlbumChange=e=>{e.stopPropagation(),this.isComponentMounted()&&this.setState({showAlbumPicker:!0})},this._onCloseAlbumPicker=e=>{if(this._hasShownAlbum||e){if(this.isComponentMounted()){const t=!1;let s=this.state.currentAlbumName,i=this.state.hasPhotos;e&&e!==this.state.currentAlbumName&&(s=e,i=!0),this.setState({showAlbumPicker:t,currentAlbumName:s,hasPhotos:i})}}else this._close()},this._onClose=()=>{this._close(),this.props.onClose&&this.props.onClose()},this._onMediaItemSelected=(e,t,s,i)=>{if(this._isDragging)return;if(this._captureSessionTelemetry=new _.CaptureSession(h.PostSource.MediaPicker),!this.props.allowMultiple)return void(s&&!this._exceedsMaxVideoLength(t)&&this._editMediaSelection([t]));let n=this.state.selectedItems.slice(0);s?o.find(n,(t=>t.id===e))||n.push(t):n=o.filter(n,(t=>t.id!==e)),this.setState({selectedItems:n,selectedItemsCount:n.length})},this._onMediaPickerReset=()=>{this.setState({selectedItems:[],selectedItemsCount:0})},this._onNext=e=>{const t=F.default.newCauseId();if(p.log(h.LogTraceArea.MediaPickerPanel,"MediaPickerPanel._onNext",t),0===this.state.selectedItemsCount)return;o.some(this.state.selectedItems,(e=>this._exceedsMaxVideoLength(e)))||(1===this.state.selectedItemsCount||this._isMediaPreviewEnabled()?this._editSelectedPhoto():this._sendSelectedPhotos(t))},this._onSendFlowComplete=()=>{const e=F.default.newCauseId();p.log(h.LogTraceArea.MediaPickerPanel,"MediaPickerPanel._onSendFlowComplete",e),this.props.onSendFlowComplete?this.props.onSendFlowComplete():this.props.conversationId?T.default.navigateToConversation({convId:this.props.conversationId,origin:h.NavigationConversationOrigin.MediaPicker,causeId:e}):T.default.navigateToHub(e)},this._onMediaPickerWrapperViewRef=e=>{this._mediaPickerWrapperView=e||void 0},this._onCenterControlsRef=e=>{this._centerControls=e||void 0},this._isMediaPreviewEnabled=()=>this.props.conversationId&&C.default.isMediaPreviewEnabled(this.props.conversationId)}_buildState(e,t){const s={statusBarPadding:M.default.statusBarPadding(),isMobileScreenReaderEnabled:w.default.isMobileScreenReaderEnabled(),maxSelectionCount:e.allowMultiple?a.default.getS4LMessagingFeaturesNoSubscription().limitForFilePicker:0,disableGifs:a.default.getS4LMessagingFeatures().disableGifsInMediaPicker,maxVideoDurationOnMobileMin:a.default.getS4LCMCFeatures().maxVideoDurationOnMobileMin};if(t){const t=e.mediaPickerMode||d.MediaPickerMode.Default;s.selectedItems=[],s.selectedItemsCount=0,s.currentAlbumName="",s.nextButtonDisabled=!0,s.showAlbumPicker=!!e.defaultToAlbums,s.thumbnailSize=0,s.isExpanded=t!==d.MediaPickerMode.InlinePeekaboo,s.isScrolledToTop=!0,s.viewDimensions={width:0,height:0},s.hasPhotos=!0,this._contentTransform=e.hidden?n.UserInterface.measureWindow().height:0,b.default.markAnimatedValue(this._contentAnimatedTransfromValue,this._contentTransform),b.default.markAnimatedValue(this._contentAnimatedOpacityValue,1);const i=e.hidden||e.mediaPickerMode===d.MediaPickerMode.InlinePeekaboo?-1*(E+s.statusBarPadding):0;b.default.markAnimatedValue(this._headerAnimatedTransfromValue,i)}return s}componentDidMount(){super.componentDidMount(),this.props.mediaPickerMode===d.MediaPickerMode.InlinePeekaboo&&this._expandOrCollapse(this.state.isExpanded,!1),this._hasShownAlbum=!this.state.showAlbumPicker,this.state.isExpanded&&!this.props.preventAccessibilityFocus&&this._centerControls&&(p.log(h.LogTraceArea.MediaPickerPanel,"componentDidMount, focus center controls"),this._focusCenterControlWithDelay())}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._hasShownAlbum||this.state.showAlbumPicker||(this._hasShownAlbum=!0);const i=this._mediaPickerMode();if(i!==d.MediaPickerMode.Default){if(this.props.thumbnailPeek===e.thumbnailPeek&&this.state.viewDimensions.height===t.viewDimensions.height||this.state.isExpanded||this._expandOrCollapse(this.state.isExpanded,!1),this.props.hidden!==e.hidden){const e=this.props.hidden||i===d.MediaPickerMode.InlinePeekaboo;this._expandOrCollapse(!e)}this.props.onExpanded&&this.state.isExpanded!==t.isExpanded&&this.props.onExpanded(this.state.isExpanded),this.state.isExpanded&&!t.isExpanded&&!this.props.preventAccessibilityFocus&&this._centerControls&&(p.log(h.LogTraceArea.MediaPickerPanel,"componentDidUpdate, focus center controls"),this._focusCenterControlWithDelay())}}handleBackAction(){return!(!this.state.isExpanded||this._mediaPickerMode()!==d.MediaPickerMode.InlinePeekaboo)&&(this._expandOrCollapse(!1),!0)}expandOrCollapse(e,t=!0){this._expandOrCollapse(e,t)}_mediaPickerMode(){return this.props.mediaPickerMode||d.MediaPickerMode.Default}_focusCenterControlWithDelay(){const e=this._getContext().isPresentedByMobileStackNavigator?100:500;o.delay((()=>{this.isComponentMounted()&&this.state.isExpanded&&this._centerControls&&(p.log(h.LogTraceArea.MediaPickerPanel,"Focussed center controls after delay: "+e),this._centerControls.requestFocus())}),e)}_expandOrCollapse(e,t=!0,s=!0){if(0===this.state.viewDimensions.height)return;const i=E+this.state.statusBarPadding,o=this.props.hidden?-60:this.props.thumbnailPeek||-60,r=e?0:this.state.viewDimensions.height-i-o,a=e?0:-1*(i+50),l=e?1:.75,c=this.state.viewDimensions.height-i-r;if(this.state.isExpanded!==e&&(this.props.onExpanded&&this.props.onExpanded(e),e||this.props.mediaPickerMode!==d.MediaPickerMode.InlinePeekaboo||this.props.hidden||this._mediaPickerWrapperView&&this._mediaPickerWrapperView.scrollToTop()),p.log(h.LogTraceArea.MediaPickerPanel,"_expandOrCollapse",e),t){const t=300;n.Animated.parallel([b.default.timing(this._contentAnimatedTransfromValue,{toValue:r,duration:t,easing:e||this.props.hidden?n.Animated.Easing.Out():n.Animated.Easing.OutBack(),useNativeDriver:!0}),b.default.timing(this._contentAnimatedOpacityValue,{toValue:l,duration:t,easing:n.Animated.Easing.Out(),useNativeDriver:!0}),b.default.timing(this._headerAnimatedTransfromValue,{toValue:a,duration:t,easing:n.Animated.Easing.Out(),useNativeDriver:!0})]).start((t=>{this.state.isExpanded!==e&&s&&this.isComponentMounted()&&this.setState({isExpanded:e}),this._isDragging=!1})),this.props.mediaPickerMode===d.MediaPickerMode.InlinePeekaboo&&n.Animated.timing(this._emptyViewAnimatedHeightValue,{toValue:c,duration:t,easing:n.Animated.Easing.Out()}).start()}else this._contentAnimatedTransfromValue.setValue(r),this._contentAnimatedOpacityValue.setValue(l),this._headerAnimatedTransfromValue.setValue(a),this.props.mediaPickerMode===d.MediaPickerMode.InlinePeekaboo&&this._emptyViewAnimatedHeightValue.setValue(c),this.state.isExpanded!==e&&s&&this.isComponentMounted()&&this.setState({isExpanded:e}),this._isDragging=!1;this._contentTransform=r}render(){const e=[V.header.container,this._headerAnimatedTransfromStyle];this.state.statusBarPadding&&e.push(I.default.heightStyle(D+this.state.statusBarPadding));const t=(0,i.jsx)(v.default,{ref:this._onMediaPickerWrapperViewRef,maxSelectionCount:this.state.maxSelectionCount,disableGifs:this.state.disableGifs,mediaType:this.props.allowVideo?d.MediaType.All:d.MediaType.PhotoOnly,albumName:this.state.currentAlbumName,disableScrolling:!this.state.isExpanded,darkTheme:!0,pauseLoading:this.props.pauseLoading||this.props.defaultToAlbums&&!this.state.currentAlbumName,onClose:this._onClose,onItemSelected:this._onMediaItemSelected,onReset:this._onMediaPickerReset,onScrolledToTop:this._onScrolledToTop,onPhotosLoaded:this._onPhotosLoaded,screenChangeOnSelection:this.props.screenChangeOnSelection},"mediapickernative"),s=[V.emptyViewWrapper];this.props.mediaPickerMode===d.MediaPickerMode.InlinePeekaboo?s.push(this._emptyViewAnimatedHeightStyle):s.push(V.emptyViewWrapperFullHeight);const o=this.state.hasPhotos?void 0:(0,i.jsx)(n.Animated.View,Object.assign({style:s,blockPointerEvents:!0},{children:(0,i.jsx)(L.BodyText,Object.assign({size:L.BodyTextSize.BigDeprecated,style:V.emptyViewText},{children:S.getString("MediaPickerPanel.EmptyAlbumMessage")}))}),"emptyWrapper");let r=this.state.hasPhotos?t:o;const a=this._mediaPickerMode();a!==d.MediaPickerMode.Default&&(a===d.MediaPickerMode.InlinePeekaboo&&(r=(0,i.jsx)(n.GestureView,Object.assign({style:O.default.flexOne,onPanVertical:!this.state.isExpanded||this.state.isScrolledToTop?this._onPanVertical:this._onPan,panPixelThreshold:20,releaseOnRequest:!0,importantForAccessibility:n.Types.ImportantForAccessibility.No},{children:r}))),r=(0,i.jsx)(n.Animated.View,Object.assign({style:[O.default.flexOne,this._contentAnimatedStyle,this._contentAnimatedOpacityStyle],importantForAccessibility:this.state.showAlbumPicker?n.Types.ImportantForAccessibility.NoHideDescendants:n.Types.ImportantForAccessibility.No},{children:r}),"content"));const l=this.state.showAlbumPicker?(0,i.jsx)(n.View,Object.assign({style:V.modal},{children:(0,i.jsx)(f.MediaAlbumPicker,{disableGifs:this.state.disableGifs,onClose:this._onCloseAlbumPicker,mediaType:this.props.allowVideo?d.MediaType.All:d.MediaType.PhotoOnly})}),"albumpicker"):void 0,c=[V.panel];a!==d.MediaPickerMode.Default&&c.push(V.panelInline);const h={icon:a===d.MediaPickerMode.InlinePeekaboo?A.SkypeIcon.DownChevron:x.closeIcon(),title:S.getString("MediaPickerPanel.CloseMediaPanelAccessibilityLabel"),onPress:this._onClose,color:k.Color.white},u=this.state.selectedItemsCount>1&&!this._isMediaPreviewEnabled(),p=this.props.allowMultiple&&(this.state.selectedItemsCount>0||u)?{icon:u?A.SkypeIcon.Send:x.navForwardIcon(!0),title:u?S.getString("Global.SendButtonTitle"):S.getString("Global.NextButtonTitle"),color:k.Color.blue,onPress:this._onNext,flipIcon:u&&this._getContext().isRTL}:void 0,g=this.state.isMobileScreenReaderEnabled?void 0:(0,i.jsx)(n.GestureView,{style:V.gestureOverlay});return(0,i.jsxs)(n.View,Object.assign({style:c,onLayout:this._onLayoutChanged,ignorePointerEvents:!0,importantForAccessibility:this.props.preventAccessibilityFocus||!this.state.isExpanded?n.Types.ImportantForAccessibility.NoHideDescendants:void 0},{children:[(0,i.jsx)(B.default,{statusBarKey:"MediaPickerPanel",backgroundColor:k.Color.black,barStyle:B.BarStyle.LIGHT_CONTENT,animated:!0}),(0,i.jsxs)(n.Animated.View,Object.assign({style:e,importantForAccessibility:this.state.showAlbumPicker?n.Types.ImportantForAccessibility.NoHideDescendants:void 0},{children:[g,(0,i.jsx)(P.SimplePanelHeader,{titleView:this._getHeaderCenterControls(),leftButton:h,rightButtons:p,useTransparentBackground:!0})]}),"header"),r,l]}))}_getHeaderCenterControls(){const e=0===this.state.selectedItemsCount,t=e?this.state.currentAlbumName||S.getString("MediaPickerPanel.Title"):S.getString("MediaPickerPanel.SelectedTitle",{count:this.state.selectedItemsCount,total:this.state.maxSelectionCount}),s=e?(0,i.jsx)(u.default,{icon:A.SkypeIcon.DownChevron,size:A.IconSize.size12,color:k.Color.white}):void 0,o=e?c.default.combinedAccessibilityLabel(t,S.getString("MediaPickerPanel.ChangeAlbum")):S.getString("MediaPickerPanel.SelectedAccessibilityTitle",{count:this.state.selectedItemsCount,total:this.state.maxSelectionCount});return(0,i.jsx)(n.View,Object.assign({style:V.header.headerControlWrap,onPress:e?this._onAlbumChange:void 0,ref:this._onCenterControlsRef,accessibilityTraits:e?n.Types.AccessibilityTrait.Button:void 0,accessibilityLabel:o,importantForAccessibility:this.state.isExpanded?n.Types.ImportantForAccessibility.Yes:n.Types.ImportantForAccessibility.NoHideDescendants,tabIndex:0},{children:(0,i.jsxs)(n.View,Object.assign({style:V.header.innerContainer},{children:[(0,i.jsx)(L.PanelHeader,Object.assign({style:V.header.title,numberOfLines:1},{children:t})),s]}))}))}_close(){const e=F.default.newCauseId();p.log(h.LogTraceArea.MediaPickerPanel,"MediaPickerPanel._close, causeId: "+e),this._mediaPickerMode()===d.MediaPickerMode.InlinePeekaboo?this._expandOrCollapse(!1):this.props.onBackPressed&&this.props.onBackPressed()||T.default.closeMediaPickerPanel(e,this._getContext())}_editSelectedPhoto(){if(0===this.state.selectedItems.length)return;const e=this.state.selectedItems;this._editMediaSelection(e)}_editMediaSelection(e){if(!e)return;const t=this.props.capturedContentHandler;if(!t)return;const s=e.map((e=>{const s=e.node,i=!s.node.isPhoto,o=s.node.image.thumbnailUri;return{localMediaObjectUri:s.node.image.uri,fileSize:void 0,width:s.node.image.width,height:s.node.image.height,localMediaThumbnailUri:o,localMediaIsVideo:i,mediaSelection:e,conversationId:this.props.conversationId,onCaptureFlowComplete:this._onSendFlowComplete,capturedContentHandler:t,captureSessionTelemetry:this._captureSessionTelemetry,entryPoint:h.PostSource.MediaPicker,unlockOrientation:!0,skipShareWithPanel:!!this.props.conversationId,onReject:this._onClose}}));this.props.onHandleEditMediaSelection?this.props.onHandleEditMediaSelection(s):T.default.navigateToCapturePreview(s[0])}_sendSelectedPhotos(e){if(!this.props.conversationId)return void p.error(h.LogTraceArea.MediaPickerPanel,"MediaPickerPanel: must have a conversationId to send multiple photos. causeId:"+e);const t=this.state.selectedItems,s=this._captureSessionTelemetry;delete this._captureSessionTelemetry,s&&s.setMediaCount(t.length),y.default.postMediaSelections(t,this.props.conversationId,h.PostSource.MediaPicker,{},s,e),this._close()}_exceedsMaxVideoLength(e){const t=60*this.state.maxVideoDurationOnMobileMin+1,s=!e.node.node.isPhoto&&e.node.node.image.duration;if(s&&s>=t){r.default.showOKAlert("",S.getString("MediaPickerPanel.ItemCannotBeSelected",{count:this.state.maxVideoDurationOnMobileMin}),this._getRootViewId());const e=F.default.newCauseId();p.log(h.LogTraceArea.MediaPickerPanel,"MediaPickerPanel._exceedsMaxVideoLength: Max Video Length Exceeded"+e);const t=new _.FileRejectedByClient(R.UploadFileType.Video,h.PostSource.MediaPicker,_.FileRejectedReason.VideoDuration),i=+(s/60).toFixed(2);return t.setVideoDurationDetails(this.state.maxVideoDurationOnMobileMin,i),p.track(t),!0}return!1}}t.MediaPickerPanel=N,t.default=N},723752:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(1706),a=s(889391),l=s(338173),d=s(282773),c=s(422801),h=s(476621),u=s(351077),p=s(61375),g=s(671830),m=s(400984),S=s(417677),f=s(703871),y=s(677381),v=s(539549),C=s(882261),_=s(986374),b=s(952262),T=s(770891),M=s(746096),I=s(136400),w=s(436237),P=s(915877),k=s(540522),A=s(733754),x=s(312762),R=s(312762),O=s(475043),L=s(844972),F=s(18078),B=s(104735),D=s(785207),E=s(29130),V=s(914976),N=s(829034),U=s(279829),j=s(677914),H=s(700960),z=s(404057),W=s(981531),G=s(581760),K=s(311010),q=s(360305),Q=s(203109),X=s(177878),$=s(626712),J=s(853374),Y=s(913944),Z=s(711828),ee=s(680837),te=(0,P.lazyProperties)({messageContentsViewContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),atMentionMe:()=>n.Styles.createTextStyle({font:K.default.font.uiDisplaySemibold,color:G.Color.orange}),mentionIconStyle:()=>n.Styles.createTextStyle({color:G.Color.whiteOverlay50,backgroundColor:G.Color.transparent,marginTop:-3,marginBottom:4}),inlineViewWrapper:()=>n.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",flex:1}),reportedMessageStyle:()=>n.Styles.createTextStyle({fontStyle:"italic"}),translationContainer:()=>n.Styles.createViewStyle({flexDirection:"column"}),translateLinkStyleRight:()=>n.Styles.createTextStyle({textAlign:"right"}),translateLinkStyleLeft:()=>n.Styles.createTextStyle({textAlign:"left"}),translateLinkHoveredStyle:()=>n.Styles.createTextStyle({opacity:1}),translateIcon:()=>n.Styles.createViewStyle({paddingHorizontal:10,paddingVertical:6,borderRadius:8,width:40,height:32,marginLeft:10}),translateIconWrapper:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"nowrap",alignContent:"stretch"})});class se extends y.default{constructor(){super(...arguments),this._onToggleTranslationPressed=()=>{this.props.options&&this.props.options.onToggleTranslation&&this.props.options.onToggleTranslation()},this._onToggleTranslationOptionsPressed=()=>{var e,t,s,i;if(this.props.options&&this.props.options.onToggleTranslateOptions){const o=null===(e=this.state.translateMetadata)||void 0===e?void 0:e.oloc,n=null===(i=null===(s=null===(t=this.state.translateMetadata)||void 0===t?void 0:t.translations)||void 0===s?void 0:s[0])||void 0===i?void 0:i.loc;this.props.options.onToggleTranslateOptions(this._translateOptionsButtonRef,o,n)}},this._getTranslateButtonRef=e=>{this._translateOptionsButtonRef=e||void 0}}_buildState(e,t){const s=a.default.getS4LCMCFeatures(),i={cmcFeatures:s,isOwnMessage:F.default.isMyMri(e.message.creator),enableMessageTranslation:s.enableMessageTranslation,enableOneMessageTranslation:s.enableOneMessageTranslation};t&&(i.onFollowQuoteLinkDefault=(e,t,s)=>{if(e.preventDefault(),h.default.getConversationMetaFromMemoryCache(t)){const e=J.default.newCauseId();w.log(M.LogTraceArea.MessageContent,"MessageContent.onFollowQuoteLinkDefault, causeId: "+e),B.default.navigateToConversation({convId:t,scrollToTimestamp:s,forceRefreshFocus:!0,origin:M.NavigationConversationOrigin.QuoteLink,causeId:e})}},i.onSwiftReplyActionLinkDefault=(t,s,i=[])=>{t.preventDefault();const o=C.createSwiftResponseMessageInfo(e.message.conversationId,M.PostSource.SwiftReply,s,i,e.message.creator);D.default.postMessage(o)},i.onSwiftSkypeUriActionLinkDefault=(t,s,i)=>{t.preventDefault();const o=J.default.newCauseId();w.log(M.LogTraceArea.MessageContent,"MessageContent.onSwiftSkypeUriActionLinkDefault, causeId: "+o);const n=s.substring(6),a=n.split("?")[0];if("add_to_this_conversation"===n.split("?")[1]){const t=(0,v.default)().getConversation(e.message.conversationId);if(t&&t.isThread()){const s=(0,L.isModerated)(t);c.default.serviceAddMemberToThread(e.message.conversationId,a,p.AddMemberToThreadSource.SwiftCard,!s).fail((()=>{w.log(M.LogTraceArea.MessageContent,"Could not add "+V.mriOrId(a)+" to "+V.mriOrId(e.message.conversationId)+": Chat service request failed.")}))}else if(m.default.isContact(a))h.default.ensureConversationLoadedOrFaked(a).then((()=>{B.default.navigateToConversation({convId:a,origin:M.NavigationConversationOrigin.SwiftCardLink,causeId:o})}));else{const e=r.default.getAgentDescriptionForMri(a);l.default.addAgentAsContact(e.agentId).then((()=>{h.default.ensureConversationLoadedOrFaked(a).then((()=>{B.default.navigateToConversation({convId:a,isNewConversation:!0,origin:M.NavigationConversationOrigin.SwiftCardLink,causeId:o})}))}),(()=>{w.log(M.LogTraceArea.MessageContent,"Failed to add agent from the swift card")}))}}else w.log(M.LogTraceArea.MessageContent,"Unsupported skype uri query")},i.onOAuthActionLinkDefault=(t,s,i)=>{t.preventDefault();const o=J.default.newCauseId();if(w.log(M.LogTraceArea.MessageContent,"MessageContent.onOAuthActionLinkDefault, causeId: "+o),s&&i){const t=s+"&userid="+encodeURIComponent(F.default.getSkypeId())+"&threadid="+encodeURIComponent(e.message.conversationId);$.default.isUrlValid(t)&&k.openUrlWithParams({origin:M.BrowserOrigin.AuthActionLink,url:t,options:{onNavigationStateChange:e=>{e.url.startsWith(i)&&B.default.closeInAppBrowser(o,this._getContext())}},rootViewId:this._getRootViewId()})}},i.onCallInviteAccepted=t=>{j.default.acceptInvitation(t),w.track(new N.ScheduledCallRSVPEvent(U.ScheduleCallRSVPEntryPoint.MessageStream,U.ScheduledCallInvitationStatus.Accepted,e.message.conversationId,t))},i.onCallInviteDeclined=t=>{j.default.declineInvitation(t),w.track(new N.ScheduledCallRSVPEvent(U.ScheduleCallRSVPEntryPoint.MessageStream,U.ScheduledCallInvitationStatus.Declined,e.message.conversationId,t))});const n=(0,o.cloneDeep)(e.options||{});let y;if(n.message=e.message,i.isOwnMessage||m.default.isConversationAccepted(e.message.conversationId)||(n.blurMedia=!0,n.processing=n.processing||{},n.processing.links=T.ProcessingLevel.Stripped),n.onFollowQuoteLink||(n.onFollowQuoteLink=i.onFollowQuoteLinkDefault||this.state.onFollowQuoteLinkDefault),n.onSwiftReplyActionLink||(n.onSwiftReplyActionLink=i.onSwiftReplyActionLinkDefault||this.state.onSwiftReplyActionLinkDefault),n.onSwiftSkypeUriActionLink||(n.onSwiftSkypeUriActionLink=i.onSwiftSkypeUriActionLinkDefault||this.state.onSwiftSkypeUriActionLinkDefault),n.atMentionMeOverrideStyle||(n.atMentionMeOverrideStyle=te.atMentionMe),e.message.properties&&e.message.properties[u.MessageProperties.Prototype]&&(n.swiftCardState=z.default.parseJsonWithDefault(e.message.properties[u.MessageProperties.Prototype],{}),n.swiftCardState.disableActions=e.disableActions),n.swiftCardState||(n.swiftCardState={disableActions:e.disableActions}),n.isMobileScreenSize||(n.isMobileScreenSize=E.default.isMobileScreenSize(this._getRootViewId())),n.onOAuthActionLink||(n.onOAuthActionLink=i.onOAuthActionLinkDefault||this.state.onOAuthActionLinkDefault),n.onCallInviteAccepted||(n.onCallInviteAccepted=i.onCallInviteAccepted||this.state.onCallInviteAccepted),n.onCallInviteDeclined||(n.onCallInviteDeclined=i.onCallInviteDeclined||this.state.onCallInviteDeclined),e.wrapInQuote){const t=b.default.getDisplayName(e.message.creator,!0),s=S.quoteMessage(e.message,t);y=_.Parser.root([s])}else y=e.preDecodedMessage||_.decode(e.message),i.enableMessageTranslation&&n.hasTranslation&&(y=this._maybeTranslateQuotes(e,y,n));n.textOnlyForEmoticons=y.getNumberOfEmoticons()>a.default.dangerouslyGetS4LMessagingFeatures().maxNumberEmoticonsPerMessage,n.onPressSuggestedTextHighlight=t=>{var s;const i=null===(s=n.suggestedTextHighlights)||void 0===s?void 0:s.find((e=>e.phrase===t));if(!i||!i.sanitizedAction)return;const o=i.sanitizedAction;switch(o.type){case T.SwiftActionTypes.openUrl:W.default.handleOpenUrl(o,e.message.conversationId,this._getRootViewId());break;case T.SwiftActionTypes.openView:W.default.handleOpenView(o,e.message.conversationId,this._getRootViewId());case T.SwiftActionTypes.invoke:}W.default.textHighlightPressedTelemetry(o,e.message)};const I=e.message.messagetype===u.MessageTypes.Text,P=e.message.messagetype===u.MessageTypes.RichText,A=g.isAgent(e.message.creator);let x,R,H;if(e.message.isReported())x=this._renderReportedMessage(n);else if(n.urlPreviewData)x=f.renderLinkAsPreview(n);else{const t=g.isPhoneMri(e.message.conversationId),s=s=>{let i=Q.extraTextNodeParsing(s,!t&&(I||P&&A),!0,e.options&&e.options.suggestedTextHighlights);return i=(0,X.transformUnicodeEmojis)(i),i=this._maybeHighlightSearchResults(e,i),f.renderReact(i,n,e.searchStore)};if(x=s(y),(I||P)&&e.message.isBookmark()){const t=d.default.getBookmarkEditedMessage(e.message.cuid,e.message);if(t){w.log(M.LogTraceArea.Bookmarks,"Rendering new version of bookmark message.");R=s(_.decode(t))}}if(i.enableMessageTranslation&&n.hasTranslation){const t=O.default.getTranslatedMessage(e.message.conversationId,e.message.cuid);if(t){i.translateMetadata=u.getMessageTranslationMetadata(t.content);let o=_.decode(t);if(e.wrapInQuote){const e=b.default.getDisplayName(t.creator,!0),s=S.quoteMessage(t,e);o=_.Parser.root([s])}else if(u.hasQuote(e.message.content)){let t=y.getQuoteNodes();t=t.map((t=>this._translateQuoteNode(e.message.conversationId,t,!!i.isOwnMessage,!0))),o=_.Parser.root(t.concat([o]))}H=s(o)}}}return i.renderEditedBookmarkResult=R,i.renderTranslatedReact=H,i.renderResult=x,i}render(){var e,t,s;const r=this._getContentElement(),a=!!(null===(e=this.props.options)||void 0===e?void 0:e.conversationTranslated)&&this.state.renderTranslatedReact&&!q.default.isTabletNoSubscription(),l=!(null===(t=this.props.options)||void 0===t?void 0:t.conversationTranslated)&&this.state.renderTranslatedReact&&(null===(s=this.props.options)||void 0===s?void 0:s.showTranslatedMessage),d=(0,o.compact)([...Array.isArray(r)?r:[r],a&&this._getTranslateLink()]);if(this.state.renderResult.renderAsInline&&1===d.length&&!l)return r;const c=this.state.renderResult.renderAsInline;if(l){const e=c?te.inlineViewWrapper:te.messageContentsViewContainer,t=[this.state.renderTranslatedReact&&te.translationContainer];return(0,i.jsxs)(n.View,Object.assign({style:[e,te.translateIconWrapper],onLayout:c?void 0:this.props.onLayout},{children:[(0,i.jsx)(n.View,Object.assign({style:[t,ee.default.flexOne]},{children:d})),this._getTranslateIcon()]}),this.props.message.cuid)}const h=[c?te.inlineViewWrapper:te.messageContentsViewContainer,this.state.renderTranslatedReact&&te.translationContainer];return(0,i.jsx)(n.View,Object.assign({style:h,onLayout:c?void 0:this.props.onLayout},{children:d}),this.props.message.cuid)}_renderReportedMessage(e){const t=R.PlainTextNode.fromPlainText(A.getString("MessageContentNodes.ReportedMessageFallback")),s=_.Parser.root([t]);return e.textOverrideStyle=n.Styles.combine(e.textOverrideStyle,te.reportedMessageStyle),f.renderReact(s,e,this.props.searchStore)}_maybeHighlightSearchResults(e,t){var s,i;let o=!1;const n=F.default.isMyMri(e.message.creator),r=e.searchStore;let a;if(r){if(r.isMessageInConvSearchResults(e.message.cuid)){const t=r.getSearchQuery();t&&(o=r.isMessageFocused(e.message.cuid),a=t.query)}}else a=e.rawSearchQuery;return a&&(t=(0,H.highlightSearchResults)(t,a,o,n,null!==(i=null===(s=e.options)||void 0===s?void 0:s.isGlobalSearch)&&void 0!==i&&i)),t}_maybeTranslateQuotes(e,t,s){if(s.showTranslatedMessage)return t;const i=F.default.isMyMri(e.message.creator),o=t.getQuoteNodes().map((t=>this._translateQuoteNode(e.message.conversationId,t,i,!1)));return _.Parser.root(o.concat(t.children.filter((e=>!(e instanceof x.QuoteNode)))))}_translateQuoteNode(e,t,s,i){if(t&&t.cuid){const o=O.default.getTranslatedMessage(e,t.cuid);if(o){if(i!==(F.default.isMyMri(o.creator)!==s)){const e=b.default.getDisplayName(o.creator,!0);return S.quoteMessage(o,e)}}}return t}_getContentElement(){var e;return this.props.message.isBookmark()&&this.state.renderEditedBookmarkResult?this.state.renderEditedBookmarkResult.value:this.state.renderTranslatedReact&&(null===(e=this.props.options)||void 0===e?void 0:e.showTranslatedMessage)?this.state.renderTranslatedReact.value:this.state.renderResult.value}_getTranslateLink(){if(!this.props.options||this.props.wrapInQuote)return null;const e=`${this.props.message.cuid}-link`,t=[this.props.options.translationLinkStyle,K.default.fontStyle.captionSelected,this.state.isOwnMessage?te.translateLinkStyleRight:te.translateLinkStyleLeft],s=this.props.options.showTranslatedMessage?A.getString("Translator.MessageShowOriginal"):A.getString("Translator.MessageShowTranslation"),o=this.props.options.showTranslatedMessage?A.getString("Translator.MessageShowTranslation"):A.getString("Translator.MessageShowOriginal");return(0,i.jsx)(n.View,Object.assign({accessibilityLabel:o,accessibilityTraits:n.Types.AccessibilityTrait.Switch,onPress:this._onToggleTranslationPressed,importantForAccessibility:n.Types.ImportantForAccessibility.Yes},{children:(0,i.jsx)(I.HoverableLink,Object.assign({url:"#",style:t,hoverStyle:te.translateLinkHoveredStyle,onPress:this._onToggleTranslationPressed},{children:s}),e)}))}_getTranslateIcon(){if(!this.props.options||this.props.wrapInQuote)return null;const e=`${this.props.message.cuid}-btn`,t=n.Styles.combine([te.translateIcon,this.props.options.translationIconStyle]),s=A.getString("Translator.TranslationOptions");return(0,i.jsx)(n.View,Object.assign({style:t,ref:this._getTranslateButtonRef,onPress:this._onToggleTranslationOptionsPressed},{children:(0,i.jsx)(Y.default,{size:Z.IconSize.size20,color:this._getContext().themeColors.primaryIconColor||G.Color.black,icon:Z.SkypeIcon.SkypeTranslatorNew,title:s,accessibilityLabel:s,accessibilityTraits:n.Types.AccessibilityTrait.Button,onPress:this._onToggleTranslationOptionsPressed,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,tabIndex:0},e)}))}}t.default=se},276093:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(285788),n=s(516778),r=s(889391),a=s(38566),l=s(351077),d=s(770891),c=s(746096),h=s(139889),u=s(136400),p=s(913944),g=s(110117),m=s(436237),S=s(915877),f=s(540522),y=s(733754),v=s(265822),C=s(812056),_=s(520849),b=s(617707),T=s(758962),M=s(886045),I=s(581760),w=s(311010),P=s(711828),k=s(619675),A=s(24576),x=s(994214),R=s(675865),O=s(853374),L=s(803729),F=(0,S.lazyProperties)({mojiContainer:()=>n.Styles.createViewStyle({flexDirection:"row"}),playButtonContainer:()=>n.Styles.createViewStyle({backgroundColor:I.Color.blackOverlay50,alignItems:"center",justifyContent:"center",width:64,height:64,borderRadius:32}),playButtonContainerMedium:()=>n.Styles.createViewStyle({width:48,height:48,borderRadius:24}),alternateTextLink:()=>n.Styles.createTextStyle({lineHeight:16}),alternateTextLinkDarkTheme:()=>n.Styles.createTextStyle({color:I.Color.white}),alternateTextLinkHover:()=>n.Styles.createTextStyle({color:I.Color.blue}),metadataContainer:()=>n.Styles.createViewStyle({marginTop:8,marginHorizontal:8,flex:-1}),metadataPreview:()=>n.Styles.createViewStyle({marginLeft:-44}),description:()=>n.Styles.createTextStyle({lineHeight:16}),descriptionDarkTheme:()=>n.Styles.createTextStyle({color:I.Color.gray200}),copyright:()=>n.Styles.createTextStyle({lineHeight:16}),copyrightDarkTheme:()=>n.Styles.createTextStyle({color:I.Color.gray200}),metdataTextRight:()=>n.Styles.createTextStyle({textAlign:"right",lineHeight:16}),metdataTextBottom:()=>n.Styles.createTextStyle({textAlign:"center"}),mojiContainerCentered:()=>n.Styles.createViewStyle({alignSelf:"center"}),replayButtonContainer:()=>n.Styles.createViewStyle({flexDirection:"column",paddingHorizontal:60}),replayButton:()=>n.Styles.createViewStyle({justifyContent:"center",position:"absolute",width:P.IconSize.size60,top:0,right:0,left:0,bottom:0}),sendButtonWrapper:()=>n.Styles.createViewStyle({position:"absolute",right:0,left:0,top:0,bottom:0,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:I.Color.blueOverlay70}),transparentView:()=>n.Styles.createViewStyle({opacity:0}),opaqueView:()=>n.Styles.createViewStyle({opacity:1}),flippedView:()=>n.Styles.createViewStyle({transform:[{scaleX:-1}]})}),B=(0,S.lazyProperties)({mojiExtraLarge:()=>({mojiVideoContainer:n.Styles.createButtonStyle({width:T.frameHeights.moji.Size232,height:T.frameHeights.moji.Size232,alignItems:"center",justifyContent:"center"}),mojiMaskSize:T.frameHeights.moji.Size232,mojiMask:n.Styles.createTextStyle({position:"absolute",top:0,left:0,fontSize:T.frameHeights.moji.Size232+4,width:T.frameHeights.moji.Size232+4,height:T.frameHeights.moji.Size232+4}),mojiPlaceholder:n.Styles.createViewStyle({width:T.frameHeights.moji.Size232,height:T.frameHeights.moji.Size232,backgroundColor:I.Color.gray200,justifyContent:"center",alignItems:"center"}),thumbnailContainer:n.Styles.createViewStyle({width:T.frameHeights.moji.Size232,height:T.frameHeights.moji.Size232,alignItems:"center",justifyContent:"center"}),thumbnailImage:n.Styles.createImageStyle({position:"absolute",top:0,left:0,width:T.frameHeights.moji.Size232,height:T.frameHeights.moji.Size232}),video:n.Styles.createViewStyle({position:"absolute",top:0,left:0,width:T.frameHeights.moji.Size232,height:T.frameHeights.moji.Size232}),sendButtonSize:P.IconSize.size24}),mojiLarge:()=>({mojiVideoContainer:n.Styles.createButtonStyle({width:T.frameHeights.moji.Size200,height:T.frameHeights.moji.Size200,alignItems:"center",justifyContent:"center"}),mojiMaskSize:T.frameHeights.moji.Size200,mojiMask:n.Styles.createTextStyle({position:"absolute",top:0,left:0,fontSize:T.frameHeights.moji.Size200,width:T.frameHeights.moji.Size200,height:T.frameHeights.moji.Size200}),mojiPlaceholder:n.Styles.createViewStyle({width:T.frameHeights.moji.Size200,height:T.frameHeights.moji.Size200,backgroundColor:I.Color.gray200,justifyContent:"center",alignItems:"center"}),thumbnailContainer:n.Styles.createViewStyle({width:T.frameHeights.moji.Size200,height:T.frameHeights.moji.Size200,alignItems:"center",justifyContent:"center"}),thumbnailImage:n.Styles.createImageStyle({position:"absolute",top:0,left:0,width:T.frameHeights.moji.Size200,height:T.frameHeights.moji.Size200}),video:n.Styles.createViewStyle({position:"absolute",top:0,left:0,width:T.frameHeights.moji.Size200,height:T.frameHeights.moji.Size200}),sendButtonSize:P.IconSize.size20}),mojiMedium:()=>({mojiVideoContainer:n.Styles.createButtonStyle({width:T.frameHeights.moji.Size108,height:T.frameHeights.moji.Size108,alignItems:"center",justifyContent:"center"}),mojiMaskSize:T.frameHeights.moji.Size108+10,mojiMask:n.Styles.createTextStyle({position:"absolute",top:0,left:0,fontSize:T.frameHeights.moji.Size108+1,width:T.frameHeights.moji.Size108+1,height:T.frameHeights.moji.Size108+1}),mojiPlaceholder:n.Styles.createViewStyle({width:T.frameHeights.moji.Size108,height:T.frameHeights.moji.Size108,backgroundColor:I.Color.gray200,justifyContent:"center",alignItems:"center"}),thumbnailContainer:n.Styles.createViewStyle({width:T.frameHeights.moji.Size108,height:T.frameHeights.moji.Size108,alignItems:"center",justifyContent:"center"}),thumbnailImage:n.Styles.createImageStyle({position:"absolute",top:0,left:0,width:T.frameHeights.moji.Size108,height:T.frameHeights.moji.Size108}),video:n.Styles.createViewStyle({position:"absolute",top:0,left:0,width:T.frameHeights.moji.Size108,height:T.frameHeights.moji.Size108,borderRadius:16}),sendButtonSize:P.IconSize.size24}),mojiMediumSmall:()=>({mojiVideoContainer:n.Styles.createButtonStyle({width:T.frameHeights.moji.Size80,height:T.frameHeights.moji.Size80,alignItems:"center",justifyContent:"center"}),mojiMaskSize:T.frameHeights.moji.Size80+4,mojiMask:n.Styles.createTextStyle({position:"absolute",top:0,left:0,fontSize:T.frameHeights.moji.Size80+4,width:T.frameHeights.moji.Size80+4,height:T.frameHeights.moji.Size80+4}),mojiPlaceholder:n.Styles.createViewStyle({width:T.frameHeights.moji.Size80,height:T.frameHeights.moji.Size80,backgroundColor:I.Color.gray200,justifyContent:"center",alignItems:"center"}),thumbnailContainer:n.Styles.createViewStyle({width:T.frameHeights.moji.Size80,height:T.frameHeights.moji.Size80,alignItems:"center",justifyContent:"center"}),thumbnailImage:n.Styles.createImageStyle({position:"absolute",top:0,left:0,width:T.frameHeights.moji.Size80,height:T.frameHeights.moji.Size80}),video:n.Styles.createViewStyle({position:"absolute",top:0,left:0,width:T.frameHeights.moji.Size80,height:T.frameHeights.moji.Size80}),sendButtonSize:P.IconSize.size16}),mojiSmall:()=>({mojiVideoContainer:n.Styles.createButtonStyle({width:T.frameHeights.moji.Size40,height:T.frameHeights.moji.Size40,alignItems:"center",justifyContent:"center"}),mojiMaskSize:T.frameHeights.moji.Size40+2,mojiMask:n.Styles.createTextStyle({position:"absolute",top:0,left:0,fontSize:T.frameHeights.moji.Size40+2,width:T.frameHeights.moji.Size40+2,height:T.frameHeights.moji.Size40+2}),mojiPlaceholder:n.Styles.createViewStyle({width:T.frameHeights.moji.Size40,height:T.frameHeights.moji.Size40,backgroundColor:I.Color.gray200,justifyContent:"center",alignItems:"center"}),thumbnailContainer:n.Styles.createViewStyle({width:T.frameHeights.moji.Size40,height:T.frameHeights.moji.Size40,alignItems:"center",justifyContent:"center"}),thumbnailImage:n.Styles.createImageStyle({position:"absolute",top:0,left:0,width:T.frameHeights.moji.Size40,height:T.frameHeights.moji.Size40}),video:n.Styles.createViewStyle({position:"absolute",top:0,left:0,width:T.frameHeights.moji.Size40,height:T.frameHeights.moji.Size40}),sendButtonSize:P.IconSize.size16})});class D extends A.default{constructor(){super(...arguments),this._audioManagerClient=new a.default(a.AudioManagerSource.Moji),this._onAuxiliaryUrlLinkPress=()=>{this.state.mojiMetadata&&this.state.mojiMetadata.auxiliaryUrl&&f.openUrlWithParams({origin:c.BrowserOrigin.Moji,url:this.state.mojiMetadata.auxiliaryUrl,rootViewId:this._getRootViewId()})},this._onVideoWithTelemetryRef=e=>{this._videoWithTelemetry=e||void 0},this._onSend=e=>{e.stopPropagation(),this.props.isPreviewModeOn&&this.props.onSend()},this._onReplay=e=>{e.stopPropagation(),this.state.isVideoLoaded&&this._videoWithTelemetry&&(this._videoWithTelemetry.seek(0),this.setState({isPlaying:!0}))},this._onMojiContainerPress=e=>{e.stopPropagation(),M.default.isMobileScreenReaderEnabled()&&this._onPlayOrPause(e)},this._onPlayOrPause=e=>{e.stopPropagation(),this.state.isPlaying?this.setState({isPlaying:!1}):(this.setState({isPlaying:!0}),this.props.message&&m.track(new C.MessageContentClicked(this.props.message)))},this._onRetry=e=>{e.stopPropagation(),this.isComponentMounted()&&this.setState({thumbnailNotLoaded:!1,isVideoLoaded:!1,videoFailed:!1})},this._onEnded=()=>{this.isComponentMounted()&&this.setState({isPlaying:!1})},this._onCanPlay=()=>{this.isComponentMounted()&&(this.setState({isVideoLoaded:!0}),(this.props.isPreviewModeOn||this.props.autoPlay)&&this._playVideo())},this._onMojiError=()=>{this.isComponentMounted()&&!this.state.videoFailed&&this.setState({videoFailed:!0})},this._onThumbnailError=()=>{this.isComponentMounted()&&!this.state.thumbnailNotLoaded&&this.setState({thumbnailNotLoaded:!0})},this._onThumbnailLoaded=()=>{this.isComponentMounted()&&this.setState({thumbnailNotLoaded:!1})}}_buildState(e,t){const s=r.default.getConfigSettings().pes.rewriteRules,i=T.rewriteUrl(e.src,s),o=i+"/views/meta."+y.getLocale(),n=this.props,a=i+"/views/default";let l=i+"/views/thumbnail";e.size===d.MojiSize.Small&&(l+="_120");let c=i;y.getLocale()!==b.default.getCurrentCachedPesLocal()&&(c=void 0);const h={contentUrl:R.default.getAuthenticatedUrl(a),thumbnailUrl:R.default.getAuthenticatedUrl(l),cdnToken:x.default.getCdnToken(),mojiMetadata:_.default.getMetadataForMoji(o,e.pesID,c)};(t||n.pesID!==e.pesID||n.src!==e.src)&&(h.isPlaying=!1,h.isVideoLoaded=!1,h.videoFailed=!1,h.thumbnailNotLoaded=!0,h.renderCounter=0),!t&&this.state.cdnToken!==h.cdnToken&&this.state.thumbnailNotLoaded&&(h.renderCounter=this.state.renderCounter+1,h.isVideoLoaded=!1,h.videoFailed=!1);const u=v.default.getActivePlayerToken();return!t&&this._playerToken!==u&&this.state.isPlaying&&(h.isPlaying=!1),h}_playVideo(){!this.state.isPlaying&&this._videoWithTelemetry&&this.setState({isPlaying:!0})}componentDidMount(){super.componentDidMount(),this._playerToken=v.default.registerAsPlayer()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=O.default.newCauseId();m.log(c.LogTraceArea.Moji,"Moji.componentDidUpdate causeId: "+i),!t.isPlaying&&this.state.isPlaying?this._audioManagerClient.requestMode(o.AudioModes.MojiPlayback,i).then((e=>{e&&this.isComponentMounted()&&(v.default.setAsActive(this._playerToken),this._videoWithTelemetry&&this._videoWithTelemetry.play())})):t.isPlaying&&!this.state.isPlaying&&(this._videoWithTelemetry&&this._videoWithTelemetry.pause(),this.state.isVideoLoaded&&M.default.isMobileScreenReaderEnabled()&&M.default.maybeAnnounceForAccessibility(y.getString("Moji.SendButtonTitle")),this._audioManagerClient.release(i))}componentWillUnmount(){super.componentWillUnmount();const e=O.default.newCauseId();m.log(c.LogTraceArea.Moji,"componentWillUnmount causeId",e),this._audioManagerClient.release(e)}_getStyle(e){switch(e){case d.MojiSize.Small:return B.mojiSmall;case d.MojiSize.Medium:return B.mojiMedium;case d.MojiSize.Large:return B.mojiLarge;case d.MojiSize.ExtraLarge:return B.mojiExtraLarge;default:return B.mojiMediumSmall}}render(){const e=this._getStyle(this.props.size),t=(0,i.jsx)(g.default,{icon:P.SkypeIcon.MojiMaskInverted,size:e.mojiMaskSize,color:this.props.borderColor,style:e.mojiMask});let s;if(this.state.mojiMetadata&&!this.props.hideMetadata){let e;const t=[F.description],o=[w.default.fontStyle.captionSmall,F.copyright,this._themeStyles.secondaryTextColorStyle];let r;const a=[w.default.fontStyle.subtitle,F.alternateTextLink,this._themeStyles.primaryTextColorStyle];this.props.metadataPosition===d.MojiMetadataAlign.Bottom?(t.push(F.metdataTextBottom),o.push(F.metdataTextBottom),r=F.metdataTextBottom):this.props.metadataPosition===d.MojiMetadataAlign.Left&&(t.push(F.metdataTextRight),o.push(F.metdataTextRight),r=F.metdataTextRight),this.props.useTransparentDarkTheme&&(t.push(F.descriptionDarkTheme),o.push(F.copyrightDarkTheme),a.push(F.alternateTextLinkDarkTheme)),e=this.state.mojiMetadata.auxiliaryUrl?(0,i.jsx)(n.Text,Object.assign({style:r,selectable:!0},{children:(0,i.jsx)(u.HoverableLink,Object.assign({style:a,hoverStyle:F.alternateTextLinkHover,disableHoverOpacityStyles:!0,url:this.state.mojiMetadata.auxiliaryUrl,onPress:this._onAuxiliaryUrlLinkPress},{children:this.state.mojiMetadata.auxiliaryText}))})):(0,i.jsx)(k.Subtitle,Object.assign({selectable:!0},{children:this.state.mojiMetadata.auxiliaryText}));const l=[F.metadataContainer];this.props.isPreviewModeOn&&this.props.metadataPosition===d.MojiMetadataAlign.Right&&l.push(F.metadataPreview),s=(0,i.jsxs)(n.View,Object.assign({style:l,importantForAccessibility:n.Types.ImportantForAccessibility.No},{children:[(0,i.jsx)(k.Caption,Object.assign({style:t,selectable:!0,accessibilityHidden:!0},{children:this.state.mojiMetadata.description})),e,(0,i.jsx)(n.Text,Object.assign({style:o,selectable:!0,importantForAccessibility:n.Types.ImportantForAccessibility.No},{children:this.state.mojiMetadata.copyright}))]}),"metadata")}const o=this.state.contentUrl?(0,i.jsx)(L.default,{origin:"Moji",ref:this._onVideoWithTelemetryRef,style:[e.video,this.state.isPlaying?F.opaqueView:F.transparentView],source:this.state.contentUrl,onEnded:this._onEnded,onCanPlay:this._onCanPlay,onError:this._onMojiError,mediaProvider:d.MediaProvider.Moji,messagetype:l.MessageTypes.Media_FlikMsg},"video"):void 0,r=(0,i.jsx)(n.View,Object.assign({style:[e.thumbnailContainer,e.mojiPlaceholder]},{children:(0,i.jsx)(g.default,{icon:P.SkypeIcon.Moji,size:P.IconSize.size32,color:I.Color.gray300})})),a=(0,i.jsx)(n.View,Object.assign({style:[e.thumbnailContainer,e.mojiPlaceholder]},{children:(0,i.jsx)(g.default,{icon:P.SkypeIcon.MojiDeleted,size:P.IconSize.size32,color:I.Color.gray300})})),c=(0,i.jsx)(h.default,{origin:"MojiThumbnail",style:e.thumbnailImage,source:this.state.thumbnailUrl,containerStyle:e.thumbnailImage,altView:r,errorView:a,resizeMode:"cover",onError:this._onThumbnailError,onLoad:this._onThumbnailLoaded},"thumbnail"+this.state.renderCounter);let m;const S=[e.mojiVideoContainer];this.props.metadataPosition===d.MojiMetadataAlign.Bottom&&S.push(F.mojiContainerCentered);const f=!this.state.isPlaying&&this.state.isVideoLoaded;if(this.state.videoFailed){let e,s;if(this.state.thumbnailNotLoaded){const e=this.state.mojiMetadata&&this.state.mojiMetadata.pickerTitle?this.state.mojiMetadata.pickerTitle:"";s=y.getString("Moji.MojiTitle",{description:e})}else s=y.getString("Moji.RetryButtonTitle"),e=this._getRetryButton(this._onRetry);m=(0,i.jsxs)(n.View,Object.assign({style:S,onPress:this.state.thumbnailNotLoaded?void 0:this._onRetry,onLongPress:this.props.onLongPress,title:s,activeOpacity:this.props.activeOpacityOverride||1},{children:[c,t,e]}),"placeholderContainer")}else if(this.props.isPreviewModeOn){let s,r,a,l;if(f)this.props.showReplayButtonAfterPlay?(l=this._onReplay,s=this._getRetryButton(this._onReplay),a=y.getString("Moji.ReplayButtonTitle")):(a=y.getString("Moji.SendButtonTitle"),l=this._onSend,s=(0,i.jsx)(n.View,Object.assign({style:F.sendButtonWrapper},{children:(0,i.jsx)(g.default,{icon:P.SkypeIcon.Send,style:this._getContext().isRTL?F.flippedView:void 0,color:I.Color.white,size:e.sendButtonSize})})));else{const e=this.state.mojiMetadata&&this.state.mojiMetadata.pickerTitle?this.state.mojiMetadata.pickerTitle:"";a=y.getString("Moji.MojiTitle",{pickerTitle:e}),l=this._onPlayOrPause}(f&&!this.props.showReplayButtonAfterPlay||M.default.isMobileScreenReaderEnabled())&&(r=(0,i.jsx)(p.default,{style:F.replayButton,title:y.getString("Moji.ReplayButtonTitle"),onPress:this._onReplay,onLongPress:this.props.onLongPress,size:P.IconSize.size24,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:P.SkypeIcon.Reload,activeOpacity:this.props.activeOpacityOverride,disabled:!f})),m=(0,i.jsxs)(n.View,Object.assign({style:F.replayButtonContainer},{children:[(0,i.jsxs)(n.Button,Object.assign({autoFocus:!0,style:S,onPress:l,onLongPress:this.props.onLongPress,title:a,activeOpacity:this.props.activeOpacityOverride||1,disabled:this.props.disableActions,disabledOpacity:1},{children:[c,o,s,t]}),"videoContainer"),r]}))}else{const e=this.props.size===d.MojiSize.Medium?P.IconSize.size40:P.IconSize.size60;let s;if(f){const t=[F.playButtonContainer];this.props.size===d.MojiSize.Medium&&t.push(F.playButtonContainerMedium),s=(0,i.jsx)(p.default,{style:t,size:e,color:I.Color.white,hoverColor:I.Color.whiteOverlay70,icon:P.SkypeIcon.Play,activeOpacity:this.props.activeOpacityOverride},"play")}m=(0,i.jsxs)(n.Button,Object.assign({autoFocus:this.props.setAccessibilityFocusOnMoji,style:S,onPress:this._onPlayOrPause,onContextMenu:this.props.onContextMenu,onLongPress:this.props.onLongPress,title:this._getPlayMojiTitle(),activeOpacity:this.props.activeOpacityOverride||1,disabled:this.props.disableActions,disabledOpacity:1},{children:[c,o,t,s]}),"videoContainer")}const v=this._getContainerStyle();return this.props.metadataPosition===d.MojiMetadataAlign.Bottom?(0,i.jsxs)(n.View,Object.assign({style:v},{children:[m,s]})):this.props.metadataPosition===d.MojiMetadataAlign.Left?(0,i.jsxs)(n.View,Object.assign({style:v,onPress:void 0},{children:[s,m]})):(0,i.jsxs)(n.View,Object.assign({style:v},{children:[m,s]}))}_getContainerStyle(){return this.props.metadataPosition===d.MojiMetadataAlign.Bottom?this.props.style:[F.mojiContainer,this.props.style]}_getRetryButton(e){const t=[F.playButtonContainer];return this.props.size===d.MojiSize.Medium&&t.push(F.playButtonContainerMedium),(0,i.jsx)(p.default,{style:t,title:y.getString("Global.RetryLabel"),onPress:e,onLongPress:this.props.onLongPress,size:this.props.size===d.MojiSize.Medium?P.IconSize.size40:P.IconSize.size60,color:I.Color.white,hoverColor:I.Color.whiteOverlay70,icon:P.SkypeIcon.Reload,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants,activeOpacity:this.props.activeOpacityOverride},"retry")}_subscribeToThemeChanges(){return!1}_getPlayMojiTitle(){return this.state.mojiMetadata&&this.state.mojiMetadata.pickerTitle?y.getString("Moji.PlayMojiButtonTitle",{mojiName:this.state.mojiMetadata.pickerTitle}):void 0}}t.default=D},881357:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundPickerItem=void 0;const i=s(785893),o=s(274840),n=s(516778),r=s(967593),a=s(343632),l=s(139889),d=s(913944),c=s(733754),h=s(581760),u=s(711828),p=s(110117),g=s(497174),m=s(436237),S=s(915877),f=s(526424),y=s(279810),v=s(594011),C=s(135455),_=s(24576),b=(0,S.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",alignSelf:"stretch",paddingHorizontal:10}),iconButton:()=>n.Styles.createViewStyle({paddingRight:6}),iconButtonBackground:()=>n.Styles.createButtonStyle({borderWidth:1,borderStyle:"solid",borderColor:h.Color.gray200,alignItems:"center",justifyContent:"center"}),iconButtonNoBorder:()=>n.Styles.createButtonStyle({borderWidth:0}),stickerImage:()=>n.Styles.createViewStyle({width:20,height:20}),checkmark:()=>n.Styles.createViewStyle({position:"absolute",right:3,bottom:0,marginRight:0,flex:0,alignSelf:"center",width:14,height:14,borderRadius:14,borderWidth:1,borderStyle:"solid",alignItems:"center",justifyContent:"center",backgroundColor:h.Color.blueDark,borderColor:h.Color.white}),checkmarkIcon:()=>n.Styles.createViewStyle({padding:3.5})}),T={colors:[{key:"Blue",colorGradientStart:h.Color.blueLight,colorGradientEnd:h.Color.blueDark},{key:"Blueviolet",colorGradientStart:h.Color.blurpleLight,colorGradientEnd:h.Color.blurpleDark},{key:"Redviolet",colorGradientStart:h.Color.purpleLight,colorGradientEnd:h.Color.purpleDark},{key:"Red",colorGradientStart:h.Color.pinkLight,colorGradientEnd:h.Color.pinkDark},{key:"Orange",colorGradientStart:h.Color.orangeLight,colorGradientEnd:h.Color.orangeDark},{key:"White",colorGradientStart:h.Color.gray50,colorGradientEnd:h.Color.gray200}]};class M extends _.default{constructor(){super(...arguments),this._onSelectBackgroundColor=e=>{if(this.setState({selectedBackgroundColor:e}),this.props.onSelectBackgroundColorInfo){this.props.onSelectBackgroundColorInfo({key:e.key,colors:[e.colorGradientStart,e.colorGradientEnd]},this.props.iconEntity);const t={tabType:this.props.selectedTabType,triggeredBy:this.props.triggeredBy};m.track(new y.PesBackgroundColorTelemetryEvent(t))}},this._mapColorGradientToColorInfo=()=>{var e,t,s;return{key:null===(e=this.state.selectedBackgroundColor)||void 0===e?void 0:e.key,colors:[null===(t=this.state.selectedBackgroundColor)||void 0===t?void 0:t.colorGradientStart,null===(s=this.state.selectedBackgroundColor)||void 0===s?void 0:s.colorGradientEnd]}}}_buildState(e,t){const s={};return t&&e.iconEntity&&(s.selectedBackgroundColor=T.colors[0]),s}render(){const e=this.props.iconEntity?this.state.generatedColors:T;return e&&e.colors.length?(0,i.jsx)(n.View,Object.assign({style:b.container},{children:e.colors.map((e=>(0,i.jsx)(I,{iconEntity:this.props.iconEntity,selectedColorInfo:this.state.selectedBackgroundColor,colorInfo:e,onSelect:this._onSelectBackgroundColor,staticIcon:this.props.staticIcon},e.key)))})):null}componentDidMount(){super.componentDidMount(),this.props.onSelectBackgroundColorInfo&&!this.props.iconEntity&&this.props.onSelectBackgroundColorInfo(this._mapColorGradientToColorInfo()),this.props.iconEntity&&this._generateBackgroundColors()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=this.props.iconEntity!==e.iconEntity,o=this.state.generatedColors!==t.generatedColors;i&&this.props.iconEntity&&this._generateBackgroundColors(),o&&this.props.onSelectBackgroundColorInfo&&this.props.onSelectBackgroundColorInfo(this._mapColorGradientToColorInfo(),this.props.iconEntity)}_generateBackgroundColors(){const e=(0,a.getInputEntityUrl)(this.props.iconEntity,f.EmoticonSize.Small);e&&o.default.getColorHarmonies(e).then((e=>{this.setState({generatedColors:null!=e?e:T,selectedBackgroundColor:(null!=e?e:T).colors[0]})})).catch((()=>{this.setState({generatedColors:T,selectedBackgroundColor:T.colors[0]})}))}}t.default=M;class I extends n.Component{constructor(){super(...arguments),this._onSelect=()=>{this.props.onSelect&&this.props.onSelect(this.props.colorInfo),n.Accessibility.announceForAccessibility(this._getAccessibilityLabel(!0))}}render(){const{iconEntity:e,selectedColorInfo:t,colorInfo:s,staticIcon:o,large:a}=this.props,l=(null==t?void 0:t.key)===s.key;if(!e&&!o)return null;const d=a?f.EmoticonSize.Large:f.EmoticonSize.Small,c=e?e instanceof g.EmoticonEntity?this._getEmoticonIcon(d):this._getStickerIcon():this._getStaticIcon(),h=o?b.iconButtonNoBorder:void 0,u=a?60:32,p=[b.iconButtonBackground,n.Styles.createButtonStyle({width:u,height:u,borderRadius:u/2},!1)];return(0,i.jsxs)(n.Button,Object.assign({style:b.iconButton,onPress:this._onSelect,autoFocus:l,accessibilityLabel:this._getAccessibilityLabel(l)},{children:[(0,i.jsx)(r.GradientView,Object.assign({style:[p,h],colors:[s.colorGradientStart,s.colorGradientEnd],direction:r.GradientDirection.BOTTOM_RIGHT},{children:c})),l&&this._renderCheckmark()]}),s.key)}_getAccessibilityLabel(e){const t=(0,a.getLocalizedColorName)(this.props.colorInfo.key);return`${c.getString("MeetNow.BackgroundPickerItemLabel",{color:t})}${e?`, ${c.getString("Global.SelectedAccessibilityLabel")}`:""}`}_getEmoticonIcon(e=f.EmoticonSize.Small){const t=this.props.iconEntity;if(!t)return null;const s={id:t.emoticonName,tone:t.tone,firstFrame:0,frameCount:0};return(0,i.jsx)(v.StaticEmoticon,{emoticonInfo:s,size:e},"emoticon")}_getStickerIcon(){const e=this.props.iconEntity,t=(0,C.getStickerUrl)(e.uri,C.StickerSize.ThumbLarge,!1,!0);return(0,i.jsx)(l.default,{origin:"StickerThumbnail",style:b.stickerImage,containerStyle:b.stickerImage,resizeMode:"cover",source:t},"sticker")}_getStaticIcon(){const e="White"===this.props.colorInfo.key?h.Color.gray400:h.Color.white;return this.props.staticIcon&&(0,i.jsx)(d.default,{size:u.IconSize.size16,color:e,hoverColor:e,icon:this.props.staticIcon,title:c.getString("PesPicker.MeetNowTitle")})}_renderCheckmark(){return(0,i.jsx)(n.View,Object.assign({style:b.checkmark},{children:(0,i.jsx)(p.default,{style:b.checkmarkIcon,icon:u.SkypeIcon.Ok,size:u.IconSize.size12,color:h.Color.white})}))}}t.BackgroundPickerItem=I},394894:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(282773),r=s(911009),a=s(677381),l=s(245381),d=s(711828);class c extends a.default{constructor(){super(...arguments),this._toolTipAnimationConfig={duration:250,easing:o.Animated.Easing.OutBack()},this._toolTipConfig=()=>({getElement:this.props.anchor,positions:[r.PopupAnchorPositon.Bottom],durationMs:3500,title:this.props.title,optionalIcon:d.SkypeIcon.Bookmarked,anchorAccessibilityLabel:this.props.accessibilityLabel,instanceId:this.state.instanceId,rootViewId:this._getRootViewId()}),this._onBookmarkTooltipDismiss=()=>{n.default.bookmarkTooltipDisplayed()}}_buildState(e,t){return{instanceId:e.instanceId||"unknown"}}render(){return(0,i.jsx)(l.default,{toolTipInfo:this._toolTipConfig(),animateDismissal:!0,animationConfig:this._toolTipAnimationConfig,textMarginHorizontal:10,textMarginVertical:10,containerOffsetX:this.props.offsetX,containerOffsetY:this.props.offsetY,onDismiss:this._onBookmarkTooltipDismiss})}}t.default=c},110547:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(667294),r=s(516778),a=s(889391),l=s(881357),d=s(843368),c=s(632949),h=s(746096),u=s(601720),p=s(443106),g=s(128909),m=s(436237),S=s(172490),f=s(915877),y=s(733754),v=s(901117),C=s(706250),_=s(743855),b=s(696168),T=s(571502),M=s(79096),I=s(63584),w=s(783294),P=s(617707),k=s(758962),A=s(223528),x=s(422538),R=s(63110),O=s(581760),L=s(311010),F=s(711828),B=s(680837),D=s(24576),E=s(853374),V=O.Color.gray50,N=O.Color.gray200,U=(0,f.lazyProperties)({container:()=>r.Styles.createViewStyle({height:250,borderColor:V,backgroundColor:O.Color.white}),containerTop:()=>r.Styles.createViewStyle({borderWidth:1,borderBottomWidth:0,borderTopLeftRadius:10,borderTopRightRadius:10}),containerBottom:()=>r.Styles.createViewStyle({borderWidth:1,borderTopWidth:0,borderBottomLeftRadius:10,borderBottomRightRadius:10}),containerWhiteBackground:()=>r.Styles.createViewStyle({backgroundColor:O.Color.white}),containerRadiusOverrideTop:()=>r.Styles.createViewStyle({borderTopLeftRadius:24,borderTopRightRadius:24}),containerRadiusOverrideBottom:()=>r.Styles.createViewStyle({borderBottomLeftRadius:24,borderBottomRightRadius:24}),centeredContainer:()=>r.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),headerContainer:()=>r.Styles.createViewStyle({minHeight:T.MinimumPesHeaderHeight,borderBottomWidth:1,borderColor:V,flexDirection:"row",alignItems:"center",justifyContent:"space-between",alignSelf:"stretch"}),headerContainerNoCategorySwitcher:()=>r.Styles.createViewStyle({justifyContent:"flex-end"}),headerContainerNarrowView:()=>r.Styles.createViewStyle({paddingVertical:T.HeaderContainerVerticalPadding,flexDirection:"column-reverse",alignItems:"stretch"}),headerContainerNarrowViewDirectionColum:()=>r.Styles.createViewStyle({flexDirection:"column"}),searchInputContainer:()=>r.Styles.createViewStyle({flexBasis:150,flexShrink:1,height:T.SearchInputHeight,borderRadius:5,borderWidth:1,marginHorizontal:10}),searchInputContainerNarrowView:()=>r.Styles.createViewStyle({marginBottom:5,minWidth:150,flexBasis:30}),searchInputInnerContainer:()=>r.Styles.createViewStyle({paddingHorizontal:5}),searchInputControl:()=>r.Styles.createTextInputStyle({paddingHorizontal:5}),borderLightTheme:()=>r.Styles.createTextInputStyle({borderColor:V}),borderLightThemeSearchInput:()=>r.Styles.createViewStyle({borderColor:N}),borderAccessibleTheme:()=>r.Styles.createTextInputStyle({borderColor:O.Color.black}),borderSeparator:()=>r.Styles.createTextInputStyle({borderBottomWidth:1,borderColor:V,marginVertical:10}),categorySwitcherContainer:()=>r.Styles.createTextInputStyle({flexGrow:1,paddingHorizontal:20}),categorySwitcherHorizontalPadding:()=>r.Styles.createTextInputStyle({paddingHorizontal:T.HeaderContainerVerticalPadding}),meetNowPickerContainer:()=>r.Styles.createTextInputStyle({paddingVertical:T.HeaderContainerVerticalPadding,borderBottomWidth:1,borderColor:V})});class j extends D.default{constructor(){super(...arguments),this._mountedPickerRefs=new C.default,this._initialTabType=w.defaultTabType,this._onEscape=()=>(this.props.onClose(),!0),this._onEmoticonSelected=e=>{this.props.showBackgroundColorsSwitcher&&this.setState({selectedEntityForBackgroundColor:e}),this.props.onEmoticonSelected(e)},this._onStickerSelected=e=>{this.props.showBackgroundColorsSwitcher&&this.setState({selectedEntityForBackgroundColor:e}),this.props.onStickerSelected(e)},this._onSwitchPesTabType=e=>{if(e!==this.state.selectedTabType){this._updatePickerTelemetrySessions(this.state.selectedTabType,e),this.isComponentMounted()&&this.setState({selectedTabType:e,hasSwitchedTabs:!0,isSearchInputPristine:!!this.state.searchQuery,searchQuery:this.state.searchQuery,visibleSearchInput:!this.props.isMobileAvatarPickerStyle&&this._isSearchableTab(e),selectedEntityForBackgroundColor:void 0});const t=this._mountedPickerRefs.ref(e.toString());t&&t.requestFocusOnFirstItem()}},this._isSearchableTab=e=>e in k.SearchableTabType,this._shouldShowBackgroundPicker=()=>this.props.showBackgroundColorsSwitcher&&this.state.selectedEntityForBackgroundColor,this._onSearchQueryChange=e=>{if(!this.isComponentMounted())return;const t={},s=e.trim();this.state.selectedTabType===k.TabType.Gif&&(s||p.default.setSearchParams("")),s!==this.state.searchQuery&&(t.searchQuery=e),this.state.isSearchInputPristine&&(t.isSearchInputPristine=!1),!o.isEmpty(t)&&this.isComponentMounted()&&this.setState(t)},this._onSearchQueryChangeDebounced=o.debounce(this._onSearchQueryChange,a.default.getS4LSearchFeatures().searchHeaderDebounceWait)}_buildState(e,t){const s=this.props,i={showingInNarrowView:!!e.availableWidth&&e.availableWidth<600,loadingStatus:b.default.getLoadingStatus()};return t&&(i.selectedTabType=e.selectedTabType||this._initialTabType,i.hasSwitchedTabs=!1,i.isSearchInputPristine=!0,i.searchQuery=e.searchQuery||"",i.visibleSearchInput=!e.isMobileAvatarPickerStyle&&this._isSearchableTab(i.selectedTabType)),s.showCategorySwitcher!==e.showCategorySwitcher&&this.state.selectedTabType!==this._initialTabType&&(i.selectedTabType=this._initialTabType),i}componentDidMount(){super.componentDidMount();const e=E.default.newCauseId();m.log(h.LogTraceArea.Pes,"DesktopPesPicker componentDidMount causeId: "+e),this.state.loadingStatus===b.PesConfigLoadingStatus.NotStarted?x.EnsureStarted(P.default).then((()=>P.default.refreshConfig(e))):this.state.loadingStatus===b.PesConfigLoadingStatus.Loading&&P.default.refreshConfig(e),S.default.addEscapeHandler(this._onEscape)}componentWillUnmount(){super.componentWillUnmount(),S.default.removeEscapeHandler(this._onEscape),d.default.close(this._getRootViewId())}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.searchQuery&&e.selectedTabType&&(e.searchQuery!==this.state.searchQuery||e.selectedTabType!==this.state.selectedTabType)&&this.setState({searchQuery:e.searchQuery,selectedTabType:e.selectedTabType})}_isDarkThemeAllowed(){return this._useDarkTheme()&&!this.props.disableDarkTheme}render(){const e=this.props.renderPosition===k.PesPickerRenderPosition.BOTTOM,t=[U.container,this.props.styles,e?U.containerBottom:U.containerTop,this._getAccessibleThemeStyles(),e?U.containerRadiusOverrideBottom:U.containerRadiusOverrideTop];return this._isDarkThemeAllowed()&&t.push(this._themeStyles.headerShadowBorderColorStyle,this._themeStyles.secondaryBackgroundColorStyle),this.state.loadingStatus===b.PesConfigLoadingStatus.NotStarted||this.state.loadingStatus===b.PesConfigLoadingStatus.Loading?(t.push(U.centeredContainer),(0,i.jsx)(r.View,Object.assign({style:t},{children:(0,i.jsx)(_.default,{})}))):(0,i.jsxs)(r.View,Object.assign({style:t},{children:[this._getHeader(),this._getPicker()]}))}_getHeader(){const e=[U.headerContainer,this._getAccessibleThemeStyles()],t=[U.searchInputContainer,this._getAccessibleThemeStyles(!0)],s=[U.categorySwitcherContainer],o=[];let a;this.state.showingInNarrowView&&(e.push(U.headerContainerNarrowView),t.push(U.searchInputContainerNarrowView),s.push(U.categorySwitcherHorizontalPadding),this.props.showBackgroundColorsSwitcher&&(e.push(U.headerContainerNarrowViewDirectionColum),o.push(this.props.isMobileAvatarPickerStyle||this.state.visibleSearchInput?U.borderSeparator:void 0,this._getAccessibleThemeStyles()))),this._isDarkThemeAllowed()&&e.push(this._themeStyles.headerShadowBorderColorStyle),this.props.showCategorySwitcher?a=(0,i.jsx)(r.View,Object.assign({style:s},{children:(0,i.jsx)(M.default,{categoryOrder:this.props.customCategoryOrder,currentTabType:this.state.selectedTabType,onSwitchPesTabType:this._onSwitchPesTabType,showInLandscape:!0,showCategoriesAsIcons:this.state.showingInNarrowView,disableDarkTheme:this.props.disableDarkTheme})})):e.push(U.headerContainerNoCategorySwitcher);const d=(0,i.jsx)(A.default,{inputText:this.state.searchQuery,style:t,searchInputControlStyle:U.searchInputInnerContainer,clearSearchIconColor:this._getSearchIconColor(),placeholderText:y.getString("SearchInputControl.PlaceHolderTextShort"),accessibilityLabel:y.getString("SearchInputControl.PlaceHolderTextShort"),clearSearchIconSize:F.IconSize.size14,inputStyle:[U.searchInputControl,L.default.fontStyle.caption],showSearchIcon:!0,hideBackground:!0,doNotAutoFocusOnMount:!0,onInputTextChange:this._onSearchQueryChangeDebounced});let c;return this._shouldShowBackgroundPicker()&&(c=(0,i.jsxs)(n.Fragment,{children:[(0,i.jsx)(l.default,{iconEntity:this.state.selectedEntityForBackgroundColor,onSelectBackgroundColorInfo:this.props.onBackgroundSelected,selectedTabType:this.state.selectedTabType,triggeredBy:this.props.origin}),(0,i.jsx)(r.View,{style:o})]})),(0,i.jsxs)(r.View,Object.assign({style:e},{children:[a,(0,i.jsx)(r.View,{style:o}),c,this.state.visibleSearchInput&&d]}))}_getPicker(){let e;switch(this.state.selectedTabType){case k.TabType.Emoticon:e=this._getEmoticonPicker();break;case k.TabType.Moji:e=this._getMojiPicker();break;case k.TabType.ChatSticker:e=this._getStickerPicker();break;case k.TabType.Gif:e=this._getGifPicker();break;case k.TabType.MeetNow:e=this._getMeetNowIconPicker();break;case k.TabType.ImageUploader:e=this._getImageUploadPicker();break;case k.TabType.CaptureSticker:case k.TabType.Effect:case k.TabType.PickerPopup:break;default:E.default.switchStatementExhaustiveChecking(this.state.selectedTabType)}return(0,i.jsx)(r.View,Object.assign({style:B.default.flexOne},{children:e}))}_getEmoticonPicker(){return(0,i.jsx)(c.default,{ref:this._mountedPickerRefs.onComponentRef(k.TabType.Emoticon.toString()),renderMobileInterface:!1,onPesSelected:this._onEmoticonSelected,filter:this.state.searchQuery,doNotRenderTabIndicator:!!this.state.searchQuery,searchMode:!!this.state.searchQuery,showingInNarrowView:this.state.showingInNarrowView,darkTheme:this._isDarkThemeAllowed(),availableWidth:this.props.availableWidth,autoFocusFirstItem:this.state.hasSwitchedTabs&&this.state.isSearchInputPristine,showCategorySwitcher:this.props.showCategorySwitcher,parentRef:this.props.parentRef,pesPickerPopupRef:this.props.pesPickerPopupRef,triggeredBy:this.props.origin,forceExcludeRecents:!1,hideDeleteButton:!!this.props.isMobileAvatarPickerStyle})}_getMojiPicker(){return(0,i.jsx)(v.default,{ref:this._mountedPickerRefs.onComponentRef(k.TabType.Moji.toString()),renderMobileInterface:!1,onPesSelected:this.props.onMojiSelected,filter:this.state.searchQuery,doNotRenderTabIndicator:!!this.state.searchQuery,searchMode:!!this.state.searchQuery,showingInNarrowView:this.state.showingInNarrowView,darkTheme:this._useDarkTheme(),availableWidth:this.props.availableWidth,autoFocusFirstItem:this.state.hasSwitchedTabs&&this.state.isSearchInputPristine})}_getStickerPicker(){return(0,i.jsx)(R.default,{ref:this._mountedPickerRefs.onComponentRef(k.TabType.ChatSticker.toString()),renderMobileInterface:!1,onPesSelected:this._onStickerSelected,filter:this.state.searchQuery,doNotRenderTabIndicator:!!this.state.searchQuery,searchMode:!!this.state.searchQuery,showingInNarrowView:this.state.showingInNarrowView,darkTheme:this._useDarkTheme(),availableWidth:this.props.availableWidth,autoFocusFirstItem:this.state.hasSwitchedTabs&&this.state.isSearchInputPristine,triggeredBy:this.props.origin})}_getGifPicker(){return(0,i.jsx)(u.default,{renderMobileInterface:!1,onPesSelected:this.props.onGifSelected,filter:this.state.searchQuery,doNotRenderPreview:!1,doNotRenderTabIndicator:!!this.state.searchQuery,searchMode:!!this.state.searchQuery,showingInNarrowView:this.state.showingInNarrowView,darkTheme:this._useDarkTheme(),autoFocusFirstItem:this.state.hasSwitchedTabs&&this.state.isSearchInputPristine})}_getMeetNowIconPicker(){return(0,i.jsx)(r.View,Object.assign({style:[U.meetNowPickerContainer,this._getAccessibleThemeStyles()]},{children:(0,i.jsx)(l.default,{staticIcon:F.SkypeIcon.MeetNow,onSelectBackgroundColorInfo:this.props.onBackgroundSelected,selectedTabType:this.state.selectedTabType,triggeredBy:this.props.origin})}))}_getAccessibleThemeStyles(e=!1){return this.props.disableDarkTheme?this._useAccessibleTheme()?U.borderAccessibleTheme:e?U.borderLightThemeSearchInput:U.borderLightTheme:this._useAccessibleTheme()||e?this._themeStyles.dividerBorderColorStyle:void 0}_getSearchIconColor(){if(this.props.disableDarkTheme)return this._useAccessibleTheme()?O.Color.black:O.Color.gray400}_getImageUploadPicker(){return(0,i.jsx)(g.default,{onImageUploadSelected:this.props.onImageUploadSelected})}_updatePickerTelemetrySessions(e,t){switch(e){case k.TabType.Emoticon:I.EmoticonPickerTelemetry.closed();break;case k.TabType.ChatSticker:I.StickerPickerTelemetry.closed();break;case k.TabType.Moji:I.MojiPickerTelemetry.closed();break;case k.TabType.Gif:I.GifPickerTelemetry.closed();break;case k.TabType.MeetNow:I.PesPickerMeetNowTelemetry.closed();break;case k.TabType.ImageUploader:I.PesPickerImageUploaderTelemetry.closed()}switch(t){case k.TabType.Emoticon:I.EmoticonPickerTelemetry.open(this.props.origin);break;case k.TabType.ChatSticker:I.StickerPickerTelemetry.open(this.props.origin);break;case k.TabType.Moji:I.MojiPickerTelemetry.open();break;case k.TabType.Gif:I.GifPickerTelemetry.open();break;case k.TabType.MeetNow:I.PesPickerMeetNowTelemetry.open(this.props.origin);break;case k.TabType.ImageUploader:I.PesPickerImageUploaderTelemetry.open(this.props.origin)}}}t.default=j},958460:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmoticonItem=void 0;const i=s(785893),o=s(516778),n=s(639024),r=s(110117),a=s(915877),l=s(733754),d=s(330124),c=s(795549),h=s(594011),u=s(581760),p=s(711828),g=o.Styles.createButtonStyle({flex:1,alignItems:"center",alignSelf:"stretch"}),m=(0,a.lazyProperties)({diversityIndicator:()=>o.Styles.createViewStyle({width:4,height:4,borderRadius:2,position:"absolute",top:1,right:1}),diversityIndicatorLightTheme:()=>o.Styles.createViewStyle({backgroundColor:u.Color.gray200}),diversityIndicatorDarkTheme:()=>o.Styles.createViewStyle({backgroundColor:u.Color.gray300}),customIcon:()=>o.Styles.createButtonStyle({position:"absolute",right:1,bottom:0,backgroundColor:u.Color.gray100,borderWidth:1,borderColor:u.Color.white,borderRadius:9,overflow:"visible",height:14,paddingTop:2,paddingLeft:3,paddingRight:2}),customAddIcon:()=>o.Styles.createButtonStyle({backgroundColor:u.Color.blueDark}),customRemoveIcon:()=>o.Styles.createButtonStyle({backgroundColor:u.Color.red}),customRemoveIconContrast:()=>o.Styles.createButtonStyle({backgroundColor:u.Color.gray100}),customAddIconContrastLight:()=>o.Styles.createButtonStyle({backgroundColor:u.Color.black}),customAddIconContrastDark:()=>o.Styles.createButtonStyle({backgroundColor:u.Color.white})});class S extends c.PesPickerItem{_getMarginStyle(e){let t=S._cachedMarginStyles[e];return t||(t=o.Styles.createImageStyle({margin:e},!1),S._cachedMarginStyles[e]=t),t}_getImportantForAccessibility(){return o.Types.ImportantForAccessibility.Yes}_getAccessibilityLabel(e){if(!e.description)return;let t=n.getEmoticonInfoAccessibilityLabel(e);return this._isItemWithPopup(e)&&(t+=", "+l.getString("Global.MoreOptionsAvailableAccessibilityLabel")),t}_renderItem(e){const t=[],s=this._getPopupIndicator(e);return s&&!this.props.hideDiverseIndicatior&&t.push(s),t.push((0,i.jsx)(h.StaticEmoticon,{emoticonInfo:e,size:this.props.size,style:this._getMarginStyle(this.props.margin),onLoad:this.props.onImageLoad},"emoticon")),this.props.renderWithToggleIcons&&t.push(this.props.existsInCustomSet?this._renderRemoveIcon():this._renderAddIcon()),t}_renderAddIcon(){let e;return this._useAccessibleTheme()&&(e=this._useDarkTheme()?m.customAddIconContrastDark:m.customAddIconContrastLight),(0,i.jsx)(o.View,Object.assign({style:[m.customIcon,m.customAddIcon,e]},{children:(0,i.jsx)(r.default,{icon:p.SkypeIcon.Plus,size:p.IconSize.size8,color:this._useAccessibleTheme()&&this._useDarkTheme()?u.Color.black:u.Color.white})}),"toggleIconAdd"+this.props.id)}_renderRemoveIcon(){let e;return this._useAccessibleTheme()&&(e=m.customRemoveIconContrast),(0,i.jsx)(o.View,Object.assign({style:[m.customIcon,m.customRemoveIcon,e]},{children:(0,i.jsx)(r.default,{icon:p.SkypeIcon.PresenceBusy,size:p.IconSize.size8,color:this._useAccessibleTheme()?u.Color.black:u.Color.white})}),"toggleIconRemove"+this.props.id)}_getPopupIndicator(e){if(!this._isItemWithPopup(e))return;const t=this._useDarkTheme()?m.diversityIndicatorDarkTheme:m.diversityIndicatorLightTheme;return(0,i.jsx)(o.View,{style:[m.diversityIndicator,t]},"diverseIndicator")}_onPressPesItem(){this.props.onSelected(this.props.info)}_getCustomParentStyle(){return d.default.isUsingStackNavigationContextNoSubscription()?g:void 0}_isItemWithPopup(e){return!!e.diverse||!!(this.props.emoticonGroupsEnabled&&e.group&&e.group.length>0)}}S._cachedMarginStyles={},t.EmoticonItem=S},632949:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(934339),a=s(889391),l=s(662602),d=s(958460),c=s(82433),h=s(746096),u=s(497174),p=s(436237),g=s(915877),m=s(733754),S=s(526424),f=s(696168),y=s(571502),v=s(571502),C=s(795549),_=s(63584),b=s(783294),T=s(758962),M=s(758962),I=s(382677),w=s(431234),P=(s(536150),s(404057)),k=s(711828),A=(0,g.lazyProperties)({previewMarginBottom:()=>n.Styles.createViewStyle({marginBottom:24})});class x extends y.PesPicker{constructor(){super(...arguments),this._renderPesItem=(e,t)=>{const s=this.state.items[e];if(!s)return p.warn(h.LogTraceArea.Pes,`Emoticon with id ${e} not found`),null;const o=this.state.itemsForTabsMap[this.state.isSearching?0:this._currentTabIndex];let r=!1,a=e;o&&(r=o[0]===e),s.group&&s.group.length>0&&(a=s.group[0]+"_"+a);const l=!!this.state.previewItem&&this.state.previewItem.id===s.id,c=-1===this.state.focusedButtonIndexInPack&&l;return(0,i.jsx)(n.View,{children:(0,i.jsx)(d.EmoticonItem,{autoFocus:this._shouldAutoFocusFirstItem()&&r,ref:this._itemsInCurrentTabRefs.onComponentRef(e),tabIndex:c?0:-1,id:s.id,info:s,size:this._getSize(),margin:this._getExtraItemMargin(),isSelected:l,renderMobileInterface:this.props.renderMobileInterface,emoticonGroupsEnabled:this.state.emoticonGroupsEnabled,renderWithToggleIcons:this.props.renderWithToggleIcons,existsInCustomSet:this._existsInCustomSet(s),hideDiverseIndicatior:this.props.hideDiverseIndicatior,onFocus:this._getButtonFocusCallback(e),onHover:this._onPesHoverBound,onItemContextMenu:this._onItemContextMenu,onItemLongPress:this._onItemLongPress,onSelected:this._onSelected,onItemDidMount:this._onEmoticonItemDidMount,onItemWillMount:this._onEmoticonItemWillMount,onImageLoad:t?this._onFirstImageLoad:this._onImageLoad},a)},a)},this._onSelected=e=>{this._hidePickerPopup(),e.group&&e.group.length>0?c.default.setLastUsedEmoticonGroupItem(e.group[0],e.id):this.props.isCustomReactions||c.default.setLastUsedTone(e.id,e.tone);const t=o.head(e.shortcuts);if(t){const s=new u.EmoticonEntity(t,e.id,e.tone);this.props.onPesSelected(s,T.mediaTypes.emoticon,e.id)}this._trackClickedEmotion(e),!this.props.renderMobileInterface&&this.state.isSearching&&this._desktopSearchTelemetry&&(this._desktopSearchTelemetry.sendSuccessTelemetryEvent(e.id,this.state.searchQuery.length),this._searchSuccessTelemetry=!0)},this._trackClickedEmotion=e=>{_.EmoticonPickerTelemetry.itemAdded(e);const t=e.group?o.indexOf(e.group,e.id):void 0;this._trackClickedItem(e.id,e.tone,t,this.props.triggeredBy)},this._onItemContextMenu=(e,t,s)=>{this._showPickerPopup(e,t,s,M.PesPickerTriggeredBy.ContextMenu)},this._onItemLongPress=(e,t,s)=>{this._showPickerPopup(e,t,s,M.PesPickerTriggeredBy.LongPress)},this._showPickerPopup=(e,t,s,i)=>{if(!this._isItemWithPopup(t))return;const o=this._getPickerPopup();o&&this._measurePosition(s,(()=>this._getParent()),(e=>{const s={item:t,itemSize:this._getSize(),onItemSelected:this._onSelected,onItemHover:this._onPesHoverBound,onHide:this._onPickerPopupHide,x:e.x,y:e.y,leftBoundary:e.leftBoundary,rightBoundary:e.rightBoundary,triggeredBy:i};o.show(s)}))},this._hidePickerPopup=()=>{const e=this._getPickerPopup();e&&e.hide()},this._getParent=()=>{if(this.props.parentRef)return this.props.parentRef()},this._getPickerPopup=()=>{if(this.props.pesPickerPopupRef)return this.props.pesPickerPopupRef()},this._onPickerPopupHide=e=>{this._requestFocusOnItem(e)},this._onEmoticonItemWillMount=()=>{_.EmoticonPickerTelemetry.willMountItem()},this._onEmoticonItemDidMount=()=>{_.EmoticonPickerTelemetry.mountedItem()},this._imagesLoadedCount=0,this._onFirstImageLoad=()=>{_.EmoticonPickerTelemetry.markFirstVisibleItemReady(),this._onImageLoad()},this._onImageLoad=()=>{this._imagesLoadedCount++,this._imagesLoadedCount>=this.state.totalItemsCount&&(_.EmoticonPickerTelemetry.finishOpenScenario(this.state.totalItemsCount),this._imagesLoadedCount=0)},this._onMobileScroll=this._hidePickerPopup,this._onDesktopScroll=this._hidePickerPopup}componentWillUnmount(){super.componentWillUnmount(),_.EmoticonPickerTelemetry.pickerWillUnmount(),this._hidePickerPopup()}_willChangeTab(e){super._willChangeTab(e),this._hidePickerPopup()}_willChangeCategory(e){super._willChangeCategory(e),e!==this._getPesTabType()&&(_.EmoticonPickerTelemetry.closed(),_.EmoticonPickerTelemetry.finishOpenScenario(),this._hidePickerPopup())}_buildState(e,t){const s=a.default.getS4LMessagingFeatures(),i=super._buildState(e,t);if(i.items){const t=c.default.getLastUsedTones(),n=i.items;if(e.isCustomReactions||o.each(t,((e,t)=>{n[t]&&(n[t]=Object.assign(Object.assign({},n[t]),{tone:e}))})),s.enableEmoticonGroups){const e=c.default.getLastUsedEmoticonGroupItems();o.each(e,((e,t)=>{const s=n[t],i=this._getPesItem(e);s&&i&&void 0!==s.group&&-1!==o.indexOf(s.group,e)&&(n[t]=Object.assign(Object.assign({},i),{group:s.group}))}))}}return Object.assign(Object.assign({},i),{emoticonGroupsEnabled:s.enableEmoticonGroups,useSmallEmoticonSizeDesktop:s.enableSmallEmoticonsInDesktopPicker,useSmallEmoticonSizeMobile:!1})}_getPesPreview(){if(this.state.previewItem)return(0,i.jsx)(r.AnimatedEmoticon,{style:A.previewMarginBottom,size:r.Size.ExtraLarge,description:this.state.previewItem.description,innerText:o.head(this.state.previewItem.shortcuts),emoticonName:this.state.previewItem.id,tone:this.state.previewItem.tone,preventSelectable:!0})}_getInitialPagedTabIndex(e){if(this.props.initialTabId&&e){let t=this.getTabIndexByTabId(e,this.props.initialTabId);if(-1===t&&(t=this.getTabIndexByCopyright(e,this.props.initialTabId)),-1!==t)return t}return 1}_getEmptyRecentMessage(){return m.getString("PesPicker.EmptyRecentEmoticons")}_getPesTabType(){return T.TabType.Emoticon}_getTabs(e,t,s){const i=f.default.getEmoticonTabs();let n;if(e){const t=s?this._getGroupedEmoticonTab():void 0;t&&i.push(t),n=b.searchInPackTitleAndItemKeyword(i,e),n=o.filter(n,(e=>e.packs&&e.packs.length>0));const r=this._mergePacksInSingleTab(n);r&&(n=[r])}else{const e=s?c.default.getLastUsedEmoticonGroupItems():void 0,n=w.default.getRecentEmoticonTabInfo(e);(!t||t&&!o.isEmpty(n.packs))&&i.unshift(n)}const r=n||i;return this._getContext().isRTL,r}_getPackAccessibilityLabel(e){return m.getString("PesPicker.EmoticonPackHeaderAccessibilityLabel",{title:e.title,count:e.items.length})}_getSearchNoResultsMessage(){return m.getString("PesSearch.EmoticonPickerNoResultsSearchText")}_getErrorMessage(){return m.getString("MediaBar.EmoticonPickerErrorText")}_getErrorSymbol(){return k.SkypeIcon.EmoticonNotPresent}_getPesInfo(e){const t=e.description,s=o.head(e.shortcuts);return[t,new u.EmoticonEntity(s,e.id,e.tone).text()]}_getPesItem(e){const t=I.separateReactionNameAndTone(e),s=c.default.getEmoticonByName(t.reactionNameWithoutTone);return s&&I.isTonedReaction(e)?Object.assign(Object.assign({},s),{tone:t.reactionTone}):s}_getSearchLabel(){return m.getString("PesPicker.SearchEmoticons")}_supportsRenderTabsWithoutPaging(){return!1}_getStaticItemDimension(){return this.state.useSmallEmoticonSizeMobile?T.frameHeights.emoticons.Size32:T.frameHeights.emoticons.Size40}_getDefaultItemDimension(){return this._getStaticItemDimension()}_getNumberOfItemsPerLine(){{if(o.isUndefined(this.state.availableWidth))return;const e=this._getStaticItemDimension()+2;return Math.floor(this.state.availableWidth/e)}}_onPickerResize(){super._onPickerResize(),this._hidePickerPopup()}_measurePosition(e,t,s){this.isComponentMounted()&&l.default.measureLayoutRelativeToWindow(e).then((e=>{this.isComponentMounted()&&l.default.measureLayoutRelativeToWindow((()=>this._mainContentRef)).then((i=>{if(!this.isComponentMounted())return;let o;t&&t()&&l.default.measureLayoutRelativeToWindow(t).then((e=>{this.isComponentMounted()&&(o=e,p.log(h.LogTraceArea.Pes,e))})).fail((e=>{p.error(h.LogTraceArea.Pes,"Unable to measure parent position: "+P.default.errorAsString(e))}));const n=this._previewSeen?y.PesPreviewContainerWidth:0;let r=e.width/2+n,a=v.MinimumPesHeaderHeight+(this.props.showingInNarrowView&&this.props.showCategorySwitcher?y.CategorySwitcherIconHeight:0);o&&(r=e.width/2,a=0),s({x:e.x-(o?o.x:i.x)+r,y:e.y-(o?o.y:i.y)+a,leftBoundary:n,rightBoundary:i.width+n})})).fail((e=>{p.error(h.LogTraceArea.Pes,"Unable to measure picker position: "+P.default.errorAsString(e))}))})).fail((e=>{p.error(h.LogTraceArea.Pes,"Unable to measure item position: "+P.default.errorAsString(e))}))}_getSize(){return this.props.renderMobileInterface&&this._shouldRenderTabsWithoutPaging()?this.state.useSmallEmoticonSizeMobile?S.EmoticonSize.Medium:S.EmoticonSize.Large:!this.props.renderMobileInterface&&this.state.useSmallEmoticonSizeDesktop?S.EmoticonSize.Small:this.props.renderMobileInterface?S.EmoticonSize.Large:S.EmoticonSize.Medium}_getExtraItemMargin(){let e=0;if(this.props.renderMobileInterface&&!this._shouldRenderTabsWithoutPaging()&&this.props.availableWidth){const t=this.props.availableWidth-2*y.PesListMobilePadding,s=T.frameHeights.emoticons.Size40+2*C.PesItemBorder,i=Math.floor(t/s),o=t%s;e=Math.floor(o/(2*i))}else this.props.renderMobileInterface||(e=3);return e}_existsInCustomSet(e){const t=I.updateReactionNameWithTone(e.id,null==e?void 0:e.tone);return o.includes(this.props.selectedEmoticons,t)}_isItemWithPopup(e){return!!e.diverse||!!(this.state.emoticonGroupsEnabled&&e.group&&e.group.length>0)}_getGroupedEmoticonTab(){const e=c.default.getGroupedEmoticons();if(!o.isEmpty(e))return{id:"grouped emoticons tab",packs:[{id:"grouped emoticons pack",items:e,title:""}],iconUrlOrAssetID:0,tabType:T.TabType.Emoticon}}}t.default=x},423790:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GifItem=void 0;const i=s(785893),o=s(516778),n=s(244770),r=s(809206),a=s(746096),l=s(139889),d=s(110117),c=s(436237),h=s(915877),u=s(733754),p=s(795549),g=s(581760),m=s(711828),S=s(680837),f=s(104735),y=(s(827357),s(437490),s(889391)),v=(0,h.lazyProperties)({alternateViewContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center"}),absolute:()=>S.default.absoluteFill,backgroundImage:()=>o.Styles.createViewStyle({opacity:.5,backgroundColor:g.Color.gray300}),gifItemNoBorder:()=>o.Styles.createButtonStyle({borderWidth:0}),gifItemNoPadding:()=>o.Styles.createButtonStyle({padding:0,borderWidth:0}),sendButtonWrapper:()=>o.Styles.createViewStyle({position:"absolute",right:0,left:0,top:0,bottom:0,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:g.Color.blueOverlay70}),flippedView:()=>o.Styles.createViewStyle({transform:[{scaleX:-1}]})});class C extends p.PesPickerItem{constructor(){super(...arguments),this._isGifImageLoaded=!1,this._isGifThumbnailLoaded=!1,this._handleGifImageLoad=()=>{this._isGifImageLoaded=!0},this._handleGifThumbnailLoad=()=>{this._isGifThumbnailLoaded=!0},this._handleGifImageLoadError=()=>{c.error(a.LogTraceArea.Pes,"There was an error loading the gif ",this.props.id),this._isGifImageLoaded=!1}}_buildState(e,t){return{enableGifOptimisation:y.default.getS4LMessagingFeatures().enableGifOptimisation&&!1}}_getStyle(e,t){return{thumbnailContainer:o.Styles.createViewStyle({width:e,height:t,alignItems:"center",justifyContent:"center"},!1),thumbnailImage:o.Styles.createImageStyle({position:"absolute",top:0,left:0,width:e,height:t},!1)}}_getCustomParentStyle(){const e=[];return this.props.isUsedForPreview&&e.push(v.gifItemNoBorder),this.props.isUsedForSearch&&e.push(v.gifItemNoPadding),e}_renderItem(e){const t=this._getStyle(this.props.width,this.props.height);let s;this.props.showPlaceholder&&(s=this.state.enableGifOptimisation?(t,s)=>{var r;return(0,i.jsx)(o.View,Object.assign({style:v.alternateViewContainer},{children:(0,i.jsx)(o.Image,{style:v.absolute,resizeMode:"cover",source:null!==(r=e.full.stillUrl)&&void 0!==r?r:n.Collection.WIGGLE_PATTERN_350,onLoad:()=>{t(),this._handleGifThumbnailLoad()},onError:s})}))}:(0,i.jsx)(o.View,Object.assign({style:v.alternateViewContainer},{children:(0,i.jsx)(o.Image,{style:[v.absolute,v.backgroundImage],resizeMode:"cover",source:n.Collection.WIGGLE_PATTERN_350})})));const r=(0,i.jsxs)(o.View,Object.assign({style:v.alternateViewContainer},{children:[(0,i.jsx)(o.Image,{style:v.backgroundImage,resizeMode:"cover",source:n.Collection.WIGGLE_PATTERN_350}),(0,i.jsx)(d.default,{icon:m.SkypeIcon.Gif,color:g.Color.white,size:m.IconSize.size30})]})),a=(0,i.jsx)(l.default,{source:this.props.src,origin:"GifThumbnail",showAltView:s&&this.state.enableGifOptimisation,showAltViewImmediately:s&&this.state.enableGifOptimisation,style:t.thumbnailImage,containerStyle:t.thumbnailContainer,altView:s,errorView:r,resizeMode:this.props.isUsedForPreview?"contain":"cover",onLoad:this._handleGifImageLoad,onError:this._handleGifImageLoadError},"thumbnail");return[(0,i.jsx)(o.View,Object.assign({title:e.title,importantForAccessibility:o.Types.ImportantForAccessibility.Yes,accessibilityTraits:o.Types.AccessibilityTrait.Button},{children:a}),"placeholderContainer")]}_onPressPesItem(){(this._isGifThumbnailLoaded||this._isGifImageLoaded)&&(r.default.isMobile()?this.props.isUsedForPreview?this.props.onSelected(this.props.info):f.default.navigateToGifPreview(this.props.info,u.getString("PesPicker.GifPreviewSendButtonAccessibility"),this._getRootViewId()):this.props.onSelected(this.props.info))}_getImportantForAccessibility(){return o.Types.ImportantForAccessibility.Yes}}t.GifItem=C},601720:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(889391),r=s(35566),a=s(746096),l=s(423790),d=s(443106),c=s(497174),h=s(436237),u=s(733754),p=(s(330124),s(526424)),g=s(696168),m=s(571502),S=s(63584),f=s(960621),y=s(783294),v=s(617707),C=s(758962),_=s(711828);class b extends m.PesPicker{constructor(){super(...arguments),this._renderPesItem=e=>{const t=this.state.items[e];if(!t)return h.warn(a.LogTraceArea.Pes,`Gif with id ${e} not found`),null;const s=this.state.itemsForTabsMap[this._currentTabIndex],o=s&&s[0]===e,n=this._getItemDimension(),r=!!this.state.previewItem&&this.state.previewItem.id===t.id,d=-1===this.state.focusedButtonIndexInPack&&r;return n?(0,i.jsx)(l.GifItem,{autoFocus:this._shouldAutoFocusFirstItem()&&o,tabIndex:d?0:-1,ref:this._itemsInCurrentTabRefs.onComponentRef(e),onFocus:this._getButtonFocusCallback(e),id:t.id,info:t,src:t.asmImageProxySmall,isSelected:r,renderMobileInterface:this.props.renderMobileInterface,onHover:this._onPesHoverBound,onSelected:this._onSelected,width:n,height:n,showPlaceholder:!0,onItemDidMount:this._onGifItemDidMount,onItemWillMount:this._onGifItemWillMount},t.id):null},this._onSelected=e=>{const t=y.getGifSwiftMessage(e);if(t){const s=new c.SwiftUriObjectEntity(t,this.props.conversationId,!0);this.props.onPesSelected(s,C.mediaTypes.gif,e.id),this._trackClickedGif(e),this.state.isSearching&&this._desktopSearchTelemetry&&(this._desktopSearchTelemetry.sendSuccessTelemetryEvent(e.id,this.state.searchQuery.length),this._searchSuccessTelemetry=!0)}},this._trackClickedGif=e=>{S.GifPickerTelemetry.itemAdded(void 0),this._trackClickedItem(e.id)},this._onGifItemWillMount=()=>{S.GifPickerTelemetry.willMountItem()},this._onGifItemDidMount=()=>{S.GifPickerTelemetry.mountedItem()}}_buildState(e,t){const s=!!e.filter&&e.filter.length>=p.GifMinSearchChars;return Object.assign(Object.assign({},super._buildState(e,t)),{isSearching:s,forceRenderTabIndicator:!o.isUndefined(s)&&!s,isFetchingGifsForSearch:d.default.isSearching(),gifItemsLimit:n.default.getS4LMessagingFeatures().pesGifItemsLimit})}componentDidMount(){if(super.componentDidMount(),this.props.filter&&this.props.filter.length>=p.GifMinSearchChars)v.default.getGifsForSearchTerm(this.props.filter,this.state.gifItemsLimit);else{const e=this._getCurentTab();e&&this._fetchGifsForCategory(e)}this._gifSendSubscriptionToken=f.GifPreviewService.onSend(this._onSelected)}componentWillUnmount(){super.componentWillUnmount(),this._gifSendSubscriptionToken.unsubscribe(),S.GifPickerTelemetry.pickerWillUnmount()}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.filter&&this.props.filter&&e.filter.length<p.GifMinSearchChars&&e.filter.length<this.props.filter.length&&d.default.setSearchParams("")}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=this.props.filter!==e.filter;if(this.state.isSearching&&i&&this.props.filter)v.default.getGifsForSearchTerm(this.props.filter,this.state.gifItemsLimit);else if(t.isSearching&&!this.state.isSearching){const e=this._getCurentTab();e&&this._fetchGifsForCategory(e)}}_fetchGifsForCategory(e){const t=e.searchTerm&&(e.searchTerm&&e.searchTerm.toLowerCase())!==p.GifDefaultCategory.toLowerCase()?e.searchTerm:void 0;!e.packs.length||e.packs[0].items.length||this.state.isFetchingItems||v.default.getGifsForCategory(e.id,this.state.gifItemsLimit,t)}_getCurentTab(){return this.state.tabs[this._currentTabIndex]||void 0}_getInitialPagedTabIndex(){return 0}_getEmptyRecentMessage(){return u.getString("PesPicker.EmptyRecentGifs")}_getPesTabType(){return C.TabType.Gif}_noSearchResultsFound(){return!this._isFetchingResults()&&this.state.isSearching&&o.isEmpty(this.state.items)}_isFetchingResults(){return this.state.isFetchingGifsForSearch}_shouldAnnounceForAccessibility(e,t){return this.state.isSearching&&!o.isUndefined(this.props.filter)&&this.props.filter.length>=p.GifMinSearchChars&&this.props.filter===d.default.getGifsForSearch().searchQuery}_getSearchItemsCountForAccessibility(){return o.keys(this.state.items).length}_getTabs(e){const t=g.default.getGifTabs();let s;if(e&&e.length>=p.GifMinSearchChars){const e=d.default.getGifsIdsFromSearch(),i=t[0];if(!o.isEmpty(e)&&i){const t=Object.assign(Object.assign({},i.packs[0]),{items:e});s=[Object.assign(Object.assign({},i),{packs:[t]})]}}const i=s||t;return this._getContext().isRTL,i}_getPesItem(e,t){return this.state&&this.state.isSearching&&t&&t.length>=p.GifMinSearchChars?d.default.getSearchGif(e):d.default.getCategoryGif(e)}_getPesInfo(e){return["",y.getGifAttribution()]}_getPesPreview(){if(!this.state.previewItem)return;const e=r.default.fitToContainer({width:this.state.previewItem.full.width,height:this.state.previewItem.full.height},{width:m.PesPreviewContainerWidth-10,height:m.PesPreviewContainerHeight});return(0,i.jsx)(l.GifItem,{id:this.state.previewItem.id,info:this.state.previewItem,src:this.state.previewItem.asmImageProxy,renderMobileInterface:this.props.renderMobileInterface,isSelected:!0,isUsedForPreview:!0,width:e.width,height:e.height,onSelected:this._onSelected},this.state.previewItem.id)}_getPackAccessibilityLabel(e){return u.getString("PesPicker.GifPackHeaderAccessibilityLabel",{title:e.title,count:e.items.length})}_getErrorMessage(){return this.state.isSearching?u.getString("PesSearch.GifPickerNoResultsSearchText"):u.getString("MediaBar.GifPickerErrorText")}_getErrorSymbol(){return _.SkypeIcon.Gif}_getSearchLabel(){return u.getString("PesPicker.SearchGifs")}_getSearchNoResultsMessage(){return u.getString("PesSearch.GifPickerNoResultsSearchText")}_willChangeTab(e){this._fetchGifsForCategory(e)}_willChangeCategory(e){super._willChangeCategory(e),e!==this._getPesTabType()&&S.GifPickerTelemetry.closed()}_getStaticItemDimension(){return(this._getItemDimension()||this._getDefaultItemDimension())+this._doubleBorderItem}_getDefaultItemDimension(){return C.frameHeights.gifs.Size90}_getMinItems(e){return e>p.GifPickerLayoutBreakpoint?8:6}}t.default=b},128909:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(24576),r=s(733754),a=s(136400),l=s(110117),d=s(581760),c=s(711828),h=s(619675),u=(0,s(915877).lazyProperties)({containerStyle:()=>o.Styles.createViewStyle({paddingTop:20,alignSelf:"center"}),buttonStyle:()=>o.Styles.createButtonStyle({paddingVertical:10,paddingHorizontal:20,flexDirection:"row",borderRadius:30,borderWidth:1,maxWidth:180}),iconStyleMargin:()=>o.Styles.createViewStyle({marginRight:10}),textColor:()=>o.Styles.createTextStyle({color:d.Color.gray400})});class p extends n.default{constructor(){super(...arguments),this._uploadAvatarImage=()=>{this.props.onImageUploadSelected&&this.props.onImageUploadSelected()}}render(){return(0,i.jsx)(o.View,Object.assign({style:u.containerStyle},{children:(0,i.jsxs)(a.HoverableButton,Object.assign({style:u.buttonStyle,onPress:this._uploadAvatarImage,accessibilityLabel:r.getString("PesPicker.ImageUploaderTabPlaceholder")},{children:[(0,i.jsx)(l.default,{icon:c.SkypeIcon.Media,style:u.iconStyleMargin,color:this._useAccessibleTheme()?d.Color.black:d.Color.gray400,size:c.IconSize.size20}),(0,i.jsx)(h.BodyText,Object.assign({style:u.textColor},{children:r.getString("PesPicker.ImageUploaderTabPlaceholder")}))]}))}))}}t.default=p},640392:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocationPickerPin=t.PinSize=t.CurrentLocationPinHeight=t.NonCurrentLocationPinHeight=void 0;const i=s(785893),o=s(588785),n=s(516778),r=s(263099),a=s(952262),l=s(110117),d=s(436237),c=s(915877),h=s(733754),u=s(546705),p=s(18078),g=s(581760),m=s(711828),S=s(734528),f=s(478262),y=s(619675),v=s(24576);t.NonCurrentLocationPinHeight=99,t.CurrentLocationPinHeight=135,t.PinSize=22;const C=t.PinSize/2+5,_=(0,c.lazyProperties)({popover:()=>(0,c.lazyProperties)({contentContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderRadius:8,paddingHorizontal:10,backgroundColor:g.Color.gray400}),textContainer:()=>n.Styles.createViewStyle({paddingVertical:10,maxWidth:250,alignSelf:"center"}),narrowTextContainer:()=>n.Styles.createViewStyle({maxWidth:200}),caret:()=>n.Styles.createViewStyle({alignSelf:"center",justifyContent:"center",marginTop:-2,width:12,height:8,backgroundColor:g.Color.transparent}),textFirstLine:()=>n.Styles.createTextStyle({color:g.Color.white}),textSecondLine:()=>n.Styles.createTextStyle({flex:1,color:g.Color.gray200}),textSecondLineAccessible:()=>n.Styles.createTextStyle({flex:1,color:g.Color.white})}),mapMarkerStyle:()=>n.Styles.createTextStyle({alignSelf:"center",backgroundColor:"transparent",marginTop:5}),mapMarkerCurrentStyle:()=>n.Styles.createTextStyle({marginTop:C}),mapMarkerCurrentStyleDesktop:()=>n.Styles.createTextStyle({marginTop:0}),pinStyle:()=>n.Styles.createViewStyle({height:t.PinSize,width:t.PinSize,borderRadius:2*t.PinSize,backgroundColor:g.Color.gray400,borderWidth:3,borderColor:g.Color.white}),sendButtonStyle:()=>n.Styles.createTextStyle({justifyContent:"center",alignItems:"center",width:m.IconSize.default,height:m.IconSize.default})});class b extends v.default{constructor(){super(...arguments),this._onPressPopover=()=>{this.props.onPressPopupOver&&this.state.address&&this.props.onPressPopupOver(this.state.address.addressFriendlyName,this.state.address.fullAddress,this.state.address.shortAddress)}}_buildState(e,t){e.locationType===f.LocationType.Current&&e.userMri;const s={postedByCurrentUser:e.userMri&&p.default.isMyMri(e.userMri),address:{}};if(!s.postedByCurrentUser&&e.conversationId&&e.userMri&&(s.userName=a.default.getMemberShortNameForConversation(e.conversationId,e.userMri)),(t||e.overrideAddress)&&(s.isAddressOverwritten=!1,e.overrideAddress)){const t=h.getString("LocationPicker.FullAddress",{addressFriendlyName:e.overrideAddress.addressFriendlyName,address:e.overrideAddress.address});s.address.addressFriendlyName=e.overrideAddress.addressFriendlyName,s.address.fullAddress=t,s.address.shortAddress=e.overrideAddress.address,s.isAddressOverwritten=!0}return s}componentDidMount(){super.componentDidMount(),this._resolveAddress(this.props)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),(e.overrideAddress||e.location!==this.props.location)&&this._resolveAddress(e)}requestFocus(){}render(){const e=[_.mapMarkerStyle];this.props.hideLocationPin&&e.push(_.mapMarkerCurrentStyleDesktop);const t=this.props.hideLocationPin?null:(0,i.jsx)(n.View,{style:_.pinStyle});return(0,i.jsxs)(n.View,Object.assign({style:this.props.style},{children:[this._getPopover(),(0,i.jsx)(n.View,Object.assign({style:e},{children:t}))]}))}_getPopover(){if(this.props.showSendPopover||this.props.showViewerPopover){const e=this._getPopoverTextElement();let t;return this.props.showSendPopover?t=(0,i.jsxs)(n.View,Object.assign({style:_.popover.contentContainer},{children:[e,(0,i.jsx)(n.Button,Object.assign({title:h.getString("LocationPicker.SendButtonTitle"),onPress:this._onPressPopover,autoFocus:!0},{children:(0,i.jsx)(l.default,{style:_.sendButtonStyle,size:m.IconSize.size24,color:g.Color.white,icon:m.SkypeIcon.Send})}))]})):this.props.showViewerPopover&&(t=(0,i.jsxs)(n.Button,Object.assign({style:_.popover.contentContainer,onPress:this._onPressPopover},{children:[e,(0,i.jsx)(l.default,{style:_.sendButtonStyle,size:m.IconSize.size24,color:g.Color.white,icon:S.navForwardIcon()})]}))),(0,i.jsxs)(n.View,{children:[t,this._getCaret()]})}return null}_getPopoverTextElement(){const e=this._getTextLines();let t;e.second&&(t=(0,i.jsx)(y.BodyText,Object.assign({numberOfLines:1,allowFontScaling:!1,style:this._useAccessibleTheme()?_.popover.textSecondLineAccessible:_.popover.textSecondLine},{children:e.second})));const s=[_.popover.textContainer];return this.props.narrow&&s.push(_.popover.narrowTextContainer),(0,i.jsxs)(n.View,Object.assign({style:s},{children:[(0,i.jsx)(y.RowTitle,Object.assign({numberOfLines:1,allowFontScaling:!1,style:_.popover.textFirstLine},{children:e.first})),t]}))}_getTextLines(){const e=this._getCurrentLocationString();let t="";return this.props.showViewerPopover?t=h.getString("LocationPicker.TapToSeeOnMapLabel"):this.state.address&&(this.props.locationType===f.LocationType.Current?t=this.state.address.fullAddress:this.state.isAddressOverwritten?t=this.state.address.shortAddress:this.state.address.locality&&this.state.address.zipCode&&(t=this.state.address.state?h.getString("LocationPicker.LocalAddressLabel",{locality:this.state.address.locality,state:this.state.address.state,zipcode:this.state.address.zipCode}):h.getString("LocationPicker.LocalAddressNoStateLabel",{locality:this.state.address.locality,zipcode:this.state.address.zipCode}))),{first:e,second:t}}_getCurrentLocationString(){let e;return this.props.locationType===f.LocationType.Current?e=this.state.postedByCurrentUser?h.getString("LocationPicker.YourLocationLabel"):this.state.userName?h.getString("LocationPicker.SharedCurrentLocation",{userName:this.state.userName}):void 0:this.state.address&&(e=this.state.address.addressFriendlyName,e||(e=this.state.address.streetName&&this.state.address.streetNumber?h.getString("LocationPicker.LocalStreetLabel",{streetName:this.state.address.streetName,streetNumber:this.state.address.streetNumber}):h.getString("LocationPicker.NoValidAddressFallback"))),e}_getCaret(){return(0,i.jsx)(o.ImageSvg,Object.assign({style:_.popover.caret,webShadow:"3px 3px 6px rgba(0, 175, 240, 0.2)",width:12,height:8},{children:(0,i.jsx)(o.SvgPath,{strokeColor:g.Color.gray400,strokeWidth:1,strokeOpacity:0,fillColor:g.Color.gray400,fillOpacity:1,d:"M12,0 l0,0 c0,0 0,0 0,0 l0,0 c0,0 0,0 0,0 l0,0 l-6,8 l-6,-8 l0,0 c0,0 0,0 0,0 l0,0 c0,0 0,0 0,0 z"})}))}_resolveAddress(e){if(!e.skipAddressResolution&&!e.overrideAddress&&e.location&&!this._queryingGeocodingServices){this._queryingGeocodingServices=!0;const t=(new Date).getTime();r.resolveAdddress({lat:e.location.latitude,lng:e.location.longitude}).then((s=>{this._queryingGeocodingServices=!1;const i=this.isComponentMounted(),o=null!==s;i&&this.setState({address:s});const n=(new Date).getTime();d.track(new u.LocationPickerResolveAddress(e.locationType,o,i,n-t))})).catch((s=>{this._queryingGeocodingServices=!1;const i=this.isComponentMounted(),o=(new Date).getTime();d.track(new u.LocationPickerResolveAddress(e.locationType,!1,i,o-t))}))}}}t.LocationPickerPin=b,t.default=b},331298:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MojiItem=void 0;const i=s(785893),o=s(516778),n=s(889391),r=s(147204),a=s(139889),l=s(139285),d=s(110117),c=s(915877),h=s(733754),u=s(520849),p=s(130886),g=s(330124),m=s(795549),S=s(960621),f=s(758962),y=s(536150),v=s(581760),C=s(711828),_=s(619675),b=s(675865),T=(0,c.lazyProperties)({mojiContainer:()=>o.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),sendButtonWrapper:()=>o.Styles.createViewStyle({position:"absolute",right:0,left:0,top:0,bottom:0,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:v.Color.blueOverlay70}),flippedView:()=>o.Styles.createViewStyle({transform:[{scaleX:-1}]})}),M="mojiPreviewDialog";class I extends m.PesPickerItem{constructor(){super(...arguments),this._isMojiImageLoaded=!1,this._onDismissMojiPreview=e=>{e&&this.props.id===e.id&&this.isComponentMounted()&&this.setState({isPreviewOn:!1})},this._onSendMoji=e=>{e&&this.props.id===e.id&&this.isComponentMounted()&&this._onPressPesItem()},this._handleMojiImageLoad=()=>{this._isMojiImageLoaded=!0},this._handleMojiImageLoadError=()=>{this._mojiPreviewCloseSubscriptionToken&&(this._mojiPreviewCloseSubscriptionToken.unsubscribe(),this._mojiPreviewCloseSubscriptionToken=void 0),this._mojiSendSubscriptionToken&&(this._mojiSendSubscriptionToken.unsubscribe(),this._mojiSendSubscriptionToken=void 0)},this._sendMojiFromPreviewModal=()=>{r.default.dismissModal(M,this._getRootViewId()),this.props.onSelected(this.props.info),this.state.isPreviewOn&&this.setState({isPreviewOn:!1})},this._dismissMojiPreviewModal=()=>{r.default.dismissModal(M,this._getRootViewId())},this._onUpdateMojiPreview=()=>{this.isComponentMounted()&&this.setState({isPreviewOn:!1})},this._onCloseMojiPreviewModal=()=>{this._dismissMojiPreviewModal(),this._onUpdateMojiPreview()}}_buildState(e,t){const s=n.default.getConfigSettings().pes.rewriteRules,i=f.rewriteUrl(e.info.baseUrl,s),o=i+"/views/meta."+h.getLocale(),r=i+"/views/thumbnail";return{thumbnailUrl:b.default.getAuthenticatedUrl(r),localizedMetadata:u.default.getMetadataForMoji(o,e.info.id),isUsingStackNavigationContext:g.default.isUsingStackNavigationContext()}}_getStyle(e){let t=I._cachedStyles[e];return t||(t={thumbnailContainer:o.Styles.createViewStyle({width:e,height:e,alignItems:"center",justifyContent:"center"},!1),thumbnailImage:o.Styles.createImageStyle({position:"absolute",top:0,left:0,width:e-1,height:e},!1),mojiTitle:o.Styles.createTextStyle({width:e-2,paddingHorizontal:1,paddingTop:8,color:v.Color.gray300,textAlign:"center"},!1),mojiPlaceholder:o.Styles.createViewStyle({width:e,height:e,backgroundColor:v.Color.gray100,justifyContent:"center",alignItems:"center"},!1),mojiMask:o.Styles.createTextStyle({position:"absolute",top:0,left:0,fontSize:e+1})},I._cachedStyles[e]=t),t}componentDidMount(){super.componentDidMount(),this._mojiPreviewCloseSubscriptionToken=S.MojiPreviewService.onPesPreviewClosed(this._onDismissMojiPreview),this._mojiSendSubscriptionToken=S.MojiPreviewService.onSend(this._onSendMoji)}componentWillUnmount(){super.componentWillUnmount(),this._mojiPreviewCloseSubscriptionToken&&(this._mojiPreviewCloseSubscriptionToken.unsubscribe(),this._mojiPreviewCloseSubscriptionToken=void 0),this._mojiSendSubscriptionToken&&(this._mojiSendSubscriptionToken.unsubscribe(),this._mojiSendSubscriptionToken=void 0)}_renderItem(e){const t=this._getStyle(this.props.dimension),s=this.props.showPlaceholder?(0,i.jsx)(o.View,Object.assign({style:[t.thumbnailContainer,t.mojiPlaceholder]},{children:(0,i.jsx)(d.default,{icon:C.SkypeIcon.Moji,size:C.IconSize.size14,color:v.Color.gray300})})):void 0,n=(0,i.jsx)(o.View,Object.assign({style:[t.thumbnailContainer,t.mojiPlaceholder]},{children:(0,i.jsx)(d.default,{icon:C.SkypeIcon.MojiDeleted,size:C.IconSize.size14,color:v.Color.gray300})})),r=this._shouldShowSendOverlay()?(0,i.jsx)(l.default,Object.assign({style:T.sendButtonWrapper},{children:(0,i.jsx)(d.default,{icon:C.SkypeIcon.Send,size:C.IconSize.size16,color:v.Color.white,style:this._getContext().isRTL?T.flippedView:void 0})})):void 0,c=!this.props.hideTitle&&this.state.localizedMetadata?(0,i.jsx)(_.Caption,Object.assign({small:!0,style:t.mojiTitle,numberOfLines:1,accessibilityHidden:!0},{children:this.state.localizedMetadata.pickerTitle})):void 0,h=this._useDarkTheme()?v.Color.pesPickerBackgroundDark:v.Color.pesPickerBackgroundLight,u=this._getMojiTitle();return[(0,i.jsxs)(o.View,Object.assign({style:T.mojiContainer,title:u,importantForAccessibility:o.Types.ImportantForAccessibility.Yes,accessibilityTraits:o.Types.AccessibilityTrait.Button},{children:[(0,i.jsxs)(l.default,Object.assign({style:t.thumbnailContainer},{children:[(0,i.jsx)(a.default,{origin:"MojiThumbnail",style:t.thumbnailImage,containerStyle:t.thumbnailContainer,altView:s,errorView:n,resizeMode:"cover",source:this.state.thumbnailUrl,onLoad:this._handleMojiImageLoad,onError:this._handleMojiImageLoadError},"thumbnail"),r]}),"thumbnailContainer"),(0,i.jsx)(d.default,{icon:C.SkypeIcon.MojiMaskInverted,size:this.props.dimension,color:h,style:t.mojiMask}),c]}),"mojiContainer")]}_shouldShowSendOverlay(){return this.state.isPreviewOn||this.props.isSelected}_getMojiTitle(){let e;return this.state.localizedMetadata&&(this.props.renderMobileInterface?(e=h.getString("Moji.PreviewMoji",{pickerTitle:this.state.localizedMetadata.pickerTitle||""}),this._shouldShowSendOverlay()&&(e=h.getString("Moji.SendMoji",{mojiName:e}))):e=this.state.localizedMetadata.pickerTitle,this.state.localizedMetadata.copyright&&(e+=this.state.localizedMetadata.copyright)),e}_onPressPesItem(){if(this._isMojiImageLoaded)if(this.props.sendOnFirstTapIfScreenReaderActive&&y.default.isMobileScreenReaderEnabled())this.props.onSelected(this.props.info);else{if(this.props.showMojiPreviewAsFullScreenModal){const e=(0,i.jsx)(p.MojiPreview,{moji:this.props.info,onClose:this._dismissMojiPreviewModal,onSend:this._sendMojiFromPreviewModal,useFullScreen:!0,useTransparentDarkTheme:!0,showSendButton:!0,sendButtonTitle:h.getString("Moji.SendButtonTitle"),showReplayOnMojiAfterPlay:!0,setAccessibilityFocusOnMoji:!0});return this.props.onMojiPreviewSeen&&this.props.onMojiPreviewSeen(),void r.default.showModal(e,M,{rootViewId:this._getRootViewId()})}if(this.props.renderMobileInterface)if(!this.props.renderMobileInterface||this.state.isUsingStackNavigationContext)this.props.renderMobileInterface&&!this.state.isPreviewOn?(S.MojiPreviewService.openPesPreview(this.props.info),this.setState({isPreviewOn:!0})):(S.MojiPreviewService.closePesPreview(),this.setState({isPreviewOn:!1}),this.props.onSelected(this.props.info));else if(this.state.isPreviewOn||this.props.isSelected)this._onCloseMojiPreviewModal(),this.props.onSelected(this.props.info);else{const e=(0,i.jsx)(p.MojiPreview,{moji:this.props.info,onClose:this._onCloseMojiPreviewModal,onSend:this._sendMojiFromPreviewModal,onMojiUpdated:this._onUpdateMojiPreview,useTransparentDarkTheme:!0,showSendButton:!0,sendButtonTitle:h.getString("Moji.SendButtonTitle")});this._dismissMojiPreviewModal(),r.default.showModal(e,M,{rootViewId:this._getRootViewId()}),this.setState({isPreviewOn:!0})}else this.props.isSelected&&this.props.onSelected&&this.props.onSelected(this.props.info)}}_getImportantForAccessibility(){}_getAccessibilityLabel(e){}}I._cachedStyles={},t.MojiItem=I},901117:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(889391),a=s(770891),l=s(746096),d=s(497174),c=s(436237),h=s(915877),u=s(733754),p=s(276093),g=s(331298),m=s(572666),S=s(696168),f=s(571502),y=s(63584),v=s(960621),C=s(783294),_=s(758962),b=s(431234),T=s(29130),M=s(886045),I=s(711828),w=(0,h.lazyProperties)({previewMarginBottom:()=>n.Styles.createViewStyle({marginBottom:10})});class P extends f.PesPicker{constructor(){super(...arguments),this._renderPesItem=e=>{const t=this.state.items[e];if(!t)return c.warn(l.LogTraceArea.Pes,`Moji with id ${e} not found`),null;const s=this.state.itemsForTabsMap[this._currentTabIndex],o=s&&s[0]===e,n=this._getItemDimension(),r=!!this.state.previewItem&&this.state.previewItem.id===t.id,a=-1===this.state.focusedButtonIndexInPack&&r;return n?(0,i.jsx)(g.MojiItem,{autoFocus:this._shouldAutoFocusFirstItem()&&o,tabIndex:a?0:-1,ref:this._itemsInCurrentTabRefs.onComponentRef(e),onFocus:this._getButtonFocusCallback(e),id:t.id,info:t,isSelected:r,renderMobileInterface:this.props.renderMobileInterface,onHover:this._onPesHoverBound,onSelected:this._onSelected,dimension:n,showPlaceholder:!0,showMojiPreviewAsFullScreenModal:this.props.showMojiPreviewAsFullScreenModal,onMojiPreviewSeen:this.props.onMojiPreviewSeen,onItemWillMount:this._onMojiItemWillMount,onItemDidMount:this._onMojiItemDidMount},t.id):null},this._onSelected=e=>{const t=r.default.getConfigSettings().pes,s=t.xmmFallbackUrl+t.xmmFallbackUrlParams+e.id,i=new d.MojiEntity(e.id,e.baseUrl,e.baseUrl+"/views/thumbnail","Video.1/Flik.1",s,"","Moji",e.description||"");this.props.onPesSelected(i,_.mediaTypes.moji,e.id),this._trackClickedMoji(e),!this.props.renderMobileInterface&&this.state.isSearching&&this._desktopSearchTelemetry&&(this._desktopSearchTelemetry.sendSuccessTelemetryEvent(e.id,this.state.searchQuery.length),this._searchSuccessTelemetry=!0)},this._trackClickedMoji=e=>{y.MojiPickerTelemetry.itemAdded(void 0),this._trackClickedItem(e.id)},this._onMojiPreviewClosed=e=>{if(e&&M.default.isMobileScreenReaderEnabled()){const t=this._itemsInCurrentTabRefs.ref(e.id);t&&t.requestFocus()}this.isComponentMounted()&&this.setState({previewItem:void 0})},this._onMojiPreviewOpened=e=>{this.setState({previewItem:e})},this._onMojiItemWillMount=()=>{y.MojiPickerTelemetry.willMountItem()},this._onMojiItemDidMount=()=>{y.MojiPickerTelemetry.mountedItem()}}_buildState(e,t){const s=this._getRootViewId();return Object.assign(Object.assign({},super._buildState(e,t)),{deviceOrientation:T.default.getDeviceOrientation(s)})}componentDidMount(){super.componentDidMount(),this._mojiPreviewOpenSubscriptionToken=v.MojiPreviewService.onPesPreviewOpened(this._onMojiPreviewOpened),this._mojiPreviewCloseSubscriptionToken=v.MojiPreviewService.onPesPreviewClosed(this._onMojiPreviewClosed)}componentWillUnmount(){super.componentWillUnmount(),this._mojiPreviewOpenSubscriptionToken.unsubscribe(),this._mojiPreviewCloseSubscriptionToken.unsubscribe(),y.MojiPickerTelemetry.pickerWillUnmount()}_willChangeCategory(e){super._willChangeCategory(e),e!==this._getPesTabType()&&(v.MojiPreviewService.closePesPreview(),y.MojiPickerTelemetry.closed())}_getPesPreview(){if(!this.state.previewItem)return;const e=this.props.renderMobileInterface?a.MojiSize.Large:a.MojiSize.Medium;return(0,i.jsx)(p.default,{style:w.previewMarginBottom,borderColor:this._themeColors.primaryBackgroundColor,src:this.state.previewItem.baseUrl,hideMetadata:!0,autoPlay:!0,size:e,pesID:this.state.previewItem.id},this.state.previewItem.id)}_getInitialPagedTabIndex(){return 1}_getEmptyRecentMessage(){return u.getString("PesPicker.EmptyRecentMojis")}_getPesTabType(){return _.TabType.Moji}_getTabs(e,t){const s=S.default.getMojiTabs();let i;if(e){i=C.searchInPackTitleAndDescription(s,e),i=o.filter(i,(e=>e.packs&&e.packs.length>0));const t=this._mergePacksInSingleTab(i);t&&(i=[t])}else if(""!==e){const e=b.default.getRecentMojiTabInfo();(!t||t&&!o.isEmpty(e.packs))&&s.unshift(e)}const n=i||s;return this._getContext().isRTL,n}_getSearchNoResultsMessage(){return u.getString("PesSearch.MojiPickerNoResultsSearchText")}_getErrorMessage(){return u.getString("MediaBar.MojiPickerErrorText")}_getPackAccessibilityLabel(e){return u.getString("PesPicker.MojiPackHeaderAccessibilityLabel",{title:e.title,count:e.items.length})}_getErrorSymbol(){return I.SkypeIcon.MojiDeleted}_getPesInfo(e){return[e.pickerTitle?e.pickerTitle.trim():void 0,e.copyright?e.copyright.trim():void 0]}_getPesItem(e){return m.default.getMoji(e)}_getSearchLabel(){return u.getString("PesPicker.SearchMojis")}_getStaticItemDimension(){return(this._getItemDimension()||this._getDefaultItemDimension())+this._doubleBorderItem}_getDefaultItemDimension(){return _.frameHeights.moji.Size70}_getMinItems(e){return 5}}t.default=P},256928:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MyBotFloatTooltip=void 0;const i=s(785893),o=s(516778),n=s(667294),r=s(705465),a=s(911009),l=s(245381),d=s(915877),c=s(311010),h=s(889391),u=s(178735),p=s(258187),g=s(3553),m=s(660198),S=s(912770),f=s(491632),y=s(445472),v=s(512952),C=s(496418),_=s(662602),b=s(516283),T=g.HOUR,M=(0,d.lazyProperties)({describeDestopStyle:()=>o.Styles.createTextStyle({marginTop:4,marginBottom:4,marginLeft:8,marginRight:20}),describeMobileStyle:()=>o.Styles.createTextStyle({marginTop:6,marginBottom:12,marginLeft:10,marginRight:24}),textDesktopStyle:()=>o.Styles.createTextStyle({fontSize:c.default.controlFontSize.caption}),textMobileStyle:()=>o.Styles.createTextStyle({fontSize:c.default.controlFontSize.rowTitle}),closeDesktopStyle:()=>o.Styles.createTextStyle({top:8,right:8}),closeMobileStyle:()=>o.Styles.createTextStyle({top:12,right:12})}),I=r.StyleSheet.create({viewContainer:{width:"100%",height:"100%",position:"absolute"}});t.MyBotFloatTooltip=(0,m.WithResub)((e=>{const t=(0,n.useRef)(null),[s]=(0,n.useState)(e.instanceId||"unknown"),[d,c]=(0,n.useState)(!1),[h,g]=(0,n.useState)(!1),[m,v]=(0,n.useState)(-2),w=(0,p.useCommonContext)(),P={duration:250,easing:o.Animated.Easing.OutBack()},{enableMyBot:k,enableShowFloatTooltips:A,myBotIndex:x}=e,R=()=>{c(!1),g(!1),u.default.setMyBotTooltipVisible(!0)};return(0,n.useEffect)((()=>{const e=S.default.setTimeout((()=>{d&&u.default.setMyBotTooltipVisible(!0)}),2500);return()=>{e&&S.default.clearTimeout(e)}}),[d]),(0,n.useEffect)((()=>{const e=k&&A,t=C.default.isCoachMarkBeingShown({markType:a.CoachMarkType.Profile}),s=u.default.isMyBotTooltipVisibleNoSubscription(),i=e&&(h||!s&&!t);f.Instrumentation.log(b.LogTraceArea.CoachMarks,"[MyBotFloatTooltip]",`[enableMyBot: ${k}]`,`[enableShowFloatTooltips: ${A}]`,`[shouldUpdatePostion: ${h}]`,`[isMyBotTooltipSeen: ${s}]`,`[isOtherCoachMarkBeingShown: ${t}]`),c(i),i&&f.Instrumentation.track(new y.MyBotTooltipShow)}),[k,A,h]),(0,n.useEffect)((()=>{const e=S.default.setTimeout((()=>{t.current?(t.current.updatePosition(),g(!0)):g(!1)}),300);return()=>{e&&S.default.clearTimeout(e)}}),[x,t]),(0,n.useEffect)((()=>{e.parentRef&&_.default.measureLayoutRelativeToWindow(e.parentRef).then((e=>{v(e.y)}))}),[e.parentRef]),d?(0,i.jsx)(r.View,Object.assign({style:I.viewContainer},{children:(0,i.jsx)(l.default,{toolTipInfo:{getElement:e.anchor,positions:[a.PopupAnchorPositon.Top],durationMs:T,description:e.title,anchorAccessibilityLabel:e.accessibilityLabel,instanceId:s,rootViewId:w.rootViewId},animateDismissal:!0,animationConfig:P,textMarginHorizontal:10,textMarginVertical:10,containerOffsetX:0,containerOffsetY:m,hideTitle:!0,onDismiss:()=>{f.Instrumentation.track(new y.MyBotTooltipClose(y.MyBotTooltipCloseType.TouchScreenClose)),R()},descriptionStyle:M.describeDestopStyle,popupRadius:7,popupBeakHeight:5,popupBeakWidth:10,leftMargin:12,rightMargin:12,beakOffset:22,textStyle:M.textDesktopStyle,onPressClose:()=>{f.Instrumentation.track(new y.MyBotTooltipClose(y.MyBotTooltipCloseType.ClickBtnClose)),R()},closeStyle:M.closeDesktopStyle,ref:t})})):(0,i.jsx)(i.Fragment,{})}),(e=>{const{enableMyBot:t,enableShowFloatTooltips:s}=h.default.getS4LMessagingFeatures(),i=v.default.getMyBotItemIndex();return Object.assign(Object.assign({},e),{enableMyBot:t,enableShowFloatTooltips:s,myBotIndex:i})}))},913168:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocationPickerId=void 0;const i=s(785893),o=s(496486),n=s(396265),r=s(516778),a=s(397691),l=s(889391),d=s(348564),c=s(711930),h=s(898278),u=s(436237),p=s(915877),g=s(733754),m=s(546705),S=s(89808),f=s(871082),y=s(915415),v=s(619675),C=s(24576);var _,b;!function(e){e[e.Ready=0]="Ready",e[e.Fetching=1]="Fetching",e[e.Failed=2]="Failed",e[e.Complete=3]="Complete"}(_||(_={})),function(e){e.BingFooter="nbpl_bingFooter",e.BingHeader="nbpl_bingHeader",e.BingPlace="nbpl_bingPlace"}(b||(b={})),t.LocationPickerId="LocationPicker";const T={key:"bingHeader",template:b.BingHeader,height:43,isNavigable:!1,isHoverable:!1,accessibilityGroup:n.Types.AccessibilityGroupMarker.Begin,accessibilityGroupLabel:g.getString("LocationPicker.NearByPlacesLabel")},M={key:"bingFooter",template:b.BingFooter,height:46,isNavigable:!1,isHoverable:!1,accessibilityGroup:n.Types.AccessibilityGroupMarker.End,accessibilityTrait:r.Types.AccessibilityTrait.None},I=(0,p.lazyProperties)({container:()=>r.Styles.createViewStyle({alignSelf:"stretch",flexDirection:"column",alignItems:"flex-start"}),spinner:()=>r.Styles.createViewStyle({flex:1,justifyContent:"center",alignItems:"center",alignSelf:"stretch"}),errorContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",justifyContent:"center",alignItems:"center"}),errorMessage:()=>r.Styles.createTextStyle({textAlign:"center"}),listContainer:()=>r.Styles.createViewStyle({alignSelf:"stretch"}),poweredByImage:()=>r.Styles.createImageStyle({flexDirection:"row",justifyContent:"center",marginVertical:8,paddingVertical:15}),nearbyTitleContainer:()=>r.Styles.createViewStyle({paddingHorizontal:10,paddingTop:20,paddingBottom:8,flexDirection:"row",alignItems:"flex-end",justifyContent:"space-between"})});class w extends C.default{constructor(){super(...arguments),this._renderItem=e=>{switch(e.template){case b.BingHeader:const t=g.getString("LocationPicker.NearByPlacesLabel"),s=g.getString("LocationPicker.PoweredByBingMapsLabel"),o=!0,n=o?c.default.headerAccessibilityInfo(t,s):void 0;return(0,i.jsxs)(r.View,Object.assign({style:[I.nearbyTitleContainer,this._themeStyles.primaryBackgroundColorStyle],accessibilityLabel:n?n.accessibilityLabel:void 0,accessibilityTraits:n?n.accessibilityTraits:void 0,importantForAccessibility:o?r.Types.ImportantForAccessibility.Yes:void 0},{children:[(0,i.jsx)(v.Subtitle,Object.assign({accessibilityHidden:!!o},{children:t})),(0,i.jsx)(v.Caption,Object.assign({accessibilityHidden:!!o},{children:s}))]}),e.key);case b.BingFooter:return(0,i.jsx)(r.Image,{style:I.poweredByImage,accessibilityLabel:g.getString("LocationPicker.PoweredByBingMapsLabel"),source:this.state.poweredByBingImageUrl,resizeMode:"contain"},e.key);case b.BingPlace:return(0,i.jsx)(f.BingListItem,{id:e.key,suggestion:e.suggestion,onPlaceSelected:this.props.onItemSelected,onPlaceSent:this.props.sendItem,onRemoveItem:this._onRemoveItem},e.key);default:return[]}},this._onRemoveItem=e=>{this.setState({itemList:o.filter(this.state.itemList,(t=>t.key!==e))})}}_buildState(e,t){const s={};return t&&(s.itemList=[],s.service=_.Ready,s.poweredByBingImageUrl=l.default.getS4LMessagingFeatures().bingMapsPoweredByImageUrl),s}componentDidMount(){super.componentDidMount(),this._fetchLocations(this.props.latitude,this.props.longitude,this.props.query)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),e.latitude===this.props.latitude&&e.longitude===this.props.longitude&&e.query===this.props.query||this._fetchLocations(e.latitude,e.longitude,e.query)}_fetchLocations(e,t,s){if(!e||!t)return;this._runningSearchTasks&&o.each(this._runningSearchTasks,(e=>e.cancel()));let i=this.state.service;if(this._runningSearchTasks=[],null==s?void 0:s.length){i=_.Fetching;const n=d.default.getInstance().getAutoSuggestResults(e,t,s);this._runningSearchTasks.push(n.then((e=>{let t=this.state.itemList;const s=o.findIndex(t,(e=>e.key===M.key));s>=0&&(t=t.slice(s+1));const i=[];(null==e?void 0:e.length)&&i.push(T),i.push(...o.map(e,(e=>({template:b.BingPlace,height:84,key:e.id,suggestion:e,accessibilityTrait:r.Types.AccessibilityTrait.Button})))),(null==e?void 0:e.length)&&i.push(M),this.isComponentMounted()&&this.setState({itemList:[...i,...t],service:_.Complete})})))}const n=(new Date).getTime();a.all(this._runningSearchTasks).then((()=>{const e=this.isComponentMounted(),t=(new Date).getTime();u.track(new m.LocationPickerNearByFetching(this.props.locationType,e,t-n)),this._runningSearchTasks=void 0})).fail((e=>{const t=this.isComponentMounted(),s=(new Date).getTime();u.track(new m.LocationPickerNearByFetchingFailed(this.props.locationType,t,s-n,e&&o.isNumber(e.statusCode)?e.statusCode:0))})),this.setState({service:i,itemList:[]})}_renderLocationItems(){return this.state.itemList.length?(0,i.jsx)(n.VirtualListView,{itemList:this.state.itemList,renderItem:this._renderItem,animateChanges:!1,skipRenderIfItemUnchanged:!0,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,style:I.listContainer,accessibilityLabel:g.getString("LocationPicker.NearByPlacesListLabel")}):(0,i.jsx)(r.View,{style:I.listContainer})}render(){const e=[I.container,this._themeStyles.primaryBackgroundColorStyle,this.props.style],t=this.state.service===_.Fetching?(0,i.jsx)(r.View,Object.assign({style:I.spinner},{children:(0,i.jsx)(y.default,{size:h.SXActivityIndicatorSize.Medium,tintColor:S.default.getPrimaryColorNoSubscription()})})):void 0,s=this._shouldRenderError()?(0,i.jsx)(r.View,Object.assign({style:I.errorContainer},{children:(0,i.jsx)(r.Text,Object.assign({style:[I.errorMessage,this._themeStyles.secondaryTextColorStyle]},{children:g.getString(this.props.searchModeOn?"LocationPicker.NoResultsFound":"LocationPicker.NoPlacesNearByFound")}))})):void 0;return(0,i.jsxs)(r.View,Object.assign({style:e},{children:[this._renderLocationItems(),t,s]}))}_shouldRenderError(){return!this.props.latitude||!this.props.longitude||this.state.service===_.Failed||this.state.service===_.Complete&&this.state.itemList.length<=1||o.isEmpty(this.props.query)}}t.default=w},871082:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BingListItem=void 0;const i=s(785893),o=s(516778),n=s(217041),r=s(348564),a=s(139889),l=s(110117),d=s(915877),c=s(451072),h=s(581760),u=s(711828),p=s(619675),g=s(24576),m=(0,d.lazyProperties)({listItem:()=>o.Styles.createViewStyle({flexDirection:"row",paddingHorizontal:10,paddingVertical:12}),placePicture:()=>o.Styles.createViewStyle({width:60,height:60,marginRight:10}),extraInfoContainer:()=>o.Styles.createViewStyle({flex:1,justifyContent:"center"}),placeName:()=>o.Styles.createTextStyle({marginBottom:5}),alternateView:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",width:60,height:60,alignItems:"center",justifyContent:"center",backgroundColor:h.Color.gray300})});class S extends g.default{constructor(){super(...arguments),this._onPlaceSelectedOrSent=()=>{o.UserInterface.isNavigatingWithKeyboard()&&this.props.onPlaceSent?this.props.onPlaceSent():this.props.onPlaceSelected()},this._hoverStart=()=>{this.setState({isHovering:!0})},this._hoverEnd=()=>{this.setState({isHovering:!1})}}render(){const e=(0,i.jsx)(o.View,Object.assign({style:m.alternateView},{children:(0,i.jsx)(l.default,{icon:u.SkypeIcon.Location,size:u.IconSize.size20,color:h.Color.white})})),t=[m.listItem];return this.state.isHovering&&t.push(this._themeStyles.rowHighlightViewStyle),(0,i.jsx)(o.View,{children:(0,i.jsxs)(c.MaybeListItem.Button,Object.assign({style:t,onPress:this._onPlaceSelectedOrSent,onFocus:this.props.onPlaceSelected,onHoverStart:this._hoverStart,onHoverEnd:this._hoverEnd},{children:[(0,i.jsx)(a.default,{origin:"NearByPlacePhoto",resizeMode:"cover",title:this.props.name,source:this.props.photoUrl,style:m.placePicture,containerStyle:m.placePicture,altView:e,errorView:e},"placePhoto"),(0,i.jsxs)(o.View,Object.assign({style:m.extraInfoContainer},{children:[(0,i.jsx)(p.RowTitle,Object.assign({style:m.placeName,numberOfLines:1},{children:this.props.name})),(0,i.jsx)(p.BodyText,Object.assign({numberOfLines:1,textThemeColor:p.TextThemeColor.Secondary},{children:this.props.address}))]}))]}),this.props.name+this.props.address)})}}class f extends n.ComponentBase{constructor(e){super(e),this._onSelected=()=>{this.state.place&&this.props.onPlaceSelected(this.state.place)},this._onSent=()=>{this.state.place&&this.props.onPlaceSent&&this.props.onPlaceSent(this.state.place)},this._bingMapsClient=r.default.getInstance()}componentDidMount(){super.componentDidMount(),this._bingMapsClient.getLocationDetail(this.props.suggestion).then((e=>{this.isComponentMounted()&&this.setState({place:e})})).catch((()=>{this.isComponentMounted()&&this.props.onRemoveItem(this.props.id)}))}render(){return(0,i.jsx)(S,{name:this.props.suggestion.name,address:this.props.suggestion.address,photoUrl:this.state.place&&this.state.place.photoUrl,onPlaceSelected:this._onSelected,onPlaceSent:this._onSent})}}t.BingListItem=f},743855:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(705465),n=s(600212),r=s(915415),a=s(898278),l=o.StyleSheet.create({indicatorDark:{opacity:.5}});t.default=()=>{const{themeColors:e,mode:t}=(0,n.useSkypeTheme)();return(0,i.jsx)(r.default,{size:a.SXActivityIndicatorSize.Medium,tintColor:e.iconSecondary,style:t.isDark?l.indicatorDark:void 0})}},571502:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesPicker=t.SearchInputHeight=t.PesListMobilePadding=t.PesPreviewContainerHeight=t.PesPreviewContainerWidth=t.HeaderContainerVerticalPadding=t.CategorySwitcherIconHeight=t.MinimumPesHeaderHeight=t.DesktopTabViewMargin=void 0;const i=s(785893),o=s(496486),n=s(163001),r=s(516778),a=s(244770),l=s(889391),d=s(898278),c=s(746096),h=s(110117),u=s(436237),p=s(547126),g=s(915877),m=s(733754),S=s(706250),f=s(330124),y=s(747990),v=s(743855),C=s(696168),_=s(79096),b=s(795549),T=s(141067),M=s(783294),I=s(617707),w=s(758962),P=s(75821),k=s(431234),A=s(451070),x=s(681115),R=s(886045),O=s(422538),L=s(404057),F=s(581760),B=s(640363),D=s(311010),E=s(711828),V=s(478262),N=s(680837),U=s(360305),j=s(619675),H=s(24576),z=s(853374);class W extends n.PesTabView{}class G extends n.PesListView{}t.DesktopTabViewMargin=10,t.MinimumPesHeaderHeight=60,t.CategorySwitcherIconHeight=44,t.HeaderContainerVerticalPadding=10,t.PesPreviewContainerWidth=140,t.PesPreviewContainerHeight=120,t.PesListMobilePadding=8,t.SearchInputHeight=30;const K=(0,g.lazyProperties)({pesPickerContainerMobile:()=>r.Styles.createViewStyle({flex:1,alignItems:"stretch",justifyContent:"center"}),pesPickerContainerTransparent:()=>r.Styles.createViewStyle({backgroundColor:F.Color.transparent}),errorPaddingStyle:()=>r.Styles.createViewStyle({padding:15}),pesScrollContainer:()=>r.Styles.createViewStyle({alignSelf:"stretch"}),pesScrollContainerMobile:()=>r.Styles.createViewStyle({paddingHorizontal:8}),pesScrollContainerTransparent:()=>r.Styles.createViewStyle({backgroundColor:F.Color.transparent}),tabViewStyleRTL:()=>r.Styles.createViewStyle({transform:[{scaleX:-1}]}),wrappedPesList:()=>r.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"flex-start",flex:1}),sectionTitle:()=>r.Styles.createViewStyle({alignSelf:"stretch",borderBottomWidth:1,borderStyle:"solid",marginBottom:4}),sectionTitleDesktop:()=>r.Styles.createViewStyle({borderBottomWidth:0,paddingTop:10}),sectionTitleText:()=>r.Styles.createTextStyle({margin:4}),sectionTitleLight:()=>r.Styles.createTextStyle({color:F.Color.gray300}),sectionTitleAccessible:()=>r.Styles.createTextStyle({color:F.Color.black}),errorContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center"}),errorIconContainer:()=>r.Styles.createViewStyle({alignItems:"center",justifyContent:"center",paddingBottom:30}),errorTextStyle:()=>r.Styles.createTextStyle({textAlign:"center"}),messageContainer:()=>r.Styles.createViewStyle({justifyContent:"center",alignItems:"center"}),messageText:()=>r.Styles.createTextStyle({textAlign:"center",marginHorizontal:40}),flippedView:()=>r.Styles.createViewStyle({transform:[{scaleX:-1}]}),headerShadow:()=>r.Styles.createViewStyle({left:0,right:0,height:1,marginBottom:-1}),wrappedContent:()=>r.Styles.createViewStyle({flexDirection:"column-reverse",flex:1,alignItems:"stretch"}),pesPickerContainerBackgroundLight:()=>r.Styles.createViewStyle({backgroundColor:F.Color.pesPickerBackgroundLight}),pesPickerContainerBackgroundDark:()=>r.Styles.createViewStyle({backgroundColor:F.Color.pesPickerBackgroundDark}),sectionTitleView:()=>r.Styles.createViewStyle({alignSelf:"stretch",height:22}),sectionTitleTextMargin:()=>r.Styles.createViewStyle({marginTop:5,marginLeft:5}),desktop:()=>(0,g.lazyProperties)({pesPickerContainerDesktop:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row"}),pesListViewMargin:()=>r.Styles.createViewStyle({marginLeft:t.DesktopTabViewMargin}),sectionTitleText:()=>r.Styles.createViewStyle({marginTop:4,marginBottom:4,marginRight:4,marginLeft:6}),previewInfoContainer:()=>r.Styles.createViewStyle({alignItems:"center",justifyContent:"center",borderRightWidth:1,borderColor:F.Color.gray50,width:t.PesPreviewContainerWidth}),previewContainer:()=>r.Styles.createViewStyle({flexGrow:1,alignItems:"center",justifyContent:"center"}),previewLabel:()=>r.Styles.createTextStyle({textAlign:"center",marginHorizontal:8}),searchNoResultsImage:()=>r.Styles.createImageStyle({height:80,width:80}),searchResultsList:()=>r.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",paddingTop:10}),loadingContainer:()=>r.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center"})}),mobile:()=>(0,g.lazyProperties)({pesPickerTabContainer:()=>r.Styles.createViewStyle({paddingHorizontal:t.PesListMobilePadding})})}),q={};class Q extends H.default{constructor(){super(...arguments),this._tabsSeen=!1,this._tabHeaderRefs={},this._buttonFocusCallbacks={},this._cachedDimensions={},this._listViewNoPagingRefs={},this._previewSeen=!1,this._itemsInCurrentTabRefs=new S.default,this._doubleBorderItem=2*b.PesItemBorderWidth,this._scrolledToTop=!0,this._headerOpacityValue=new r.Animated.Value(0),this._headerOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._headerOpacityValue}),this._onPesHoverBound=o.debounce((e=>{if(!this.isComponentMounted())return;const t={previewItem:e};this.setState(t)}),100),this._trackClickedItem=(e,t,s,i)=>{if(!this.state.enableItemClickTracking)return;const n=this.state.isSearching?0:this._currentTabIndex,r=this.state.tabs[n],a=o.find(r.packs,(t=>o.includes(t.items,e))),l=this.state.availableWidth||this.props.availableWidth,d={itemIndex:a?o.indexOf(a.items,e):-1,sectionIndex:r?o.indexOf(r.packs,a):-1,tabIndex:n,pickerWidth:l||-1,itemTone:t,type:this._getPesTabType(),groupIndex:s,isSearchMode:this.props.searchMode,triggeredBy:i};u.track(new y.PesItemTelemetryEvent(d))},this._onCategoryPressed=e=>{let t;switch(e){case w.TabType.Emoticon:t=V.MediaBarCustomAction.LaunchEmoticon;break;case w.TabType.Moji:t=V.MediaBarCustomAction.LaunchMoji;break;case w.TabType.ChatSticker:t=V.MediaBarCustomAction.LaunchSticker;break;case w.TabType.Gif:t=V.MediaBarCustomAction.LaunchGif}this._willChangeCategory(e),this.props.onCustomAction&&!o.isUndefined(t)&&this.props.onCustomAction(t)},this._onCategorySwitcherRef=e=>{this._categorySwitcherRef=e||void 0},this._setTabViewRef=e=>{this._tabViewRef=e||void 0},this._setTabViewNoPagingRef=e=>{this._tabViewNoPagingRef=e||void 0},this._setTabIndicatorRef=e=>{this._tabIndicatorRef=e||void 0},this._setMainContentRef=e=>{this._mainContentRef=e||void 0},this._renderTabContent=(e,t)=>{if(!e)return null;if(e.id===k.default.recentTabId&&0===e.packs.length){const e=[K.messageContainer];return this._appendCommonStyles(e),(0,i.jsx)(r.View,Object.assign({style:e},{children:(0,i.jsx)(r.Text,Object.assign({style:[K.messageText,this._themeStyles.primaryTextColorStyle]},{children:this._getEmptyRecentMessage()}))}))}if(this.state.isFetchingItems)return this._getLoadingView();const s=this._getPesListViewStyle(),a=[K.pesScrollContainer];this.props.renderMobileInterface&&a.push(K.pesScrollContainerMobile),this.props.darkTheme&&a.push(K.pesScrollContainerTransparent),this._appendCommonStyles(a);const l=this._getPacksForPesListView(e.packs),d=this._getStaticItemDimension()||40;let c,h=!0;o.isUndefined(t)||(c=t-22,h=c>d);const u=this.state.tabs[0].id===e.id;if(this.props.renderMobileInterface&&this._shouldRenderTabsWithoutPaging())return(0,i.jsx)(r.View,Object.assign({style:a},{children:(0,i.jsx)(n.PesPackHorizontalListView,{packs:l,renderPackHeader:h?this._renderPackHeader:this._noOp,renderPackItem:u?this._renderFirstTabPesItem:this._renderPesItem,style:s,availableHeight:c,itemHeight:d,getNumberOfColumnsForInitialRender:(t,s,i)=>this._getNumberOfColumnsForInitialRender(t,s,i,e.id),ref:t=>this._onListViewRef(t,e.id)})}));{const e=this._getNumberOfItemsPerLine()||4;return this._hasEmptyPack(l)?this._getErrorView():(0,i.jsx)(G,{packs:l,itemHeight:d,renderPackHeader:this._renderPackHeader,renderPackItem:this._renderPesItem,style:[...s,this.state.safeAreaHorizontalPaddingStyle],onScroll:this._onScroll,onScrolled:this._onDesktopScroll,numberOfColumns:e,onKeyPress:this._onKeyPress,setScrollTopOnKeyboardNavigation:!1})}},this._noOp=e=>{},this._renderPackHeader=e=>{const t=this.props.renderMobileInterface?[K.sectionTitleView]:[K.sectionTitle,this._themeStyles.dividerBorderColorStyle];this.props.renderMobileInterface||t.push(K.sectionTitleDesktop);const s=this.state.packs[e];if(s)return(0,i.jsx)(r.View,Object.assign({ref:this._setFirstTabHeaderRef,style:t,accessibilityLabel:this._getPackAccessibilityLabel(s),importantForAccessibility:r.Types.ImportantForAccessibility.Yes,accessibilityTraits:[r.Types.AccessibilityTrait.Text,r.Types.AccessibilityTrait.Header],tabIndex:-1},{children:(0,i.jsx)(r.Text,Object.assign({style:this._getSectionTitleTextStyle(),numberOfLines:1,allowFontScaling:!1},{children:s.title}))}),"sectionTitle");u.warn(c.LogTraceArea.Pes,`Pack with id ${e} not found`)},this._onScroll=(e,t)=>{if(this.props.onScroll&&this.props.onScroll(e,t),!this.state.isDesktopCompositeNav){const t=e<=0;this._scrolledToTop!==t&&(this._scrolledToTop=t,r.Animated.timing(this._headerOpacityValue,{toValue:t?0:1,duration:50,easing:r.Animated.Easing.Out()}).start())}},this._onCurrentVisibleTabChanged=e=>{if(this._tabIndicatorRef){const t=o.findIndex(this.state.tabs,(t=>t.id===e));this._tabIndicatorRef.onPageSelected({position:t}),this._setListViewUpdatePriority(t)}},this._onTabSelected=e=>{const t=o.findIndex(this.state.tabs,(t=>t.id===e.id));if(this._currentTabIndex===t)return;this._previousTabIndex=this._currentTabIndex,this._currentTabIndex=t,this._setListViewUpdatePriority(this._currentTabIndex),this._tabViewRef&&this._tabViewRef.showTab(this.state.tabs[this._currentTabIndex]),this._tabViewNoPagingRef&&this._tabViewNoPagingRef.showTab(this.state.tabs[this._currentTabIndex]),this._tabIndicatorRef&&this._tabIndicatorRef.onPageSelected({position:this._currentTabIndex}),this._itemsInCurrentTabRefs=new S.default,this._buttonFocusCallbacks={},this.setState({hasSwitchedTabs:!0});this._tabHeaderRefs[this._currentTabIndex];this.requestFocusOnFirstItem(),this._willChangeTab(e)},this._setFirstTabHeaderRef=e=>{this._previousTabIndex&&this._tabHeaderRefs[this._previousTabIndex]&&!e&&(this._tabHeaderRefs[this._previousTabIndex]=void 0),this._currentTabIndex&&!this._tabHeaderRefs[this._currentTabIndex]&&e&&(this._tabHeaderRefs[this._currentTabIndex]=e,this.props.dontSetFocusOnTabHeader)},this._onContainerLayout=e=>{const s=e.width-t.DesktopTabViewMargin;this.state.availableWidth!==e.width&&this.setState({availableWidth:s}),this._onPickerResize()},this._onContainerBlur=()=>{this.setState({hasFocus:!1,focusedButtonIndexInPack:-1,focusedPackIndex:-1})},this._onKeyPress=e=>{let t=0;const s=this._getNumberOfItemsPerLine()||0;if(e.keyCode===p.default.RIGHT?t=1:e.keyCode===p.default.LEFT?t=-1:e.keyCode===p.default.UP?t=-s:e.keyCode===p.default.DOWN&&(t=s),0===t)return;const i=this.state.isSearching?0:this._currentTabIndex,o=this.state.focusedButtonIndexInPack,n=this.state.focusedPackIndex,r=this._getPacksForPesListView(this.state.tabs[i].packs),a=this.state.isSearching?Object.keys(this.state.items):r[Object.keys(r)[n]];if(!a)return;const l=a.length,d=o%s;let c;const h=o+t;if(h<l&&h>-1)c=a[h];else if(this.state.isSearching&&e.keyCode===p.default.DOWN){Math.floor(o/s)===Math.floor((l-1)/s)||(c=a[l-1])}else e.keyCode===p.default.LEFT||e.keyCode===p.default.UP?c=this._getRequiredItemIdOfAdjacentPack(!1,n,o,d,t,r,s,a):e.keyCode===p.default.RIGHT?c=this._getRequiredItemIdOfAdjacentPack(!0,n,o,0,t,r,s,a):e.keyCode===p.default.DOWN&&(c=this._getRequiredItemIdOfAdjacentPack(!0,n,o,d,t,r,s,a));c&&this._requestFocusOnItem(c),e.preventDefault(),e.stopPropagation()},this._renderFirstTabPesItem=e=>this._renderPesItem(e,!0)}_buildState(e,t){let s;e.filter&&(s=L.default.deburrLowerCase(e.filter.trim()));const i=l.default.getS4LMessagingFeatures(),o=f.default.isUsingStackNavigationContext(),n=U.default.isTabletUI(),r=o||n,a=U.default.isTablet()?!e.searchMode&&e.showCategorySwitcher:!e.searchMode&&e.showCategorySwitcher&&o,c=!!e.forceExcludeRecents||e.renderMobileInterface&&this._shouldRenderTabsWithoutPaging(),h=this._getTabs(s,c,i.enableEmoticonGroups),u=this._getPackDataForPicker(h),p=this._getPesItems(h,e.filter),{itemIdsPerTabMap:g,previewItem:m,totalItemsCount:S}=this._getItemIdsForTabs(h,e.filter),y={tabs:h,packs:u,items:p,totalItemsCount:S,loadingStatus:C.default.getLoadingStatus(),isDesktopCompositeNav:!o,isSearching:!!e.filter,bottomSafeAreaInset:A.default.bottomSafeAreaInset(d.BottomInsetDefault),safeAreaHorizontalInsets:A.default.horizontalInsets(d.HorizontalInsetDefault),useMobileUI:r,itemsForTabsMap:g,showCategorySwitcher:a,forceRenderTabIndicator:!1,enableItemClickTracking:i.enableIndividualPesItemTelemetry,focusedButtonIndexInPack:-1,focusedPackIndex:-1};return t?(this._currentTabIndex=this._getStartingTabIndex(h),y.searchQuery="",y.hasSwitchedTabs=!1,y.previewItem=m):this.state.previewItem||(y.previewItem=m),y.isFetchingItems=!(!h||!h[this._currentTabIndex])&&h[this._currentTabIndex].isFetchingItems,e.ancestorUsesSafeAreaHorizontalPaddingStyle||(y.safeAreaHorizontalPaddingStyle=A.default.horizontalPaddingStyle(d.HorizontalInsetDefault)),y}componentDidMount(){super.componentDidMount();const e=z.default.newCauseId();u.log(c.LogTraceArea.Pes,"PesPicker componentDidMount causeId: "+e),this.state.loadingStatus===C.PesConfigLoadingStatus.NotStarted?O.EnsureStarted(I.default).then((()=>I.default.refreshConfig(e))):this.state.loadingStatus===C.PesConfigLoadingStatus.Loading&&I.default.refreshConfig(e)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=this.state.searchQuery!==t.searchQuery,o=this.props.filter!==e.filter;if(this._shouldAnnounceForAccessibility(i,o)){const e=this.props.filter||this.state.searchQuery;this._annouceForAccessibility(this._getSearchItemsCountForAccessibility(),e)}if(o){this._itemsInCurrentTabRefs=new S.default,this._buttonFocusCallbacks={};const e=this.state.items[Object.keys(this.state.items)[0]];this.setState({previewItem:e})}}componentWillUnmount(){super.componentWillUnmount(),this._desktopSearchTelemetry&&this.state.isSearching&&!this._searchSuccessTelemetry&&this._desktopSearchTelemetry.cancelSessionTelemetryEvent(this.state.searchQuery.length)}_shouldRenderTabsWithoutPaging(){return!R.default.isMobileScreenReaderEnabled()&&this._supportsRenderTabsWithoutPaging()}_supportsRenderTabsWithoutPaging(){return!1}_requestFocusOnItem(e){const t=this._itemsInCurrentTabRefs.ref(e);t&&t.requestFocus()}_getButtonFocusCallback(e){return this._buttonFocusCallbacks[e]||(this._buttonFocusCallbacks[e]=t=>{let s=-1,i=-1;if(this.state.isSearching)s=o.indexOf(Object.keys(this.state.items),e);else{const t=this._getPacksForPesListView(this.state.tabs[this._currentTabIndex].packs);o.each(t,((n,r)=>{if(s=o.indexOf(n,e),-1!==s)return i=o.indexOf(Object.keys(t),r),!1}))}this.setState({focusedButtonIndexInPack:s,focusedPackIndex:i})}),this._buttonFocusCallbacks[e]}_getWrappedPesListStyle(e){if(0===e)return[K.wrappedPesList];let t=q[e];return t||(t=r.Styles.createViewStyle({marginHorizontal:e},!1),q[e]=t),[K.wrappedPesList,t]}_onPickerResize(){}_willChangeTab(e){}_willChangeCategory(e){}_getItemIdsForTabs(e,t){const s={};let i,n=0;return o.each(e,((e,r)=>{const a=[];o.each(e.packs,(s=>{o.each(s.items,(s=>{const o=this._getPesItem(s,t);o&&this._isPesItemVisible(o)&&(a.push(o.id),i||this.props.renderMobileInterface||e.id===k.default.recentTabId||(i=o))}))})),s[r]=a,n+=a.length})),{itemIdsPerTabMap:s,previewItem:i,totalItemsCount:n}}_mergePacksInSingleTab(e){let t;if(e.length>0){t=e[0];let s=new Array;o.each(e,(e=>{s=s.concat(e.packs)}));t=Object.assign(Object.assign({},t),{packs:s})}return t}_shouldAutoFocusFirstItem(){return(this.state.hasSwitchedTabs||this.props.autoFocusFirstItem)&&!this.state.isSearching}_getItemDimensionBasedOnAvailableWidth(e,t,s){const i=this._getAvailableWidthForItemsDisplay(e),n=t+this._doubleBorderItem,r=Math.round(i/n);let a=i/Math.max(s,r)-2*b.PesItemPadding-this._doubleBorderItem;if(-1!==a.toString().indexOf(".")){const e=o.split(a.toString(),".",2);a=parseFloat(e[0]+"."+e[1].charAt(0))}return a}_getItemDimension(){const e=this.state.availableWidth;if(o.isUndefined(e))return;if(this._cachedDimensions[e])return this._cachedDimensions[e];const t=this._getMinItems(e),s=this._getItemDimensionBasedOnAvailableWidth(Math.floor(e),this._getDefaultItemDimension(),t);return this._cachedDimensions[e]=s,this._cachedDimensions[e]}_getMinItems(e){return 3}_getPesItems(e,t){const s={};return o.each(e,(e=>{o.each(e.packs,(e=>{o.each(e.items,(e=>{const i=this._getPesItem(e,t);i&&this._isPesItemVisible(i)&&(s[e]=i)}))}))})),s}_getNumberOfItemsPerLine(){const e=this.state.availableWidth;if(!o.isUndefined(e))return Math.floor(this._getAvailableWidthForItemsDisplay(e)/this._getStaticItemDimension())}_getAvailableWidthForItemsDisplay(e){return e-(t.DesktopTabViewMargin||2*t.PesListMobilePadding)-this.state.safeAreaHorizontalInsets.left-this.state.safeAreaHorizontalInsets.right}requestFocusOnFirstItem(){const e=this.state.itemsForTabsMap[this._currentTabIndex];e&&e.length>0&&this._requestFocusOnItem(e[0])}_getPackDataForPicker(e){const t={};return o.each(e,(e=>{o.each(e.packs,(e=>{t[e.id]=e}))})),t}_reverseLayout(){return this._getContext().isRTL&&B.default.getPlatformType()===c.PlatformType.Android}_isDarkThemeAllowed(){return this._useDarkTheme()&&!!this.props.darkTheme}render(){return this.props.renderMobileInterface?this._renderMobile():this._renderDesktop()}_renderMobile(){if(this.state.loadingStatus===C.PesConfigLoadingStatus.Error)return this._getErrorView();if(this._noSearchResultsFound())return this.props.onSearchNoResultsFound&&this.props.onSearchNoResultsFound(),this._getNoSearchResultsView();if(this._isLoadingConfig())return this._getLoadingView();const e=this.state.tabs[this._currentTabIndex],t=this._reverseLayout();this._tabsSeen=!this.props.doNotRenderTabIndicator&&!this.state.searchQuery;const s=[];this.state.safeAreaHorizontalPaddingStyle&&s.push(this.state.safeAreaHorizontalPaddingStyle),this.state.bottomSafeAreaInset&&s.push(x.default.marginBottomStyle(this.state.bottomSafeAreaInset)),this._isDarkThemeAllowed()?s.push(K.pesPickerContainerBackgroundDark):s.push(K.pesPickerContainerBackgroundLight);const o=this._tabsSeen?(0,i.jsx)(P.default,{style:s,initialTab:e,ref:this._setTabIndicatorRef,transparentTheme:!1,onPesDeleteButtonPress:this.props.onPesDeleteButtonPress,tabs:this.state.tabs,onTabSelected:this._onTabSelected,conversationId:this.props.conversationId,onMessageSent:this.props.onMessageSent,onCloseSearch:this.props.onCloseSearch,clearEditInChatsComposer:this.props.clearEditInChatsComposer,renderMobileInterface:this.props.renderMobileInterface,reversed:t,hideSearchDelete:this.props.hideSearchDelete,darkTheme:this._isDarkThemeAllowed()}):null;let a=this._shouldRenderTabsWithoutPaging()?(0,i.jsx)(n.PesTabViewNoPaging,{ref:this._setTabViewNoPagingRef,style:t?K.tabViewStyleRTL:void 0,tabs:this.state.tabs,renderTab:this._renderTabContent,tabOrderReversed:t,onTabSelected:this._onTabSelected,onCurrentScrollActiveTabChanged:this._onCurrentVisibleTabChanged,onScroll:this._onMobileScroll}):(0,i.jsx)(W,{style:t?K.tabViewStyleRTL:void 0,initialTab:e,ref:this._setTabViewRef,tabs:this.state.tabs,renderTab:this._renderTabContent,onTabSelected:this._onTabSelected,forceDesktopMode:this._shouldForceLandscapeMode(),tabOrderReversed:t,isFetching:!!this.state.isFetchingItems,availableWidth:this.state.availableWidth,removeHiddenItems:this._getPesTabType()===w.TabType.Gif});this.state.showCategorySwitcher&&(a=(0,i.jsxs)(r.View,Object.assign({style:K.wrappedContent,onLayout:this._onContainerLayout},{children:[a,(0,i.jsx)(r.Animated.View,{style:[K.headerShadow,this._themeStyles.headerShadowColorStyle,this._headerOpacityStyle]}),(0,i.jsx)(_.default,{ref:this._onCategorySwitcherRef,currentTabType:this._getPesTabType(),onSwitchPesTabType:this._onCategoryPressed,showInLandscape:!0,preventAutoFocus:this.props.preventAutoFocusOnCategory},"categorytoggle")]})));const l=this._isDarkThemeAllowed()?K.pesPickerContainerBackgroundDark:K.pesPickerContainerBackgroundLight,d=[K.pesPickerContainerMobile,l];if(this.props.isRenderedForCustomStatus){const e=r.Styles.createViewStyle({width:this.props.availableWidth},!1);d.push(e)}return(0,i.jsxs)(r.View,Object.assign({ref:this._setMainContentRef,style:d,onLayout:this._onContainerLayout},{children:[a,o]}),this._containerKey())}_isLoadingConfig(){const e=this.state.tabs&&1===this.state.tabs.length&&this.state.tabs[0].id===k.default.recentTabId;return this.state.loadingStatus===C.PesConfigLoadingStatus.NotStarted||this.state.loadingStatus===C.PesConfigLoadingStatus.Loading||o.isEmpty(this.state.tabs)||e}_renderDesktop(){let e,t,s;if(this._tabsSeen=!1,this.state.loadingStatus===C.PesConfigLoadingStatus.Error)e=this._getErrorView();else if(this.state.isSearching)this._desktopSearchTelemetry||(this._desktopSearchTelemetry=new T.default(!0,this._getPesTabType())),t=this._getOptionalPesPreview(),e=this._getDesktopSearchResults();else if(this._isLoadingConfig())e=this._getLoadingView();else{t=this._getOptionalPesPreview();const o=this.state.tabs[this._currentTabIndex],n=this._reverseLayout(),a=[];this.state.safeAreaHorizontalPaddingStyle&&a.push(this.state.safeAreaHorizontalPaddingStyle),this.state.bottomSafeAreaInset&&a.push(x.default.marginBottomStyle(this.state.bottomSafeAreaInset)),this._tabsSeen=!this.props.doNotRenderTabIndicator||this.state.forceRenderTabIndicator,s=this._tabsSeen?(0,i.jsx)(P.default,{style:a,initialTab:o,ref:this._setTabIndicatorRef,transparentTheme:!1,onPesDeleteButtonPress:this.props.onPesDeleteButtonPress,tabs:this.state.tabs,onTabSelected:this._onTabSelected,conversationId:this.props.conversationId,onMessageSent:this.props.onMessageSent,onCloseSearch:this.props.onCloseSearch,clearEditInChatsComposer:this.props.clearEditInChatsComposer,renderMobileInterface:this.props.renderMobileInterface,reversed:n,darkTheme:this._isDarkThemeAllowed(),hideDeleteButton:this.props.hideDeleteButton}):void 0,e=(0,i.jsx)(r.View,Object.assign({ref:this._setMainContentRef,onLayout:this._onContainerLayout,onBlur:this._onContainerBlur,style:N.default.flexOne},{children:(0,i.jsx)(W,{style:n?K.tabViewStyleRTL:void 0,initialTab:o,ref:this._setTabViewRef,tabs:this.state.tabs,renderTab:this._renderTabContent,onTabSelected:this._onTabSelected,forceDesktopMode:this._shouldForceLandscapeMode(),tabOrderReversed:n,isFetching:!!this.state.isFetchingItems,removeHiddenItems:!1,availableWidth:this.state.availableWidth})}))}const o=[K.desktop.pesPickerContainerDesktop];return this.props.darkTheme&&o.push(K.pesPickerContainerTransparent),(0,i.jsxs)(r.View,Object.assign({style:o},{children:[t,(0,i.jsxs)(r.View,Object.assign({style:N.default.flexOne},{children:[e,s]}))]}),this._containerKey())}getNumberOfPesItemsRendered(){let e=0;return this.state.tabs&&o.each(this.state.tabs,(t=>{o.each(t.packs,(t=>{e+=t.items.length}))})),e}requestFocus(){this._categorySwitcherRef&&this._categorySwitcherRef.requestFocus()}getTabIndexByTabId(e,t){return o.findIndex(e,(e=>e.id===t))}getTabIndexByCopyright(e,t){return o.findIndex(e,(e=>e.copyright===t))}_getStartingTabIndex(e){return this._shouldRenderTabsWithoutPaging()?0:this._getInitialPagedTabIndex(e)}_isPesItemVisible(e){return o.isUndefined(e.visible)||e.visible}_containerKey(){return"container"+this.state.safeAreaHorizontalInsets.left+"_"+this.state.safeAreaHorizontalInsets.right}_shouldForceLandscapeMode(){return!1}_getNumberOfColumnsForInitialRender(e,t,s,i){let o=e;for(let e=0;e<this.state.tabs.length;e++){const n=this.state.tabs[e],r=n.id===i;for(let e=0;e<n.packs.length;e++){if(r&&e===s)return o;if(o-=Math.ceil(n.packs[e].items.length/t),o<=0)return 0}}return o}_setListViewUpdatePriorityForTab(e,t,s){if(s){const i=Math.abs(t-e);s.setBackgroundUpdatePriority(i)}}_setListViewUpdatePriority(e){o.each(this._listViewNoPagingRefs,((t,s)=>{this._setListViewUpdatePriorityForTab(e,+s,t)}))}_onListViewRef(e,t){const s=o.findIndex(this.state.tabs,(e=>e.id===t));s>-1&&(this._listViewNoPagingRefs[s]=e||void 0,this._setListViewUpdatePriorityForTab(this._currentTabIndex,s,e||void 0))}_hasEmptyPack(e){return o.some(e,(e=>!e.length))}_getPesListViewStyle(){const e=[N.default.flexOne];if(this.props.renderMobileInterface)e.push(K.mobile.pesPickerTabContainer);else{const t=K.desktop.pesListViewMargin;e.push(t)}return this.props.initialPaddingForSearchResults&&e.push(r.Styles.createViewStyle({paddingTop:this.props.initialPaddingForSearchResults},!1)),e}_appendCommonStyles(e){const t=this._reverseLayout(),s=this.state.safeAreaHorizontalPaddingStyle;e.push(N.default.flexOne),t&&e.push(K.flippedView),s&&e.push(s)}_getSectionTitleTextStyle(){let e=this._themeStyles.secondaryTextColorStyle;!this.props.darkTheme&&this._useAccessibleTheme()?e=K.sectionTitleAccessible:!this.props.darkTheme&&this._useDarkTheme()&&(e=K.sectionTitleLight);const t=[D.default.fontStyle.caption,e];let s=K.sectionTitleText;return this.props.renderMobileInterface&&this._shouldRenderTabsWithoutPaging()?s=K.sectionTitleTextMargin:this.props.renderMobileInterface||(s=K.desktop.sectionTitleText),t.push(s),t}_getOptionalPesPreview(){if(this._previewSeen=!1,!this.props.showingInNarrowView&&!this.props.doNotRenderPreview)return this._noSearchResultsFound()||this._isFetchingResults()&&!this.state.previewItem?(0,i.jsx)(r.View,Object.assign({style:this._getPesPreviewStyle()},{children:(0,i.jsx)(r.Image,{style:K.desktop.searchNoResultsImage,source:a.Collection.SEARCH_EMPTYSTATE})})):!this._noSearchResultsFound()&&this.state.previewItem?(this._previewSeen=!0,(0,i.jsx)(r.View,Object.assign({style:this._getPesPreviewStyle()},{children:this._getPesPreviewMediaAndInfo()}))):void 0}_getPesPreviewStyle(){const e=[K.desktop.previewInfoContainer];return this._useDarkTheme()&&e.push(this._themeStyles.headerShadowBorderColorStyle),e}_getPesPreviewMediaAndInfo(){const e=K.desktop.previewContainer;return(0,i.jsxs)(r.View,Object.assign({style:e},{children:[this._getPesPreview(),this._getPesPreviewInfo()]}),"PreviewContainer")}_getPesPreviewInfo(){const[e,t]=this._getPesInfo(this.state.previewItem),s=[K.desktop.previewLabel,D.default.fontStyle.captionSmall];e&&s.push(D.default.fontStyle.subtitle),s.push(this._themeStyles.primaryTextColorStyle);const o=[K.desktop.previewLabel,D.default.fontStyle.captionSmall],n=r.Styles.createTextStyle({color:this._themeColors.textSecondary},!1);return(0,i.jsxs)(r.View,Object.assign({title:e},{children:[(0,i.jsx)(r.Text,Object.assign({style:s},{children:e}),"pesTitle"),(0,i.jsx)(r.Text,Object.assign({style:[o,n]},{children:t}),"pesInfo")]}),"InfoContainer")}_noSearchResultsFound(){return this.state.isSearching&&o.isEmpty(this.state.tabs)}_isFetchingResults(){return!1}_shouldAnnounceForAccessibility(e,t){return this.state.isSearching&&(e||t)}_getSearchItemsCountForAccessibility(){return this.getNumberOfPesItemsRendered()}_annouceForAccessibility(e,t){const s=this._getPesTabType();if(0===e){const e=M.getNoSearchResultsAnnouncementKey(s),i=m.getString(e,{query:t||""});r.Accessibility.announceForAccessibility(i)}else{const t=M.getSearchResultsAnnouncementKey(s),i=m.getString(t,{count:e});r.Accessibility.announceForAccessibility(i)}}_getDesktopSearchResults(){if(this._isFetchingResults())return this._getLoadingView();if(this._noSearchResultsFound())return this._desktopSearchTelemetry&&this._desktopSearchTelemetry.trackNoResultsInSearch(),this.props.onSearchNoResultsFound&&this.props.onSearchNoResultsFound(),this._getNoSearchResultsView();const e=[K.pesScrollContainer];this._appendCommonStyles(e);const t=K.desktop.searchResultsList;return(0,i.jsx)(r.View,Object.assign({ref:this._setMainContentRef,style:e,onLayout:this._onContainerLayout,onKeyPress:this._onKeyPress,onBlur:this._onContainerBlur},{children:(0,i.jsx)(r.ScrollView,Object.assign({keyboardShouldPersistTaps:!0,style:this._getPesListViewStyle()},{children:(0,i.jsx)(r.View,Object.assign({style:t},{children:o.map(this.state.items,((e,t)=>this._renderPesItem(t)))}))}))}))}_getNoSearchResultsView(){return(0,i.jsx)(r.View,Object.assign({style:[K.errorContainer]},{children:(0,i.jsx)(j.BodyText,Object.assign({style:K.errorTextStyle,textThemeColor:j.TextThemeColor.Secondary},{children:this._getSearchNoResultsMessage()}))}))}_getPacksForPesListView(e){const t={};return o.each(e,(e=>(t[e.id]=o.filter(e.items,(e=>!!this.state.items[e])),t))),t}_getErrorView(){const e=[K.errorContainer,K.errorPaddingStyle,this._themeStyles.primaryBackgroundColorStyle];return(0,i.jsxs)(r.View,Object.assign({style:e},{children:[(0,i.jsx)(r.View,Object.assign({style:K.errorIconContainer},{children:(0,i.jsx)(h.default,{icon:this._getErrorSymbol(),color:this._themeColors.secondaryTextColor,size:E.IconSize.size60})})),(0,i.jsx)(j.BodyText,Object.assign({style:K.errorTextStyle,textThemeColor:j.TextThemeColor.Secondary},{children:this._getErrorMessage()}))]}))}_getLoadingView(e){const t=e?K.pesPickerContainerTransparent:this._themeStyles.primaryBackgroundColorStyle,s=this.props.renderMobileInterface?[K.errorContainer,t]:[K.desktop.loadingContainer];return(0,i.jsx)(r.View,Object.assign({style:s},{children:(0,i.jsx)(v.default,{})}))}_getRequiredItemIdOfAdjacentPack(e,t,s,i,o,n,r,a){if(!e&&t>0){t--;const e=n[Object.keys(n)[t]];let s=e.length-1;if(o<-1){const t=e.length;s=Math.floor((t-1)/r)*r+i,s>=e.length&&(s=e.length-1)}return e[s]}if(e){const e=a.length;if(!(Math.floor(s/r)===Math.floor((e-1)/r)))return a[e-1];if(t<Object.keys(n).length-1){t++;const e=n[Object.keys(n)[t]];return i>=e.length&&(i=e.length-1),e[i]}}}}t.PesPicker=Q},79096:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(583367),r=s(516778),a=s(4736),l=s(889391),d=s(711930),c=s(898278),h=s(547126),u=s(915877),p=s(733754),g=s(609748),m=s(706250),S=s(526424),f=s(960621),y=s(758962),v=s(29130),C=s(451070),_=s(22222),b=s(311010),T=s(711828),M=s(581760),I=s(360305),w=s(24576),P=s(853374),k=(0,u.lazyProperties)({categoryButtonContainerTopMargin:()=>r.Styles.createViewStyle({marginTop:5,marginBottom:5}),categoryButtonContainer:()=>r.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",justifyContent:"space-between",margin:5}),categoryButton:()=>r.Styles.createButtonStyle({flex:1,flexBasis:0,marginRight:5}),categoryButtonLast:()=>r.Styles.createButtonStyle({marginRight:0}),categoryButtonNotSelected:()=>r.Styles.createButtonStyle({opacity:.5}),categoryButtonText:()=>r.Styles.createTextStyle({fontSize:b.default.controlFontSize.caption}),desktop:()=>(0,u.lazyProperties)({categoryButtonContainer:()=>r.Styles.createViewStyle({flexGrow:1,flexShrink:0,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",marginRight:5,overflow:"visible"}),categoryButton:()=>r.Styles.createButtonStyle({flexShrink:1,flexGrow:0,flexBasis:110,marginRight:5})})});class A extends w.default{constructor(){super(...arguments),this._mountedRefsMap=new m.default,this._buttonFocusCallbacks={},this._getTabByType=e=>{switch(e){case g.MediaBarItemKeys.Moji:return y.TabType.Moji;case g.MediaBarItemKeys.Sticker:return y.TabType.ChatSticker;case g.MediaBarItemKeys.Gif:return y.TabType.Gif;case g.MediaBarItemKeys.MeetNowIconPicker:return y.TabType.MeetNow;case g.MediaBarItemKeys.ImagePicker:return y.TabType.ImageUploader;case g.MediaBarItemKeys.Emoticon:default:return y.TabType.Emoticon}},this._onSwitchPesTabTypeEmoticon=()=>{this.props.onSwitchPesTabType(y.TabType.Emoticon),this._closeOtherPreviews(y.TabType.Emoticon)},this._onSwitchPesTabTypeMoji=()=>{this.props.onSwitchPesTabType(y.TabType.Moji),this._closeOtherPreviews(y.TabType.Moji)},this._onSwitchPesTabTypeChatSticker=()=>{this.props.onSwitchPesTabType(y.TabType.ChatSticker),this._closeOtherPreviews(y.TabType.ChatSticker)},this._onSwitchPesTabTypeGif=()=>{this.props.onSwitchPesTabType(y.TabType.Gif),this._closeOtherPreviews(y.TabType.Gif)},this._onSwitchTypeMeetNowIcon=()=>{this.props.onSwitchPesTabType(y.TabType.MeetNow),this._closeOtherPreviews(y.TabType.MeetNow)},this._onSwitchPesTabTypeImageUploader=()=>{this.props.onSwitchPesTabType(y.TabType.ImageUploader),this._closeOtherPreviews(y.TabType.ImageUploader)},this._closeOtherPreviews=e=>{e!==y.TabType.Gif&&f.GifPreviewService.closePesPreview(),e!==y.TabType.Moji&&f.MojiPreviewService.closePesPreview()},this._onKeyPress=e=>{let t=0;if(e.keyCode===h.default.RIGHT?t=1:e.keyCode===h.default.LEFT&&(t=-1),0!==t){const s=this.state.switcherCategories.length;this._focusButton((this.state.focusedButtonIndex+t+s)%s),e.preventDefault(),e.stopPropagation()}},this._onContainerBlur=()=>{this.setState({focusedButtonIndex:-1})}}_buildState(e,t){const{pesPickerCategoryOrder:s,enablePesGifs:i}=l.default.getS4LMessagingFeatures(),o=e.categoryOrder?e.categoryOrder:s,r=this._getRootViewId(),a={switcherCategories:this._getSwitcherCategories(o,i),safeAreaHorizontalPaddingStyle:C.default.horizontalPaddingStyle(c.HorizontalInsetDefault),isTablet:I.default.isTablet(),isLandscape:v.default.getDeviceOrientation(r)===n.DeviceOrientation.Landscape};return t&&(a.focusedButtonIndex=-1),a}_getSwitcherCategories(e,t){return(t?e:e.filter((e=>e!==g.MediaBarItemKeys.Gif))).map((e=>this._getTabByType(e)))}requestFocus(){const e=this._mountedRefsMap.ref(this.props.currentTabType.toString());e&&e.requestFocus()}render(){if(this.state.isLandscape&&!this.props.showInLandscape)return null;const e=this.state.switcherCategories.length,t=o.map(this.state.switcherCategories,((t,s)=>this._renderCategoryButton(t,0===s,s===this.state.switcherCategories.length-1,s,e))),s=this._getCategorySwitcherStyles();return(0,i.jsx)(r.View,Object.assign({style:s,onBlur:this._onContainerBlur,onKeyPress:this._onKeyPress,accessibilityTraits:[r.Types.AccessibilityTrait.TabList]},{children:t}),"categorytoggle")}_getCategorySwitcherStyles(){const e=[k.desktop.categoryButtonContainer];return this.state.isTablet&&e.push(k.categoryButtonContainerTopMargin),this.state.safeAreaHorizontalPaddingStyle&&e.push(this.state.safeAreaHorizontalPaddingStyle),e}_renderCategoryButton(e,t,s,n,r){const l={paddingLeft:5,paddingRight:5,height:S.PesCategorySwitcherHeight,borderRadius:17},h=e===this.props.currentTabType,u=this.state.focusedButtonIndex===n||-1===this.state.focusedButtonIndex&&h,g=[k.desktop.categoryButton],m=[k.categoryButtonText];let f;h||g.push(k.categoryButtonNotSelected),s&&g.push(k.categoryButtonLast),l.marginBottom=S.PesCategoryButtonSpacer,l.marginRight=S.PesCategoryButtonSpacer;let v=o.noop,C=T.SkypeIcon.EmoticonStroke;switch(e){case y.TabType.Emoticon:f=p.getString("PesPicker.EmoticonTitle"),v=this._onSwitchPesTabTypeEmoticon,C=T.SkypeIcon.EmoticonStroke;break;case y.TabType.Moji:f=p.getString("PesPicker.MojiTitle"),v=this._onSwitchPesTabTypeMoji,C=T.SkypeIcon.Moji;break;case y.TabType.ChatSticker:f=p.getString("PesPicker.StickerTitle"),v=this._onSwitchPesTabTypeChatSticker,C=T.SkypeIcon.Sticker;break;case y.TabType.Gif:f=p.getString("PesPicker.GifTitle"),v=this._onSwitchPesTabTypeGif,C=T.SkypeIcon.Gif;break;case y.TabType.MeetNow:f=p.getString("PesPicker.MeetNowTitle"),v=this._onSwitchTypeMeetNowIcon,C=T.SkypeIcon.MeetNow;break;case y.TabType.ImageUploader:f=p.getString("PesPicker.ImageUploaderTitle"),v=this._onSwitchPesTabTypeImageUploader,C=T.SkypeIcon.Media;break;default:return P.default.switchStatementExhaustiveChecking(e)}const b=d.default.tabAccessibilityLabel(f,n,r),I=d.default.tabAccessibilityTraits(h),w="button"+e;return this.props.showCategoriesAsIcons?(0,i.jsx)(a.default,{autoFocus:!this.props.preventAutoFocus&&h,ref:this._mountedRefsMap.onComponentRef(e.toString()),onFocus:this._getButtonFocusCallback(n),onPress:v,accessibilityLabel:b,accessibilityTraits:I,title:f,icon:C,iconSize:T.IconSize.size20,size:a.ActionButtonSize.Small,deselected:!h,tabIndex:u?0:-1,backgroundColor:!h&&this.props.disableDarkTheme?M.Color.gray50:void 0,iconColor:!h&&this.props.disableDarkTheme?M.Color.gray400:void 0},w):(0,i.jsx)(_.default,{autoFocus:!this.props.preventAutoFocus&&h,onFocus:this._getButtonFocusCallback(n),ref:this._mountedRefsMap.onComponentRef(e.toString()),onPress:v,accessibilityLabel:b,accessibilityTraits:I,buttonStyle:h?c.SXButtonStyle.GradientFill:c.SXButtonStyle.ThemeStroke,buttonSize:c.SXButtonSize.Medium,textStyleDeprecated:m,title:f||"",style:g,backgroundStyle:l,tabIndex:u?0:-1},w)}_focusButton(e){const t=this.state.switcherCategories[e];if(!o.isUndefined(t)){const e=this._mountedRefsMap.ref(t.toString());e&&e.requestFocus()}}_getButtonFocusCallback(e){return this._buttonFocusCallbacks[e]||(this._buttonFocusCallbacks[e]=t=>{this.setState({focusedButtonIndex:e})}),this._buttonFocusCallbacks[e]}}t.default=A},795549:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesPickerItem=t.PesItemBorder=t.PesItemPadding=t.PesItemBorderWidth=void 0;const i=s(785893),o=s(516778),n=s(915877),r=s(89808),a=s(581760),l=s(24576);t.PesItemBorderWidth=2,t.PesItemPadding=1,t.PesItemBorder=t.PesItemBorderWidth+t.PesItemPadding;const d=(0,n.lazyProperties)({pesItemContainer:()=>o.Styles.createButtonStyle({borderColor:a.Color.transparent,borderRadius:4,borderStyle:"solid",borderWidth:t.PesItemBorderWidth,padding:t.PesItemPadding})});class c extends l.default{constructor(){super(...arguments),this._onButtonRef=e=>{this._buttonRef=e||void 0},this._onPesHoverStart=()=>{this.props.onHover&&this.props.onHover(this.props.info),this.setState({isHovering:!0})},this._onPesHoverEnd=()=>{this.setState({isHovering:!1})},this._onPress=()=>{this._onPressPesItem()},this._onPressIn=()=>{this.props.onPressIn&&this.props.onPressIn(this.props.info)},this._onLongPress=e=>{this.props.onItemLongPress&&this.props.onItemLongPress(e,this.props.info,(()=>this.isComponentMounted()?this:void 0))},this._onItemContextMenu=e=>{this.props.onItemContextMenu&&(e.preventDefault(),this.props.onItemContextMenu(e,this.props.info,(()=>this.isComponentMounted()?this:void 0)))}}_getImportantForAccessibility(){return o.Types.ImportantForAccessibility.No}_getAccessibilityLabel(e){}_getCustomParentStyle(){}render(){const e=this._renderItem(this.props.info),t=[d.pesItemContainer];if(this.state.isHovering){const e=this._useAccessibleTheme()?this._themeColors.dividerColor:r.default.getPrimaryColorNoSubscription();t.push(o.Styles.createViewStyle({borderColor:e},!1))}return(0,i.jsx)(o.Button,Object.assign({autoFocus:this.props.autoFocus,tabIndex:this.props.tabIndex,ref:this._onButtonRef,style:[t,this._getCustomParentStyle()],onHoverStart:this._onPesHoverStart,onHoverEnd:this._onPesHoverEnd,onPressIn:this._onPressIn,onPressOut:this.props.onPressOut,onPress:this._onPress,onContextMenu:this.props.onItemContextMenu?this._onItemContextMenu:void 0,onLongPress:this.props.onItemLongPress?this._onLongPress:void 0,importantForAccessibility:this._getImportantForAccessibility(),accessibilityLabel:this._getAccessibilityLabel(this.props.info),onFocus:this.props.onFocus},{children:e}),this.props.id)}requestFocus(){this._buttonRef&&this._buttonRef.requestFocus()}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this.props.onItemWillMount&&this.props.onItemWillMount()}componentDidMount(){super.componentDidMount(),this.props.onItemDidMount&&this.props.onItemDidMount()}}t.PesPickerItem=c},879348:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesPickerPopup=void 0;const i=s(785893),o=s(496486),n=s(588785),r=s(516778),a=s(639024),l=s(82433),d=s(746096),c=s(436237),h=s(172490),u=s(547126),p=s(915877),g=s(733754),m=s(706250),S=s(526424),f=s(795549),y=s(260681),v=s(63584),C=s(758962),_=s(886045),b=s(293194),T=s(581760),M=s(24576);var I;!function(e){e[e.Diversity=0]="Diversity",e[e.EmoticonGroup=1]="EmoticonGroup"}(I||(I={}));const w=7,P=3,k=3,A=8,x=8,R=6,O=(0,p.lazyProperties)({container:()=>r.Styles.createViewStyle({position:"absolute",overflow:"visible",flexDirection:"column",alignItems:"stretch",paddingBottom:x,paddingLeft:P,paddingRight:P,backgroundColor:"transparent"}),bubble:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,overflow:"visible",borderRadius:R}),shadow:()=>r.Styles.createViewStyle({shadowColor:T.Color.gray200,shadowOpacity:.9,shadowRadius:20,shadowOffset:{width:0,height:6}}),svg:()=>r.Styles.createViewStyle({position:"absolute"}),itemContainer:()=>r.Styles.createViewStyle({flexDirection:"row",alignContent:"stretch",justifyContent:"center",flexGrow:1,marginBottom:x}),item:()=>r.Styles.createViewStyle({flexGrow:1,justifyContent:"center",alignItems:"center"})});class L extends M.default{constructor(){super(...arguments),this._itemRefs=new m.default,this._focusedItemIndex=0,this._preventHide=!1,this.show=e=>{if(!this.isComponentMounted())return;r.Input.keyDownEvent.subscribe(this._onKeyDown),h.default.addEscapeHandler(this.hide),this._focusedItemIndex=0;const t=L._getPopupType(e.item);o.isUndefined(t)||(L._announcePickerOpening(e.item,t),v.PesPickerPopupTelemetry.open(e.triggeredBy),this.setState({isVisible:!0,displayData:e,popupType:t}))},this.hide=()=>!(!this.state.isVisible||!this.isComponentMounted())&&(this._preventHide?(this._preventHide=!1,!0):(r.Input.keyDownEvent.unsubscribe(this._onKeyDown),h.default.removeEscapeHandler(this.hide),v.PesPickerPopupTelemetry.closed(),this.setState({isVisible:!1}),v.PesPickerPopupTelemetry.pickerWillUnmount(),this.state.displayData&&this.state.displayData.onHide&&this.state.displayData.onHide(this.state.displayData.item.id),!0)),this.preventHide=()=>{this._preventHide=!0},this.item=()=>{if(this.state.displayData)return this.state.displayData.item},this.isVisible=()=>this.state.isVisible,this._setPopupPosition=e=>{const t={top:this._getPopupY(e.y)};this._getContext().isRTL?t.right=this._getPopupX(e.x,e.leftBoundary,e.rightBoundary):t.left=this._getPopupX(e.x,e.leftBoundary,e.rightBoundary),this._containerPositionStyle=r.Styles.createViewStyle(t,!1),this._svgPath=this._buildBubblePath()},this._setPopupSize=e=>{const t=(0,C.getFrameHeight)(e);this._itemWidth=t+2*k+2*f.PesItemBorder;const s=this._useAccessibleTheme()?2:0;this._pickerWidth=2*P+this._items.length*this._itemWidth+s,this._pickerHeight=2*w+this._itemWidth,this._containerSizeStyle=r.Styles.createViewStyle({width:this._pickerWidth,height:this._pickerHeight+x},!1),this._bubbleSizeStyle=r.Styles.createViewStyle({width:this._pickerWidth+s-1,height:this._pickerHeight-x-1},!1)},this._onItemSelected=e=>{v.PesPickerPopupTelemetry.itemAdded(e),this.state.displayData&&this.state.displayData.onItemSelected(e)},this._onMenuItemSelected=(e,t)=>{if(e===b.SXActionMenuCancel)return;const s=parseInt(e,10),i=this._items[s];i&&(v.PesPickerPopupTelemetry.itemAdded(i),t(i))},this._onKeyDown=e=>{if(!this.isVisible()||!this.isComponentMounted())return!1;switch(e.keyCode){case u.default.TAB:return e.shiftKey?this._focusPrevItem():this._focusNextItem(),!0;case u.default.LEFT:case u.default.UP:return this._focusPrevItem(),!0;case u.default.RIGHT:case u.default.DOWN:return this._focusNextItem(),!0}return!1},this._getFocusedItem=()=>this._itemRefs.ref(this._focusedItemIndex.toString()),this._focusPrevItem=()=>{this._focusedItemIndex=(this._focusedItemIndex+this._items.length-1)%this._items.length;const e=this._getFocusedItem();e&&(this.preventHide(),e.requestFocus())},this._focusNextItem=()=>{this._focusedItemIndex=(this._focusedItemIndex+1)%this._items.length;const e=this._getFocusedItem();e&&(this.preventHide(),e.requestFocus())},this._onEmoticonItemWillMount=()=>{v.PesPickerPopupTelemetry.willMountItem()},this._onEmoticonItemDidMount=()=>{v.PesPickerPopupTelemetry.mountedItem()},this._renderPopupItems=()=>{if(!this.state.displayData)return;const e=this.state.displayData.onItemHover,t=this.state.displayData.itemSize,s=[];return o.each(this._items,((o,n)=>{const a=this.preventHide;s.push((0,i.jsx)(r.View,Object.assign({style:O.item},{children:(0,i.jsx)(y.PesPickerPopupEmoticonItem,{id:o.id,info:o,ref:this._itemRefs.onComponentRef(n.toString()),autoFocus:0===n,tabIndex:0,size:t,margin:k,renderMobileInterface:this.props.renderMobileInterface,emoticonGroupsEnabled:!0,isSelected:!1,onPressIn:a,onSelected:this._onItemSelected,onHover:e,onItemDidMount:this._onEmoticonItemDidMount,onItemWillMount:this._onEmoticonItemWillMount})}),o.id+"_"+n))})),(0,i.jsx)(r.View,Object.assign({style:O.itemContainer,restrictFocusWithin:!1,onBlur:this.hide},{children:s}))},this._buildBubblePath=()=>{const e=this._useAccessibleTheme()?1:0,t=e,s=e,i=this._pickerWidth-1,o=this._pickerHeight-x-1;return this._genLineSegment(t,R,"M")+this._genLineSegment(t,s,"C")+this._genLineSegment(R,s)+this._genLineSegment(R,s)+this._genLineSegment(i-R,s,"L")+this._genLineSegment(i,s,"C")+this._genLineSegment(i,R)+this._genLineSegment(i,R)+this._genLineSegment(i,o-R,"L")+this._genLineSegment(i,o,"C")+this._genLineSegment(i-R,o)+this._genLineSegment(i-R,o)+this._genLineSegment(this._beakPositionX+A,o,"L")+this._genLineSegment(this._beakPositionX,o+x,"L")+this._genLineSegment(this._beakPositionX-A,o,"L")+this._genLineSegment(R,o,"L")+this._genLineSegment(t,o,"C")+this._genLineSegment(t,o-R)+this._genLineSegment(t,o-R)+"Z"},this._genLineSegment=(e,t,s="")=>(this._useAccessibleTheme()||(e+=.5,t+=.5),s+e+","+t+" "),this._getPopupX=(e,t,s)=>{const i=this._pickerWidth/2;let o=e-i,n=o;const r=R+A+k;if(this._pickerWidth+this._itemWidth>s-t)return o=(s+t)/2-i,this._beakPositionX=i+n-o,this._beakPositionX=Math.min(this._beakPositionX,this._pickerWidth-r),this._beakPositionX=Math.max(this._beakPositionX,r),o;if(s+=P+k,o<(t-=P-k)){for(this._items.length%2==0&&(o+=this._itemWidth/2);o<t;)o+=this._itemWidth;n-=1,t=e-r,o=Math.min(o,t)}if(o+this._pickerWidth>s){for(this._items.length%2==0&&(o-=this._itemWidth/2);o+this._pickerWidth>s;)o-=this._itemWidth;s=e+r-this._pickerWidth,o=Math.max(o,s)}return this._beakPositionX=i+(n-o),o},this._getPopupY=e=>{let t=e-this._pickerHeight-1;return t=Math.max(t,0),t}}_buildState(e,t){const s={};return t&&(s.isVisible=!1),s}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),!t.displayData||!t.isVisible)return;const i=t.displayData.item;if(this.state.displayData&&this.state.displayData.item===t.displayData.item)this.state.displayData&&this.state.displayData.itemSize===t.displayData.itemSize||this._setPopupSize(t.displayData.itemSize);else{if(this._items=L._getPopupItems(t.displayData.item),this._items.length<2)return void c.warn(d.LogTraceArea.Pes,"PES picker pop-up cannot be shown (<2 options) for emoticon "+i.id);this._setPopupSize(t.displayData.itemSize)}this._setPopupPosition(t.displayData)}render(){return this.state.displayData&&this.state.isVisible?(0,i.jsxs)(r.View,Object.assign({style:[O.container,this._containerSizeStyle,this._containerPositionStyle]},{children:[this._renderBubble(),this._renderPopupItems()]})):null}showActionMenu(e,t,s){if(!t.description)return;const i=L._getPopupType(t);if(o.isUndefined(i))return;L._announcePickerOpening(t,i),this._items=L._getPopupItems(t);const n=[];o.each(this._items,((e,t)=>{n.push({text:a.getEmoticonAccessibilityLabel(e.description||e.id,e.tone),command:t.toString()})})),b.default.showWithActionMenuConfig({options:{anchor:()=>{},buttons:n},callback:e=>this._onMenuItemSelected(e,s),rootViewId:this._getRootViewId(),invokingEvent:e})}_svgPopupProps(){const e=this._useAccessibleTheme();return this._useDarkTheme()||e||!this._shadowsSupported()?{fillColor:this._themeColors.popoverBackgroundColor,fillOpacity:1,strokeColor:this._themeColors.dividerColor,strokeWidth:e?2:1,strokeOpacity:1,d:this._svgPath}:{fillColor:this._themeColors.popoverBackgroundColor,fillOpacity:1,d:this._svgPath}}_renderBubble(){const e=[O.bubble,this._bubbleSizeStyle],t=this._useAccessibleTheme();return this._useDarkTheme()||t||!this._shadowsSupported()||e.push(O.shadow),(0,i.jsx)(r.View,Object.assign({style:e},{children:(0,i.jsx)(n.ImageSvg,Object.assign({style:O.svg,width:this._pickerWidth,height:this._pickerHeight},{children:(0,i.jsx)(n.SvgPath,Object.assign({},this._svgPopupProps()))}))}),"bubble")}_shadowsSupported(){return!0}static _announcePickerOpening(e,t){let s;s=t===I.Diversity?g.getString("PesPicker.DiversityPickerAnnouncement"):g.getString("PesPicker.EmoticonGroupPickerAnnouncement",{emoticonName:e.description||e.id}),_.default.maybeAnnounceForAccessibility(s)}static _getPopupType(e){return e.group&&e.group.length>0?I.EmoticonGroup:e.diverse?I.Diversity:void c.warn(d.LogTraceArea.Pes,"PES picker pop-up cannot be shown for emoticon "+e.id)}}L._getPopupItems=e=>{let t;return L._getPopupType(e)===I.EmoticonGroup?(t=[],o.each(e.group,(s=>{const i=l.default.getEmoticonByName(s);i&&t.push(Object.assign(Object.assign({},i),{group:e.group}))})),t.length>6&&(c.warn(d.LogTraceArea.Pes,"More than 6 groupped emoticons found for emoticon "+e.id),t=o.take(t,6))):t=o.map(S.DiverseToneSuffixes,(t=>Object.assign(Object.assign({},e),{tone:t===S.DefaultDiverseTone?void 0:t}))),t},t.PesPickerPopup=L},260681:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesPickerPopupEmoticonItem=void 0;const i=s(958460),o=s(639024);class n extends i.EmoticonItem{_getAccessibilityLabel(e){return o.getEmoticonInfoAccessibilityLabel(e)}_getPopupIndicator(e){}}t.PesPickerPopupEmoticonItem=n},63584:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesPickerImageUploaderTelemetry=t.PesPickerMeetNowTelemetry=t.PesPickerPopupTelemetry=t.GifPickerTelemetry=t.StickerPickerTelemetry=t.MojiPickerTelemetry=t.EmoticonPickerTelemetry=void 0;const i=s(436237),o=s(758962),n=s(90025),r=s(415963),a=s(794050),l=s(853374);class d{constructor(e){this._pickerType=e,this._numberOfItems=0,this._shouldMeasureOpeningTime=!0,this._firstRender=!0}open(e){if(!this._scenario&&(this._usageEvent=new n.PesPickerUsageEvent(this._pickerType,this._firstRender,e),this._shouldMeasureOpeningTime)){const e=this._getScenarioNameForPickerType(this._pickerType);this._scenario=new a.default(e),this._scenario.start(void 0,this._endOpeningTime),this._shouldMeasureOpeningTime=!1}}_getScenarioNameForPickerType(e){switch(e){case o.TabType.Emoticon:return r.ScenarioName.OpenEmoticonPicker;case o.TabType.Moji:return r.ScenarioName.OpenMojiPicker;case o.TabType.ChatSticker:return r.ScenarioName.OpenChatStickerPicker;case o.TabType.Gif:return r.ScenarioName.OpenGifPicker;case o.TabType.PickerPopup:return r.ScenarioName.OpenDiversityPicker;case o.TabType.MeetNow:return r.ScenarioName.OpenMeetNowPicker;case o.TabType.ImageUploader:return r.ScenarioName.OpenImageUploader;default:return l.default.switchStatementExhaustiveChecking(e)}}willMountItem(){this._scenario&&this._numberOfItems++}mountedItem(){this._scenario&&(this._numberOfItems--,this._numberOfItems<=0&&this._usageEvent&&(this._scenario.markStepCompleted("finished_opening",void 0,void 0,!0),this._scenario.finish(),this._usageEvent.openingCompleted(Date.now()),this._scenario=void 0,this._endOpeningTime=void 0,this._numberOfItems=0))}itemAdded(e){var t,s;null===(s=null===(t=this._usageEvent)||void 0===t?void 0:t.itemAdded)||void 0===s||s.call(t,e)}pickerWillUnmount(){this._shouldMeasureOpeningTime=!0}closed(){this._scenario&&(this._scenario.finish(),this._scenario=void 0),this._usageEvent&&(i.track(this._usageEvent),this._firstRender=!1,this._usageEvent=void 0)}}const c="finished_first_item_load",h="finished_keyboard_seen";t.EmoticonPickerTelemetry=new class extends d{startOpenScenario(){this._shouldMeasureOpeningTime&&(this._markedFirstItemReady=!1,this._markedKeyboardSeen=!1,this._openScenario=new a.default(r.ScenarioName.EmoticonPesPickerOpen),this._openScenario.start())}markFirstVisibleItemReady(){var e;this._markedFirstItemReady||(null===(e=this._openScenario)||void 0===e||e.markStepCompleted(c),this._markedFirstItemReady=!0)}markKeyboardSeen(){var e;this._markedKeyboardSeen||(null===(e=this._openScenario)||void 0===e||e.markStepCompleted(h),this._markedKeyboardSeen=!0)}finishOpenScenario(e){if(!this._openScenario)return;const t=null==e?void 0:{totalCount:e};this._openScenario.finish(t),this._openScenario=void 0,this._markedFirstItemReady=!1,this._markedKeyboardSeen=!1}}(o.TabType.Emoticon),t.MojiPickerTelemetry=new d(o.TabType.Moji),t.StickerPickerTelemetry=new d(o.TabType.ChatSticker),t.GifPickerTelemetry=new d(o.TabType.Gif),t.PesPickerPopupTelemetry=new d(o.TabType.PickerPopup),t.PesPickerMeetNowTelemetry=new d(o.TabType.MeetNow),t.PesPickerImageUploaderTelemetry=new d(o.TabType.ImageUploader)},32687:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(820770),a=s(587134),l=s(632949),d=s(915877),c=s(854757),h=s(742545),u=s(681115),p=s(857946),g=s(680837),m=(0,d.lazyProperties)({messageComposerOuterContainerVertical:()=>n.Styles.createViewStyle({flex:-1,flexDirection:"row",justifyContent:"center"})});class S extends h.PesSearchPanel{constructor(){super(...arguments),this._noOfPesItemsSelected=0,this._onMessageSent=e=>{const t=!!this.props.onMessageSent&&this.props.onMessageSent(e);return this._closeSearchPanel(!0),this._pesSearchTelemetry.sendSuccessTelemetryEvent(void 0,this.state.rawSearchQuery.length,!0,this._noOfPesItemsSelected),t},this._handleScroll=(e,t)=>{this._messageComposer&&this._messageComposer.isFocused()&&this._messageComposer.blur(),this._onScroll(e,t)},this._onEmoticonPesSelected=(e,t,s)=>{this._messageComposer&&this._messageComposer.autoReplaceText(e.text(),"Emoticon",e),this._noOfPesItemsSelected++,this._pesSearchTelemetry.sendSuccessTelemetryEvent(s,this.state.rawSearchQuery.length)},this._onMessageComposerRef=e=>{this._messageComposer=e||void 0},this._onEmoticonPickerRef=e=>{this._emoticonPicker=e||void 0},this._onClearQuotedMessage=()=>{this.isComponentMounted()&&this.setState({quotedMessages:void 0})},this._onClearEditedMessage=()=>{this.isComponentMounted()&&this.setState({editedMessage:void 0}),this.props.clearEditInChatsComposer&&this.props.clearEditInChatsComposer()}}_buildState(e,t){const s=super._buildState(e,t),i=r.default.getSavedMessageInput(e.conversationId);return i&&(s.type=i.type,s.inputEntities=i.inputEntities,o.isEmpty(i.messages)||(s.quotedMessages=i.type===p.SavedMessageType.Quoted?i.messages:void 0,s.editedMessage=i.type===p.SavedMessageType.Edited?o.first(i.messages):void 0)),s}_renderPesResultsPane(){const e=(0,i.jsx)(l.default,{ref:this._onEmoticonPickerRef,renderMobileInterface:!0,darkTheme:this._useDarkTheme(),availableWidth:this.state.availableWidth,onPesSelected:this._onEmoticonPesSelected,filter:this.state.rawSearchQuery,doNotRenderTabIndicator:!0,searchMode:!0,onScroll:this._handleScroll,dontSetFocusOnTabHeader:!0,initialPaddingForSearchResults:this.state.keepSearchBoxCollapsed?void 0:this._initialPaddingForSearchResults,onSearchNoResultsFound:this._onNoResultsError}),t=[m.messageComposerOuterContainerVertical];this.state.safeAreaHorizontalPaddingStyle&&t.push(this.state.safeAreaHorizontalPaddingStyle),this.state.bottomSafeAreaInset&&!this.state.isKeyboardSeen&&t.push(u.default.marginBottomStyle(this.state.bottomSafeAreaInset));const s=(0,i.jsx)(n.View,Object.assign({style:t},{children:(0,i.jsx)(c.default,{ref:this._onMessageComposerRef,conversationId:this.props.conversationId,otherPartyMri:void 0,disableCopyPasteMedia:!0,hideMediaBar:!0,hideAudioMessage:!0,shouldAutoFocus:!1,onMessageSent:this._onMessageSent,initialInputEntities:this.state.inputEntities,quotedMessages:this.state.quotedMessages,onClearQuotedMessage:this._onClearQuotedMessage,editedMessage:this.state.editedMessage,onClearEdit:this._onClearEditedMessage})})),o=this._divider();return(0,i.jsxs)(n.View,Object.assign({style:g.default.flexOne},{children:[e,o,s]}))}_getNumberOfItemsRendered(){return this._emoticonPicker?this._emoticonPicker.getNumberOfPesItemsRendered():-1}_getAccessibilityKeyForSearchResults(){return"PesSearch.SearchResultsAnnouncementEmoticons"}_divider(){return(0,i.jsx)(a.default,{marginLeft:0,marginRight:0,useLightTheme:!0})}}t.default=S},476359:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(351077),n=s(746096),r=s(901117),a=s(742545),l=(s(758962),s(785207));class d extends a.PesSearchPanel{constructor(){super(...arguments),this._onMojiPickerRef=e=>{this._mojiPicker=e||void 0},this._onMojiPreviewSeen=()=>{this._blurSearchInput()},this._sendMoji=(e,t,s)=>{this._closeSearchPanel(),l.default.postMessageFromInput(this.props.conversationId,n.PostSource.MojiSearch,[e],o.MessageTypes.Media_FlikMsg),this._pesSearchTelemetry.sendSuccessTelemetryEvent(s,this.state.rawSearchQuery.length,!0)}}_renderPesResultsPane(){return(0,i.jsx)(r.default,{ref:this._onMojiPickerRef,renderMobileInterface:!0,darkTheme:this._useDarkTheme(),onPesSelected:this._sendMoji,availableWidth:this.state.availableWidth,filter:this.state.rawSearchQuery,doNotRenderTabIndicator:this.state.rawSearchQuery.length>0,showMojiPreviewAsFullScreenModal:!0,onMojiPreviewSeen:this._onMojiPreviewSeen,searchMode:!0,onScroll:this._onScroll,initialPaddingForSearchResults:this.state.keepSearchBoxCollapsed?void 0:this._initialPaddingForSearchResults,dontSetFocusOnTabHeader:!0,onSearchNoResultsFound:this._onNoResultsError})}_getNumberOfItemsRendered(){return this._mojiPicker?this._mojiPicker.getNumberOfPesItemsRendered():-1}_getAccessibilityKeyForSearchResults(){return"PesSearch.SearchResultsAnnouncementMojis"}}t.default=d},742545:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesSearchPanel=void 0;const i=s(785893),o=(s(496486),s(583367)),n=s(516778),r=s(996074),a=s(752754),l=s(780128),d=s(898278),c=s(341444),h=s(746096),u=s(436237),p=s(710400),g=s(915877),m=s(733754),S=s(330124),f=s(141067),y=s(29130),v=s(451070),C=s(536150),_=s(886045),b=(s(640363),s(711828)),T=s(734528),M=s(680837),I=s(853374),w=(0,g.lazyProperties)({panel:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),searchHeaderWrapper:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0})});class P extends r.default{constructor(){super(...arguments),this._currentScrollTop=0,this._headerExpanded=!0,this._onScroll=(e,t,s)=>{if(s||this._blurSearchInput(),this.state.keepSearchBoxCollapsed)return;let i=this._headerExpanded;if(e<l.default.collapsableHeight(this._getRootViewId()))i=!0;else{const t=this._currentScrollTop-e;i=i&&t>0}this._expandOrCollapseHeader(i,!0),this._currentScrollTop=e},this._onNoResultsError=()=>{this._pesSearchTelemetry.trackNoResultsInSearch()},this._cancelSearch=e=>{e&&e.stopPropagation(),this._closeSearchPanel(!1),this._pesSearchTelemetry.cancelSessionTelemetryEvent(this.state.rawSearchQuery.length)},this._onInputTextChange=e=>{if(!this.isComponentMounted())return;const t={};t.rawSearchQuery=e,this.setState(t)},this._onSearchHeaderRef=e=>{this._searchHeader=e||void 0},this._onDesktopSearchHeaderRef=e=>{this._desktopSearchHeader=e||void 0}}_buildState(e,t){const s={},i=this._getRootViewId();return s.availableWidth=y.default.getWidth(i),s.isSmallDevice=y.default.isSmallDevice(i),s.isUsingStackNavigationContext=S.default.isUsingStackNavigationContext(),s.statusBarPadding=v.default.statusBarPadding(),s.bottomSafeAreaInset=v.default.bottomSafeAreaInset(d.BottomInsetDefault),s.safeAreaHorizontalPaddingStyle=v.default.horizontalPaddingStyle(d.HorizontalInsetDefault),s.isKeyboardSeen=p.default.isKeyboardSeen(),s.keepSearchBoxCollapsed=y.default.getDeviceOrientation(i)===o.DeviceOrientation.Landscape||C.default.isMobileScreenReaderEnabled()&&!1||!s.isUsingStackNavigationContext,t&&(s.rawSearchQuery="",this._pesSearchTelemetry=new f.default(!0,e.searchType)),s}componentDidMount(){super.componentDidMount()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._updateAccessibilityNotification(),this.state.keepSearchBoxCollapsed!==t.keepSearchBoxCollapsed&&(this.state.keepSearchBoxCollapsed?this._expandOrCollapseHeader(!1,!1):this._onScroll(this._currentScrollTop,0,!0))}render(){const e=this._renderSearchHeader(),t=[M.default.flexOne];this._initialPaddingForSearchResults=l.default.collapsableHeight(this._getRootViewId());const s=this._renderPesResultsPane();let o;return this.state.keepSearchBoxCollapsed?(this._initialPaddingForSearchResults=void 0,o=(0,i.jsxs)(n.View,Object.assign({style:w.panel},{children:[e,s]}))):(t.push(n.Styles.createViewStyle({marginTop:l.default.collapsedHeight(this._getRootViewId())+this.state.statusBarPadding},!1)),o=(0,i.jsxs)(n.View,Object.assign({style:[w.panel,this._themeStyles.primaryBackgroundColorStyle]},{children:[(0,i.jsx)(n.View,Object.assign({style:t},{children:s})),(0,i.jsx)(n.View,Object.assign({style:w.searchHeaderWrapper,ignorePointerEvents:!0},{children:e}))]}))),o}_closeSearchPanel(e){const t=I.default.newCauseId();u.log(h.LogTraceArea.Navigation,"PESSearchPanel._closeSearchPanel,  causeId: "+t),this.props.onCloseSearch&&this.props.onCloseSearch(e),p.default.immediatelyResetUpdateInfo(),this._goBack(t)}_focusSearchInput(){this._searchHeader?this._searchHeader.focusInput():this._desktopSearchHeader&&this._desktopSearchHeader.focusInput()}_blurSearchInput(){this._searchHeader?this._searchHeader.blurInput():this._desktopSearchHeader&&this._desktopSearchHeader.blurInput()}_renderSearchHeader(){return this.state.isUsingStackNavigationContext?(0,i.jsx)(a.default,{ref:this._onSearchHeaderRef,initialValue:this.state.keepSearchBoxCollapsed?0:1,closeIcon:T.closeIcon(),rawSearchQuery:this.state.rawSearchQuery,autoFocus:!0,cancelSearch:this._cancelSearch,onInputTextChange:this._onInputTextChange}):(0,i.jsx)(c.default,{ref:this._onDesktopSearchHeaderRef,rawSearchQuery:this.state.rawSearchQuery,onInputTextChange:this._onInputTextChange,hideCloseButton:!1,searchHeaderStyles:M.default.flexNegativeOne,showSearchIcon:!0,autoFocus:!0,cancelSearch:this._cancelSearch,closeButtonSize:b.IconSize.size20})}_expandOrCollapseHeader(e,t=!0){this._headerExpanded!==e&&(this._searchHeader&&this._searchHeader.setExpandedValue(e?1:0,t),this._headerExpanded=e)}_updateAccessibilityNotification(){if(_.default.shouldAnnounceForAccessibility()&&""!==this.state.rawSearchQuery){const e=this._getNumberOfItemsRendered();let t;e>=0&&e!==this._previousResultCount&&(t=m.getString(this._getAccessibilityKeyForSearchResults(),{count:e})),t&&n.Accessibility.announceForAccessibility(t),this._previousResultCount=e}}}t.PesSearchPanel=P},141067:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(436237),o=s(90025);t.default=class{constructor(e,t){this._navigatedFromMediaBar=e,this._searchType=t,this._startNewTelemetrySession()}_startNewTelemetrySession(){this._pesSearchTelemetryEvent=new o.PesSearchSession,this._pesSearchTelemetryEvent.setSearchType(this._searchType),this._pesSearchTelemetryEvent.setNavigatedFromMediaBar(this._navigatedFromMediaBar)}sendSuccessTelemetryEvent(e,t,s,o){this._pesSearchTelemetryEvent.complete(!0,t,e,s,o),i.track(this._pesSearchTelemetryEvent),s||this._startNewTelemetrySession()}trackNoResultsInSearch(){this._pesSearchTelemetryEvent.incrementAttemptsMade()}cancelSessionTelemetryEvent(e,t=!1){this._pesSearchTelemetryEvent.complete(!1,e,void 0,void 0,void 0,t),i.track(this._pesSearchTelemetryEvent)}}},336061:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(351077),n=s(746096),r=s(742545),a=(s(758962),s(785207)),l=s(63110);class d extends r.PesSearchPanel{constructor(){super(...arguments),this._onStickerPickerRef=e=>{this._stickerPicker=e||void 0},this._sendSticker=(e,t,s)=>{this._closeSearchPanel(),a.default.postMessageFromInput(this.props.conversationId,n.PostSource.StickerSearch,[e],o.MessageTypes.RichText),this._pesSearchTelemetry.sendSuccessTelemetryEvent(s,this.state.rawSearchQuery.length,!0)}}_renderPesResultsPane(){return(0,i.jsx)(l.default,{ref:this._onStickerPickerRef,renderMobileInterface:!0,darkTheme:this._useDarkTheme(),onPesSelected:this._sendSticker,availableWidth:this.state.availableWidth,filter:this.state.rawSearchQuery,doNotRenderTabIndicator:this.state.rawSearchQuery.length>0,searchMode:!0,onScroll:this._onScroll,initialPaddingForSearchResults:this.state.keepSearchBoxCollapsed?void 0:this._initialPaddingForSearchResults,dontSetFocusOnTabHeader:!0,onSearchNoResultsFound:this._onNoResultsError})}_getNumberOfItemsRendered(){return this._stickerPicker?this._stickerPicker.getNumberOfPesItemsRendered():-1}_getAccessibilityKeyForSearchResults(){return"PesSearch.SearchResultsAnnouncementStickers"}}t.default=d},75821:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(709133),r=s(516778),a=s(711930),l=(s(484994),s(898278),s(746096)),d=s(913944),c=s(436237),h=s(547126),u=s(915877),p=s(733754),g=s(540897),m=s(706250),S=s(104735),f=s(330124),y=s(63584),v=s(960621),C=s(758962),_=s(333242),b=(s(29130),s(581760)),T=s(711828),M=s(680837),I=s(360305),w=s(24576),P=s(912770),k=s(853374),A=T.IconSize.size20,x=(0,u.lazyProperties)({pesTabsContainerBase:()=>r.Styles.createViewStyle({alignSelf:"stretch",alignItems:"center",flexDirection:"row",borderTopWidth:1,borderStyle:"solid",paddingHorizontal:8}),pesTabsContainerBaseTransparent:()=>r.Styles.createViewStyle({alignSelf:"stretch",alignItems:"center",flexDirection:"row",paddingHorizontal:8}),pesTabsContainerTransparent:()=>r.Styles.createViewStyle({justifyContent:"flex-end",backgroundColor:b.Color.blackOverlay70}),swipeableViewRTL:()=>r.Styles.createScrollViewStyle({flexDirection:"row-reverse"}),flippedView:()=>r.Styles.createScrollViewStyle({transform:[{scaleX:-1}]}),iconSpacerTouch:()=>r.Styles.createViewStyle({width:40,height:40}),searchButton:()=>r.Styles.createViewStyle({paddingRight:8,borderRightWidth:1,alignSelf:"stretch"}),deleteButton:()=>r.Styles.createViewStyle({paddingLeft:8,borderLeftWidth:1,alignSelf:"stretch"}),pesTabsContainerDesktop:()=>r.Styles.createViewStyle({flexDirection:"row"}),borderColorLight:()=>r.Styles.createViewStyle({borderColor:b.Color.gray50}),backgroundColorDark:()=>r.Styles.createViewStyle({backgroundColor:b.Color.transparent}),backgroundColorLight:()=>r.Styles.createViewStyle({backgroundColor:b.Color.white})});class R extends w.default{constructor(){super(...arguments),this._isDeleteButtonPressTimedOut=!1,this._mountedRefsMap=new m.default,this._buttonFocusCallbacks={},this._tabSelected=e=>{let t=o.findIndex(this.props.tabs,(t=>t.id===e));this.props.reversed&&!o.isEmpty(this.props.tabs)&&(t=this.props.tabs.length-t-1),this.setState({selectedTabIndex:t}),this.props.onTabSelected(this.props.tabs[t])},this._setScrollViewRef=e=>{this._scrollView=e||void 0},this._onLayout=e=>{const t=e.width+(this._showDeleteButton()?A:0);this.setState({availableWidthForIndicator:t,iconSpacing:this._computeIconSpacing(t)},(()=>this._scrollToTabIcon(this.state.selectedTabIndex,!1)))},this._onScroll=(e,t)=>{this.setState({scrollPosition:t})},this._handleSearchButtonClick=e=>{e.stopPropagation();const t=k.default.newCauseId();if(c.log(l.LogTraceArea.Pes,"PesTabIndicaor._handleSearchButtonClick,  causeId: "+t),!this.props.conversationId)return;const s=this._getSelectedTabType();o.isUndefined(s)||(s===C.TabType.Moji&&(v.MojiPreviewService.closePesPreview(),y.MojiPickerTelemetry.closed()),s===C.TabType.Gif&&(v.GifPreviewService.closePesPreview(),y.GifPickerTelemetry.closed()),(0,g.isSupportedTabType)(s)&&g.default.tryActivateInlineSearch(s)?n.default.showNativeKeyboard():S.default.navigateToPesSearch({searchType:s,conversationId:this.props.conversationId,onMessageSent:this.props.onMessageSent,onCloseSearch:this.props.onCloseSearch,clearEditInChatsComposer:this.props.clearEditInChatsComposer,causeId:t},this._getContext()))},this._deleteButtonPressIn=e=>{e.stopPropagation(),!this._isDeleteButtonPressTimedOut&&this.props.onPesDeleteButtonPress&&this.props.onPesDeleteButtonPress(!1),this._deleteButtonPressedInterval=P.default.setInterval((()=>{!this._isDeleteButtonPressTimedOut&&this.props.onPesDeleteButtonPress&&this.props.onPesDeleteButtonPress(!1)}),100),this._deleteButtonPressedTimeout=P.default.setTimeout((()=>{P.default.clearInterval(this._deleteButtonPressedInterval),this._isDeleteButtonPressTimedOut=!0,this._deleteButtonPressedInterval=P.default.setInterval((()=>{this.props.onPesDeleteButtonPress&&this.props.onPesDeleteButtonPress(!0)}),150)}),1e3)},this._deleteButtonPressOut=e=>{e.stopPropagation(),P.default.clearInterval(this._deleteButtonPressedInterval),P.default.clearTimeout(this._deleteButtonPressedTimeout),this._isDeleteButtonPressTimedOut=!1},this._onKeyPress=e=>{let t=0;if(e.keyCode===h.default.RIGHT?t=1:e.keyCode===h.default.LEFT&&(t=-1),0!==t){const s=this.props.tabs.length;this._focusButton((this.state.focusedButtonIndex+t+s)%s),e.preventDefault(),e.stopPropagation()}},this._onContainerBlur=()=>{this.setState({focusedButtonIndex:-1})}}_buildState(e,t){const s={useTabletUI:I.default.isTabletUI()};this._getRootViewId();if(t){let t=0;e.initialTab&&(t=o.findIndex(e.tabs,(t=>t.id===e.initialTab.id)),t=Math.max(t,0)),s.selectedTabIndex=t,s.isUsingStackNavigationContext=f.default.isUsingStackNavigationContext(),s.focusedButtonIndex=-1,s.scrollPosition=0,s.iconSpacing=6,s.scrollPosition=0}return s}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s)}render(){return this._renderScrollableView()}onPageSelected(e){e.position!==this.state.selectedTabIndex&&(this._scrollToTabIcon(e.position),this.setState({selectedTabIndex:e.position}))}_renderTabIcons(){const e=this.props.reversed,t=this.props.tabs,s=t?t.length:0;return o.map(t,((t,o)=>{const n=e?s-o-1:o,r=this.state.selectedTabIndex===n,l=this.state.focusedButtonIndex===o||-1===this.state.focusedButtonIndex&&r;let d;return t.title&&(d=a.default.tabAccessibilityLabel(t.title,o,s)),(0,i.jsx)(_.default,{ref:this._mountedRefsMap.onComponentRef(o.toString()),onFocus:this._getButtonFocusCallback(o),tabIndex:l?0:-1,thumbnailUrlOrAssetID:t.iconUrlOrAssetID,accessibilityTraits:a.default.tabAccessibilityTraits(r),style:e?x.flippedView:void 0,isSelected:r,buttonSize:20,title:t.title,accessibilityLabel:d,buttonId:t.id,onClick:this._tabSelected,paddingVertical:12,paddingHorizontal:this.state.iconSpacing},"pack-"+t.id)}))}_renderScrollableView(){const e=this._renderDeleteButton(),t=this._renderSearchButton(),s=this._renderScrollableIndicator();if(!e&&!s)return null;const o=this._getScrollableViewContainerStyles();return(0,i.jsxs)(r.View,Object.assign({style:o,onBlur:this._onContainerBlur,onKeyPress:this._onKeyPress},{children:[t,s,e]}))}_getScrollableViewContainerStyles(){let e;return e=this.props.transparentTheme?[x.pesTabsContainerBaseTransparent,x.pesTabsContainerTransparent]:this.props.darkTheme?[x.pesTabsContainerBase,x.backgroundColorDark,this._themeStyles.headerShadowBorderColorStyle]:[x.pesTabsContainerBase,x.backgroundColorLight,x.borderColorLight],this.props.style&&e.push(this.props.style),e}_renderScrollableIndicator(){const e=[M.default.flexOne];e.push(x.pesTabsContainerDesktop),this.props.reversed&&e.push([x.swipeableViewRTL,x.flippedView]);let t=this._renderTabIcons();return t=(0,i.jsx)(r.View,Object.assign({accessibilityTraits:[r.Types.AccessibilityTrait.TabList],style:[x.pesTabsContainerDesktop,M.default.overflowVisible],forceDirection:!0},{children:t})),(0,i.jsx)(r.ScrollView,Object.assign({style:e,onLayout:this._onLayout,ref:this._setScrollViewRef,vertical:!1,horizontal:!0,keyboardDismissMode:"none",keyboardShouldPersistTaps:!0,onScroll:this._onScroll,showsHorizontalScrollIndicator:!0},{children:t}))}_showDeleteButton(){return!1}_renderDeleteButton(){if(!this._showDeleteButton())return;const e=[x.deleteButton,this._themeStyles.dividerBorderColorStyle];return(0,i.jsx)(d.default,{color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,size:A,onPressIn:this._deleteButtonPressIn,onPressOut:this._deleteButtonPressOut,icon:T.SkypeIcon.Backspace,title:p.getString("Global.DeleteLabel"),flipIcon:this.props.reversed&&!0,style:e},"delete-emoticon")}_renderSearchButton(){}_scrollToTabIcon(e,t=!0){0}_computeIconSpacing(e){return 6}_getSelectedTabType(){const e=this.props.tabs[this.state.selectedTabIndex];return e&&e.tabType}_focusButton(e){const t=this._mountedRefsMap.ref(e.toString());t&&t.requestFocus()}_getButtonFocusCallback(e){return this._buttonFocusCallbacks[e]||(this._buttonFocusCallbacks[e]=t=>{this.setState({focusedButtonIndex:e})}),this._buttonFocusCallbacks[e]}}t.default=R},333242:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(217041),a=s(139597),l=s(861253),d=s(733754),c=s(581760);var h;!function(e){e[e.notSelected=0]="notSelected",e[e.hover=1]="hover",e[e.selected=2]="selected"}(h||(h={}));class u extends r.ComponentBase{constructor(){super(...arguments),this._onButtonClick=e=>{e.stopPropagation(),(0,l.default)(this.props.isSelected,void 0)&&this.setState({currentFrame:h.selected}),this.props.onClick&&this.props.onClick(this.props.buttonId)},this._onHoverStart=()=>{this.isComponentMounted()&&(this.state.currentFrame===h.notSelected?this.setState({isHovering:!0,currentFrame:h.hover}):this.setState({isHovering:!0}))},this._onHoverEnd=()=>{this.isComponentMounted()&&(this.state.currentFrame===h.hover?this.setState({isHovering:!1,currentFrame:h.notSelected}):this.setState({isHovering:!1}))},this._onButtonRef=e=>{this._buttonRef=e||void 0}}_buildState(e,t){const s={};return o.isNumber(e.thumbnailUrlOrAssetID)?s.urlOrAssetIDToRender=e.thumbnailUrlOrAssetID:s.urlOrAssetIDToRender=a.default.requestImage(e.thumbnailUrlOrAssetID),s.currentFrame=e.isSelected?h.selected:h.notSelected,t?s.isHovering=!1:this.state.isHovering&&(s.currentFrame=h.hover),s}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),o.isUndefined(e.isSelected)||this.setState({currentFrame:e.isSelected?h.selected:h.notSelected})}requestFocus(){this._buttonRef&&this._buttonRef.requestFocus()}render(){const e=this.state.currentFrame*this.props.buttonSize,t=n.Styles.createButtonStyle({height:this.props.buttonSize+2*(this.props.paddingVertical||0),width:this.props.buttonSize+2*(this.props.paddingHorizontal||0),justifyContent:"center",alignItems:"center"},!1),s=n.Styles.createViewStyle({height:this.props.buttonSize,width:this.props.buttonSize,backgroundColor:c.Color.transparent},!1),o=n.Styles.createImageStyle({height:this.props.buttonSize*u._frameCount,width:this.props.buttonSize,transform:[{translateY:-e}]},!1),r=void 0!==this.state.urlOrAssetIDToRender?(0,i.jsx)(n.Image,{style:o,source:this.state.urlOrAssetIDToRender,resizeMode:"contain"}):null;return(0,i.jsx)(n.Button,Object.assign({onPress:this._onButtonClick,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,style:[t,this.props.style],title:this.props.title,accessibilityLabel:this._getAccessibilityLabel(),accessibilityTraits:this.props.accessibilityTraits,ref:this._onButtonRef,onFocus:this.props.onFocus,tabIndex:this.props.tabIndex},{children:(0,i.jsx)(n.View,Object.assign({style:s},{children:r}))}))}_getAccessibilityLabel(){return this.props.accessibilityLabel?this.props.accessibilityLabel:this.props.title?this.state.currentFrame===h.selected?d.getString("AccessibilityLabel.SelectedTriStateButton",{title:this.props.title}):d.getString("AccessibilityLabel.NotSelectedTriStateButton",{title:this.props.title}):void 0}}u._frameCount=3,t.default=u},2544:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StickerItem=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(889391),a=s(746096),l=s(139889),d=s(110117),c=s(436237),h=s(733754),u=s(795549),p=s(758962),g=s(24139),m=s(581760),S=s(711828),f=s(675865);class y extends u.PesPickerItem{constructor(){super(...arguments),this._isStickerImageLoaded=!1,this._handleStickerImageLoad=()=>{this._isStickerImageLoaded=!0},this._handleStickerImageLoadError=()=>{c.error(a.LogTraceArea.Capture,"There was an error loading the sticker",this.props.id),this._isStickerImageLoaded=!1}}_buildState(e,t){const s=r.default.getConfigSettings().pes.rewriteRules,i=e.info.baseUrl?p.rewriteUrl(e.info.baseUrl,s):void 0,o=i?i+"/views/meta."+h.getLanguageFromLocale():void 0,n=i?`${i}/views/thumblarge?etag=${e.info.etag?e.info.etag:"v1"}`:void 0;return{thumbnailUrl:n?f.default.getAuthenticatedUrl(n):void 0,localizedMetadata:o?g.default.getMetadataForSticker(o,e.info.id):void 0}}_getStyle(e){let t=y._cachedStyles[e];return t||(t={thumbnailContainer:n.Styles.createViewStyle({width:e,height:e,alignItems:"center",justifyContent:"center"},!1),thumbnailImage:n.Styles.createImageStyle({position:"absolute",top:0,left:0,width:e-1,height:e},!1),stickerPlaceholder:n.Styles.createViewStyle({width:e,height:e,backgroundColor:m.Color.transparent,justifyContent:"center",alignItems:"center"},!1)},y._cachedStyles[e]=t),t}_renderItem(e){const t=this._getStyle(this.props.dimension);let s;this.props.showPlaceholder&&(s=(0,i.jsx)(n.View,Object.assign({style:[t.thumbnailContainer,t.stickerPlaceholder]},{children:(0,i.jsx)(d.default,{icon:S.SkypeIcon.Sticker,color:m.Color.transparent,size:S.IconSize.size14})})));const o=(0,i.jsx)(n.View,Object.assign({style:[t.thumbnailContainer,t.stickerPlaceholder]},{children:(0,i.jsx)(d.default,{icon:S.SkypeIcon.StickerDeleted,color:m.Color.transparent,size:S.IconSize.size14})}));return[(0,i.jsx)(l.default,{origin:"StickerThumbnail",title:this.state.localizedMetadata?this.state.localizedMetadata.description:void 0,style:t.thumbnailImage,containerStyle:t.thumbnailContainer,altView:s,errorView:o,resizeMode:"cover",source:this.state.thumbnailUrl,onLoad:this._handleStickerImageLoad,onError:this._handleStickerImageLoadError},"thumbnail")]}_onPressPesItem(){this._isStickerImageLoaded&&this.props.onSelected(this.props.info)}_getAccessibilityLabel(e){let t=this.state.localizedMetadata?this.state.localizedMetadata.name:void 0;return t&&this.props.numberInGroupAccessibilityLabel&&!o.isUndefined(this.props.itemIndex)&&!o.isUndefined(this.props.totalInGroup)&&(t+=", ",t+=h.getString("MediaPickerPanel.SelectedTitle",{count:this.props.itemIndex+1,total:this.props.totalInGroup})),t}_getImportantForAccessibility(){return n.Types.ImportantForAccessibility.Yes}}y._cachedStyles={},t.StickerItem=y},63110:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(746096),r=s(497174),a=s(436237),l=s(733754),d=s(696168),c=s(571502),h=s(63584),u=s(783294),p=s(758962),g=s(431234),m=s(931847),S=s(2544),f=s(713130),y=s(711828);class v extends c.PesPicker{constructor(){super(...arguments),this._renderPesItem=e=>{const t=this.state.items[e];if(!t)return a.warn(n.LogTraceArea.Pes,`Sticker with id ${e} not found`),null;const s=this.state.itemsForTabsMap[this._currentTabIndex],o=s&&s[0]===e,r=this._getItemDimension(),l=!!this.state.previewItem&&this.state.previewItem.id===t.id,d=-1===this.state.focusedButtonIndexInPack&&l;return r?(0,i.jsx)(S.StickerItem,{autoFocus:this._shouldAutoFocusFirstItem()&&o,tabIndex:d?0:-1,ref:this._itemsInCurrentTabRefs.onComponentRef(e),onFocus:this._getButtonFocusCallback(e),id:t.id,info:t,isSelected:l,renderMobileInterface:this.props.renderMobileInterface,onHover:this._onPesHoverBound,onSelected:this._onSelected,dimension:r,showPlaceholder:!0,onItemDidMount:this._onStickerItemDidMount,onItemWillMount:this._onStickerItemWillMount},t.id):null},this._onSelected=e=>{const t=new r.StickerEntity(e.id,e.baseUrl,e.baseUrl,e.name);this.props.onPesSelected(t,p.mediaTypes.sticker,e.id),this._trackClickedSticker(e),!this.props.renderMobileInterface&&this.state.isSearching&&this._desktopSearchTelemetry&&(this._desktopSearchTelemetry.sendSuccessTelemetryEvent(e.id,this.state.searchQuery.length),this._searchSuccessTelemetry=!0)},this._trackClickedSticker=e=>{h.StickerPickerTelemetry.itemAdded(void 0),this._trackClickedItem(e.id,void 0,void 0,this.props.triggeredBy)},this._onStickerItemWillMount=()=>{h.StickerPickerTelemetry.willMountItem()},this._onStickerItemDidMount=()=>{h.StickerPickerTelemetry.mountedItem()}}componentWillUnmount(){super.componentWillUnmount(),h.StickerPickerTelemetry.pickerWillUnmount()}_willChangeCategory(e){super._willChangeCategory(e),e!==this._getPesTabType()&&h.StickerPickerTelemetry.closed()}_getInitialPagedTabIndex(){return 1}_getEmptyRecentMessage(){return l.getString("PesPicker.EmptyRecentStickers")}_getPesTabType(){return p.TabType.ChatSticker}_getTabs(e,t){const s=d.default.getChatStickerTabs();let i;if(e){i=u.searchInPackDescriptionAndItemMetadata(s,e),i=o.filter(i,(e=>e.packs&&e.packs.length>0));const t=this._mergePacksInSingleTab(i);t&&(i=[t])}else if(""!==e){const e=g.default.getRecentStickerInChatTabInfo();(!t||t&&!o.isEmpty(e.packs))&&s.unshift(e)}const n=i||s;return this._getContext().isRTL&&o.reverse(n),n}_getPesItem(e){return f.default.getSticker(e)}_getPesPreview(){if(this.state.previewItem)return(0,i.jsx)(m.default,{src:this.state.previewItem.baseUrl,etag:this.state.previewItem.etag,showPlaceholder:!0,dimension:p.frameHeights.stickers.Size112,name:this.state.previewItem.name},this.state.previewItem.id)}_getPesInfo(e){return[e.name?e.name.trim():void 0,e.copyright?e.copyright.trim():void 0]}_getPackAccessibilityLabel(e){return l.getString("PesPicker.StickerPackHeaderAccessibilityLabel",{title:e.title,count:e.items.length})}_getSearchNoResultsMessage(){return l.getString("PesSearch.StickerPickerNoResultsSearchText")}_getErrorMessage(){return l.getString("MediaBar.StickerPickerErrorText")}_getErrorSymbol(){return y.SkypeIcon.StickerDeleted}_getSearchLabel(){return l.getString("PesPicker.SearchStickers")}_getStaticItemDimension(){return(this._getItemDimension()||this._getDefaultItemDimension())+this._doubleBorderItem}_getDefaultItemDimension(){return p.frameHeights.stickers.Size90}_getMinItems(e){return 3}}t.default=v},356129:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(911009),r=s(677381),a=s(245381),l=s(711828);class d extends r.default{constructor(){super(...arguments),this._toolTipAnimationConfig={duration:250,easing:o.Animated.Easing.OutBack()},this._toolTipConfig=()=>({getElement:this.props.anchor,positions:[n.PopupAnchorPositon.Bottom],durationMs:3500,title:this.props.title,optionalIcon:l.SkypeIcon.Lightbulb,anchorAccessibilityLabel:this.props.accessibilityLabel,instanceId:this.state.instanceId,rootViewId:this._getRootViewId()}),this._onTooltipClick=e=>{this.props.onPress&&this.props.onPress(e)}}_buildState(e,t){return{instanceId:e.instanceId||"unknown"}}render(){return(0,i.jsx)(a.default,{toolTipInfo:this._toolTipConfig(),animateDismissal:!1,animationConfig:this._toolTipAnimationConfig,textMarginHorizontal:10,textMarginVertical:10,containerOffsetX:this.props.offsetX,containerOffsetY:this.props.offsetY,onPress:this._onTooltipClick})}}t.default=d},624722:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(671830),a=s(147204),l=s(677381),d=s(539549),c=s(437490),h=s(952262),u=s(341706),p=s(667121),g=s(125793),m=s(915877),S=s(733754),f=s(330124),y=s(29130),v=s(910265),C=s(581760),_=s(311010),b=s(619675),T=(0,m.lazyProperties)({contentContainer:()=>n.Styles.createViewStyle({flexDirection:"column",flex:1}),safeCodeSummaryText:()=>n.Styles.createTextStyle({paddingVertical:16,color:C.Color.white}),safeCodeText:()=>n.Styles.createTextStyle({paddingRight:15,paddingBottom:10,color:C.Color.white,fontFamily:_.default.fontFamily.monospace}),safeCodeTextContainer:()=>n.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",maxWidth:280})}),M="SafeCodeDialog";class I extends l.default{_buildState(e,t){const s=this._getRootViewId();return{isUsingStackNavigationContext:f.default.isUsingStackNavigationContext(),width:y.default.getWidth(s),recipientShortName:h.default.getShortDisplayName(e.mri),isEncryptedThreadEstablished:u.default.getHandshakeState(e.conversationId)===g.SecureHandshakeState.Completed}}static hideSafeCode(e){a.default.isModalDisplayed(M,e)&&a.default.dismissModal(M,e)}static showForConversationId(e,t){const s=(0,d.default)().getConversation(e);if(s){const o=s.getOtherPartyMri();o&&p.default.getFingerprint(r.asSkypeThreadId(e)).then((s=>{c.dismissAll();const n=(0,i.jsx)(I,{conversationId:e,mri:o,fingerprint:s});a.default.showModal(n,M,{rootViewId:t})}))}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.isEncryptedThreadEstablished&&!this.state.isEncryptedThreadEstablished&&I.hideSafeCode(this._getRootViewId())}render(){const e=[{text:S.getString("Global.CloseButtonTitle"),isCancel:!0}],t=[T.contentContainer];const s=S.getString("InfoPanel.SafeCodeDialogHeading",{recipientName:this.state.recipientShortName}),o=S.getString("InfoPanel.SafeCodeDialogTitle");return(0,i.jsx)(v.default,Object.assign({dialogId:M,text:o,buttons:e,closeOnClickOutside:!0,accessibilityLabel:o},{children:(0,i.jsxs)(n.View,Object.assign({style:t},{children:[(0,i.jsx)(b.BodyText,Object.assign({style:T.safeCodeSummaryText},{children:S.getString("InfoPanel.SafeCodeDialogBody")})),(0,i.jsx)(b.BodyText,Object.assign({bold:!0,style:T.safeCodeSummaryText},{children:s})),(0,i.jsx)(n.View,Object.assign({style:T.safeCodeTextContainer},{children:this._formatFingerprint()}))]}))}))}_formatFingerprint(){const e=o.map(o.chunk(this.props.fingerprint,5),(e=>o.join(e,"")));return o.map(e,(e=>(0,i.jsx)(n.Text,Object.assign({style:[_.default.fontStyle.secondaryButton,T.safeCodeText]},{children:e}),e)))}}t.default=I},617993:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(898278),n=s(341706),r=s(125793),a=s(733754),l=s(330124),d=s(69413),c=s(711828),h=s(24576),u=s(677524);class p extends h.default{constructor(){super(...arguments),this._showSafeCode=e=>{e.stopPropagation(),(0,d.showPrivateConversationSafeCode)(this.props.conversationId,this._getRootViewId())}}_buildState(e,t){return{isUsingStackNavigationContext:l.default.isUsingStackNavigationContext(),isEncryptedThreadEstablished:n.default.getHandshakeState(e.conversationId)===r.SecureHandshakeState.Completed}}render(){return(0,i.jsx)(u.WideButton,{icon:c.SkypeIcon.PrivateSessionKey,label:a.getString("InfoPanel.SafeCodeLabel"),onPressed:this._showSafeCode,hideArrow:!0,disabled:!this.state.isEncryptedThreadEstablished,buttonStyles:this.state.isUsingStackNavigationContext?void 0:o.ListItem.small.shortHeightStyle})}}t.default=p},18369:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImagePreview=t.UrlPreview=t.PreviewInfo=t.FilePreview=void 0;const i=s(785893),o=s(516778),n=s(898278),r=s(139889),a=s(685609),l=s(110117),d=s(915877),c=s(915415),h=s(581760),u=s(311010),p=s(711828),g=s(680837),m=s(619675),S=s(24576),f=(0,d.lazyProperties)({previewIconContainer:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:h.Color.blue,justifyContent:"center",alignItems:"center"}),previewIconContainerUrl:()=>o.Styles.createViewStyle({justifyContent:"center",alignItems:"center"}),previewInfoContainer:()=>o.Styles.createViewStyle({flexDirection:"column",justifyContent:"center"}),previewInfo2Container:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}),previewInfo2ContainerForContact:()=>o.Styles.createViewStyle({justifyContent:"center",paddingRight:5}),previewTextSmall1:()=>o.Styles.createTextStyle({backgroundColor:h.Color.transparent,textAlign:"left"}),previewTextSmall2:()=>o.Styles.createTextStyle({backgroundColor:h.Color.transparent,textAlign:"left",textAlignVertical:"center",marginTop:2}),previewTextLarge1:()=>o.Styles.createTextStyle({textAlign:"center",color:h.Color.black,fontSize:u.default.fontSize.size20}),previewTextLarge2:()=>o.Styles.createTextStyle({color:h.Color.black,fontSize:u.default.fontSize.size18}),spinnerContainer:()=>o.Styles.createTextInputStyle({alignSelf:"stretch",marginRight:10,justifyContent:"center",alignItems:"center"}),imageContainerPreview:()=>o.Styles.createImageStyle({flex:1,alignSelf:"stretch"}),fileIcon:()=>o.Styles.createViewStyle({margin:8}),fileIconCaption:()=>o.Styles.createTextStyle({paddingHorizontal:4,maxWidth:110}),iconPadding:()=>o.Styles.createViewStyle({paddingRight:4})});class y extends S.default{render(){let e,t,s,n,r=h.Color.white;this.props.borderRadius&&(s=o.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1));const d=[f.previewIconContainer,s];if(this.props.fileName){r=this._themeColors.primaryIconColor,d.push(this._themeStyles.primaryBackgroundColorStyle),n=f.fileIcon;const s=a.FileIconHelper.getIconFromFileType(this.props.fileName,this.props.fileType);e=s.icon,t=(0,i.jsx)(m.BodyText,Object.assign({bold:!0,ellipsizeMode:"tail",numberOfLines:1,style:f.fileIconCaption},{children:s.displayString}))}return(!e||this.props.isShareWithContact&&e===p.SkypeIcon.File)&&(e=p.SkypeIcon.FileMultiple),(0,i.jsxs)(o.View,Object.assign({style:d},{children:[(0,i.jsx)(l.default,{icon:e,size:p.IconSize.size32,color:r,style:n}),t]}))}}t.FilePreview=y;class v extends S.default{render(){const e=[f.previewTextSmall1,this.props.isShareWithContact?f.previewTextLarge1:void 0,this.props.lineStyles],t=[f.previewTextSmall2,this.props.lineStyles,this.props.isShareWithContact?f.previewTextLarge2:void 0,this.props.lineStyles];let s,n;if(this.props.firstLine){const t=this.props.iconToShowFirstLine?(0,i.jsx)(l.default,{icon:this.props.iconToShowFirstLine,size:p.IconSize.size16,color:this._themeColors.primaryTextColor,style:f.iconPadding}):void 0,n=(0,i.jsx)(m.BodyText,Object.assign({style:e,numberOfLines:1,ellipsizeMode:"tail",bold:!0,size:m.BodyTextSize.SmallDeprecated},{children:this.props.firstLine}));s=t?(0,i.jsxs)(o.View,Object.assign({style:f.previewInfo2Container},{children:[t,n]})):n}if(this.props.secondLine){const e=this.props.iconToShowSecondLine?(0,i.jsx)(l.default,{icon:this.props.iconToShowSecondLine,size:p.IconSize.size12,color:this._themeColors.secondaryTextColor,style:f.iconPadding}):void 0;n=(0,i.jsxs)(o.View,Object.assign({style:[f.previewInfo2Container,this.props.isShareWithContact?f.previewInfo2ContainerForContact:void 0]},{children:[e,(0,i.jsx)(m.Caption,Object.assign({style:t,ellipsizeMode:"tail",numberOfLines:1},{children:this.props.secondLine}))]}))}return(0,i.jsxs)(o.View,Object.assign({style:f.previewInfoContainer},{children:[s,n]}))}}t.PreviewInfo=v;class C extends S.default{render(){let e;this.props.borderRadius&&(e=o.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1));let t,s=[];return this.props.urlThumbnail?(t=(0,i.jsx)(_,{imagePreviewHeight:this.props.imagePreviewHeight,imagePreviewWidth:this.props.imagePreviewWidth,borderRadius:this.props.borderRadius,urlThumbnail:this.props.urlThumbnail}),s=[g.default.shadowStyle,g.default.absoluteFill,e]):(t=(0,i.jsx)(l.default,{icon:p.SkypeIcon.Link,size:p.IconSize.size40,color:this._themeColors.primaryIconColor}),s.push(f.previewIconContainerUrl)),(0,i.jsx)(o.View,Object.assign({style:s},{children:t}))}}t.UrlPreview=C;class _ extends S.default{render(){const e=o.Styles.createTextInputStyle({height:this.props.imagePreviewHeight,width:this.props.imagePreviewWidth},!1);let t;this.props.borderRadius&&(t=o.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1));const s=(0,i.jsx)(o.View,Object.assign({style:[f.spinnerContainer,e]},{children:(0,i.jsx)(c.default,{size:n.SXActivityIndicatorSize.Small,tintColor:this._themeColors.primaryIconColor})})),a=(0,i.jsx)(y,{borderRadius:this.props.borderRadius}),l=o.Styles.createImageStyle({overlayColor:this._themeColors.primaryBackgroundColor},!1);return(0,i.jsx)(r.default,{containerStyle:[f.imageContainerPreview,t],style:[f.imageContainerPreview,t,l],origin:"ShareWithContactPanel",source:this.props.urlThumbnail,resizeMode:"cover",altView:s,errorView:a})}}t.ImagePreview=_},79735:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(898278),r=s(409628),a=s(915877),l=s(733754),d=s(89808),c=s(886045),h=s(915415),u=s(22222),p=s(711828),g=s(680837),m=s(24576),S=s(746096),f=(0,a.lazyProperties)({containerWidth:()=>o.Styles.createViewStyle({minWidth:77,marginRight:2}),spinnerContainer:()=>g.default.alignItemsCenter,containerSmall:()=>o.Styles.createViewStyle({height:30})});class y extends m.default{constructor(){super(...arguments),this._renderSendButton=()=>{const e=this.props.origin===S.SearchResultsListOrigin.SayHiPopup?l.getString("SayHiPopup.SayHiButtonBeforeSending"):l.getString("ShareWithPanel.SendButton");return(0,i.jsx)(u.default,{title:e,accessibilityLabel:this.state.accessibilityLabel,buttonSize:n.SXButtonSize.Small,onPress:this._onSendPress,tabIndex:-1,importantForAccessibility:void 0})},this._onSendPress=e=>{e.stopPropagation(),this.props.onSendMessageButtonPress(this.props.userMri)},this._renderSendingIndicator=()=>(0,i.jsx)(h.default,{size:n.SXActivityIndicatorSize.Small,tintColor:this.state.color}),this._renderSentIndicator=()=>{const e=l.getString("ShareWithPanel.SentLabel");return(0,i.jsx)(u.default,{title:e,accessibilityLabel:this.state.accessibilityLabel,buttonStyle:n.SXButtonStyle.ColorStroke,buttonSize:n.SXButtonSize.Small,onPress:this._onSendPress,disabled:!0,icon:p.SkypeIcon.Ok,disabledOpacityOverride:!0,tabIndex:-1,importantForAccessibility:void 0})}}_buildState(e,t){const s=r.default.getStateForMri(e.userMri);return{sendingState:s,color:this._useAccessibleTheme()?this._themeColors.primaryTextColor:d.default.getPrimaryColor(),accessibilityLabel:this._getAccessibilityLabelForMRI(e.rowTitle,s)}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.sendingState!==r.ForwardMessageState.Sent&&this.state.sendingState===r.ForwardMessageState.Sent&&c.default.maybeAnnounceForAccessibility(l.getString("MessageComposer.MessageSentLabel"))}render(){let e;const t=[f.containerWidth];return this.state.sendingState===r.ForwardMessageState.Sending?(t.push(f.spinnerContainer),e=this._renderSendingIndicator()):this.state.sendingState===r.ForwardMessageState.Sent?(t.push(f.containerSmall),e=this._renderSentIndicator()):(t.push(f.containerSmall),e=this._renderSendButton()),(0,i.jsx)(o.View,Object.assign({style:t},{children:e}))}_getAccessibilityLabelForMRI(e,t){let s="ShareWithPanel.SendToAccessibilityLabel";return t===r.ForwardMessageState.Sent&&(s="ShareWithPanel.SentToAccessibilityLabel"),l.getString(s,{displayName:e})}}t.default=y},690574:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(809206),r=s(583367),a=s(216934),l=s(516778),d=s(974634),c=s(397691),h=s(889391),u=s(67930),p=s(351077),g=s(803056),m=s(18369),S=s(946992),f=s(882261),y=s(816402),v=s(770891),C=s(746096),_=s(552115),b=s(753559),T=s(409628),M=s(497174),I=s(923944),w=s(436237),P=s(710400),k=s(915877),A=s(733754),x=s(381157),R=s(723752),O=s(104735),L=s(330124),F=s(795691),B=s(785207),D=s(628433),E=s(29130),V=s(451070),N=s(415963),U=s(694622),j=s(210541),H=s(532514),z=s(250571),W=s(994165),G=s(724067),K=s(190631),q=s(316392),Q=s(404057),X=s(932293),$=s(581760),J=s(311010),Y=s(711828),Z=s(680837),ee=s(619675),te=s(409426),se=s(510609),ie=s(626712),oe=s(702301),ne=s(567977),re=s(853374),ae=s(115340),le=s(898278),de=n.default.isMobile()?140:205,ce=n.default.isMobile()?20:0,he=n.default.isMobile()?110:185,ue=n.default.isMobile()?110:185,pe=10,ge=(0,k.lazyProperties)({container:()=>l.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),previewContainerCommon:()=>l.Styles.createViewStyle({flexDirection:"row",alignItems:"stretch"}),previewContainer:()=>l.Styles.createViewStyle({padding:10}),previewContainerModernizedMobile:()=>l.Styles.createViewStyle({padding:16}),previewContainerModernized:()=>l.Styles.createViewStyle({paddingHorizontal:36,paddingTop:16,paddingBottom:10}),mediaPreviewContainer:()=>l.Styles.createViewStyle({height:he,width:ue,alignSelf:"stretch",marginRight:10,justifyContent:"center",alignItems:"center",borderRadius:pe}),mediaPreviewForwardContainerDesktop:()=>l.Styles.createViewStyle({height:110,width:110}),frontImageContainerPreview:()=>l.Styles.createViewStyle({position:"absolute",top:7,left:0,right:0,bottom:0,borderRadius:pe}),backImageContainerPreview:()=>l.Styles.createViewStyle({position:"absolute",top:2,left:7,right:7,bottom:7,borderRadius:pe}),imagesCount:()=>l.Styles.createTextStyle({position:"absolute",bottom:0,left:0,right:0,lineHeight:24,borderBottomLeftRadius:pe,borderBottomRightRadius:pe,color:$.Color.white,backgroundColor:$.Color.blackOverlay60,textAlign:"center",elevation:3}),messageAndButtonAndPreviewInfoContainer:()=>l.Styles.createViewStyle({flex:1,paddingTop:12,paddingLeft:12,paddingRight:12,paddingBottom:8,borderRadius:pe,overflow:"visible",flexDirection:"column",justifyContent:"space-between"}),messageMobile:()=>l.Styles.createTextInputStyle({backgroundColor:$.Color.transparent,paddingRight:15,flex:1,height:80,fontSize:J.default.fontSize.size17}),textInputHeightMobile:()=>l.Styles.createTextInputStyle({height:60}),messageDesktopForward:()=>l.Styles.createTextInputStyle({backgroundColor:$.Color.transparent,flex:1}),messageForwardCanvas:()=>l.Styles.createTextInputStyle({margin:12}),quotePreviewArea:()=>l.Styles.createViewStyle({flex:1,paddingTop:12,paddingHorizontal:12}),quotesPreviewContainerCommon:()=>l.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"stretch",borderRadius:10,borderWidth:0}),quotesPreviewContainerWithTextInput:()=>l.Styles.createViewStyle({margin:10}),quotesPreviewContainerWithTextInputMobile:()=>l.Styles.createViewStyle({margin:16}),quotesPreviewContainerWithTextInputModernized:()=>l.Styles.createViewStyle({marginHorizontal:36,marginTop:16,marginBottom:10}),quotePreviewTextStyle:()=>l.Styles.createTextStyle({fontSize:Y.IconSize.size16,lineHeight:21}),previewInfoWithoutThumbnail:()=>l.Styles.createTextStyle({maxWidth:420}),previewInfoWithThumbnail:()=>l.Styles.createTextStyle({maxWidth:300}),quoteContainerForwardDesktop:()=>l.Styles.createViewStyle({height:47}),previewLocationPin:()=>l.Styles.createViewStyle({backgroundColor:$.Color.black,height:22,width:22,borderRadius:44,borderWidth:3,borderColor:$.Color.white,borderStyle:"solid",position:"absolute",top:55,left:55}),secondaryButton:()=>l.Styles.createButtonStyle({position:"absolute",height:40,width:40,right:10})}),me={[C.SearchType.ZeroInput]:[{groupType:C.SearchResultsListGroup.SuggestedRecentConversationsWithEstablishedPrivateConversations,isCollapsible:!0},{groupType:C.SearchResultsListGroup.CombinedContactsWithoutAddressBookOrAlphaHeaders,isCollapsible:!0}],[C.SearchType.ZeroInputWithMagicBot]:[{groupType:C.SearchResultsListGroup.ShareMagicBot},{groupType:C.SearchResultsListGroup.SuggestedRecentConversationsWithEstablishedPrivateConversations,isCollapsible:!0},{groupType:C.SearchResultsListGroup.CombinedContactsWithoutAddressBookOrAlphaHeaders,isCollapsible:!0}],[C.SearchType.ShortQuery]:[{groupType:C.SearchResultsListGroup.AllPeopleWithoutAddressBook},{groupType:C.SearchResultsListGroup.GroupChats}],[C.SearchType.LongQuery]:[{groupType:C.SearchResultsListGroup.AllPeopleWithoutAddressBook},{groupType:C.SearchResultsListGroup.GroupChats},{groupType:C.SearchResultsListGroup.PublicDirectory}]};class Se extends u.default{constructor(){super(...arguments),this._onKeyDownEvent=new d.default,this._keyboardAnimatedHeightValue=new l.Animated.Value(0),this._keyboardAnimatedHeightStyle=l.Styles.createAnimatedViewStyle({height:this._keyboardAnimatedHeightValue}),this._hasUsedSearch=!1,this._wasSharePanelDismissedByUser=!1,this._goBack=e=>(w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._goBack,  causeId: "+e),this.props.onShareCancel&&(this.props.onShareCancel(),this._dismissed=!0),this._wasSharePanelDismissedByUser=!0,x.default.hideProcessingDialog(!1),super._goBack(e)),this._onSearchResultsListRef=e=>{this._searchResultsListRef=e||void 0},this._onExternalShareButtonRef=e=>{this._externalShareButtonRef=e||void 0},this._onProfileRemoved=()=>{this._searchResultsListRef&&this._searchResultsListRef.focusFirst()},this._onInputChanged=e=>{this.isComponentMounted()&&(!1===this._hasUsedSearch&&e.length>0&&(this._hasUsedSearch=!0),this.setState({inputText:e}))},this._onExternalSharePress=()=>{if(this.props.onExternalShare)if(this.props.entryPoint===C.SharePanelEntryOrigin.TodayTab||this.props.entryPoint===C.SharePanelEntryOrigin.InAppBrowserActionMenu)this.props.onExternalShare();else if(this.props.entryPoint===C.SharePanelEntryOrigin.MessageActionMenu){const e=this._getStreamItemUrl();o.isString(e)&&this.props.onExternalShare(e,this._externalShareButtonRef)}},this._isDoneButtonDisabled=()=>!this.isComponentMounted()||!this.state.shareDestinations||this.state.shareDestinations.length<=0,this._getHeader=()=>{let e;if(!this.props.isExternalWindow){const t={closeButtonType:this.props.navigationDirection===q.StackNavigationDirection.Push?K.CloseButtonType.Back:K.CloseButtonType.Close,onPress:this._cancelShare,title:A.getString("ShareWithPanel.CloseButtonTitle")},s=this._getHeaderText(this.state),n=this.props.accessibilityLabelTitle||o.trimEnd(s,".");e=(0,i.jsx)(K.SimplePanelHeader,{panelName:s,accessibleName:n,leftButton:t,hideBottomBorder:!this._enablePreview})}const t=this._enablePreview?this._renderPreviewAndText():void 0;return(0,i.jsxs)(l.View,{children:[e,t]})},this._getStreamItemUrl=()=>{var e,t;if(this.props.multipleMessagesParameters.length>0){const s=this.props.multipleMessagesParameters[0].swiftMessage;if(null==s?void 0:s.attachments)return null===(t=null===(e=s.attachments[0].content)||void 0===e?void 0:e.tap)||void 0===t?void 0:t.value}},this._onSearchInputKeyDown=e=>{this._onKeyDownEvent.fire(e.keyCode)},this._onSendButtonPress=e=>{const t=re.default.newCauseId();w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._onSendButtonPress,  causeId: "+t),T.default.updateSendingStatus(e,T.ForwardMessageState.Sending),this.state.shareDestinations.push(e),this.isComponentMounted()&&this.setState({shareDestinations:this.state.shareDestinations,headerConfig:Object.assign(Object.assign({},this.state.headerConfig),{key:"header"+this.state.shareDestinations.length})}),this._completeSharingProcess([e],t)},this._cancelShare=()=>{const e=re.default.newCauseId();w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._cancelShare, causeId: "+e),this._goBack(e)},this._shareDone=()=>{const e=re.default.newCauseId();return w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._shareDone, causeId: "+e),this._wasSharePanelDismissedByUser=!0,x.default.hideProcessingDialog(!1),super._goBack(e)},this._onInput=e=>{this._savedMessageInput=e,this.isComponentMounted()&&this.setState({previewMessage:e,headerConfig:Object.assign(Object.assign({},this.state.headerConfig),{key:"header"+e})})},this._headerHeight=()=>{const{sharePreviewType:e}=this.props,t=[F.SharePreviewType.AudioMessage,F.SharePreviewType.Location,F.SharePreviewType.File,F.SharePreviewType.Audio],s=this._enablePreview?de:0,i=e&&t.includes(e)?ce:0,o=this.state.enableMagicBotShare?-10:0;return(this.state.deviceOrientation!==r.DeviceOrientation.Landscape?this.state.isSmallDevice?K.HeaderHeightSmall:K.HeaderHeight:this.state.isSmallDevice?K.HeaderHeightLandscapeSmall:K.HeaderHeightLandscape)+this.state.statusBarPadding+s+i+o}}_buildState(e,t){const s=this._getRootViewId(),{modernizeSearchPanel:i,enableShareMediaPreview:n,enableForwardingQuotes:r,enableMagicBot:a,enableMyBot:d}=h.default.getS4LMessagingFeatures();let c={statusBarPadding:V.default.statusBarPadding(),deviceOrientation:E.default.getDeviceOrientation(s),isSmallDevice:E.default.isSmallDevice(s),modernizeSearchPanel:i,enableForwardingQuotes:r,enableMagicBotShare:a&&e.isMagicBotShare,enableMyBot:d};if(t&&(this._conversationSelectionController=new S.default,this._finishButtonAnimatedHeightValue=new l.Animated.Value(0),this._dismissed=!1,c.urlThumbnail=void 0,c.inputText="",c.shareDestinations=[],this._enableForwardPreview=o.isUndefined(e.showForwardPreview)||e.showForwardPreview,this._enableMediaPreview=e.enableMediaPreview&&n,this._enablePreview=o.isUndefined(this._enableForwardPreview)?this._enableMediaPreview:this._enableForwardPreview,this._enablePreview)){c=this._tryGetUrlPreview(e,c);const t=o.find(e.multipleMessagesParameters,(e=>!!e.messageContent));c.previewMessage=this._isUrlShare||e.showForwardPreview||e.sharePreviewType!==F.SharePreviewType.Text?void 0:t&&t.messageContent,this._savedMessageInput=c.previewMessage}c.isUsingStackNavigationContext=L.default.isUsingStackNavigationContext(),c.keyboardUpdateInfo=P.default.getUpdateInfo(),c.keyboardResizeMode=P.default.getResizeMode(),c.selectedMris=this._conversationSelectionController.getSelectedConversations(),c.canSubmit=this._conversationSelectionController.getSelectedConversations().length>0;const u=e.sharePreviewType===F.SharePreviewType.Text,g=e.sharePreviewType===F.SharePreviewType.MultipleMessages&&o.every(e.multipleMessagesParameters,(e=>e.messageType===p.MessageTypes.Text||e.messageType===p.MessageTypes.EncryptedText)),m=u||g;return c.includePrivateConversations=e.showForwardPreview&&m,c.excludeS4B=!m,c.headerConfig={getHeader:this._getHeader,getHeaderHeight:this._headerHeight,key:"header"+c.previewMessage},c}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._searchController=new H.default,T.default.reset()}componentDidMount(){super.componentDidMount();const e=this.props.multipleMessagesParameters.length>0&&this.props.multipleMessagesParameters[0].conversationId;e&&(this._conversationSelectionController.addConversation(e),this.setState({canSubmit:!0}),l.Animated.timing(this._finishButtonAnimatedHeightValue,{toValue:48,duration:250,easing:l.Animated.Easing.InOut()}).start())}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.state.keyboardUpdateInfo.height!==t.keyboardUpdateInfo.height&&this._keyboardAnimatedHeightValue.setValue(t.keyboardUpdateInfo.height)}componentWillUnmount(){super.componentWillUnmount();const e=re.default.newCauseId();w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel.componentWillUnmount,  causeId: "+e),T.default.reset(),!this._dismissed&&this.props.onShareCancel&&this.props.onShareCancel(),this._searchController&&this._searchController.destroy(),w.track(new z.SharePanelTelemetry(this.props.entryPoint,this.state.shareDestinations.length,this._hasUsedSearch,!!this._savedMessageInput)),this.state.shareDestinations.length>0&&this._wasSharePanelDismissedByUser&&(this.props.showForwardPreview&&o.each(this.props.multipleMessagesParameters,(t=>{this._onShareCompleteForMessage(t,this.state.shareDestinations,e)})),!this.props.onShareComplete||this.props.onShareCancel&&this._dismissed||this.props.onShareComplete(this.state.shareDestinations,!!this.state.previewMessage))}render(){const e=this.state.keyboardResizeMode===a.KeyboardAwareResizeMode.None?(0,i.jsx)(l.Animated.View,{style:this._keyboardAnimatedHeightStyle}):void 0,t=!l.UserInterface.isNavigatingWithKeyboard();return(0,i.jsx)(g.default,Object.assign({goBack:this._goBack},{children:(0,i.jsxs)(ae.KeyboardAvoidingView,Object.assign({style:[ge.container,this._themeStyles.primaryBackgroundColorStyle]},{children:[(0,i.jsxs)(l.View,Object.assign({style:ge.container},{children:[(0,i.jsx)(D.default,{searchController:this._searchController,headerConfig:this.state.headerConfig,onCancel:this._cancelShare,peopleType:j.PeopleType.AllExcludingBots,includeGroups:!0,autoFocusOnInput:t,autoFocusWhenActive:!0,selectorController:this._conversationSelectionController,useCollapsableHeader:!1,onKeyDown:this._onSearchInputKeyDown,isUrlRequestComplete:!!this.state.urlThumbnail,inputText:this.state.inputText,onInputChanged:this._onInputChanged,colorThemeOverride:this.props.colorThemeOverride,onProfileRemoved:this._onProfileRemoved,noFixedHeight:this._isHeightUnknownForHeader(),showSendButtonOnEverySearchItemUI:!0},"peopleInput"),(0,i.jsx)(U.SearchResultsList,{useItemSeparator:!this.state.modernizeSearchPanel,ref:this._onSearchResultsListRef,rawSearchQuery:this.state.inputText,origin:C.SearchResultsListOrigin.ShareWithPanel,searchResultGroups:this._getSearchResultsGroup(),searchController:this._searchController,arePeopleSelectableForInvite:!1,selectedMris:this.state.selectedMris,peopleType:this.state.enableMyBot?j.PeopleType.PeopleWithMyBot:j.PeopleType.AllExcludingBots,maxNumberOfSuggestedContacts:20,excludePstn:!0,excludeS4B:this.state.excludeS4B,userMrisToExclude:this.props.userMrisToExclude,keyDownEvent:this._onKeyDownEvent,colorThemeOverride:this.props.colorThemeOverride,excludeEncrypted:!this.state.includePrivateConversations,includePrivateConversationsWithHandshake:this.state.includePrivateConversations,onSendMessageButtonPress:this._onSendButtonPress,disableItemOnLongPress:!0,disableRowHoverStyle:!0,excludeNewsChannels:!0,excludeNewsBot:!0})]})),(0,i.jsx)(G.default,{button:this._getActionDoneButton(),secondaryButton:this._getExternalShareButton()}),e]}))}))}_componentId(){return"ShareWithPanel"}_isHeightUnknownForHeader(){return!this.state.isUsingStackNavigationContext||this.props.sharePreviewType===F.SharePreviewType.Text}_getActionDoneButton(){return{onPress:this._shareDone,disabled:this._isDoneButtonDisabled(),text:A.getString("Global.DoneButtonTitle"),accessibilityLabel:A.getString("Global.DoneButtonTitle")}}_getExternalShareButton(){if(void 0!==this.props.onExternalShare)return{onPress:this._onExternalSharePress,icon:Y.SkypeIcon.Share,iconSize:Y.IconSize.size24,buttonStyle:le.SXButtonStyle.Custom,backgroundStyle:{borderRadius:40,paddingLeft:0,paddingRight:0},buttonConfig:{backgroundColor:$.Color.gray200},style:ge.secondaryButton,setButtonRef:this._onExternalShareButtonRef}}_tryGetUrlPreview(e,t){if(e.sharePreviewType!==F.SharePreviewType.Text)return t;if(e.showForwardPreview){const s=o.filter(e.multipleMessagesParameters,(e=>!!e.urlPreviewData));if(s&&1===s.length){const e=s[0].urlPreviewData;e&&e.isValid&&(this._isUrlShare=!0,t=Object.assign(Object.assign({},t),{urlThumbnail:e.urlPreviewMetadata.thumbnail,site:e.urlPreviewMetadata.site,infoUrl:e.urlPreviewMetadata.url}))}return t}let s;return e.multipleMessagesParameters.length>0&&(s=e.multipleMessagesParameters[0].messageContent||e.multipleMessagesParameters[0].url),s&&ie.default.isUrlValid(s)?(this._isUrlShare=!0,te.default.getUrlInfoAsync(s).then((e=>{if(!s)return;const t=se.getUrlPreviewInformationFromMetadata(e,s),i=t.hasThumbnail?t.urlPreviewMetadata.thumbnail:void 0,o=t.urlPreviewMetadata.site,n=t.urlPreviewMetadata.url;this.isComponentMounted()&&this.setState({urlThumbnail:i,site:o,infoUrl:n})})).catch((e=>{w.error(C.LogTraceArea.ShareWithPanel,"Error generating url preview in ShareWithPanel: "+Q.default.errorAsString(e))})),t):t}_getOptionalContentPreviewAsQuoteStyles(){const e=[ge.quotesPreviewContainerCommon];return this.state.modernizeSearchPanel?e.push(ge.quotesPreviewContainerWithTextInputModernized):e.push(ge.quotesPreviewContainerWithTextInput),e.push(this._themeStyles.secondaryBackgroundColorStyle),e}_getPreviewContentStyles(){const e=[ge.previewContainerCommon];return this.state.modernizeSearchPanel?e.push(ge.previewContainerModernized):e.push(ge.previewContainer),e}_renderPreviewAndText(){let e,t,s,r;const a=!this.props.isExternalWindow&&!n.default.isMobile(),d=[ge.mediaPreviewContainer,a?ge.mediaPreviewForwardContainerDesktop:void 0];let c;if(c=this.state.urlThumbnail?ge.previewInfoWithThumbnail:ge.previewInfoWithoutThumbnail,this._isUrlShare)this.state.urlThumbnail&&(e=(0,i.jsx)(m.UrlPreview,{imagePreviewHeight:he,imagePreviewWidth:ue,borderRadius:pe,urlThumbnail:this.state.urlThumbnail})),t=this._getOptionalPreviewInfo({firstLine:this.state.site,secondLine:this.state.infoUrl,isUrlPreview:!0,iconToShowSecondLine:Y.SkypeIcon.Link,lineStyles:c});else{let n=o.filter(this.props.multipleMessagesParameters,(e=>!o.isUndefined(e.localMediaThumbnailUri)));const a=this.props.sharePreviewType===F.SharePreviewType.Audio,c=ge.previewInfoWithThumbnail;let h;switch(this.props.sharePreviewType){case F.SharePreviewType.Video:t=this._getOptionalPreviewInfo({firstLine:A.getString("ShareWithPanel.VideoPreviewInfo"),iconToShowFirstLine:Y.SkypeIcon.Video,lineStyles:c}),e=this._renderThumbnailsPreview(n);break;case F.SharePreviewType.MixedVideoAndPhoto:case F.SharePreviewType.Photo:e=this._renderThumbnailsPreview(n);break;case F.SharePreviewType.AudioMessage:const u=this.props.multipleMessagesParameters&&this.props.multipleMessagesParameters.length>0?this.props.multipleMessagesParameters[0].audioMessageDuration:void 0,p=u?y.default.getElapsedTimeStringFromS(Math.ceil(u/1e3)):void 0;t=this._getOptionalPreviewInfo({firstLine:A.getString("ShareWithPanel.AudioMessagePreviewInfo"),secondLine:p?A.getString("ShareWithPanel.AudioMessageDuration",{duration:p}):void 0,iconToShowFirstLine:o.isUndefined(p)?Y.SkypeIcon.Microphone:void 0,iconToShowSecondLine:p?Y.SkypeIcon.Microphone:void 0,lineStyles:ge.previewInfoWithThumbnail});break;case F.SharePreviewType.File:case F.SharePreviewType.Audio:let g;if(d.push(this._themeStyles.viewBorderStyle),n&&1===n.length){const e=n[0];g=e.localMediaThumbnailUri&&this._getFileNameFromUrl(e.localMediaThumbnailUri)}else n=o.filter(this.props.multipleMessagesParameters,(e=>!o.isUndefined(e.fileName))),n&&1===n.length&&(g=n[0].fileName,h=a?n[0].fileType:void 0);const S=W.default.getPreviewInfoSizeInBytes(n),f=S?_.default.formatFileSize(S,2).formattedString:void 0;e=(0,i.jsx)(m.FilePreview,{borderRadius:pe,fileName:g,fileType:h}),t=this._getOptionalPreviewInfo({firstLine:W.default.getPreviewInfoTitle(n,this.props.sharePreviewType),secondLine:f,lineStyles:c});break;case F.SharePreviewType.Contact:let v,C,b="",T="";n=o.filter(this.props.multipleMessagesParameters,(e=>!o.isUndefined(e.contactInfo&&e.contactInfo.skypeId))),n&&1===n.length&&(v=n[0]),v&&v.contactInfo&&(b=v.contactInfo.skypeId,T=v.contactInfo.fullName,C=v.contactInfo.userMri),C&&(e=this._renderContactPreview(C)),t=this._getOptionalPreviewInfo({firstLine:T,secondLine:b,lineStyles:c});break;case F.SharePreviewType.SwiftCards:let M,I;if(n=o.filter(this.props.multipleMessagesParameters,(e=>!o.isUndefined(e.swiftMessage))),n&&1===n.length){n[0].localMediaThumbnailUri&&(e=this._renderThumbnailsPreview(n));const t=n[0].swiftMessage;if(t){t.attachments&&1===t.attachments.length&&(M=t.summary,I=X.default.getSwiftCardInfoTitle(t))}}t=this._getOptionalPreviewInfo({firstLine:M,secondLine:I,lineStyles:c,isUrlPreview:!0,iconToShowSecondLine:Y.SkypeIcon.Link});break;case F.SharePreviewType.Text:if(!this.props.showForwardPreview)break;const w=o.filter(this.props.multipleMessagesParameters,(e=>!o.isUndefined(e.message)));if(w.length&&w[0]){const e=w[0].message;if(!e||this.state.enableForwardingQuotes&&w[0].sendAsForwardedQuote)break;r=this._renderQuotePreview(e)}break;case F.SharePreviewType.Location:if(n=o.filter(this.props.multipleMessagesParameters,(e=>!o.isUndefined(e.locationInfo))),e=this._renderThumbnailsPreview(n),e&&(s=(0,i.jsx)(l.View,{style:ge.previewLocationPin})),n&&n.length){const e=n[0].locationInfo;e&&(t=this._getOptionalPreviewInfo({firstLine:e.topAddress,secondLine:e.bottomAddress,lineStyles:c}))}}}const h=[];a?h.push(ge.messageDesktopForward):(h.push(ge.messageMobile),this.props.sharePreviewType===F.SharePreviewType.SwiftCards&&h.push(ge.textInputHeightMobile));const u=[this._themeStyles.primaryTextColorStyle,h,r?ge.messageForwardCanvas:void 0],p=[ge.messageAndButtonAndPreviewInfoContainer,this._themeStyles.messageComposerBackgroundStyle],g=e?(0,i.jsx)(l.View,Object.assign({style:d},{children:e})):void 0,S=(0,i.jsx)(l.TextInput,{autoCorrect:!0,value:this.state.previewMessage,style:u,maxLength:25e3,multiline:!r,blurOnSubmit:!!r,onChangeText:this._onInput,placeholder:A.getString("ShareWithPanel.MessagePlaceHolder"),placeholderTextColor:this._themeColors.secondaryTextColor,keyboardAppearance:this._useDarkTheme()?"dark":"default",autoCapitalize:"sentences",editable:!this.state.isTextInputDisabled,clearButtonMode:"never"},"optionalInputText");return r?(0,i.jsxs)(l.View,Object.assign({style:this._getOptionalContentPreviewAsQuoteStyles()},{children:[r,S]})):(0,i.jsxs)(l.View,Object.assign({style:this._getPreviewContentStyles()},{children:[g,s,(0,i.jsxs)(l.View,Object.assign({style:p},{children:[S,t]}))]}))}_getOptionalPreviewInfo(e){return(0,i.jsx)(m.PreviewInfo,{firstLine:e.firstLine,secondLine:e.secondLine,isUrlPreview:e.isUrlPreview||!1,colorThemeOverride:this.props.colorThemeOverride,iconToShowFirstLine:e.iconToShowFirstLine,iconToShowSecondLine:e.iconToShowSecondLine,lineStyles:e.lineStyles})}_renderQuotePreview(e){const t=[this._themeStyles.primaryTextColorStyle,J.default.font.uiDisplayBold],s={numberOfLines:1,renderOrigin:v.MessageRenderOrigin.ForwardCanvas,textOverrideStyle:[ge.quotePreviewTextStyle,this._themeStyles.primaryTextColorStyle],atMentionStyle:t,atMentionMeOverrideStyle:this._themeStyles.primaryTextColorStyle,quoteSymbolStyle:{size:Y.IconSize.size20,color:this._themeColors.primaryTextColor},quoteSeparatorStyle:l.Styles.createViewStyle({borderColor:this._themeColors.secondaryTextColor,marginBottom:0},!1),renderSimpleAtMentions:!0},o=[ge.quotePreviewArea,ge.quoteContainerForwardDesktop];return(0,i.jsx)(l.View,Object.assign({style:o},{children:(0,i.jsx)(R.default,{message:e,wrapInQuote:!0,options:s})}))}_renderContactPreview(e){return(0,i.jsx)(oe.UserIcon,{userMri:e,size:ne.UserIconSize.Size110,borderRadiusOverride:pe},"contact-preview")}_renderThumbnailsPreview(e){if(!o.isUndefined(e)&&0===e.length)return;const t=[],s=e[0],n=e[1];let r;if(o.isUndefined(s.localMediaThumbnailUri))return;if(n){const s=(0,i.jsx)(m.ImagePreview,{imagePreviewHeight:he,imagePreviewWidth:ue,borderRadius:pe,urlThumbnail:n.localMediaThumbnailUri});t.push((0,i.jsx)(l.View,Object.assign({style:[Z.default.shadowStyle,ge.backImageContainerPreview]},{children:s}),"image-back"));const o=W.default.getPreviewInfoTitle(e,this.props.sharePreviewType);r=(0,i.jsx)(ee.Caption,Object.assign({style:ge.imagesCount},{children:o}),"images-count")}const a=(0,i.jsx)(m.ImagePreview,{imagePreviewHeight:he,imagePreviewWidth:he,borderRadius:pe,urlThumbnail:s.localMediaThumbnailUri});return n?(t.push((0,i.jsx)(l.View,Object.assign({style:[Z.default.shadowStyle,ge.frontImageContainerPreview]},{children:a}),"image-front")),r&&t.push(r),t):a}_getSearchResultsGroup(){const e=me,t=o.trim(this.state.inputText);return 0===t.length?this.state.enableMagicBotShare?e[C.SearchType.ZeroInputWithMagicBot]:e[C.SearchType.ZeroInput]:t.length<h.default.getConfigSettingsNoSubscription().search.longQueryCharCount?e[C.SearchType.ShortQuery]:e[C.SearchType.LongQuery]}_completeSharingProcess(e,t){w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcess,  causeId: "+t);let s=!0;if(this.state.previewMessage){const t=this.props.sharePreviewType===F.SharePreviewType.Text&&!this._isUrlShare;this.props.showForwardPreview&&t||W.default.sendPreviewTextMessage(e,this.state.previewMessage)}o.each(this.props.multipleMessagesParameters,(i=>{s=s&&this._shareOrForwardMessage(i,e,t)})),o.each(e,(e=>{T.default.updateSendingStatus(e,T.ForwardMessageState.Sent)}))}_shareOrForwardMessage(e,t,s){w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._shareOrForwardMessage,  causeId: "+s);let i=!0;return e&&!o.isEmpty(t)&&(e.mediaSelection?(this._completeSharingProcessForMediaSelection(e.mediaSelection,t,s),i=!1):!o.isEmpty(e.forwardMediaInfos)&&!e.swiftMessage||e.messageType===p.MessageTypes.MediaAlbum?this._completeForwardProcessForMedia(e,t,s):e.messageType&&(i=this._shareMessageBasedOnType(e,t,s))),this.props.showForwardPreview||this._onShareCompleteForMessage(e,t,s),i}_onShareCompleteForMessage(e,t,s){w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._onShareCompleteForMessage,  causeId: "+s),e.onShareCompleteForMessage&&(this._isUrlShare&&!o.isUndefined(s)&&this.props.entryPoint===C.SharePanelEntryOrigin.External&&this._completeSharingProcessForGenericMessage(e,t,s),e.onShareCompleteForMessage(t))}_shareMessageBasedOnType(e,t,s){let i;w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._shareMessageBasedOnType,  causeId: "+s);let o=!1;switch(e.messageType){case p.MessageTypes.RichText:case p.MessageTypes.Location:case p.MessageTypes.Contacts:i=this._completeSharingProcessForGenericMessage(e,t,s),o=!0,this._onPostComplete(i);break;case p.MessageTypes.Media_Card:e.adaptiveCardMessage?(i=this._completeSharingProcessForAdaptiveCard(e,t,s),o=!0):(i=this._completeSharingProcessForMediaCard(e,t,s),o=!0),this._onPostComplete(i);break;case p.MessageTypes.UriObject:this._completeSharingProcessForPhoto(e,t,s).then((e=>{this._onPostComplete(e)}));break;case p.MessageTypes.Media_Video:this._completeSharingProcessForVideo(e,t,s).then((e=>{this._onPostComplete(e)}))}return o}_onPostComplete(e){this.props.onPostComplete&&this.props.onPostComplete(e)}_completeSharingProcessForGenericMessage(e,t,s){if(w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForGenericMessage,  causeId: "+s),o.isEmpty(t))return w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForGenericMessage, nothing to share, causeId: "+s),[];const i=[];return o.each(t,(t=>{if(e.url||this._isUrlShare){const s=e.url||e.messageContent;if(!s)return;const o=W.default.sendUrlAsLink(s,t);i.push(o)}else if(e.inputEntities){let s;const o=[e.inputEntities];this._savedMessageInput&&this.props.sharePreviewType===F.SharePreviewType.Text&&(this.state.enableForwardingQuotes&&e.sendAsForwardedQuote?this._shareMessage(t,this._savedMessageInput,e.message,e.messageType,i):(s=new M.UnhandledEntity(this._savedMessageInput),o.push(s)));const n=W.default.shareMessageEntities(t,o,e.message,e.messageType);i.push(n)}else e.messageContent&&this._shareMessage(t,e.messageContent,e.message,e.messageType,i)})),i}_shareMessage(e,t,s,i,o){const n=f.createForwardMessageInfo(e,C.PostSource.ShareWith,t||"",i,void 0,void 0,s?p.getForwardedTeamsProperties(s.properties):void 0);B.default.postMessage(n),o.push({clientMessageId:n.messageForPosting.clientmessageid,conversationId:e})}_completeSharingProcessForAdaptiveCard(e,t,s){const i=[];return w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForAdaptiveCard,  causeId: "+s),o.isEmpty(t)?(w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForAdaptiveCard, nothing to share, causeId: "+s),i):(o.each(t,(t=>{if(e.adaptiveCardMessage){const s={type:e.adaptiveCardMessage.type,attachments:e.adaptiveCardMessage.attachments},o=I.encode([new M.AdaptiveUriObjectEntity(s,t,!0)],!1),n=f.createForwardMessageInfo(t,C.PostSource.ShareWith,o,e.messageType);B.default.postMessage(n),i.push({clientMessageId:n.messageForPosting.clientmessageid||"",conversationId:t})}})),i)}_completeSharingProcessForMediaCard(e,t,s){const i=[];return w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForMediaCard,  causeId: "+s),o.isEmpty(t)?(w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForMediaCard, nothing to share, causeId: "+s),i):(o.each(t,(t=>{if(e.swiftMessage){const s={type:e.swiftMessage.type,attachments:e.swiftMessage.attachments,summary:e.swiftMessage.summary},o=I.encode([new M.SwiftUriObjectEntity(s,t,!0,e.swiftMessage.summary)],!1),n=f.createForwardSwiftMessageInfo(t,C.PostSource.ShareWith,o,e.messageType,s,e.forwardMediaInfos);B.default.postMessage(n),i.push({clientMessageId:n.messageForPosting.clientmessageid||"",conversationId:t})}})),i)}_completeForwardProcessForMedia(e,t,s){w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeForwardProcessForMediaSelection,  causeId: "+s),o.isEmpty(t)?w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeForwardProcessForMediaSelection, nothing to forward, causeId: "+s):o.each(t,(t=>{B.default.postMessage(f.createForwardMessageInfo(t,C.PostSource.ShareWith,e.messageContent||"",e.messageType,e.forwardMediaInfos,e.albumId))}))}_completeSharingProcessForMediaSelection(e,t,s){w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForMediaSelection,  causeId: "+s),o.isEmpty(t)?w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForMediaSelection, nothing to share, causeId: "+s):x.default.postMediaSelections(e,t,C.PostSource.ShareWith,{},void 0,s).then((()=>{O.default.navigateToHub(s)}))}_completeSharingProcessForPhoto(e,t,s){if(w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForPhoto,  causeId: "+s),o.isEmpty(t))return w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForPhoto, nothing to share, causeId: "+s),c.Resolved([]);const i=e.localMediaObjectUri;if(i){const o=this._getFileNameFromUrl(i),n={file:{uri:i,name:o,size:e.fileSize,type:"image/jpg"},extension:b.default.extractFileExtension(o)};return e.width&&e.height&&(n.dimensions={width:e.width,height:e.height}),B.default.postUploadAndShowFeedbackToast(t,n,C.PostSource.ShareWith,void 0,void 0,void 0,{name:N.ScenarioName.SendMessage}).finally((()=>{O.default.navigateToHub(s)}))}return w.warn(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForPhoto, no uri for the photo!  causeId: "+s),c.Rejected()}_completeSharingProcessForVideo(e,t,s){if(w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForVideo,  causeId: "+s),o.isEmpty(t))return w.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForVideo, nothing to share, causeId: "+s),c.Resolved([]);const i=e.localMediaObjectUri;if(i){const o=i.substring(i.lastIndexOf("/")+1),n={file:{uri:i,name:o,size:e.fileSize,type:"video/mp4"},extension:b.default.extractFileExtension(o)};if(e.width&&e.height&&(n.dimensions={width:e.width,height:e.height}),e.localMediaThumbnailUri){const i=e.localMediaThumbnailUri,r=b.default.extractFileName(o)+"-thumbnail.jpg";n.thumbnail={file:{uri:i,name:r,size:0,type:"image/jpg"},extension:b.default.extractFileExtension(o)},e.width&&e.height&&(n.thumbnail.dimensions={width:e.width,height:e.height});const a={name:N.ScenarioName.SendVideo};return B.default.postVideoWithThumbnail(t,n,C.PostSource.ShareWith,!1,a).finally((()=>{O.default.navigateToHub(s)}))}return w.warn(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForVideo, the local media thumbnail uri is not present. causeId: "+s),c.Rejected()}return w.warn(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForVideo, no uri for the video! causeId: "+s),c.Rejected()}_getHeaderText(e){return this.props.shareMessageTitle||A.getString("ShareWithPanel.ShareWithHeader")}_getFileNameFromUrl(e){return e.substring(e.lastIndexOf("/")+1)}}t.default=Se},594011:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StaticEmoticon=void 0;const i=s(785893),o=s(496486),n=s(217041),r=s(516778),a=s(861253),l=s(139597),d=s(236974),c=s(889391),h=s(758962),u=s(258187),p=s(732183),g=s(526424),m={};function S(e){const t=h.getFrameHeight(e);return m[t]||(m[t]={image:r.Styles.createViewStyle({height:t,width:t}),placeholder:r.Styles.createViewStyle({height:t,width:t,borderRadius:t/2})}),m[t]}const f=e=>{const{themeColors:t}=(0,u.useCommonContext)(),s=r.Styles.createViewStyle({backgroundColor:t.buttonBackgroundColor},!1);return(0,i.jsx)(r.View,{style:[s,S(e.size).placeholder,e.style]})};class y extends n.ComponentBase{constructor(){super(...arguments),this._telemetry=new d.default(c.default.getS4LMessagingFeaturesNoSubscription().nativeEmoticonCacheTelemetrySampleRate,(()=>this._getEmoticonInfo(this.props)))}_getEmoticonInfo(e){return{id:e.emoticonInfo.id,size:h.getPixelSize(e.size),type:g.EmoticonType.Static,tone:e.emoticonInfo.tone,etag:e.emoticonInfo.etag}}_doPropsDiffer(e,t){return!(0,a.default)(this._getEmoticonInfo(e),this._getEmoticonInfo(t))}_buildState(e,t){const s=this._getEmoticonInfo(e);return{resultToRender:l.default.requestEmoticon((0,p.getUrl)(s),s).result}}componentDidMount(){super.componentDidMount(),this._telemetry.updateTelemetry(this.state.resultToRender)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._doPropsDiffer(e,this.props)?(this._telemetry.finishAndResetTelemetry(),this._telemetry.updateTelemetry(this.state.resultToRender)):(0,a.default)(t.resultToRender,this.state.resultToRender)||this._telemetry.updateTelemetry(this.state.resultToRender)}componentWillUnmount(){this._telemetry.finishAndResetTelemetry(),super.componentWillUnmount()}render(){if(!this.state.resultToRender||this.state.resultToRender.type!==g.ResultIconType.Final)return(e=>{if(e)return(0,i.jsx)(f,Object.assign({},e))})({size:this.props.size,style:this.props.style});const e=S(this.props.size),t=c.default.getConfigSettingsNoSubscription().images.cacheControlRequestHeader,s=o.head(this.props.emoticonInfo.shortcuts);return(0,i.jsx)(r.Image,{source:(0,p.getUrl)(this.state.resultToRender.icon),resizeMode:"cover",onLoad:this.props.onLoad,style:this.props.style?[e.image,this.props.style]:e.image,onError:this.props.onError,headers:t?{"Cache-Control":t}:void 0,title:s})}}t.StaticEmoticon=y},931847:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(217041),r=s(139889),a=s(110117),l=s(733754),d=s(135455),c=s(581760),h=s(711828),u={};class p extends n.ComponentBase{_buildState(e,t){return{imageUrl:d.getStickerUrl(e.src,d.StickerSize.ThumbLarge,!1,!0,e.etag)}}render(){let e;this.props.showPlaceholder&&(e=(0,i.jsx)(a.default,{icon:h.SkypeIcon.Sticker,color:c.Color.gray300,size:h.IconSize.size32}));const t=(0,i.jsx)(a.default,{icon:h.SkypeIcon.StickerDeleted,color:c.Color.gray300,size:h.IconSize.size32}),s=this.props.name?l.getString("AccessibilityLabel.Sticker",{stickerName:this.props.name}):l.getString("AccessibilityLabel.StickerWithoutName"),n=(d=this.props.dimension,u[d]||(u[d]={container:o.Styles.createViewStyle({width:d+4,height:d+4,margin:4},!1),stickerImage:o.Styles.createViewStyle({width:d,height:d},!1)}),u[d]);var d;return(0,i.jsx)(o.View,Object.assign({importantForAccessibility:o.Types.ImportantForAccessibility.Yes,accessibilityLabel:s},{children:(0,i.jsx)(r.default,{origin:"StickerThumbnail",style:n.stickerImage,containerStyle:n.container,altView:e,errorView:t,resizeMode:"cover",source:this.state.imageUrl},"sticker")}))}}t.default=p},703871:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderLinkAsPreview=t.renderReact=void 0;const i=s(570655),o=s(785893),n=s(823719),r=s(496486),a=s(516778),l=s(419320),d=s(217041),c=s(934339),h=s(889391),u=s(521476),p=s(392091),g=s(209841),m=s(279957),S=s(368625),f=s(248467),y=s(428553),v=s(292387),C=s(656241),_=s(796096),b=s(905531),T=s(465127),M=s(351077),I=s(671830),w=s(898278),P=s(57219),k=s(616026),A=s(247477),x=s(681959),R=s(986374),O=s(913991),L=s(913991),F=s(435521),B=s(770891),D=s(746096),E=s(685609),V=s(702781),N=s(373560),U=s(305406),j=s(491754),H=s(923944),z=s(436237),W=s(915877),G=s(540522),K=s(452859),q=s(733754),Q=s(62523),X=s(272977),$=s(424466),J=s(312762),Y=s(42036),Z=s(106658),ee=s(665047),te=s(276093),se=s(18078),ie=s(118317),oe=s(758962),ne=s(778302),re=s(571837),ae=s(500634),le=s(326143),de=s(931847),ce=s(404057),he=s(960552),ue=s(388808),pe=s(227862),ge=s(321835),me=s(581760),Se=s(311010),fe=s(711828),ye=s(680837),ve=s(460562),Ce=s(626712),_e=s(853374),be=s(5451),Te=s(753559),Me=s(519243),Ie=s(994224),we=s(140508),Pe=s(800161),ke=s(42847),Ae=s(253110),xe=Z.messageTextLineHeight,Re=oe.frameHeights.emoticons.SMALL+2,Oe=(0,W.lazyProperties)({onlyEmoticonsStyleExtraExtraLarge:()=>a.Styles.createViewStyle({margin:4,width:oe.frameHeights.emoticons.Size120+8}),onlyEmoticonsStyleExtraLarge:()=>a.Styles.createViewStyle({margin:4,width:oe.frameHeights.emoticons.Size80}),onlyEmoticonsStyleLarge:()=>a.Styles.createViewStyle({margin:4,width:oe.frameHeights.emoticons.Size40}),onlyEmoticonsStyleMedium:()=>a.Styles.createViewStyle({margin:4,width:oe.frameHeights.emoticons.Size32}),onlyEmojiStyleSmallVerticalAlign:()=>a.Styles.createTextStyle({verticalAlign:"text-bottom",marginHorizontal:2,width:oe.frameHeights.emoticons.SMALL}),onlyEmoticonsStyleSmall:()=>a.Styles.createTextStyle({paddingTop:4,paddingLeft:2,width:oe.frameHeights.emoticons.SMALL+4,height:Re,overflow:"visible"}),onlyEmoticonsStyleSmallNoText:()=>a.Styles.createTextStyle({paddingTop:0}),onlyEmojiStyleExtraExtraLarge:()=>a.Styles.createTextStyle({lineHeight:oe.frameHeights.emoticons.Size120,fontStyle:"normal",fontSize:90}),onlyEmojiStyleExtraLarge:()=>a.Styles.createTextStyle({lineHeight:oe.frameHeights.emoticons.Size80,fontStyle:"normal",fontSize:63}),onlyEmojiStyleLarge:()=>a.Styles.createTextStyle({lineHeight:oe.frameHeights.emoticons.Size40,fontStyle:"normal",fontSize:30}),onlyEmojiStyleMedium:()=>a.Styles.createTextStyle({lineHeight:oe.frameHeights.emoticons.Size32,fontStyle:"normal",fontSize:22}),onlyEmojiStyleSmall:()=>a.Styles.createTextStyle({lineHeight:oe.frameHeights.emoticons.SMALL,fontStyle:"normal",fontSize:15}),smallEmojiDesktopRenderNormalization:()=>a.Styles.createTextStyle({top:2,paddingRight:2}),horizontalPadding:()=>a.Styles.createViewStyle({paddingHorizontal:2})});class Le extends A.TransformerBase{constructor(e,t,s){super(),this._root=t,this._key=0,this.transformEditMessageMetaDataNode=this._skip,this.transformLegacyQuoteNode=this._skip,this._onExecuteAdaptiveCardAction=e=>{if(e.type!==l.Types.ActionTypes.actionOpenUrl)return;const t=e;t&&Ce.default.isUrlValid(t.url)&&(t.preview?Y.default.viewLink(t.url,w.MainRootViewId):G.openUrl(D.BrowserOrigin.AdaptiveCard,t.url,w.MainRootViewId))},this._onAdaptiveCardOpenUrlAction=e=>{Ce.default.isUrlValid(e)&&G.openUrl(D.BrowserOrigin.AdaptiveCard,e,w.MainRootViewId)},this.transformUnknownNode=this._renderChildren,this.transformTextWrapperNode=this._skip,this.transformTargetUserNode=this._skip,this.transformTargetLegacyUserNode=this._skip,this.transformTargetRoleNode=this._skip,this.transformTargetsNode=this._skip,this.transformMetaNode=this._skip,this.transformUriObjectNode=this._renderChildren,this.transformSkypeVideoMessageNode=this._renderChildren,this.transformPartNode=this._skip,this.transformEndedNode=this._skip,this.transformGuestNameUpdateTargetNode=r.identity,this._renderStringParts=(e,t)=>r.flatMap(e,((e,s)=>r.isString(e)?(0,o.jsx)(a.Text,Object.assign({style:r.compact([this._options.systemTextStyle,this._options.textOverrideStyle]),selectable:!this._useInheritedStyle&&this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},{children:e}),this._generateReactKey(t,s)):r.isArray(e)?this._renderStringParts(e):e)),this._renderArbitraryText=(e,t)=>{const s=R.decodeFromContent(e),i=r.clone(this._options);return i.textOverrideStyle=r.flatten(r.compact([i.textOverrideStyle,t])),new Le(i,this._root,this._searchStore).transform(s)},this._renderTextNode=(e,t)=>{const s=r.clone(this._options);return s.textOverrideStyle=r.flatten(r.compact([s.textOverrideStyle,t])),new Le(s,this._root,this._searchStore).transform(e)},this._formatListAsDisplayNames=e=>{const t=[];return r.each(e,((s,i)=>{t.push(this._formatAsDisplayName(s)),i!==e.length-1&&t.push((0,o.jsx)(a.Text,Object.assign({style:r.compact([this._options.regularTextStyle,this._options.textOverrideStyle]),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},{children:", "}),","+i))})),t},this._formatAsDisplayName=(e,t="")=>(0,o.jsx)(F.DisplayName,{mri:e,fallbackText:t,renderName:this._formatParticipantName},this._appendUniqueKeyValue(e)),this._formatParticipantName=e=>(0,o.jsx)(a.Text,Object.assign({style:r.compact([this._options.systemEmphasisTextStyle,this._options.textOverrideStyle]),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},{children:e}),this._appendUniqueKeyValue(e)),this._formatAtMentionParticipantName=e=>this._formatParticipantName("@"+e),this._renderMessageParts=(e,t)=>{const s=this._renderStringParts(e,t);return(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceLayoutInRTL:this._options.forceLayoutInRTL,forceDirection:!0},{children:s}),this._appendUniqueKeyValue("localizeParts"))},this._options=this._optionsWithDefaults(e),this._searchStore=s,this._useInheritedStyle=!!this._options.inheritColor}static _getDefaultOptions(e){const t=Math.round(e);if(!Le._defaultOptions[t]){const e={metadataAlign:B.MojiMetadataAlign.Left,size:B.MojiSize.Large,hideMetadata:!1};Le._defaultOptions[t]={message:void 0,onlyEmoticons:!1,numberOfEmoticons:0,onlyUnicodeEmoji:!1,numberOfUnicodeEmoji:0,processing:{},lineBreakString:"\n",renderMedia:!0,mediaPlaceholderIconColor:me.Color.gray400,blurMedia:!1,allowTextSelection:!1,allowClickableLinks:!0,regularTextStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:xe,letterSpacing:-.2,fontFamily:Se.default.fontFamily.uidDisplayRegular,color:me.Color.gray400,alignSelf:"stretch",backgroundColor:me.Color.transparent}),italicTextStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:xe,fontStyle:"italic",backgroundColor:me.Color.transparent}),boldTextStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:xe,font:Se.default.font.uiDisplaySemibold,backgroundColor:me.Color.transparent}),strikeThroughStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:xe,textDecorationLine:"line-through",backgroundColor:me.Color.transparent}),preTextStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:xe,fontFamily:Se.default.fontFamily.monospace,fontStyle:"normal"}),listStyle:a.Styles.createViewStyle({flexDirection:"column",paddingLeft:24}),nestedListStyle:a.Styles.createViewStyle({flexDirection:"column",paddingLeft:24}),listItemStyle:a.Styles.createViewStyle({flexDirection:"row",paddingLeft:0,marginBottom:0}),listItemContentStyle:a.Styles.createTextStyle({flexShrink:1,fontSize:t}),listItemPrefixStyle:a.Styles.createTextStyle({alignSelf:"flex-start",paddingRight:6,fontSize:t}),systemTextStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:xe,fontFamily:Se.default.fontFamily.uidDisplayRegular,color:me.Color.gray400}),systemEmphasisTextStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:xe,font:Se.default.font.uiDisplaySemibold,color:me.Color.gray400}),atMentionStyle:a.Styles.createTextStyle({font:Se.default.font.uiDisplaySemibold,color:me.Color.gray400}),quotedTextStyle:a.Styles.createTextStyle({color:me.Color.gray400,fontSize:t,lineHeight:xe,fontStyle:"italic"}),quoteAttributeStyle:a.Styles.createTextStyle({color:me.Color.gray400,fontSize:Se.default.controlFontSize.bodySmallDeprecated,lineHeight:18,font:Se.default.font.uiDisplayRegular}),quoteSeparatorStyle:a.Styles.createViewStyle({borderColor:me.Color.gray300,borderBottomWidth:1}),linkStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:xe,color:me.Color.white,fontFamily:Se.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),mojiBackgroundColor:me.Color.white,mojiProps:e,renderSimpleAtMentions:!1,linkedMessages:[],hasTranslation:!1,attributions:new Map}}return Le._defaultOptions[t]}_optionsWithDefaults(e){const t=e.fontSize||Se.default.controlFontSize.messageStreamItemDesktop;return r.defaults(e,Le._getDefaultOptions(t))}_renderChildren(e){return this._renderReactNodes(e.children)}_skip(){return{value:null,stopProcessing:!1,renderAsInline:!0}}_aggregateInlines(e,t,s,i,n){const l=[];let d=[];if(r.each(e,(e=>{r.isString(e)?d.push(e):(d.length&&(l.push(d.join("")),d=[]),l.push(e))})),d.length&&l.push(d.join("")),l.length>1&&!i){const e=r.flatten(r.compact([this._options.regularTextStyle,this._options.textOverrideStyle]));return s?l:r.map(l,(s=>r.isString(s)?(0,o.jsx)(a.Text,Object.assign({style:e,selectable:this._options.allowTextSelection,forceDirection:n,textBreakStrategy:"simple"},{children:s}),this._appendUniqueKeyValue(t)):s))}if(1!==l.length||!s&&r.isString(l[0])||i&&!(l[0]instanceof a.Text)){const e=r.flatten(r.compact([this._options.regularTextStyle,this._options.textOverrideStyle]));return[(0,o.jsx)(a.Text,Object.assign({ref:this._options.onSelectableText,selectable:!this._useInheritedStyle&&this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,style:e,allowFontScaling:this._options.allowFontScaling,maxContentSizeMultiplier:this._options.maxContentSizeMultiplier,forceLayoutInRTL:this._options.forceLayoutInRTL,forceDirection:n||void 0,textBreakStrategy:"simple"},{children:l}),t)]}return l}_renderReactNodes(e,t=!1,s){const i=[];let o,n=[],a=!1,l=!0;const d=e.length;for(let c=0;c<d;c++){let d;const h=e[c];if(h?(d=h.accept(this),d||(d=this._skip())):d=this._skip(),d.value&&(o=(void 0===o||o)&&d.forceDirection,d.renderAsInline?r.isArray(d.value)?n=n.concat(d.value):n.push(d.value):(l=!1,n.length>0&&(i.push(...this._aggregateInlines(n,this._appendUniqueKeyValue("inline"),t,!!s,d.forceDirection)),n=[]),i.push(d.value))),d.stopProcessing){a=!0;break}}n.length>0&&i.push(...this._aggregateInlines(n,this._appendUniqueKeyValue("inline"),t,!!s,o));let c=null;return 1===i.length?c=i[0]:i.length>1&&(c=i),{value:c,stopProcessing:a,renderAsInline:l}}_useLargeEmoticons(){const{allowLargeEmoticons:e,onlyEmoticons:t,onlyUnicodeEmoji:s,numberOfEmoticons:i,numberOfUnicodeEmoji:o}=this._options;return!!e&&(t&&i<=3||s&&o<=3)}_generateReactKey(e,...t){return this._appendUniqueKeyValue(e?e.getTag():"_")+t.join("")}_appendUniqueKeyValue(e){return this._key++,e+this._key.toString()}transform(e){return e.accept(this)}transformRootNode(e){return this._useLargeEmoticons()?this._renderReactNodes(e.children,!1,!1):this._renderReactNodes(e.children,!1,!0)}transformPlainTextNode(e){return this._renderPlainText(e.getRawText(),e)}transformHighlightedNode(e,t,s,i){if(!e.children)return{value:null,stopProcessing:!1};const n=this._renderReactNodes(e.children,!0,!1);return Object.assign(Object.assign({},n),{value:(0,o.jsx)(U.HighlightedNode,Object.assign({isPrimarySearchResult:!!t,allowTextSelection:this._options.allowTextSelection,textOverrideStyle:this._options.textOverrideStyle,isOwnMessage:!!s,isGlobalSearch:!!i},{children:n.value}),this._generateReactKey(e))})}_renderSingleLine(e,t){return{value:e,stopProcessing:!1}}_renderLineBreak(e){return this._options.trimToFirstLine?{value:null,stopProcessing:!0,renderAsInline:!0}:{value:this._options.lineBreakString,stopProcessing:!1,renderAsInline:!0}}transformAtMentionNode(e){if(!this._options.renderSimpleAtMentions)switch(this._options.processing.atMentions){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}let t=!1;const s=_e.default.unescapeXml(e.id);let i;"*"===s?t=!0:(i=I.isMri(s)?s:I.skypeIdToMri(s),se.default.isMyMri(i)&&(t=!0));const n=r.compact([this._options.regularTextStyle,this._options.textOverrideStyle,this._options.atMentionStyle,ye.default.pointerCursor]);t&&this._options.atMentionMeOverrideStyle&&n.push(this._options.atMentionMeOverrideStyle);const a=r.clone(this._options);a.textOverrideStyle=n;let l=e.children;e.isAllMention()&&(l=[J.PlainTextNode.fromPlainText(e.getLocalizedAllMention())]);const d=new Le(a,this._root,this._searchStore)._renderReactNodes(l),c=b.default.navigation().canAccessUserDetails&&!t&&!e.isInQuote();return{value:(0,o.jsx)(u.default,Object.assign({style:n,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines,allowFontScaling:this._options.allowFontScaling,maxContentSizeMultiplier:this._options.maxContentSizeMultiplier,onPressProfileMriToShow:c?i:void 0,onContextMenu:this._options.onContextMenu,onPressInterceptionCallback:this._options.onPressInterceptionCallback,renderSimpleAtMention:this._options.renderSimpleAtMentions,skipAtSymbol:e.isLegacyAtMention},{children:d.value}),this._generateReactKey(e)),stopProcessing:d.stopProcessing,renderAsInline:!0}}transformUserMriNode(e){return{value:this._formatAsDisplayName(_e.default.unescapeXml(e.mri),_e.default.unescapeXml(e.textNode.getRawText())),stopProcessing:!1,renderAsInline:!0}}transformUnicodeEmojiNode(e){const t=this._useLargeEmoticons();let s,i;switch(s=t&&1===this._options.numberOfUnicodeEmoji?this._options.singleEmoticonSize||this._options.emoticonsOnlyEmoticonSize||c.Size.ExtraExtraLarge:t?this._options.emoticonsOnlyEmoticonSize||c.Size.ExtraLarge:c.Size.Small,t&&!this._options.allowHugeEmoticons&&(s=c.Size.Large),this._unicodeEmojiColorStyle||(this._unicodeEmojiColorStyle=a.Styles.createTextStyle({color:this._options.mediaPlaceholderIconColor},!1)),s){case c.Size.Small:i=[Oe.onlyEmojiStyleSmall,this._unicodeEmojiColorStyle],i=[Oe.onlyEmojiStyleSmall,this._unicodeEmojiColorStyle,Oe.smallEmojiDesktopRenderNormalization];break;case c.Size.Medium:i=[Oe.onlyEmojiStyleMedium,this._unicodeEmojiColorStyle];break;case c.Size.Large:i=[Oe.onlyEmojiStyleLarge,this._unicodeEmojiColorStyle];break;case c.Size.ExtraLarge:i=[Oe.onlyEmojiStyleExtraLarge,this._unicodeEmojiColorStyle];break;case c.Size.ExtraExtraLarge:i=[Oe.onlyEmojiStyleExtraExtraLarge,this._unicodeEmojiColorStyle]}return{value:(0,o.jsx)(a.Text,Object.assign({style:i,selectable:this._options.allowTextSelection},{children:e.emojiTextNode.getRawText()}),this._generateReactKey(e)),stopProcessing:!1,renderAsInline:!0}}transformEmoticonNode(e){switch(this._options.processing.emoticons){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}const t=_e.default.unescapeXml(e.type),s=e.children[0].getRawText()||"",i=A.trimToFirstLineIfNeeded(s,!!this._options.trimToFirstLine),n=this._useLargeEmoticons();let r,a=[];switch(r=n&&1===this._options.numberOfEmoticons?this._options.singleEmoticonSize||this._options.emoticonsOnlyEmoticonSize||c.Size.ExtraExtraLarge:n?this._options.emoticonsOnlyEmoticonSize||c.Size.ExtraLarge:c.Size.Small,n&&!this._options.allowHugeEmoticons&&(r=c.Size.Large),r){case c.Size.Small:a=[Oe.onlyEmojiStyleSmallVerticalAlign];break;case c.Size.Medium:a=[Oe.onlyEmoticonsStyleMedium];break;case c.Size.Large:a=[Oe.onlyEmoticonsStyleLarge];break;case c.Size.ExtraLarge:a=[Oe.onlyEmoticonsStyleExtraLarge];break;case c.Size.ExtraExtraLarge:a=[Oe.onlyEmoticonsStyleExtraExtraLarge]}return{value:(0,o.jsx)(c.AnimatedEmoticon,{innerText:i.value,emoticonName:t,size:r,style:a,preventSelectable:!this._options.allowTextSelection,onlyRenderFallbackText:this._options.textOnlyForEmoticons,isStatic:this._options.forceStaticAnimatedEmoticons,allowTextFallback:this._options.allowTextFallbackEmoticons,showPlaceHolder:this._options.showPlaceholderEmoticons,placeholderBackgroundColor:this._options.placeholderBackgroundColor,fallbackTextStyle:!n&&this._options.textOverrideStyle?this._options.textOverrideStyle:void 0,tone:e.tone},this._generateReactKey(e)),stopProcessing:i.stopProcessing,renderAsInline:i.renderAsInline}}transformFlagNode(e){switch(this._options.processing.emoticons){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}return this._renderReactNodes(e.children)}transformQuoteNode(e){if(this._options.trimToFirstLine&&this._options.onlyQuotedContent){return{value:(0,o.jsx)(ae.QuoteOnly,{mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle},this._generateReactKey(e)),stopProcessing:!0,renderAsInline:!0}}switch(this._options.processing.quotes){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}const t=this._options.numberOfLines||(this._options.renderOrigin===B.MessageRenderOrigin.ChatCanvas||this._options.renderOrigin===B.MessageRenderOrigin.CallCanvas?void 0:1),s=r.clone(this._options);s.onlyEmoticons=!1,s.inheritColor=!0,s.numberOfLines=t,s.maxContentSizeMultiplier=this._options.maxContentSizeMultiplier&&Math.min(this._options.maxContentSizeMultiplier,Le._maxContentSizeMultiplierForQuotes),s.allowTextSelection=!1,s.constrainedDimensions=L.getQuoteContentNodeRenderDimensions();const i=new Le(s,this._root,this._searchStore)._renderReactNodes(e.children),n=e.author&&_e.default.unescapeXml(e.author),a=e.authorname&&_e.default.unescapeXml(e.authorname),l=this._options.renderOrigin===B.MessageRenderOrigin.MessageComposerCanvas&&e.conversation&&Ie.default.ActiveCallUIHelper.hasActiveCall(e.conversation);return{value:(0,o.jsx)(ae.QuoteNode,{children:i.value,options:this._options,conversationId:e.conversation,messageTimestamp:Number(e.messageid),numberOfLines:t||0,authorSkypeId:n,authorname:a,timestamp:1e3*e.timestamp,message:this._options.message,onContextMenu:this._options.onContextMenu,searchStore:this._searchStore,narrowView:l},this._generateReactKey(e)),stopProcessing:i.stopProcessing,renderAsInline:!1}}transformWikiMarkupNode(e){switch(this._options.processing.wikiMarkup){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}let t;switch(e.getTag()){case"i":t=this._options.italicTextStyle;break;case"b":t=this._options.boldTextStyle;break;case"s":t=this._options.strikeThroughStyle;break;case"pre":t=this._options.preTextStyle;break;default:t=this._options.regularTextStyle}const s=r.every(e.children,(e=>e instanceof J.PlainTextNode)),i=r.flatten(r.compact([this._options.textOverrideStyle,t])),n=r.clone(this._options);n.textOverrideStyle=i;const l=new Le(n,this._root,this._searchStore)._renderReactNodes(e.children,s),d={style:i,key:this._generateReactKey(e),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0};return{value:l.renderAsInline?(0,o.jsx)(a.Text,Object.assign({},d,{selectable:this._options.allowTextSelection},{children:l.value})):(0,o.jsx)(a.View,Object.assign({},d,{children:l.value})),stopProcessing:l.stopProcessing,renderAsInline:l.renderAsInline}}transformListWikiMarkupNode(e){switch(this._options.processing.wikiMarkup){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}let t;switch(e.getTag()){case"ul":case"ol":t=e.level?this._options.nestedListStyle:this._options.listStyle;break;case"li":t=this._options.listItemStyle;break;default:t=this._options.regularTextStyle}const s=e.children.every((e=>e instanceof J.PlainTextNode)),i=r.flatten([this._options.textOverrideStyle,t].filter((e=>!!e))),n=Object.assign({},this._options);if(n.textOverrideStyle=i,"li"===e.getTag())return this._renderListItem(e,n);const l=new Le(n,this._root,this._searchStore)._renderReactNodes(e.children.filter((e=>!(e instanceof J.PlainTextNode&&["\n","\r"].includes(e.getRawText())))),s),d=!["ul","ol"].includes(e.getTag())&&l.renderAsInline,c={style:i,key:this._generateReactKey(e),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},h=d?a.Text:a.View;return{value:(0,o.jsx)(h,Object.assign({},c,{children:l.value})),stopProcessing:l.stopProcessing,renderAsInline:d}}_renderListItem(e,t){const s=new Le(t,this._root,this._searchStore);let i=e.children.findIndex((e=>{var t;return["ul","ol"].includes(null!==(t=null==e?void 0:e.getTag())&&void 0!==t?t:"")})),n=null;-1===i?i=e.children.length:n=s._renderReactNodes([e.children[i]]);const r=e.children.slice(0,i),l=s._renderReactNodes(r.filter((e=>!(e instanceof J.PlainTextNode&&["\n","\r"].includes(e.getRawText()))))),d=l.renderAsInline?a.Text:a.View,c=(0,o.jsx)(d,{children:l.value}),h=e.ordered?e.order+". ":{0:"⦁ ",1:"⚬ "}[e.level||0]||"▪ ",u=s._renderReactNodes([J.PlainTextNode.fromPlainText(h)]).value;return{value:(0,o.jsxs)(a.View,{children:[(0,o.jsxs)(a.View,Object.assign({style:this._options.listItemStyle},{children:[(0,o.jsx)(a.Text,Object.assign({style:this._options.listItemPrefixStyle,selectable:!1},{children:u})),(0,o.jsx)(a.View,Object.assign({style:this._options.listItemContentStyle},{children:c}))]})),null==n?void 0:n.value]},this._generateReactKey(e)),stopProcessing:(null==n?void 0:n.stopProcessing)||l.stopProcessing,renderAsInline:!1}}transformLinkNode(e){switch(this._options.processing.links){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}const t=e.getSanitizedHref();if(!t)return this._renderReactNodes(e.children);this._useInheritedStyle=!0;const s=r.flatten(r.compact([this._options.textOverrideStyle,ye.default.pointerCursor])),i=r.clone(this._options);i.onSelectableText=void 0,i.textOverrideStyle=s;const n=new Le(i,this._root,this._searchStore)._renderReactNodes(e.children,!1);this._useInheritedStyle=!1;return{value:(0,o.jsx)(K.default,Object.assign({message:this._options.message,decodedNode:this._root,style:r.compact([this._options.linkStyle,this._options.textOverrideStyle]),url:t,messageActions:this._options.messageActions,linkSelectable:this._options.allowTextSelection,linkClickable:this._options.allowClickableLinks,numberOfLines:this._options.numberOfLines||0,supportsCopy:!!this._options.supportsCopy,onLongPress:this._options.overrideLongPressForLinks?this._options.onLongPressContent:void 0,onEdit:this._options.onEdit,onQuote:this._options.onQuote,maxContentSizeMultiplier:this._options.maxContentSizeMultiplier,renderOrigin:this._options.renderOrigin,onPressInterceptionCallback:this._options.onPressInterceptionCallback},{children:n.value}),this._generateReactKey(e)),stopProcessing:n.stopProcessing,renderAsInline:!0}}transformAttributionNode(e){var t,s;if(this._options.processing.links===B.ProcessingLevel.None)return this._skip();if(this._options.processing.links===B.ProcessingLevel.Stripped)return this._renderReactNodes(e.children);if(!e.getSanitizedHref())return this._renderReactNodes(e.children);let i;if(e.index)this._options.attributions.set(e.index,e);else{this._useInheritedStyle=!0;const t=r.flatten([this._options.textOverrideStyle,ye.default.pointerCursor].filter((e=>!!e))),s=Object.assign({},this._options);s.onSelectableText=void 0,s.textOverrideStyle=t,i=new Le(s,this._root,this._searchStore)._renderReactNodes(e.children,!1),this._useInheritedStyle=!1}return{value:(0,o.jsx)(we.AttributionNode,Object.assign({node:e,attributions:this._options.attributions,message:this._options.message,decodedNode:this._root,messageActions:this._options.messageActions,linkSelectable:this._options.allowTextSelection,linkClickable:this._options.allowClickableLinks,supportsCopy:!!this._options.supportsCopy,onLongPress:this._options.overrideLongPressForLinks?this._options.onLongPressContent:void 0,onEdit:this._options.onEdit,onQuote:this._options.onQuote,renderOrigin:this._options.renderOrigin,onPressInterceptionCallback:this._options.onPressInterceptionCallback},{children:null!==(t=null==i?void 0:i.value)&&void 0!==t?t:e.index}),this._generateReactKey(e)),stopProcessing:null!==(s=null==i?void 0:i.stopProcessing)&&void 0!==s&&s,renderAsInline:!0}}transformAttributionsTextNode(e){if(this._options.processing.links===B.ProcessingLevel.None)return this._skip();if(this._options.processing.links===B.ProcessingLevel.Stripped)return this._renderReactNodes(e.children);const t=Object.assign(Object.assign({},this._options),{textOverrideStyle:r.flatten([this._options.textOverrideStyle,a.Styles.createTextStyle({cursor:"inherit"})].filter((e=>!!e))),onSelectableText:void 0}),s=new Le(t,this._root,this._searchStore)._renderReactNodes(e.children,!1);return{value:(0,o.jsx)(ke.AttributionsTextNode,Object.assign({href:e.getSanitizedHref(),attributions:this._options.attributions,message:this._options.message,decodedNode:this._root,messageActions:this._options.messageActions,linkSelectable:this._options.allowTextSelection,linkClickable:this._options.allowClickableLinks,supportsCopy:!!this._options.supportsCopy,onLongPress:this._options.overrideLongPressForLinks?this._options.onLongPressContent:void 0,onEdit:this._options.onEdit,onQuote:this._options.onQuote,renderOrigin:this._options.renderOrigin},{children:s.value}),this._generateReactKey(e)),stopProcessing:null==s?void 0:s.stopProcessing,renderAsInline:!0}}transformAttributionsGroupNode(e){const t=Object.assign(Object.assign({},this._options),{attributions:new Map}),s=e.children.filter((e=>!(e instanceof J.PlainTextNode)||""!==e.getRawText().trim())),i=new Le(t,this._root,this._searchStore)._renderReactNodes(s,!1,!0);return t.attributions.forEach(((e,t)=>this._options.attributions.set(t,e))),Object.assign(Object.assign({},i),{value:(0,o.jsx)(a.Text,{children:i.value},this._generateReactKey(e))})}transformBingResponseNode(e){if(!h.default.getS4LMessagingFeaturesNoSubscription().enableMagicBotAttributions)return this._renderReactNodes(e.children,!1,!0);this._options.attributions=new Map;const t=this._renderReactNodes(e.children,!1,!0),s=[...this._options.attributions.entries()].sort((([e],[t])=>+e-+t)).map((e=>e[1])),i=t.renderAsInline?a.Text:a.View;return{value:(0,o.jsx)(Pe.BingResponseNode,Object.assign({attributions:s,message:this._options.message,decodedNode:this._root,messageActions:this._options.messageActions,linkSelectable:this._options.allowTextSelection,linkClickable:this._options.allowClickableLinks,supportsCopy:!!this._options.supportsCopy,onLongPress:this._options.overrideLongPressForLinks?this._options.onLongPressContent:void 0,onEdit:this._options.onEdit,onQuote:this._options.onQuote,renderOrigin:this._options.renderOrigin,onPressInterceptionCallback:this._options.onPressInterceptionCallback,numberOfLines:this._options.numberOfLines},{children:(0,o.jsx)(i,{children:t.value})}),this._generateReactKey(e)),stopProcessing:null==t?void 0:t.stopProcessing,renderAsInline:!1}}transformEmoteNode(e){const t=this._renderReactNodes(e.children,!0);return{value:[this._formatAsDisplayName(_e.default.unescapeXml(e.escapedAuthorMri),_e.default.unescapeXml(e.escapedFallbackText)),(0,o.jsx)(a.Text,Object.assign({style:r.compact([this._options.regularTextStyle,this._options.textOverrideStyle]),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,maxContentSizeMultiplier:this._options.maxContentSizeMultiplier},{children:" "}),e.escapedAuthorMri||e.escapedFallbackText)].concat(t.value),stopProcessing:t.stopProcessing,renderAsInline:!0}}transformSuggestedTextHighlightNode(e){const t=this._renderReactNodes(e.children,!0);return{value:(0,o.jsx)(he.default,Object.assign({style:r.compact([this._options.regularTextStyle,this._options.linkStyle,this._options.textOverrideStyle]),activityId:e.getActivityId(),text:e.getPhrase(),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,onHighlightedTextPressed:this._options.onPressSuggestedTextHighlight},{children:t.value}),this._generateReactKey(e)),stopProcessing:!1,renderAsInline:!0}}transformContextNode(e){return{value:null,stopProcessing:!1,renderAsInline:!0}}transformRosterContextNode(){return{value:null,stopProcessing:!0,renderAsInline:!0}}transformLocationContextNode(){return{value:null,stopProcessing:!0,renderAsInline:!0}}transformSwiftUriObjectNode(e){if(this._options.renderMedia&&e.swiftChild)return this._renderReactNodes([e.swiftChild]);const t=e.children.filter((e=>e instanceof J.AdaptiveCardNode));if(this._options.renderMedia&&t.length)return this._renderReactNodes(t);return{value:(0,o.jsx)(pe.default,{creatorMri:this._options.message.creator,message:this._options.message,mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle},this._generateReactKey(e)),stopProcessing:!1,renderAsInline:!0}}transformSwiftNode(e){const t={preview:{renderPreview:!this._options.renderMedia,numberOfLines:1,stylesOverride:this._options.textOverrideStyle,isTextSelectable:!1},message:this._options.message,isInKeyboard:this._options.isInKeyboard,leftPaddingSwiftCarousel:this._options.leftPaddingSwiftCarousel,isMobileScreenSize:this._options.isMobileScreenSize,textOverrideStyle:this._options.textOverrideStyle,renderText:(e,t)=>this._renderArbitraryText(e,t),renderReact:(e,t)=>this._renderTextNode(e,t),onSelectionPress:this._options.onSwiftCardSelectionPress,onReplyActionLink:this._options.onSwiftReplyActionLink,onSkypeUriActionLink:this._options.onSwiftSkypeUriActionLink,swiftCardState:this._options.swiftCardState,onOAuthActionLink:this._options.onOAuthActionLink,onDisableScroll:this._options.onDisableScroll,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,onContentHorizontalScroll:this._options.onContentHorizontalScroll,renderOrigin:this._options.renderOrigin,availableSpace:this._options.availableSpace};return{value:(0,o.jsx)(ue.default,{swiftMessage:e.swiftMessage,options:t,postedByCurrentUser:!this._options.message||!this._options.message.creator||se.default.isMyMri(this._options.message.creator),conversationId:e.conversationId,message:this._options.message,isActionable:!this._options.asQuoteInComposer&&!M.hasQuote(this._options.message.content)},this._generateReactKey(e)),stopProcessing:!1,renderAsInline:!1}}transformScheduledCallInviteNode(e){if(!r.isUndefined(e.canceledTimeMs))return this._skip();return{value:(0,o.jsx)(le.default,{scheduledCallId:e.scheduledCallId,isSender:e.isSender,options:this._options,renderDimensions:this._options.constrainedDimensions},this._generateReactKey(e)),stopProcessing:!1,renderAsInline:!1}}transformAdaptiveCardNode(e){const t={leftPaddingCarousel:this._options.leftPaddingSwiftCarousel,onContentHorizontalScroll:this._options.onContentHorizontalScroll},s=(0,o.jsx)(ge.default,{adaptiveCardMessage:e.adaptiveCardMessage,conversationId:e.conversationId,message:this._options.message,renderOptions:t,postedByCurrentUser:!this._options.message||!this._options.message.creator||se.default.isMyMri(this._options.message.creator),onExecuteAdaptiveCardAction:this._onExecuteAdaptiveCardAction,placeholderLoadingEnabled:!0}),i=(0,o.jsx)(Ae.AdaptiveCardNode,{adaptiveCardMessage:e.adaptiveCardMessage,onActionOpenUrl:this._onAdaptiveCardOpenUrlAction},this._generateReactKey(e));return{value:h.default.getS4LMessagingFeaturesNoSubscription().enableAdaptiveCardLibs?i:s,stopProcessing:!1,renderAsInline:!1}}transformContactNode(e){return{value:(0,o.jsx)(P.default,{tree:e,selectable:this._options.allowTextSelection,message:this._options.message,renderDimensions:this._options.constrainedDimensions||O.ContactNodeSizes.Regular,onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,isActionable:!this._options.asQuoteInComposer&&!M.hasQuote(this._options.message.content)}),stopProcessing:!1,renderAsInline:!1}}transformContactsNode(e){if(this._options.trimToFirstLine){const t=q.getString("ContentToReactTransformer.ContactCardIconPreviewLabel");return{value:this._getContentPlaceholderResult(e,fe.SkypeIcon.ContactCard,t),stopProcessing:!0,renderAsInline:!0}}const t=this._renderReactNodes(e.children,!0);return{value:(0,o.jsx)(a.View,{children:t.value},"contact-list"),stopProcessing:t.stopProcessing,renderAsInline:!1}}transformFileNode(e){return{value:(0,o.jsx)(a.Text,Object.assign({style:r.compact([this._options.systemTextStyle,this._options.textOverrideStyle]),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},{children:e.nameChild.getRawText()}),this._generateReactKey(e)),stopProcessing:!1,renderAsInline:!0}}transformFilesNode(e){const[t]=this._renderStringParts([q.getString("ContentToDisplayTransformerBase.FilesReceivedNotSupported")],e);if(this._options.trimToFirstLine)return{value:t,stopProcessing:!0,renderAsInline:!0};const s=this._renderLineBreak(e).value,i=this._renderReactNodes(e.children,!0);return{value:[t,s,(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,numberOfLines:this._options.numberOfLines||0},{children:this._renderLineBreakBetweenElements(i).value}),this._generateReactKey(e))],stopProcessing:i.stopProcessing,renderAsInline:!0}}transformSmsNode(e){const t=H.convertRawTextToInputEntities(e.smsContentUnescaped),s=H.decodeFromInput(t,!1),i=Object.assign(Object.assign({},this._options),{onlyEmoticons:s.hasOnlyEmoticonsOrWhitespaceText(),numberOfEmoticons:s.getNumberOfEmoticons(),onlyQuotedContent:s.hasOnlyQuotedContent()});return new Le(i,this._root,this._searchStore)._renderReactNodes(s.children)}transformCallerIDNode(e){return{value:(0,o.jsx)(y.default,{layoutOption:e.layoutOption}),stopProcessing:!0,renderAsInline:!1}}transformMmsNode(e){return this._renderReactNodes(e.contentNodes)}transformMojiNode(e){const t=e.getSourceUrlSanitized();let s,i=!1;return this._options.renderMedia?s=(0,o.jsx)(te.default,{src:t,borderColor:this._options.mojiBackgroundColor||me.Color.white,size:this._options.mojiProps.size,metadataPosition:this._options.mojiProps.metadataAlign,hideMetadata:this._options.mojiProps.hideMetadata,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,message:this._options.message,disableActions:this._options.disableActions,activeOpacityOverride:this._options.activeOpacityOverride},this._generateReactKey(e)):(s=this._getContentPlaceholderResult(e,fe.SkypeIcon.Moji,q.getString("ContentToReactTransformer.MojiMediaIconPreviewLabel")),i=!1),{value:s,stopProcessing:!1,renderAsInline:i}}transformStickerNode(e){const t=e.getSourceUrlSanitized();let s;return s=this._options.renderMedia?(0,o.jsx)(de.default,{src:t,showPlaceholder:!0,dimension:oe.frameHeights.stickers.Size75,name:e.getNameForUI()},this._generateReactKey(e)):this._getContentPlaceholderResult(e,fe.SkypeIcon.Sticker,q.getString("ContentToReactTransformer.StickerMediaIconPreviewLabel")),{value:s,stopProcessing:!1,renderAsInline:!1}}transformLocationNode(e){let t,s=!1;if(!this._options.renderLocation)return this._renderReactNodes(e.children);{const i=e.addressSanitized,n=!this._options.message.isForwarded()&&e.isUserLocation,r=e.userMri||this._options.message.creator;this._options.renderMedia?t=(0,o.jsx)(Q.default,{message:this._options.message,originalCreatorMri:r,isUserLocation:n,latitude:e.latitude,longitude:e.longitude,fullAddress:i,addressFriendlyName:e.addressFriendlyNameSanitized,shortAddress:e.shortAddressSanitized,bingMapsUrl:e.bingUrl,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,disableActions:this._options.disableActions,activeOpacityOverride:this._options.activeOpacityOverride},this._generateReactKey(e)):(t=(0,o.jsx)(X.default,{conversationId:this._options.message.conversationId,isUserLocation:n,address:i,authorMri:r,mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle},this._generateReactKey(e)),s=!0)}return{value:t,stopProcessing:!1,renderAsInline:s}}transformTranslationNode(e){return this._renderReactNodes([e.contentNode])}transformDataNode(e){if(e.type===ee.DataMessageContentType.TranslationSettings){const t=A.getTranslationActionString(e.content);return{value:(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},{children:t}),this._generateReactKey(e)),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}return this._renderReactNodes(e.children)}transformUriObjectFileNode(e){let t,s=!1;const i=e.getNameForUI()||q.getString("ContentToReactTransformer.FileMediaIconPreviewLabel"),n=e.getFileContentUrlSanitized();if(this._options.renderMedia)t=this._options.asQuoteInComposer||M.hasQuote(this._options.message.content)?this._getMediaPreviewItem(i,e.getFileType().toString(),e.getSizeInBytes(),n):(0,o.jsx)(V.default,{message:this._options.message,fileSubType:e.getFileSubType(),contentUrl:n,displayFilename:i,downloadFilename:e.getNameForDownload(),mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,fileSizeInBytes:e.getSizeInBytes(),onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,renderOrigin:this._options.renderOrigin,renderDimensions:this._options.constrainedDimensions||O.UndefinedDimensions,authorMri:this._options.message.creator,isUserInformationShown:this._options.showUserName||this._options.showTimestamp,disableActions:this._options.disableActions,activeOpacityOverride:this._options.activeOpacityOverride,allowTextSelection:this._options.allowTextSelection,isFileAvailable:T.isFileAvailable(this._options.message.createdTime),isDraggingEnabled:this._options.isDraggingEnabled,searchStore:this._searchStore,isActionable:!this._options.asQuoteInComposer},this._generateReactKey(e,this._options.message.cuid));else{const o=E.FileIconHelper.getIconFromFileType(i);t=this._getContentPlaceholderResult(e,o.icon,i,this._options.mediaPlaceholderIconColor?void 0:o.iconColor),s=!0}return{value:t,stopProcessing:!1,renderAsInline:s}}transformPictureNode(e){let t;const s=q.getString("ContentToReactTransformer.PhotoMediaIconPreviewLabel"),i=e.getNameForDownload()||s,n=e.getSizeInBytes(),r=e.getDisplayThumbnailUrlSanitized(this._options.blurMedia);let a=!1;return this._options.renderMedia?t=this._options.asQuoteInComposer?this._getMediaPreviewItem(i,e.getFileType().toString(),n,r):(0,o.jsx)(ne.default,{thumbnailUrl:r,showDownloadIcon:this._options.blurMedia,contentUrl:e.getDisplayUrlSanitized(),fileName:i,renderOrigin:this._options.renderOrigin,fileSizeInBytes:n,renderDimensions:this._options.constrainedDimensions||O.UndefinedDimensions,hideSendingIndicator:this._options.hideSendingIndicators,authorMri:this._options.message.creator,containerRadiusStyles:this._options.containerRadiusStyle,onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,onMountContent:this._options.onMountContent,onShowContent:this._options.onShowContent,onHideContent:this._options.onHideContent,onThumbnailLoaded:this._options.onThumbnailLoaded,activeOpacityOverride:this._options.activeOpacityOverride,disableActions:this._options.disableActions||M.hasQuote(this._options.message.content),isMessageInSendingState:this._options.isMessageInSendingState,isDraggingEnabled:this._options.isDraggingEnabled,message:this._options.message,isRetryCommandSupported:this._options.isRetryCommandSupported},this._generateReactKey(e)):(t=this._getContentPlaceholderResult(e,fe.SkypeIcon.FilePicture,s),a=!1),{value:t,stopProcessing:!1,renderAsInline:a}}transformVideoNode(e){let t,s=!1;const i=q.getString("ContentToReactTransformer.VideoMediaIconPreviewLabel"),n=e.getNameForDownload()||i,r=e.getSizeInBytes(),a=e.getDisplayThumbnailUrlSanitized(this._options.blurMedia);return this._options.renderMedia?t=this._options.asQuoteInComposer?this._getMediaPreviewItem(n,e.getFileType().toString(),r,a):(0,o.jsx)(be.default,{thumbnailUrl:a,contentUrl:e.getDisplayUrlSanitized(),fileSizeInBytes:r,renderDimensions:this._options.constrainedDimensions||O.UndefinedDimensions,authorMri:this._options.message.creator,containerStyles:this._options.containerRadiusStyle,onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,onMountContent:this._options.onMountContent,onShowContent:this._options.onShowContent,onHideContent:this._options.onHideContent,activeOpacityOverride:this._options.activeOpacityOverride,disableActions:this._options.disableActions||M.hasQuote(this._options.message.content),renderOrigin:this._options.renderOrigin,subType:e.getSubType(),isMessageInSendingState:this._options.isMessageInSendingState,message:this._options.message,isDraggingEnabled:this._options.isDraggingEnabled,isRetryCommandSupported:this._options.isRetryCommandSupported},this._generateReactKey(e)):(t=this._getContentPlaceholderResult(e,fe.SkypeIcon.FileVideo,i),s=!0),{value:t,stopProcessing:!1,renderAsInline:s}}transformVideoMessageNode(e){let t,s=!1;const i=q.getString("ContentToReactTransformer.VideoMediaIconPreviewLabel"),n=e.getNameForDownload()||i,r=e.getSizeInBytes(),a=e.getDisplayThumbnailUrlSanitized(this._options.blurMedia);if(this._options.renderMedia)t=this._options.asQuoteInComposer?this._getMediaPreviewItem(n,e.getFileType().toString(),r,a):(0,o.jsx)(be.default,{thumbnailUrl:a,contentUrl:e.getDisplayUrlSanitized(),fileSizeInBytes:r,renderDimensions:this._options.constrainedDimensions||O.UndefinedDimensions,authorMri:this._options.message.creator,containerStyles:this._options.containerRadiusStyle,renderOrigin:this._options.renderOrigin,onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,onMountContent:this._options.onMountContent,onShowContent:this._options.onShowContent,onHideContent:this._options.onHideContent,disableActions:this._options.disableActions||M.hasQuote(this._options.message.content),subType:e.getSubType(),isMessageInSendingState:this._options.isMessageInSendingState,message:this._options.message,isDraggingEnabled:this._options.isDraggingEnabled},this._generateReactKey(e));else{const o=h.default.getS4LMessagingFeaturesNoSubscription().useNewVideoMessageIcon?fe.SkypeIcon.MessageVideo:fe.SkypeIcon.Videomail;t=this._getContentPlaceholderResult(e,o,i),s=!0}return{value:t,stopProcessing:!1,renderAsInline:s}}transformAudioNode(e){let t,s=!1;return this._options.renderMedia?t=(0,o.jsx)(g.default,{shouldShowWaveForm:!1,authorMri:this._options.message.creator,contentUrl:e.getDisplayUrlSanitized(),contentExtension:Te.default.extractFileExtension(e.getNameForDownload()),displayFilename:e.getNameForUI(),fileSizeInBytes:e.getSizeInBytes(),message:this._options.message,onContextMenu:this._options.onContextMenu,onLongPress:this._options.onLongPressContent,renderDimensions:this._options.constrainedDimensions||O.UndefinedDimensions},this._generateReactKey(e)):(t=this._getContentPlaceholderResult(e,fe.SkypeIcon.VolumeMid,q.getString("ContentToReactTransformer.AudioFileMediaIconPreviewLabel")),s=!0),{value:t,stopProcessing:!1,renderAsInline:s}}transformAudioMessageNode(e){var t;let s,i=!1;return this._options.renderMedia?s=(0,o.jsx)(p.default,{shouldShowWaveForm:!0,authorMri:this._options.message.creator,contentUrl:e.getDisplayUrlSanitized(),audioTranscriptionUrl:null===(t=e.getAudioTranscritionUrlSanitized)||void 0===t?void 0:t.call(e),contentExtension:Te.default.extractFileExtension(e.getNameForDownload()),displayFilename:e.getNameForUI(),fileSizeInBytes:e.getSizeInBytes(),audioMessageDurationMs:e.getAudioDurationMs(),message:this._options.message,onLongPress:this._options.onLongPressContent,renderDimensions:this._options.constrainedDimensions||O.UndefinedDimensions},this._generateReactKey(e)):(s=this._getContentPlaceholderResult(e,fe.SkypeIcon.Microphone,q.getString("ContentToReactTransformer.AudioMessageMediaIconPreviewLabel")),i=!0),{value:s,stopProcessing:!1,renderAsInline:i}}_getContentPlaceholderResult(e,t,s,i){return(0,o.jsx)(k.ContentPlaceholder,{icon:t,label:s,iconColorOverride:i,mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle},this._generateReactKey(e,this._options.message.cuid))}_getThreadActivityParts(e,t=[]){const{authorMri:s,personMris:i}=A.getThreadActivityMemberParts(e.initiator,t);return{authorReact:this._formatAsDisplayName(s),personsReact:this._formatListAsDisplayNames(i),authorMri:s}}transformAddMemberNode(e){const t=e.content,{authorReact:s,personsReact:i,authorMri:n}=this._getThreadActivityParts(e,t),r=A.getAddMemberLocalizeInfo(s,i,i.length>0),l=[this._renderStringWithGender(r,n,e)];if(i.length>0){const t=this._renderLineBreak(e);if(!t.stopProcessing){const s=(0,o.jsx)(m.BotDisclosure,{targets:e.content,conversationId:e.conversationId,prependValue:t.value,renderBotName:this._formatParticipantName,renderAtMentionBotName:this._formatAtMentionParticipantName,renderStringParts:this._renderStringParts,textOverrideStyle:this._options.textOverrideStyle,allowTextSelection:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines},this._generateReactKey(e));l.push(s)}}const d=this._renderStringParts(l,e);return{value:(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},{children:d}),this._appendUniqueKeyValue("add")),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformDeleteMemberNode(e){const t=e.content,{authorReact:s,personsReact:i,authorMri:n}=this._getThreadActivityParts(e,t),r=I.isThread(n)?void 0:s,l=A.getDeleteMemberNodeLocalizeInfo(r,i,i.length>0),d=[this._renderStringWithGender(l,n,e)];return{value:(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},{children:d}),this._appendUniqueKeyValue("delete")),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformRoleUpdateNode(e){const t=[e.content[0]],{authorReact:s,personsReact:i,authorMri:n}=this._getThreadActivityParts(e,t),r=e.content[0].roleChild.getRawText(),l=A.getRoleUpdateNodeLocalizeInfo(s,i,r),d=[this._renderStringWithGender(l,n,e)];return{value:(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},{children:d}),this._appendUniqueKeyValue("update")),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformTopicUpdateNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=e.content.getRawText(),n=R.decodeFromContent(i),r=new Le(this._options,this._root,this._searchStore).transform(n).value,l=A.getTopicUpdateNodeLocalizeInfo(t,r),d=[this._renderStringWithGender(l,s,e)];return{value:(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},{children:d}),this._appendUniqueKeyValue("topic")),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformHandshakeInviteNode(e){const{authorReact:t,personsReact:s,authorMri:i}=this._getThreadActivityParts(e,e.content),n=se.default.isMyMri(e.initiator.getRawText()),r=A.getHandshakeInviteNodeLocalizedInfo(n?s[0]:t,n),l=[this._renderStringWithGender(r,i,e)];return{value:(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},{children:l}),this._appendUniqueKeyValue("e2eeinvite")),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformHandshakeAcceptNode(e){const{authorReact:t,personsReact:s,authorMri:i}=this._getThreadActivityParts(e,e.content),n=se.default.isMyMri(e.initiator.getRawText()),r=A.getHandshakeAcceptNodeLocalizedInfo(n?s[0]:t,n),l=[this._renderStringWithGender(r,i,e)];return{value:(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},{children:l}),this._appendUniqueKeyValue("e2eeaccept")),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformHandshakeCompleteNode(){return{value:(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},{children:q.getString("ContentToDisplayTransformerBase.E2eeInvitationConfirmed")}),this._appendUniqueKeyValue("e2eecomplete")),stopProcessing:!1,renderAsInline:!0}}transformHandshakeRejectNode(){return{value:(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},{children:q.getString("ContentToDisplayTransformerBase.E2eeInvitationRejected")}),this._appendUniqueKeyValue("e2eereject")),stopProcessing:!1,renderAsInline:!0}}transformPictureUpdateNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=A.getPictureUpdateNodeLocalizeInfo(t),n=[this._renderStringWithGender(i,s,e)];return{value:(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},{children:n}),this._appendUniqueKeyValue("picture")),stopProcessing:!1,renderAsInline:!0}}transformHistoryDisclosedUpdateNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=A.getHistoryDisclosedUpdateLocalizeInfo(t,e.nowDisclosed),n=[this._renderStringWithGender(i,s,e)];return{value:(0,o.jsx)(a.Text,Object.assign({style:[this._options.textOverrideStyle,Oe.horizontalPadding],selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},{children:n}),this._appendUniqueKeyValue("history")),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformJoiningEnabledUpdateNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=A.getJoiningEnabledUpdateNodeLocalizeInfo(t,e.nowEnabled),n=[this._renderStringWithGender(i,s,e)];return{value:(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},{children:n}),this._appendUniqueKeyValue("join")),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformLegacyMemberAddedNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=this.transformLinkNode(e.link),n=A.getLegacyMemberAddedNodeLocalizeInfo(t,i.value),r=[this._renderStringWithGender(n,s,e)];return{value:(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},{children:r}),this._appendUniqueKeyValue("add")),stopProcessing:i.stopProcessing,renderAsInline:!0,forceDirection:!0}}transformLegacyMemberUpgradedNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=A.getLegacyMemberUpgradedNodeLocalizeInfo(t),n=[this._renderStringWithGender(i,s,e)];return{value:(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},{children:n}),this._appendUniqueKeyValue("upgrade")),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}transformPartListNode(e){let t=!1;const s=_.default.calculateCallMarkerInfo(e),i=this._options.message.conversationId;let n;if(this._options.renderMedia){const t=!!this._options.message.properties&&this._options.message.properties.messagesSentDuringCall;n=(0,o.jsx)(v.default,{callId:s.callId,duration:s.duration,markerType:s.type,timestamp:this._options.message.createdTime,messagesSentDuringCall:t,conversationId:i,callerMri:this._options.message.creator,style:this._options.callMarkerStyle},this._generateReactKey(e))}else t=!0,n=(0,o.jsx)(C.CallMarkerPreview,{callId:s.callId,duration:s.duration,markerType:s.type,conversationId:i,mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle},this._generateReactKey(e));return{value:n,stopProcessing:!1,renderAsInline:t}}transformCallInfoUriObjectNode(e){let t;const s=this._options.message.creator,i="Call"===e.containerType,n=i?fe.SkypeIcon.CallStart:fe.SkypeIcon.CallQualityIndicator,r=i?q.getString("CallCard.CallStartedStatusMessage"):e.label;let l=!1;if(this._options.renderMedia){const i=this._options.message.isMessageLie()&&!this._options.message.isEphemeral();t=(0,o.jsx)(a.Button,Object.assign({onPress:this._options.onPress},{children:(0,o.jsx)(S.default,{callId:e.callId,cardType:f.CallCardType.Cast,conversationId:e.threadId,creatorMri:s,createdTime:this._options.message.createdTime,messageText:r,iconText:n,locationName:e.locationName,isPSTN:!1,isSending:i,containerRadiusStyles:this._options.containerRadiusStyle})}))}else t=this._getContentPlaceholderResult(e,n,r),l=!0;return{value:t,stopProcessing:!1,renderAsInline:l}}transformNgcUpgradeNode(e){return{value:(0,o.jsx)(ie.NgcUpgradeSystemMessageNode,{userMrisOrNames:e.userMrisOrNames,systemTextStyle:this._options.systemTextStyle,textOverrideStyle:this._options.textOverrideStyle,numberOfLines:this._options.numberOfLines}),stopProcessing:!1,renderAsInline:!0}}transformPollNode(e){let t;return t=this._options.renderMedia&&!M.hasQuote(this._options.message.content)?(0,o.jsx)(re.default,{conversationId:this._options.message.conversationId,message:this._options.message,title:_e.default.unescapeXml(e.title),expirationTimeMs:e.expirationTimeMs,options:e.options,allowMultipleVotes:e.allowMultipleVotes,isActionable:!this._options.asQuoteInComposer},this._generateReactKey(e)):this._getContentPlaceholderResult(e,fe.SkypeIcon.Poll,q.getString("Poll.PlaceholderText")),{value:t,stopProcessing:!1,renderAsInline:!1}}transformMediaAlbumNode(e){let t=null;return this._options.linkedMessages.length>1&&(t=(0,o.jsx)($.MediaAlbumNode,{linkedMessages:this._options.linkedMessages,albumId:this._options.message.getAlbumId(),onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,containerRadiusStyles:this._options.containerRadiusStyle},this._generateReactKey(e))),{value:t,stopProcessing:!1,renderAsInline:!1}}transformHtmlNode(e){let t;if(r.isUndefined(this._options.numberOfLines)&&this._options.renderMedia){let s=null;const i=this._renderReactNodes(e.children,!0);return i.value&&(s=(0,o.jsx)(a.Text,Object.assign({style:[this._options.textOverrideStyle,e.isQuote()?this._options.quotedTextStyle:void 0]},{children:i.value}))),t=[(0,o.jsx)(j.HtmlNode,{tree:e,message:this._options.message,options:this._options,renderDimensions:this._options.constrainedDimensions||O.UndefinedDimensions,createChildReact:(e,t)=>new Le(t,this._root)._renderReactNodes(e)},this._generateReactKey(e)),s],{value:t,stopProcessing:i.stopProcessing,renderAsInline:!1}}{let s=x.renderText(e);return s?(1===this._options.numberOfLines&&(s=r.split(s,"\n")[0]),t=j.HtmlNode.highlightText(e,this._options.message,s)||this._renderStringParts([s],e)):t=n.DomUtils.findOne((e=>"img"===e.name),e.getHtmlDom())?this._getContentPlaceholderResult(e,fe.SkypeIcon.FilePicture,q.getString("ContentToReactTransformer.PhotoMediaIconPreviewLabel")):"",{value:t,stopProcessing:!1,renderAsInline:!0}}}transformGuestNameUpdateNode(e){var t;const s=null===(t=r.first(e.content))||void 0===t?void 0:t.encodedAttr(),i=null==s?void 0:s.newName,n=null==s?void 0:s.oldName;return{value:i&&n?(0,o.jsx)(a.Text,Object.assign({style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0},{children:q.getString("ContentToDisplayTransformerBase.GuestNameUpdate",{oldName:n,newName:i})}),this._appendUniqueKeyValue("guestNameUpdate")):null,stopProcessing:!1,renderAsInline:!0}}_renderStringWithGender(e,t,s){return(0,o.jsx)(N.GenderLocalizedMessage,{mri:t,localizeKey:e.key,localizeParams:e.params,tree:s,renderMessage:this._renderMessageParts},this._appendUniqueKeyValue("localizedMessage"))}_getMediaPreviewItem(e,t,s,i){const n={data:{file:{uri:i,name:e,type:t,size:s},extension:Te.default.extractFileExtension(e)},uid:this._options.message.cuid,originator:D.PostSource.MessageComposer,thumbnailUrl:i};return(0,o.jsx)(Me.default,{preview:n,index:0,onItemPress:()=>{},previewMode:!0,isNavigatingWithKeyboard:!1},"key"+n.uid)}}Le._defaultOptions={},Le._maxContentSizeMultiplierForQuotes=2;let Fe=class{renderReact(e,t={},s){try{const i=r.defaults(t,{onlyEmoticons:e.hasOnlyEmoticonsOrWhitespaceText(),onlyUnicodeEmoji:e.hasOnlyUnicodeEmoji(),numberOfEmoticons:e.getNumberOfEmoticons(),numberOfUnicodeEmoji:e.getNumberOfUnicodeEmoji(),onlyQuotedContent:e.hasOnlyQuotedContent()}),o=new Le(i,e,s);return o.transform(e)}catch(e){z.error(D.LogTraceArea.GenericUnsafe,"ContentToReactTransformer: Failed to transform tree: "+ce.default.errorAsString(e))}return{value:null,renderAsInline:!1,stopProcessing:!1}}renderLinkAsPreview(e){return{renderAsInline:!1,stopProcessing:!0,value:(0,o.jsx)(ve.default,{obfuscate:e.obfuscateUrlPreview,urlPreviewData:e.urlPreviewData,urlPreviewOnly:e.urlPreviewOnly,thumbnailRadiusStyle:e.urlPreviewThumbnailRadiusStyle,style:e.containerRadiusStyle,message:e.message,onLongPress:e.onLongPressContent,renderOrigin:e.renderOrigin,activeOpacityOverride:e.activeOpacityOverride,disableActions:e.disableActions,onContextMenu:e.onContextMenu,renderDimensions:e.constrainedDimensions,searchStore:e.searchStore},"urlpreview")}}};i.__decorate([d.disableWarnings],Fe.prototype,"renderReact",null),i.__decorate([d.disableWarnings],Fe.prototype,"renderLinkAsPreview",null),Fe=i.__decorate([d.AutoSubscribeStore],Fe);const Be=new Fe;t.renderReact=Be.renderReact,t.renderLinkAsPreview=Be.renderLinkAsPreview},700960:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.highlightSearchResults=t.createQueryRegex=t.transformToHighlightedText=t.transformToHighlighted=t.SearchTermHighlightingTransformer=void 0;const i=s(785893),o=s(496486),n=s(481169),r=s(746096),a=s(305406),l=s(436237),d=s(312762),c=s(404057),h=/^\b$/;class u{constructor(e){this._options=e,this.transformRootNode=this._default,this.transformHighlightedNode=o.identity,this.transformUnknownNode=o.identity,this.transformEditMessageMetaDataNode=o.identity,this.transformUserMriNode=o.identity,this.transformFlagNode=o.identity,this.transformLegacyQuoteNode=o.identity,this.transformBingResponseNode=o.identity,this.transformAttributionsTextNode=o.identity,this.transformAttributionsGroupNode=o.identity,this.transformEmoteNode=o.identity,this.transformContextNode=o.identity,this.transformRosterContextNode=o.identity,this.transformLocationContextNode=o.identity,this.transformTextWrapperNode=o.identity,this.transformTargetUserNode=o.identity,this.transformTargetLegacyUserNode=o.identity,this.transformTargetRoleNode=o.identity,this.transformTargetsNode=o.identity,this.transformContactNode=o.identity,this.transformContactsNode=o.identity,this.transformFileNode=o.identity,this.transformFilesNode=o.identity,this.transformSmsNode=o.identity,this.transformMmsNode=o.identity,this.transformLocationNode=o.identity,this.transformMetaNode=o.identity,this.transformUriObjectNode=o.identity,this.transformUriObjectFileNode=o.identity,this.transformPictureNode=o.identity,this.transformVideoNode=o.identity,this.transformVideoMessageNode=o.identity,this.transformAudioNode=o.identity,this.transformAudioMessageNode=o.identity,this.transformCallInfoUriObjectNode=o.identity,this.transformMojiNode=o.identity,this.transformStickerNode=o.identity,this.transformSkypeVideoMessageNode=o.identity,this.transformAddMemberNode=o.identity,this.transformDeleteMemberNode=o.identity,this.transformRoleUpdateNode=o.identity,this.transformTopicUpdateNode=o.identity,this.transformHandshakeInviteNode=o.identity,this.transformHandshakeAcceptNode=o.identity,this.transformHandshakeCompleteNode=o.identity,this.transformHandshakeRejectNode=o.identity,this.transformPictureUpdateNode=o.identity,this.transformHistoryDisclosedUpdateNode=o.identity,this.transformJoiningEnabledUpdateNode=o.identity,this.transformLegacyMemberAddedNode=o.identity,this.transformLegacyMemberUpgradedNode=o.identity,this.transformPartNode=o.identity,this.transformPartListNode=o.identity,this.transformEndedNode=o.identity,this.transformSwiftUriObjectNode=o.identity,this.transformSwiftNode=o.identity,this.transformAdaptiveCardNode=o.identity,this.transformScheduledCallInviteNode=o.identity,this.transformNgcUpgradeNode=o.identity,this.transformSuggestedTextHighlightNode=o.identity,this.transformPollNode=o.identity,this.transformCallerIDNode=o.identity,this.transformMediaAlbumNode=o.identity,this.transformTranslationNode=o.identity,this.transformDataNode=o.identity,this.transformGuestNameUpdateNode=o.identity,this.transformGuestNameUpdateTargetNode=o.identity,this._keywords=g(this._options.query),this._queryRegex=m(this._keywords)}_default(e){const t=(0,n.chain)(e.children,(0,n.map)((e=>{const t=e&&e.accept(this);return t instanceof d.RootNode?o.compact(t.children):t})),(0,n.compact)(),(0,n.flatten)());return e.cloneWithChildren(t)}_parseChildren(e){return(0,n.chain)(e.children,(0,n.map)((e=>{if(!e)return[];const t=this.transform(e);return t instanceof d.RootNode?o.compact(t.children):[t]})),(0,n.flatten)())}transform(e){return 0===this._keywords.length?e:e.accept(this)}transformPlainTextNode(e){const t=e.getRawText(),s=this._parseText(t);if(1===s.length)return s[0];return d.RootNode.parse(s)}_parseText(e){return S(e,this._queryRegex,(e=>d.HighlightedNode.fromPlainText(e,this._options.isPrimarySearchResult,this._options.isOwnMessage,this._options.isGlobalSearch)),(e=>d.PlainTextNode.fromPlainText(e)))}transformAtMentionNode(e){return d.AtMentionNode.parse(this._parseChildren(e),e.encodedAttr())}transformEmoticonNode(e){const t=e.type.toLocaleLowerCase();return o.includes(this._keywords,t)?d.HighlightedNode.parse([e],this._options.isPrimarySearchResult,this._options.isOwnMessage,void 0,this._options.isGlobalSearch):e}transformUnicodeEmojiNode(e){return e.emojiTextNode}transformQuoteNode(e){return d.QuoteNode.parse(this._parseChildren(e),e.encodedAttr(),e.getTag(),void 0)}transformWikiMarkupNode(e){return d.WikiMarkupNode.parse(this._parseChildren(e),e.encodedAttr(),e.getTag())}transformListWikiMarkupNode(e){const t=d.ListWikiMarkupNode.parse(this._parseChildren(e),e.encodedAttr(),e.getTag());return null!=t?t:e}transformLinkNode(e){return d.LinkNode.parse(this._parseChildren(e),e.encodedAttr())}transformAttributionNode(e){const t=d.AttributionNode.parse(this._parseChildren(e),e.encodedAttr());return null!=t?t:e}transformHtmlNode(e){return e.cloneAsSearchResult(this._options.query,this._options.isPrimarySearchResult)}}let p;t.SearchTermHighlightingTransformer=u;function g(e){return c.default.deburrLocaleLowerCase(e.trim()).split(/[\s]+/).filter(o.negate(o.isEmpty))}function m(e){if(e.length>0){const t=o.map(e,(e=>o.escapeRegExp(e)));return new RegExp(`(${t.join("|")})`,"g")}return h}function S(e,t,s,i){const o=c.default.deburrLocaleLowerCase(e);if(-1===o.search(t))return[i(e)];const n=[];let r,a=0;for(;(r=t.exec(o))&&(a!==r.index&&n.push(i(e.substring(a,r.index))),void 0!==r.index);)a=r.index+r[0].length,n.push(s(e.substring(r.index,a),"highlight.at."+r.index));return a!==e.length&&n.push(i(e.substring(a,e.length))),t.lastIndex=0,n}function f(e){return m(g(e))}t.transformToHighlighted=S,t.transformToHighlightedText=function(e,t,s,o,n){return S(e,f(t),((e,t)=>(0,i.jsx)(a.HighlightedNode,Object.assign({isPrimarySearchResult:s,isOwnMessage:o,allowTextSelection:n},{children:e}),t)),(e=>e))},t.createQueryRegex=f,t.highlightSearchResults=function(e,t,s,i,o){try{return((e,t,s,i)=>(!p||p.query===e&&p.isPrimarySearchResult===t&&p.isOwnMessage===s||(p=void 0),p||(p={query:e,isPrimarySearchResult:t,isOwnMessage:s,transformer:new u({query:e,isPrimarySearchResult:t,isOwnMessage:s,isGlobalSearch:i})}),p.transformer))(t,s,i,o).transform(e)}catch(e){l.error(r.LogTraceArea.GenericUnsafe,"SearchTermHighlightingTransformer: Failed to transform tree: "+c.default.errorAsString(e))}return e}},253110:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AdaptiveCardNode=void 0;const i=s(785893),o=s(667294),n=s(561963),r=s(764703),a=s(868478);t.AdaptiveCardNode=({adaptiveCardMessage:e,onActionOpenUrl:t})=>{const s=(0,o.useMemo)((()=>{var t;return(0,a.transformOldToNewAdaptiveCards)(null===(t=e.attachments)||void 0===t?void 0:t[0].content)}),[e]),{hostConfig:l,containerStyle:d}=(0,n.useAdaptiveCardConfig)(),c=(0,o.useCallback)((e=>{e.url&&(null==t||t(e.url))}),[t]);return s?(0,i.jsx)(r.AdaptiveCard,{payload:s,hostConfig:l,style:d,onActionOpenUrl:c}):null}},561963:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useAdaptiveCardConfig=void 0;const i=s(667294),o=s(600212),n=s(512193),r=s(106658),a=s(311010),l=s(898278);t.useAdaptiveCardConfig=()=>{const e=(0,o.useSkypeTheme)(),t=e.themeColors.surfacePrimary,s=e.themeColors.surfacePrimaryAccent,d=e.themeColors.surfaceSecondary,c=e.themeColors.secondarySuccessForeground,h=e.themeColors.secondaryDangerBackground,u=e.themeColors.secondaryDangerBackground,p=e.themeColors.dividerPrimary,g=e.themeColors.textPrimary,m=e.themeColors.textSecondary,S=e.themeColors.textOnAccent,f=e.themeColors.surfaceSecondaryAccent,y=e.themeColors.textDanger,v=e.themeColors.textDanger,C=e.themeColors.textSuccess,_=e.themeColors.textSuccess,b=e.themeColors.textWarning,T=e.themeColors.textWarning,M=(0,i.useMemo)((()=>({default:{default:g,subtle:m},accent:{default:S,subtle:f},attention:{default:y,subtle:v},good:{default:C,subtle:_},warning:{default:b,subtle:T},light:{default:"#fff",subtle:"#eee"},dark:{default:"#000",subtle:"#777"}})),[g,m,S,f,y,v,C,_,b,T]);return{hostConfig:(0,i.useMemo)((()=>({spacing:{small:3,default:8,medium:20,large:30,extraLarge:40,padding:10},separator:{lineThickness:1,lineColor:p},supportsInteractivity:!0,fontTypes:{default:{fontFamily:a.default.fontFamily.uidDisplayRegular,fontSizes:{small:a.default.fontSize.size12,default:a.default.fontSize.size14,medium:a.default.fontSize.size17,large:a.default.fontSize.size20,extraLarge:a.default.fontSize.size26},fontWeights:{lighter:+l.FontWeight.extraLight,default:+l.FontWeight.regular,bolder:+l.FontWeight.semiBold}},monospace:{fontFamily:a.default.fontFamily.monospace,fontSizes:{small:a.default.fontSize.size12,default:a.default.fontSize.size14,medium:a.default.fontSize.size17,large:a.default.fontSize.size20,extraLarge:a.default.fontSize.size26},fontWeights:{lighter:+l.FontWeight.extraLight,default:+l.FontWeight.regular,bolder:+l.FontWeight.semiBold}}},containerStyles:{default:{backgroundColor:t,foregroundColors:M},accent:{backgroundColor:s,foregroundColors:M},emphasis:{backgroundColor:d,foregroundColors:M},good:{backgroundColor:c,foregroundColors:M},warning:{backgroundColor:u,foregroundColors:M},attention:{backgroundColor:h,foregroundColors:M}},imageSizes:{small:40,medium:80,large:160},actions:{maxActions:5,spacing:"default",buttonSpacing:0,showCard:{actionMode:"inline",inlineTopMargin:16},actionsOrientation:"horizontal",actionAlignment:"flex-start"},adaptiveCard:{allowCustomStyle:!1},imageSet:{imageSize:"medium",maxImageHeight:100},factSet:{title:{color:"default",size:"default",isSubtle:!1,weight:"bolder",wrap:!0,maxWidth:150},value:{color:"default",size:"default",isSubtle:!1,weight:"default",wrap:!0},spacing:5}})),[p,t,g,m,S,f,y,v,C,_,b,T]),themeConfig:(0,i.useMemo)((()=>({button:{backgroundColor:S},inputLabel:{color:g},radioButton:{activeColor:S,inactiveColor:g},radioButtonText:{activeColor:g,inactiveColor:g},checkBox:{activeColor:S,inactiveColor:g},checkBoxText:{activeColor:g,inactiveColor:g}})),[S,g]),containerStyle:(0,n.useSkypeStyles)((()=>({container:{flex:1,backgroundColor:t,maxWidth:r.newsChannelMediaCardMaxWidth,borderColor:p,borderStyle:"solid",borderWidth:1,borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomRightRadius:10,borderBottomLeftRadius:10,paddingBottom:12}})),[t,p]).container}}},868478:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transformOldToNewAdaptiveCards=void 0;const s={textblock:"TextBlock",image:"Image",media:"Media",mediasource:"MediaSource",captionsource:"CaptionSource",richtextblock:"RichTextBlock",textrun:"TextRun",actionset:"ActionSet",container:"Container",columnset:"ColumnSet",column:"Column",factset:"FactSet",fact:"Fact",imageset:"ImageSet",table:"Table",tablecell:"TableCell",targetelement:"TargetElement","action.openurl":"Action.OpenUrl","action.submit":"Action.Submit","action.showcard":"Action.ShowCard","action.togglevisibility":"Action.ToggleVisibility","action.execute":"Action.Execute","input.text":"Input.Text","input.number":"Input.Number","input.date":"Input.Date","input.time":"Input.Time","input.toggle":"Input.Toggle","input.choiceset":"Input.ChoiceSet","input.choice":"Input.Choice"},i=["items","facts","columns","body","actions","images","rows","cells"];t.transformOldToNewAdaptiveCards=e=>o(e);const o=e=>{var t,n;if(e){e.type&&(e.type=null!==(t=s[e.type])&&void 0!==t?t:e.type),o(e.card);for(const t of i)null===(n=e[t])||void 0===n||n.forEach(o);return e}}},446049:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ACSkypeBaseAction=void 0;const i=s(785893),o=s(22222),n=s(898278),r=s(455746);t.ACSkypeBaseAction=e=>class t extends e{constructor(){super(...arguments),this.renderReactElement=()=>(0,i.jsx)(o.default,{title:this._getTitle(),imageSource:this._getIconUrl(),onPress:()=>{this.execute()},buttonSize:n.SXButtonSize.Small,disabled:this._getDisabled(),accessibilityLabel:this._getTooltip(),buttonStyle:"positive"===this._getStyle()?n.SXButtonStyle.GradientFill:n.SXButtonStyle.ColorStroke})}get renderedElement(){return this._renderedElement}_getTitle(){return this.getValue(t.titleProperty)}_getIconUrl(){return this.getValue(t.iconUrlProperty)}_getDisabled(){return!this.getValue(t.isEnabledProperty)}_getTooltip(){return this.getValue(t.tooltipProperty)}_getStyle(){return this.getValue(t.styleProperty)}getJsonTypeName(){return t.JsonTypeName}render(){const e=(0,r.reactDomRender)(this.renderReactElement());this._renderedElement=e}}},504713:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ACSkypeChoiceSetInput=void 0;const i=s(985821);class o extends i.ChoiceSetInput{}o.JsonTypeName="Input.ChoiceSet",t.ACSkypeChoiceSetInput=o},313961:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ACSkypeDateInput=void 0;const i=s(985821);class o extends i.DateInput{}o.JsonTypeName="Input.Date",t.ACSkypeDateInput=o},457015:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ACSkypeNumberInput=void 0;const i=s(985821);class o extends i.NumberInput{}o.JsonTypeName="Input.Number",t.ACSkypeNumberInput=o},751731:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ACSkypeTextInput=void 0;const i=s(985821);class o extends i.TextInput{}o.JsonTypeName="Input.Text",t.ACSkypeTextInput=o},501294:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ACSkypeTimeInput=void 0;const i=s(985821);class o extends i.TimeInput{}o.JsonTypeName="Input.Time",t.ACSkypeTimeInput=o},228001:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ACSkypeToggleInput=void 0;const i=s(985821);class o extends i.ToggleInput{}o.JsonTypeName="Input.Toggle",t.ACSkypeToggleInput=o},455746:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.reactDomRender=void 0;const i=s(620745);t.reactDomRender=e=>{const t=document.createElement("div");return(0,i.createRoot)(t).render(e),t}},764703:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AdaptiveCard=void 0;const i=s(785893),o=s(985821),n=s(667294),r=s(281878),a=s(751731),l=s(512193),d=s(457015),c=s(313961),h=s(501294),u=s(504713),p=s(228001),g=s(446049);o.GlobalRegistry.elements.register(a.ACSkypeTextInput.JsonTypeName,a.ACSkypeTextInput),o.GlobalRegistry.elements.register(d.ACSkypeNumberInput.JsonTypeName,d.ACSkypeNumberInput),o.GlobalRegistry.elements.register(c.ACSkypeDateInput.JsonTypeName,c.ACSkypeDateInput),o.GlobalRegistry.elements.register(h.ACSkypeTimeInput.JsonTypeName,h.ACSkypeTimeInput),o.GlobalRegistry.elements.register(p.ACSkypeToggleInput.JsonTypeName,p.ACSkypeToggleInput),o.GlobalRegistry.elements.register(u.ACSkypeChoiceSetInput.JsonTypeName,u.ACSkypeChoiceSetInput),o.GlobalRegistry.actions.register(o.OpenUrlAction.JsonTypeName,(0,g.ACSkypeBaseAction)(o.OpenUrlAction)),o.GlobalRegistry.actions.register(o.SubmitAction.JsonTypeName,(0,g.ACSkypeBaseAction)(o.SubmitAction)),o.GlobalRegistry.actions.register(o.ShowCardAction.JsonTypeName,(0,g.ACSkypeBaseAction)(o.ShowCardAction)),o.GlobalRegistry.actions.register(o.ExecuteAction.JsonTypeName,(0,g.ACSkypeBaseAction)(o.ExecuteAction)),o.GlobalRegistry.actions.register(o.ToggleVisibilityAction.JsonTypeName,(0,g.ACSkypeBaseAction)(o.ToggleVisibilityAction));t.AdaptiveCard=({payload:e,style:t,hostConfig:s,onActionSubmit:a,onActionOpenUrl:d,onActionShowCard:c,onActionToggleVisibility:h,onActionExecute:u,onActionUnknown:p,onError:g})=>{const m=(0,n.useRef)(new o.AdaptiveCard),S=(({onActionSubmit:e,onActionOpenUrl:t,onActionShowCard:s,onActionToggleVisibility:i,onActionExecute:r,onActionUnknown:a})=>(0,n.useCallback)((n=>{const l=n.getJsonTypeName(),d={[o.OpenUrlAction.JsonTypeName]:[t,e=>{window.open(e.url,"_blank")}],[o.SubmitAction.JsonTypeName]:[e],[o.ShowCardAction.JsonTypeName]:[s],[o.ToggleVisibilityAction.JsonTypeName]:[i],[o.ExecuteAction.JsonTypeName]:[r]}[l]||[a];for(const e of d)if(e){e(n);break}}),[t,e,s,i,r,a]))({onActionSubmit:a,onActionOpenUrl:d,onActionShowCard:c,onActionToggleVisibility:h,onActionExecute:u,onActionUnknown:p});(0,n.useEffect)((()=>{m.current.onExecuteAction=S}),[S]),(0,n.useEffect)((()=>{m.current.hostConfig=new o.HostConfig(s)}),[s]);const{targetRef:f,error:y}=((e,t)=>{const[s,i]=(0,n.useState)(),o=(0,n.useRef)(null);return(0,n.useEffect)((()=>{if(!o.current)return;const s=e;try{s.parse(t);const e=s.render(),i="";o.current.innerHTML=i,o.current.appendChild(e)}catch(e){i(e)}}),[e,t,e.hostConfig]),{targetRef:o,error:s}})(m.current,e);(0,n.useEffect)((()=>{y&&g&&g(y)}),[y,g]);const{error:v}=(0,l.useSkypeStyles)((e=>({error:{color:e.themeColors.textDanger}})),[]);return y?(0,i.jsx)(r.Box,Object.assign({style:v},{children:y.message})):(0,i.jsx)(r.Box,{style:t,ref:f})}},521476:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(677381),r=s(746096),a=s(436237),l=s(104735),d=s(853374);class c extends n.default{constructor(){super(...arguments),this._showProfile=()=>{const e=d.default.newCauseId();a.log(r.LogTraceArea.Navigation,"AtMentionNode._showProfile, causeId: "+e);const t=this.props.onPressProfileMriToShow;t&&l.default.showDetailsPanelWithParams({mri:t,rootViewId:this._getRootViewId(),causeId:e})}}render(){const{style:e,selectable:t,numberOfLines:s=0,allowFontScaling:n,onContextMenu:r,children:a,skipAtSymbol:l,maxContentSizeMultiplier:d,onPressProfileMriToShow:c,onPressInterceptionCallback:h,renderSimpleAtMention:u}=this.props,p={style:e,selectable:t,numberOfLines:s,allowFontScaling:n,maxContentSizeMultiplier:d},g=l?null:"@";return c&&!u&&(p.onPress=h||this._showProfile,p.onContextMenu=r),(0,i.jsxs)(o.Text,Object.assign({},p,{children:[g,a]}))}}t.default=c},392091:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(209841);class o extends i.default{renderFileInformationOnStop(){return!1}willRenderTranscription(){return!0}isAudioFile(){return!1}}t.default=o},209841:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(496486),r=s(681806),a=s(746096),l=s(915877),d=s(18078),c=s(536150),h=s(581760),u=s(24576),p=s(163841),g=s(418037),m=s(465915),S=s(226593),f=s(110117),y=s(711828),v=s(680837),C=s(552115),_=s(685609),b=s(889391),T=(0,l.lazyProperties)({controlsContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",flexDirection:"column",justifyContent:"center",backgroundColor:h.Color.transparent}),progressContainer:()=>o.Styles.createViewStyle({width:120}),highContrastContainer:()=>o.Styles.createViewStyle({borderWidth:1}),controlContainerForRedesign:()=>o.Styles.createViewStyle({justifyContent:"center",flexDirection:"column",flex:1,paddingTop:12,paddingHorizontal:4}),fileIconContainerForRedesign:()=>o.Styles.createViewStyle({position:"relative"}),contentContainerForRedesign:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingTop:10,paddingBottom:2}),fileTypeIconPaddingForRedesign:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"center"}),playIconForRedesign:()=>o.Styles.createViewStyle({padding:0,paddingRight:8}),playerContainerForRedesign:()=>o.Styles.createViewStyle({flex:0}),fileName:()=>o.Styles.createTextStyle({fontWeight:"500",fontSize:15,lineHeight:20}),fileMetaSection:()=>o.Styles.createTextStyle({fontSize:12,flexDirection:"row",alignItems:"center"}),fileMetaText:()=>o.Styles.createTextStyle({fontSize:12,fontWeight:"400"}),fileMetaSeparator:()=>o.Styles.createViewStyle({width:1,height:12,marginHorizontal:6})});class M extends u.default{constructor(){super(...arguments),this._onPress=e=>{e.stopPropagation(),this._audioPlayer&&this.isComponentMounted()&&this._audioPlayer.onPausePlay()},this._onAudioPlayerRef=e=>{this._audioPlayer=e||void 0}}_buildState(e,t){const s=g.default.colorTheme(),i=g.default.flipBubbleColors(),o=g.default.isDarkTheme(),n=g.default.isAccessibleTheme(),r=d.default.isMyMri(e.authorMri),a=m.default.getTranscriptVTTMap(),l=m.default.getProgressInSeconds(),h=m.default.getCurrentTranscriptionUrl(),{enableMediaFileRedesign:u,enableAudioMessageWaveAndSpeed:S}=b.default.getS4LMessagingFeatures();let f=!1;return r?f=!o&&!i:(s===p.Theme.AccessibleDark||this._currentTheme===p.Theme.Delphi||i&&!o&&!n)&&(f=!0),f=!o,{currentTranscriptionUrl:h,progressInSeconds:l,transcriptionVTTMap:a,isMyMri:r,hasLightBackground:f,enableMediaFileRedesign:u,enableAudioMessageWaveAndSpeed:S,isMobileScreenReaderEnabled:c.default.isMobileScreenReaderEnabled()}}componentWillUnmount(){super.componentWillUnmount(),m.default.clearTranscriptVTT()}render(){let e,t;const s=[],l=[T.controlsContainer],d=_.FileIconHelper.getIconFromFileType(this.props.displayFilename),c=[T.fileMetaText,o.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1)],u=[T.fileMetaSeparator,o.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.textPrimary},!1)];return this._useAccessibleTheme()&&s.push(T.highContrastContainer,o.Styles.createViewStyle({borderColor:this._themeColors.textPrimary},!1)),e=this.state.hasLightBackground?{iconColor:this._themeColors.iconPrimary,iconHoverColor:h.Color.gray300,progressContainerStyle:[T.progressContainer],progressTrackColor:this._themeColors.surfaceInteractiveFill,progressBarColor:this._themeColors.surfaceInteractive,timerColor:this._themeColors.textPrimary,fileNameColor:this._themeColors.textPrimary,progressTrackStyle:s}:{iconColor:h.Color.white,iconHoverColor:h.Color.gray200,progressContainerStyle:[T.progressContainer],progressTrackColor:this._themeColors.surfaceInteractiveFill,progressBarColor:this._themeColors.surfaceInteractive,timerColor:this._themeColors.textPrimary,fileNameColor:this._themeColors.textPrimary,progressTrackStyle:s},this.state.enableMediaFileRedesign&&this.isAudioFile()?t=(0,i.jsxs)(o.View,Object.assign({style:[T.controlContainerForRedesign,{width:this.props.renderDimensions.width}],title:this.props.displayFilename},{children:[(0,i.jsx)(o.View,Object.assign({style:T.fileIconContainerForRedesign},{children:(0,i.jsx)(f.default,{icon:y.SkypeIcon.FileAudioBig,size:y.IconSize.size64,color:h.Color.transparent,style:T.fileTypeIconPaddingForRedesign})})),(0,i.jsxs)(o.View,Object.assign({style:T.contentContainerForRedesign},{children:[(0,i.jsx)(r.default,{origin:a.AudioPlayerOrigin.AudioNode,contentUrl:this.props.contentUrl,contentExtension:this.props.contentExtension,ref:this._onAudioPlayerRef,displayFilename:this.props.displayFilename,fileSizeInBytes:this.props.fileSizeInBytes,defaultDurationMs:this.props.audioMessageDurationMs,autoloop:!1,style:T.playerContainerForRedesign,playerStyles:Object.assign(Object.assign({},e),{iconStyle:[T.playIconForRedesign]}),renderInformationOnstop:this.renderFileInformationOnStop(),message:this.props.message,shouldShowWaveForm:this.props.shouldShowWaveForm,hidePlayerInfo:!0}),(0,i.jsxs)(o.View,Object.assign({style:v.default.flexOne},{children:[(0,i.jsx)(o.Text,Object.assign({style:[v.default.flexOne,T.fileName,{paddingRight:this.state.enableAudioMessageWaveAndSpeed?8:0,color:this._getContext().themeColors.textPrimary}],ellipsizeMode:"middle",numberOfLines:1},{children:this.props.displayFilename})),(0,i.jsxs)(o.View,Object.assign({style:T.fileMetaSection},{children:[(0,i.jsx)(o.Text,Object.assign({style:c,numberOfLines:1},{children:C.default.formatFileSize(this.props.fileSizeInBytes,1).formattedString})),(0,i.jsx)(o.View,{style:u}),(0,i.jsx)(o.Text,Object.assign({style:c,numberOfLines:1},{children:n.capitalize(d.displayString)}))]}))]}))]}))]})):(l.push({paddingRight:12}),t=(0,i.jsxs)(o.View,{children:[(0,i.jsx)(r.default,{origin:a.AudioPlayerOrigin.AudioNode,contentUrl:this.props.contentUrl,contentExtension:this.props.contentExtension,ref:this._onAudioPlayerRef,displayFilename:this.props.displayFilename,fileSizeInBytes:this.props.fileSizeInBytes,defaultDurationMs:this.props.audioMessageDurationMs,autoloop:!1,playerStyles:e,renderInformationOnstop:this.renderFileInformationOnStop(),message:this.props.message,audioTranscriptionUrl:this.props.audioTranscriptionUrl,willRenderTranscription:this.willRenderTranscription(),shouldShowWaveForm:this.props.shouldShowWaveForm}),(0,i.jsx)(S.default,{transcriptionVTTMap:this.state.transcriptionVTTMap,progressInSeconds:this.state.progressInSeconds,transcriptionUrl:this.props.audioTranscriptionUrl,currentTranscriptionUrl:this.state.currentTranscriptionUrl})]})),(0,i.jsx)(o.View,Object.assign({style:l,onPress:this.state.isMobileScreenReaderEnabled?this._onPress:void 0,importantForAccessibility:void 0,onLongPress:this.props.onLongPress,onContextMenu:this.props.onContextMenu},{children:t}))}renderFileInformationOnStop(){return!0}willRenderTranscription(){return!1}isAudioFile(){return!0}}t.default=M},50719:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useAudioTranscriptionTextColor=void 0;const i=s(600212);t.useAudioTranscriptionTextColor=()=>{const{themeColors:{textOnAccent:e,textPrimary:t,textSecondary:s}}=(0,i.useSkypeTheme)();return(i,o,n)=>n<i?s:n>=i&&n<=o?e:t}},226593:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(705465),n=s(667294),r=s(733754),a=s(265976),l=s(50719),d=s(512193),c=s(898278),h=s(915415),u=s(600212),p=o.StyleSheet.create({transcriptionWrapper:{paddingLeft:16,width:236},textWrapper:{marginBottom:8},textItem:{flexWrap:"wrap",fontSize:13,lineHeight:18},spinnerContainer:{flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center"}});t.default=e=>{const{transcriptionVTTMap:t,transcriptionUrl:s,currentTranscriptionUrl:g,progressInSeconds:m}=e,S=(0,l.useAudioTranscriptionTextColor)(),[f,y]=(0,n.useState)(),{themeColors:v}=(0,u.useSkypeTheme)();(0,n.useEffect)((()=>{const e=(0,a.extractAmsDocumentIdFromUrl)(s),i=t.get(e);i&&y(i)}),[s,t,g,m]);const{devideLineStyles:C,textTitleStyles:_}=(0,d.useSkypeStyles)((({themeColors:e})=>({devideLineStyles:{backgroundColor:e.surfaceOnAccent,height:1,marginBottom:16},textTitleStyles:{fontSize:13,lineHeight:18,color:e.textPrimary}})),[]);return f?(0,i.jsxs)(o.View,Object.assign({style:p.transcriptionWrapper},{children:[(0,i.jsx)(o.View,{style:C}),f.isTranscribing?(0,i.jsx)(o.View,Object.assign({style:p.spinnerContainer},{children:(0,i.jsx)(h.default,{size:c.SXActivityIndicatorSize.Small,tintColor:v.textPrimary,deferTimeMs:0})})):(0,i.jsxs)(o.View,{children:[(0,i.jsx)(o.Text,Object.assign({style:_},{children:f.isValid?`${r.getString("AudioMessageComposer.AudioMessageTranscriptionHeader")}:`:`[${r.getString("AudioMessageComposer.AudioMessageTranscriptionFailHint")}]`})),f.isValid&&(0,i.jsx)(o.View,Object.assign({style:p.textWrapper},{children:f.cues.map(((e,t)=>{if("cue"===e.type){const{start:s,end:n,text:r}=e.data;return(0,i.jsx)(o.Text,Object.assign({style:[p.textItem,{color:S(s,n,1e3*f.progressInSeconds)}]},{children:r}),t)}return null}))}))]})]})):null}},279957:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BotDisclosure=t.getBotsForDisclosure=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(217041),a=s(573208),l=s(1706),d=s(481169),c=s(671830),h=s(247477),u=s(539549),p=s(18078),g=s(846116);function m(e,t,s,i){const n=o.some(e,(e=>p.default.isMyMri(e.getRawText())));let r=[];if(n){const e=(0,u.default)().getConversation(t);e&&(r=o.filter(e.getMemberMris(),(e=>c.isAgent(e))))}else r=(0,d.chain)(e,(0,d.map)((e=>e.getRawText())),(0,d.filter)((e=>c.isAgent(e))));const h=[],m=[];return o.each(r,(e=>{const t=l.default.getAgentDescriptionForMri(e),o=a.default.canListenToAllMessages(t.disclosures),r=t.displayName,d=(0,g.getMagicBotId)()===e;if(o)h.push(s(r));else{const e={botName:s(r),atMentionBotName:i(r),isMagicBot:d,isMe:n};m.push(e)}})),{allMessagesBotsFormatted:h,atMentionOnlyBotsFormatted:m}}t.getBotsForDisclosure=m;class S extends r.ComponentBase{_buildState(e,t){return m(e.targets,e.conversationId,e.renderBotName,e.renderAtMentionBotName)}render(){const{allMessagesBotsFormatted:e,atMentionOnlyBotsFormatted:t}=this.state;if(e.length>0||t.length>0){const s=h.renderBotDisclosureParts(e,t);this.props.prependValue&&s.unshift(this.props.prependValue);const o=this.props.renderStringParts(s);return(0,i.jsx)(n.Text,Object.assign({style:this.props.textOverrideStyle,selectable:this.props.allowTextSelection,numberOfLines:this.props.numberOfLines||0},{children:o}),"BotDisclosure")}return(0,i.jsx)(n.Text,{})}}t.BotDisclosure=S},332832:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallInviteNodeBase=void 0;const i=s(785893),o=s(516778),n=s(816402),r=s(746096),a=s(110117),l=s(436237),d=s(915877),c=s(733754),h=s(106658),u=s(29130),p=s(34273),g=s(279829),m=s(71987),S=s(581760),f=s(711828),y=s(680837),v=s(619675),C=s(24576),_=s(853374),b=(0,d.lazyProperties)({backgroundContainer:()=>o.Styles.createViewStyle({paddingTop:15,borderRadius:8,flex:1}),callInfo:()=>(0,d.lazyProperties)({wrapper:()=>o.Styles.createViewStyle({marginLeft:15,marginRight:15,overflow:"visible"}),wrapperV2:()=>y.default.alignItemsCenter,subject:()=>o.Styles.createTextStyle({marginTop:8,marginBottom:2}),datetime:()=>o.Styles.createTextStyle({marginTop:8,marginBottom:10}),calendarIcon:()=>o.Styles.createViewStyle({marginTop:5,marginRight:5,marginBottom:5,top:1}),calendarIconWrapper:()=>o.Styles.createViewStyle({height:f.IconSize.size32,width:f.IconSize.size32,alignItems:"center",justifyContent:"center",borderRadius:f.IconSize.size32,paddingLeft:3})}),statusIcon:()=>o.Styles.createViewStyle({margin:5})});class T extends C.default{constructor(){super(...arguments),this._onPress=()=>{const e=_.default.newCauseId();l.log(r.LogTraceArea.ScheduleCall,"CallInviteNodeBase._onPress causeId: "+e),p.default.NavigationActions.navigateToScheduledOverviewPanel({entryPoint:g.ScheduleCallEntryPoint.MessageStream,scheduledCallId:this.props.scheduledCall.id},this._getRootViewId())},this._getHeaderRef=e=>{this._headerRef=e}}_buildState(e,t){const s={};if(e.renderDimensions)s.cardWidth=e.renderDimensions.width;else if(e.messagePadding){const t=this._getRootViewId(),i=u.default.getWidth(t),o=u.default.isSmallDevice(t);s.cardWidth=o?i-e.messagePadding:h.adaptiveCardMessageFixedWidth}else s.cardWidth=h.adaptiveCardMessageFixedWidth;return s.accessibilityResumeLabel=m.default.getAccessibilityLabelForScheduledCall(e.scheduledCall),s}render(){const e=o.Styles.createViewStyle({width:this.state.cardWidth},!1),t=[b.backgroundContainer,this._themeStyles.cardColorStyle,y.default.pointerCursor,e],s=n.default.getConditionalDateTimeString(this.props.scheduledCall.datetimeMs);let r=S.Color.blue;const l=[b.callInfo.calendarIconWrapper];l.push(o.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfaceInteractive},!1)),r=this._getContext().themeColors.iconOnColor;const d=(0,i.jsxs)(o.Button,Object.assign({style:[b.callInfo.wrapper,b.callInfo.wrapperV2],importantForAccessibility:o.Types.ImportantForAccessibility.Yes,onPress:this._onPress,onLongPress:this.props.onLongPress,accessibilityTraits:o.Types.AccessibilityTrait.Button,accessibilityLabel:this.state.accessibilityResumeLabel,ref:this._getHeaderRef},{children:[(0,i.jsx)(o.View,Object.assign({style:l},{children:(0,i.jsx)(a.default,{icon:f.SkypeIcon.Schedule,size:f.IconSize.size18,color:r,style:b.callInfo.calendarIcon})})),(0,i.jsx)(v.CardTitle,Object.assign({numberOfLines:2,style:[b.callInfo.subject,this._themeStyles.headerTextColorStyle]},{children:m.default.getScheduledCallSubject(this.props.scheduledCall.subject)})),(0,i.jsx)(v.Caption,{children:c.getString("ContentToReactTransformer.ScheduledCallPreviewLabel")}),(0,i.jsx)(v.Caption,Object.assign({numberOfLines:2,style:b.callInfo.datetime},{children:s}))]}));return(0,i.jsxs)(o.View,Object.assign({style:t},{children:[d,this.renderContent()]}))}getTextAndIconForStatus(e,t){let s,o;switch(e){case g.ScheduledCallInvitationStatus.Unknown:s=c.getString("ScheduledCallCard.InvitedStatus");break;case g.ScheduledCallInvitationStatus.Accepted:s=c.getString("ScheduledCallCard.AcceptedStatus"),o=(0,i.jsx)(a.default,Object.assign({size:f.IconSize.size16,style:b.statusIcon},this.getIconPropsForStatus(e,t)),"icon");break;case g.ScheduledCallInvitationStatus.Declined:s=c.getString("ScheduledCallCard.DeclinedStatus"),o=(0,i.jsx)(a.default,Object.assign({size:f.IconSize.size16,style:b.statusIcon},this.getIconPropsForStatus(e,t)),"icon");break;default:return _.default.switchStatementExhaustiveChecking(e)}return{statusText:s,optionalIcon:o}}getIconPropsForStatus(e,t){switch(e){case g.ScheduledCallInvitationStatus.Accepted:return{icon:f.SkypeIcon.Ok,color:t?this._themeColors.secondaryTextColor:S.Color.green};case g.ScheduledCallInvitationStatus.Declined:return{icon:f.SkypeIcon.Cancel,color:t?this._themeColors.secondaryTextColor:S.Color.red};default:return _.default.switchStatementExhaustiveChecking(e)}}}t.CallInviteNodeBase=T},74775:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(332832),r=s(587134),a=s(110117),l=s(915877),d=s(733754),c=s(18078),h=s(279829),u=s(311010),p=s(711828),g=(0,l.lazyProperties)({responseStatus:()=>(0,l.lazyProperties)({responseButtonsContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"stretch",justifyContent:"space-around",overflow:"visible",height:44}),responseButton:()=>o.Styles.createButtonStyle({flex:1,alignItems:"center"}),inviteeStatus:()=>o.Styles.createViewStyle({flexGrow:1,flexShrink:0,flexDirection:"row",alignItems:"center",justifyContent:"center",height:44,paddingHorizontal:15})}),verticalDivider:()=>o.Styles.createViewStyle({width:1,height:44})});class m extends n.CallInviteNodeBase{constructor(){super(...arguments),this._onAccept=e=>{e.stopPropagation(),this.props.onCallInviteAccepted(this.props.scheduledCall.id,this.state.mySkypeMri),this._headerRef&&this._headerRef.requestFocus()},this._onDecline=e=>{e.stopPropagation(),this.props.onCallInviteDeclined(this.props.scheduledCall.id,this.state.mySkypeMri),this._headerRef&&this._headerRef.requestFocus()}}_buildState(e,t){const s=super._buildState(e,t);s.mySkypeMri=c.default.getSkypeMri();const i=e.scheduledCall.invitations[s.mySkypeMri];return i&&(t||!t&&i.invitationStatus!==h.ScheduledCallInvitationStatus.Unknown)&&(s.responseStatus=i.invitationStatus||h.ScheduledCallInvitationStatus.Unknown),s}renderContent(){let e;return this.state.responseStatus===h.ScheduledCallInvitationStatus.Unknown?e=this._renderResponseButtons():this.state.responseStatus&&(e=this._renderResponseStatus(this.state.responseStatus)),[(0,i.jsx)(r.default,{style:this._themeStyles.messageStreamBackgroundColorStyle},"divider"),(0,i.jsx)(o.View,{children:e},"invite_status")]}_renderResponseButtons(){return(0,i.jsxs)(o.View,Object.assign({style:g.responseStatus.responseButtonsContainer},{children:[(0,i.jsx)(o.Button,Object.assign({onPress:this._onAccept,accessibilityLabel:d.getString("ScheduledCallCard.AcceptButton"),style:g.responseStatus.responseButton},{children:(0,i.jsx)(a.default,Object.assign({size:p.IconSize.size24},this.getIconPropsForStatus(h.ScheduledCallInvitationStatus.Accepted)),"accept")})),(0,i.jsx)(r.default,{style:[g.verticalDivider,this._themeStyles.messageStreamBackgroundColorStyle]},"buttonDivider"),(0,i.jsx)(o.Button,Object.assign({onPress:this._onDecline,accessibilityLabel:d.getString("ScheduledCallCard.DeclineButton"),style:g.responseStatus.responseButton},{children:(0,i.jsx)(a.default,Object.assign({size:p.IconSize.size24},this.getIconPropsForStatus(h.ScheduledCallInvitationStatus.Declined)),"decline")}))]}))}_renderResponseStatus(e){const{statusText:t,optionalIcon:s}=this.getTextAndIconForStatus(e);return(0,i.jsxs)(o.View,Object.assign({style:g.responseStatus.inviteeStatus},{children:[s,(0,i.jsx)(o.Text,Object.assign({importantForAccessibility:o.Types.ImportantForAccessibility.No,style:[u.default.fontStyle.tertiaryButton,this._themeStyles.primaryTextColorStyle]},{children:t}))]}))}}t.default=m},766265:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(332832),a=s(952262),l=s(587134),d=s(915877),c=s(50361),h=s(279829),u=s(581760),p=s(567977),g=(0,d.lazyProperties)({dividerDark:()=>n.Styles.createViewStyle({backgroundColor:u.Color.gray300}),avatars:()=>n.Styles.createViewStyle({margin:10})});class m extends r.CallInviteNodeBase{_buildState(e,t){const s=super._buildState(e,t),i=[];return o.each(e.scheduledCall.invitations,((e,t)=>{i.push({name:a.default.getDisplayName(t),status:e.invitationStatus||h.ScheduledCallInvitationStatus.Unknown,skypeId:t})})),s.invitees=i,s}renderContent(){return[(0,i.jsx)(l.default,{marginLeft:15,marginRight:15,style:this._useDarkTheme()?g.dividerDark:this._themeStyles.dividerColorStyle},"divider"),(0,i.jsx)(c.default,{shouldUseInvitationStatusToFilter:!0,shouldShowFilteredStatusAsLabel:!0,style:g.avatars,avatarSize:p.UserIconSize.Size24,avatarBorderWidth:0,invitations:this.props.scheduledCall.invitations},"invitees-avatar-list")]}}t.default=m},656241:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallMarkerPreview=void 0;const i=s(785893),o=s(516778),n=s(217041),r=s(325489),a=s(796096),l=s(671830),d=s(110117),c=s(915877),h=s(581760),u=(0,c.lazyProperties)({contentPlaceholderContainer:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",marginBottom:-2,width:20,height:16}),contentPlaceholderPadding:()=>o.Styles.createViewStyle({paddingRight:4})});class p extends n.ComponentBase{_buildState(e,t){const s=r.default.getCallLog(e.callId),i=a.default.calculateCallMarkerInfoFromPath(s,e.callId,e.conversationId,e.markerType,e.duration);return{markerType:i.type,duration:i.duration}}render(){const e=[this.props.regularTextStyle,this.props.textOverrideStyle],t=u.contentPlaceholderPadding,s=a.CallMarkerDisplayUtils.getIcon(this.state.markerType),n=(0,i.jsx)(o.View,Object.assign({style:u.contentPlaceholderContainer},{children:(0,i.jsx)(d.default,{icon:s,size:16,color:this.props.mediaPlaceholderIconColor?this.props.mediaPlaceholderIconColor:h.Color.white,style:t})}),"placeholderIcon"),r=this.state.markerType,c=this.props.conversationId,p=c&&l.isEncryptedThread(c)?a.CallMarkerDisplayUtils.getTextForEncryptedThread(r,this.state.duration):a.CallMarkerDisplayUtils.getText(r,this.state.duration);return(0,i.jsxs)(o.Text,Object.assign({style:e,ellipsizeMode:"middle"},{children:[n,p]}))}}t.CallMarkerPreview=p},57219:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(905531),r=s(671830),a=s(913991),l=s(746096),d=s(314299),c=s(436237),h=s(915877),u=s(733754),p=s(451072),g=s(633596),m=s(812056),S=s(18078),f=s(104735),y=s(527683),v=s(581760),C=s(478262),_=s(619675),b=s(24576),T=s(702301),M=s(567977),I=s(853374),w=a.contactNodeHeight,P=(0,h.lazyProperties)({contactCardContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",borderStyle:"solid",borderRadius:10}),senderBorderRadius:()=>o.Styles.createViewStyle({borderBottomRightRadius:0}),recieverBorderRadius:()=>o.Styles.createViewStyle({borderTopLeftRadius:0}),dataContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center",justifyContent:"flex-start",marginTop:8}),textContainer:()=>o.Styles.createViewStyle({flex:-1,flexDirection:"column",alignItems:"center",marginTop:10}),fullName:()=>o.Styles.createTextStyle({flex:-1,lineHeight:22,paddingBottom:5,paddingHorizontal:10}),skypeId:()=>o.Styles.createTextStyle({flex:-1,lineHeight:16,paddingHorizontal:10}),btnContainer:()=>o.Styles.createViewStyle({paddingVertical:15,borderStyle:"solid",borderTopWidth:2,paddingHorizontal:12}),btnText:()=>o.Styles.createTextStyle({textAlign:"center"}),textWrapper:()=>o.Styles.createViewStyle({flex:0,flexDirection:"row"})});class k extends b.default{constructor(){super(...arguments),this._onPress=()=>{const e=I.default.newCauseId();c.log(l.LogTraceArea.Navigation,"ContactNode._onPress, causeId: "+e),n.default.contacts().canHaveContacts?f.default.navigateToConversation({convId:this.state.contactUserMri,origin:l.NavigationConversationOrigin.SharedContactCard,causeId:e}):f.default.navigateToGuestUpsell(d.GuestUpsellType.LeaveGroup),this.props.message&&c.track(new m.MessageContentClicked(this.props.message))}}_buildState(e,t){let s;if(e.tree.isPstn&&e.tree.skypeId){const t={number:y.default.normalizePartialNumberWithCountryCode(e.tree.skypeId),type:C.PhoneNumberTypes.Other};s=r.getMriFromPhoneNumber(t)}else s=e.tree.isS4B&&e.tree.skypeId?r.getMriFromS4BId(e.tree.skypeId):r.skypeIdToMri(e.tree.skypeId);return{contactUserMri:s,isSentByCurrentUser:e.message&&S.default.isMyMri(e.message.creator)}}render(){const e=g.getStyleForDimensions(this.props.renderDimensions),t=o.Styles.createTextStyle({maxWidth:this.props.renderDimensions.width},!1),s=this.props.tree.fullName,n=(0,i.jsx)(o.View,Object.assign({style:P.textWrapper},{children:(0,i.jsx)(_.BodyText,Object.assign({style:[P.fullName,t],size:_.BodyTextSize.BigDeprecated,bold:!0,numberOfLines:1,ellipsizeMode:"middle",accessibilityHidden:!0},{children:s}))})),r=this.props.isActionable?(0,i.jsx)(_.Caption,Object.assign({style:[P.skypeId,t],numberOfLines:1,ellipsizeMode:"tail",textThemeColor:_.TextThemeColor.Primary,accessibilityHidden:!0},{children:this.props.tree.skypeId})):void 0,a=u.getString("ContactCard.ChatButtonTitle"),l=s?u.getString("ContactCard.ChatButtonAccessibilityLabel",{userName:s}):a,d=this.props.isActionable?(0,i.jsx)(o.Button,Object.assign({style:[P.btnContainer,this._themeStyles.primaryBorderColorStyle],onPress:this._onPress,onLongPress:this.props.onLongPress,title:a,disabled:S.default.isMyMri(this.state.contactUserMri),accessibilityLabel:l},{children:(0,i.jsx)(_.BodyText,Object.assign({size:_.BodyTextSize.BigDeprecated,bold:!0,style:P.btnText},{children:a}))})):void 0,c=(0,i.jsx)(T.UserIcon,{userMri:this.state.contactUserMri,backgroundColor:v.Color.gray100,size:M.UserIconSize.Size50,importantForAccessibility:o.Types.ImportantForAccessibility.NoHideDescendants}),h=this.state.isSentByCurrentUser?P.senderBorderRadius:P.recieverBorderRadius,m=o.Styles.createTextStyle({maxHeight:w},!1);return(0,i.jsxs)(p.default.View,Object.assign({style:[m,P.contactCardContainer,e,h,this._themeStyles.cardColorStyle],onContextMenu:this.props.onContextMenu,keepOriginalProps:!0},{children:[(0,i.jsxs)(o.View,Object.assign({style:P.dataContainer},{children:[c,(0,i.jsxs)(o.View,Object.assign({style:P.textContainer},{children:[n,r]}))]})),d]}))}}t.default=k},616026:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentPlaceholder=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(217041),a=s(110117),l=s(915877),d=s(581760),c=s(680837),h=(0,l.lazyProperties)({contentPlaceholderContainer:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",marginBottom:-2,width:20,height:16}),contentPlaceholderPadding:()=>n.Styles.createViewStyle({paddingRight:4})});class u extends r.ComponentBase{render(){const e=o.compact([this.props.regularTextStyle,this.props.textOverrideStyle,c.default.noWrap]);let t=this.props.iconColorOverride;!t&&this.props.mediaPlaceholderIconColor&&(t=this.props.mediaPlaceholderIconColor);const s=(0,i.jsx)(n.View,Object.assign({style:h.contentPlaceholderContainer},{children:(0,i.jsx)(a.default,{icon:this.props.icon,size:16,color:null!=t?t:d.Color.white,style:h.contentPlaceholderPadding})}),"placeholderIcon");return(0,i.jsxs)(n.Text,Object.assign({style:e,numberOfLines:this.props.numberOfLines||0,selectable:this.props.allowTextSelection,ellipsizeMode:"middle"},{children:[this.props.isNewsChannel||this.props.isNewsBot?null:s,this.props.label]}))}}t.ContentPlaceholder=u},435521:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DisplayName=t.displayNameText=void 0;const i=s(496486),o=s(217041),n=s(952262);function r(e,t){return e&&n.default.getDisplayName(e)||i.trimEnd(t)}t.displayNameText=r;class a extends o.ComponentBase{_buildState(e,t){return{name:r(e.mri,e.fallbackText)}}render(){return this.props.renderName(this.state.name)}}t.DisplayName=a},702781:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileNodeForRedesign=t.FileNode=void 0;const i=s(785893),o=s(174958),n=s(496486),r=s(477517),a=s(550785),l=(s(900515),s(516778)),d=s(398861),c=s(219784),h=s(889391),u=s(720603),p=s(225638),g=s(246549),m=s(671830),S=s(711930),f=s(400984),y=s(816402),v=s(913991),C=s(952262),_=s(435521),b=s(606452),T=s(103291),M=s(770891),I=s(746096),w=s(907234),P=s(685609),k=s(761317),A=s(552115),x=s(179251),R=s(462937),O=s(753559),L=s(469382),F=s(317873),B=s(110117),D=s(436237),E=s(861253),V=s(916724),N=s(915877),U=s(540522),j=s(733754),H=s(451072),z=s(633596),W=s(812056),G=s(178735),K=s(18078),q=(s(104735),s(932226)),Q=s(785207),X=s(17791),$=s(29130),J=s(886045),Y=s(700960),Z=s(583181),ee=s(581760),te=s(640363),se=s(311010),ie=s(478262),oe=s(680837),ne=s(782176),re=s(619675),ae=s(24576),le=s(815188),de=s(626612),ce=s(626712),he=s(853374),ue=s(994224),pe=s(711828),ge=s(139285);var me;!function(e){e[e.INITIAL=0]="INITIAL",e[e.NONE=1]="NONE",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOAD_ERROR=3]="DOWNLOAD_ERROR",e[e.UPLOADING=4]="UPLOADING",e[e.UPLOAD_ERROR=5]="UPLOAD_ERROR",e[e.ERROR=6]="ERROR",e[e.SUCCESS=7]="SUCCESS"}(me||(me={}));const Se=Date.now()+2592e6,fe=25*Math.pow(1024,2),ye={whiteSpace:"nowrap"},ve=(0,N.lazyProperties)({link:()=>l.Styles.createButtonStyle({flex:1,flexDirection:"column",alignSelf:"stretch",justifyContent:"center",overflow:"visible"}),flexCenter:()=>l.Styles.createViewStyle({flexDirection:"row",justifyContent:"center"}),learnMoreLink:()=>l.Styles.createLinkStyle({color:ee.Color.blue}),contentContainer:()=>l.Styles.createButtonStyle({paddingTop:12,paddingBottom:0,borderBottomRightRadius:10,borderBottomLeftRadius:10}),contentContainerRestricted:()=>l.Styles.createButtonStyle({maxWidth:v.fileNodeWidth,minWidth:v.fileNodeWidth}),contentContainerRestrictedSmall:()=>l.Styles.createButtonStyle({maxWidth:v.fileNodeWidthSmall,minWidth:v.fileNodeWidthSmall}),textWrapper:()=>l.Styles.createTextStyle({flex:1,paddingHorizontal:10}),textWrapperForRedesign:()=>l.Styles.createViewStyle({justifyContent:"center",flexDirection:"column",flex:1,paddingHorizontal:10}),thumbnailContainer:()=>l.Styles.createViewStyle({position:"relative",height:64}),containerBorders:()=>l.Styles.createViewStyle({borderWidth:0,borderColor:ee.Color.transparent,borderBottomLeftRadius:10,borderBottomRightRadius:10,borderTopLeftRadius:10,borderTopRightRadius:10}),radiusCurrentUser:()=>l.Styles.createViewStyle({borderBottomRightRadius:0}),radiusOtherUser:()=>l.Styles.createViewStyle({borderTopLeftRadius:0}),cardTitle:()=>l.Styles.createTextStyle({alignItems:"flex-start",paddingRight:16}),cardSubtitle:()=>l.Styles.createTextStyle({paddingTop:4}),cardSubtitleError:()=>l.Styles.createTextStyle({paddingTop:4,color:ee.Color.pink}),fileName:()=>l.Styles.createTextStyle({fontWeight:"500",fontSize:15,lineHeight:20}),fileMetaSection:()=>l.Styles.createTextStyle({fontSize:12,flexDirection:"row",alignItems:"center"}),fileMetaSeparator:()=>l.Styles.createViewStyle({width:1,height:12,marginHorizontal:6}),fileMetaText:()=>l.Styles.createTextStyle({fontSize:12,fontWeight:"400"}),fileTypeSection:()=>l.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingTop:24,paddingBottom:10}),fileTypeSectionForRedesign:()=>l.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingTop:10,paddingBottom:10}),fileTypeIconPadding:()=>l.Styles.createViewStyle({paddingRight:6}),fileTypeIconPaddingForRedesign:()=>l.Styles.createViewStyle({paddingRight:8}),fileActionSection:()=>(0,N.lazyProperties)({base:()=>l.Styles.createViewStyle({flex:0,flexDirection:"column",alignItems:"center",paddingVertical:13,paddingHorizontal:5,borderTopWidth:2,borderStyle:"solid"})}),progressIndicatorMask:()=>[oe.default.absoluteFill,l.Styles.createViewStyle({alignItems:"center",justifyContent:"center",height:64})],progressIndicator:()=>l.Styles.createViewStyle({flex:0,width:24,height:24,marginRight:10}),progressIndicatorForRedesign:()=>l.Styles.createViewStyle({flex:0,width:40,height:40,alignItems:"center",justifyContent:"center",borderRadius:20}),actionButtonText:()=>l.Styles.createTextStyle({textAlign:"center"}),fileFooterTextAlignRight:()=>l.Styles.createTextStyle({textAlign:"right"}),fileFooterTextAlignLeft:()=>l.Styles.createTextStyle({textAlign:"left"}),FileFooterContainer:()=>l.Styles.createViewStyle({flexGrow:1,flexShrink:1}),draggableThumbnailContainer:()=>l.Styles.createViewStyle({alignItems:"center",justifyContent:"center",width:60,height:60,shadowRadius:1,shadowOffset:{width:0,height:2},paddingVertical:18,paddingHorizontal:18,shadowColor:ee.Color.blackOverlay20,borderRadius:10,borderWidth:1})});class Ce extends ae.default{_buildState(){return{enableMediaFileRedesign:h.default.getS4LMessagingFeatures().enableMediaFileRedesign}}render(){return this.state.enableMediaFileRedesign?(0,i.jsx)(be,Object.assign({},this.props)):(0,i.jsx)(_e,Object.assign({},this.props))}}t.default=Ce;class _e extends ae.default{constructor(){super(...arguments),this._onFileNodeContainerRef=e=>{this._fileNodeContainerRef=e||void 0},this._onPress=e=>{e.stopPropagation();const t=he.default.newCauseId();D.log(I.LogTraceArea.FileNode,"_onPress, causeId: "+t),F.default.potentiallyMarkItemViewed(this.props.message,this.props.renderOrigin),this._handleDownload(t)},this._handleDownload=(e,t)=>{if(!this.state.isConnected&&this.state.status===me.NONE)return;const s=!0,i=this.props.fileSizeInBytes;switch(this.state.status){case me.DOWNLOADING:return void D.track(new x.FileDownloadCancelClick(this.state.fileExtension,this.props.message,i,x.FileEventVersion.OldDesign,!!this.state.allowAutoDownloadFiles,this.state.networkType));case me.UPLOADING:return void n.each(this.props.message.getUnacknowledgedClientMessageIds(),(e=>{Q.default.cancelPostMessage(this.props.message.conversationId,e)}));case me.SUCCESS:return void(this.state.isUpload?(this._downloadFile(s,t),D.track(new x.FileDownloadClick(this.state.fileExtension,this.props.message,i,x.FileEventVersion.OldDesign,!!this.state.allowAutoDownloadFiles,this.state.networkType))):(this._processFile(),D.track(new x.FileOpenClick(this.state.fileExtension,this.props.message,x.FileEventVersion.OldDesign,!!this.state.allowAutoDownloadFiles,this.state.networkType))));case me.ERROR:return this._downloadFile(s,t),void D.track(new x.FileDownloadRetryClick(this.state.fileExtension,this.props.message,i,x.FileEventVersion.OldDesign,!!this.state.allowAutoDownloadFiles,this.state.networkType));default:return this._downloadFile(s,t),void D.track(new x.FileDownloadClick(this.state.fileExtension,this.props.message,i,x.FileEventVersion.OldDesign,!!this.state.allowAutoDownloadFiles,this.state.networkType))}},this._handleAutoDownload=()=>{const e=he.default.newCauseId();D.log(I.LogTraceArea.FileNode,"_handleAutoDownload, causeId: "+e),this._handleDownload(e,!0)},this._autoDownloadFile=()=>{if(this.state.documentId&&!g.default.isQueued(this.state.documentId)){const e={key:this.state.documentId,url:this.props.contentUrl,filename:this.state.fileUri,tag:this.props.message.conversationId,encryptionData:this._getEncryptionData()};g.default.downloadItem(e)}},this._onFileLearnMorePress=e=>{e.stopPropagation(),e.preventDefault(),U.openUrlWithParams({origin:I.BrowserOrigin.FileSharingLimits,url:h.default.getConfigSettingsNoSubscription().fileNode.learnMoreLink,rootViewId:this._getRootViewId()})},this._onFileLearnMoreKeyPress=e=>{e.stopPropagation()},this._showPromptForLargeFiles=()=>{const e=[{text:j.getString("FileTransfer.FileAccept"),onPress:()=>this._checkFileStatus(),isSubmit:!0},{text:j.getString("FileTransfer.DontAskMeAgain"),onPress:()=>(this._checkFileStatus(),G.default.setUserPreferencesLocal({dontShowAcceptLargeFileDialog:!0}),!0)},{text:j.getString("Global.CancelLabel"),isCancel:!0}],t=j.getString("FileTransfer.AcceptLargeFilePromptTitle",{maxFileSize:25}),s=j.getString("FileTransfer.AcceptLargeFilePromptMessage",{maxFileSize:25}),i=`${t}, ${s}`;return c.default.showWithOptions({title:t,message:s,dialogAccessibilityTitle:i,buttons:e,rootViewId:this._getRootViewId()})},this._handleFileCancelled=e=>{e===this.state.documentId&&this.setState({status:me.NONE})},this._handleFileDownloadUpdate=e=>{if(this.isComponentMounted()){if(this.state.documentId!==e.key)return;e.isFinished&&(e.downloadTransfer&&e.downloadTransfer.success?(te.default.getPlatformType()===I.PlatformType.iOS?e.isCached&&this.setState({status:me.SUCCESS,localUri:w.default.getLocalUri(e.key)}):this.setState({status:me.SUCCESS,localUri:e.downloadTempLocalUri}),this._sendTelemetryEvent(!0,I.MessagingFailureReason.None,e),J.default.maybeAnnounceForAccessibility(j.getString("AccessibilityLabel.FileDownloadSuccess"))):(this.setState({status:me.ERROR}),this._sendTelemetryEvent(!1,I.MessagingFailureReason.AMSFailure,e),J.default.maybeAnnounceForAccessibility(j.getString("AccessibilityLabel.FileDownloadError")),D.track(new x.FileDownloadFailure(this.state.fileExtension,this.props.message,this.props.fileSizeInBytes,x.FileEventVersion.OldDesign,!!this.state.allowAutoDownloadFiles,this.state.networkType))))}},this._downloadFileRN=()=>{const e=he.default.newCauseId();if(D.log(I.LogTraceArea.FileNode,"_downloadFileRN, causeId: "+e),!this.state.documentId)return D.warn(I.LogTraceArea.FileNode,"Tried to download a file without a documentId. Setting status to ERROR."),void this.setState({status:me.ERROR});const t=this._getEncryptionData();te.default.getPlatformType()===I.PlatformType.iOS?b.default.downloadAmsContentToCache(this.state.documentId,this.props.downloadFilename,Se,w.CacheEvictionKind.UserInvolved,Date.now(),this.props.contentUrl,e,void 0,t):b.default.androidDownloadAmsContentToPublicFolder(this.state.documentId,this.props.downloadFilename,this.props.contentUrl,e,void 0,t),this.setState({status:me.DOWNLOADING}),J.default.maybeAnnounceForAccessibility(j.getString("AccessibilityLabel.FileDownloadStarted")),n.defer((()=>{this.requestFocus()}))},this._downloadFileWebOrWrapper=()=>{const e=he.default.newCauseId();if(D.log(I.LogTraceArea.FileNode,"_downloadFileWebOrWrapper, causeId: "+e),!this.state.documentId)return D.warn(I.LogTraceArea.FileNode,"Tried to download a file without a documentId. Setting status to ERROR."),void this.setState({status:me.ERROR});{const e=new p.default(this.props.contentUrl).getViewId();e&&(u.default.getStatusAsync(this.state.documentId,e).then((e=>{this.isComponentMounted()&&(this.state.status===me.DOWNLOADING&&e&&e.view_location&&(ue.default.CallingStore.disableWindowUninitEventHandler(),a.default.saveFile(e.view_location,this.props.downloadFilename),ue.default.CallingStore.enableWindowUninitEventHandler()),this.setState({status:me.NONE}))})).fail((()=>{this.isComponentMounted()&&this.setState({status:me.ERROR})})),this.setState({status:me.DOWNLOADING}))}},this._onShareError=e=>{c.default.showOKAlert(j.getString("FileTransfer.FileOpen"),j.getString("FileTransfer.UnableToOpenFileMessage",{fileName:this.props.downloadFilename}),this._getRootViewId()),this._trackShare(!1,e)},this._onShareCallback=(e,t)=>{this._trackShare(e,void 0)},this._onLongPress=e=>{this.props.onLongPress&&this.props.onLongPress(e)},this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHovering:!1})},this._getLocalFileUri=()=>{let e=this.state.localUri;return!e&&this.state.documentId&&R.default.canTrackFiles()&&(e=R.default.getLocalUri(this.state.documentId)),e},this._canDownloadFile=()=>!!this.props.isFileAvailable&&(!(this._getLocalFileUri()||this._isDownloading()||!this.state.isConversationAccepted||!this.state.allowAutoDownloadFiles)&&!(this.state.isInCall&&!this.state.allowAutoDownloadFilesInCall)),this._cancelDownloadForKey=e=>{D.log(I.LogTraceArea.FileNode,"FileNode._cancelDownloadForKey, causeId: "+e),this.state.documentId&&(this.state.allowAutoDownloadFiles&&g.default.isQueued(this.state.documentId)?g.default.cancelDownload(this.state.documentId):b.default.cancelDownloadForKey(this.state.documentId,e))},this._maybeCancelOngoingDownloads=()=>{if(this.state.documentId&&this._isDownloading()&&b.default.isDownloading(this.state.documentId)){const e=he.default.newCauseId();this._cancelDownloadForKey(e)}},this._isDownloading=()=>this.state.status===me.DOWNLOADING,this._onDragStartFile=e=>{T.default.addDragAndDropFileInformation(e,this.props.message)}}_buildState(e,t){h.default.getS4LMessagingFeatures();const s=K.default.isMyMri(e.authorMri),i=G.default.getUserPreferencesLocal(),o={dontPromptDownloadConfirmation:s||i.dontShowAcceptFileDialog,dontPromptLargeFileDownloadConfirmation:i.dontShowAcceptLargeFileDialog,wasCreatedByCurrentUser:s,isConnected:q.default.isConnected(),status:t?me.NONE:this.state.status,fileRetentionDurationDays:h.default.getS4LCMCFeatures().fileRetentionDurationDays,isConversationAccepted:f.default.isConversationAccepted(e.message.conversationId),allowAutoDownloadFiles:false,allowAutoDownloadFilesInCall:false,isInCall:Z.default.isInCall(),networkType:X.default.getNetworkType()};let n=!1;const r=this.props;if(t?(o.fileSizeInformation=A.default.formatFileSize(e.fileSizeInBytes,1),o.fileExtension=O.default.extractFileExtension(e.displayFilename),o.lastContentUrl=e.contentUrl,o.isUpload=!1):this.state.status===me.SUCCESS&&this.state.localUri&&(n=!0),(t||r.displayFilename!==e.displayFilename)&&(o.fileInfo=P.FileIconHelper.getIconFromFileType(e.displayFilename)),e.contentUrl&&(t||this.state.lastContentUrl!==e.contentUrl)&&(o.lastContentUrl=e.contentUrl,o.documentId=new p.default(e.contentUrl).getDocumentId(),o.documentId?R.default.canTrackFiles()&&(o.localUri=R.default.getLocalUri(o.documentId)):o.isUpload=!0),!n){const t=e.contentUrl?de.default.getTransferProgressForUrl(e.contentUrl):0,s=ce.default.isFileOrBlob(e.contentUrl),i=o.status;o.localUri?o.status=me.SUCCESS:t&&(t.finished?t.success&&(o.status=me.SUCCESS):o.status=s?me.UPLOADING:me.DOWNLOADING),D.log(I.LogTraceArea.FileNode,"File node state changed from: "+i+", to: "+o.status)}const a=(o.fileSizeInformation||this.state.fileSizeInformation).formattedString;let l=e.displayFilename;switch(o.status){case me.DOWNLOADING:l+=j.getString("AccessibilityLabel.FileCancelDownload");break;case me.SUCCESS:l+=j.getString("AccessibilityLabel.OpenFile",{fileSize:a});break;case me.NONE:case me.ERROR:l+=j.getString("AccessibilityLabel.DownloadFile",{fileSize:a});break;case me.UPLOADING:l+=j.getString("AccessibilityLabel.FileUploadProgress")}const d={senderName:(0,_.displayNameText)(e.message.creator,e.message.creator),timestamp:y.default.getDisplayTimeString(e.message.createdTime),messageContent:l};o.accessibilityLabel=e.message.isUnsent()?j.getString("AccessibilityLabel.MediaMessageSending",d):j.getString("AccessibilityLabel.MediaMessage",d),o.responsiveWidth=$.default.getResponsiveWidth(this._getRootViewId());const c=e.searchStore?e.searchStore.getSearchQuery():void 0;return e.searchStore&&c&&e.searchStore.isMessageInConvSearchResults(e.message.cuid)?o.cardTitle=(0,Y.transformToHighlightedText)(e.displayFilename,c.query,e.searchStore.isMessageFocused(e.message.cuid),!1):o.cardTitle=[e.displayFilename],o.fileUri=k.FilePickerUtils.getFileUri(e.downloadFilename,i.fileDownloadPathDesktop),o}componentWillUnmount(){super.componentWillUnmount(),b.default.downloadUpdated.unsubscribe(this._handleFileDownloadUpdate),g.default.downloadCancelled.unsubscribe(this._handleFileCancelled),this._maybeCancelOngoingDownloads()}componentDidMount(){super.componentDidMount(),b.default.downloadUpdated.subscribe(this._handleFileDownloadUpdate),g.default.downloadCancelled.subscribe(this._handleFileCancelled),D.track(new x.FileExposure(this.state.fileExtension,this.props.message,x.FileEventVersion.ReDesignV1,!!this.state.allowAutoDownloadFiles,this.state.networkType)),this._canDownloadFile()&&this._handleAutoDownload()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._canDownloadFile()&&this.state.shouldHandleAutoDownload&&this._handleAutoDownload()}render(){const e=!m.isEncryptedThread(this.props.message.conversationId),t=[ve.containerBorders];this.props.renderOrigin!==M.MessageRenderOrigin.CompositeGalleryCanvas&&t.push(this.state.wasCreatedByCurrentUser&&this.props.renderOrigin!==M.MessageRenderOrigin.StackGalleryCanvas?ve.radiusCurrentUser:ve.radiusOtherUser);let s,o=e?j.getString("FileTransfer.DownloadFile"):j.getString("FileTransfer.UnsupportedEncryptedFile"),a=this.state.fileSizeInformation.formattedString,d=ve.cardSubtitle,c=!1;switch(this.state.status){case me.DOWNLOADING:o=j.getString("Global.CancelLabel"),a=j.getString("FileTransfer.DownloadingStatus",{fileSize:a}),c=!0;break;case me.UPLOADING:o=j.getString("Global.CancelLabel"),a=j.getString("FileTransfer.UploadingStatus",{fileSize:a}),c=!0;break;case me.ERROR:o=j.getString("FileTransfer.RetryDownloadFile"),a=j.getString("FileTransfer.ErrorStatus"),d=ve.cardSubtitleError;break;case me.SUCCESS:this.state.isUpload?a=j.getString("FileTransfer.UploadedStatus",{fileSize:a}):(o=j.getString("FileTransfer.OpenFile"),a=j.getString("FileTransfer.DownloadedStatus",{fileSize:a}));case me.NONE:}c&&(s=(0,i.jsx)(l.View,Object.assign({style:ve.progressIndicator},{children:(0,i.jsx)(le.default,{size:24,strokeColor:this._themeColors.primaryTextColor,contentUrls:[this.props.contentUrl],showFiniteProgressIndicatorUI:!0})})));let h=[ve.link,ve.contentContainer,this._themeStyles.cardColorStyle];(0,E.default)(this.props.renderDimensions,v.FileNodeSizes.Small)?h.push(ve.contentContainerRestrictedSmall):(0,E.default)(this.props.renderDimensions,v.FileNodeSizes.Regular)&&h.push(ve.contentContainerRestricted),h=n.flatten([h,t]);const u=[ve.actionButtonText,se.default.fontStyle.cardAction];!this.state.isConnected&&this.state.status===me.NONE||!e?(u.push(this._themeStyles.disabledTextColorStyle),h.push(oe.default.defaultCursor)):u.push(this.state.isHovering?this._themeStyles.textHoverColorStyle:this._themeStyles.buttonTextColorStyle);const p=[ve.fileActionSection.base,this._themeStyles.primaryBorderColorStyle],g=this._renderFooterView();let S;this.props.isFileAvailable&&(S=this.props.isActionable?(0,i.jsx)(l.View,Object.assign({style:p,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd},{children:(0,i.jsx)(l.Text,Object.assign({style:u,forceDirection:!0},{children:o}))})):void 0);const f=z.getStyleForDimensions({width:this.props.renderDimensions.width,height:void 0});return(0,i.jsxs)(r.DragDroppableView,Object.assign({onDragStart:this.props.isDraggingEnabled?this._onDragStartFile:void 0,dragThumbnailElement:this.props.isDraggingEnabled?this._getThumbnailElement():void 0,style:f},{children:[(0,i.jsx)(H.default.Button,Object.assign({ref:this._onFileNodeContainerRef,style:h,title:j.getString("FileTransfer.FileOpen"),onPress:e?this._onPress:void 0,onLongPress:e?this._onLongPress:void 0,onContextMenu:this.props.onContextMenu,underlayColor:this._themeColors.rowHighlightColor,activeOpacity:this.props.activeOpacityOverride,accessibilityLabel:this.state.accessibilityLabel,keepOriginalProps:!0,disabled:this.props.disableActions||!this.props.isFileAvailable,disabledOpacity:1},{children:(0,i.jsxs)(l.View,Object.assign({style:ve.textWrapper,title:this.props.displayFilename},{children:[(0,i.jsx)(re.CardTitle,Object.assign({style:ve.cardTitle,numberOfLines:1,ellipsizeMode:"middle"},{children:this.state.cardTitle})),(0,i.jsx)(re.Caption,Object.assign({style:d,numberOfLines:1},{children:a})),(0,i.jsxs)(l.View,Object.assign({style:[ve.fileTypeSection]},{children:[(0,i.jsx)(B.default,{icon:this.state.fileInfo.icon,size:24,color:this.props.mediaPlaceholderIconColor||ee.Color.gray300,style:ve.fileTypeIconPadding}),(0,i.jsx)(re.Caption,Object.assign({style:oe.default.flexOne,numberOfLines:1},{children:this.state.fileInfo.displayString})),s]})),S]}))}),"file"),g]}))}requestFocus(){this._fileNodeContainerRef&&this._fileNodeContainerRef.requestFocus()}_renderFooterView(){let e;if(!this.props.isFileAvailable){let t,s=this.state.wasCreatedByCurrentUser?ve.fileFooterTextAlignRight:ve.fileFooterTextAlignLeft;this.props.renderOrigin!==M.MessageRenderOrigin.CompositeGalleryCanvas&&this.props.renderOrigin!==M.MessageRenderOrigin.StackGalleryCanvas||(s=ve.fileFooterTextAlignLeft);const o=(0,i.jsx)(l.Link,Object.assign({url:h.default.getConfigSettingsNoSubscription().fileNode.learnMoreLink,onPress:this._onFileLearnMorePress,style:[ve.learnMoreLink,ye]},{children:j.getString("FileTransfer.FileLearnMoreLinkText")}),"FileLearnMoreLink "),n=j.getParts("FileTransfer.FileNotAvailableMessage",{learnMoreLink:o}),r=(0,i.jsx)(re.Caption,Object.assign({style:s,allowFontScaling:!1},{children:n})),a=!1;a&&(t=S.default.linkAccessibilityInfo(j.getString("FileTransfer.FileNotAvailableMessage",{learnMoreLink:j.getString("FileTransfer.FileLearnMoreLinkText")}),!0)),e=(0,i.jsx)(l.View,Object.assign({style:ve.FileFooterContainer,importantForAccessibility:l.Types.ImportantForAccessibility.Yes,accessibilityLabel:t?t.label:void 0,accessibilityTraits:t?t.traits:void 0,onPress:a?this._onFileLearnMorePress:void 0,onKeyPress:this._onFileLearnMoreKeyPress},{children:r}))}return e}_downloadFile(e,t){this.setState({isUpload:!1});const{dontPromptLargeFileDownloadConfirmation:s}=this.state,i=t&&this.state.allowAutoDownloadFiles;if(e)i?this._autoDownloadFile():this._checkFileStatusWrapperOrWeb();else{const e=this.state.networkType===d.DeviceNetworkType.Wifi,t=this.props.fileSizeInBytes>=fe;e||s||i||!t?this._checkFileStatus():this._showPromptForLargeFiles()}}_sendTelemetryEvent(e,t,s){const i=o.pii.Omit(s.targetUri||""),n=new V.FileReceived(i,void 0,ne.default.extractExtensionForTelemetry(s.filename));n.setDownloadDuration(Date.now()-s.startTime),n.setSuccess(e,t,s.finishedAttemptsSoFar,s.responseStatusCode),D.track(n)}_checkFileStatusWrapperOrWeb(){const e=this.props.displayFilename,t=C.default.getDisplayName(this.props.authorMri,!0)||this.props.authorMri,s=e.lastIndexOf(".")+1,i=e.substring(s,s+e.length),o=h.default.getS4LMessagingFeatures().unsafeFiles.indexOf(i)>=0,n=j.getString(o?"FileTransfer.AcceptUnsafeFileMessage":"FileTransfer.AcceptFileMessage",{fileName:e,senderName:t});let r="";const a=[{text:j.getString("FileTransfer.FileAccept"),onPress:this._downloadFileWebOrWrapper,isSubmit:!0},{text:j.getString("Global.CancelLabel"),isCancel:!0}];if(o)r=j.getString("FileTransfer.UnsafeFileHeader");else{if(this.state.dontPromptDownloadConfirmation)return this._downloadFileWebOrWrapper();a.push({text:j.getString("FileTransfer.DontAskMeAgain"),onPress:()=>(this._downloadFileWebOrWrapper(),G.default.setUserPreferencesLocal({dontShowAcceptFileDialog:!0}),!0)})}c.default.showWithOptions({title:r,message:n,dialogAccessibilityTitle:n,buttons:a,rootViewId:this._getRootViewId()})}_checkFileStatus(){const e=h.default.getS4LMessagingFeatures().unsafeFiles.indexOf(this.state.fileExtension)>=0,t=C.default.getDisplayName(this.props.authorMri,!0)||this.props.authorMri,s=this.props.displayFilename,i=j.getString(e?"FileTransfer.AcceptUnsafeFileMessage":"FileTransfer.AcceptFileMessage",{fileName:s,senderName:t}),o=[{text:j.getString("FileTransfer.FileAccept"),onPress:this._downloadFileRN},{text:j.getString("Global.CancelLabel")}];e?c.default.showWithOptions({title:j.getString("FileTransfer.UnsafeFileHeader"),message:i,dialogAccessibilityTitle:i,buttons:o,rootViewId:this._getRootViewId()}):this.state.dontPromptDownloadConfirmation?this._downloadFileRN():(o.push({text:j.getString("FileTransfer.DontAskMeAgain"),onPress:()=>{this._downloadFileRN(),G.default.setUserPreferencesLocal({dontShowAcceptFileDialog:!0})}}),c.default.showWithOptions({title:j.getString("FileTransfer.AcceptFileHeader"),dialogAccessibilityTitle:i,message:i,buttons:o,rootViewId:this._getRootViewId()}))}_processFile(){}_trackShare(e,t){const s=new W.ShareFileMessageTelemetry(this.props.message.conversationId,this.props.message,this.props.message.createdTime,W.MessageActionOrigin.FileNode,W.MessageActionType.ShareFile,this.state.fileExtension,!1);D.track(s)}_getEncryptionData(){return this.props.message.getFileEncryptionKeys()}_getThumbnailElement(){return(0,i.jsx)(B.default,{icon:this.state.fileInfo.icon,size:24,color:this.props.mediaPlaceholderIconColor||ee.Color.gray300,style:[ve.draggableThumbnailContainer,this._themeStyles.primaryBackgroundColorStyle,this._themeStyles.dividerBorderColorStyle]})}}t.FileNode=_e;class be extends ae.default{constructor(){super(...arguments),this._getIcon=(e,t=pe.IconSize.size64)=>(0,i.jsx)(B.default,{icon:e,color:this._themeColors.iconPrimaryFixed,size:t,style:ve.flexCenter}),this._onFileNodeContainerRef=e=>{this._fileNodeContainerRef=e||void 0},this._onPress=e=>{e.stopPropagation();const t=he.default.newCauseId();D.log(I.LogTraceArea.FileNode,"_onPress, causeId: "+t),F.default.potentiallyMarkItemViewed(this.props.message,this.props.renderOrigin),this._handleDownload(t)},this._handleDownload=(e,t)=>{if(!this.state.isConnected&&this.state.status===me.NONE)return;const s=!0,i=this.props.fileSizeInBytes;switch(this.state.status){case me.DOWNLOADING:return void D.track(new x.FileDownloadCancelClick(this.state.fileExtension,this.props.message,i,x.FileEventVersion.ReDesignV1,!!this.state.allowAutoDownloadFiles,this.state.networkType));case me.UPLOADING:return void n.each(this.props.message.getUnacknowledgedClientMessageIds(),(e=>{Q.default.cancelPostMessage(this.props.message.conversationId,e)}));case me.SUCCESS:return void(this.state.isUpload&&!this.state.localUri?(this._downloadFile(s,t),D.track(new x.FileDownloadClick(this.state.fileExtension,this.props.message,i,x.FileEventVersion.ReDesignV1,!!this.state.allowAutoDownloadFiles,this.state.networkType))):(this._processFile(),D.track(new x.FileOpenClick(this.state.fileExtension,this.props.message,x.FileEventVersion.ReDesignV1,!!this.state.allowAutoDownloadFiles,this.state.networkType))));case me.ERROR:return this._downloadFile(s,t),void D.track(new x.FileDownloadRetryClick(this.state.fileExtension,this.props.message,i,x.FileEventVersion.ReDesignV1,!!this.state.allowAutoDownloadFiles,this.state.networkType));default:return this._downloadFile(s,t),void D.track(new x.FileDownloadClick(this.state.fileExtension,this.props.message,i,x.FileEventVersion.ReDesignV1,!!this.state.allowAutoDownloadFiles,this.state.networkType))}},this._handleAutoDownload=()=>{const e=he.default.newCauseId();D.log(I.LogTraceArea.FileNode,"_handleAutoDownload, causeId: "+e),this._handleDownload(e,!0)},this._autoDownloadFile=()=>{if(this.state.documentId&&!g.default.isQueued(this.state.documentId)){const e={key:this.state.documentId,url:this.props.contentUrl,filename:this.state.fileUri,tag:this.props.message.conversationId,encryptionData:this._getEncryptionData()};g.default.downloadItem(e)}},this._onFileLearnMorePress=e=>{e.stopPropagation(),e.preventDefault(),U.openUrlWithParams({origin:I.BrowserOrigin.FileSharingLimits,url:h.default.getConfigSettingsNoSubscription().fileNode.learnMoreLink,rootViewId:this._getRootViewId()})},this._onFileLearnMoreKeyPress=e=>{e.stopPropagation()},this._showPromptForLargeFiles=()=>{const e=[{text:j.getString("FileTransfer.FileAccept"),onPress:()=>this._checkFileStatus(),isSubmit:!0},{text:j.getString("FileTransfer.DontAskMeAgain"),onPress:()=>(this._checkFileStatus(),G.default.setUserPreferencesLocal({dontShowAcceptLargeFileDialog:!0}),!0)},{text:j.getString("Global.CancelLabel"),isCancel:!0}],t=j.getString("FileTransfer.AcceptLargeFilePromptTitle",{maxFileSize:25}),s=j.getString("FileTransfer.AcceptLargeFilePromptMessage",{maxFileSize:25}),i=`${t}, ${s}`;return c.default.showWithOptions({title:t,message:s,dialogAccessibilityTitle:i,buttons:e,rootViewId:this._getRootViewId()})},this._handleFileCancelled=e=>{e===this.state.documentId&&this.setState({status:me.NONE})},this._handleFileDownloadUpdate=e=>{if(this.isComponentMounted()){if(this.state.documentId!==e.key)return;e.isFinished&&(e.downloadTransfer&&e.downloadTransfer.success?(te.default.getPlatformType()===I.PlatformType.iOS?e.isCached&&this.setState({status:me.SUCCESS,localUri:w.default.getLocalUri(e.key)}):this.setState({status:me.SUCCESS,localUri:e.downloadTempLocalUri}),this._sendTelemetryEvent(!0,I.MessagingFailureReason.None,e),J.default.maybeAnnounceForAccessibility(j.getString("AccessibilityLabel.FileDownloadSuccess"))):(this.setState({status:me.DOWNLOAD_ERROR}),this._sendTelemetryEvent(!1,I.MessagingFailureReason.AMSFailure,e),J.default.maybeAnnounceForAccessibility(j.getString("AccessibilityLabel.FileDownloadError")),D.track(new x.FileDownloadFailure(this.state.fileExtension,this.props.message,this.props.fileSizeInBytes,x.FileEventVersion.ReDesignV1,!!this.state.allowAutoDownloadFiles,this.state.networkType))))}},this._downloadFileRN=()=>{const e=he.default.newCauseId();if(D.log(I.LogTraceArea.FileNode,"_downloadFileRN, causeId: "+e),!this.state.documentId)return D.warn(I.LogTraceArea.FileNode,"Tried to download a file without a documentId. Setting status to DOWNLOAD_ERROR."),void this.setState({status:me.DOWNLOAD_ERROR});const t=this._getEncryptionData();te.default.getPlatformType()===I.PlatformType.iOS?b.default.downloadAmsContentToCache(this.state.documentId,this.props.downloadFilename,Se,w.CacheEvictionKind.UserInvolved,Date.now(),this.props.contentUrl,e,void 0,t):b.default.androidDownloadAmsContentToPublicFolder(this.state.documentId,this.props.downloadFilename,this.props.contentUrl,e,void 0,t),this.setState({status:me.DOWNLOADING}),J.default.maybeAnnounceForAccessibility(j.getString("AccessibilityLabel.FileDownloadStarted")),n.defer((()=>{this.requestFocus()}))},this._downloadFileWebOrWrapper=()=>{const e=he.default.newCauseId();if(D.log(I.LogTraceArea.FileNode,"_downloadFileWebOrWrapper, causeId: "+e),!this.state.documentId)return D.warn(I.LogTraceArea.FileNode,"Tried to download a file without a documentId. Setting status to DOWNLOAD_ERROR."),void this.setState({status:me.DOWNLOAD_ERROR});{const e=new p.default(this.props.contentUrl).getViewId();e&&(u.default.getStatusAsync(this.state.documentId,e).then((e=>{this.isComponentMounted()&&(this.state.status===me.DOWNLOADING&&e&&e.view_location&&(ue.default.CallingStore.disableWindowUninitEventHandler(),a.default.saveFile(e.view_location,this.props.downloadFilename),ue.default.CallingStore.enableWindowUninitEventHandler()),this.setState({status:me.NONE}))})).fail((()=>{this.isComponentMounted()&&this.setState({status:me.DOWNLOAD_ERROR})})),this.setState({status:me.DOWNLOADING}))}},this._onShareError=e=>{c.default.showOKAlert(j.getString("FileTransfer.FileOpen"),j.getString("FileTransfer.UnableToOpenFileMessage",{fileName:this.props.downloadFilename}),this._getRootViewId()),this._trackShare(!1,e)},this._onShareCallback=(e,t)=>{this._trackShare(e,void 0)},this._onLongPress=e=>{this.props.onLongPress&&this.props.onLongPress(e)},this._getLocalFileUri=()=>{let e=this.state.localUri;return!e&&this.state.documentId&&R.default.canTrackFiles()&&(e=R.default.getLocalUri(this.state.documentId)),e},this._canDownloadFile=()=>!!this.props.isFileAvailable&&(!(this._getLocalFileUri()||this._isDownloading()||!this.state.isConversationAccepted||!this.state.allowAutoDownloadFiles)&&!(this.state.isInCall&&!this.state.allowAutoDownloadFilesInCall)),this._cancelDownloadForKey=e=>{D.log(I.LogTraceArea.FileNode,"FileNode._cancelDownloadForKey, causeId: "+e),this.state.documentId&&(this.state.allowAutoDownloadFiles&&g.default.isQueued(this.state.documentId)?g.default.cancelDownload(this.state.documentId):b.default.cancelDownloadForKey(this.state.documentId,e))},this._maybeCancelOngoingDownloads=()=>{if(this.state.documentId&&this._isDownloading()&&b.default.isDownloading(this.state.documentId)){const e=he.default.newCauseId();this._cancelDownloadForKey(e)}},this._isDownloading=()=>this.state.status===me.DOWNLOADING,this._onDragStartFile=e=>{T.default.addDragAndDropFileInformation(e,this.props.message)}}_buildState(e,t){const s=h.default.getS4LMessagingFeatures(),i=K.default.isMyMri(e.authorMri),o=G.default.getUserPreferencesLocal(),n=!i&&L.isFileEligibleForAutoDownload(s,o),r=e.message.isSendRejected(),a={showFileDownloadPrompt:L.shouldShowFileDownloadPrompt(n,i,o),showLargeFileDownloadPrompt:L.shouldShowLargeFileDownloadPrompt(n,o),wasCreatedByCurrentUser:i,isConnected:q.default.isConnected(),fileRetentionDurationDays:h.default.getS4LCMCFeatures().fileRetentionDurationDays,isConversationAccepted:f.default.isConversationAccepted(e.message.conversationId),allowAutoDownloadFiles:n,allowAutoDownloadFilesInCall:n&&s.enableAutoDownloadFilesInCall,isInCall:Z.default.isInCall(),networkType:X.default.getNetworkType(),sendingFailed:r};let l=!1;const d=this.props;if(t?(a.status=r?me.UPLOAD_ERROR:me.INITIAL,a.fileSizeInformation=A.default.formatFileSize(e.fileSizeInBytes,1),a.fileExtension=O.default.extractFileExtension(e.displayFilename),a.lastContentUrl=e.contentUrl,a.isUpload=!1):this.state.status===me.SUCCESS&&this.state.localUri&&(l=!0),t||(a.status=r?me.UPLOAD_ERROR:this.state.status),(t||d.displayFilename!==e.displayFilename)&&(a.fileInfo=P.FileIconHelper.getIconFromFileType(e.displayFilename)),e.contentUrl&&(t||this.state.lastContentUrl!==e.contentUrl)&&(a.lastContentUrl=e.contentUrl,a.documentId=new p.default(e.contentUrl).getDocumentId(),a.documentId?R.default.canTrackFiles()&&(a.localUri=R.default.getLocalUri(a.documentId)):(a.isUpload=!0,a.status=r?me.UPLOAD_ERROR:me.UPLOADING)),!l){const t=e.contentUrl?de.default.getTransferProgressForUrl(e.contentUrl):0,i=ce.default.isFileOrBlob(e.contentUrl),n=a.status;a.localUri?a.status=me.SUCCESS:t?t.finished?t.success&&(a.status=me.SUCCESS):a.status=i?r?me.UPLOAD_ERROR:me.UPLOADING:me.DOWNLOADING:(a.allowAutoDownloadFiles=L.isFileEligibleForAutoDownload(s,o),a.allowAutoDownloadFilesInCall=a.allowAutoDownloadFiles&&s.enableAutoDownloadFilesInCall),D.log(I.LogTraceArea.FileNode,"File node state changed from: "+n+", to: "+a.status)}const c=(a.fileSizeInformation||this.state.fileSizeInformation).formattedString;let u=e.displayFilename;switch(a.status){case me.DOWNLOADING:u+=j.getString("AccessibilityLabel.FileCancelDownload");break;case me.SUCCESS:u+=j.getString("AccessibilityLabel.OpenFile",{fileSize:c});break;case me.NONE:case me.ERROR:case me.INITIAL:u+=j.getString("AccessibilityLabel.DownloadFile",{fileSize:c});break;case me.UPLOADING:u+=j.getString("AccessibilityLabel.FileUploadProgress");break;case me.UPLOAD_ERROR:u+=j.getString("AccessibilityLabel.FileUploadFailed")}const g={senderName:(0,_.displayNameText)(e.message.creator,e.message.creator),timestamp:y.default.getDisplayTimeString(e.message.createdTime),messageContent:u};a.accessibilityLabel=e.message.isUnsent()?j.getString("AccessibilityLabel.MediaMessageSending",g):j.getString("AccessibilityLabel.MediaMessage",g),a.responsiveWidth=$.default.getResponsiveWidth(this._getRootViewId());const m=e.searchStore?e.searchStore.getSearchQuery():void 0;return e.searchStore&&m&&e.searchStore.isMessageInConvSearchResults(e.message.cuid)?a.cardTitle=(0,Y.transformToHighlightedText)(e.displayFilename,m.query,e.searchStore.isMessageFocused(e.message.cuid),!1):a.cardTitle=[e.displayFilename],a.fileUri=k.FilePickerUtils.getFileUri(e.downloadFilename,o.fileDownloadPathDesktop),a}_renderCover(){const e=this.props.fileSubType===ie.UploadFileType.File?O.default.getFileType(O.default.extractFileExtension(this.props.displayFilename)):this.props.fileSubType;if(this.state.status===me.NONE)return e===ie.UploadFileType.Word?this._getIcon(pe.SkypeIcon.MSWordBig):e===ie.UploadFileType.Excel?this._getIcon(pe.SkypeIcon.MSExcelBig):e===ie.UploadFileType.Powerpoint?this._getIcon(pe.SkypeIcon.MSPowerPointBig):e===ie.UploadFileType.PDF?this._getIcon(pe.SkypeIcon.FilePDFBig):e===ie.UploadFileType.AVI?this._getIcon(pe.SkypeIcon.FileAVIBig):e===ie.UploadFileType.Audio?this._getIcon(pe.SkypeIcon.FileAudioBig):e===ie.UploadFileType.Picture?this._getIcon(pe.SkypeIcon.FilePictureBig):e===ie.UploadFileType.Video?this._getIcon(pe.SkypeIcon.FileVideoBig):e===ie.UploadFileType.Zip?this._getIcon(pe.SkypeIcon.FileZipBig):this._getIcon(pe.SkypeIcon.FileBig)}componentWillUnmount(){super.componentWillUnmount(),b.default.downloadUpdated.unsubscribe(this._handleFileDownloadUpdate),g.default.downloadCancelled.unsubscribe(this._handleFileCancelled),this._maybeCancelOngoingDownloads()}componentDidMount(){super.componentDidMount(),b.default.downloadUpdated.subscribe(this._handleFileDownloadUpdate),g.default.downloadCancelled.subscribe(this._handleFileCancelled),D.track(new x.FileExposure(this.state.fileExtension,this.props.message,x.FileEventVersion.OldDesign,!!this.state.allowAutoDownloadFiles,this.state.networkType)),this._canDownloadFile()&&this._handleAutoDownload()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._canDownloadFile()&&this.state.shouldHandleAutoDownload&&this._handleAutoDownload()}render(){const e=!m.isEncryptedThread(this.props.message.conversationId),t=[ve.containerBorders];this.props.renderOrigin!==M.MessageRenderOrigin.CompositeGalleryCanvas&&t.push(this.state.wasCreatedByCurrentUser&&this.props.renderOrigin!==M.MessageRenderOrigin.StackGalleryCanvas?ve.radiusCurrentUser:ve.radiusOtherUser);const s=this.state.fileSizeInformation.formattedString;let o,a=!1;switch(this.state.status){case me.DOWNLOADING:case me.UPLOADING:a=!0;break;case me.UPLOAD_ERROR:case me.ERROR:case me.SUCCESS:break;case me.INITIAL:a=!0;case me.NONE:}if(a){const e={backgroundColor:this._themeColors.surfacePlaceholderFixed},t={backgroundColor:this._themeColors.surfaceOverlayFixed};o=(0,i.jsx)(l.View,Object.assign({style:[...ve.progressIndicatorMask,e]},{children:(0,i.jsx)(l.View,Object.assign({style:[ve.progressIndicatorForRedesign,t]},{children:this.state.status===me.INITIAL?(0,i.jsx)(B.default,{icon:pe.SkypeIcon.DownArrow,color:this._themeColors.iconPrimaryFixed,size:pe.IconSize.size24,style:ve.flexCenter}):(0,i.jsx)(le.default,{size:24,strokeWidth:2,strokeColor:this._themeColors.textPrimaryFixed,contentUrls:[this.props.contentUrl],showFiniteProgressIndicatorUI:!1})}))}))}let d=[ve.link,ve.contentContainer,this._themeStyles.cardColorStyle];this.props.message.isMyMessage()&&!this._useAccessibleTheme()&&d.push({backgroundColor:this._themeColors.bubble}),(0,E.default)(this.props.renderDimensions,v.FileNodeSizes.Small)?d.push(ve.contentContainerRestrictedSmall):(0,E.default)(this.props.renderDimensions,v.FileNodeSizes.Regular)&&d.push(ve.contentContainerRestricted),d=n.flatten([d,t]);const c=[ve.actionButtonText,se.default.fontStyle.cardAction];!this.state.isConnected&&this.state.status===me.NONE||!e?(c.push(this._themeStyles.disabledTextColorStyle),d.push(oe.default.defaultCursor)):c.push(this.state.isHovering?this._themeStyles.textHoverColorStyle:this._themeStyles.buttonTextColorStyle);const h=this._renderFooterView(),u=z.getStyleForDimensions({width:this.props.renderDimensions.width,height:void 0}),p=[ve.fileMetaText,l.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1)],g=[ve.fileMetaSeparator,l.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.textPrimary},!1)];return(0,i.jsxs)(r.DragDroppableView,Object.assign({onDragStart:this.props.isDraggingEnabled?this._onDragStartFile:void 0,dragThumbnailElement:this.props.isDraggingEnabled?this._getThumbnailElement():void 0,style:u},{children:[(0,i.jsx)(H.default.Button,Object.assign({ref:this._onFileNodeContainerRef,style:d,title:j.getString("FileTransfer.FileOpen"),onPress:e?this._onPress:void 0,onLongPress:e?this._onLongPress:void 0,onContextMenu:this.props.onContextMenu,underlayColor:this._themeColors.rowHighlightColor,activeOpacity:this.props.activeOpacityOverride,accessibilityLabel:this.state.accessibilityLabel,keepOriginalProps:!0,disabled:this.props.disableActions||!this.props.isFileAvailable,disabledOpacity:1},{children:(0,i.jsxs)(l.View,Object.assign({style:ve.textWrapperForRedesign,title:this.props.displayFilename},{children:[(0,i.jsxs)(l.View,Object.assign({style:ve.thumbnailContainer},{children:[this._renderCover(),o]})),(0,i.jsxs)(l.View,Object.assign({style:[ve.fileTypeSectionForRedesign]},{children:[(0,i.jsx)(B.default,{icon:this.state.fileInfo.icon,size:24,color:this._themeColors.iconPrimary||ee.Color.gray300,style:ve.fileTypeIconPaddingForRedesign}),(0,i.jsxs)(l.View,Object.assign({style:oe.default.flexOne},{children:[(0,i.jsx)(l.Text,Object.assign({style:[oe.default.flexOne,ve.fileName,{color:this._getContext().themeColors.textPrimary}],ellipsizeMode:"middle",numberOfLines:1},{children:this.state.cardTitle})),(0,i.jsxs)(l.View,Object.assign({style:[ve.fileMetaSection]},{children:[(0,i.jsx)(l.Text,Object.assign({style:p,numberOfLines:1},{children:s})),(0,i.jsx)(l.View,{style:g}),(0,i.jsx)(re.Caption,Object.assign({style:p,numberOfLines:1},{children:this.state.fileInfo.displayString}))]}))]}))]}))]}))}),"file"),h]}))}requestFocus(){this._fileNodeContainerRef&&this._fileNodeContainerRef.requestFocus()}_renderFooterView(){let e,t=this.state.wasCreatedByCurrentUser?ve.fileFooterTextAlignRight:ve.fileFooterTextAlignLeft;if(this.state.status===me.UPLOAD_ERROR||this.state.sendingFailed){const s=j.getString("MediaNode.SendingFailed");e=(0,i.jsx)(ge.default,Object.assign({style:[t]},{children:(0,i.jsx)(re.Caption,{children:s})}))}if(this.state.status===me.DOWNLOAD_ERROR){const s=j.getString("MediaNode.DownloadFailed");e=(0,i.jsx)(ge.default,Object.assign({style:[t]},{children:(0,i.jsx)(re.Caption,{children:s})}))}if(!this.props.isFileAvailable){let s;this.props.renderOrigin!==M.MessageRenderOrigin.CompositeGalleryCanvas&&this.props.renderOrigin!==M.MessageRenderOrigin.StackGalleryCanvas||(t=ve.fileFooterTextAlignLeft);const o=(0,i.jsx)(l.Link,Object.assign({url:h.default.getConfigSettingsNoSubscription().fileNode.learnMoreLink,onPress:this._onFileLearnMorePress,style:[ve.learnMoreLink,ye]},{children:j.getString("FileTransfer.FileLearnMoreLinkText")}),"FileLearnMoreLink "),n=j.getParts("FileTransfer.FileNotAvailableMessage",{learnMoreLink:o}),r=(0,i.jsx)(re.Caption,Object.assign({style:t,allowFontScaling:!1},{children:n})),a=!1;a&&(s=S.default.linkAccessibilityInfo(j.getString("FileTransfer.FileNotAvailableMessage",{learnMoreLink:j.getString("FileTransfer.FileLearnMoreLinkText")}),!0)),e=(0,i.jsx)(l.View,Object.assign({style:ve.FileFooterContainer,importantForAccessibility:l.Types.ImportantForAccessibility.Yes,accessibilityLabel:s?s.label:void 0,accessibilityTraits:s?s.traits:void 0,onPress:a?this._onFileLearnMorePress:void 0,onKeyPress:this._onFileLearnMoreKeyPress},{children:r}))}return e}_downloadFile(e,t){this.setState({isUpload:!1});const{showLargeFileDownloadPrompt:s}=this.state,i=t&&this.state.allowAutoDownloadFiles;if(e)i?this._autoDownloadFile():this._checkFileStatusWrapperOrWeb();else{const e=this.state.networkType===d.DeviceNetworkType.Wifi,t=this.props.fileSizeInBytes>=fe;!e&&s&&!i&&t?this._showPromptForLargeFiles():this._checkFileStatus()}}_sendTelemetryEvent(e,t,s){const i=o.pii.Omit(s.targetUri||""),n=new V.FileReceived(i,void 0,ne.default.extractExtensionForTelemetry(s.filename));n.setDownloadDuration(Date.now()-s.startTime),n.setSuccess(e,t,s.finishedAttemptsSoFar,s.responseStatusCode),D.track(n)}_checkFileStatusWrapperOrWeb(){const e=this.props.displayFilename,t=C.default.getDisplayName(this.props.authorMri,!0)||this.props.authorMri,s=e.lastIndexOf(".")+1,i=e.substring(s,s+e.length),o=h.default.getS4LMessagingFeatures().unsafeFiles.indexOf(i)>=0,n=j.getString(o?"FileTransfer.AcceptUnsafeFileMessage":"FileTransfer.AcceptFileMessage",{fileName:e,senderName:t});let r="";const a=[{text:j.getString("FileTransfer.FileAccept"),onPress:this._downloadFileWebOrWrapper,isSubmit:!0},{text:j.getString("Global.CancelLabel"),isCancel:!0}];if(o)r=j.getString("FileTransfer.UnsafeFileHeader");else{if(!this.state.showFileDownloadPrompt)return this._downloadFileWebOrWrapper();a.push({text:j.getString("FileTransfer.DontAskMeAgain"),onPress:()=>(this._downloadFileWebOrWrapper(),G.default.setUserPreferencesLocal({dontShowAcceptFileDialog:!0}),!0)})}c.default.showWithOptions({title:r,message:n,dialogAccessibilityTitle:n,buttons:a,rootViewId:this._getRootViewId()})}_checkFileStatus(){const e=h.default.getS4LMessagingFeatures().unsafeFiles.indexOf(this.state.fileExtension)>=0,t=C.default.getDisplayName(this.props.authorMri,!0)||this.props.authorMri,s=this.props.displayFilename,i=j.getString(e?"FileTransfer.AcceptUnsafeFileMessage":"FileTransfer.AcceptFileMessage",{fileName:s,senderName:t}),o=[{text:j.getString("FileTransfer.FileAccept"),onPress:this._downloadFileRN},{text:j.getString("Global.CancelLabel")}];e?c.default.showWithOptions({title:j.getString("FileTransfer.UnsafeFileHeader"),message:i,dialogAccessibilityTitle:i,buttons:o,rootViewId:this._getRootViewId()}):this.state.showFileDownloadPrompt?(o.push({text:j.getString("FileTransfer.DontAskMeAgain"),onPress:()=>{this._downloadFileRN(),G.default.setUserPreferencesLocal({dontShowAcceptFileDialog:!0})}}),c.default.showWithOptions({title:j.getString("FileTransfer.AcceptFileHeader"),dialogAccessibilityTitle:i,message:i,buttons:o,rootViewId:this._getRootViewId()})):this._downloadFileRN()}_processFile(){}_trackShare(e,t){const s=new W.ShareFileMessageTelemetry(this.props.message.conversationId,this.props.message,this.props.message.createdTime,W.MessageActionOrigin.FileNode,W.MessageActionType.ShareFile,this.state.fileExtension,!1);D.track(s)}_getEncryptionData(){return this.props.message.getFileEncryptionKeys()}_getThumbnailElement(){return(0,i.jsx)(B.default,{icon:this.state.fileInfo.icon,size:24,color:this.props.mediaPlaceholderIconColor||ee.Color.gray300,style:[ve.draggableThumbnailContainer,this._themeStyles.primaryBackgroundColorStyle,this._themeStyles.dividerBorderColorStyle]})}}t.FileNodeForRedesign=be},373560:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GenderLocalizedMessage=t.localizeMessageString=t.localizeMessageParts=void 0;const i=s(217041),o=s(671830),n=s(647662),r=s(733754),a=s(478262),l=s(172758),d="gender";function c(e,t){const s=e&&!o.isThread(e)&&l.default.getFullUserProfileByMri(e).gender||a.eGender.Unspecified;return t[d]=n.getLocalizeParamForGender(s),t}t.localizeMessageParts=function(e,t,s){const i=c(e,s);return r.getParts(t,i)},t.localizeMessageString=function(e,t,s){const i=c(e,s);return r.getString(t,i)};class h extends i.ComponentBase{_buildState(e,t){const s=c(e.mri,e.localizeParams);return{messageParts:r.getParts(e.localizeKey,s)}}render(){return this.props.renderMessage(this.state.messageParts,this.props.tree)}}t.GenderLocalizedMessage=h},305406:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HighlightedNode=void 0;const i=s(785893),o=s(217041),n=s(667294),r=s(516778),a=s(915877),l=s(258187),d=s(89808),c=s(889391),h=s(10102),u=s(680837),p=(0,a.lazyProperties)({searchResultBackgroundStyle:()=>r.Styles.createViewStyle({padding:2,borderRadius:3})}),g=({allowTextSelection:e,children:t,currentSearchResultBackgroundColor:s,currentSearchResultTextColor:o,isGlobalSearch:a,isPrimarySearchResult:d,searchResultsBackgroundColor:c,searchResultsTextColor:g,textOverrideStyle:m,modernizeSearchPanel:S})=>{const{userColor:{primaryAccent:f}}=(0,l.useCommonContext)(),{primaryAccent:y}=(0,h.getDefaultUnknownColorInfo)(),v=n.useMemo((()=>{const{addPaddings:e,backgroundStyle:t,textStyle:i}=((e,t,s,i,o,n,a,l,d)=>{let c,h,p=!1;return a&&l?(c=u.default.transparentBackground,h=r.Styles.createTextStyle({color:null!=e?e:t},!1)):(c=r.Styles.createViewStyle({backgroundColor:d?s:i},!1),h=r.Styles.createTextStyle({color:d?o:n},!1),p=!0),{addPaddings:p,backgroundStyle:c,textStyle:h}})(f,y,s,c,o,g,S,null!=a&&a,d);let n=[t,i];return e&&n.push(p.searchResultBackgroundStyle),m&&(n=[m,n]),n}),[S,a,m,f,y,d,s,c,o,g]);return(0,i.jsx)(r.Text,Object.assign({style:v,selectable:e},{children:t}))};t.HighlightedNode=(0,o.withResubAutoSubscriptions)((e=>{const{isOwnMessage:t}=e,{modernizeSearchPanel:s}=c.default.getS4LMessagingFeatures(),o=d.default.getCurrentSearchResultBackgroundColor(),n=d.default.getSearchResultsBackgroundColor(t),r=d.default.getCurrentSearchResultTextColor(),a=d.default.getSearchResultsTextColor(t);return(0,i.jsx)(g,Object.assign({},e,{modernizeSearchPanel:s,searchResultsTextColor:a,currentSearchResultTextColor:r,currentSearchResultBackgroundColor:o,searchResultsBackgroundColor:n}))}))},831807:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlInlineImage=void 0;const i=s(785893),o=s(499560),n=s(516778),r=s(244770),a=s(889391),l=s(265976),d=s(662602),c=s(677381),h=s(139889),u=s(753559),p=s(913944),g=s(915877),m=s(733754),S=s(633596),f=s(342653),y=s(945983),v=s(570561),C=s(268080),_=s(581760),b=s(711828),T=s(734528),M=s(478262),I=s(680837),w=s(675865),P=s(626712),k=(0,g.lazyProperties)({backgroundImage:()=>[I.default.absoluteFill,n.Styles.createViewStyle({opacity:.5})],alternateViewContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",backgroundColor:_.Color.gray200}),headerContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"flex-end",backgroundColor:_.Color.transparent}),moreButton:()=>n.Styles.createTextStyle({height:48,width:48})});class A extends c.default{constructor(){super(...arguments),this._mediaViewerController={getOptions:()=>({animateOpenClose:!0,showCustomHeader:!0,showCustomFooter:!1}),renderCustomHeader:(e,t)=>(0,i.jsx)(n.View,Object.assign({style:k.headerContainer},{children:(0,i.jsx)(p.default,{ref:this._setMoreButtonRef,size:b.IconSize.size24,style:k.moreButton,onPress:t=>this._showMoreMenu(t,e),color:_.Color.white,hoverColor:_.Color.gray300,icon:T.moreIcon(),title:m.getString("Global.MoreOptions")})})),renderCustomFooter:e=>(0,i.jsx)(f.default,{hideLeftButton:!1,hideRightReactionButton:!0,message:this.props.message,mediaDescriptor:e}),getMediaLocationInWindow:e=>d.default.measureLayoutRelativeToWindow((()=>this))},this._setMoreButtonRef=e=>{this._moreButton=e||void 0},this._onPress=e=>{const t=`${this.props.message.cuid}_${o(this.props.source).toString()}`,s=u.default.extractFileNameWithExtension(this.props.source),i=u.default.extractFileExtension(s)?s:t+".jpg",n=this.props.originalDimensions.width&&this.props.originalDimensions.height?{width:this.props.originalDimensions.width,height:this.props.originalDimensions.height}:void 0,r=this.props.thumbnailDimensions.width&&this.props.thumbnailDimensions.height?{width:this.props.thumbnailDimensions.width,height:this.props.thumbnailDimensions.height}:void 0,a={id:t,mediaType:y.MediaViewerTypes.Picture,downloadFileName:i,thumbnailUrl:this.state.thumbnailUrl,displayResolutionUrl:this.state.fullSizeUrl,fullResolutionUrl:this.state.fullSizeUrl,originalSize:n,thumbnailSize:r};C.default.showWithConfig({initialMedia:a,controller:this._mediaViewerController,rootViewId:this._getRootViewId()})}}_showMoreMenu(e,t){v.default.showWithConfig({message:this.props.message,mediaDescriptor:t,componentContext:this._getContext(),anchor:()=>this._moreButton,invokingEvent:e})}_buildState(e,t){let s,i;const o=l.getDocumentId(e.source);if(o)s=l.getDisplayUrl(o,M.UploadFileType.Picture,M.MediaViewSize.ThumbnailUncropped),i=l.getDisplayUrl(o,M.UploadFileType.Picture,M.MediaViewSize.Full);else{const t=a.default.getS4LMessagingFeatures().asmImageProxy;s=P.default.addUrlParameter(t,"url",encodeURIComponent(e.source)),i=s}return{thumbnailUrl:w.default.getAuthenticatedUrl(s),fullSizeUrl:w.default.getAuthenticatedUrl(i)}}render(){const e=[k.alternateViewContainer],t=(0,i.jsx)(n.View,Object.assign({style:e},{children:(0,i.jsx)(n.Image,{style:k.backgroundImage,resizeMode:"cover",source:r.Collection.WIGGLE_PATTERN_350})})),s=S.getStyleForDimensions(this.props.thumbnailDimensions);return(0,i.jsx)(h.default,{origin:"HtmlNode",containerStyle:s,style:[this.props.style,s],source:this.state.thumbnailUrl,resizeMode:"contain",onPress:this._onPress,altView:t,errorView:t})}}t.HtmlInlineImage=A},491754:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlNode=void 0;const i=s(785893),o=s(823719),n=s(496486),r=s(445680),a=s(516778),l=s(351077),d=s(677381),c=s(913991),h=s(831807),u=s(17213),p=s(57199),g=s(312762),m=s(18078),S=s(758962),f=s(700960),y=s(680837);class v extends d.default{constructor(){super(...arguments),this._createEmoticonNodeFromHtml=e=>{const t=g.PlainTextNode.fromPlainText("("+e+")"),s=new g.EmoticonNode(t,e,void 0),i=n.clone(this.props.options);i.allowLargeEmoticons=!1,i.allowHugeEmoticons=!1;return this.props.createChildReact([s],i).value},this._createImageNodeFromHtml=(e,t)=>{const s={width:this._getPixelDimension(t.width),height:this._getPixelDimension(t.height)},o=c.getScaledThumbnailDimensions(s,this.props.renderDimensions);return{result:(0,i.jsx)(h.HtmlInlineImage,{message:this.props.message,originalDimensions:s,thumbnailDimensions:o,style:t,source:e}),renderInline:!1}},this._createAtMentionNodeFromHtml=e=>{const t=l.getTeamsMentionProperties(this.props.message.properties);if(t){const s=n.find(t,(t=>t.itemid+""==e+""));if(s&&s.mri){const t=s.displayName,i=g.PlainTextNode.fromPlainText(t||e),o=new g.AtMentionNode([i],s.mri,!1,e);let r;this.props.tree.isQuote()?(r=n.clone(this.props.options),r.textOverrideStyle=r.quotedTextStyle):r=this.props.options;return this.props.createChildReact([o],r).value}}},this._createTextNodeFromHtml=e=>{const t=e.replace(/\r\n/g,"\n");return v.highlightText(this.props.tree,this.props.message,t)||t},this._onScrollViewLayout=e=>{this._scrollLayoutWidth=e.width,this._updateScrollIndicator()},this._onContentSizeChange=(e,t)=>{this._scrollContentWidth=e,this._updateScrollIndicator()}}_buildState(e,t){let s;const i=this.props;if(t||e.tree!==i.tree){const t=[],i=e.tree.getHtmlDom(),r=this._transformHtmlForRendering(n.cloneDeep(i),t,e.tree.isQuote());n.each(t,(e=>o.DomUtils.removeElement(e))),s=new p.default(r)}else s=this.state.htmlDom;return{htmlDom:s,renderResult:r.default.htmlToReact(s.value,{defaultTextStyle:[e.options.regularTextStyle,e.options.textOverrideStyle,y.default.overflowVisible],emoticonSize:S.frameHeights.emoticons.SMALL,renderEmoticon:this._createEmoticonNodeFromHtml,renderImage:this._createImageNodeFromHtml,renderAtMention:this._createAtMentionNodeFromHtml,renderTextNode:this._createTextNodeFromHtml}),needsHorizontalScroll:this.state&&this.state.needsHorizontalScroll||!1}}_transformHtmlForRendering(e,t,s){return n.map(e,(e=>{if(s&&"text"===e.type&&n.trim(e.data)){const t=e.parent;if(t&&"tag"===t.type&&"i"===t.name)return e;const s=new o.Element("i",{},[e]);return o.DomUtils.replaceElement(e,s),s}if("tag"===e.type&&"img"===e.name&&e.attribs&&e.attribs.itemtype===u.SemanticObjectSchemas.amsImage){const s=o.DomUtils.getSiblings(e),i=n.findIndex(s,e);if(i>=0){let e=i-1;for(;e>=0&&this._checkForLineBreaks(s[e],t);)e--;for(e=i+1;e<s.length&&this._checkForLineBreaks(s[e],t);)e++}}return e.children&&(e.children=this._transformHtmlForRendering(e.children,t,s)),e}))}_checkForLineBreaks(e,t){return"tag"===e.type&&"br"===e.name?(t.push(e),!0):"text"===e.type&&0===n.trim(e.data).length}_getPixelDimension(e){if(n.isString(e)&&n.endsWith(e,"px")){const t=e;return n.toNumber(t.slice(0,-2))}if(n.isNumber(e))return n.toNumber(e)}static highlightText(e,t,s){const i=e.getSearchQuery();if(i)return(0,f.transformToHighlightedText)(s,i,e.isPrimarySearchResult(),m.default.isMyMri(t.creator))}_updateScrollIndicator(){n.isUndefined(this._scrollContentWidth)||n.isUndefined(this._scrollLayoutWidth)||this.setState({needsHorizontalScroll:this._scrollContentWidth>this._scrollLayoutWidth})}render(){return(0,i.jsx)(a.ScrollView,Object.assign({style:y.default.flexOne,horizontal:!0,vertical:!1,showsHorizontalScrollIndicator:this.state.needsHorizontalScroll,onLayout:this._onScrollViewLayout,onContentSizeChange:this._onContentSizeChange},{children:this.state.renderResult}))}}t.HtmlNode=v},452859:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=(s(496486),s(516778)),n=s(719061),r=s(889391),a=s(677381),l=s(273145),d=s(746096),c=s(317873),h=s(436237),u=s(540522),p=(s(733754),s(519089)),g=s(812056),m=s(546529),S=s(600750),f=s(291319),y="web-link";class v extends a.default{_buildState(e){return{magicBotId:r.default.getS4LMessagingFeatures().magicBotId}}constructor(e){super(e),this._getReactionMenuAnchor=()=>this._linkRef,this._getContextMenuItems=()=>{let e=[];return this.props.messageActions&&(e=[...this.props.messageActions.actionMenuCommands]),this.props.supportsCopy&&e.push(S.CommandTypes.CopyLink),this._commandManager.getSXMenuItems(this._createCommandOptions(),e)},this._onLinkRef=e=>{this._linkRef=e||void 0},this._onPress=e=>{var t,s,i;if(!1!==this.props.linkClickable)if(this.props.onPressInterceptionCallback)this.props.onPressInterceptionCallback();else{if(c.default.potentiallyMarkItemViewed(this.props.message,this.props.renderOrigin),p.default.isPiPEnabled()){const e=f.default.getYoutubeVideoPropsFromUrl(this.props.url);if(e)return void p.default.setContentProps(e)}(null===(t=this.props.message)||void 0===t?void 0:t.creator)===this.state.magicBotId&&(null===(s=this.props.message)||void 0===s?void 0:s.conversationId)&&h.track(new g.MessageLink(null===(i=this.props.message)||void 0===i?void 0:i.conversationId)),u.openUrlWithParams({origin:d.BrowserOrigin.LinkNode,url:this.props.url,options:{conversationId:this.props.message?this.props.message.conversationId:void 0,preventInAppNavigationForGuest:!n.default.canNavigateInApp()},rootViewId:this._getRootViewId()})}else e.stopPropagation()},this._onStreamItemCommandSelected=(e,t)=>{this._intOnCommandSelected(e,t.rootViewId)},this._onCommandSelected=e=>{this._intOnCommandSelected(e,this._getRootViewId())},this._onLongPress=e=>{if(this.props.onLongPress)this.props.onLongPress(e);else if(this.props.supportsCopy){const t=[S.CommandTypes.CopyLink],s=this._createCommandOptions();this._commandManager.showSXPopup(s,t,y,(()=>this._linkRef),this._getRootViewId(),e)}},this._commandManager=new m.StreamItemCommandManager(this._onStreamItemCommandSelected)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s)}requestFocus(){this._linkRef&&this._linkRef.requestFocus()}render(){let e=(0,i.jsx)(o.Link,Object.assign({ref:this._onLinkRef,style:this.props.style,url:this.props.url,title:this.props.url,onPress:this._onPress,onLongPress:this._onLongPress,selectable:this.props.linkSelectable,numberOfLines:this.props.numberOfLines,maxContentSizeMultiplier:this.props.maxContentSizeMultiplier,tabIndex:this.props.onPressInterceptionCallback?-1:void 0},{children:this.props.children}));return this.props.onPressInterceptionCallback||(e=(0,i.jsx)(l.default,Object.assign({wrapperOnly:!1,getMenuItems:this._getContextMenuItems,onItemSelected:this._onCommandSelected,renderAsText:!0},{children:e}))),e}_intOnCommandSelected(e,t){this._commandManager.dismissSXPopup(y,t),this._commandManager.onActionMenuOptionSelected(this._createCommandOptions(),e)}_createCommandOptions(){return{message:this.props.message,decodedNode:this.props.decodedNode,url:this.props.url,onQuoteCallback:this.props.onQuote,onEditCallback:this.props.onEdit,renderOrigin:this.props.renderOrigin,getReactionMenuPopupAnchor:this._getReactionMenuAnchor,componentContext:this._getContext(),getRootWindowComponent:this._getReactionMenuAnchor}}}t.default=v},62523:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LongitudeDelta=t.LatitudeDelta=void 0;const i=s(785893),o=s(351444),n=s(516778),r=s(952262),a=s(746096),l=s(139889),d=s(907234),c=s(436237),h=s(915877),u=s(540522),p=s(733754),g=s(640392),m=s(546705),S=s(751176),f=s(751176),y=s(451072),v=s(18078),C=(s(104735),s(404057)),_=s(581760),b=s(478262),T=s(360305),M=s(619675),I=s(24576);t.LatitudeDelta=.0421,t.LongitudeDelta=.0221;const w=(0,h.lazyProperties)({container:()=>n.Styles.createViewStyle({width:S.MapWidth,height:S.LocationHeight,alignItems:"stretch"}),mapSnapshotStyle:()=>n.Styles.createViewStyle({height:0,width:0}),mapStyle:()=>n.Styles.createViewStyle({height:S.MapHeight,width:S.MapWidth}),locationPin:()=>n.Styles.createViewStyle({position:"absolute",top:S.MapHeight/2-g.PinSize/2,left:S.MapWidth/2-g.PinSize/2}),footerContainer:()=>n.Styles.createViewStyle({paddingHorizontal:10,height:S.FooterHeight,justifyContent:"center"}),footerRadius:()=>n.Styles.createViewStyle({borderBottomLeftRadius:10,borderBottomRightRadius:0}),footerRadiusOtherUsers:()=>n.Styles.createViewStyle({borderBottomLeftRadius:10,borderBottomRightRadius:10}),footerTextFirstLine:()=>n.Styles.createTextStyle({marginBottom:5}),mapSnapshotAlternateView:()=>n.Styles.createViewStyle({flex:1,alignSelf:"center",alignItems:"center",justifyContent:"center",width:S.MapWidth,height:S.MapHeight,backgroundColor:_.Color.gray200}),topRadius:()=>n.Styles.createViewStyle({borderTopLeftRadius:10,borderTopRightRadius:10}),topRadiusOtherUsers:()=>n.Styles.createViewStyle({borderTopLeftRadius:0,borderTopRightRadius:10})});class P extends I.default{constructor(){super(...arguments),this._setMapViewRef=e=>{this._mapView=e},this._onPress=e=>{c.track(new m.LocationViewerOpen(this.props.message.conversationId,this.props.message)),u.openUrlWithParams({origin:a.BrowserOrigin.LocationNode,url:this.props.bingMapsUrl,options:{conversationId:this.props.message?this.props.message.conversationId:void 0},rootViewId:this._getRootViewId()})},this._onLongPress=e=>{this.props.onLongPress&&this.props.onLongPress(e)}}_buildState(e,t){const s=f.default.getLocationRegionFromLatLong(e.latitude,e.longitude),i={wasOriginallyPostedByCurrentUser:v.default.isMyMri(e.originalCreatorMri),wasLastPostedByCurrentUser:v.default.isMyMri(e.message.creator),shouldRenderSnapshot:this._canTakeMapSnapshot(),latitudeValue:s.latitude,longitudeValue:s.longitude,fileId:f.default.getFileIdForLocation(e.message.cuid),useTabletUI:T.default.isTabletUI()};return i.wasOriginallyPostedByCurrentUser||(i.creatorName=r.default.getMemberShortNameForConversation(e.message.conversationId,e.originalCreatorMri)),d.default.isKnown(i.fileId)?i.mapSnapshotUri=d.default.getLocalUri(i.fileId):i.mapSnapshotUri=f.default.getBingMapsImageUrl(s,S.MapWidth,S.MapHeight),i}_canTakeMapSnapshot(){return!0}componentDidMount(){if(super.componentDidMount(),this.state.shouldRenderSnapshot&&!this.state.mapSnapshotUri&&this._mapView){const e={latitude:this.state.latitudeValue,longitude:this.state.longitudeValue,latitudeDelta:S.LatitudeLongitudeDelta,longitudeDelta:S.LatitudeLongitudeDelta*(S.MapWidth/S.MapHeight)};this._mapView.takeSnapshot(S.MapWidth,S.MapHeight,e,((e,t)=>{if(e)return void c.warn(a.LogTraceArea.LocationNode,"Unable to takeSnapshot: "+C.default.errorAsString(e));if(!t)return void c.warn(a.LogTraceArea.LocationNode,"Unable to takeSnapshot: snapshot is undefined");const s="file://"+t.uri;d.default.isKnown(this.state.fileId)||d.default.save(this.state.fileId,s,this.state.fileId+S.LocationSuffix+".png",Date.now()+6048e5,!1,d.CacheEvictionKind.Preview,Date.now()).then((()=>{this.isComponentMounted()&&this.setState({mapSnapshotUri:d.default.getLocalUri(this.state.fileId)})})).fail((e=>{c.warn(a.LogTraceArea.LocationNode,"Unable to move the screenshot: "+e.code)}))}))}}render(){const e={latitude:this.state.latitudeValue,longitude:this.state.longitudeValue,latitudeDelta:t.LatitudeDelta,longitudeDelta:t.LongitudeDelta};let s,r,a,d=this.props.addressFriendlyName;if(this.props.isUserLocation&&(d=this.state.wasOriginallyPostedByCurrentUser?p.getString("LocationPicker.YourLocationLabel"):p.getString("LocationPicker.OtherPersonLocationLabel",{name:this.state.creatorName||""})),d&&(s=(0,i.jsx)(M.CardTitle,Object.assign({style:w.footerTextFirstLine,numberOfLines:1},{children:d}))),this.props.fullAddress){const e=this.props.addressFriendlyName?this.props.shortAddress:this.props.fullAddress;r=(0,i.jsx)(M.Caption,Object.assign({textThemeColor:M.TextThemeColor.Primary,numberOfLines:1},{children:e}))}if(s||r){const e=[w.footerContainer,this._themeStyles.cardColorStyle,this.state.wasLastPostedByCurrentUser?w.footerRadius:w.footerRadiusOtherUsers];a=(0,i.jsxs)(n.View,Object.assign({style:e},{children:[s,r]}))}const c=(0,i.jsx)(g.default,{style:this.state.shouldRenderSnapshot?w.locationPin:void 0,userMri:this.props.originalCreatorMri,locationType:this.props.isUserLocation?b.LocationType.Current:b.LocationType.None},"locationpin"),h=this.state.shouldRenderSnapshot?c:(0,i.jsx)(o.MapMarker,Object.assign({coordinate:e},{children:c}));let u,m;const S=this.state.wasLastPostedByCurrentUser?w.topRadius:w.topRadiusOtherUsers;if(this.state.shouldRenderSnapshot){const e=[w.mapSnapshotAlternateView,S],t=(0,i.jsx)(n.View,Object.assign({style:e},{children:c}));m=(0,i.jsx)(l.default,Object.assign({origin:"LocationSnapshot",resizeMode:"cover",source:this.state.mapSnapshotUri,style:e,containerStyle:e,altView:t,errorView:t},{children:c}))}if(!this.state.mapSnapshotUri){const t=[this.state.shouldRenderSnapshot?w.mapSnapshotStyle:w.mapStyle,S];u=(0,i.jsx)(o.MapView,Object.assign({ref:this._setMapViewRef,initialRegion:e,style:t,scrollEnabled:!1,cacheEnabled:!1,pitchEnabled:!1,rotateEnabled:!1,showsUserLocation:!1,loadingEnabled:!1,zoomEnabled:!1,showsMyLocationButton:!0,toolbarEnabled:!1,liteMode:!0,disableRegionChangeUpdates:!0},{children:h}))}return(0,i.jsxs)(y.default.Button,Object.assign({style:[w.container,S],onPress:this._onPress,onLongPress:this._onLongPress,onContextMenu:this.props.onContextMenu,activeOpacity:this.props.activeOpacityOverride,keepOriginalProps:!0,disabled:this.props.disableActions,disabledOpacity:1},{children:[u,m,a]}),"location")}}t.default=P},272977:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(217041),n=s(616026),r=s(952262),a=s(733754),l=s(18078),d=s(711828);class c extends o.ComponentBase{_buildState(e,t){const s={postedByCurrentUser:l.default.isMyMri(e.authorMri)};return s.postedByCurrentUser||(s.creatorName=r.default.getMemberShortNameForConversation(e.conversationId,e.authorMri)),s}render(){let e=this.props.address;return this.props.isUserLocation?e=l.default.isMyMri(this.props.authorMri)?a.getString("LocationPicker.SharedCurrentLocationYou"):a.getString("LocationPicker.SharedCurrentLocation",{userName:this.state.creatorName||""}):e||(e=a.getString("ContentToReactTransformer.LocationMessageMediaIconPreviewLabel")),(0,i.jsx)(n.ContentPlaceholder,{icon:d.SkypeIcon.Location,label:e,numberOfLines:1,allowTextSelection:!1,mediaPlaceholderIconColor:this.props.mediaPlaceholderIconColor,regularTextStyle:this.props.regularTextStyle,textOverrideStyle:this.props.textOverrideStyle})}}t.default=c},424466:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaAlbumNode=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(986374),a=s(915877),l=s(733754),d=s(451072),c=s(518606),h=s(312762),u=s(106658),p=s(18078),g=s(330124),m=s(778302),S=s(144487),f=s(581760),y=s(311010),v=s(711828),C=s(680837),_=s(24576),b=s(815188),T=s(626712),M=s(5451),I=(0,a.lazyProperties)({albumStyle:()=>n.Styles.createViewStyle({flexDirection:"row",overflow:"hidden",justifyContent:"center"}),albumRow:()=>n.Styles.createViewStyle({flexDirection:"row"}),overflowNumberTransparentLayer:()=>n.Styles.createViewStyle({backgroundColor:f.Color.blackOverlay50}),overflowNumberContainer:()=>n.Styles.createViewStyle({justifyContent:"center",alignItems:"center"}),overflowNumber:()=>n.Styles.createTextStyle({color:f.Color.white,fontSize:28,position:"absolute"}),boldOverflowNumber:()=>n.Styles.createTextStyle({font:y.default.font.uiDisplayBold}),marginRight:()=>n.Styles.createViewStyle({marginRight:1}),marginBottom:()=>n.Styles.createViewStyle({marginBottom:1}),marginRightBottom:()=>n.Styles.createViewStyle({marginRight:1,marginBottom:1}),borderTopLeftRadius:()=>n.Styles.createViewStyle({borderTopLeftRadius:u.messageBorderRadius}),borderTopRightRadius:()=>n.Styles.createViewStyle({borderTopRightRadius:u.messageBorderRadius}),borderBottomRightRadius:()=>n.Styles.createViewStyle({borderBottomRightRadius:u.messageBorderRadius}),borderBottomLeftRadius:()=>n.Styles.createViewStyle({borderBottomLeftRadius:u.messageBorderRadius})});var w;!function(e){e.Picture="Picture",e.Video="Video"}(w||(w={}));class P extends _.default{constructor(){super(...arguments),this._renderProgressIndicator=()=>{if(this.state.isUploading)return(0,i.jsx)(b.default,{contentUrls:this.state.contentUrls,strokeColor:f.Color.white,size:v.IconSize.size60,showFiniteProgressIndicatorUI:!0,isUploadingCompleted:!this.state.isUploading})},this._renderOverflowNumber=e=>{if(!this._shouldRenderOverflowNumber())return;const{mediaItems:t}=this.state,s="+"+(t.length>4?t.length-4:1),o=[I.overflowNumber];this.state.isUsingStackNavigation&&o.push(I.boldOverflowNumber);const r=[C.default.absoluteFill,I.overflowNumberContainer],a=[];return(0,i.jsxs)(n.View,Object.assign({style:[r,...a]},{children:[(0,i.jsx)(n.View,{style:[I.overflowNumberTransparentLayer,C.default.absoluteFill,...a]}),(0,i.jsx)(n.Text,Object.assign({style:o},{children:s}))]}))},this._onPress=e=>{this.props.onPress&&this.props.onPress(e)},this._shouldRenderOverflowNumber=()=>{const{mediaItems:e}=this.state;return 3===e.length||e.length>4},this._determineNodesLength=()=>{const{mediaItems:e}=this.state;return o.take(e,3===e.length?2:4)},this._createAlbumStyle=()=>{const{width:e,height:t}=this._getCellDimensions();return n.Styles.createViewStyle({maxWidth:2*e+2,maxHeight:2*t+2},!1)},this._getCellDimensions=()=>{const e=this._getDesktopCellDimensions();return this.state.isUsingStackNavigation?{width:120,height:120}:{width:e.width,height:e.height}},this._getDesktopCellDimensions=()=>{const e=this._getContext().isPresentedInDesktopRightNav||this._getContext().isPresentedInDesktopLeftNav;return{width:e?100:140,height:e?100:140}}}_buildState(e,t){const s={linkedMessages:c.default.getNotFailedMediaMessagesForAlbum(e.albumId),isUsingStackNavigation:g.default.isUsingStackNavigationContext(),isSelectMessagesModeActive:S.default.isSelectMessagesModeActive(this._getRootViewId())},i=o.compact(o.map(s.linkedMessages,(e=>{const t=r.decode(e),s=t.getFirstUriObjectChild(h.PictureNode),i=t.getFirstUriObjectChild(h.VideoNode),o=s||i;if(o)return{message:e,contentUrl:o.getDisplayThumbnailUrlSanitized(),thumbnailUrl:o.getDisplayThumbnailUrlSanitized(),type:s?w.Picture:w.Video,onPress:t=>{c.default.setSelectedMediaForAlbum(e),this._onPress(t)},onFocus:()=>c.default.setSelectedMediaForAlbum(e)}})));return s.mediaItems=i,s.contentUrls=o.compact(o.filter(o.map(i,(e=>e.contentUrl)),(e=>T.default.isFileOrBlob(e)))),s.isUploading=!o.isEmpty(s.contentUrls),s.isPostedByCurrentUser=s.linkedMessages&&!o.isEmpty(s.linkedMessages)&&p.default.isMyMri(s.linkedMessages[0].creator),s}render(){const e=this.state.isSelectMessagesModeActive?n.Types.ImportantForAccessibility.NoHideDescendants:void 0,t=this.state.mediaItems.length,s=l.getString("AccessibilityLabel.MediaAlbumPhotos",{count:t}),r=this._renderAlbumItems();let a;return a=2===r.length?r:(0,i.jsxs)(n.View,{children:[(0,i.jsx)(n.View,Object.assign({style:I.albumRow},{children:o.take(r,2)})),(0,i.jsx)(n.View,Object.assign({style:I.albumRow},{children:o.takeRight(r,2)}))]}),(0,i.jsxs)(d.default.Button,Object.assign({onPress:this._onPress,keepOriginalProps:!0,style:this.props.containerRadiusStyles,importantForAccessibility:e,accessibilityLabel:s},{children:[(0,i.jsx)(n.View,Object.assign({style:[I.albumStyle,this._createAlbumStyle()]},{children:a})),this._renderProgressIndicator()]}),"album")}_renderAlbumItems(){const e=this._getCellDimensions(),t=this._determineNodesLength();return o.map(t,((s,o)=>{const r=n.Styles.createViewStyle(e,!1);let a;const l=void 0;a=s.type===w.Video?(0,i.jsx)(M.default,{contentUrl:s.contentUrl,thumbnailUrl:s.thumbnailUrl,authorMri:s.message.creator,renderDimensions:e,subType:void 0,message:s.message,isPresentedInAlbum:!0,containerStyles:[l,C.default.alignItemsCenter]},`albumItem-${s.message.cuid}`):(0,i.jsx)(m.default,{contentUrl:s.contentUrl,thumbnailUrl:s.thumbnailUrl,authorMri:s.message.creator,renderDimensions:e,message:s.message,isPresentedInAlbum:!0,containerRadiusStyles:l},`albumItem-${s.message.cuid}`);const d=o===t.length-1,c=this._getItemMargin(t.length,o);return(0,i.jsxs)(n.View,Object.assign({onPress:s.onPress,onFocus:s.onFocus,onLongPress:this.props.onLongPress,onContextMenu:this.props.onContextMenu,style:[r,c],importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants,activeOpacity:1},{children:[a,d&&this._renderOverflowNumber(o)]}),`albumItemButton-${s.message.cuid}`)}))}_getBorderRadiusStyleForItem(e,t){const s=[],i=0===t,o=1===t,n=2===t,r=3===t;return this.state.isPostedByCurrentUser?e<=3?i?(s.push(I.borderTopLeftRadius),s.push(I.borderBottomLeftRadius)):(o||n)&&s.push(I.borderTopRightRadius):i?s.push(I.borderTopLeftRadius):o?s.push(I.borderTopRightRadius):n&&s.push(I.borderBottomLeftRadius):e<=3?i?s.push(I.borderBottomLeftRadius):(o||n)&&(s.push(I.borderTopRightRadius),s.push(I.borderBottomRightRadius)):o?s.push(I.borderTopRightRadius):n?s.push(I.borderBottomLeftRadius):r&&s.push(I.borderBottomRightRadius),s}_getItemMargin(e,t){const s=[],i=0===t,o=1===t,n=2===t;return i&&s.push(I.marginRight),e>3&&(i&&s.push(I.marginRightBottom),o&&s.push(I.marginBottom),n&&s.push(I.marginRight)),s.push(I.marginRight),s}}t.MediaAlbumNode=P},118317:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NgcUpgradeSystemMessageNode=t.ngcUpgradeMessageText=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(217041),a=s(671830),l=s(952262),d=s(733754);function c(e){return a.isMri(e)?l.default.getDisplayName(e):e}function h(e){let t;if(1===o.size(e))t=d.getString("NgcUpgradeNode.NgcUpgradeOneMessage",{user:c(e[0])||""});else{const s=o.last(e),i=o.filter(e,(e=>e!==s));t=d.getString("NgcUpgradeNode.NgcUpgradeManyMessage",{users:o.map(i,(e=>c(e))).join(", "),lastUser:c(s)||""})}return t}t.ngcUpgradeMessageText=h;class u extends r.ComponentBase{_buildState(e,t){return{ngcUpgradeMessage:h(e.userMrisOrNames)}}render(){return(0,i.jsx)(n.Text,Object.assign({style:[this.props.systemTextStyle,this.props.textOverrideStyle],numberOfLines:this.props.numberOfLines||0},{children:this.state.ngcUpgradeMessage}),"ngcUpgradeMessage")}}t.NgcUpgradeSystemMessageNode=u},778302:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(477517),n=s(516778),r=s(244770),a=s(103291),l=s(770891),d=s(746096),c=s(139889),h=s(110117),u=s(436237),p=s(915877),g=s(733754),m=s(451072),S=s(633596),f=s(42036),y=s(18078),v=s(144487),C=s(581760),_=s(711828),b=s(680837),T=s(619675),M=s(24576),I=s(815188),w=s(675865),P=s(626712),k=s(265976),A=(0,p.lazyProperties)({pictureContainer:()=>n.Styles.createViewStyle({justifyContent:"center"}),pictureContainerHidden:()=>n.Styles.createViewStyle({opacity:0}),overlayCenteredContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),overlayContainerBackground:()=>n.Styles.createViewStyle({backgroundColor:C.Color.blackOverlay10}),actionButtonborderStyle:()=>n.Styles.createViewStyle({backgroundColor:C.Color.blackOverlay10,borderStyle:"solid",borderWidth:2,borderColor:C.Color.white,alignItems:"center",justifyContent:"center"}),absolutPositionStyle:()=>n.Styles.createViewStyle({position:"absolute"}),alternateViewContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",backgroundColor:C.Color.gray200}),retryButtonSmallSizeStyle:()=>n.Styles.createViewStyle({borderRadius:_.IconSize.size48/2,width:_.IconSize.size48,height:_.IconSize.size48}),retryButtonNormalSizeStyle:()=>n.Styles.createViewStyle({borderRadius:_.IconSize.size60/2,width:_.IconSize.size60,height:_.IconSize.size60}),backgroundImage:()=>[b.default.absoluteFill,n.Styles.createViewStyle({opacity:.5})],draggableThumbnailContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",width:60,height:60,shadowRadius:1,shadowOffset:{width:0,height:2},shadowColor:C.Color.blackOverlay20,borderRadius:10,borderWidth:1}),footerContainer:()=>n.Styles.createViewStyle({flexGrow:1,flexShrink:1}),footerTextAlignRight:()=>n.Styles.createViewStyle({alignItems:"flex-end"})});class x extends M.default{constructor(){super(...arguments),this._onPress=e=>{this.state.sendingFailed&&this.props.isRetryCommandSupported?(this._onRetryClick(),e.stopPropagation()):this.props.onPress&&this.props.onPress(e)},this._onImageRef=e=>{this._errorSafeImage=e||void 0},this._onLocalThumbnailError=()=>{this._onError(this.state.localUrl)},this._onThumbnailError=()=>{this._onError(this.props.thumbnailUrl)},this._onThumbnailLoad=()=>{this.setState({thumbnailLoaded:!0}),this.props.onThumbnailLoaded&&this.props.onThumbnailLoaded(!0)},this._onDragStartPicture=e=>{a.default.addDragAndDropFileInformation(e,this.props.message)}}_buildState(e,t){const s={contentUrl:w.default.getAuthenticatedUrl(e.contentUrl),thumbnailUrl:w.default.getAuthenticatedUrl(e.thumbnailUrl),wasCreatedByCurrentUser:y.default.isMyMri(e.authorMri),sendingFailed:e.message.isSendRejected(),isSelectMessagesModeActive:v.default.isSelectMessagesModeActive(this._getRootViewId())};return t&&(s.isImageHidden=!1),P.default.isFileOrBlob(e.thumbnailUrl)?(s.localUrl=e.thumbnailUrl,s.isUploading=!0,s.showAltView=!0):s.isUploading=!1,s}componentDidMount(){super.componentDidMount(),this.props.onMountContent&&this.props.onMountContent("PictureNode",this,!0)}componentWillUnmount(){super.componentWillUnmount(),this.props.onMountContent&&this.props.onMountContent("PictureNode",this,!1)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.isUploading&&!this.state.isUploading&&this.setState({showAltView:!1})}getThumbnailDimensions(){let e;return this._errorSafeImage&&(e=this._errorSafeImage.getNativeImageSize()),e}hideNode(){this.isComponentMounted()&&(this.setState({isImageHidden:!0}),this.props.onHideContent&&this.props.onHideContent())}showNode(){this.isComponentMounted()&&(this.setState({isImageHidden:!1}),this.props.onShowContent&&this.props.onShowContent())}render(){let e,t=this.state.isUploading||this.props.isMessageInSendingState;this.state.sendingFailed&&(t=!1);const s=S.getStyleForDimensions(this.props.renderDimensions),a=S.getStyleForDimensions({width:this.props.renderDimensions.width,height:void 0});let l=_.IconSize.size60;this._isPictureSmall()&&(l=_.IconSize.size48),t&&(e=(0,i.jsx)(I.default,{contentUrls:[this.state.contentUrl],strokeColor:C.Color.white,size:l,showFiniteProgressIndicatorUI:!0,isUploadingCompleted:!this.state.isUploading}));const d=[A.pictureContainer];this.state.isImageHidden&&d.push(A.pictureContainerHidden);const u=[A.alternateViewContainer,this.props.containerRadiusStyles],p=(0,i.jsx)(n.View,Object.assign({style:u},{children:(0,i.jsx)(n.Image,{style:A.backgroundImage,resizeMode:"cover",source:r.Collection.WIGGLE_PATTERN_350})})),g=(0,i.jsx)(n.View,Object.assign({style:u},{children:(0,i.jsx)(n.Image,{style:A.backgroundImage,resizeMode:"cover",source:r.Collection.WIGGLE_PATTERN_350})})),f=n.Styles.createImageStyle({overlayColor:this._themeColors.messageStreamBackgroundColor},!1);let y;const v=[S.defaultStyles.pictureDefaultThumbnail,s,f,this.props.containerRadiusStyles],T=[d,this.props.containerRadiusStyles,s];this.state.localUrl&&(0,k.isAmsDomainUrl)(this.state.localUrl)&&(y=(0,i.jsx)(c.default,{origin:"PictureNodeLocalImage",style:v,containerStyle:T,source:this.state.localUrl,altView:p,errorView:g,onError:this._onLocalThumbnailError,onLoad:this._onThumbnailLoad,resizeMode:"cover"},"localImage"));const M=this.state.thumbnailUrl&&(0,k.isAmsDomainUrl)(this.state.thumbnailUrl)?this.state.thumbnailUrl:void 0,w=(0,i.jsx)(c.default,{ref:this._onImageRef,origin:"PictureNodeImage",style:v,containerStyle:T,source:M,altView:y||p,errorView:g,onError:this._onThumbnailError,onLoad:this._onThumbnailLoad,resizeMode:"cover",showAltView:this.state.showAltView});let P;if(this.state.thumbnailLoaded){let e;this.props.showDownloadIcon&&(e=(0,i.jsx)(n.View,Object.assign({style:A.actionButtonborderStyle},{children:(0,i.jsx)(h.default,{icon:_.SkypeIcon.Down,size:_.IconSize.size24,color:C.Color.white})})));const t=[b.default.absoluteFill,A.overlayCenteredContainer,this.props.containerRadiusStyles,A.overlayContainerBackground];P=(0,i.jsx)(o.DragDroppableView,Object.assign({style:t,onDragStart:this.props.isDraggingEnabled?this._onDragStartPicture:void 0,dragThumbnailElement:this.props.isDraggingEnabled?this._getDraggableThumbnailElement():void 0},{children:e}))}const x=this._isPictureSmall()?A.retryButtonSmallSizeStyle:A.retryButtonNormalSizeStyle,R=this.state.sendingFailed&&this.props.isRetryCommandSupported?(0,i.jsx)(n.View,Object.assign({style:[A.actionButtonborderStyle,A.absolutPositionStyle,x]},{children:(0,i.jsx)(h.default,{icon:_.SkypeIcon.Reload,size:_.IconSize.size24,color:C.Color.white})})):void 0,O=this._getPictureNodeButtonTitle();let L=(0,i.jsxs)(m.default.Button,Object.assign({style:[d,s,this.props.containerRadiusStyles,b.default.alignItemsCenter],title:O,onPress:this._onPress,onLongPress:this.props.onLongPress,onContextMenu:this.props.onContextMenu,activeOpacity:this.props.activeOpacityOverride,keepOriginalProps:!0,disabled:this.props.disableActions,disabledOpacity:1,importantForAccessibility:this.state.isSelectMessagesModeActive?n.Types.ImportantForAccessibility.No:void 0},{children:[w,P,R,e]}),"picture");this.props.isPresentedInAlbum&&(L=(0,i.jsxs)(n.View,Object.assign({style:[d,s,this.props.containerRadiusStyles,b.default.alignItemsCenter],title:O},{children:[w,P]}),"picture"));const F=this._renderFooterView();return F?(0,i.jsxs)(n.View,Object.assign({style:[d,a]},{children:[L,F]})):L}_onRetryClick(){f.default.retryFailedSend(this.props.message)}_onError(e){this.props.onThumbnailLoaded&&this.props.onThumbnailLoaded(!1),u.warn(d.LogTraceArea.GenericUnsafe,"Failed to load image for PictureNode: "+e)}_renderFooterView(){let e;if(this.state.sendingFailed){const t=this.props.isRetryCommandSupported?g.getString("MediaNode.SendingFailed"):g.getString("MediaNode.MediaNotAvailableForSending");e=(0,i.jsx)(n.View,Object.assign({style:[A.footerContainer,this.state.wasCreatedByCurrentUser?A.footerTextAlignRight:void 0]},{children:(0,i.jsx)(T.Caption,{children:t})}))}return e}_getDraggableThumbnailElement(){return(0,i.jsx)(n.Image,{source:this.props.thumbnailUrl,style:[A.draggableThumbnailContainer,this._themeStyles.dividerBorderColorStyle]})}_isPictureSmall(){return this.props.renderDimensions.width&&this.props.renderDimensions.width<75||this.props.renderDimensions.height&&this.props.renderDimensions.height<75}_getPictureNodeButtonTitle(){return this.state.sendingFailed?g.getString("FileTransfer.RetryImageSendAction"):this.props.fileName&&this.props.renderOrigin&&this.props.renderOrigin===l.MessageRenderOrigin.CompositeGalleryCanvas?g.getString("FileTransfer.ImageOpenWithFileName",{fileName:this.props.fileName}):g.getString("FileTransfer.ImageOpen")}}t.default=x},571837:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(934339),a=s(889391),l=s(816402),d=s(587134),c=s(110117),h=s(436237),u=s(915877),p=s(733754),g=s(526424),m=s(953569),S=s(435590),f=s(45151),y=s(371926),v=s(399375),C=s(581760),_=s(711828),b=s(619675),T=s(24576),M=(0,u.lazyProperties)({attribution:()=>(0,u.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",paddingTop:10,paddingBottom:15,paddingHorizontal:15}),text:()=>n.Styles.createTextStyle({lineHeight:16,paddingLeft:8})}),cardContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",overflow:"visible",width:240,borderTopLeftRadius:10,borderTopRightRadius:10,borderBottomLeftRadius:10,borderBottomRightRadius:0}),details:()=>(0,u.lazyProperties)({button:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",marginVertical:12,marginHorizontal:3}),text:()=>n.Styles.createTextStyle({lineHeight:22})}),divider:()=>n.Styles.createViewStyle({height:1,backgroundColor:C.Color.white}),expiration:()=>(0,u.lazyProperties)({text:()=>n.Styles.createTextStyle({lineHeight:16,paddingTop:10,paddingLeft:15})}),title:()=>n.Styles.createTextStyle({lineHeight:24,paddingHorizontal:15,paddingTop:15,marginBottom:5}),winner:()=>(0,u.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"column",paddingHorizontal:15,paddingTop:15}),emoticonContainer:()=>n.Styles.createViewStyle({flexDirection:"column",paddingBottom:28,backgroundColor:C.Color.white,alignItems:"center"}),header:()=>n.Styles.createTextStyle({lineHeight:24}),text:()=>n.Styles.createTextStyle({paddingTop:15,paddingBottom:27,paddingHorizontal:15,color:C.Color.black}),textInPreviewMode:()=>n.Styles.createTextStyle({color:C.Color.black,paddingVertical:5}),title:()=>n.Styles.createTextStyle({lineHeight:16,paddingVertical:5,fontStyle:"italic"})})});class I extends T.default{constructor(){super(...arguments),this._onVote=e=>{v.selectVote(this.props.message,v.getMyVotes(this.state.pollVotes),e,this.props.expirationTimeMs,this.props.allowMultipleVotes,y.VoteOrigin.Card)},this._onViewPollDetails=()=>{h.track(new y.PollDetailsOpenedEvent(this.props.message)),m.default.navigateToPollSummaryPanel({conversationId:this.props.conversationId,message:this.props.message,title:this.props.title,expirationTimeMs:this.props.expirationTimeMs,options:this.props.options,allowMultipleVotes:this.props.allowMultipleVotes},this._getRootViewId())}}_buildState(e){const t=a.default.getS4LMessagingFeatures(),s=e.message.getPollData(),i=v.combinePollOptionsAndVotes(e.options,s,e.message,!1),o=f.default.getPollByMessageCuid(e.message.cuid);return{pollVotes:i,isPollExpired:v.isPollExpired(o?o.expirationTimeMs:e.expirationTimeMs),noVotesEmoticonName:t.pollNoVotesEmoticonName,winnerEmoticonName:t.pollWinnerEmoticonName}}render(){return this.state.isPollExpired?this._renderResultsCardForExpiredPoll():this._renderCardForUnexpiredPoll()}_renderResultsCardForExpiredPoll(){return(0,i.jsxs)(n.View,Object.assign({style:[M.cardContainer,this._themeStyles.cardColorStyle],importantForAccessibility:n.Types.ImportantForAccessibility.No},{children:[this._renderWinnerHeader(),this._renderAttribution(),(0,i.jsx)(d.default,{style:M.divider}),this._renderDetailsButton()]}),"pollCardNode_"+this.props.message.getLatestServerMessageId())}_renderCardForUnexpiredPoll(){return(0,i.jsxs)(n.View,Object.assign({style:[M.cardContainer,this._themeStyles.cardColorStyle],importantForAccessibility:n.Types.ImportantForAccessibility.No},{children:[this._renderTitle(),this._renderOptions(),this._renderExpiration(),this._renderAttribution(),(0,i.jsx)(d.default,{style:M.divider}),this._renderDetailsButton()]}),"pollCardNode_"+this.props.message.getLatestServerMessageId())}_renderWinnerHeader(){const e=v.getMaxVoteOptions(this.state.pollVotes),t=this.props.isActionable?(0,i.jsx)(b.CardTitle,Object.assign({style:[M.winner.header,this._themeStyles.headerTextColorStyle],useSmallTitle:!1},{children:this._getWinnerTitle(e)})):void 0;return(0,i.jsxs)(n.View,Object.assign({style:M.winner.container,importantForAccessibility:n.Types.ImportantForAccessibility.No},{children:[t,(0,i.jsx)(b.Caption,Object.assign({style:M.winner.title},{children:this.props.title})),this._renderWinnerIcon(e)]}),"pollCardNode_"+this.props.message.getLatestServerMessageId())}_getWinnerTitle(e){return!e||o.isEmpty(e)?p.getString("Poll.NoVotesWinnerLabel"):e.length>1?p.getString("Poll.TieLabel"):p.getString("Poll.WinnerLabel")}_renderWinnerIcon(e){const t=[M.winner.emoticonContainer];return this.props.isActionable||t.push(n.Styles.createViewStyle({paddingBottom:20})),(0,i.jsxs)(n.View,Object.assign({style:t,importantForAccessibility:n.Types.ImportantForAccessibility.No},{children:[(0,i.jsx)(b.CardTitle,Object.assign({style:this.props.isActionable?M.winner.text:M.winner.textInPreviewMode,useSmallTitle:!this.props.isActionable},{children:o.join(e,p.getString("Poll.TieVotesSeparator"))})),(0,i.jsx)(r.AnimatedEmoticon,{emoticonName:this._getEmoticonName(e),size:this.props.isActionable?g.EmoticonSize.ExtraLarge:g.EmoticonSize.Medium})]}))}_getEmoticonName(e){return o.isEmpty(e)?this.state.noVotesEmoticonName:this.state.winnerEmoticonName}_renderTitle(){return(0,i.jsx)(n.View,Object.assign({importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityLabel:p.getString("Poll.StreamItemAccessibilityLabel",{question:this.props.title})},{children:(0,i.jsx)(b.CardTitle,Object.assign({style:[M.title,this._themeStyles.headerTextColorStyle],useSmallTitle:!1},{children:this.props.title}))}))}_renderOptions(){if(!o.isEmpty(this.state.pollVotes)&&this.props.isActionable)return o.map(o.keys(this.state.pollVotes),((e,t)=>this._renderPollOption(t,e,this.state.pollVotes[e])))}_renderPollOption(e,t,s){return(0,i.jsx)(S.default,{expirationTimeMs:this.props.expirationTimeMs,index:e,onVote:this._onVote,option:t,users:s},"pollOption"+e)}_renderExpiration(){if(!this.props.isActionable)return;const e=p.getString("Poll.ExpirationDateLabel",{expirationDate:l.default.getConditionalDateTimeString(this.props.expirationTimeMs)});return(0,i.jsx)(b.Caption,Object.assign({style:M.expiration.text},{children:e}))}_renderAttribution(){return(0,i.jsxs)(n.View,Object.assign({style:M.attribution.container},{children:[(0,i.jsx)(c.default,{icon:_.SkypeIcon.Poll,size:_.IconSize.size16,color:this._themeColors.primaryIconColor}),(0,i.jsx)(b.Caption,Object.assign({style:M.attribution.text},{children:p.getString("Poll.Header")}))]}))}_renderDetailsButton(){if(!this.props.isActionable)return;const e=this.state.isPollExpired?p.getString("Poll.SummaryButtonTextAfterExpiration"):p.getString("Poll.SummaryButtonTextBeforeExpiration");return(0,i.jsx)(n.Button,Object.assign({style:M.details.button,accessibilityLabel:e,onPress:this._onViewPollDetails},{children:(0,i.jsx)(b.BodyText,Object.assign({style:M.details.text,bold:!0},{children:e}))}))}}t.default=I},500634:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QuoteOnly=t.QuoteNode=void 0;const i=s(785893),o=s(496486),n=(s(583367),s(516778)),r=s(217041),a=s(110117),l=s(476621),d=s(671830),c=s(616026),h=s(677381),u=s(539549),p=s(816402),g=s(952262),m=s(770891),S=s(913944),f=s(915877),y=s(733754),v=s(18078),C=s(29130),_=s(700960),b=s(581760),T=s(711828),M=s(734528),I=(s(360305),s(969716)),w=(0,f.lazyProperties)({quoteContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",backgroundColor:b.Color.transparent}),quoteContainerInDesktopComposer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginRight:15}),quoteContainerInForwardCanvas:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",paddingBottom:12}),quoteSeparator:()=>n.Styles.createViewStyle({borderStyle:"solid",borderBottomWidth:1,marginBottom:5}),quoteSeparatorInChat:()=>n.Styles.createViewStyle({marginBottom:14}),openQuote:()=>n.Styles.createViewStyle({marginBottom:4,flexDirection:"row"}),quoteTextDesktopStyles:()=>n.Styles.createTextStyle({paddingRight:4}),quoteAttribute:()=>n.Styles.createTextStyle({marginTop:6,marginBottom:12}),quoteContentContainer:()=>n.Styles.createViewStyle({flex:1,paddingLeft:20}),quoteContentContainerInForwardCanvas:()=>n.Styles.createViewStyle({flex:1,paddingHorizontal:10}),quoteContentTextInComposer:()=>n.Styles.createViewStyle({flex:1,maxHeight:250,alignSelf:"stretch"}),quoteContentTextInStream:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),clearQuoteButton:()=>n.Styles.createButtonStyle({position:"absolute",top:4,right:0,marginTop:-5})});class P extends h.default{constructor(){super(...arguments),this._onPressQuote=e=>{e.stopPropagation(),this.props.options.onPressInterceptionCallback?this.props.options.onPressInterceptionCallback():this.state.conversationIdForNavigation&&this.props.messageTimestamp&&this.props.options.onFollowQuoteLink&&this.props.options.onFollowQuoteLink(e,this.state.conversationIdForNavigation,this.props.messageTimestamp)},this._onLongPress=e=>{e.stopPropagation(),this.props.options.onLongPressContent&&this.props.options.onLongPressContent(e)}}_buildState(e,t){let s;if(e.authorSkypeId){const t=d.skypeIdToMri(e.authorSkypeId);t&&(s=g.default.getDisplayName(t))}s||(s=e.authorname||e.authorSkypeId);const i=y.getString("ContentToReactTransformer.QuoteNodeAttributeText",{name:s.trim(),date:p.default.getDisplayDateTimeString(e.timestamp)}),o=e.searchStore?e.searchStore.getSearchQuery():void 0;let n;n=o&&e.searchStore&&e.searchStore.isMessageInConvSearchResults(e.message.cuid)?(0,_.transformToHighlightedText)(i,o.query,e.searchStore.isMessageFocused(e.message.cuid),v.default.isMyMri(e.message.creator)):[i];const r=this._getRootViewId();return{attributeText:n,suppressAttribution:(e.options.renderOrigin,m.MessageRenderOrigin.ChatCanvas,e.options.renderOrigin===m.MessageRenderOrigin.ForwardCanvas),isSmallDevice:C.default.isSmallDevice(r),replySymbol:M.getReplySymbol(),conversationIdForNavigation:this._getConverstionIdForNavigation(e)}}render(){let e;if(!this.props.options.onlyQuotedContent||this.props.options.renderOrigin===m.MessageRenderOrigin.ForwardCanvas){const t=o.compact([w.quoteSeparator,this.props.options.renderOrigin===m.MessageRenderOrigin.ChatCanvas?w.quoteSeparatorInChat:void 0,this.props.options.quoteSeparatorStyle]);e=(0,i.jsx)(n.View,{style:t},"quote.separator")}const t=[this._getOpenQuote(),this._getQuoteContent()];let s,r=w.quoteContainer;this.props.options.renderOrigin===m.MessageRenderOrigin.ForwardCanvas?r=w.quoteContainerInForwardCanvas:this.props.options.renderOrigin!==m.MessageRenderOrigin.ChatCanvas&&this.props.options.renderOrigin!==m.MessageRenderOrigin.CallCanvas&&(r=w.quoteContainerInDesktopComposer);const a=[m.MessageRenderOrigin.ForwardCanvas,m.MessageRenderOrigin.MessageComposerCanvas];return s=o.includes(a,this.props.options.renderOrigin)?(0,i.jsx)(n.View,Object.assign({style:r},{children:t}),"quote.maybeclickable"):o.isUndefined(this.state.conversationIdForNavigation)?t:(0,i.jsx)(n.Button,Object.assign({style:r,onPress:this._onPressQuote,onLongPress:void 0,onContextMenu:this.props.onContextMenu,activeOpacity:this.props.options.activeOpacityOverride,disabled:this.props.options.disableActions,disabledOpacity:1},{children:t}),"quote.maybeclickable"),(0,i.jsxs)(n.View,Object.assign({style:w.quoteContainer},{children:[s,e,this._getQuoteCloseButton()]}))}_getConverstionIdForNavigation(e){if(!e.conversationId||!e.messageTimestamp)return;if(v.default.isMyMri(e.conversationId))return e.options.message&&e.options.message.creator;const t=l.default.getConversationMetaFromMemoryCache(e.conversationId);if(t&&(0,u.default)().ableToViewConversation(e.conversationId)){if(!t.conv.isThread()){if(o.isUndefined(e.authorSkypeId)||o.isUndefined(e.options.message))return;if(!v.default.isMyMri(d.skypeIdToMri(e.authorSkypeId))&&!v.default.isMyMri(e.options.message.creator))return}return e.conversationId}}_getOpenQuote(){var e,t,s,o;return(0,i.jsx)(a.default,{icon:this.state.replySymbol,size:null!==(t=null===(e=this.props.options.quoteSymbolStyle)||void 0===e?void 0:e.size)&&void 0!==t?t:T.IconSize.size16,color:null!==(o=null===(s=this.props.options.quoteSymbolStyle)||void 0===s?void 0:s.color)&&void 0!==o?o:b.Color.black,style:w.openQuote,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants},"quote.open")}_getQuoteContent(){const e=this.state.suppressAttribution?void 0:(0,i.jsx)(n.Text,Object.assign({style:[w.quoteAttribute,this.props.options.textOverrideStyle,this.props.options.quoteAttributeStyle]},{children:this.state.attributeText}),"quote.author"),t=this.props.options.renderOrigin===m.MessageRenderOrigin.ChatCanvas||this.props.options.renderOrigin===m.MessageRenderOrigin.ForwardCanvas||this.props.options.renderOrigin===m.MessageRenderOrigin.CallCanvas?w.quoteContentTextInStream:w.quoteContentTextInComposer,s=[this.props.options.textOverrideStyle,this.props.options.quotedTextStyle,w.quoteTextDesktopStyles],o=(0,I.hasOnlyInlineElements)(this.props.children)?(0,i.jsx)(n.Text,Object.assign({style:s,numberOfLines:this.props.numberOfLines},{children:this.props.children})):(0,i.jsx)(n.View,{children:this.props.children});let r;return this.props.narrowView||(r=this.props.options.renderOrigin===m.MessageRenderOrigin.ForwardCanvas?w.quoteContentContainerInForwardCanvas:w.quoteContentContainer),(0,i.jsxs)(n.View,Object.assign({style:r},{children:[(0,i.jsx)(n.View,Object.assign({style:t},{children:o})),e]}),"quote.content")}_getQuoteCloseButton(){return this.props.options.renderOrigin!==m.MessageRenderOrigin.ChatCanvas&&this.props.options.onClearQuote?(0,i.jsx)(S.default,{style:w.clearQuoteButton,title:y.getString("MessageComposer.RemoveQuoteButtonTitle"),onPress:this.props.options.onClearQuote,size:T.IconSize.size16,color:b.Color.gray300,hoverColor:b.Color.black,icon:T.SkypeIcon.Cancel,disabled:this.props.options.disableActions}):void 0}}t.QuoteNode=P;class k extends r.ComponentBase{_buildState(e,t){return{replySymbol:M.getReplySymbol()}}render(){return(0,i.jsx)(c.ContentPlaceholder,{icon:this.state.replySymbol,label:y.getString("ContentToReactTransformer.QuoteIconPreviewLabel"),mediaPlaceholderIconColor:this.props.mediaPlaceholderIconColor,regularTextStyle:this.props.regularTextStyle,textOverrideStyle:this.props.textOverrideStyle})}}t.QuoteOnly=k},326143:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(74775),n=s(766265),r=s(616026),a=s(677381),l=s(733754),d=s(677914),c=s(422538),h=s(711828);class u extends a.default{_buildState(e,t){let s;if(c.HasStarted(d.default)){const i=t?e.options.message:void 0;s=d.default.getScheduledCallById(e.scheduledCallId,i)}return{scheduledCall:s}}render(){let e;return e=this.props.options.renderMedia&&this.state.scheduledCall&&this.props.options.onCallInviteAccepted&&this.props.options.onCallInviteDeclined?this.props.isSender?(0,i.jsx)(n.default,{scheduledCall:this.state.scheduledCall,message:this.props.options.message,onLongPress:this.props.options.onLongPressContent,messagePadding:this.props.options.messagePadding,renderDimensions:this.props.renderDimensions}):(0,i.jsx)(o.default,{scheduledCall:this.state.scheduledCall,onCallInviteAccepted:this.props.options.onCallInviteAccepted,onCallInviteDeclined:this.props.options.onCallInviteDeclined,message:this.props.options.message,onLongPress:this.props.options.onLongPressContent,renderDimensions:this.props.renderDimensions}):(0,i.jsx)(r.ContentPlaceholder,{icon:h.SkypeIcon.Schedule,label:l.getString("ContentToReactTransformer.ScheduledCallPreviewLabel"),mediaPlaceholderIconColor:this.props.options.mediaPlaceholderIconColor,regularTextStyle:this.props.options.regularTextStyle,textOverrideStyle:this.props.options.textOverrideStyle}),e}}t.default=u},960552:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(217041);class r extends n.ComponentBase{constructor(){super(...arguments),this._onPressed=()=>{this.props.onHighlightedTextPressed&&this.props.onHighlightedTextPressed(this.props.text,this.props.activityId)}}render(){return(0,i.jsx)(o.Text,Object.assign({style:this.props.style,selectable:this.props.selectable,numberOfLines:this.props.numberOfLines,onPress:this._onPressed},{children:this.props.children}))}}t.default=r},388808:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(217041),n=s(770891),r=s(317873),a=s(416419),l={height:130,width:240};class d extends o.ComponentBase{constructor(){super(...arguments),this._onSwiftCardPressTelemetryCallback=()=>{r.default.potentiallyMarkItemViewed(this.props.message,this.props.options.renderOrigin)}}static getConstrainedWidth(e){return a.default.getConstrainedWidth(e)}render(){const e=this.props.options;return this.props.options.renderOrigin!==n.MessageRenderOrigin.CompositeGalleryCanvas&&this.props.options.renderOrigin!==n.MessageRenderOrigin.StackGalleryCanvas||(e.onSwiftCardPressTelemetryCallback=this._onSwiftCardPressTelemetryCallback),this.props.options.renderOrigin===n.MessageRenderOrigin.MessageComposerCanvas&&(e.availableSpace=l),(0,i.jsx)(a.default,{swiftMessage:this.props.swiftMessage,options:e,postedByCurrentUser:this.props.postedByCurrentUser,conversationId:this.props.conversationId,displayInPreviewMode:!this.props.isActionable})}}t.default=d},227862:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(217041),n=s(616026),r=s(681959),a=s(986374),l=s(952262),d=s(770891),c=s(753559),h=s(733754),u=s(312762),p=s(711828),g=s(539549),m=s(741660);class S extends o.ComponentBase{_buildState(e,t){var s;const i=null===(s=e.message)||void 0===s?void 0:s.conversationId,o=i?(0,g.default)().getConversation(i):void 0;return{labelText:this._getLabelText(l.default.getDisplayName(e.creatorMri)),icon:this._getIcon(),isNewsChannel:(0,m.isContentChannel)(o),isNewsBot:(0,m.isTodayBot)(i)}}_getLabelText(e){let t;if(this.props.message){const s=a.decode(this.props.message).getFirstUriObjectChild(u.SwiftUriObjectNode);s&&(t=r.renderText(s,{message:this.props.message,processing:{quotes:d.ProcessingLevel.None,wikiMarkup:d.ProcessingLevel.Stripped},trimToFirstLine:!0}),"Card"===t&&(t=h.getString("SwiftCard.Card")),s.getCardType()===c.default.imageContentTypes.gif&&e&&(t=h.getString("ContentToReactTransformer.GifCardIconPreviewLabel",{creator:e})))}return t||(t=e?h.getString("ContentToReactTransformer.CardIconPreviewLabelLong",{creator:e}):h.getString("ContentToReactTransformer.CardIconPreviewLabelShort")),t}_getIcon(){if(this.props.message){const e=a.decode(this.props.message).getFirstUriObjectChild(u.SwiftUriObjectNode);if(e&&e&&e.getCardType()===c.default.imageContentTypes.gif)return p.SkypeIcon.Gif}return p.SkypeIcon.Card}render(){return(0,i.jsx)(n.ContentPlaceholder,{icon:this.state.icon,label:this.state.labelText,numberOfLines:1,allowTextSelection:!1,mediaPlaceholderIconColor:this.props.mediaPlaceholderIconColor,regularTextStyle:this.props.regularTextStyle,textOverrideStyle:this.props.textOverrideStyle,isNewsChannel:this.state.isNewsChannel,isNewsBot:this.state.isNewsBot})}}t.default=S},460562:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(889391),a=s(719061),l=s(816402),d=s(913991),c=s(952262),h=s(770891),u=s(746096),p=s(139889),g=s(753559),m=s(317873),S=s(110117),f=s(436237),y=s(861253),v=s(915877),C=s(540522),_=s(733754),b=s(451072),T=s(519089),M=s(106658),I=s(18078),w=s(17791),P=s(29130),k=s(700960),A=s(404057),x=s(581760),R=s(311010),O=s(711828),L=s(478262),F=s(680837),B=s(619675),D=s(24576),E=s(865322),V=s(626712),N=s(291319),U=s(265976),j=M.messageTextLineHeight,H=(0,v.lazyProperties)({removeBorder:()=>n.Styles.createViewStyle({borderWidth:0,borderColor:x.Color.transparent}),containerSmall:()=>n.Styles.createViewStyle({width:200}),containerRegular:()=>n.Styles.createViewStyle({width:300}),thumbnailRegular:()=>n.Styles.createViewStyle({width:300,height:150}),thumbnailRegularHeightOnly:()=>n.Styles.createViewStyle({height:150}),thumbnailSmall:()=>n.Styles.createViewStyle({width:200,height:125}),thumbnailBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:x.Color.gray200}),thumbnailObfuscated:()=>n.Styles.createViewStyle({justifyContent:"center",alignItems:"center"}),cardTitle:()=>n.Styles.createTextStyle({paddingHorizontal:10,marginTop:10,lineHeight:j}),titleTextMaxHeight:()=>n.Styles.createTextStyle({maxHeight:2*j}),titleTextMaxHeightLarge:()=>n.Styles.createTextStyle({maxHeight:3*j}),cardDescription:()=>n.Styles.createTextStyle({paddingHorizontal:10,marginTop:4}),descriptionTextMaxHeight:()=>n.Styles.createTextStyle({lineHeight:16,maxHeight:32}),descriptionTextMaxHeightLarge:()=>n.Styles.createTextStyle({lineHeight:16,maxHeight:96}),footer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",marginTop:7,marginBottom:12,paddingHorizontal:12}),reactionOverlayedFooter:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",marginTop:7,marginBottom:24,paddingHorizontal:12}),footerText:()=>n.Styles.createTextStyle({flex:1,marginLeft:4}),favIcon:()=>n.Styles.createViewStyle({height:16,width:16}),linkStyle:()=>n.Styles.createTextStyle({fontSize:14,lineHeight:j,color:x.Color.blue,fontFamily:R.default.fontFamily.uidDisplayRegular,paddingHorizontal:12,paddingVertical:7})});class z extends D.default{constructor(){super(...arguments),this._maxGifFileSizeForIOs=r.default.getConfigSettings().urlPreview.gifSizeLimitInBytes,this._onPress=e=>{m.default.potentiallyMarkItemViewed(this.props.message,this.props.renderOrigin);const t={conversationId:this.props.message.conversationId};if(T.default.isPiPEnabled()){const e=N.default.getYoutubeVideoPropsFromUrlPreviewData(this.props.urlPreviewData);if(e)return void T.default.setContentProps(e)}t.preventInAppNavigationForGuest=!a.default.canNavigateInApp(),C.openUrlWithParams({origin:u.BrowserOrigin.LinkNode,url:this.props.urlPreviewData.url,options:t,rootViewId:this._getRootViewId()}),f.track(new E.UrlPreviewClickTelemetry(this.props.urlPreviewData.url,this.props.message))},this._onLongPress=e=>{this.props.onLongPress&&this.props.onLongPress(e,this.props.urlPreviewData.url)},this._onFavIconError=e=>{this._shouldInstrument()&&(f.warn(u.LogTraceArea.LinkNode,"Failed to load the favicon"+A.default.errorAsString(e)),f.track(new E.UrlPreviewImageFailureTelemetry(this.props.urlPreviewData.urlPreviewMetadata.favicon,e?e.name:"<noErr>",E.UrlPreviewActionType.LoadFaviconFailure)))},this._onThumbnailError=e=>{this._shouldInstrument()&&(f.warn(u.LogTraceArea.LinkNode,"Failed to thumbnail the favicon"+A.default.errorAsString(e)),f.track(new E.UrlPreviewImageFailureTelemetry(this.props.urlPreviewData.urlPreviewMetadata.thumbnail,e?e.name:"<noErr>",E.UrlPreviewActionType.LoadThumbnailFailure)))}}_buildState(e,t){const s={wasCreatedByCurrentUser:I.default.isMyMri(e.message.creator)},i=e.urlPreviewData.urlPreviewMetadata;if((i||e.obfuscate)&&(s.senderDisplayName=c.default.getMemberShortNameForConversation(e.message.conversationId,e.message.creator)),i){const t=_.getString("AccessibilityLabel.UrlPreview",{previewTitle:e.urlPreviewData.urlPreviewMetadata.title||"",previewDescription:e.urlPreviewData.urlPreviewMetadata.description||""}),i={senderName:s.senderDisplayName||"",timestamp:l.default.getDisplayTimeString(e.message.createdTime),messageContent:t};s.accessibilityLabel=_.getString("AccessibilityLabel.MediaMessage",i)}s.responsiveWidth=this._getContext().isPresentedInDesktopSubview?L.ResponsiveWidth.MinDesktop:P.default.getResponsiveWidth(this._getRootViewId()),s.showReactionsOverlay=r.default.getS4LMessagingFeatures().enableReactionOverlays;const o=e.searchStore?e.searchStore.getSearchQuery():void 0,n=V.default.getDomainName(e.urlPreviewData.url);let a;if(n&&(a=o&&e.searchStore&&e.searchStore.isMessageInConvSearchResults(e.message.cuid)?(0,k.transformToHighlightedText)(n,o.query,e.searchStore.isMessageFocused(e.message.cuid),!!s.wasCreatedByCurrentUser):[n]),s.domainName=a,e.urlPreviewData.urlPreviewMetadata){let t,i=e.urlPreviewData.urlPreviewMetadata.title;i=e.obfuscate?_.getString("StreamItem.LinkNodeObfuscatedTitle",{userName:s.senderDisplayName||""}):i&&i.trim(),i&&(t=o&&e.searchStore&&e.searchStore.isMessageInConvSearchResults(e.message.cuid)?(0,k.transformToHighlightedText)(i,o.query,e.searchStore.isMessageFocused(e.message.cuid),!!s.wasCreatedByCurrentUser):[i]),s.title=t}return s}_getStyles(){const e=this.props.renderOrigin===h.MessageRenderOrigin.StackGalleryCanvas;return this.props.renderOrigin===h.MessageRenderOrigin.CompositeGalleryCanvas?{container:void 0,thumbnail:H.thumbnailRegularHeightOnly,maxTitleHeight:H.titleTextMaxHeight,maxDescriptionHeight:H.descriptionTextMaxHeight}:{container:e?void 0:(0,y.default)(this.props.renderDimensions,d.UrlPreviewNodeSizes.Small)?H.containerSmall:H.containerRegular,thumbnail:(0,y.default)(this.props.renderDimensions,d.UrlPreviewNodeSizes.Small)?H.thumbnailSmall:H.thumbnailRegular,maxTitleHeight:this.state.responsiveWidth===L.ResponsiveWidth.Large?H.titleTextMaxHeightLarge:H.titleTextMaxHeight,maxDescriptionHeight:this.state.responsiveWidth===L.ResponsiveWidth.Large?H.descriptionTextMaxHeightLarge:H.descriptionTextMaxHeight}}render(){const e=this._getStyles(),t=[H.removeBorder,this._themeStyles.cardColorStyle,e.container,this.props.style],{description:s,favicon:r,thumbnail:a,content_type:l,size:d}=this.props.urlPreviewData.urlPreviewMetadata||{},c=d?Number(d):void 0,h=l&&g.default.isImageMimeType(l);let m,y,v;if(this.state.title?m=(0,i.jsx)(B.CardTitle,Object.assign({style:[H.cardTitle,e.maxTitleHeight],allowFontScaling:!1,numberOfLines:2},{children:this.state.title})):h||s||(m=(0,i.jsx)(n.Link,Object.assign({style:[H.linkStyle,this._themeStyles.linkTextColorStyle],url:this.props.urlPreviewData.url,onPress:this._onPress,selectable:!0},{children:this.props.urlPreviewData.url}))),s||this.props.obfuscate){const t=this.props.obfuscate?_.getString("StreamItem.LinkNodeObfuscatedDescription"):s&&s.trim();y=(0,i.jsx)(B.Caption,Object.assign({style:[H.cardDescription,e.maxDescriptionHeight],allowFontScaling:!1,numberOfLines:2},{children:t}))}const C=(0,i.jsx)(n.View,{children:(0,i.jsx)(S.default,{icon:O.SkypeIcon.Link,size:O.IconSize.default,color:x.Color.gray300,style:F.default.flexOne})}),T=o.compact([H.removeBorder,e.thumbnail,H.thumbnailBackgroundStyle,this.props.thumbnailRadiusStyle]);if(this.props.obfuscate){const e=[T,H.thumbnailObfuscated];v=(0,i.jsx)(n.View,Object.assign({style:e},{children:C}))}else if(a&&(0,U.isAmsDomainUrl)(a)){l===g.default.imageContentTypes.gif&&f.log(u.LogTraceArea.LinkNode,"Rendering a gif in link preview of size "+c);const t=n.Styles.createImageStyle({overlayColor:this._themeColors.messageStreamBackgroundColor},!1);v=(0,i.jsx)(p.default,{origin:"LinkThumbnailUrlp",style:[e.thumbnail,t,this.props.thumbnailRadiusStyle],containerStyle:T,source:a,altView:C,errorView:C,onError:this._onThumbnailError,resizeMode:"cover"},"thumbnail")}const M=(0,i.jsx)(S.default,{icon:O.SkypeIcon.Link,size:O.IconSize.size16,color:x.Color.gray300}),I=r&&(0,U.isAmsDomainUrl)(r)?r:void 0,w=(0,i.jsxs)(n.View,Object.assign({style:[this.state.showReactionsOverlay&&this.props.message.hasReactions()&&this.props.urlPreviewOnly?H.reactionOverlayedFooter:H.footer]},{children:[(0,i.jsx)(p.default,{origin:"LinkFaviconUrlp",style:H.favIcon,containerStyle:H.favIcon,source:I,altView:M,errorView:M,onError:this._onFavIconError,resizeMode:"cover"},"favicon"),(0,i.jsx)(B.Caption,Object.assign({style:H.footerText,allowFontScaling:!1,numberOfLines:1},{children:this.state.domainName}))]}));return(0,i.jsx)(b.default.Button,Object.assign({style:t,onPress:this._onPress,onLongPress:this._onLongPress,accessibilityLabel:this.state.accessibilityLabel,title:this.props.urlPreviewData.url,activeOpacity:this.props.activeOpacityOverride,keepOriginalProps:!0,onContextMenu:this.props.onContextMenu,disabled:this.props.disableActions,disabledOpacity:1},{children:(0,i.jsxs)(n.View,Object.assign({style:H.removeBorder,onLayout:this.props.onLayout},{children:[v,m,y,w]}))}))}_shouldInstrument(){return this.isComponentMounted()&&w.default.isNetworkingAvailable()}}t.default=z},5451:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(477517),n=s(516778),r=s(244770),a=s(889391),l=s(351077),d=s(103291),c=s(746096),h=s(139889),u=s(139285),p=s(110117),g=s(436237),m=s(915877),S=s(733754),f=s(451072),y=s(633596),v=s(42036),C=s(18078),_=s(144487),b=s(581760),T=s(711828),M=s(680837),I=s(619675),w=s(24576),P=s(815188),k=s(378194),A=s(675865),x=s(626712),R=s(265976),O=(0,m.lazyProperties)({thumbnailContainer:()=>n.Styles.createButtonStyle({justifyContent:"center"}),overlayContainer:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center"}),overlayContainerBackground:()=>n.Styles.createViewStyle({backgroundColor:b.Color.blackOverlay10}),videoContainerHidden:()=>n.Styles.createViewStyle({opacity:0}),actionButtonborderStyle:()=>n.Styles.createViewStyle({backgroundColor:b.Color.blackOverlay10,borderRadius:T.IconSize.size60/2,borderStyle:"solid",borderWidth:2,borderColor:b.Color.white,alignItems:"center",justifyContent:"center",width:T.IconSize.size60,height:T.IconSize.size60}),playButtonBorderDraggableThumbnailStyle:()=>n.Styles.createViewStyle({borderWidth:1,borderRadius:T.IconSize.size30/2,width:T.IconSize.size30,height:T.IconSize.size30,shadowColor:b.Color.black,shadowRadius:2,backgroundColor:b.Color.blackOverlay10}),alternateViewContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",backgroundColor:b.Color.gray200}),backgroundImage:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,opacity:.5}),nodeContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),callRecordingFooterText:()=>n.Styles.createTextStyle({textAlign:"center"}),callRecordingFooterContainer:()=>n.Styles.createViewStyle({flexGrow:1,flexShrink:1,paddingHorizontal:5}),uploadProgressFooterContainer:()=>n.Styles.createViewStyle({flexGrow:1,flexShrink:1}),footerTextAlignRight:()=>n.Styles.createViewStyle({alignItems:"flex-end"}),draggableThumbnailContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",width:60,height:60,shadowRadius:1,shadowOffset:{width:0,height:2},shadowColor:b.Color.blackOverlay20,borderRadius:10,borderWidth:1})});class L extends w.default{constructor(){super(...arguments),this._onLocalThumbnailError=()=>{this._onError(this.state.localUrl)},this._onThumbnailError=()=>{this._onError(this.props.thumbnailUrl)},this._onThumbnailLoad=()=>{this.setState({thumbnailLoaded:!0})},this._onPress=e=>{this.state.sendingFailed&&this.props.isRetryCommandSupported?(this._onRetryClick(),e.stopPropagation()):this.props.onPress&&this.props.onPress(e)},this._onDragStartVideo=e=>{d.default.addDragAndDropFileInformation(e,this.props.message)}}_buildState(e,t){const s={contentUrl:A.default.getAuthenticatedUrl(e.contentUrl),thumbnailUrl:A.default.getAuthenticatedUrl(e.thumbnailUrl),wasCreatedByCurrentUser:C.default.isMyMri(e.authorMri),callRecorderRetentionDurationDays:a.default.getS4LCMCFeatures().callRecorderRetentionDurationDays,sendingFailed:e.message.isSendRejected(),isSelectMessagesModeActive:_.default.isSelectMessagesModeActive(this._getRootViewId())};return t&&(s.isVideoHidden=!1),x.default.isFileOrBlob(e.thumbnailUrl)?(s.isUploading=!0,s.localUrl=e.thumbnailUrl,s.showAltView=!0):s.isUploading=!1,s}componentDidMount(){super.componentDidMount(),this.props.onMountContent&&this.props.onMountContent("VideoNode",this,!0)}componentWillUnmount(){super.componentWillUnmount(),this.props.onMountContent&&this.props.onMountContent("VideoNode",this,!1)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.isUploading&&!this.state.isUploading&&this.setState({showAltView:!1})}hideNode(){this.isComponentMounted()&&(this.setState({isVideoHidden:!0}),this.props.onHideContent&&this.props.onHideContent())}showNode(){this.isComponentMounted()&&(this.setState({isVideoHidden:!1}),this.props.onShowContent&&this.props.onShowContent())}render(){const e=y.getStyleForDimensions(this.props.renderDimensions),t=y.getStyleForDimensions({width:this.props.renderDimensions.width,height:void 0}),s=(0,i.jsx)(n.View,Object.assign({style:O.alternateViewContainer},{children:(0,i.jsx)(n.Image,{style:O.backgroundImage,resizeMode:"cover",source:r.Collection.WIGGLE_PATTERN_350})})),a=(0,i.jsx)(n.View,Object.assign({style:O.alternateViewContainer},{children:(0,i.jsx)(n.Image,{style:O.backgroundImage,resizeMode:"cover",source:r.Collection.WIGGLE_PATTERN_350})}));let l,d,c,g;if(this.state.thumbnailUrl){const t=[O.overlayContainer,e,this.props.containerStyles];if(this.state.isVideoHidden&&t.push(O.videoContainerHidden),this.state.thumbnailLoaded){const e=[M.default.absoluteFill,this.props.containerStyles,O.overlayContainerBackground];c=(0,i.jsx)(n.View,{style:e})}const o=[y.defaultStyles.pictureDefaultThumbnail,e,this.props.containerStyles],r=[t,this.props.containerStyles,e];this.state.localUrl&&(0,R.isAmsDomainUrl)(this.state.localUrl)&&(d=(0,i.jsx)(h.default,{origin:"VideoNodeLocalThumbnail",style:o,containerStyle:r,source:this.state.localUrl,altView:s,errorView:a,onError:this._onLocalThumbnailError,onLoad:this._onThumbnailLoad,resizeMode:"cover"},"localImage"));const u=(0,R.isAmsDomainUrl)(this.state.thumbnailUrl)?this.state.thumbnailUrl:void 0;l=(0,i.jsx)(h.default,{origin:"VideoNodeThumbnail",style:o,containerStyle:r,source:u,altView:d||s,errorView:a,onError:this._onThumbnailError,onLoad:this._onThumbnailLoad,resizeMode:"cover",showAltView:this.state.showAltView})}let m=this._isVideoCurrentlyBeingSent();this.state.sendingFailed&&(m=!1),m&&this.state.contentUrl&&(g=(0,i.jsx)(u.default,Object.assign({style:[O.overlayContainer,this.props.containerStyles]},{children:(0,i.jsx)(P.default,{contentUrls:[this.state.contentUrl],strokeColor:b.Color.white,size:T.IconSize.size60,showFiniteProgressIndicatorUI:!0,isUploadingCompleted:!this.state.isUploading})})));const v=(0,i.jsx)(n.View,Object.assign({style:O.actionButtonborderStyle},{children:(0,i.jsx)(p.default,{icon:this.state.sendingFailed&&!this.props.isPresentedInAlbum?T.SkypeIcon.Reload:T.SkypeIcon.Play,size:T.IconSize.size24,color:b.Color.white})})),C=m||this.state.sendingFailed&&!this.props.isRetryCommandSupported?void 0:(0,i.jsx)(o.DragDroppableView,Object.assign({style:[O.overlayContainer,this.props.containerStyles],onDragStart:this.props.isDraggingEnabled&&!this.state.sendingFailed?this._onDragStartVideo:void 0,dragThumbnailElement:this.props.isDraggingEnabled&&!this.state.sendingFailed?this._getDraggableThumbnailElement():void 0},{children:v})),_=this.state.sendingFailed?S.getString("VideoNode.RetrySendAction"):S.getString("VideoNode.OpenVideoTitle");let I=(0,i.jsxs)(f.default.Button,Object.assign({style:[O.thumbnailContainer,e,this.props.containerStyles],title:_,onLongPress:this.props.onLongPress,onContextMenu:this.props.onContextMenu,activeOpacity:this.props.activeOpacityOverride,onPress:this._onPress,keepOriginalProps:!0,disabled:this.props.disableActions,disabledOpacity:1,importantForAccessibility:this.state.isSelectMessagesModeActive?n.Types.ImportantForAccessibility.No:void 0},{children:[l,c,g,C]}),"video");this.props.isPresentedInAlbum&&(I=(0,i.jsxs)(n.View,Object.assign({style:[O.thumbnailContainer,e,this.props.containerStyles],title:_},{children:[l,c,v]}),"video"));const w=this._renderFooterView();if(!w)return I;let k=[];if(this._shouldShowCallRecordingFooter()){const e=y.getStyleForDimensions({width:this.props.renderDimensions.width,height:void 0});k=[O.nodeContainer,e]}return(0,i.jsxs)(n.View,Object.assign({style:[k,t]},{children:[I,w]}))}_isVideoCurrentlyBeingSent(){return this.state.isUploading||this.props.isMessageInSendingState}_renderFooterView(){let e;if(this.state.sendingFailed){const t=this.props.isRetryCommandSupported?S.getString("MediaNode.SendingFailed"):S.getString("MediaNode.MediaNotAvailableForSending");return e=(0,i.jsx)(u.default,Object.assign({style:[O.uploadProgressFooterContainer,this.state.wasCreatedByCurrentUser?O.footerTextAlignRight:void 0]},{children:(0,i.jsx)(I.Caption,{children:t})})),e}if(this.state.contentUrl&&this.state.isUploading&&!this.props.isPresentedInAlbum)return e=(0,i.jsx)(u.default,Object.assign({style:[O.uploadProgressFooterContainer,this.state.wasCreatedByCurrentUser?O.footerTextAlignRight:void 0]},{children:(0,i.jsx)(k.default,{contentUrl:this.state.contentUrl,fileSizeInBytes:this.props.fileSizeInBytes})})),e;if(this._shouldShowCallRecordingFooter()){const t=(0,i.jsx)(I.Caption,Object.assign({style:O.callRecordingFooterText,allowFontScaling:!1},{children:S.getString("VideoNode.CallRecordingAvailabilityMessage",{numberOfDays:this.state.callRecorderRetentionDurationDays})}));e=(0,i.jsx)(n.View,Object.assign({style:O.callRecordingFooterContainer},{children:t}))}return e}_shouldShowCallRecordingFooter(){return this.props.subType&&this.props.subType===l.UriObjectTypeSubTypes.Video.CallRecording}_onError(e){g.warn(c.LogTraceArea.GenericUnsafe,"Failed to load image for VideoNode: "+e)}_onRetryClick(){v.default.retryFailedSend(this.props.message)}_getDraggableThumbnailElement(){return(0,i.jsx)(n.Image,Object.assign({source:this.props.thumbnailUrl,style:[O.draggableThumbnailContainer,this._themeStyles.dividerBorderColorStyle]},{children:(0,i.jsx)(n.View,Object.assign({style:[O.actionButtonborderStyle,O.playButtonBorderDraggableThumbnailStyle]},{children:(0,i.jsx)(p.default,{icon:T.SkypeIcon.Play,size:T.IconSize.size10,color:b.Color.white})}))}))}}t.default=L},717540:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AttributionNode=void 0;const i=s(785893),o=s(516778),n=s(889391),r=s(311010),a=s(512193),l=s(273145),d=s(527024),c=s(96958),h=s(660198),u=s(812056);t.AttributionNode=(0,h.WithResub)((({node:e,attributions:t,isFooter:s,children:n,supportsCopy:h,linkSelectable:p,linkClickable:g,message:m,decodedNode:S,messageActions:f,renderOrigin:y,magicBotId:v,onPress:C,onLongPress:_,onQuote:b,onEdit:T,onPressInterceptionCallback:M})=>{var I;const{commandManagerRef:w,commandOptions:P,linkRef:k,handleLinkRef:A,contextMenuItems:x,handleCommandSelected:R}=(0,d.useAttributionNodeExtras)({node:e,supportsCopy:h,linkClickable:g,message:m,decodedNode:S,messageActions:f,renderOrigin:y,onPress:C,onLongPress:_,onQuote:b,onEdit:T}),{handlePress:O,handleLongPress:L,handleHoverStart:F,handleHoverEnd:B}=(0,c.useAttributionNodePressEvents)({node:e,attributions:t,message:m,supportsCopy:h,linkClickable:g,renderOrigin:y,magicBotId:v,commandManagerRef:w,commandOptions:P,linkRef:k,attributionType:s?u.AttributionType.Footer:u.AttributionType.InlineAttribution,onPress:C,onLongPress:_}),D=(0,a.useRXStyles)((e=>({mobileViewContainer:o.Styles.createViewStyle({overflow:"visible"},!1),container:o.Styles.createTextStyle({overflow:"visible",marginVertical:s?4:0,marginHorizontal:2,height:s?24:20},!1),mobileContainer:o.Styles.createViewStyle({position:"relative",overflow:"visible"},!1),desktopWrapper:o.Styles.createTextStyle({flexGrow:0,lineHeight:s?24:20,height:s?24:20},!1),attributionWrapperStyle:o.Styles.createViewStyle({transform:[{translateY:s?0:4}]},!1),attributionStyle:o.Styles.createViewStyle({height:s?24:20,top:-1,marginVertical:s?4:0,paddingVertical:s?4:2,borderRadius:4,backgroundColor:e.themeColors.surfaceSecondaryAccent,overflow:"visible"},!1),attributionLinkStyle:o.Styles.createLinkStyle({color:e.themeColors.textSecondaryInteractive,paddingHorizontal:7,lineHeight:16},!1),copyLink:{position:"absolute",left:0,right:0,height:20,overflow:"hidden"},copyLinkMobileWrapper:o.Styles.createViewStyle({position:"absolute",left:0,right:0,height:20,overflow:"hidden",transform:[{translateY:4}]},!1)})),[s]),E=[r.default.fontStyle.captionSelected,D.attributionLinkStyle];E.push(D.attributionStyle);const V=(0,i.jsx)(o.Link,Object.assign({ref:A,style:E,url:null!==(I=null==e?void 0:e.getSanitizedHref())&&void 0!==I?I:"#",title:null==e?void 0:e.getSanitizedHref(),onPress:O,onLongPress:L,onHoverStart:F,onHoverEnd:B,numberOfLines:1,tabIndex:M?-1:void 0},{children:(0,i.jsx)(o.Text,Object.assign({selectable:!1},{children:n}))})),N=(0,i.jsx)(o.Text,Object.assign({selectable:p,style:D.copyLink},{children:null==e?void 0:e.getSanitizedHref()})),U=(0,i.jsx)(l.default,Object.assign({wrapperStyle:D.desktopWrapper,wrapperOnly:!1,getMenuItems:x,onItemSelected:R,renderAsText:!0},{children:V})),j=N;return(0,i.jsxs)(o.Text,Object.assign({style:D.container},{children:[j,U]}))}),(e=>Object.assign(Object.assign({},e),{magicBotId:n.default.getS4LMessagingFeatures().magicBotId})))},140508:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AttributionNode=void 0;var i=s(717540);Object.defineProperty(t,"AttributionNode",{enumerable:!0,get:function(){return i.AttributionNode}})},527024:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useAttributionNodeExtras=void 0;const i=s(667294),o=s(258187),n=s(546529),r=s(600750);t.useAttributionNodeExtras=e=>{var t,{node:s,href:a=(null!==(t=null==s?void 0:s.getSanitizedHref())&&void 0!==t?t:"#"),supportsCopy:l,message:d,decodedNode:c,messageActions:h,renderOrigin:u,onQuote:p,onEdit:g}=e;const m=(0,o.useCommonContext)(),S=(0,i.useRef)(void 0),f=(0,i.useMemo)((()=>({message:d,decodedNode:c,url:a,onQuoteCallback:p,onEditCallback:g,renderOrigin:u,getReactionMenuPopupAnchor:()=>{var e;return null!==(e=S.current)&&void 0!==e?e:void 0},componentContext:m,getRootWindowComponent:()=>{var e;return null!==(e=S.current)&&void 0!==e?e:void 0}})),[m,c,a,d,g,p,u]),y=(0,i.useRef)(void 0),v=(0,i.useCallback)(((e,t)=>{var s,i;null===(s=y.current)||void 0===s||s.dismissSXPopup("attribution-link",t),null===(i=y.current)||void 0===i||i.onActionMenuOptionSelected(f,e)}),[f]),C=(0,i.useCallback)(((e,t)=>v(e,t.rootViewId)),[v]);(0,i.useEffect)((()=>{y.current=new n.StreamItemCommandManager(C)}),[C]);const _=(0,i.useCallback)((e=>v(e,m.rootViewId)),[m.rootViewId,v]),b=(0,i.useCallback)((()=>{var e,t;const s=[];return h&&s.push(...h.actionMenuCommands),l&&s.push(r.CommandTypes.CopyLink),null!==(t=null===(e=y.current)||void 0===e?void 0:e.getSXMenuItems(f,s))&&void 0!==t?t:[]}),[f,h,l]);return{handleLinkRef:(0,i.useCallback)((e=>S.current=null!=e?e:void 0),[]),contextMenuItems:b,handleCommandSelected:_,commandManagerRef:y,commandOptions:f,linkRef:S}}},96958:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useAttributionNodePressEvents=void 0;const i=s(667294),o=s(258187),n=s(600750),r=(s(733754),s(812056)),a=s(317873),l=s(519089),d=s(291319),c=s(491632),h=s(746096),u=s(719061),p=s(540522),g=s(360305),m=s(330124),S=s(896589);t.useAttributionNodePressEvents=({node:e,attributions:t,supportsCopy:s,commandOptions:f,commandManagerRef:y,linkRef:v,linkClickable:C,href:_,message:b,renderOrigin:T,magicBotId:M,attributionType:I,onLongPress:w,onPress:P})=>{var k,A;const x=null!==(A=null!==(k=null==e?void 0:e.getSanitizedHref())&&void 0!==k?k:_)&&void 0!==A?A:"#",R=(0,o.useCommonContext)(),{openAttributionsOverlay:O,hoverEndCloseAttributionsOverlay:L}=(0,S.useAttributionsOverlay)({attributions:t,activeAttributionIndex:null==e?void 0:e.index,linkClickable:C,message:b,anchor:()=>v.current}),F=(0,i.useMemo)((()=>m.default.isUsingStackNavigationContextNoSubscription()||g.default.isTabletUINoSubscription()),[]),B=(0,i.useCallback)((e=>{var t;if(w)w(e);else if(s){const s=[n.CommandTypes.CopyLink],i=f;null===(t=y.current)||void 0===t||t.showSXPopup(i,s,"attribution-link",(()=>v.current),R.rootViewId,e)}}),[f,R.rootViewId,x,w,s]),D=(0,i.useCallback)(((e,t)=>{if(C)if(P)P(e,t);else{if(F&&I!==r.AttributionType.Footer)return O();if(a.default.potentiallyMarkItemViewed(b,T),l.default.isPiPEnabled()){const e=d.default.getYoutubeVideoPropsFromUrl(x);if(e)return void l.default.setContentProps(e)}(null==b?void 0:b.creator)===M&&(null==b?void 0:b.conversationId)&&c.Instrumentation.track(new r.MessageAttribution(null==b?void 0:b.conversationId,I,"Bing")),p.openUrlWithParams({origin:h.BrowserOrigin.AttributionNode,url:x,options:{conversationId:b?b.conversationId:void 0,preventInAppNavigationForGuest:!u.default.canNavigateInApp()},rootViewId:R.rootViewId})}else e.stopPropagation()}),[R.rootViewId,x,b,P,T,M,C,I,O]),E=(0,i.useCallback)((()=>{var e;I!==r.AttributionType.Footer&&(null===(e=v.current)||void 0===e||e.focus(),O())}),[I,O]);return{handlePress:D,handleLongPress:B,handleHoverStart:E,handleHoverEnd:(0,i.useCallback)((()=>I!==r.AttributionType.Footer&&L()),[I,L])}}},316073:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AttributionListItem=void 0;const i=s(785893),o=s(516778),n=s(667294),r=s(705465),a=s(512193),l=s(311010),d=s(31280),c=s(619675),h=s(139889),u=s(581760),p=s(578621),g=s(258187),m={shadowColor:u.Color.blackOverlay20,shadowRadius:3,shadowOffset:{height:1,width:0}};t.AttributionListItem=({attribution:e,isAd:t,isHovered:s,linkClickable:u,message:S,rootViewId:f})=>{var y;const v=(0,g.useCommonContext)(),[C,_]=(0,n.useState)(!1),b=(0,n.useMemo)((()=>C||s),[s,C]),T=(0,n.useCallback)((()=>_(!0)),[]),M=(0,n.useCallback)((()=>_(!1)),[]),I=(0,p.useAttributionItemPressHandler)({attribution:e,linkClickable:u,message:S,rootViewId:f}),w=(0,a.useRXStyles)((e=>({index:o.Styles.createTextStyle({marginRight:v.isRTL?0:16,marginLeft:v.isRTL?16:0,alignItems:"center",justifyContent:"center",textAlign:"center",paddingHorizontal:6,minWidth:20,height:20,borderRadius:4,lineHeight:20,backgroundColor:e.themeColors.surfaceSecondaryAccent,color:e.themeColors.textSecondaryInteractive}),image:o.Styles.createImageStyle({width:32,height:32,marginRight:v.isRTL?0:8,marginLeft:v.isRTL?8:0}),title:o.Styles.createTextStyle({fontSize:17,lineHeight:20,color:e.themeColors.textInteractive,font:l.default.font.uiDisplaySemibold}),url:o.Styles.createTextStyle({lineHeight:20}),description:o.Styles.createTextStyle({lineHeight:20})})),[v.isRTL]),P=(0,a.useSkypeStyles)((()=>({wrapper:Object.assign({overflow:"visible",boxSizing:"border-box",paddingVertical:12,paddingHorizontal:12,flexDirection:v.isRTL?"row-reverse":"row",justifyContent:"flex-start",alignItems:"center",borderRadius:12},b?m:{}),textsContainer:{flexDirection:"column",overflow:"hidden",flexShrink:1},attributionContainer:{flexDirection:v.isRTL?"row-reverse":"row",alignItems:"center",flexShrink:1}})),[b,v.isRTL]);return(0,i.jsxs)(r.Pressable,Object.assign({style:P.wrapper,onPress:I,onHoverIn:T,onHoverOut:M,onHoverStart:T,onHoverEnd:M},{children:[!t&&(0,i.jsx)(d.Caption,Object.assign({selected:!0,style:w.index},{children:e.index})),(0,i.jsxs)(r.View,Object.assign({style:P.attributionContainer},{children:[e.logo&&(0,i.jsx)(h.default,{containerStyle:w.image,origin:"AttributionItem",resizeMode:"contain",source:e.logo}),(0,i.jsxs)(r.View,Object.assign({style:P.textsContainer},{children:[(0,i.jsx)(c.RowTitle,Object.assign({ellipsizeMode:"tail",numberOfLines:1,style:w.title},{children:null!==(y=e.title)&&void 0!==y?y:e.anchor})),(0,i.jsx)(d.Caption,Object.assign({ellipsizeMode:"tail",numberOfLines:1,style:w.url},{children:e.getSanitizedHref()})),e.description&&(0,i.jsx)(d.Caption,Object.assign({ellipsizeMode:"tail",numberOfLines:1,style:w.description},{children:e.description}))]}))]}))]}))}},319118:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AttributionsOverlay=t.overlayPadding=void 0;const i=s(785893),o=s(705465),n=s(667294),r=s(316073),a=s(360305),l=s(330124);t.overlayPadding=16;t.AttributionsOverlay=({attributions:e,activeAttributionIndex:s,linkClickable:d,rootViewId:c,message:h,onMouseEnter:u,onMouseLeave:p})=>{const[g,m]=(0,n.useState)(!1),S=(0,n.useMemo)((()=>l.default.isUsingStackNavigationContextNoSubscription()||a.default.isTabletUINoSubscription()),[]),f=(0,n.useMemo)((()=>o.StyleSheet.create({container:{cursor:"default",padding:t.overlayPadding,overflow:"visible"},scrollableContainer:{maxHeight:500},wrapper:{overflow:"visible"}})),[]),y=(0,n.useCallback)((e=>{null==u||u(e),m(!0)}),[u]),v=(0,n.useCallback)((e=>{null==p||p(e),m(!1)}),[p]),C=(0,i.jsx)(o.View,Object.assign({style:f.wrapper},{children:e.map((e=>(0,i.jsx)(r.AttributionListItem,{attribution:e,linkClickable:d,isHovered:!g&&s===e.index,rootViewId:c,message:h},e.index)))}));return(0,i.jsx)(o.Pressable,Object.assign({style:f.container,onMouseEnter:y,onMouseLeave:v},{children:S?(0,i.jsx)(o.ScrollView,Object.assign({style:f.scrollableContainer},{children:C})):C}))}},578621:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useAttributionItemPressHandler=void 0;const i=s(667294),o=s(812056),n=s(540522),r=s(519089),a=s(291319),l=s(491632),d=s(746096),c=s(719061);t.useAttributionItemPressHandler=({linkClickable:e,message:t,attribution:s,rootViewId:h})=>(0,i.useCallback)((i=>{if(e){if(r.default.isPiPEnabled()){const e=a.default.getYoutubeVideoPropsFromUrl(s.getSanitizedHref());if(e)return void r.default.setContentProps(e)}l.Instrumentation.track(new o.MessageAttribution(t.conversationId,o.AttributionType.Overlay,"Bing")),n.openUrlWithParams({origin:d.BrowserOrigin.AttributionNode,url:s.getSanitizedHref(),options:{conversationId:t?t.conversationId:void 0,preventInAppNavigationForGuest:!c.default.canNavigateInApp()},rootViewId:h})}else i.stopPropagation()}),[e,t,s,h])},896589:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useAttributionsOverlay=void 0;const i=s(785893),o=s(667294),n=s(705465),r=s(757139),a=s(258187),l=s(853374),d=s(319118),c=s(824490),h=s(912770);t.useAttributionsOverlay=({attributions:e,activeAttributionIndex:t,linkClickable:s,message:u,anchor:p})=>{const g=(0,a.useCommonContext)(),{width:m,height:S}=(0,n.useWindowDimensions)(),[f,y]=(0,o.useState)(m),[v,C]=(0,o.useState)(""),_=(0,o.useRef)(),b=(0,o.useRef)(),[T,M]=(0,o.useState)(),[I,w]=(0,o.useState)(),P=(0,o.useCallback)((e=>e.reduce(((e,t)=>e+(t.description?84:64)),0)+2*d.overlayPadding),[]),k=(0,o.useCallback)((()=>{I&&(h.default.clearTimeout(I),w(void 0)),T&&(h.default.clearTimeout(T),M(void 0))}),[I,T]),A=(0,o.useCallback)((()=>{k(),r.default.close(g.rootViewId,v)}),[v,k,g.rootViewId]),x=(0,o.useCallback)((()=>{k(),M(h.default.setTimeout((()=>{M(void 0),_.current||b.current||A()}),50))}),[k,A]),R=(0,o.useCallback)((()=>{b.current=!1,x()}),[x]),O=(0,o.useCallback)((()=>{_.current=!0}),[]),L=(0,o.useCallback)((()=>{_.current=!1,x()}),[x]),F=(0,o.useCallback)((()=>{if(!e)return;const o=l.default.newCauseId(),n=[...e.values()];C(o),r.default.showWithContent({getTitle:()=>{},content:(0,i.jsx)(d.AttributionsOverlay,{attributions:n,activeAttributionIndex:t,linkClickable:s,onMouseEnter:O,onMouseLeave:L,rootViewId:g.rootViewId,message:u}),anchor:p,menuId:"",rootViewId:g.rootViewId,menuWidth:Math.min(700,m-16),menuHeight:Math.min(P(n),500,S),headerConfig:{headerType:c.HeaderType.Slim},onCloseMenu:A},o)}),[e,t,s,O,L,g.rootViewId,u,p,m,P,S,A]),B=(0,o.useCallback)((()=>{k(),b.current=!0,w(h.default.setTimeout((()=>{w(void 0),F()}),50))}),[k,F]);return(0,o.useEffect)((()=>{m!==f&&(A(),y(m))}),[A,f,m]),{openAttributionsOverlay:B,closeAttributionsOverlay:A,hoverEndCloseAttributionsOverlay:R}}},42847:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AttributionsTextNode=void 0;const i=s(785893),o=s(667294),n=s(516778),r=s(705465),a=s(889391),l=s(527024),d=s(96958),c=s(512193),h=s(660198),u=s(273145),p=s(419895),g=s(812056);t.AttributionsTextNode=(0,h.WithResub)((({children:e,attributions:t,href:s,linkSelectable:a,supportsCopy:h,linkClickable:m,message:S,decodedNode:f,messageActions:y,renderOrigin:v,magicBotId:C,onPress:_,onLongPress:b,onQuote:T,onEdit:M})=>{const I=(0,o.useContext)(p.BingResponseHoveredContext),w=(()=>{const[e,t]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{var e,s;const[i,o]=[!0,!1].map((e=>s=>{"Control"===s.key&&t(e)}));return null===(e=null===window||void 0===window?void 0:window.addEventListener)||void 0===e||e.call(window,"keydown",i),null===(s=null===window||void 0===window?void 0:window.addEventListener)||void 0===s||s.call(window,"keyup",o),()=>{var e,t;null===(e=null===window||void 0===window?void 0:window.removeEventListener)||void 0===e||e.call(window,"keydown",i),null===(t=null===window||void 0===window?void 0:window.removeEventListener)||void 0===t||t.call(window,"keyup",o)}}),[]),e})(),{commandManagerRef:P,commandOptions:k,linkRef:A,handleLinkRef:x,contextMenuItems:R,handleCommandSelected:O}=(0,l.useAttributionNodeExtras)({href:s,supportsCopy:h,linkClickable:m,message:S,decodedNode:f,messageActions:y,renderOrigin:v,onLongPress:b,onQuote:T,onEdit:M}),{handlePress:L,handleLongPress:F}=(0,d.useAttributionNodePressEvents)({attributions:t,message:S,supportsCopy:h,linkClickable:m,renderOrigin:v,magicBotId:C,commandManagerRef:P,commandOptions:k,linkRef:A,href:s,attributionType:g.AttributionType.InlineText,onPress:_,onLongPress:b}),B=(0,c.useSkypeStyles)((e=>({link:{textDecorationLine:I?"underline":"none",textDecorationColor:e.themeColors.textSecondary,textDecorationStyle:"dotted",textUnderlineOffset:4,color:e.themeColors.textPrimary,cursor:w?"pointer":"text"}})),[I,w]),D=w?(0,i.jsx)(n.Link,Object.assign({ref:x,url:null!=s?s:"#",title:s,onPress:L,onLongPress:F,selectable:a,numberOfLines:1,tabIndex:-1},{children:(0,i.jsx)(r.Text,Object.assign({style:B.link},{children:e}))})):(0,i.jsx)(r.Text,Object.assign({style:B.link},{children:e}));return(0,i.jsx)(u.default,Object.assign({wrapperOnly:!1,getMenuItems:R,onItemSelected:O,renderAsText:!0},{children:D}))}),(e=>Object.assign(Object.assign({},e),{magicBotId:a.default.getS4LMessagingFeatures().magicBotId})))},419895:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BingResponseHoveredContext=void 0;const i=s(667294);t.BingResponseHoveredContext=(0,i.createContext)(!1)},800161:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BingResponseNode=void 0;const i=s(785893),o=s(667294),n=s(516778),r=s(705465),a=s(512193),l=s(733754),d=s(140508),c=s(419895),h=s(31280),u=s(258187),p=s(311010),g=(s(969716),s(493625));t.BingResponseNode=function({attributions:e,message:t,decodedNode:s,messageActions:m,linkSelectable:S,linkClickable:f,supportsCopy:y,onLongPress:v,onEdit:C,onQuote:_,renderOrigin:b,onPressInterceptionCallback:T,children:M,numberOfLines:I}){const w=(0,u.useCommonContext)(),[P,k]=(0,o.useState)(!1),[A,x]=(0,o.useState)(!1),{dividerStyle:R,attributionsContainer:O,learnMoreText:L,reducedHeightContainer:F}=(0,a.useRXStyles)((e=>({dividerStyle:n.Styles.createViewStyle({borderColor:e.themeColors.strokeSecondary,borderTopWidth:1,borderStyle:"solid",marginVertical:12},!1),learnMoreText:n.Styles.createTextStyle({textAlign:w.isRTL?"right":"left",lineHeight:20,marginBottom:4},!1),attributionsContainer:n.Styles.createTextStyle({flexDirection:w.isRTL?"row-reverse":"row",flexWrap:"wrap",paddingBottom:6,marginLeft:-2},!1),reducedHeightContainer:n.Styles.createViewStyle({overflow:"hidden",maxHeight:I?I*p.default.messageTextLineHeight:void 0},!1)})),[w.isRTL,I]);let B,D=[];e.length>3?[B,D]=[e.slice(0,2),e.slice(2)]:B=e;const E=e=>{var o,n;return(0,i.jsx)(d.AttributionNode,Object.assign({node:e,isFooter:!0,message:t,decodedNode:s,messageActions:m,linkSelectable:S,linkClickable:f,supportsCopy:y,onLongPress:v,onEdit:C,onQuote:_,renderOrigin:b,onPressInterceptionCallback:T},{children:l.getString("BingResponseNode.FooterAttributionText",{index:null!==(o=e.index)&&void 0!==o?o:"1",anchor:null!==(n=e.anchor)&&void 0!==n?n:""})}),e.index)},V=D.length?(0,i.jsx)(d.AttributionNode,Object.assign({isFooter:!0,onPress:e=>{e.preventDefault(),k(!P)},message:t,decodedNode:s,messageActions:m,linkSelectable:!1,supportsCopy:!1,linkClickable:!0},{children:l.getString("BingResponseNode.PlusMore",{count:D.length})})):null,N=B.map(E),U=D.map(E),j=(0,o.useCallback)((()=>x(!0)),[]),H=(0,o.useCallback)((()=>x(!1)),[]),z=(0,g.useFocus)({onFocus:j,onBlur:H});let W=M;const G=(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.View,{style:R}),(0,i.jsx)(h.Caption,Object.assign({selected:!0,style:L},{children:l.getString("BingResponseNode.LearnMore")})),(0,i.jsxs)(n.View,Object.assign({style:O},{children:[N,P?U:V]}))]});return(0,i.jsx)(c.BingResponseHoveredContext.Provider,Object.assign({value:A},{children:(0,i.jsx)(r.View,Object.assign({onTouchStart:z},{children:(0,i.jsxs)(n.View,Object.assign({onMouseEnter:j,onMouseLeave:H},{children:[W,!I&&e.length?G:null]}))}))}))}},493625:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useFocus=void 0;const i=s(667294),o=s(692375);t.useFocus=({onFocus:e,onBlur:t})=>{const[s,n]=(0,i.useState)(),r=(0,i.useCallback)((t=>{n(t.target),e()}),[e]),a=(0,i.useCallback)((e=>{s&&e.target!==s&&(n(void 0),t())}),[t,s]);return(0,o.useRootTouchEvents)(o.TouchEventType.TouchStart,a),r}},225739:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MenuItem=void 0;const i=s(496486),o=s(889391),n=s(598925),r=s(890239),a=s(671830),l=s(733754),d=s(149769),c=s(640363),h=s(286259);var u;!function(e){e.Settings="settings",e.SendSMS="sendsms",e.PrivateConversation="privateconversation",e.NewGroup="newgroup",e.ShareLink="sharelink",e.AddParticipants="addparticipants",e.Gallery="gallery"}(u=t.MenuItem||(t.MenuItem={}));t.default=new class{constructor(){this._validateMenuItem=(e,t)=>{switch(e){case u.Settings:case u.ShareLink:case u.AddParticipants:return!0;case u.SendSMS:return t.otherPartyMri&&t.canShowSmsEntryPoint&&d.default.canSendSMSToMri(t.otherPartyMri);case u.PrivateConversation:return t.otherPartyMri&&!t.isEncryptedThread&&t.otherPartyMri!==c.default.getEchoMri()&&!a.isAgent(t.otherPartyMri)&&!a.isPhoneMri(t.otherPartyMri);case u.NewGroup:return!t.isEncryptedThread;default:return!1}}}accessibilityLabel(e,t,s,i){let o=l.getString("ContentPanelHeader.ProfileButtonAccessibilityLabel",{conversationName:e.conversationName})+", ";if(e.isEncryptedThread&&(o+=l.getString("ContentPanelHeader.PrivateConversationLabel")+", "),!t)if(s&&e.userPresence){const t=h.accessibilityLabelForUserStatus(e.userPresence);t&&(o+=t+", "),e.moodLabel?o+=e.moodLabel+", ":e.moodRawText?o+=l.getString("ContentPanelHeaderTitle.MoodMessageWrapper",{moodMessage:e.moodRawText})+", ":e.isUserActive||e.userPresence.status===r.UserStatus.Busy||e.isEncryptedThread||(o+=a.getLastSeenPresenceText(e.userPresence,!1,e.gender,e.isUserActive,!0),o+=", ")}else e.memberCount&&(i&&e.callRateText&&(o+=e.callRateText+", "),e.isOneOnOne||(o+=l.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:e.memberCount})+", "));return o+=l.getString("UserProfilePanel.ViewProfileLabel"),o}callingDisabledTooltip(e){let t;switch(e){case n.CallValidationFailureReason.GroupTooLarge:t=l.getString("ContentPanelHeader.CallDisabledToolTip");break;case n.CallValidationFailureReason.RegularMemberInModeratedGroup:t=l.getString("ContentPanelHeader.CallDisabledModeratedToolTip");break;case n.CallValidationFailureReason.PlatformNotSupported:t=l.getString("ContentPanelHeader.PlatformNotSupportedTooltip");break;case n.CallValidationFailureReason.E2eeHandshakeIncomplete:case n.CallValidationFailureReason.GogoNetwork:default:t=void 0}return t}getMenuItems(e){if(e.isMriBlocked)return[];const t=o.default.getS4LUiFeaturesNoSubscription().contextHeaderDropdownActions,s=[];return i.each(e.otherPartyMri?t.oneOnOne:t.group,(t=>{this._validateMenuItem(t,e)&&s.push(t)})),s}getPresenceStatusForIcon(e,t){return e?r.UserStatus.Online:h.getMappedStatusIfValid(t)}}},96539:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationsListHelper=t.engagementBannerModernizedHeight=t.engagementBannerHeight=void 0;const i=s(496486),o=s(583367),n=s(823113),r=s(396265),a=s(516778),l=s(244770),d=s(889391),c=s(994224),h=s(671830),u=s(496418),p=s(780128),g=s(898278),m=s(475760),S=s(331751),f=s(820770),y=s(192758),v=s(539549),C=s(731761),_=s(546172),b=s(72822),T=s(956280),M=s(968894),I=s(470942),w=s(746096),P=s(172146),k=s(436237),A=s(733754),x=s(603088),R=s(866127),O=s(734537),L=s(844285),F=s(593486),B=s(257538),D=s(716492),E=s(391659),V=s(812944),N=s(104735),U=s(446068),j=s(581736),H=s(328377),z=s(882052),W=s(768794),G=s(793003),K=s(29130),q=s(914976),Q=s(451070),X=s(170919),$=s(210541),J=s(640363),Y=s(711828),Z=s(478262),ee=s(360305),te=s(418037),se=s(388117),ie=s(567977),oe=s(721788),ne=s(330124),re=s(846116),ae=s(809206),le=s(582916),de=s(741660),ce=s(791193);t.engagementBannerHeight=60,t.engagementBannerModernizedHeight=88;const he=[M.EngagementBannerType.SyncContacts],ue=e=>e=>e.isOneOnOne()&&d.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations&&!h.isMyBotConversation(e.id)?S.default.isGroupMarkedAsFavorite(e.id):e.isFavorite(),pe=e=>he.includes(e);class ge{constructor(e,t,s){this._shownConversations=[],this._recentConversations=[],this._conversationsListStore=(0,v.default)(),this._archivedConversations=this._conversationsListStore.getSortedArchivedConversations(),this._rowSize=z.default.recentRowSizeAndChanges(),this._contentSizeMultiplier=K.default.getContentSizeMultiplier(),this._onboardingFeatures=d.default.getOnboardingFeatures(),this._conversationSorter=e=>{let t=0;const s=f.default.getSavedMessageInput(e.id);s&&s.timestamp?t=s.timestamp:d.default.getS4LMessagingFeatures().enableMediaPreviewDrafts&&(t=x.default.getDraftPreviewTimestamp(e.id)||0);const o=(0,v.default)().getFakeTimestamp(e.id),n=e.getTimestamp();return-(i.max([o,t,n])||0)},this._rootViewId=e,this._isUsingStackNavigationContext=t,this._isPresentedInDesktopLeftNav=s}getShownConversationsCount(){return this._shownConversations.length}getFavoritesCount(){return i.filter(this._shownConversations,(e=>e.isFavorite())).length}_partitionConversationBasedOnSort(e,t,s,o){let n=[],r=[];const a=this._recentConversations;switch(s){case G.RecentsSortBy.Time:if(t){const e=i.partition(a,ue());n=e[0],r=e[1]}else r=a;return this._normalizeResults([],n,r);case G.RecentsSortBy.Unread:const s=m.default.getConversationsWithUnreadCounts(),l=t=>{const i=d.default.getS4LMessagingFeatures();if(f.default.getDraftTimestampForConversation(t.id))return!0;if(i.enableMediaPreviewDrafts&&x.default.getDraftPreviewTimestamp(t.id))return!0;if(this._isUsingStackNavigationContext)return s[t.id]&&!t.isMuted();return o===t.id&&e===o&&!t.isMuted()||s[t.id]&&!t.isMuted()},c=e=>(0,de.isContentChannel)(e);if(t){const e=i.partition(a,ue()),t=i.partition(e[0],l),s=t[0].concat(t[1]),o=i.partition(e[1],l),d=i.partition(o[0],c);n=s,r=d[1].concat(d[0]).concat(o[1])}else{const e=i.partition(a,l),t=i.partition(e[0],c);r=t[1].concat(t[0]).concat(e[1])}return this._normalizeResults([],n,r);case G.RecentsSortBy.Active:const h=oe.default.getActiveUserMris(),[u,p]=i.partition(a,(e=>h[e.id])),[g,S]=i.partition(p,ue());return this._normalizeResults(u,g,S);default:return[]}}_normalizeResults(e,t,s){return i.map([e,t,s],(e=>this._mapConversationsToIds(S.default.filterGrouped1on1s(e))))}_mapConversationsToIds(e){return i.map(e,(e=>e.id))}_pinMybotToTopFavorite(e,t){if(!t)return e;const s=h.getMyBotId(),i=e.findIndex((e=>e===s));if(-1===i)return e;const o=[...e];return o.splice(i,1),o.unshift(s),k.log(w.LogTraceArea.ConversationsListItem,"[ConversationsListHelper] [_pinMybotToTopFavorite] pin my bot conversation to top Favorite"),o}isAnyConversationArchived(){return!i.isEmpty(this._archivedConversations)}_getListItemHeight(e,t,s){const i=Math.min(this._contentSizeMultiplier,g.MaxContentSizeMultiplier),o=K.default.isMobileScreenSize(this._rootViewId)&&!ee.default.isTabletUI()&&!_.default.collapseDesktopStackNavContext(),n=this._isUsingStackNavigationContext?0:5;if(this._rowSize===G.RowSize.ExtraCompact)return 36*(i||1);if(this._rowSize===G.RowSize.Compact){return(this._isUsingStackNavigationContext?56:40)*(i||1)+n}{const r=e&&!t?50:o?35:44,a=e&&!t?s?26:28:10,l=e&&!t?s?76:78:o?35:55;return Math.max(l,r+n+Math.round(a*i))}}_mapConversationsToListItem(e,t=[],s,o,n,r,a,l,d,c,h=(e=>!1)){return i.flatten(i.map(e,((e,i)=>{const u=!!o&&this._isSelected(e,t,s,o),p=[this._allocateListItem(e,i,h(i),u,n,l,d,c)];return r&&p.push(this._getItemSpacer(2,a.idx++)),p})))}_allocateListItem(e,t,s,i,o,n,r,l){let c;J.default.isElectronOsx()&&(c=A.getString("ConversationsListItem.ConversationItemLabel"));let u=this._getListItemHeight(o,n,r);return d.default.getS4LMessagingFeaturesNoSubscription().enableMagicBotSuggestionsOnChatListPanel&&(0,re.isMagicBotConversation)(e)&&(u+=38),{key:e,height:u,index:t,isLastItem:s,isNavigable:!0,template:h.isThread(e)?le.ConversationListItemNames.groupChat:le.ConversationListItemNames.oneOnOneConv,isUsingStackNavigationContext:this._isUsingStackNavigationContext,itemHeight:-1,useMobileView:o,isSelected:i,rowSize:this._rowSize,useCompactIcon:l,ariaRoleDescription:c,accessibilityTrait:a.Types.AccessibilityTrait.Button,obfuscatedKeyForLogging:q.mriOrId(e)}}_isSelected(e,t,s,o){if(e===o)return!0;if(d.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations){const n=i.find(s,(t=>t.id===e));if(n&&n.isOneOnOne()&&!n.hasActiveCall()){const e=(0,v.default)().getConversation(o);if(e&&e.isOneOnOne()&&!e.hasActiveCall()&&!i.some(t,(t=>t===e.id||t===n.id)))return!0}}return!1}_getTopInset(e){return{key:le.ConversationListItemNames.topSpacer,height:e,template:le.ConversationListItemNames.topSpacer,isNavigable:!1}}_getItemSpacer(e,t){return{key:le.ConversationListItemNames.itemSpacer+t,height:e,template:le.ConversationListItemNames.itemSpacer,isNavigable:!1}}_getDivider(e){return{key:le.ConversationListItemNames.divider,height:e,template:le.ConversationListItemNames.divider,isNavigable:!1}}_getBottomPadding(e){return{key:le.ConversationListItemNames.bottomSpacer,height:e,template:le.ConversationListItemNames.bottomSpacer,isNavigable:!1}}_getNotificationsPrompt(e){const t=this._getNotificationPromptListItemHeight(e);return{key:le.ConversationListItemNames.notificationsPrompt,height:t,template:le.ConversationListItemNames.notificationsPrompt}}_getNotificationPromptListItemHeight(e){let t=144;return t=K.default.getDeviceOrientation(this._rootViewId)===o.DeviceOrientation.Landscape?71:e||this._isPresentedInDesktopLeftNav?U.default.containsLargeContent()?190:160:144,t*Math.min(this._contentSizeMultiplier||1,g.MaxContentSizeMultiplier)}_getLoadingIndicator(e,t,s){return{key:le.ConversationListItemNames.loadingIndicator,height:this._getListItemHeight(e,t,s),template:le.ConversationListItemNames.loadingIndicator,isUsingStackNavigationContext:this._isUsingStackNavigationContext,measureHeight:!1,isNavigable:!1}}_getSearchBar(e,t,s){const i=p.default.shouldUseIOSSearchStyles(),o=t?X.SearchInputHeight.modernizedSmall:i?X.SearchInputHeight.iOS:K.default.isSmallDevice(this._rootViewId)?X.SearchInputHeight.small:X.SearchInputHeight.default;return{key:le.ConversationListItemNames.searchBar,height:o,template:le.ConversationListItemNames.searchBar,isUsingStackNavigationContext:this._isUsingStackNavigationContext,showFilterIcon:!!e,useIOSSearchStyles:i,theme:te.default.colorTheme(),safeAreaHorizontalInsets:this.getSafeAreaHorizontalInsets(t),language:s}}_getFinishSetupPrompt(e){return{key:le.ConversationListItemNames.finishSetupPrompt,height:e||this._isPresentedInDesktopLeftNav?160:144,template:le.ConversationListItemNames.finishSetupPrompt}}_getEngagementBanner(e){return{key:le.ConversationListItemNames.engagementBanner,height:pe(e)?t.engagementBannerModernizedHeight:t.engagementBannerHeight,template:e}}getSafeAreaHorizontalInsets(e){const t=O.default.getRowPadding(e),s=i.clone(Q.default.horizontalInsets());return s.left&&(s.left=Math.max(s.left-(this._isUsingStackNavigationContext?t.left:t.leftDesktop),0)),s.right&&(s.right=Math.max(s.right-(this._isUsingStackNavigationContext?t.right:t.rightDesktop),0)),s}_getRecentsViewModeType(e){let t=le.ConversationsListMode.AllConversations;return this._isUsingStackNavigationContext?e&&(t=e):t=y.default.getConversationsListMode(),t}createSectionHeader(e,t){const s=A.getString(e);return{key:le.ConversationListItemNames.header+e,height:(0,ce.getCategoryHeaderHeight)(t),template:le.ConversationListItemNames.header,title:s,isNavigable:!1,accessibilityGroup:r.Types.AccessibilityGroupMarker.Begin,accessibilityGroupLabel:s,accessibilityTrait:a.Types.AccessibilityTrait.None}}_createSectionHeaderSpacer(e){return{key:le.ConversationListItemNames.header+e,height:20,template:le.ConversationListItemNames.header,title:"",isNavigable:!1,isHoverable:!1}}_getIconSize(e,t,s,i,o){return e===G.RowSize.Compact||e===G.RowSize.ExtraCompact||i?s?ie.AvatarIconSize.Size40:ie.AvatarIconSize.Size24:t&&!o?ie.AvatarIconSize.Size60:s?ie.AvatarIconSize.Size40:ie.AvatarIconSize.Size36}_getBaseAdHeight(e){return e.adsType===T.AdsType.PanelBanner?80:e.provider===T.AdsProvider.MeetNow&&e.adsType===T.AdsType.ListItem?140:e.adsType===T.AdsType.ListItemNarrow?78:154}_createNativeAdItem(e,t,s,i,o){const n=d.default.getAdsFeatures().placementSettings.conversationList,r=t||300,l=this._getIconSize(this._rowSize,s,!!this._isUsingStackNavigationContext,!!i,o),c=E.default.calculateConversationListNativeAdDimensions(r,this._getBaseAdHeight(e),this._getListItemHeight(s,o),E.default.includeMediaInAdHeight(e),l,se.default.getIconSize(l).user,n.dynamicDimensionsSettings,o);return{key:le.ConversationListItemNames.nativeAd,adsGuid:e.guid,adGuid:e.ads[0],isLastItem:!1,height:c.totalHeight,dimensions:c,placementId:n.placementIds[0],template:le.ConversationListItemNames.topSpacer,accessibilityTrait:a.Types.AccessibilityTrait.Group,accessibilityLabel:A.getString("NativeAd.AdAccessibilityLabel"),isUsingStackNavigationContext:!!this._isUsingStackNavigationContext,canHide:n.canHide,provider:e.provider,adType:e.adsType}}_insertNativeAdIntoList(e,t,s,i,o,n,r,a,l,c){const h=d.default.getAdsFeatures().placementSettings.conversationList,u=n||K.default.getHeight(this._rootViewId),p=this._createNativeAdItem(s,r,a,l,c),g=E.default.calculateNativeAdsPositionInListView({maxHeight:u,items:e,startPosition:i,additionalGroupsStartPositions:o,nativeAdsHeight:p.height,adsConfig:h});g===e.length?this._pushNativeAdToTheEnd(p,e,t):e.splice(g,0,p)}_pushNativeAdToTheEnd(e,t,s){e.isLastItem=!0,s.length&&t.length&&t[t.length-1].key===s[s.length-1]&&(t[t.length-1].isLastItem=!1),t.push(e)}_getUsedspace(e){return i.sumBy(e,(e=>e.key===le.ConversationListItemNames.emptyState?0:e.height))}_getEmptyStateListItemHeight(e,t,s){const i=t-e;return s<=i?i:s}_setRecentsConversations(e){this._recentConversations=i.orderBy(e,this._conversationSorter)}_splitConversationBasedOnOngoingCalls(){const e=c.default.CallingStore.getConnectedOrOutgoingCallIds(),t=i.map(e,(e=>c.default.CallingStore.getCallConversationMri(e)));return i.partition(this._shownConversations,(e=>e.hasActiveCall()||i.includes(t,e.id)))}_splitConversationsForMagicBot(){return i.partition(this._recentConversations,(this._recentConversations,e=>!!d.default.getS4LMessagingFeaturesNoSubscription().enableMagicBot&&(0,re.isMagicBotConversation)(e.id)))}_isMagicBotOnlyConversation(){return 0===this._shownConversations.length||1===this._shownConversations.length&&1===this._shownConversations.filter((e=>(0,re.isMagicBotConversation)(e.id))).length}_getEmptyStateListItem(e,t,s,i){const n=!e&&t,r=n&&s&&t?this._getEmptyStateListItemHeight(i,s,t):void 0;return{key:le.ConversationListItemNames.emptyState,height:r||1,measureHeight:!n,template:le.ConversationListItemNames.emptyState,isUsingStackNavigationContext:!!this._isUsingStackNavigationContext,hideSyncAddressBookCta:!0,isLandscape:K.default.getDeviceOrientation(this._rootViewId)===o.DeviceOrientation.Landscape,accessibilityTrait:a.Types.AccessibilityTrait.None}}_hasUserSyncedContacts(){return!j.default.systemPromptHasNotBeenDisplayed(Z.PermissionType.Contacts)&&j.default.permissionStatus(Z.PermissionType.Contacts)===n.PermissionStatus.Granted}_isPermissionsPromptRequired(){return j.default.systemPromptHasNotBeenDisplayed(Z.PermissionType.Microphone)||!this._onboardingFeatures.enableInContextCameraPermission&&j.default.systemPromptHasNotBeenDisplayed(Z.PermissionType.Camera)}_shouldDisplayFinishSetupPrompt(){let e=!1;P.default.isSetupWizardCompleted(),P.default.isOnboardingSkipped();return F.default.isChild()&&(e=!1),e}_shouldShowMobileNotificationPrompt(e,t){return e&&t&&!1}getNumberOfConversationsToFit(e,t){return Math.floor(e/this._getListItemHeight(!1,t))}getArchivedConversation(e){if(!e)return this._archivedConversations;const t=this._conversationsListStore.getArchivedChannels(),s=this._conversationsListStore.getArchivedChats();switch(e){case"channels":return[];case"chats":return s;default:return[...s,...t]}}getConversationsItemsList(e,t,s,o,n,r,a,l,c,h,p,g,m,f,v,C,_=!1,b=!1,I=!1,A=!1,x){this._shownConversations=e;const O=this._splitConversationBasedOnOngoingCalls();this._setRecentsConversations(O[1]);let L=[[]];!b||I||this._isMagicBotOnlyConversation()||(L=this._splitConversationsForMagicBot(),this._setRecentsConversations(L[1]));const B=[];let N=[],U=[],j=[];const H=m?S.default.getAllSiblingConversations(m):[];t&&B.push(this._getTopInset(t));const Q=this._getRecentsViewModeType(o.viewType),X=R.default.canModernizeConversationList(),$=ne.default.isUsingStackNavigationContext(),J=R.default.canModernizeConversationList()&&(f||v),Y={idx:0};if(Q===le.ConversationsListMode.ArchivedConversations)B.push.apply(B,this._mapConversationsToListItem(this._mapConversationsToIds(this.getArchivedConversation(x)),[],H,m,o.useMobileView,J,Y,X,$,o.useCompactIcon));else if(Q===le.ConversationsListMode.AllConversations){const e=d.default.getAdsFeatures(),t=z.default.shouldShowCategories(),S=this._shownConversations,f=e.placementSettings.conversationList,v=(E.default.shouldGetAdsInConversationsList(T.AdsType.ListItem,S)||E.default.shouldGetAdsInConversationsList(T.AdsType.ListItemNarrow,S))&&this._rowSize===G.RowSize.Default,I=this._mapConversationsToIds(O[0]),x=this._mapConversationsToIds(L[0]);o.useMobileView&&!o.hideSearchBar&&(B.push(this._getSearchBar(o.showFilterIcon,$,C)),B.push(this._getItemSpacer(8,Y.idx++)));const R=this._shouldDisplayFinishSetupPrompt(),Q=d.default.getS4LMessagingFeatures(),Z=this._shouldShowMobileNotificationPrompt(Q.enableNotificationPrompt,o.useMobileView)&&!R,te=K.default.isMobileScreenSize(this._rootViewId)&&!ee.default.isTabletUI();Z&&B.push(this._getNotificationsPrompt(te)),R&&B.push(this._getFinishSetupPrompt(te)),[N,U,j]=this._partitionConversationBasedOnSort(c,t,h,m);const se=t&&h!==G.RecentsSortBy.Active&&(I.length>0||x.length>0||U.length>0);let ie=!1;_||se||!$||(B.push(this._getItemSpacer(8,Y.idx++)),ie=!0);const oe=!Q.hideConversationsListSectionHeaders;if(o.useMobileView&&!oe&&(B.push(this._getItemSpacer(8,Y.idx++)),ie=!0),I.length>0){if(oe&&(se||this._isPresentedInDesktopLeftNav)){const e=X&&(se||!this._isPresentedInDesktopLeftNav);e&&(ie=!0,B.push(this._getItemSpacer(2,Y.idx++))),$&&(B.push(this._getItemSpacer(8,Y.idx++)),ie=!0),B.push(this.createSectionHeader("ConversationsListPanel.OngoingCallsTitle",$)),e&&B.push(this._getItemSpacer(2,Y.idx++))}B.push.apply(B,this._mapConversationsToListItem(I,I,H,m,o.useMobileView,J,Y,X,$,o.useCompactIcon)),oe&&!se&&this._isPresentedInDesktopLeftNav&&B.push(this._createSectionHeaderSpacer("ongoingcall"))}const ne=B.length-1,re=[];b&&x.length>0&&(oe&&se&&(X&&!ie&&(B.push(this._getItemSpacer(2,Y.idx++)),ie=!0),$&&!ie&&(B.push(this._getItemSpacer(8,Y.idx++)),ie=!0),B.push(this.createSectionHeader("ConversationsListPanel.MagicBotTitle",$)),X&&B.push(this._getItemSpacer(2,Y.idx++))),re.push({groupName:T.AdsListGroupType.MagicBot,position:B.length-1}),B.push.apply(B,this._mapConversationsToListItem(x,I,H,m,o.useMobileView,J,Y,X,$,o.useCompactIcon))),N&&N.length>0&&B.push.apply(B,this._mapConversationsToListItem(N,I,H,m,o.useMobileView,J,Y,X,$,o.useCompactIcon)),U.length>0&&(U=this._pinMybotToTopFavorite(U,A),oe&&se&&(X&&!ie&&(B.push(this._getItemSpacer(2,Y.idx++)),ie=!0),$&&!ie&&(B.push(this._getItemSpacer(8,Y.idx++)),ie=!0),B.push(this.createSectionHeader("ConversationsListPanel.FavoritesTitle",$)),X&&B.push(this._getItemSpacer(2,Y.idx++))),re.push({groupName:T.AdsListGroupType.Favourites,position:B.length-1}),B.push.apply(B,this._mapConversationsToListItem(U,I,H,m,o.useMobileView,J,Y,X,$,o.useCompactIcon))),U.length>0&&!oe&&t&&(B.push(this._getItemSpacer(4,Y.idx++)),B.push(this._getDivider(.5)),B.push(this._getItemSpacer(6,Y.idx++))),oe&&se&&(X&&!ie&&(B.push(this._getItemSpacer(2,Y.idx++)),ie=!0),$&&!ie&&(B.push(this._getItemSpacer(8,Y.idx++)),ie=!0),B.push(this.createSectionHeader("ConversationsListPanel.ChatsTitle",$)),X&&B.push(this._getItemSpacer(2,Y.idx++))),re.push({groupName:T.AdsListGroupType.Recents,position:B.length-1}),B.push.apply(B,this._mapConversationsToListItem(j,I,H,m,o.useMobileView,J,Y,X,$,o.useCompactIcon,(e=>e===j.length-1))),y.default.areConversationsLoading()&&B.push(this._getLoadingIndicator(o.useMobileView,X,$));const de=v?D.default.getAdsState(f.placementIds[0],{refreshIntervalInMinutes:f.refreshIntervalInMinutes,isAdMediaClickable:f.isAdMediaClickable,placementName:V.NativeAdPlacementName.ConversationList,provider:f.provider,adsType:f.adsType,otherProviders:f.otherProviders,testDevices:e.testDevices}):void 0;de&&de.status===D.AdsStatus.Loaded&&this._insertNativeAdIntoList(B,j,de,ne,re,p,g,o.useMobileView,o.useCompactIcon,X),!d.default.getS4LMessagingFeatures().modernizeIllustrations&&this.shouldContainEmptyStateItem()&&B.push(this._getEmptyStateListItem(n,r,a,this._getUsedspace(B)));const ce={[M.EngagementBannerType.CreateGroup]:this._getCreateGroupOrFallbackBanner.bind(this),[M.EngagementBannerType.SyncContacts]:this._getSyncContactOrFallbackBanner.bind(this),[M.EngagementBannerType.MeetNow]:this._getMeetNowOrFallbackBanner.bind(this)},he=this._onboardingFeatures.features.emptyStateBanner,ue=P.default.getBannerState();if(!F.default.isChild()&&he.enabled&&ue===M.EngagementBannerAction.NotDisplayed&&!s){const e=u.default.isCoachMarkBeingShown();if(k.log(w.LogTraceArea.ConversationsListItem,`\n                     Conditions for the CTA Banner _bannerState - ${ue},\n                     isCoachMarkBeingShown - ${e}\n                     shouldDisplayFinishSetupPrompt - ${R}\n                     active calls - ${I.length}\n                     BannerType - ${this._onboardingFeatures.features.emptyStateBanner.type}\n                 `),!R&&!Z&&!e&&0===I.length){const e=ce[he.type](B);if(void 0!==e){const t=B.findIndex((e=>e.template===le.ConversationListItemNames.searchBar)),s=1;B.splice(t+s,0,this._getEngagementBanner(e))}}}const pe=ae.BrowserEnvironment.isMobile();if(s&&pe&&this.getShownConversationsCount()>=2){const e=B.findIndex((e=>e.template===le.ConversationListItemNames.searchBar))+(pe?2:1);B.splice(e,0,{key:le.ConversationListItemNames.conversationsListBanner,height:120,measureHeight:!0,template:le.ConversationListItemNames.conversationsListBanner})}n&&(W.default.trackSortByFilter(h),W.default.trackRowSize(this._rowSize),W.default.trackShowCategories(t));const ge=o.bottomPadding?B.length+1:B.length;"off"===Q.convPanelLoggingLevel||!n&&ge===l||(k.log(w.LogTraceArea.ConversationsListItem,"ConversationsListPanel buildState: "+ge+" items, "+N.length+" top, "+U.length+" favorites, "+j.length+" rest, sorted by "+G.RecentsSortBy[h]),"full"===Q.convPanelLoggingLevel&&k.log(w.LogTraceArea.ConversationsListItem,"ConversationsListPanel buildState: top: ["+i.join(i.map(N,(e=>q.mriOrId(e))),", ")+"], favorites: ["+i.join(i.map(U,(e=>q.mriOrId(e))),", ")+"], rest: ["+i.join(i.map(j,(e=>q.mriOrId(e))),", ")+"]"))}return o.bottomPadding&&B.push(this._getBottomPadding(o.bottomPadding)),B.filter((e=>void 0!==e))}shouldContainEmptyStateItem(){return this._shownConversations.length<2&&!i.isUndefined(H.default.getSyncAddressBookPrivacySetting())}_getCreateGroupOrFallbackBanner(e){return i.some(e,(e=>e.template===le.ConversationListItemNames.groupChat))?M.EngagementBannerType.MeetNow:M.EngagementBannerType.CreateGroup}_getMeetNowOrFallbackBanner(e){return M.EngagementBannerType.MeetNow}_getSyncContactOrFallbackBanner(e){const t=j.default.permissionStatus(Z.PermissionType.Contacts),s=e.find((e=>e.key===le.ConversationListItemNames.emptyState)),o=!!i.isUndefined(s)||s.hideSyncAddressBookCta,r=e.filter((e=>this._isItemConversationOrGroupChat(e))).length;return t===n.PermissionStatus.Unknown&&o&&r<=this._onboardingFeatures.features.emptyStateBanner.syncContactsBannerConvCountLimit?M.EngagementBannerType.SyncContacts:M.EngagementBannerType.MeetNow}_isItemConversationOrGroupChat(e){return e.template===le.ConversationListItemNames.groupChat||e.template===le.ConversationListItemNames.oneOnOneConv}getConversationAdBanner(e,t,s){const i=d.default.getAdsFeatures(),o=i.placementSettings.conversationList,n=E.default.shouldGetAdsInConversationsList(T.AdsType.PanelBanner,this._shownConversations)&&!e?D.default.getAdsState(o.placementIds[0],{refreshIntervalInMinutes:o.refreshIntervalInMinutes,isAdMediaClickable:o.isAdMediaClickable,placementName:V.NativeAdPlacementName.ConversationList,provider:o.provider,adsType:o.adsType,otherProviders:o.otherProviders,testDevices:i.testDevices}):void 0;if(!n||n.status!==D.AdsStatus.Loaded)return;const r=t||300;return this._createNativeAdItem(n,r,!1,!1,s)}static syncContactsClickHandler(e,t){N.default.navigateToSyncAddressBook({origin:t,hideSkipButton:!0},void 0,e)}static isEngagementBannerConfigModernizedType(e){return void 0!==e&&"image"in e&&!("icon"in e)}static getEngagementBannerProps(e,t){return pe(e)?this.getEngagementBannerModernizedProps(e,t):this.getEngagementBannerLegacyProps(e,t)}static getEngagementBannerOnCloseHandler(e){return()=>{P.default.setBannerState(M.EngagementBannerAction.Dismissed),k.track(new I.EngagementBannerTelemetryEvent(e,M.EngagementBannerAction.Dismissed))}}static getEngagementBannerModernizedProps(e,t){return e===M.EngagementBannerType.SyncContacts?{title:A.getString("UserSettingsPanel.SyncAddressBook"),description:A.getString("ConversationsListPanelEmptyState.SyncContactsEngagementBannerDescription"),bannerType:M.EngagementBannerType.SyncContacts,image:l.Collection.SYNC_CONTACTS_PEOPLE,onClick:()=>{ge.syncContactsClickHandler(t.rootViewId,b.DialogNavOrigin.RecentChatsBanner),P.default.setBannerState(M.EngagementBannerAction.Clicked),k.track(new I.EngagementBannerTelemetryEvent(e,M.EngagementBannerAction.Clicked))},onClose:this.getEngagementBannerOnCloseHandler(e)}:this.getEngagementBannerLegacyProps(e,t)}static getEngagementBannerLegacyProps(e,t){const s=this.getEngagementBannerOnCloseHandler(e);switch(e){case M.EngagementBannerType.CreateGroup:return{title:A.getString("ConversationsListPanelEmptyState.FirstGroupEngagementBannerTitle"),description:A.getString("ConversationsListPanelEmptyState.FirstGroupEngagementBannerDescription"),bannerType:M.EngagementBannerType.CreateGroup,icon:Y.SkypeIcon.ContactGroupAdd,size:Y.IconSize.size28,onClick:()=>{new C.default({navigationOrigin:w.NavigationConversationOrigin.NewGroup,peopleType:$.PeopleType.All,filterPeopleType:$.FilterType.GroupCapable}).start(t.rootViewId),P.default.setBannerState(M.EngagementBannerAction.Clicked),k.track(new I.EngagementBannerTelemetryEvent(e,M.EngagementBannerAction.Clicked))},onClose:s};case M.EngagementBannerType.SyncContacts:return{title:A.getString("UserSettingsPanel.SyncAddressBook"),description:A.getString("ConversationsListPanelEmptyState.SyncContactsEngagementBannerDescription"),bannerType:M.EngagementBannerType.SyncContacts,icon:Y.SkypeIcon.ContactCard,size:Y.IconSize.size28,onClick:()=>{ge.syncContactsClickHandler(t.rootViewId,b.DialogNavOrigin.RecentChatsBanner),P.default.setBannerState(M.EngagementBannerAction.Clicked),k.track(new I.EngagementBannerTelemetryEvent(e,M.EngagementBannerAction.Clicked))},onClose:s};case M.EngagementBannerType.MeetNow:default:return{title:A.getString("Onboarding.LandingScreenWithCardsCardTitle7"),description:A.getString("ConversationsListPanelEmptyState.MeetNowEngagementBannerDescription"),bannerType:M.EngagementBannerType.MeetNow,icon:Y.SkypeIcon.MeetNow,size:Y.IconSize.size28,onClick:()=>{L.MeetNowHelpers.showNewMeetNow(B.MeetNowOrigin.RecentChatsBanner),P.default.setBannerState(M.EngagementBannerAction.Clicked),k.track(new I.EngagementBannerTelemetryEvent(e,M.EngagementBannerAction.Clicked))},onClose:s}}}}t.ConversationsListHelper=ge},637324:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLeaveSectionMenuItems=t.RowDecoratorType=t.ConversationCommands=void 0;const i=s(496486),o=s(889391),n=s(480200),r=s(671830),a=s(711930),l=s(898278),d=s(733754),c=s(581760),h=s(711828),u=s(360305),p=s(897634),g=s(286259),m=s(846116),S=s(436303);var f,y;t.ConversationCommands={Unfavorite:"unfavorite",Favorite:"favorite",Unblock:"unblock",BlockContact:"block",Call:"call",AudioCall:"audioCall",ClearConversation:"clearConversation",DeleteConversation:"deleteConversation",DeleteBotFromContacts:"deleteBotFromContacts",AddBotToContacts:"addBotToContacts",LeaveConversation:"leave",MarkRead:"markRead",MarkUnread:"markUnread",Profile:"profile",ManageGroup:"settings",Archive:"archive",Unarchive:"unarchive",Mute:"mute",Unmute:"unmute",More:"more",CopyLink:"copyLink",MagicBotPin:"magicBotPin",MagicBotUnpin:"magicBotUnpin"},function(e){e.More="more",e.Call="call",e.Archive="archive",e.MarkRead="markread",e.Mute="mute"}(f||(f={})),function(e){e[e.Avatar=0]="Avatar",e[e.Status=1]="Status",e[e.Icon=2]="Icon",e[e.None=3]="None"}(y=t.RowDecoratorType||(t.RowDecoratorType={}));class v{static getMenuSections(e){return[{key:"magicBotPin",menuItems:this._getMagicBotPinTopMenuItems(e)},{key:"favoriteSection",menuItems:this._getFavoriteSectionMenuItems(e)},{key:"otherSection",menuItems:this._getOtherSectionMenuItems(e)},{key:"leaveSection",menuItems:(0,t.getLeaveSectionMenuItems)(e)}]}static getMenuItems(e){let s=[];s=[...this._getMagicBotPinTopMenuItems(e),...this._getFavoriteSectionMenuItems(e),...this._getOtherSectionMenuItems(e),...(0,t.getLeaveSectionMenuItems)(e)];return{items:s,destructiveIndex:s.length-1}}static getSwipeActions(e,t,s,n,r){if(t)return{rightActions:[]};{const t=o.default.getS4LUiFeaturesNoSubscription().recentChatsSwipeActionsConfig;return{rightActions:i.compact(i.map(t.right,(t=>(t!==f.Call||!r)&&(!(t===f.Mute&&!r)&&this._commandToAction(t,e,s,n))))),leftActions:t.left?i.compact(i.map(t.left,(t=>this._commandToAction(t,e,s,n)))):void 0,overScrollLeft:t.overScrollLeft,overScrollRight:t.overScrollRight,overScrollDistance:t.overScrollDistance}}}static _commandToAction(e,s,i,o){switch(e){case f.More:return t.ConversationCommands.More;case f.Call:return t.ConversationCommands.AudioCall;case f.MarkRead:return i?t.ConversationCommands.MarkRead:t.ConversationCommands.MarkUnread;case f.Archive:return s?t.ConversationCommands.Unarchive:t.ConversationCommands.Archive;case f.Mute:return o?t.ConversationCommands.Unmute:t.ConversationCommands.Mute}}static conversationSwipeActionForCommand(e,s,i,o,n){let a;const l=c.Color.white;let u,g=c.Color.gray300;switch(e){case t.ConversationCommands.More:a=h.SkypeIcon.More,u=o?void 0:d.getString("Global.MoreButtonTitle"),g=p.isDarkTheme(i)?c.Color.gray400:c.Color.gray300;break;case t.ConversationCommands.Archive:a=h.SkypeIcon.Hide,u=o?void 0:d.getString("Global.HideLabel"),g=c.Color.blueDark;break;case t.ConversationCommands.Unarchive:a=h.SkypeIcon.QuickLook,u=o?void 0:d.getString("Global.UnhideLabel"),g=c.Color.blueDark;break;case t.ConversationCommands.MarkRead:a=h.SkypeIcon.MessageRead,u=o?void 0:d.getString("ConversationsListItem.MarkReadLabelShort"),g=c.Color.blueDark;break;case t.ConversationCommands.MarkUnread:a=h.SkypeIcon.MessageUnread,u=o?void 0:d.getString("ConversationsListItem.MarkUnreadLabelShort"),g=c.Color.blueDark;break;case t.ConversationCommands.Mute:a=h.SkypeIcon.NotificationOff,u=o?void 0:d.getString("ConversationsListItem.MuteLabel"),g=c.Color.blueDark;break;case t.ConversationCommands.Unmute:a=h.SkypeIcon.Notification,u=o?void 0:d.getString("ConversationsListItem.UnmuteLabel"),g=c.Color.blueDark;break;case t.ConversationCommands.Call:case t.ConversationCommands.AudioCall:a=r.isPhoneMri(s)?h.SkypeIcon.SkypeOut:h.SkypeIcon.CallStart,u=o?void 0:d.getString("Hub.NewCallMenuShortLabel"),g=c.Color.blueMedium}if(a)return{command:e,icon:a,iconColor:l,backgroundColor:g,label:u,onComplete:n}}static getAccessibilityLabel(e){let t="";if(e.isFavorite&&(t+=d.getString("ConversationsListItem.FavoriteConversation")),e.isAgent&&(t+=d.getString("ConversationsListItem.BotConversation")+", "),t+=e.conversationDisplayName+", ",e.isOneOnOne){const s=g.accessibilityLabelForUserStatus(e.presence);s&&(t+=s+", "),e.moodAccessibilityLabel&&(t+=e.moodAccessibilityLabel+", "),t+=d.getString("ConversationsListItem.OneonOneConversationLabel")}else t+=d.getString("ConversationsListItem.GroupConversationLabel");return e.hasActiveCall&&e.activeCallStatus!==n.ActiveCallStatus.None?t+=", "+(e.activeCallStatus===n.ActiveCallStatus.OnHold?d.getString("OngoingCall.OngoingCallOnHoldTitle"):d.getString("OngoingCall.OngoingCallTitle")):t+=d.getString("ConversationsListItem.LastMessageLabel",{message:e.lastMessageLabel,time:e.lastMessageTime}),e.isRecipientBlocked&&(t+=d.getString("ConversationsListItem.BlockedContact")),e.hasActiveCall||(e.isMuted?t+=d.getString("ConversationsListItem.MutedConversationLabel"):t+=d.getString("ConversationsListItem.NewMessages",{count:e.displayedUnreadCount||0}),e.isTyping&&(t+=d.getString("ConversationsListItem.ParticipantTyping"))),e.isSelected&&(t+=d.getString("Global.SelectedAccessibilityLabel")),e.addAccessibilityHint&&(t=a.default.applyMoreOptionsAccessibilityHint(t)),t}static rowDecorator(e){if(e.useExtraCompactLayout){if(e.hasActiveCall)return{type:y.Icon,icon:h.SkypeIcon.CallAnimSmall4};if(i.isUndefined(e.userStatus)){if(e.isOneOnOne){if(e.isTeamsUser)return{type:y.Icon,icon:h.SkypeIcon.MSTeams};{const t=e.conversationId?v.optionalMessageTypeIcon(!!e.useExtraCompactLayout,!!e.isEncrypted,!!e.isTranslated,e.conversationId):void 0;return t?{type:y.Icon,icon:t}:{type:y.None}}}return{type:y.Icon,icon:h.SkypeIcon.ContactGroup}}return{type:y.Status}}return{type:y.Avatar}}static optionalMessageTypeIcon(e,t,s,i,o){return o?h.SkypeIcon.Media:t?h.SkypeIcon.Lock:r.isPhoneMri(i)?e?h.SkypeIcon.SkypeOut:h.SkypeIcon.MobileSmsNew:e&&r.isAgent(i)?h.SkypeIcon.Bot:e&&r.isOneOnOneConversation(i)?h.SkypeIcon.Contact:u.default.isTabletNoSubscription()&&s?h.SkypeIcon.SkypeTranslator:void 0}}v._getFavoriteSectionMenuItems=e=>{const s=[];return e.isArchived||(e.isFavorite?s.push({text:d.getString("ConversationsListItem.UnfavoriteLabel"),command:t.ConversationCommands.Unfavorite,icon:l.SXMenuIcon.Favorite}):s.push({text:d.getString("ConversationsListItem.FavoriteLabel"),command:t.ConversationCommands.Favorite,icon:l.SXMenuIcon.Favorite})),s},v._getMagicBotPinTopMenuItems=e=>{const s=[];return e.magicBotEnabled&&(0,m.getMagicBotId)()===e.conversationId&&(e.magicBotUnpin?s.push({text:d.getString("ConversationsListItem.MagicBotPinLabel"),command:t.ConversationCommands.MagicBotPin,icon:l.SXMenuIcon.Pin}):s.push({text:d.getString("ConversationsListItem.MagicBotUnpinLabel"),command:t.ConversationCommands.MagicBotUnpin,icon:l.SXMenuIcon.PinOff})),s},v._getOtherSectionMenuItems=e=>{const s=[];e.isOneOnOne?s.push({text:d.getString("ConversationsListItem.ChatOneOnOneProfileLabel"),command:t.ConversationCommands.Profile,icon:l.SXMenuIcon.Profile}):e.isNewsChannel||s.push({text:d.getString("ConversationsListItem.ChatGroupManageLabel"),command:t.ConversationCommands.ManageGroup,icon:l.SXMenuIcon.Settings}),e.isOneOnOne||!e.isJoinEnabled||e.isNewsChannel||s.push({text:d.getString("ConversationsListItem.CopyLinik"),command:t.ConversationCommands.CopyLink,icon:l.SXMenuIcon.Copy});const i=e.displayedUnreadCount>0&&!e.isArchived;if(!e.isMyBot&&i&&s.push({text:d.getString("ConversationsListItem.MarkReadLabel"),command:t.ConversationCommands.MarkRead,icon:l.SXMenuIcon.ReadMark}),e.isMyBot||i||s.push({text:d.getString("ConversationsListItem.MarkUnreadLabel"),command:t.ConversationCommands.MarkUnread,icon:l.SXMenuIcon.UnreadMark}),e.isArchived){const i=e.isNewsChannel?"ContentChannels.ChannelsSwipeMenuUnhideOption":"ConversationsListItem.UnhideItemLabel";s.push({text:d.getString(i),command:t.ConversationCommands.Unarchive,icon:l.SXMenuIcon.UnhideMark})}else if(!e.hasActiveCall){const i=e.isNewsChannel?"ContentChannels.ChannelsSwipeMenuHideOption":"ConversationsListItem.HideItemLabel";s.push({text:d.getString(i),command:t.ConversationCommands.Archive,icon:l.SXMenuIcon.HideMark})}return e.isMriAnAgent||(e.isOneOnOne?s.push({text:d.getString("InfoPanel.DeleteConversationLabel"),command:t.ConversationCommands.DeleteConversation,icon:l.SXMenuIcon.Delete}):e.isNewsChannel||s.push({text:d.getString("InfoPanel.ClearGroupConversationLabel"),command:t.ConversationCommands.ClearConversation,icon:l.SXMenuIcon.Clear})),e.isOneOnOne&&!e.isMriAContact&&(e.isRecipientBlocked?s.push({text:d.getString("ConversationsListItem.UnblockContact",{displayName:e.conversationShortDisplayName}),command:t.ConversationCommands.Unblock,icon:l.SXMenuIcon.Block}):e.displayBlockButton&&s.push({text:d.getString("ConversationsListItem.BlockContact",{displayName:e.conversationShortDisplayName}),command:t.ConversationCommands.BlockContact,icon:l.SXMenuIcon.Block})),!e.isMriAnAgent||e.isEngagementBot||e.isMyBot||s.push({text:d.getString("ConversationsListItem.DeleteBot",{displayName:e.conversationShortDisplayName}),command:t.ConversationCommands.DeleteBotFromContacts,icon:l.SXMenuIcon.Delete}),e.isOneOnOne&&!e.isNewsBot||(e.isMuted?s.push({text:d.getString("ConversationsListItem.UnmuteLabel"),command:t.ConversationCommands.Unmute,icon:l.SXMenuIcon.Notification}):s.push({text:d.getString("ConversationsListItem.MuteLabel"),command:t.ConversationCommands.Mute,icon:l.SXMenuIcon.NotificationOff})),s},t.default=v;t.getLeaveSectionMenuItems=({isOneOnOne:e,isNewsChannel:s})=>{const i=[];return e||s||i.push({text:d.getString("InfoPanel.LeaveConversationLabel"),command:t.ConversationCommands.LeaveConversation,icon:l.SXMenuIcon.Leave}),s&&i.push(...(0,S.getMenuItems)().items),i}},969716:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasOnlyInlineElements=void 0;const i=s(516778),o=s(934339),n=s(521476),r=s(305406),a=s(452859),l=s(140508),d=s(42847),c=[i.Text,o.AnimatedEmoticon,a.default,l.AttributionNode,d.AttributionsTextNode,n.default,r.HighlightedNode];t.hasOnlyInlineElements=e=>i.Children.toArray(e).every((e=>c.includes(e.type)))},798401:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(516778),r=s(889391),a=s(915877),l=s(733754),d=s(238915),c=s(609748),h=s(90284),u=s(178735),p=s(619675),g=(0,a.lazyProperties)({overflowItem:()=>n.Styles.createViewStyle({width:h.OverflowItemSizeInList,height:h.OverflowItemSizeInList,borderRadius:10,alignItems:"center",justifyContent:"center",marginRight:20}),overflowRoundedItem:()=>n.Styles.createViewStyle({width:h.OverflowItemSizeInGridOrCarousel,height:h.OverflowItemSizeInGridOrCarousel,borderRadius:h.OverflowItemSizeInGridOrCarousel/2,alignItems:"center",justifyContent:"center",marginHorizontal:5}),overflowItemContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),iconText:()=>n.Styles.createTextStyle({lineHeight:16,paddingVertical:10,alignItems:"center",marginHorizontal:1})});const m=new class{overflowItemForDescriptor(e,t,s,o){const r=this.getMediaBarItemProps(t,s,e),a=e.render(r);return(0,i.jsxs)(n.View,Object.assign({style:[g.overflowItemContainer,o]},{children:[a,(0,i.jsx)(p.Caption,Object.assign({style:g.iconText,numberOfLines:1,accessibilityHidden:!0},{children:this.getMediaBarItemTitle(e.id)}))]}),e.id)}isMediaBarItemNew(e){const{mediaBarNewItems:t}=r.default.getS4LMessagingFeaturesNoSubscription();return t.includes(e)&&!u.default.isMediaBarNewItemSeen(e)}setMediaBarItemAsSeen(e){u.default.setMediaBarNewItemSeen(e,!0)}isAnyMediaBarItemNew(e){return e.some((e=>this.isMediaBarItemNew(e.id)))}getMediaBarItemTitle(e){let t;switch(e){case c.MediaBarItemKeys.Bing:t=(0,l.getString)("MediaBar.BingSearchTitle");break;case c.MediaBarItemKeys.MagicBotToolbox:t=(0,l.getString)("MediaBar.MagicBotToolboxTitle");break;case c.MediaBarItemKeys.FilePicker:t=(0,l.getString)("MediaBar.MediaAndFilePickerTitle");break;case c.MediaBarItemKeys.Camera:t=(0,l.getString)("QuickCapturePanel.CameraButtonTitle");break;case c.MediaBarItemKeys.Location:t=(0,l.getString)("MediaBar.LocationTitle");break;case c.MediaBarItemKeys.Contact:t=(0,l.getString)("MediaBar.ContactTitle");break;case c.MediaBarItemKeys.MediaPicker:t=(0,l.getString)("MediaBar.MediaTitle");break;case c.MediaBarItemKeys.ScheduleCall:t=(0,l.getString)("MediaBar.ScheduleCallTitle");break;case c.MediaBarItemKeys.Sms:t=(0,l.getString)("MediaBar.SMSTitle");break;case c.MediaBarItemKeys.People:t=(0,l.getString)("MediaBar.PeopleTitle");break;case c.MediaBarItemKeys.Poll:t=(0,l.getString)("MediaBar.PollTitle");break;case c.MediaBarItemKeys.VideoMessage:t=(0,l.getString)("MediaBar.VideoMessageTitle");break;case c.MediaBarItemKeys.SkypeClipsRecord:t=(0,l.getString)("MediaBar.SkypeClipsRecordTitle");break;case c.MediaBarItemKeys.SendCredit:t=(0,l.getString)("MediaBar.SendCreditTitle");break;case c.MediaBarItemKeys.Audio:t=(0,l.getString)("MessageComposer.RecordButtonTitle")}return t}getMediaBarItemDescription(e){let t;switch(e){case c.MediaBarItemKeys.Location:t=(0,l.getString)("MediaBar.LocationDescription");break;case c.MediaBarItemKeys.MediaPicker:t=(0,l.getString)("MediaBar.MediaDescription");break;case c.MediaBarItemKeys.VideoMessage:t=(0,l.getString)("MediaBar.VideoMessageDescription");break;case c.MediaBarItemKeys.SkypeClipsRecord:t=(0,l.getString)("MediaBar.SkypeClipsRecordDescription");break;case c.MediaBarItemKeys.FilePicker:t=(0,l.getString)("MediaBar.MediaAndFilePickerDescription");break;case c.MediaBarItemKeys.Contact:t=(0,l.getString)("MediaBar.ContactPickerDescription");break;case c.MediaBarItemKeys.Bing:t=(0,l.getString)("MediaBar.BingSearchDescription");break;case c.MediaBarItemKeys.MagicBotToolbox:t=(0,l.getString)("MediaBar.MagicBotToolboxDescription");break;case c.MediaBarItemKeys.Sms:t=(0,l.getString)("MediaBar.SMSDescription");break;case c.MediaBarItemKeys.ScheduleCall:t=(0,l.getString)("MediaBar.ScheduleCallDescription");break;case c.MediaBarItemKeys.Poll:t=(0,l.getString)("MediaBar.PollDescription");break;case c.MediaBarItemKeys.SendCredit:t=(0,l.getString)("MediaBar.SendCreditDescription")}return t}getMediaBarItemProps(e,t,s,i=!0){const n=[i?g.overflowRoundedItem:g.overflowItem,t.buttonBackgroundColorStyle];return o.extend({id:s.id,key:s.id,conversationId:e.conversationId,otherPartyMri:e.otherPartyMri,presentedInOverflowMenu:!0,active:!1,iconStyleOverride:n,isMobileInterface:!0,disabled:s.disabled,onActive:e.onItemSelected,onCustomAction:e.onCustomAction,onFocus:e.onFocus,onBlur:e.onBlur,origin:d.MediaBarItemOrigin.MessageOverflow},s.propOverrides)}};t.default=m},748443:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041),n=s(861253),r=s(710400);let a=class extends o.StoreBase{constructor(){super(),this._keyboardHeight=0,this._offsetTop=0,this._dimensions={width:0,height:0},this._onKeyboardUpdate=()=>{const e=r.default.getUpdateInfo().height;e!==this._keyboardHeight&&(this._keyboardHeight=e,this.trigger())},r.default.subscribe(this._onKeyboardUpdate)}updateTopOffset(e){e!==this._offsetTop&&(this._offsetTop=e,this.trigger())}updateDimensions(e){(0,n.default)(e,this._dimensions)||(this._dimensions=e,this.trigger())}getDraggableArea(){return{x:0,y:this._offsetTop,width:this._dimensions.width,height:this._dimensions.height-this._keyboardHeight}}};i.__decorate([o.autoSubscribe],a.prototype,"getDraggableArea",null),a=i.__decorate([o.AutoSubscribeStore],a),t.default=new a},154663:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesSearchHelper=void 0;const i=s(785893),o=s(496486),n=s(217041),r=s(77340),a=s(595106),l=s(746096),d=s(733754),c=s(170919),h=s(801211),u=s(175150),p=s(204899),g="messagesHeader",m="messagesFooter",S="msg_";class f extends n.ComponentBase{constructor(){super(...arguments),this._onPress=(e,t)=>{this.props.item.onListItemClick&&this.props.item.onListItemClick(e,void 0,l.SearchResultsListGroup.Messages)}}render(){return(0,i.jsx)(a.default,{itemHeight:this.props.item.height-1,searchResult:this.props.result,rawSearchQuery:this.props.rawSearchQuery,isPseudoFocused:this.props.item.isPseudoFocused,onSearchMessagePress:this._onPress})}}const y={footer:m,header:g};class v extends p.SearchSectionHelper{constructor(){super(...arguments),this._renderSearchResultItem=e=>{if(!o.isUndefined(e.item.index)&&this._searchConfig.messages[e.item.index])return(0,i.jsx)(f,Object.assign({result:this._searchConfig.messages[e.item.index]},e))}}static _getKey(e){return S+e.ConversationId+e.MessageId}buildConfig(e,t,s){return{messages:t.searchController.getMessagesResults(),isShowingMore:!!s.isShowingMore[l.SearchResultsListGroup.Messages],contentSizeMultiplier:s.contentSizeMultiplier,limit:e.isCollapsible?this._getMaxItemsInGroup(e):void 0,hideHeader:!!e.hideHeader,hideHeaderCaption:!!e.hideHeader}}getItems(e,t,s,i,o,n=!1){const r={itemHeight:c.SearchItemHeights.messageBaseItemHeight+Math.round(65*this._searchConfig.contentSizeMultiplier),itemTemplate:"content",measureHeightForNonHeaderItems:!0,showSectionEvenIfEmpty:!1,hideHeader:this._searchConfig.hideHeader||this._searchConfig.hideHeaderCaption,hideHeaderTitle:this._searchConfig.hideHeaderCaption,header:d.getString("SearchResultsList.MessagesHeader"),hasHeaderWithButtons:!0},a=p.SearchSectionHelper.generateItemsLists({searchResultsListState:e,searchResultsListProps:t,sourceList:this._searchConfig.messages,getKey:v._getKey,keys:y,renderConfig:r,groupType:l.SearchResultsListGroup.Messages,onFooterPress:o,limit:this._searchConfig.limit,forceInsertFooter:n}),h=a.defaultList;return this._searchConfig.isShowingMore&&h.push(...a.listWithRestOfItems),a.footerItem&&h.push(a.footerItem),h}renderItem(e,t=!1){return e.item.key===g?this._renderHeaderItem(e):e.item.key===m?this._renderFooterItem(e.item,t):e.item.key.substring(0,4)===S?this._renderSearchResultItem(e):void 0}_renderHeaderItem(e){const t=e.item;return(0,i.jsx)(u.default,{sectionTitle:t.hideTitle?void 0:d.getString("SearchResultsList.MessagesHeader"),enableNewSearchHeader:e.customizeExperienceByContactsLevel})}_renderFooterItem(e,t){return t?r.ActivityIndicatorHelper.renderItem(r.ActivityIndicatorHelper.getListItem(e.key)):(0,i.jsx)(h.default,{shouldShowAllResults:this._searchConfig.isShowingMore,groupType:l.SearchResultsListGroup.Messages,onShowMorePress:e.onPress})}}t.MessagesSearchHelper=v},149769:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(66020),r=s(671830),a=s(478262),l=s(172758);t.default=class{static canSendSMSToMri(e){return!(!r.isPhoneMri(e)||r.isBlockedPSTNMri(e))||i.size(l.default.getFullUserProfileByMri(e).phones)>0}static getPhoneNumberToNavigateTo(e,t,s){const i=l.default.getFullUserProfileByMriNoSubscription(e).phones||[];if(r.isPhoneMri(e)||r.getMriNamespace(e)===r.Namespaces.OneToOneTextMessage){const t={number:r.getPhoneNumberFromMri(e)||"",type:a.PhoneNumberTypes.Other};return o.Resolved(t)}return i.length?1===i.length?o.Resolved(i[0]):this.showNumberSelectionPopup(t,s,e,i,!1):o.Resolved(void 0)}static showNumberSelectionPopup(e,t,s,i,r){const a=o.Defer();return n.default.showSendSmsPrompt(e,t,s,i,(e=>{a.resolve(e)}),r),a.promise()}}},403709:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.debugDumpMessagePretty=t.debugDumpMessage=t.cancelPoll=t.editScheduledCall=t.cancelScheduledCall=t.viewLink=t.selectMessages=t.showReportedMessage=t.reportMessage=t.markReadToHere=t.openFileLocation=t.openMediaLocation=t.copyLocationMessage=t.copyLinkMessage=t.copyImage=t.copyMessage=t.translateOneMessage=t.translateMessage=t.bookmarkMessage=t.forwardMessage=t.retryFailedSend=t.cancelFailedSend=t.cancelEditMessage=t.cancelSendMessage=t.removeMessage=t.quoteSelection=t.searchSelection=t.getUrlParams=t.quoteMessage=t.editMessage=t.viewInChat=t.saveMediaAs=t.saveFileAs=t.saveMedia=t.addReaction=void 0;const i=s(496486),o=s(219784),n=s(889391),r=s(265976),a=s(681806),l=s(719061),d=s(587430),c=s(282773),h=s(351077),u=s(671830),p=s(898278),g=s(986374),m=s(746096),S=s(761317),f=s(753559),y=s(319596),v=s(317873),C=s(584876),_=s(436237),b=s(540522),T=s(733754),M=s(518606),I=s(987946),w=s(183503),P=s(764387),k=s(312762),A=s(312762),x=s(795133),R=s(788952),O=s(42036),L=s(812056),F=s(475043),B=s(10909),D=s(178735),E=s(46929),V=s(104735),N=s(827357),U=s(822669),j=s(45151),H=s(459713),z=s(146122),W=s(34273),G=s(829034),K=s(279829),q=s(677914),Q=s(71987),X=s(886045),$=s(933825),J=s(600750),Y=s(640363),Z=s(478262),ee=s(911698),te=s(853374),se=s(379467),ie=s(626712),oe=s(903367),ne=s(711828);t.addReaction=e=>({command:J.CommandTypes.AddReaction,category:m.ItemCommandActionCategory.React,localizationKey:"StreamItem.React",onCommandSelected:()=>{if(v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.AddReaction),e.screenReaderEnabled){new H.default(e.message).showReactionActionSheet(e.getReactionMenuPopupAnchor,e.componentContext.rootViewId)}else{if(!e.getReactionMenuPopupAnchor||!e.getReactionMenuPopupAnchor())return;new z.ReactionsMenuPopup(e.message,void 0,e.getReactionMenuPopupAnchor,e.componentContext.rootViewId,e.componentContext.rootViewType).show()}}});t.saveMedia=e=>{const t=w.getSaveToDirectoryLocalizationKeys(e.message),s=e.message&&e.message.isAlbum();return{command:J.CommandTypes.SaveMedia,category:m.ItemCommandActionCategory.Secondary,localizationKey:t.key,localizationKeyParameters:t.params,icon:t.icon,onCommandSelected:()=>{if(s){M.default.getAllMediaMessagesForAlbum(e.message.getAlbumId()).forEach((t=>{const s=g.decode(t).getFirstUriObjectChild(A.DisplayableMedia);s&&re(s,t,e.componentContext.rootViewId,!0,"")}))}else{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.SaveMedia);const t=e.decodedNode.getFirstUriObjectChild(A.DisplayableMedia);t&&re(t,e.message,e.componentContext.rootViewId,!1)}}}};const re=(e,t,s,i,o)=>{const n=te.default.newCauseId();_.log(m.LogTraceArea.Navigation,"onSaveMedia, causeId: "+n);const r=P.default.getMediaDescriptorForItem(t);let l;switch(r&&r.mediaType){case U.PictureViewer.MediaType:case se.VideoViewer.MediaType:case a.default.MediaType:l=r.downloadFileName;break;default:return}r&&_.track(new I.MediaDownloadTelemetryEvent(t,I.MediaDownloadActionOrigin.StreamItem,I.MediaDownloadReason.SaveToDownloads,f.default.extractFileExtension(l)));const d=e.getNameForDownload()||e.getFullResolutionUrlSanitized();o||(o=D.default.getUserPreferencesLocal().fileDownloadPathDesktop);const c=S.FilePickerUtils.getFileUri(d,o);O.default.downloadToCameraRoll(t,e.getFullResolutionUrlSanitized(),c,n,s,i)};t.saveFileAs=e=>{const t=e.decodedNode.getFirstUriObjectChild(A.UriObjectFileNode);if(t)return{command:J.CommandTypes.SaveAsFile,category:m.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.ActionSaveAs",icon:p.SXMenuIcon.Save,onCommandSelected:()=>{const s=te.default.newCauseId();_.log(m.LogTraceArea.Navigation,"onSaveAs, causeId: "+s),v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.SaveAsFile);const i=t.getFileContentUrlSanitized(),o=t.getNameForDownload();if(i&&o){const t=r.getDocumentId(i);if(t){const i=r.getDisplayUrl(t,Z.UploadFileType.File);O.default.desktopSaveAs(t,o,i,s,e.message,e.componentContext.rootViewId,e.getRootWindowComponent)}}}}};t.saveMediaAs=e=>{const t=e.message&&e.message.isAlbum();return{command:J.CommandTypes.SaveAsMedia,category:m.ItemCommandActionCategory.Secondary,localizationKey:t?"StreamItem.ActionSaveAll":"StreamItem.ActionSaveAs",icon:p.SXMenuIcon.Save,onCommandSelected:()=>{const s=te.default.newCauseId();if(_.log(m.LogTraceArea.Navigation,"onSaveMediaAs, causeId: "+s),v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.SaveAsMedia),t)S.FilePickerUtils.showOpenDialog({properties:["openDirectory"]},(t=>{M.default.getAllMediaMessagesForAlbum(e.message.getAlbumId()).forEach((s=>{const i=g.decode(s).getFirstUriObjectChild(A.DisplayableMedia);i&&re(i,s,e.componentContext.rootViewId,!0,t.path)}))}));else{let t,i;const o=P.default.getMediaDescriptorForItem(e.message);switch(o&&o.mediaType){case U.PictureViewer.MediaType:t=o.downloadFileName,i=o.fullResolutionUrl;break;case se.VideoViewer.MediaType:t=o.downloadFileName,i=o.videoUrl;break;case a.default.MediaType:t=o.downloadFileName,i=o.audioUrl;break;default:return}t&&i&&(o&&_.track(new I.MediaDownloadTelemetryEvent(e.message,I.MediaDownloadActionOrigin.StreamItem,I.MediaDownloadReason.SaveAs,f.default.extractFileExtension(t))),O.default.desktopSaveAs(r.getFileCacheKeyMedia(e.message,!0),t,i,s,e.message,e.componentContext.rootViewId,e.getRootWindowComponent))}}}};t.viewInChat=e=>({command:J.CommandTypes.ViewInChat,category:m.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ViewInChat",onCommandSelected:()=>{const t=te.default.newCauseId();_.log(m.LogTraceArea.Navigation,"StreamItemCommands.viewInChat, causeId: "+t),v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.ViewInChat),V.default.navigateToConversation({convId:e.message.conversationId,causeId:t,focusedMessageCuid:e.message.cuid,scrollToTimestamp:Number(e.message.createdTime),origin:m.NavigationConversationOrigin.Gallery})}});t.editMessage=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription();return{command:J.CommandTypes.Edit,category:m.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ActionEdit",icon:t?ne.SkypeIcon.Topic:p.SXMenuIcon.Edit,onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.Edit),e.onEditCallback&&e.onEditCallback(e.message)}}};t.quoteMessage=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription(),{pasteAsQuotesEnabled:s}=D.default.getUserPreferencesLocalNoSubscription(),i=t?ne.SkypeIcon.Reply:p.SXMenuIcon.Reply;return{command:J.CommandTypes.Quote,category:m.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ActionReply",icon:i,isVisible:()=>!(s&&ae(e)),onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.Quote),e.onQuoteCallback&&e.onQuoteCallback([e.message],ee.QuotesTriggerType.ActionMenu)}}};t.getUrlParams=(e,t)=>{const s=n.default.getS4LMessagingFeaturesNoSubscription().bingSearch,i=encodeURIComponent(e);let o=`${s.host}${i}`;ie.default.isUrlValid(o)&&(o=ie.default.addUrlParameter(o,"form",oe.FormCode.FORM_CODE_SEARCH_IN_CONVERSATION),o=ie.default.addUrlParameter(o,"PC",(0,oe.getPartnerCode)()));const r={browserTitle:T.getString("MessageStream.BingSearchSidebarTitle",e?{selectedText:`'${e}'`}:void 0),preventInAppNavigationForGuest:!l.default.canNavigateInApp(),conversationId:t.contextConversationId,openInExternalBrowser:!s.tryOpenInAppBrowser,useBingMiniCanvas:!0};return{origin:m.BrowserOrigin.LinkNode,url:o,rootViewId:t.componentContext.rootViewId,options:r}};t.searchSelection=e=>{const s=$.getSelectedText(),o=(0,i.truncate)(s,{length:20,omission:T.getString("Global.TruncationText")}),r=n.default.getS4LMessagingFeaturesNoSubscription().bingSearchMessageHint.enabled;return{command:J.CommandTypes.SearchSelection,category:m.ItemCommandActionCategory.Main,localizationKey:"StreamItem.SearchSelection",localizationKeyParameters:o?{selectedText:`'${o}'`}:void 0,icon:p.SXMenuIcon.SearchSelection,isVisible:()=>ae(e),onCommandSelected:i=>{const o=e.message;let n;if(r){x.default.hintShownAndUsed();const e=E.default.getMessageHintsUserData(R.MessageHintsTypes.HighlightToBingSearch);o.cuid!==(null==e?void 0:e.hintMessageId)||e.wasFeatureUsedByUser||(n=!0);const t=C.default.getDefaultMessageHintObject();t.wasFeatureUsedByUser=!0,E.default.setMessagesHintData(R.MessageHintsTypes.HighlightToBingSearch,t)}_.track(new L.MessageActionTelemetry(o.conversationId,o,o.createdTime,i||L.MessageActionOrigin.StreamItemDesktopContextMenu,L.MessageActionType.SearchSelection,void 0,n));const a=(0,t.getUrlParams)(s,e);b.openUrlWithParams(a)}}};t.quoteSelection=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription(),s=t?ne.SkypeIcon.Reply:p.SXMenuIcon.Reply;return{command:J.CommandTypes.QuoteSelection,category:m.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ActionReplyToSelection",icon:s,isVisible:()=>ae(e),onCommandSelected:()=>{if(v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.QuoteSelection),e.onQuoteSelection)e.onQuoteSelection();else if(e.onQuoteCallback&&($.isTextSelected()||e.selectedText)){const t=e.message.applyMessageForPostingLie($.getNewMessageFromSelection(e.message.conversationId,e.selectedText).messageForPosting);e.onQuoteCallback([t],ee.QuotesTriggerType.Selection)}}}};const ae=e=>$.isTextSelected()||!!e.selectedText;t.removeMessage=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription(),s=e.message&&e.message.messagetype===h.MessageTypes.MediaAlbum?"StreamItem.ActionRemoveAll":"StreamItem.ActionRemove";return{command:J.CommandTypes.Remove,category:m.ItemCommandActionCategory.Destructive,localizationKey:s,icon:t?ne.SkypeIcon.Delete:p.SXMenuIcon.Dismiss,onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.Remove),O.default.deleteMessage(e.message,e.componentContext.rootViewId,void 0,(()=>{X.default.maybeAnnounceForAccessibility(T.getString("Global.RemoveMessageConfirmation"))}))}}};t.cancelSendMessage=e=>({command:J.CommandTypes.CancelSend,category:m.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.ActionRemove",onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.CancelSend),O.default.cancelMessageSend(e.message,e.componentContext.rootViewId)}});t.cancelEditMessage=e=>({command:J.CommandTypes.CancelEdit,category:m.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.ActionCancelEdit",onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.CancelEdit),O.default.cancelFailedSend(e.message)}});t.cancelFailedSend=e=>({command:J.CommandTypes.CancelFailedSend,category:m.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.ActionRemove",onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.CancelFailedSend),O.default.cancelFailedSend(e.message)}});t.retryFailedSend=e=>({command:J.CommandTypes.RetryFailedSend,category:m.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ActionRetry",onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.RetryFailedSend),O.default.retryFailedSend(e.message)}});t.forwardMessage=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription(),s=e.message&&e.message.messagetype===h.MessageTypes.MediaAlbum?"StreamItem.ActionForwardAll":"StreamItem.ActionForward";return{command:J.CommandTypes.Forward,category:m.ItemCommandActionCategory.Main,localizationKey:s,icon:t?ne.SkypeIcon.ForwardItem:p.SXMenuIcon.Forward,isVisible:()=>l.default.canForwardMessage()&&!e.message.isMessageInEncryptedThread(),onCommandSelected:t=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.Forward);let s=e.message;const i=s.isAlbum()?te.default.newGuid():void 0;if(s.isBookmark()){const e=s.getBookmarkMetadata();if(e){const t=s.getMutableClone();t.creator=e.bookmarkSourceCreatorId||s.creator,t.createdTime=e.bookmarkSourceComposeTime||s.createdTime,s=t}}const o=[{message:s,node:e.decodedNode,forwardAlbumId:i}];if(s.isAlbum()){M.default.getAllMediaMessagesForAlbum(s.getAlbumId()).forEach((e=>{o.push({message:e,node:g.decode(e),forwardAlbumId:i})}))}const n=s.isBookmark()?L.MessageActionOrigin.BookmarksViewer:t||L.MessageActionOrigin.StreamItem;y.forwardMessages(o,n,e.contextConversationId,void 0,e.componentContext,e.onExternalShare)}}};t.bookmarkMessage=e=>{if(!e.message)return;const t=e.message.isBookmark(),s=e.message.isBookmarkSourceForCurrentUser(),i=t||s?"StreamItem.RemoveBookmark":"StreamItem.AddBookmark",o=N.default.isDesktopSplitNavStackCollapsedNoSubscription(),{enableReactionsInBottomSheet:r}=n.default.getS4LMessagingFeaturesNoSubscription();return{command:J.CommandTypes.Bookmark,category:m.ItemCommandActionCategory.Secondary,localizationKey:i,icon:r?ne.SkypeIcon.Bookmark:p.SXMenuIcon.Bookmark,isVisible:()=>l.default.canBookmarkMessage()&&!e.message.isEphemeral()&&!e.message.isMessageInEncryptedThread()&&!e.message.isMessageInS4BBridgeConversation()&&!e.message.isEmote(),onCommandSelected:i=>{let n;e.message.isAlbum()&&(n=te.default.newGuid());const r=[{message:e.message,node:e.decodedNode,forwardAlbumId:n}];if(e.message.isAlbum()){M.default.getAllMediaMessagesForAlbum(e.message.getAlbumId()).forEach((e=>{r.push({message:e,node:g.decode(e),forwardAlbumId:n})}))}const a=t?L.MessageActionOrigin.BookmarksViewer:i||L.MessageActionOrigin.StreamItem,l=s||t?void 0:t=>{c.default.setBookmarkAdded();const s=T.getString("BookmarksTooltips.BookmarkAddedToastText"),i=`${s} ${T.getString("BookmarksTooltips.BookmarkAddedToastLabel")}`;o?B.default.scheduleMessage({key:"bookmarkAdded",textMessage:s,actionLabel:T.getString("BookmarksTooltips.BookmarkAddedToastLabel"),accessibilityLabel:i,onPress:()=>V.default.navigateToConversation({convId:u.BookmarksThreadId,causeId:te.default.newCauseId(),origin:m.NavigationConversationOrigin.InAppNotification}),rootViewId:e.componentContext.rootViewId}):X.default.maybeAnnounceForAccessibility(i)};d.bookmarkMessageAction(r,a,l)}}};t.translateMessage=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription();return{command:J.CommandTypes.Translate,category:m.ItemCommandActionCategory.Secondary,localizationKey:e.showTranslatedMessage?"Translator.MessageShowOriginal":"Translator.MessageShowTranslation",isVisible:()=>!!e.isConversationTranslated,icon:t?ne.SkypeIcon.SkypeTranslatorNew:p.SXMenuIcon.TranslatorNew,onCommandSelected:()=>{var t;null===(t=e.onTranslateCallback)||void 0===t||t.call(e)}}};t.translateOneMessage=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription(),{enableOneMessageTranslation:s}=n.default.getS4LCMCFeaturesNoSubscription();return{command:J.CommandTypes.TranslateOne,category:m.ItemCommandActionCategory.Secondary,localizationKey:e.showTranslatedMessage?"Translator.MessageShowOriginal":"StreamItem.ActionTranslate",isVisible:()=>s&&!e.isConversationTranslated,icon:t?ne.SkypeIcon.SkypeTranslatorNew:p.SXMenuIcon.TranslatorNew,onCommandSelected:()=>{var t;null===(t=e.onTranslateOneCallback)||void 0===t||t.call(e)}}};function le(e,t,s,i){t&&e.onCopy?e.onCopy():O.default.copyMessage(s||e.message,i||e.decodedNode,e.componentContext.rootViewId,e.selectedText)}t.copyMessage=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription();return{command:J.CommandTypes.Copy,category:m.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.ActionCopy",icon:t?ne.SkypeIcon.Copy:p.SXMenuIcon.Copy,onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.Copy);const t=$.isTextSelected()||!!e.selectedText;if(e.hasTranslation&&e.showTranslatedMessage){const s=F.default.getTranslatedMessage(e.message.conversationId,e.message.cuid);s&&le(e,t,s,g.decode(s))}else le(e,t)}}};t.copyImage=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription();return{command:J.CommandTypes.CopyImage,category:m.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.ActionCopy",icon:t?ne.SkypeIcon.Copy:p.SXMenuIcon.Copy,onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.CopyImage);const t=g.decode(e.message).getFirstUriObjectChild(k.PictureNode);_.track(new I.MediaDownloadTelemetryEvent(e.message,I.MediaDownloadActionOrigin.StreamItem,I.MediaDownloadReason.Copy,t?f.default.extractFileExtension(t.getNameForUI()):void 0)),O.default.copyImageFromMessage(e.message)}}};t.copyLinkMessage=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription();return{command:J.CommandTypes.CopyLink,category:m.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.ActionCopyLink",icon:t?ne.SkypeIcon.Copy:p.SXMenuIcon.CopyLink,onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.CopyLink),O.default.copyLinkMessage(e.url,e.message)}}};t.copyLocationMessage=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription();return{command:J.CommandTypes.CopyLocation,category:m.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.ActionCopy",icon:t?ne.SkypeIcon.Copy:p.SXMenuIcon.Copy,onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.CopyLocation),O.default.copyLocationMessage(e.message,e.decodedNode)}}};t.openMediaLocation=e=>({command:J.CommandTypes.OpenMediaLocation,category:m.ItemCommandActionCategory.Secondary,localizationKey:Y.default.getPlatformType()===m.PlatformType.OSX?"StreamItem.ActionOpenFileLocationMac":"StreamItem.ActionOpenFileLocation",icon:Y.default.getPlatformType()===m.PlatformType.OSX?p.SXMenuIcon.OpenFolder:p.SXMenuIcon.Open,onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.OpenMediaLocation),O.default.openMediaLocationOnDesktop(e.message)}});t.openFileLocation=e=>({command:J.CommandTypes.OpenFileLocation,category:m.ItemCommandActionCategory.Secondary,localizationKey:Y.default.getPlatformType()===m.PlatformType.OSX?"StreamItem.ActionOpenFileLocationMac":"StreamItem.ActionOpenFileLocation",icon:Y.default.getPlatformType()===m.PlatformType.OSX?p.SXMenuIcon.OpenFolder:p.SXMenuIcon.Open,onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.OpenFileLocation),O.default.openFileLocationOnDesktop(e.decodedNode)}});t.markReadToHere=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription();return{command:J.CommandTypes.MarkReadToHere,category:m.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ActionUnreadFromHere",icon:t?ne.SkypeIcon.UnreadMark:p.SXMenuIcon.UnreadMark,onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.MarkReadToHere),O.default.markMessageUnread(e.message,e.onMarkAsUnread)}}};t.reportMessage=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription();return{command:J.CommandTypes.Report,category:m.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.ActionReportMessage",icon:t?ne.SkypeIcon.Warning:p.SXMenuIcon.Warning,onCommandSelected:()=>{v.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,J.CommandTypes.Report);const t={mriToBlock:e.message.creator,rootViewId:e.componentContext.rootViewId,content:e.message};V.default.navigateToReportConcernModal(t)}}};t.showReportedMessage=e=>({command:J.CommandTypes.ShowReported,category:m.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ActionShowReportedMessage",onCommandSelected:()=>{O.default.showReportedMessage(e.message)}});t.selectMessages=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription();return{command:J.CommandTypes.SelectMessages,category:m.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.SelectMessages",icon:t?ne.SkypeIcon.CheckmarkCircle:p.SXMenuIcon.Checkmark,onCommandSelected:()=>{e.onSelectMessagesCommandCallback&&e.onSelectMessagesCommandCallback(e.contextConversationId)}}};t.viewLink=e=>({command:J.CommandTypes.ViewLink,category:m.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.ViewLink",onCommandSelected:()=>{O.default.viewLink(e.displayUrl,e.componentContext.rootViewId)}});t.cancelScheduledCall=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription();return{command:J.CommandTypes.CancelScheduledCall,category:m.ItemCommandActionCategory.Destructive,localizationKey:"ScheduledCallCard.DeleteScheduledCallOverflowItem",icon:t?ne.SkypeIcon.Delete:p.SXMenuIcon.Dismiss,onCommandSelected:()=>{const t=e.decodedNode.getFirstUriObjectChild(A.ScheduledCallInviteNode);if(!t)return void _.error(m.LogTraceArea.ScheduleCall,"Canceling a ScheduledCall message but no Scheduled Call node was found");const s=T.getString("ScheduleCall.DeleteDialogTitle"),i=Q.default.getLocalizedDeleteDialogMessage(t.subject),n=[{text:T.getString("Global.CancelLabel"),isCancel:!0},{text:T.getString("Global.DeleteLabel"),isSubmit:!0,onPress:()=>{q.default.cancelScheduledCall(t.scheduledCallId),_.track(new G.ScheduledCallCancelEvent(K.ScheduleCallCancelEventEntryPoint.MessageStream,t.conversationId)),X.default.maybeAnnounceForAccessibility(T.getString("ScheduleCall.DeletedAnnoucement",{title:t.subject+""}))},style:"destructive"}];o.default.showWithOptions({title:s,message:i,buttons:n,dialogAccessibilityTitle:i,rootViewId:e.componentContext.rootViewId})}}};t.editScheduledCall=e=>{const{enableReactionsInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription();return{command:J.CommandTypes.EditScheduledCall,category:m.ItemCommandActionCategory.Main,localizationKey:"ScheduledCallCard.ViewDetailsOverflowItem",icon:t?ne.SkypeIcon.Calendar:p.SXMenuIcon.Calendar,onCommandSelected:()=>{const t=te.default.newCauseId();_.log(m.LogTraceArea.ScheduleCall,"StreamItemCommands.editScheduledCall causeId: "+t);const s=e.decodedNode.getFirstUriObjectChild(A.ScheduledCallInviteNode);if(!s)return void _.error(m.LogTraceArea.ScheduleCall,"Editing a ScheduledCall message but no Scheduled Call node was found");const i=q.default.getScheduledCallById(s.scheduledCallId);i&&W.default.NavigationActions.navigateToScheduledOverviewPanel({entryPoint:K.ScheduleCallEntryPoint.MessageStream,scheduledCallId:i.id},e.componentContext.rootViewId)}}};t.cancelPoll=e=>{const t={title:T.getString("Poll.DeleteDialogTitle"),body:T.getString("Poll.DeleteDialogMessage")};return{command:J.CommandTypes.CancelPoll,category:m.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.ActionRemove",icon:p.SXMenuIcon.Dismiss,onCommandSelected:()=>{O.default.deleteMessage(e.message,e.componentContext.rootViewId,t,(()=>{e.decodedNode.getFirstUriObjectChild(A.PollNode)?(j.default.cancelPoll(e.message.cuid),X.default.maybeAnnounceForAccessibility(T.getString("Poll.DeleteConfirmation"))):_.error(m.LogTraceArea.PollStore,"Removing a Poll message but no Poll node was found")}))}}};t.debugDumpMessage=e=>({command:J.CommandTypes.DebugDumpMessage,category:m.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.DumpMessage",onCommandSelected:()=>{O.default.dumpMessage(e.message,!1)}});t.debugDumpMessagePretty=e=>({command:J.CommandTypes.DebugDumpMessagePretty,category:m.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.DumpMessagePretty",onCommandSelected:()=>{O.default.dumpMessage(e.message,!0)}})},867241:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemListKey=void 0,t.ItemListKey={ReadOnlyChatHeader:"readOnlyChatHeader",ContactInviteHeaderItem:"contactInviteHeaderItem",ContactInviteHeaderSpacer:"contactInviteHeaderSpacer",Composing:"composing",UnreadMarker:"unread",DateMarkerPrefix:"d_",MessagePrefix:"m_",ReadReceiptPrefix:"readReceipt",InviteMorePeople:"inviteMorePeople",NewConnection:"newConnection",SpeechConsent:"speechConsent",OldFriendBack:"oldFriendBack"}},225638:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(63060),o=s(626712);class n extends i.default{constructor(e){super(),this._components=o.default.getURIComponents(e)}isImmutable(){return!0}getDocumentId(){if(this._components&&this._components.pathname){const e=this._components.pathname.match(n.AmsObjectIdRegex);if(e)return e[1]}}getViewId(){if(this._components&&this._components.pathname){const e=this._components.pathname.match(n.AmsViewIdRegex);if(e)return e[1]}}}n.AmsObjectIdRegex=/objects\/([^/]*)\//,n.AmsViewIdRegex=/views\/([^/]*)/,t.default=n},82927:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(265976),n=s(671830),r=s(10102),a=s(867213),l=s(733754),d=s(18078),c=s(478262),h=s(151038);class u extends a.default{constructor(e,t){super(),this._conversationId=e,this._conversation=t,this._displayName=this._calcDisplayName(),this._conversationMemberShortNames={}}isImmutable(){return!1}updateConversationAndCheckIfChanged(e){const t=this._displayName,s=this.getAvatarUrl(),o=this.getColor();this._conversation=e,this._displayName=this._calcDisplayName();let n=t!==this._displayName;n||(n=i.some(this._conversationMemberShortNames,((e,t)=>e!==this._getAndUpdateMemberShortName(t))));s!==this.getAvatarUrl()&&(n=!0);return o!==this.getColor()&&(n=!0),n}getDisplayName(e,t){return this._displayName||super.getDisplayName(e||l.getString("Notifications.UnknownGroupConversation"),t)}getUniqueId(){return this.getMri()}getMri(){return this._conversationId}_getFirstName(){}_getLastName(){}getMemberShortName(e){return this._conversationMemberShortNames[e]||this._getAndUpdateMemberShortName(e)}_getAndUpdateMemberShortName(e){let t;const s=h.getDisplayableProfile(e);if(this._conversation&&n.isThread(this._conversationId)){let o=s.getShortName(),n=!1;o&&(o=o.trim().toLowerCase(),n=!i.some(this._conversation.getThreadMembers(),(t=>{if(t.id===e)return!1;const s=h.getDisplayableProfile(t.id).getShortName();return s&&o===s.trim().toLowerCase()}))),t=n?s.getShortName():s.getDisplayName()}else t=s.getShortName();return this._conversationMemberShortNames[e]=t,t}getAvatarUrl(){let e=this._conversation&&this._conversation.isThread()?this._conversation.getThreadProperty(n.ThreadProps.Picture):void 0;if(e&&0===e.indexOf("URL@")){e=e.substring(4);const t=c.MediaViewSize.Thumbnail,s=o.getDocumentId(e);return s&&o.getDisplayUrl(s,c.UploadFileType.GroupAvatar,t)}if(!e||0!==e.indexOf("P2P@"))return e}getColor(){return this._conversation?this._conversation.color():r.getDefaultColorInfo(this._conversationId)}_calcDisplayName(){if(!this._conversation)return;const e=this._conversation.topicName();if(e){const t=this._conversation.getThreadMembers(),s=i.compact(i.map(t,(e=>n.getSkypeIdFromMri(e.id))));s.push("...");const o=e.split(", ");return i.intersection(s,o).length===o.length?this._generateTitleName():n.unescapeTextWithoutXml(e)}return this._generateTitleName()}_generateTitleName(){if(!this._conversation)return;const e=this._conversation.getThreadMembers(),t=i.filter(e,(e=>!d.default.isMyMri(e.id)));let s;if(0!==t.length){s=i.map(t.length<=3?t:t.slice(0,2),(e=>h.getDisplayableProfile(e.id).getDisplayName())).join(", "),t.length>3&&(s+=", "+l.getString("DisplayInfoStore.ListOtherNames",{count:t.length-2}))}return 1===e.length&&(s=l.getString("Global.UntitledChat")),s}}t.default=u},185455:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MaximumGroupConversationNameLength=t.ConversationHistoryTimeSpanImportant=void 0;const i=s(889391),o=s(63060),n=s(496856);t.ConversationHistoryTimeSpanImportant=2592e6,t.MaximumGroupConversationNameLength=50;class r extends o.default{constructor(e,t,s,i){super(),e?(this.conv=n.default.fromDatabaseObject(e.conv),this.syncInfo=e.syncInfo,this.counts=e.counts,this._needsSync=e._needsSync,this._isHighlight=e._isHighlight,this._forceToRecents=e._forceToRecents):(this.conv=t,this.syncInfo=s,this.counts=i,this._needsSync=this.needsSyncMessages()||this.needsSyncThreadDetails()||this.conv.hasPendingLies()?1:0,this._isHighlight=this.conv.isHighlightsThread()?1:0,this._forceToRecents=i&&i.unreadCount>0||this.conv.isFavorite()?1:0)}isImmutable(){return!0}static fromDatabaseObject(e){return e?new r(e):void 0}static newFakeEmptyMeta(e,t=void 0){const s=this.newEmptySyncInfo(),i=n.default.newFakeEmptyConversation(e,t);return new r(void 0,i,s,void 0)}static newEmptySyncInfo(){return{messagesStale:!1,messagesSyncState:void 0,messageHistoryStartTime:Number.MAX_VALUE}}static firstTimeMeta(e,t,s){return new r(void 0,e,t,s)}updateConversation(e){return e===this.conv?this:new r(void 0,e,this.syncInfo,this.counts)}updateSyncInfo(e){return e===this.syncInfo?this:new r(void 0,this.conv,e,this.counts)}updateConversationAndSyncInfo(e,t){return e===this.conv&&t===this.syncInfo?this:new r(void 0,e,t,this.counts)}updateCounts(e){return e===this.counts?this:new r(void 0,this.conv,this.syncInfo,e)}updateEverything(e,t,s){return e===this.conv&&t===this.syncInfo&&s===this.counts?this:new r(void 0,e,t,s)}needsSyncMessages(){return!this.conv.isBricked&&this.syncInfo.messagesStale&&this.conv.isCurrentUserMember()&&this.conv.isSyncEnabled(i.default.getS4LMessagingFeaturesNoSubscription().syncSettings)}needsSyncThreadDetails(){return!(this.conv.isBricked||!this.conv.isSyncEnabled(i.default.getS4LMessagingFeaturesNoSubscription().syncSettings)||this.conv.isReactionsThread()||!this.conv.isCurrentUserMember())&&(!!this.conv.needsForceSyncThreadDetails()||!this.conv.hasApplicableMembersData())}}t.default=r},498317:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},788952:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageViewItemInfo=t.MessageHintsTypes=void 0,function(e){e[e.DoubleTapMessageToLike=1]="DoubleTapMessageToLike",e[e.TapOnReactionToReactTheSame=2]="TapOnReactionToReactTheSame",e[e.HighlightToBingSearch=3]="HighlightToBingSearch"}(t.MessageHintsTypes||(t.MessageHintsTypes={}));t.MessageViewItemInfo=class{constructor(e,t,s,i){this.key=e,this.skypeMessage=t,this.shouldItemFocusOnMobile=s,this.height=i,this.focusable=!0}}},758962:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cultureInfo=t.generateAssetKey=t.rewriteUrl=t.tabTypeToMediaBarCustomAction=t.mediaTypesToTabType=t.mediaTypes=t.frameHeights=t.getFrameHeight=t.getPixelSize=t.getEmoticonSizes=t.EmoticonUrl=t.PesPickerTriggeredBy=t.SearchableTabType=t.TabType=t.ModelDataState=t.PesPickerRenderPosition=t.PesItemTypes=t.AssetState=t.AssetDownloadStatus=void 0;const i=s(496486),o=s(516778),n=s(526424),r=s(478262);var a;!function(e){e[e.NONE=0]="NONE",e[e.DOWNLOADING=1]="DOWNLOADING",e[e.ERROR=2]="ERROR",e[e.SUCCESS=3]="SUCCESS",e[e.EXPIRED=4]="EXPIRED"}(t.AssetDownloadStatus||(t.AssetDownloadStatus={}));t.AssetState=class{constructor(e,t,s,i){this.status=e,this.name=t,this.url=s,this.localUri=i}},function(e){e[e.MODELZIP=0]="MODELZIP",e[e.IMAGEFILE=1]="IMAGEFILE",e[e.MODELBIN=2]="MODELBIN"}(t.PesItemTypes||(t.PesItemTypes={})),function(e){e[e.BOTTOM=0]="BOTTOM",e[e.TOP=1]="TOP"}(t.PesPickerRenderPosition||(t.PesPickerRenderPosition={}));t.ModelDataState=class{constructor(e,t,s,i,o,n,r){this.id=e,this.type=t,this.status=s,this.key=i,this.localUri=o,this.unzippedLocalUri=n,this.fileName=r}},function(e){e[e.Emoticon=0]="Emoticon",e[e.Moji=1]="Moji",e[e.CaptureSticker=2]="CaptureSticker",e[e.ChatSticker=3]="ChatSticker",e[e.Effect=4]="Effect",e[e.Gif=5]="Gif",e[e.PickerPopup=6]="PickerPopup",e[e.MeetNow=7]="MeetNow",e[e.ImageUploader=8]="ImageUploader"}(a=t.TabType||(t.TabType={})),function(e){e[e.Emoticon=0]="Emoticon",e[e.Moji=1]="Moji",e[e.CaptureSticker=2]="CaptureSticker",e[e.ChatSticker=3]="ChatSticker",e[e.Gif=4]="Gif",e[e.PickerPopup=5]="PickerPopup"}(t.SearchableTabType||(t.SearchableTabType={})),function(e){e[e.ContextMenu=1]="ContextMenu",e[e.LongPress=2]="LongPress",e[e.MeetNowLobby=3]="MeetNowLobby",e[e.GroupProfileHeader=4]="GroupProfileHeader"}(t.PesPickerTriggeredBy||(t.PesPickerTriggeredBy={}));const l=i.once((()=>({width:window.screen&&window.screen.width||0,height:window.screen&&window.screen.height||0,isHighDensity:o.UserInterface.isHighPixelDensityScreen()})));t.EmoticonUrl={profilePrefix:"default_",animSuffix:"_anim",flatSuffix:"_f",diverseSuffix:"_s"};const d={[n.EmoticonSize.ExtraSmall]:40,[n.EmoticonSize.Small]:40,[n.EmoticonSize.Medium]:60,[n.EmoticonSize.Large]:80,[n.EmoticonSize.ExtraLarge]:160,[n.EmoticonSize.ExtraExtraLarge]:240},c={[n.EmoticonSize.ExtraSmall]:20,[n.EmoticonSize.Small]:20,[n.EmoticonSize.Medium]:40,[n.EmoticonSize.Large]:40,[n.EmoticonSize.ExtraLarge]:80,[n.EmoticonSize.ExtraExtraLarge]:120};t.getEmoticonSizes=function(){return i.uniq(i.values(l().isHighDensity?d:c))},t.getPixelSize=function(e){return l().isHighDensity?d[e]:c[e]},t.getFrameHeight=function(e){switch(e){case n.EmoticonSize.ExtraSmall:return t.frameHeights.emoticons.Size16;case n.EmoticonSize.Small:return t.frameHeights.emoticons.SMALL;case n.EmoticonSize.Medium:return t.frameHeights.emoticons.Size32;case n.EmoticonSize.Large:return t.frameHeights.emoticons.Size40;case n.EmoticonSize.ExtraLarge:return t.frameHeights.emoticons.Size80;case n.EmoticonSize.ExtraExtraLarge:return t.frameHeights.emoticons.Size120;default:return t.frameHeights.emoticons.Size40}},t.frameHeights={emoticons:{SMALL:20,Size16:16,Size32:32,Size40:40,Size80:80,Size120:120},moji:{Size40:40,Size70:70,Size80:80,Size108:108,Size200:200,Size232:232},stickers:{Size50:50,Size80:80,Size90:90,Size112:112,Size75:175},gifs:{Size90:90}},t.mediaTypes={emoticon:"emoticon",moji:"flik",sticker:"sticker",gif:"gif"},t.mediaTypesToTabType={[t.mediaTypes.emoticon]:a.Emoticon,[t.mediaTypes.moji]:a.Moji,[t.mediaTypes.sticker]:a.CaptureSticker,[t.mediaTypes.gif]:a.Gif},t.tabTypeToMediaBarCustomAction={[a.Emoticon]:r.MediaBarCustomAction.LaunchEmoticon,[a.Moji]:r.MediaBarCustomAction.LaunchMoji,[a.ChatSticker]:r.MediaBarCustomAction.LaunchSticker,[a.Gif]:r.MediaBarCustomAction.LaunchGif},t.rewriteUrl=function(e,t){let s=e;return i.some(t,(e=>-1!==s.search(e.from)&&(s=s.replace(e.from,e.to),!0))),s},t.generateAssetKey=function(e,t,s,i){return`${e}_${t}_${s}_${i||"NA"}`};t.cultureInfo=new class{constructor(){this.mappings=[{language:"am",defaultLocale:"am-et"},{language:"ar",defaultLocale:"ar-sa"},{language:"bg",defaultLocale:"bg-bg"},{language:"bn",defaultLocale:"bn-in"},{language:"ca",defaultLocale:"ca-es"},{language:"cs",defaultLocale:"cs-cz"},{language:"cy",defaultLocale:"cy-gb"},{language:"da",defaultLocale:"da-dk"},{language:"de",defaultLocale:"de-de"},{language:"el",defaultLocale:"el-gr"},{language:"en",defaultLocale:"en-us"},{language:"es",defaultLocale:"es-es"},{language:"et",defaultLocale:"et-ee"},{language:"eu",defaultLocale:"eu-es"},{language:"fa",defaultLocale:"fa-ir"},{language:"fi",defaultLocale:"fi-fl"},{language:"fil",defaultLocale:"fil-ph"},{language:"fr",defaultLocale:"fr-fr"},{language:"gl",defaultLocale:"gl-es"},{language:"gu",defaultLocale:"gu-in"},{language:"he",defaultLocale:"he-il"},{language:"hi",defaultLocale:"hi-in"},{language:"hr",defaultLocale:"hr-hr"},{language:"hu",defaultLocale:"hu-hu"},{language:"id",defaultLocale:"id-id"},{language:"is",defaultLocale:"is-is"},{language:"it",defaultLocale:"it-it"},{language:"ja",defaultLocale:"ja-jp"},{language:"kk",defaultLocale:"kk-kz"},{language:"kn",defaultLocale:"kn-in"},{language:"ko",defaultLocale:"ko-kr"},{language:"ku",defaultLocale:"ku-arab-iq"},{language:"lt",defaultLocale:"lt-lt"},{language:"lv",defaultLocale:"lv-lv"},{language:"ml",defaultLocale:"ml-in"},{language:"mr",defaultLocale:"mr-in"},{language:"ms",defaultLocale:"ms-my"},{language:"nb",defaultLocale:"nb-no"},{language:"nl",defaultLocale:"nl-nl"},{language:"nn",defaultLocale:"nn-no"},{language:"or",defaultLocale:"or-in"},{language:"pl",defaultLocale:"pl-pl"},{language:"pt",defaultLocale:"pt-pt"},{language:"ro",defaultLocale:"ro-ro"},{language:"ru",defaultLocale:"ru-ru"},{language:"sk",defaultLocale:"sk-sk"},{language:"sl",defaultLocale:"sl-si"},{language:"sr",defaultLocale:"sr-cyrl-rs"},{language:"sr-cyrl",defaultLocale:"sr-cyrl-rs"},{language:"sr-latn",defaultLocale:"sr-latn-rs"},{language:"sv",defaultLocale:"sv-se"},{language:"sw",defaultLocale:"sw-ke"},{language:"ta",defaultLocale:"ta-in"},{language:"te",defaultLocale:"te-in"},{language:"th",defaultLocale:"th-th"},{language:"tr",defaultLocale:"tr-tr"},{language:"uk",defaultLocale:"uk-ua"},{language:"ur",defaultLocale:"ur-pk"},{language:"vi",defaultLocale:"vi-vn"},{language:"zh",defaultLocale:"zh-cn"},{language:"zh-hant",defaultLocale:"zh-tw"},{language:"zh-cht",defaultLocale:"zh-tw"},{language:"zh-hk",defaultLocale:"zh-tw"},{language:"zh-mo",defaultLocale:"zh-tw"}],this.pesMappings=[{locale:"am-et",pesLocale:"am-ET"},{locale:"ar-sa",pesLocale:"ar-SA"},{locale:"az-latn-az",pesLocale:"az-Latn-AZ"},{locale:"be-by",pesLocale:"be-BY"},{locale:"bg-bg",pesLocale:"bg-BG"},{locale:"bn-bd",pesLocale:"bn-BD"},{locale:"bn-in",pesLocale:"bn-IN"},{locale:"bs-latn-ba",pesLocale:"bs-Latn-BA"},{locale:"ca-es",pesLocale:"ca-ES"},{locale:"ca-es-valencia",pesLocale:"ca-ES-valencia"},{locale:"cs-cz",pesLocale:"cs-CZ"},{locale:"cy-gb",pesLocale:"cy-GB"},{locale:"da-dk",pesLocale:"da-DK"},{locale:"de-de",pesLocale:"de-DE"},{locale:"el-gr",pesLocale:"el-GR"},{locale:"en-gb",pesLocale:"en-GB"},{locale:"en-us",pesLocale:"en-US"},{locale:"es-es",pesLocale:"es-ES"},{locale:"es-mx",pesLocale:"es-MX"},{locale:"es-us",pesLocale:"es-MX"},{locale:"es-ar",pesLocale:"es-MX"},{locale:"et-ee",pesLocale:"et-EE"},{locale:"eu-es",pesLocale:"eu-ES"},{locale:"fa-ir",pesLocale:"fa-IR"},{locale:"fi-fl",pesLocale:"fi"},{locale:"fil-ph",pesLocale:"fil-PH"},{locale:"fr-fr",pesLocale:"fr-FR"},{locale:"gd-gb",pesLocale:"gd-GB"},{locale:"gl-es",pesLocale:"gl-ES"},{locale:"gu-in",pesLocale:"gu-IN"},{locale:"he-il",pesLocale:"he-IL"},{locale:"hi-in",pesLocale:"hi-IN"},{locale:"hr-hr",pesLocale:"hr-HR"},{locale:"hu-hu",pesLocale:"hu-HU"},{locale:"id-id",pesLocale:"id-ID"},{locale:"is-is",pesLocale:"is-IS"},{locale:"it-it",pesLocale:"it-IT"},{locale:"ja-jp",pesLocale:"ja-JP"},{locale:"ka-ge",pesLocale:"ka-GE"},{locale:"kk-kz",pesLocale:"kk-KZ"},{locale:"kn-in",pesLocale:"kn-IN"},{locale:"ko-kr",pesLocale:"ko-KR"},{locale:"ku-arab-iq",pesLocale:"ku-Arab-IQ"},{locale:"lb-lu",pesLocale:"lb-LU"},{locale:"lt-lt",pesLocale:"lt-LT"},{locale:"lv-lv",pesLocale:"lv-LV"},{locale:"mk-mk",pesLocale:"mk-MK"},{locale:"ml-in",pesLocale:"ml-IN"},{locale:"mr-in",pesLocale:"mr-IN"},{locale:"ms-my",pesLocale:"ms-MY"},{locale:"nb-no",pesLocale:"nb-NO"},{locale:"nl-nl",pesLocale:"nl-NL"},{locale:"nn-no",pesLocale:"nn-NO"},{locale:"or-in",pesLocale:"or-IN"},{locale:"pl-pl",pesLocale:"pl-PL"},{locale:"pt-br",pesLocale:"pt-BR"},{locale:"pt-pt",pesLocale:"pt-PT"},{locale:"ro-ro",pesLocale:"ro-RO"},{locale:"ru-ru",pesLocale:"ru-RU"},{locale:"sk-sk",pesLocale:"sk-SK"},{locale:"sl-si",pesLocale:"sl-SI"},{locale:"sq-al",pesLocale:"sq-AL"},{locale:"sr-cyrl-ba",pesLocale:"sr-Cyrl-BA"},{locale:"sr-cyrl-rs",pesLocale:"sr-Cyrl-RS"},{locale:"sr-latn-rs",pesLocale:"sr-Latn-RS"},{locale:"sv-se",pesLocale:"sv-SE"},{locale:"sw-ke",pesLocale:"sw-KE"},{locale:"ta-in",pesLocale:"ta-IN"},{locale:"te-in",pesLocale:"te-IN"},{locale:"th-th",pesLocale:"th-TH"},{locale:"tr-tr",pesLocale:"tr-TR"},{locale:"uk-ua",pesLocale:"uk-UA"},{locale:"ur-pk",pesLocale:"ur-PK"},{locale:"uz-latn-uz",pesLocale:"uz-Latn-UZ"},{locale:"vi-vn",pesLocale:"vi-VN"},{locale:"zh-cn",pesLocale:"zh-CN"},{locale:"zh-tw",pesLocale:"zh-TW"}]}getMappingByLanguage(e){for(let t=0;t<this.mappings.length;t++)if(this.mappings[t].language.toLowerCase()===e.toLowerCase())return this.mappings[t]}getPesMapping(e){for(let t=0;t<this.pesMappings.length;t++)if(this.pesMappings[t].locale.toLowerCase()===e.toLowerCase()&&this.pesMappings[t])return this.pesMappings[t]}getPesLocale(e){if(!e)return"default";let t=this.getPesMapping(e);if(t&&t.pesLocale)return t.pesLocale;const s=this.getLocale(e);return s!==e&&(t=this.getPesMapping(s),t)?t.pesLocale:"default"}getLocale(e){const t=this.getMappingByLanguage(e);if(t)return t.defaultLocale;{const t=e.lastIndexOf("-");return t>-1?this.getLocale(e.substring(0,t)):e}}}},857946:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertDbSkypeDraftsInputToSavedMessageInput=t.convertSavedMessageInputToDbSkypeDraftsInput=t.SavedMessageType=void 0;const i=s(496486),o=s(881632),n=s(986374),r=s(923944),a=s(112692);var l;!function(e){e[e.None=0]="None",e[e.Edited=1]="Edited",e[e.Quoted=2]="Quoted"}(l=t.SavedMessageType||(t.SavedMessageType={})),t.convertSavedMessageInputToDbSkypeDraftsInput=function(e,t){const s=(0,r.decodeFromInput)(t.inputEntities,!1),o=i.head(t.messages),n=i.tail(t.messages);return{conversationId:e,inputEntitiesDataVersion:t.inputEntitiesDataVersion,type:t.type,timestamp:t.timestamp,message:o,restMessages:i.size(n)>0?n:void 0,inputEntities:s.encodeToString()}},t.convertDbSkypeDraftsInputToSavedMessageInput=function(e){const{conversationId:t,inputEntities:s,inputEntitiesDataVersion:r,type:d,timestamp:c}=e;return{conversationId:t,messages:d===l.None?void 0:i.compact(i.map([e.message,...e.restMessages||[]],a.default.fromDatabaseObject)),inputEntities:(0,o.toEntities)(n.decodeFromContent(s),{supportEmoticons:!0}),inputEntitiesDataVersion:r,type:d,timestamp:c||Date.now()}}},496856:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ThreadPropLiesAllowed=t.PropLieType=t.ConvPropLiesAllowed=t.MagicUnreadPinnedNumber=t.MagicFavoritesPinnedNumber=void 0;const i=s(174958),o=s(496486),n=s(248467),r=s(568580),a=s(598925),l=s(351077),d=s(890239),c=s(671830),h=s(10102),u=s(63060),p=s(746096),g=s(436237),m=s(861253),S=s(18078),f=s(112692),y=s(404057),v=s(478262),C=s(327795),_=s(571046),b="skypeid=";o.invert(c.ConversationProps),o.invert(c.ThreadProps);var T;t.MagicFavoritesPinnedNumber=31536e8,t.MagicUnreadPinnedNumber=15768e8,t.ConvPropLiesAllowed={[c.ConversationProps.Alerts]:!0,[c.ConversationProps.ConsumptionHorizon]:!0,[c.ConversationProps.Pinned]:!0,[c.ConversationProps.Subscription]:!0,[c.ConversationProps.ConversationStatus]:!0,[c.ConversationProps.ConversationBlocked]:!0,[c.ConversationProps.Color]:!0,[c.ConversationProps.Archived]:!0},function(e){e[e.Local=1]="Local",e[e.Global=2]="Global"}(T=t.PropLieType||(t.PropLieType={})),t.ThreadPropLiesAllowed={[c.ThreadProps.TopicName]:T.Global,[c.ThreadProps.Picture]:T.Global,[c.ThreadProps.JoinEnabled]:T.Global,[c.ThreadProps.MagicBotEnabled]:T.Global,[c.ThreadProps.LiveState]:T.Local,[c.ThreadProps.LastLeaveAt]:T.Local};const M=/identity="(.*?)"/g,I=/type="(.*?)"/g,w=[l.MessageTypes.HandshakeInvite,l.MessageTypes.HandshakeAccept,l.MessageTypes.HandshakeComplete];class P extends u.default{constructor(e,t=!1){super(),this.id=e.id,this.mriNamespace=c.getMriNamespace(this.id),this.convViewVersion=e.convViewVersion,this._convProps=e._convProps,this._convPropLieInfo=e._convPropLieInfo,this._consumptionHorizonPropVersion=e._consumptionHorizonPropVersion,this.memberConsumptionHorizonsSorted=e.memberConsumptionHorizonsSorted,this.threadDetailsVersion=e.threadDetailsVersion,this._threadProps=e._threadProps,this._threadPropLieInfo=e._threadPropLieInfo,this._threadMembers=e._threadMembers,this._forceSyncThreadDetails=e._forceSyncThreadDetails||!1,this.lastMessage=e.lastMessage?f.default.fromDatabaseObject(e.lastMessage):void 0,this.lastCallTime=e.lastCallTime,this.lastCallDirection=e.lastCallDirection,this.isFake=e.isFake,this.isBricked=this._isBricked(e),this._timestamp=e._timestamp||this._calcTimestamp(),this._searchTerms=(t?e._searchTerms:this._generateSearchTerms())||"",this._lastHandshakeChangeTime=e._lastHandshakeChangeTime}_isBricked(e){return!!c.isBrickedOneToOneThread(e.id)||!c.isOneOnOneConversation(e.id)&&e.isBricked}_generateSearchTerms(){const e=[];let t=this.topicName();t&&(t=c.unescapeTextWithoutXml(t),e.push(t));const s=this.getMemberMrisWithoutMe();return s&&e.push(...s),e.join(" ")}isImmutable(){return!0}static _mergeLastMessage(e,t){return e&&!o.isEmpty(e)?t?t.applyServerMessage(e):f.default.fromFirstServerMessage(e):t}static fromRawConversation(e,t){let s=P._mergeLastMessage(e.lastMessage,t);return s&&s.isMergingBotHighlightMessageLocal(e.id)&&(s=void 0),new P({id:e.id,convViewVersion:e.version,_convProps:e.properties,_convPropLieInfo:void 0,_consumptionHorizonPropVersion:void 0,memberConsumptionHorizonsSorted:void 0,threadDetailsVersion:0,_threadProps:e.threadProperties,_threadPropLieInfo:void 0,_threadMembers:void 0,lastMessage:s,lastCallTime:void 0,lastCallDirection:void 0,isFake:!1,isBricked:!1,_timestamp:void 0,_forceSyncThreadDetails:!1})}static fromRawThread(e){return new P({id:e.id,convViewVersion:0,_convProps:{},_convPropLieInfo:void 0,_consumptionHorizonPropVersion:void 0,memberConsumptionHorizonsSorted:void 0,threadDetailsVersion:e.version,_threadProps:this._removeInvalidThreadProps(e.properties),_threadPropLieInfo:void 0,_threadMembers:e.members,lastMessage:void 0,lastCallTime:void 0,lastCallDirection:void 0,isFake:!1,isBricked:!1,_forceSyncThreadDetails:!1})}static newFakeEmptyConversation(e,t=void 0){return new P({id:e,convViewVersion:0,_convProps:{},_convPropLieInfo:void 0,_consumptionHorizonPropVersion:void 0,memberConsumptionHorizonsSorted:void 0,threadDetailsVersion:0,_threadProps:c.isThread(e)?{}:void 0,_threadPropLieInfo:void 0,lastMessage:void 0,_threadMembers:t?[{id:t,role:d.ThreadMemberRoles.User},{id:S.default.getSkypeMri(),role:d.ThreadMemberRoles.User}]:void 0,lastCallDirection:void 0,lastCallTime:void 0,isFake:!0,isBricked:!1,_forceSyncThreadDetails:!1})}static fromDatabaseObject(e){return e?new P(e,!0):void 0}mergeConversationUpdate(e,t){const s=P._mergeLastMessage(e.lastMessage,t);if(e.version<=this.convViewVersion)return g.log(p.LogTraceArea.SkypeConversationLocal,"Ignoring out of date conversation:, ",i.pii.Mri(this.id),"New version:",e.version,"<=",this.convViewVersion,"lastMessage version:",this.lastMessage?this.lastMessage.getLatestServerMessageVersion():"n/a","new lastMessage version:",s?s.getLatestServerMessageVersion():"n/a"),this;let n,r=!1;if(e.threadProperties){if(n=o.cloneDeep(this._threadProps)||{},void 0!==e.threadProperties[c.ThreadProps.TopicName]){const t=(Boolean(this._threadProps)&&this.getThreadProperty(c.ThreadProps.TopicName)||"").toString().length;let s=!0;e.threadProperties[c.ThreadProps.TopicName].toString().length>=60&&(t<60?r=!0:s=!1),s&&(n[c.ThreadProps.TopicName]=e.threadProperties[c.ThreadProps.TopicName])}o.each(c.getThreadPropsInConversationView(),(t=>{e.threadProperties[t]?n[t]=e.threadProperties[t]:delete n[t]}))}let a,l=e.properties;this._consumptionHorizonPropVersion&&this._consumptionHorizonPropVersion>e.version&&(a=this._consumptionHorizonPropVersion,l=o.cloneDeep(l),l[c.ConversationProps.ConsumptionHorizon]=this._convProps[c.ConversationProps.ConsumptionHorizon]);const[d,h,u]=this._calcNewServerMessageInfo(this.lastCallTime,this.lastCallDirection,s,!1);return new P({id:this.id,convViewVersion:e.version,_convProps:l,_convPropLieInfo:this._convPropLieInfo,_consumptionHorizonPropVersion:a,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:n,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:d,lastCallTime:h,lastCallDirection:u,isFake:!1,isBricked:!1,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:r})}mergeThreadUpdate(e){if(this._forceSyncThreadDetails)g.log(p.LogTraceArea.SkypeConversationLocal,"Force syncing thread update: "+i.pii.Mri(this.id)+"New version: "+e.version+", old version: "+this.threadDetailsVersion);else if(this.threadDetailsVersion&&e.version<=this.threadDetailsVersion)return g.log(p.LogTraceArea.SkypeConversationLocal,"Ignoring out of date thread: ",i.pii.Mri(this.id),"New version:",e.version,"<=",this.threadDetailsVersion),this;const t=P._removeInvalidThreadProps(e.properties);if(this._threadProps&&(this._threadProps[c.ThreadProps.LastJoinAt]&&(t[c.ThreadProps.LastJoinAt]=this._threadProps[c.ThreadProps.LastJoinAt]),this._threadProps[c.ThreadProps.LastLeaveAt]&&(t[c.ThreadProps.LastLeaveAt]=this._threadProps[c.ThreadProps.LastLeaveAt])),void 0===t[c.ThreadProps.TopicName]&&(t[c.ThreadProps.TopicName]=""),this._threadProps&&(this._threadProps[c.ThreadProps.ThreadDetailsVersion]||Number(this._threadProps[c.ThreadProps.ThreadDetailsVersion])<e.version)&&(t[c.ThreadProps.ThreadDetailsVersion]=e.version.toString()),this.isEncryptedThread()){const e=this.getEncryptionHandshake(),s=this._parseSecureHandshake(t[c.ThreadProps.SecureHandshake]);if(e&&s){const i=c.ThreadProps.SecureDeviceSwitch;"None"!==e.HandshakeState&&(this._threadProps&&this._threadProps[i]?t[i]=!0:t[i]=e.InviteId!==s.InviteId);const n=c.ThreadProps.SecureHandshakeOnceEstablished;this._threadProps&&!o.isUndefined(this._threadProps[n])?t[n]=this._threadProps[n]:"Completed"===s.HandshakeState&&(t[n]=!0)}}return new P({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:this._convPropLieInfo,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:e.version,_threadProps:t,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:c.filterMembersProp(e.members),lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:!1,isBricked:!1,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:!1})}mergeMessageLocal(e,t){const[s,i,o,n,r]=this._calcNewServerMessageInfo(this.lastCallTime,this.lastCallDirection,e,t);return r?new P({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:this._convPropLieInfo,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:this._threadProps,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:s,lastCallTime:i,lastCallDirection:o,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:n,_forceSyncThreadDetails:this._forceSyncThreadDetails}):this}mergeConsumptionHorizonPush(e,t){if(t&&(t<this.convViewVersion||this._consumptionHorizonPropVersion&&t<this._consumptionHorizonPropVersion))return this;const s=o.cloneDeep(this._convProps);s[c.ConversationProps.ConsumptionHorizon]=e;const n=c.getServerTimestampFromConsumptionHorizon(e),r=this.getConsumptionHorizonTimestamp();return r>n&&g.log(p.LogTraceArea.SkypeConversationLocal,"Remote consumption horizon is older then local: ",i.pii.Mri(this.id)," remove:",n," local:",r),new P({id:this.id,convViewVersion:this.convViewVersion,_convProps:s,_convPropLieInfo:this._convPropLieInfo,_consumptionHorizonPropVersion:t,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:this._threadProps,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:this._forceSyncThreadDetails})}mergeMemberConsumptionHorizons(e){let t=!1;const s=o.keyBy(this.memberConsumptionHorizonsSorted||[],(e=>e.id));if(o.each(e,(e=>{const o=c.getServerTimestampFromConsumptionHorizon(e.consumptionhorizon),n=c.getConsumptionHorizonUpdateTime(e.consumptionhorizon);(!s[e.id]||s[e.id].consumptionHorizon<o)&&(t=!0,s[e.id]={id:e.id,consumptionHorizon:o,consumptionHorizonUpdateTime:n}),g.log(p.LogTraceArea.SkypeConversationLocal,"Merging member consumption horizons: ",i.pii.Mri(this.id)," id:",i.pii.Mri(e.id)," consumptionHorizon:",o," updated:",n," wasUpdated:",t)})),!t)return this;const n=o.sortBy(o.values(s),(e=>e.consumptionHorizon));return new P({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:this._convPropLieInfo,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,memberConsumptionHorizonsSorted:n,threadDetailsVersion:this.threadDetailsVersion,_threadProps:this._threadProps,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:this._forceSyncThreadDetails})}dropLastMessage(){return new P({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:this._convPropLieInfo,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:this._threadProps,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:void 0,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:this._forceSyncThreadDetails})}_setNewPropInfo(e,t,s,i){return new P({id:this.id,convViewVersion:this.convViewVersion,_convProps:e,_convPropLieInfo:t,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:s,_threadPropLieInfo:i,_threadMembers:this._threadMembers,lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:this._forceSyncThreadDetails})}setConvPropertyLie(e,t,s){if(this._convProps[e]===t&&(!this._convPropLieInfo||!(e in this._convPropLieInfo)||this._convPropLieInfo[e].value===t&&(0,m.default)(this._convPropLieInfo[e].additionalParams,s)))return this;const i=this.getConversationProperty(e);if(e===c.ConversationProps.ConsumptionHorizon&&s&&"false"===s.bookmark&&!c.isConsumptionHorizonNewer(i,t))return this;const n=o.cloneDeep(this._convPropLieInfo)||{};return n[e]={value:t,additionalParams:s},this._setNewPropInfo(this._convProps,n,this._threadProps,this._threadPropLieInfo)}revertConvPropertyLie(e,t,s){if(!this._convPropLieInfo||!this._convPropLieInfo[e]||this._convPropLieInfo[e].value!==t||!(0,m.default)(this._convPropLieInfo[e].additionalParams,s))return this;let i=o.cloneDeep(this._convPropLieInfo)||{};return delete i[e],o.isEmpty(i)&&(i=void 0),this._setNewPropInfo(this._convProps,i,this._threadProps,this._threadPropLieInfo)}confirmConvPropertyLieApplied(e,t,s){if(!this._convPropLieInfo||!this._convPropLieInfo[e]||this._convPropLieInfo[e].value!==t||!(0,m.default)(this._convPropLieInfo[e].additionalParams,s))return this;const i=this.getConversationProperty(e);let n=o.cloneDeep(this._convPropLieInfo)||{};delete n[e],o.isEmpty(n)&&(n=void 0);const r=o.cloneDeep(this._convProps);return r[e]=i,this._setNewPropInfo(r,n,this._threadProps,this._threadPropLieInfo)}setThreadPropertyLie(e,t){if(this._threadProps,!(this._threadProps[e]!==t||this._threadPropLieInfo&&e in this._threadPropLieInfo&&this._threadPropLieInfo[e].value!==t))return this;const s=o.cloneDeep(this._threadPropLieInfo)||{};return s[e]={value:t},this._setNewPropInfo(this._convProps,this._convPropLieInfo,this._threadProps,s)}revertThreadPropertyLie(e,t){if(!this._threadPropLieInfo||!this._threadPropLieInfo[e]||this._threadPropLieInfo[e].value!==t)return this;let s=o.cloneDeep(this._threadPropLieInfo)||{};return delete s[e],o.isEmpty(s)&&(s=void 0),this._setNewPropInfo(this._convProps,this._convPropLieInfo,this._threadProps,s)}confirmThreadPropertyLieApplied(e,t){if(!this._threadPropLieInfo||!this._threadPropLieInfo[e]||this._threadPropLieInfo[e].value!==t)return this;let s=o.cloneDeep(this._threadPropLieInfo)||{};delete s[e],o.isEmpty(s)&&(s=void 0);const i=o.cloneDeep(this._threadProps);return i[e]=t,this._setNewPropInfo(this._convProps,this._convPropLieInfo,i,s)}brickConversation(){const e=o.cloneDeep(this._threadProps);return e&&(e[c.ThreadProps.ThreadDetailsVersion]="0"),new P({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:void 0,_consumptionHorizonPropVersion:void 0,memberConsumptionHorizonsSorted:void 0,threadDetailsVersion:0,_threadProps:e,_threadPropLieInfo:void 0,_threadMembers:this._threadMembers,lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:!0,_forceSyncThreadDetails:!1})}_calcNewServerMessageInfo(e,t,s,i){if(!s||(0,_.isMagicBotOneOnOneControlMessage)(s)||s&&s.isMergingBotHighlightMessageLocal(this.id))return[this.lastMessage,e,t,this._lastHandshakeChangeTime,!1];if(!s)return[this.lastMessage,e,t,this._lastHandshakeChangeTime,!1];let n,r=!1,a=this.lastMessage,d=e,h=t,u=this._lastHandshakeChangeTime;if(this.lastMessage){const e=this.lastMessage.getLatestServerMessageVersion();n=e?Number(e):0}else n=0;const m=s.getLatestServerMessageVersion(),S=m?Number(m):0;let f=!1;if(f=s.isDeletedMessage()||s.isReported()?!!this.lastMessage&&this.lastMessage.cuid===s.cuid:!this.lastMessage||s.createdTime>this.lastMessage.createdTime||S>=n&&(s.createdTime===this.lastMessage.createdTime||this.lastMessage.cuid===s.cuid)||i&&(this.lastMessage.isDeletedMessage()||this.lastMessage.isUnreconciledEdit()||this.lastMessage.isCanceledScheduledCall()||this.lastMessage.isReported()||this.lastMessage.isHiddenTranslationSettingsMessage()||this.lastMessage.isHiddenInPreviewTranslation(this.isTranslated())||c.isConciergeBotMri(this.lastMessage.creator)&&!this.lastMessage.isAllowedEngagementBotMessage()),f&&(a=s,r=!0,g.log(p.LogTraceArea.SkypeConversationLocal,`Updated last message to cuid: ${s.cuid} createdTime ${s.createdTime}`)),s.messagetype===l.MessageTypes.Call){const t=e;d=e?Math.max(e,s.createdTime):s.createdTime,h=P._getCallType(s.content),d!==t&&(r=!0)}return o.includes(w,s.messagetype)&&(u=o.max([u,s.createdTime]),r=r||u!==this._lastHandshakeChangeTime),[a,d,h,u,r]}static _getCallType(e){const t=M.exec(e);if(t&&t.length>0&&S.default.getSkypeId()===t[1])return v.CallDirectionType.Outgoing;{const t=I.exec(e);return t&&t.length>0&&t[1]===n.CallCardType.Missed?v.CallDirectionType.Missed:v.CallDirectionType.Incoming}}static _removeInvalidThreadProps(e){const t=o.cloneDeep(e);return delete t[c.ThreadProps.LastJoinAt],delete t[c.ThreadProps.LastLeaveAt],t}isCurrentUserMember(){return!this.isBricked&&(!this.isThread()||(this._threadMembers&&this.threadDetailsVersion&&this.threadDetailsVersion>=this.convViewVersion?o.some(this._threadMembers,(e=>S.default.isMyMri(e.id))):!(this._threadProps&&this._threadProps[c.ThreadProps.LastLeaveAt]&&(!this._threadProps[c.ThreadProps.LastJoinAt]||Number(this._threadProps[c.ThreadProps.LastJoinAt])<Number(this._threadProps[c.ThreadProps.LastLeaveAt])))))}isDeleted(){const e=this.getDeletedTimestamp(),t=this.getSecureHandshakeTimestamp();return!(e<=0)&&(!this._timestamp||e>=this._timestamp&&e>=t)}getDeletedTimestamp(){const e=this.getConversationProperty(c.ConversationProps.DeleteTimestamp);return e?Number(e):0}getSecureHandshakeTimestamp(){const e=this.isEncryptedThread()?this.getEncryptionHandshake():void 0;return e?Date.parse(e.LastUpdateTs):0}isUserMember(e){return this.isThread()?o.includes(this.getMemberMris(),e):this.id===e||!!S.default.isMyMri(e)}hasAgentMember(){return this.isThread()?o.some(this.getThreadMembers(),(e=>c.isAgent(e.id))):c.isAgent(this.id)}isThread(){return this.mriNamespace===c.Namespaces.Thread}isOneOnOne(){return this._isOneOnOneNonReentrantCheck()||this.isLogicalOneOnOneSmsConversation()||this.isV2OneToOneThread()}isOneToOneThread(){return c.isOneToOneThread(this.id)}isOneToOneUserConvWithThreadIdSupport(){return c.isOneToOneThreadUserMriNamespace(this.id)}_isOneOnOneNonReentrantCheck(){return c.isMriNamespaceUser(this.mriNamespace)||this.mriNamespace===c.Namespaces.OneToOneTextMessage||c.isOneToOneThread(this.id)||c.isEncryptedThread(this.id)}isV2OneToOneThread(){return c.isV2Thread(this.id)&&this.isSticky()}getOneOnOneThreadId(){if(c.isV2Thread(this.id))return this.isSticky()?this.id:void 0;if(c.isOneToOneThreadUserMriNamespace(this.id)){const e=this._convProps[c.ConversationProps.OneToOneThreadId];return e?c.Namespaces.Thread+":"+e:(g.track(new C.DevDebug("buildOneOnOneThreadId",this.id)),c.buildOneOnOneThreadId(this.id))}}getTrackableConversationId(){return this.isOneOnOne()?this.getOneOnOneThreadId():this.id}getOtherPartyMri(){if(c.isMriNamespaceUser(this.mriNamespace)||this.mriNamespace===c.Namespaces.OneToOneTextMessage)return this.id;const e=o.find(this.getThreadMembers(),(e=>!S.default.isMyMri(e.id)&&c.isSkypeIdMri(e.id)));return e?e.id:void 0}getOtherPartyMriForOneToOneThread(){const e=o.find(this.getThreadMembers(),(e=>!S.default.isMyMri(e.id)));return e?e.id:void 0}getOtherPartyMriOrConvId(){return(this.isOneOnOne()?this.getOtherPartyMri():void 0)||this.id}isHighlightsThread(){return c.isHighlightsThread(this.id)}isBotHighlightsThread(){return c.isBotHighlightsThread(this.id)}isReactionsThread(){return!!this.isThread()&&!(this.getThreadProperty(c.ThreadProps.ThreadType)!==c.ThreadTypes.Reactions&&!c.isReactionsThread(this.id))}isBookmarksThread(){return c.isBookmarkConversation(this.id)}isMyBotThread(){return c.isMyBotConversation(this.id)}isEncryptedThread(){return c.isEncryptedThread(this.id)}isSkypeSMSConversation(){return c.isPhoneMri(this.id)}isLogicalOneOnOneSmsConversation(){return c.isPhoneMri(this.id)}isSyncEnabled(e){return!this.isHighlightsThread()&&(!(e&&e.skipCastSync&&this.isReactionsThread())&&!(e&&e.skipSmsMmsSync&&c.isSmsMmsThread(this.id)))}hasSpecificAgentMember(e){return!!e&&o.includes(this.getMemberMrisWithoutMe(),e)}getLastJoinAt(){if(this._threadProps)return Number(this._threadProps[c.ThreadProps.LastJoinAt])}topicName(){if(this.isThread())return this.getThreadProperty(c.ThreadProps.TopicName)}getSuggestedActions(e,t){return t?this._getSuggestedActionsV2(e):this._getSuggestedActionsV1()}_getSuggestedActionsV1(){const e=y.default.parseJsonErrorToUndefined(this._convProps[c.ConversationProps.SuggestedActions]);return e&&e.messageId?{messageId:e.messageId.toString(),to:e.to,actions:o.map(e.actions,(e=>({title:e.title,value:e.value,type:e.type,image:e.image,pageTitle:e.displayText,attributes:e.channelData?e.channelData.telemetryData:void 0})))}:void 0}_getSuggestedActionsV2(e){}getSuggestedMessageActivity(e){}creator(){if(!this._threadProps||!this._threadProps[c.ThreadProps.Creator]){if(this.isBotHighlightsThread()){const e=c.getSkypeIdFromHighlightsThreadMri(this.id);return e?c.asMri(e):void 0}if(this.isHighlightsThread()){const e=c.getSkypeIdFromHighlightsThreadMri(this.id);return e?c.idAndNamespaceToMri(e,c.Namespaces.SkypeId):void 0}return this.isOneOnOne()&&!this.isThread()?this.id:void 0}const e=this._threadProps[c.ThreadProps.Creator],t=e.split(";");if(1===t.length)return e;let s;for(let e=t.length-1;e>=0;e--){const i=t[e];if(0===i.indexOf(b))return c.skypeIdToMri(i.substring(8));!s&&c.isMri(i)&&(s=i)}return s}createdDate(){return this._threadProps&&this._threadProps[c.ThreadProps.CreatedAt]?parseInt(this._threadProps[c.ThreadProps.CreatedAt],10):void 0}color(){return this._convProps&&this._convProps[c.ConversationProps.Color]?h.deserializeColorInfo(this._convProps[c.ConversationProps.Color]):h.getDefaultColorInfo(this.id)}getConnector(e){this._threadProps;const t=o.find(o.keys(this._threadProps),(t=>t===c.stripMriNamespace(e)));return t?y.default.parseJsonErrorToUndefined(this._threadProps[t]):void 0}getWebhookUrl(e){this._threadProps;const t=o.filter(o.keys(this._threadProps),(e=>o.startsWith(e,c.ConnectorThreadPropPrefix))),s=o.find(t,(t=>{if(!t)return!1;const s=y.default.parseJsonErrorToUndefined(this._threadProps[t]);return s?e===s.displayName:(g.log(p.LogTraceArea.SkypeConversationLocal,"Parsing failed for key: "+t+", value: "+this._threadProps[t]),!1)}));if(!s)return void g.log(p.LogTraceArea.SkypeConversationLocal,"No matching thread prop found for "+i.pii.Omit(e));const n=y.default.parseJsonErrorToUndefined(this._threadProps[s]);return n&&n.incomingUrl}getConnectorMris(){return o.compact(o.map(o.keys(this._threadProps),(e=>{if(o.startsWith(e,c.ConnectorThreadPropPrefix))return c.sanitizeMri(e,c.Namespaces.Bot)})))}getTimestamp(){return this._timestamp}getSortRank(){return this._timestamp+(this.isFavorite()?t.MagicFavoritesPinnedNumber:0)}_calcTimestamp(){const e=[0];return this.lastMessage&&e.push(this.lastMessage.createdTime),this._threadProps&&(this._threadProps[c.ThreadProps.CreatedAt]&&e.push(this._threadProps[c.ThreadProps.CreatedAt]),this._threadProps[c.ThreadProps.LastJoinAt]&&e.push(this._threadProps[c.ThreadProps.LastJoinAt]),this._threadProps[c.ThreadProps.LastLeaveAt]&&e.push(this._threadProps[c.ThreadProps.LastLeaveAt])),Math.max.apply(Math,e)}hasPendingLies(){return!!this._convPropLieInfo||!!this._threadPropLieInfo}getPendingConvPropLies(){return this._convPropLieInfo}getPendingThreadPropLies(){return this._threadPropLieInfo}isUserAlertsEnabled(){const e=this.getConversationProperty(c.ConversationProps.Alerts);return!e||"true"===e.toLowerCase()}isArchived(){return!!this.getConversationProperty(c.ConversationProps.Archived)}canDisplayArchived(){const e=this.getConversationProperty(c.ConversationProps.Archived);return!e||e<this._timestamp}isMuted(){return this.getSubscription()===c.SubscriptionTypes.Muted}isLoud(){return this.getSubscription()===c.SubscriptionTypes.Loud}isFavorite(){const e="true"===(this.getConversationProperty(c.ConversationProps.Pinned)||"").toLowerCase(),t="true"===(this.getConversationProperty(c.ConversationProps.Favorite)||"").toLowerCase();return e||t}isTranslated(){return this.getTranslationState()===a.TranslationState.Enabled}isTranslationDisabled(){return!o.includes([a.TranslationState.Enabled,a.TranslationState.Requested,a.TranslationState.Pending],this.getTranslationState())}getTranslationState(){if(this._convProps[c.ConversationProps.Translated]){const e=this.getConversationProperty(c.ConversationProps.Translated),t=parseInt(a.TranslationState[e],10);return t||a.TranslationState.Disabled}return a.TranslationState.Disabled}getMessageTranslationLocale(){return this.isThread()?this.getThreadProperty(c.ThreadProps.MessageTranslationLocale):this.getConversationProperty(c.ConversationProps.MessageTranslationLocale)}isJoinEnabled(){return this.isThread()&&"true"===(this.getThreadProperty(c.ThreadProps.JoinEnabled)||"").toLowerCase()}isMagicBotEnabled(){return"true"===(this.getThreadProperty(c.ThreadProps.MagicBotEnabled)||"").toLowerCase()}isModerated(){return this.isThread()&&"true"===(this.getThreadProperty(c.ThreadProps.ModeratedThread)||"").toLowerCase()}isSticky(){return this.isThread()&&"true"===(this.getThreadProperty(c.ThreadProps.IsSticky)||"").toLowerCase()}getBannedSkypeIds(){const e=this.isThread()&&this.getThreadProperty(c.ThreadProps.BannedUserList)||"";if(e){const t=o.map(e.split(","),(e=>c.getSkypeIdFromMri(c.asMri(e))));return o.compact(t)}return[]}isHistoryDisclosed(){return this.isThread()&&"true"===(this.getThreadProperty(c.ThreadProps.HistoryDisclosed)||"").toLowerCase()}isGuestJoinDisabled(){return this.isThread()&&"true"===(this.getThreadProperty(c.ThreadProps.DisableAnonymousJoin)||"").toLowerCase()}getSubscription(){if(!this.isUserAlertsEnabled())return c.SubscriptionTypes.Muted;const e=this.getConversationProperty(c.ConversationProps.Subscription);return e===c.SubscriptionTypes.Muted?c.SubscriptionTypes.Loud:e||c.SubscriptionTypes.Loud}hasActiveCall(){return this.isThread()&&r.default.isLiveStateValid(this.liveState())}hasGoLive(){const e=this.validLiveState();return!!e&&r.default.isLiveStateForGoLive(e)}validLiveState(){const e=this.liveState();return r.default.isLiveStateValid(e)?e:void 0}liveState(){if(!this.isThread()){const e=this.getConversationProperty(c.ConversationProps.LiveState);return y.default.parseJsonErrorToUndefined(e)}const e=this.getThreadProperty(c.ThreadProps.LiveState);if(!e)return;const t=y.default.parseJsonErrorToUndefined(e);return t&&t.groupCallInitiator?(t.groupCallInitiator=c.sanitizeMri(t.groupCallInitiator,c.Namespaces.SkypeId),t):void 0}getConsumptionHorizon(){const e=this.getConversationProperty(c.ConversationProps.ConsumptionHorizon);if(e)return e;if(this.isThread()&&!this.isHighlightsThread()){const e=this.getLastJoinAt()||0;return e+";"+e+";0"}return"0;0;0"}getConsumptionHorizonTimestamp(){return c.getServerTimestampFromConsumptionHorizon(this.getConsumptionHorizon())}getConversationProperty(e){if(this._convPropLieInfo&&e in this._convPropLieInfo){const t=this._convPropLieInfo[e];if(e===c.ConversationProps.ConsumptionHorizon&&t.additionalParams&&"false"===t.additionalParams.bookmark&&!c.isConsumptionHorizonNewer(this._convProps[e],this._convPropLieInfo[e].value))return this._convProps[e];const s=this._convPropLieInfo[e].value;return null===s?void 0:s}return c.getProperty(e,this._convProps,c.ConversationPropsMapping)}getConversationPropertyLie(e){if(this._convPropLieInfo&&e in this._convPropLieInfo){const t=this._convPropLieInfo[e];return e===c.ConversationProps.ConsumptionHorizon&&t.additionalParams&&"false"===t.additionalParams.bookmark&&!c.isConsumptionHorizonNewer(this._convProps[e],this._convPropLieInfo[e].value)?this._convProps[e]:this._convPropLieInfo[e].value||void 0}}getThreadProperty(e,t=!0){if(this._threadProps,t&&this._threadPropLieInfo&&e in this._threadPropLieInfo){const t=this._threadPropLieInfo[e].value;return null===t?void 0:t}return c.getProperty(e,this._threadProps,c.ThreadPropsMapping)}areThreadDetailsStale(){if(!this._threadProps)return!1;if(this.isFake&&this._isOneOnOneNonReentrantCheck())return!1;if(this._forceSyncThreadDetails)return!0;const e=Number(this._threadProps[c.ThreadProps.ThreadDetailsVersion]);return!e||this.threadDetailsVersion<e}isAdmin(e){return o.some(this.getThreadMembers(),(t=>t.id===e&&t.role===d.ThreadMemberRoles.Admin))}getThreadMembers(){if(!this.isThread())return[];if(this.areThreadDetailsStale()&&this.convViewVersion>this.threadDetailsVersion){const e=this._threadProps[c.ThreadProps.ConvView_MemberListString];if(e&&o.isString(e)){const t=y.default.parseJsonErrorToUndefined(e);if(t)return o.compact(o.map(t,(e=>e?o.isString(e)?{id:e,role:d.ThreadMemberRoles.User}:{id:e.MemberMri,role:1===e.MemberRole?d.ThreadMemberRoles.Admin:d.ThreadMemberRoles.User}:void 0)))}}return this._threadMembers||[]}getMemberMris(){return this.isThread()?o.map(this.getThreadMembers(),(e=>e.id)):[this.id,S.default.getSkypeMri()]}getMemberMrisWithoutMe(){return c.getMemberMrisWithoutMe(this.getMemberMris())}getMemberCount(){return this.isThread()?this.areThreadDetailsStale()&&c.ThreadProps.ConvView_MemberCount in this._threadProps?Number(this._threadProps[c.ThreadProps.ConvView_MemberCount]):this.getThreadMembers().length:this._convProps[c.ConversationProps.Participants]?this._convProps[c.ConversationProps.Participants].split(",").length:2}getConversationStatus(){const e=this._convProps[c.ConversationProps.ConversationStatus];if(e){const t=e;return parseInt(p.ConversationStatus[t],10)}}getConversationBlocked(){if(this._convProps[c.ConversationProps.ConversationBlocked])return"true"===this._convProps[c.ConversationProps.ConversationBlocked].toLowerCase()}isEmptyConversation(){if(this._convProps[c.ConversationProps.IsEmptyConversation])return"true"===this._convProps[c.ConversationProps.IsEmptyConversation].toLowerCase()}getAddedBy(){if(this._convProps[c.ConversationProps.ConversationStatusProperties]){const e=this._convProps[c.ConversationProps.ConversationStatusProperties],t=y.default.parseJsonErrorToUndefined(e);return t&&t.AddedBy}}getAcceptPendingMessageCount(){if(this._convProps[c.ConversationProps.ConversationStatusProperties]){const e=this._convProps[c.ConversationProps.ConversationStatusProperties],t=y.default.parseJsonErrorToUndefined(e);return t&&t.AcceptPendingMessageCount}}getEncryptionHandshake(){const e=this.getThreadProperty(c.ThreadProps.SecureHandshake);return this._parseSecureHandshake(e)}getLastEncryptionHandshakeChange(){return this._lastHandshakeChangeTime}isSwitchingSecureDevice(){return!!this.getThreadProperty(c.ThreadProps.SecureDeviceSwitch)}_parseSecureHandshake(e){if(!e)return;const t=y.default.parseJsonErrorToUndefined(e);if(!t)return void g.error(p.LogTraceArea.SkypeConversationLocal,`Failed to parse handshake info of secure thread ${i.pii.Mri(this.id)}`);const s=y.default.parseJsonErrorToUndefined(t.APartyKeyBundle),o=y.default.parseJsonErrorToUndefined(t.BPartyKeyBundle);return Object.assign(Object.assign({},t),{APartyPreKeyBundle:s,BPartyPreKeyBundle:o})}hasApplicableMembersData(){if(this.isBricked)return!1;if(!this.isCurrentUserMember())return!0;if(!this.isThread())return!0;if(c.ThreadProps.ConvView_MemberListString in this._threadProps)return!0;if(c.ThreadProps.ConvView_MemberCount in this._threadProps){if(Number(this._threadProps[c.ThreadProps.ConvView_MemberCount])>12)return!0}return!this.areThreadDetailsStale()}needsForceSyncThreadDetails(){return this._forceSyncThreadDetails}isGroupConversation(){return this.isThread()&&c.isGroupConversation(this.id)}getSource(){if(this.isThread())return this.getThreadProperty(c.ThreadProps.Source)}isLegacyMeetNowThread(){return this.isThread()&&this.getThreadProperty(c.ThreadProps.ThreadType)===c.ThreadTypes.LegacyMeetNow}}t.default=P},574163:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toClipboardObject=t.fromClipboardObject=void 0;const i=s(112692);t.fromClipboardObject=function(e){return i.default.fromFirstAcknowledgedLie({id:e.id,composetime:e.composetime,content:e.content,contenttype:e.contenttype,messagetype:e.messagetype},e.conversationId,e.creactor,e.createdTime)},t.toClipboardObject=function(e){return{id:e.getLatestServerMessageId()||"",content:e.content,composetime:new Date(e.composeTime).toDateString(),contenttype:e.contenttype,messagetype:e.messagetype,conversationId:e.conversationId,creactor:e.creator,createdTime:e.createdTime}}},112692:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(217003),n=s(889391),r=s(598925),a=s(481169),l=s(351077),d=s(671830),c=s(124898),h=s(746096),u=s(436237),p=s(861253),g=s(18078),m=s(969417),S=s(478262),f=s(853374),y=/\u2028|\u2029/g,v=(0,o.createRegExp)(o.Patterns.MATCH_IGNORABLE_SYMBOLS,"g"),C=/identity="(.*?)"/g,_=/(?:<|&lt;)quote((?:\s+[^=]+="[^"]+")+)\s*(?:>|&gt;)([^]*?)(?:<|&lt;)\/quote(?:>|&gt;)/gi,b=/([^\s=]+)="([^"]+)"/gi;class T extends c.default{constructor(e,t,s,o,n,r,a,c=!1,p,m,S,f,C){var _,b,T;if(super(e),e){if(this.createdTime>=7e15&&(this.createdTime=Date.now()),this._isSendRejected){const e=i.findLast(this._unacknowledgedLies,(e=>!i.some(this._serverMessages,(t=>t.clientmessageid===e.clientmessageid))));this._sendRejectedCMID=e?e.clientmessageid:void 0}}else if(t||s||o){if(t){this._serverMessages=i.orderBy(t,[e=>e.version||e.id,e=>e.content?e.content.length:0,e=>e.properties?1:0]);{const e=this._serverMessages[0];for(let t=1;t<this._serverMessages.length;){const s=this._serverMessages[t-1],i=this._serverMessages[t];s.version===i.version?(this._serverMessages.splice(t-1,1),u.log(h.LogTraceArea.MessageStream,"Message "+s.id+" removed as not important")):!i.skypeeditedid&&i.id>e.id&&i.content!==e.content?(this._serverMessages.splice(t,1),u.log(h.LogTraceArea.MessageStream,"Message "+i.id+" removed as a fraud")):t++}}const e=i.find(this._serverMessages,(e=>!e.skypeeditedid))||i.head(this._serverMessages);if(e){this.cuid=d.getCuidForMessage(e);const t=d.getParsedConversationId(e);this.conversationId=t||r,this.createdTime=Number(e.id),this.creator=d.getCreatorMriForMessageFromLink(e.from);const s=Date.parse(e.composetime);this.composeTime=s||this.createdTime,e.messagetype!==l.MessageTypes.Call&&this._isOriginalConfirmedServerMessage(e)&&(this._serverMessages=i.filter(this._serverMessages,(e=>d.getCreatorMriForMessageFromLink(e.from)===this.creator)))}}else{const e=i.head(o)||i.head(s);if(e&&(this.cuid=d.getCuidForMessage(e)),this.conversationId=r,this.createdTime=S,e&&e===i.head(o)&&e.id&&(this.createdTime=Number(e.id)),e){const t=Date.parse(e.composetime);this.composeTime=t||this.createdTime}this.creator=a}let e,M;i.isEmpty(s)&&i.isEmpty(o)||(this._acknowledgedLies=i.filter(o,(e=>!i.some(this._serverMessages,(t=>t.clientmessageid===e.clientmessageid||t.version>=e.version)))),this._unacknowledgedLies=i.filter(s,(e=>!(i.some(this._serverMessages,(t=>t.clientmessageid===e.clientmessageid))||e.cancel&&i.some(this._serverMessages,(t=>t.clientmessageid===e.skypeeditedid))))));let I=!1;{const t=(e,t)=>i.maxBy([e,t],(e=>e?new Date(e.composetime).getTime():0)),s=e=>i.findLast(e,(e=>!l.isDeletedMessage(e)));e=t(s(this._acknowledgedLies),s(this._unacknowledgedLies)),M=t(i.last(this._acknowledgedLies),i.last(this._unacknowledgedLies)),p&&M&&M.clientmessageid===p&&l.isDeletedMessage(M)&&(I=!0)}const w=i.findLast(this._serverMessages,(e=>this._isContentEdited(e))),P=this.getOriginalServerMessage(),k=(I?e:M)||w||P||M;(k.clientmessageid===p||I&&M&&M.clientmessageid===p)&&(this._sendRejectedCMID=p,this._sendRetryInfo=m),this.content=(k.content||"").replace(v,"").replace(y,"\n"),this.messagetype=k.messagetype,this.contenttype=k.contenttype,k.skypeemoteoffset&&(this.skypeemoteoffset=Number(k.skypeemoteoffset)),k.skypeeditoffset&&(this.skypeeditoffset=Number(k.skypeeditoffset)),k.skypeguid&&(this.skypeguid=k.skypeguid),k.amsreferences&&(this.amsreferences=i.clone(k.amsreferences));const A=w||P;A&&A.fromline&&(this.fromline=A.fromline);const x=this._serverMessages&&this._serverMessages.length?this._getServerMessageForProperties():(I?e:void 0)||M;let R=x?i.cloneDeep(x.properties):void 0;i.isEmpty(n)||(this._unacknowledgedPropSets=n,i.each(n,(e=>{R||(R={}),R[e.key]=e.value})));const O=null===(_=this._serverMessages)||void 0===_?void 0:_.filter((e=>{var t;return null===(t=e.properties)||void 0===t?void 0:t[l.MessageProperties.SuggestedActions]})),L=null===(T=null===(b=null==O?void 0:O.pop())||void 0===b?void 0:b.properties)||void 0===T?void 0:T[l.MessageProperties.SuggestedActions];L&&(R=null!=R?R:{},R[l.MessageProperties.SuggestedActions]=L),this.properties=R,this._isEphemeral=c,this._fileEncryptionKeys=f,this.reported=C,this._countsType=this.countsForUnreadCounts()?this._countsForHighPriorityUnreadCounts()?2:1:void 0,this._isMyMessage=g.default.isMyMri(this.creator)?1:0}}static fromDatabaseObject(e){return e?new T(e):void 0}static fromFirstLie(e,t,s,i,o=!1){return new T(void 0,void 0,[e],void 0,void 0,t,s,o,void 0,void 0,i)}static fromFirstAcknowledgedLie(e,t,s,i,o=!1){return new T(void 0,void 0,void 0,[e],void 0,t,s,o,void 0,void 0,i)}static fromFirstServerMessage(e){if(d.getParsedConversationId(e))return new T(void 0,[e]);u.warn(h.LogTraceArea.MessageStream,"Message "+e.id+" has invalid conversationLink")}isImmutable(){return!0}rejectMessageSend(e,t,s){return this._sendRejectedCMID===e&&this.createdTime===t&&(0,p.default)(this._sendRetryInfo,s)?this:new T(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,e,s,t,this._fileEncryptionKeys,this.reported)}applyServerMessage(e){let t=this._unacknowledgedPropSets;if(t){const s=this._getServerMessageForProperties();s&&s.id===e.id&&s.version<e.version&&(t=void 0)}if(d.isPhoneMri(this.conversationId)&&e.properties){const t=l.getSmsDeliveryReport(this.properties),s=l.getSmsDeliveryReport(e.properties);if(!t&&s&&!l.isSmsDeliveredSuccessfully(s)){const e=this.getLatestRelevantClientMessageId();u.track(new m.SmsDeliveryFailed(e,s))}}const s=(this._serverMessages||[]).concat(e);return new T(void 0,s,this._unacknowledgedLies,this._acknowledgedLies,t,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}applyMessageForPostingLie(e){const t=(this._unacknowledgedLies||[]).concat(e);return new T(void 0,this._serverMessages,t,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,void 0,void 0,this.createdTime,this._fileEncryptionKeys,this.reported)}revertMessageForPostingLie(e){const t=i.filter(this._unacknowledgedLies,(t=>t.clientmessageid!==e));if(!(t.length||this._serverMessages&&this._serverMessages.length)){const e={clientmessageid:f.default.newClientMessageId(),content:this.content.substring(0,this.skypeemoteoffset||0),contenttype:this.contenttype,messagetype:this.messagetype,skypeeditedid:this.getOriginalClientMessageId(),composetime:(new Date).toISOString(),cancel:!0};t.push(e)}return new T(void 0,this._serverMessages,t,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}applyPropertyLie(e,t){const s=(this._unacknowledgedPropSets||[]).concat({key:e,value:t});return new T(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,s,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}revertPropertyLie(e,t){const s=i.filter(this._unacknowledgedPropSets,(s=>s.key!==e||s.value!==t));return new T(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,s,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}acknowledgeMessageLie(e,t,s){const o=i.partition(this._unacknowledgedLies,(t=>t.clientmessageid===e)),n=i.last(o[0]);if(!n)return this;const r=Object.assign(Object.assign({},n),{id:t,version:s}),a=(this._acknowledgedLies||[]).concat(r);return new T(void 0,this._serverMessages,o[1],a,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}addFileKeyMaterial(e){return(0,p.default)(e,this._fileEncryptionKeys)?this:new T(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,e,this.reported)}markAsReported(e){return e===this.reported?this:new T(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,e)}clone(){return i.cloneDeep(this)}getMutableClone(){return this.clone()}getUniqueReactions(){const e=l.getCleanedEmotionMetadata(this.properties),t=i.flatten(i.map(e,(e=>i.map(e.users,(t=>({key:e.key,mri:t.mri,time:t.time})))))),s=i.groupBy(t,(e=>e.mri)),o=i.mapValues(s,((e,t)=>i.maxBy(e,(e=>e.time)))),n=i.groupBy(o,(e=>e.key));return i.sortBy(i.map(n,((e,t)=>({key:t,users:e}))),(e=>-e.users.length))}getReactionsAndFilterMri(e){const t=this.getUniqueReactions();let s;for(let o=0;o<t.length;o++)if(i.some(t[o].users,(t=>t.mri===e))){s=t[o].key;break}return{mriReactionKey:s,fullListReactions:t}}hasReactions(){const e=l.getCleanedEmotionMetadata(this.properties);return!i.isEmpty(e)}getReactions(){const e=l.getCleanedEmotionMetadata(this.properties),t=i.flatten(i.map(e,(e=>i.map(e.users,(t=>({key:e.key,mri:t.mri,time:t.time})))))),s=i.groupBy(t,(e=>e.key));return i.orderBy(i.map(s,((e,t)=>({key:t,users:e}))),[e=>-e.users.length,e=>-i.maxBy(e.users,(e=>e.time)).time])}hasUserReactedOnMessage(e){return this.getCleanedEmotionAnnotations().some((t=>t.users.some((t=>t.mri===e))))}isLastChangeScheduledCallMetadata(){return l.isScheduledCallMetadataType(this.messagetype)}isLastChangeReactionConsumptionHorizonUpdate(){if(!this._serverMessages)return!1;const e=this.getLatestServerMessage();if(!e)return!1;const t=this._getCurrentUserReactionConsumptionHorizonFromProperties(e.properties);if(!t)return!1;const s=this._serverMessages[this._serverMessages.length-2];if(s){const e=this._getCurrentUserReactionConsumptionHorizonFromProperties(s.properties);if(e)return e!==t}return!0}isMyMessage(){return 1===this._isMyMessage}_getCurrentUserReactionConsumptionHorizonFromProperties(e){const t=l.getEmotionMetadata(e);if(!t)return;const s=i.find(t,(e=>e.key===l.MessageAnnotations.ReactionsConsumptionHorizon));if(!s)return;const o=i.find(s.users,(e=>g.default.isMyMri(e.mri)));return o?o.time:void 0}_getCurrentUserScheduledCallConsumptionHorizonFromProperties(e){const t=l.getScheduledCallConsumptionHorizons(e);if(!t)return;const s=i.find(t,((e,t)=>g.default.isMyMri(t)));return i.isUndefined(s)?void 0:s}getReactionUpdates(e){const t={added:[],removed:[]},s=i.filter(l.flattenEmotionMetadata(this.getCleanedEmotionAnnotations()),(e=>!g.default.isMyMri(e.mri)));if(!e)return t.added=s,t;const o=i.filter(l.flattenEmotionMetadata(e.getCleanedEmotionAnnotations()),(e=>!g.default.isMyMri(e.mri)));return t.added=i.differenceWith(s,o,i.isEqual),t.removed=i.differenceWith(o,s,i.isEqual),t}hasUrlPreviewMetadata(){return l.getUrlPreviewMetadata(this.properties).length>0}isForwarded(){return l.getForwardMetadata(this.properties).isForwarded}isBookmark(){return d.isBookmarkConversation(this.conversationId)}getBookmarkMetadata(){return l.getBookmarkMetadata(this.properties)}isBookmarkSourceForCurrentUser(){return!!this.getBookmarkSourceMetadataForCurrentUser()}getBookmarkSourceMetadataForCurrentUser(){return l.getBookmarkMetadataForUser(this.properties,g.default.getSkypeMri())}isBookmarkSourceDeletedMessageForCurrentUser(){if(!this._serverMessages)return!1;if(!this.getLatestServerMessage())return!1;const e=this._serverMessages[this._serverMessages.length-2];return!!e&&(this.isDeletedMessage()&&!!l.getBookmarkMetadataForUser(e.properties,g.default.getSkypeMri()))}getBookmarkSourceMetadataForCurrentUserFromPreviousMessage(){if(!this._serverMessages)return;const e=this._serverMessages[this._serverMessages.length-2];return e?l.getBookmarkMetadataForUser(e.properties,g.default.getSkypeMri()):void 0}getUrlPreviewMetadata(e){if(!e)return;const t=l.getUrlPreviewMetadata(this.properties);if(0===t.length)return;const s=e.trim(),o=i.find(t,(e=>e.key.trim()===s));return o?o.value:void 0}getEmotionAnnotations(){return l.getEmotionMetadata(this.properties)}getCleanedEmotionAnnotations(){return l.getCleanedEmotionMetadata(this.properties)}getPollData(){return l.getPollMetadata(this.properties)}getScheduledCallsResponses(){return l.getScheduledCallMetadata(this.properties)}getSuggestedActions(){const e=this.properties?this.properties[l.MessageProperties.SuggestedActions]:void 0;return e?{creator:this.creator,to:e.to,actions:i.map(e.actions,(e=>({botId:this.creator,title:e.title,value:e.value,type:e.type,image:e.image,pageTitle:e.displayText,attributes:e.channelData?e.channelData.telemetryData:void 0})))}:void 0}isEmote(){const e=this.getOriginalServerMessage();return e?Number(e.skypeemoteoffset)>0:(this.skypeemoteoffset||0)>0}isEdited(){return!(!this.properties||!this.properties[l.MessageProperties.EditTime]&&!this.properties[l.MessageProperties.DeleteTime])||(this.isEditLie()||i.some(this._serverMessages,(e=>!!e.skypeeditedid)))}isEditLie(){return!i.isEmpty(this._unacknowledgedLies)&&!!i.last(this._unacknowledgedLies).skypeeditedid||!i.isEmpty(this._acknowledgedLies)&&!!i.last(this._acknowledgedLies).skypeeditedid}isDeletedMessage(){return!(!this.properties||!this.properties[l.MessageProperties.DeleteTime])||l.isDeletedMessage(this)}isAllowedEngagementBotMessage(){const e=n.default.getEngagementFeatures().conciergeBotSettings;return e.enableVisibility&&d.isConciergeBotMri(this.creator)&&-1!==e.allowedRecentMessageTypes.indexOf(this.messagetype)}isTranslationSettings(){return i.includes([l.MessageTypes.TranslationSettings],this.messagetype)&&!!l.getTranslationSettingsMetadata(this.content)}isHiddenTranslationSettingsMessage(){if(!this.isTranslationSettings())return!1;const e=l.getTranslationSettingsMetadata(this.content),t=l.getTranslationSettingsState(this.content);if(e&&void 0!==t){if(e.isUpdate)return!0;if(!i.includes([r.TranslationState.Disabled,r.TranslationState.Enabled],t))return g.default.isMyMri(this.creator)}return!1}isTranslation(){return this.messagetype===l.MessageTypes.Translation}isHiddenInPreviewTranslation(e){return!!this.isTranslation()&&(e?!n.default.getS4LCMCFeaturesNoSubscription().enableMessageTranslation||g.default.isMyMri(this.creator):!g.default.isMyMri(this.creator))}getMessageContentFromServerMessages(){const e=i.find(this._serverMessages,(e=>""!==e.content));return e?e.content:void 0}isDeletedHighlightServerMessage(){return this.isDeletedMessage()&&i.some(this._serverMessages,(e=>l.isHighlightMessageType(e)))}isMutated(){const e=this._getServerMessageForProperties();return e&&e.version>e.id||!i.isEmpty(this._unacknowledgedPropSets)}hasUnseenReactions(){const e=this.getLastReactionTimeExcludingCurrentUser();if(i.isUndefined(e))return!1;return this.getReactionsReadTimeForCurrentUser()<e}isAlbum(){return this.hasAlbumId()&&this.messagetype===l.MessageTypes.MediaAlbum}isAlbumItem(){return this.hasAlbumId()&&this.messagetype!==l.MessageTypes.MediaAlbum}hasAlbumId(){return this.properties&&this.properties[l.MessageProperties.AlbumId]}getAlbumId(){return this.properties&&this.properties[l.MessageProperties.AlbumId]}getBingImageTrackingMetadata(){return this.properties&&this.properties[l.MessageProperties.BingImageTrackingMetadata]}hasBingImageTrackingMetadata(){return this.properties&&this.properties[l.MessageProperties.BingImageTrackingMetadata]}getAlbumIdFromPreviousMessage(){if(!this._serverMessages)return;const e=this._serverMessages[this._serverMessages.length-2];return e&&e.properties?e.properties[l.MessageProperties.AlbumId]:void 0}isUnreconciledEdit(){return!i.isEmpty(this._serverMessages)&&!this.getOriginalServerMessage()}isMessageLie(){return!i.isEmpty(this._unacknowledgedLies)}isPropertyLie(){return!i.isEmpty(this._unacknowledgedPropSets)}isCurrentVersionKnownByServer(){return this.isAnyVersionKnownByServer()&&!this.isMessageLie()&&!this.isPropertyLie()}isAnyVersionKnownByServer(){return!!this._serverMessages&&this._serverMessages.length>0||!!this._acknowledgedLies&&this._acknowledgedLies.length>0}isUnsent(){return!this._isEphemeral&&!this.isAnyVersionKnownByServer()}isEphemeral(){return!!this._isEphemeral}isSendRejected(){return!!this._sendRejectedCMID}getSendRejectedCMID(){return this._sendRejectedCMID}getSendRetryInfo(){return this._sendRetryInfo}isBotHighlightMessage(){return d.isBotHighlightsThread(this.conversationId)&&-1!==this.content.indexOf(d.BotHighlightMessageContent)}isHighlightMessage(){return d.isHighlightsThread(this.conversationId)&&(l.isHighlightMessageType(this)||this.isBotHighlightMessage())}isHighlightFollow(){return!!d.isHighlightsThread(this.conversationId)&&(this.messagetype===l.MessageTypes.AddMember||this.messagetype===l.MessageTypes.DeleteMember||this.messagetype===l.MessageTypes.HighlightsFollow||this.messagetype===l.MessageTypes.HighlightsRemoveFollow||this.messagetype===l.MessageTypes.HighlightsRefuseFollow)}isHighlightFollowRequest(){return!!d.isHighlightsThread(this.conversationId)&&this.messagetype===l.MessageTypes.HighlightsFollow}isHighlightFollowRemove(){return!!d.isHighlightsThread(this.conversationId)&&this.messagetype===l.MessageTypes.HighlightsRemoveFollow}isHighlightFollowAcceptedByOther(){return!!d.isHighlightsThread(this.conversationId)&&(!d.isMyHighlightThread(this.conversationId)&&this.messagetype===l.MessageTypes.AddMember)}isHighlightFollowAcceptedByMe(){return!!d.isHighlightsThread(this.conversationId)&&(d.isMyHighlightThread(this.conversationId)&&this.messagetype===l.MessageTypes.AddMember)}isMessageInEncryptedThread(){return d.isEncryptedThread(this.conversationId)}isMessageInS4BBridgeConversation(){return d.isS4BBridgeMri(this.conversationId)}isE2eeHandshakeTypeAllowedForNotification(){return d.isEncryptedThread(this.conversationId)&&(this.messagetype===l.MessageTypes.HandshakeInvite||this.messagetype===l.MessageTypes.HandshakeAccept||this.messagetype===l.MessageTypes.HandshakeComplete)&&!this._isCurrentUserInitiator()}getLatestRelevantClientMessageId(){const e=i.findLast(this._serverMessages,(e=>this._isContentEdited(e)))||this.getOriginalServerMessage();return e?e.skypeeditedid||e.clientmessageid:void 0}_isContentEdited(e){return!!e.skypeeditedid||!(!e.properties||!e.properties[l.MessageProperties.EditTime]&&!e.properties[l.MessageProperties.DeleteTime])}getLatestServerMessageVersion(){const e=this.getLatestServerMessage();return e&&(e.version||e.id)}getLatestServerMessage(){return i.last(this._serverMessages)}getLatestServerMessageId(){const e=i.findLast(this._serverMessages,(e=>this._isContentEdited(e)));return e&&e.id||this.getOriginalServerId()}getLastReactionTimeExcludingCurrentUser(){const e=this.getCleanedEmotionAnnotations();if(i.isEmpty(e))return;const t=(0,a.chain)(e,(0,a.map)((e=>e.users)),(0,a.flatten)(),(0,a.filter)((e=>!g.default.isMyMri(e.mri))));if(i.isEmpty(t))return;return i.maxBy(t,(e=>e.time)).time}getOriginalClientMessageId(){const e=this.getOriginalServerMessage()||i.head(this._acknowledgedLies)||i.head(this._unacknowledgedLies);return e&&(e.skypeeditedid||e.clientmessageid)}getOriginalServerMessage(){return i.find(this._serverMessages,(e=>!!this._isOriginalConfirmedServerMessage(e)))}_isOriginalConfirmedServerMessage(e){const t=e&&this.messagetype===l.MessageTypes.Call&&e.skypeguid===this.skypeguid;return e&&(d.getCuidForMessage(e)===this.cuid||t)&&!e.skypeeditedid}getOriginalServerId(){const e=this.getOriginalServerMessage()||i.head(this._acknowledgedLies);return e&&e.id}_getServerMessageForProperties(){const e=this.getOriginalServerId();if(e)return i.findLast(this._serverMessages,(t=>t.id===e))}getServerIdForPropertyChanges(){return this.getOriginalServerId()}getCHID(){if(!this.skypeguid)return this.cuid;const e=this.getLatestServerMessage();return e?e.skypeeditedid||e.clientmessageid||e.id:this.getOriginalServerId()}getConsumptionHorizonString(){const e=this.getOriginalServerId();if(!e)return void u.warn(h.LogTraceArea.MessageStream,"getConsumptionHorizonString called on an unreconciled edit");const t=this.getCHID();return i.isUndefined(t)?void 0:d.getConsumptionHorizonForMessageAndCHID(e,t)}getUnacknowledgedClientMessageIds(){return i.map(this._unacknowledgedLies,(e=>e.clientmessageid))}test_getServerMessages(){return this._serverMessages||[]}push_getThreadTopic(){const e=i.maxBy(this._serverMessages,(e=>e.version));return e?e.threadtopic:void 0}push_getSenderDisplayName(){const e=i.maxBy(this._serverMessages,(e=>e.version));return e?e.imdisplayname:void 0}static test_fromFirstServerMessage(e){return T.fromFirstServerMessage(e)}_isTargetingMe(){return null!==this.content.match(`<target>${i.escapeRegExp(g.default.getSkypeMri())}</target>`)}getCountsType(){return this._countsType}countsForUnreadCounts(){if(this.isEphemeral())return!1;if(g.default.isMyMri(this.creator))return!1;if(!this.isShownInStream())return!1;if(this.isUnreconciledEdit())return!1;if((this.messagetype===l.MessageTypes.HandshakeInvite||this.messagetype===l.MessageTypes.HandshakeAccept||this.messagetype===l.MessageTypes.HandshakeReject||this.messagetype===l.MessageTypes.HandshakeComplete)&&this._isTargetingMe())return!0;if(l.isThreadActivityType(this.messagetype))return!1;if(d.isHighlightsThread(this.conversationId)&&!this.isHighlightMessage())return!1;if(l.getMessageTypeGroup(this)===l.MessageTypeGroups.Calling){if(!i.startsWith(this.content,"<partlist"))return!1;if(d.isGroupConversation(this.conversationId)){const e=g.default.getSkypeId();let t;for(;t=C.exec(this.content);)if(t[1]===e)return C.lastIndex=0,!1}else if(-1===this.content.indexOf('type="missed"'))return!1}return!this.hasAlbumId()||this.isAlbum()}countsForReadReceipts(){if(this.isEphemeral())return!1;if(!this.isShownInStream())return!1;if(this.isUnreconciledEdit())return!1;if(l.isThreadActivityType(this.messagetype))return!1;return l.getMessageTypeGroup(this)!==l.MessageTypeGroups.Calling}_countsForHighPriorityUnreadCounts(){const e=this.getMessageNotificationClass();return e===S.MessageNotificationClass.OneOnOne||e===S.MessageNotificationClass.MentionedOrQuoted}getMessageNotificationClass(){let e=S.MessageNotificationClass.Normal;if(n.default.getS4LCMCFeaturesNoSubscription().enableMessageTranslation&&this.isTranslationSettings()&&!this.isHiddenTranslationSettingsMessage())return e;return l.getMessageTypeGroup(this)===l.MessageTypeGroups.System?S.MessageNotificationClass.SystemInformational:(g.default.isMyMri(this.creator)||(this.isCurrentUserMentionedOrQuoted()?e=S.MessageNotificationClass.MentionedOrQuoted:d.isUserMri(this.conversationId)&&(e=S.MessageNotificationClass.OneOnOne)),e)}isShownInStream(){if(this.isDeletedMessage())return!1;if(this.isUnreconciledEdit())return!1;if(this.messagetype===l.MessageTypes.HighlightsFollow||this.messagetype===l.MessageTypes.HighlightsRefuseFollow||this.messagetype===l.MessageTypes.HighlightsRemoveFollow)return!1;const e=l.getMessageTypeGroup(this);return!(e!==l.MessageTypeGroups.Calling||!l.isCallInfoForCallMessageType(this)&&!l.isEventCallStartedMessageType(this))||e!==l.MessageTypeGroups.Engagement&&(e!==l.MessageTypeGroups.Translation&&(this.isTranslationSettings()?!!n.default.getS4LCMCFeaturesNoSubscription().enableMessageTranslation&&!this.isHiddenTranslationSettingsMessage():!this.isCanceledScheduledCall()&&e!==l.MessageTypeGroups.None))}isShownInPreview(e){return(this.isShownInStream()||this.isTranslation())&&!this.isReported()&&!this.isHiddenInPreviewTranslation(e)}isCanceledScheduledCall(){if(!l.isScheduledCallType(this.messagetype))return!1;const e=this.content.match(/canceledTimeMs=/i);return!i.isEmpty(e)}isCurrentUserMentionedOrQuoted(e=!0){return i.some(g.default.getMyMris(),(t=>this._isUserAtMentioned(t,e)||T._testUserIsQuoted(this.content,t)))}isCurrentUserMentioned(e=!0){return i.some(g.default.getMyMris(),(t=>this._isUserAtMentioned(t,e)))}isCurrentUserQuoted(){return i.some(g.default.getMyMris(),(e=>T._testUserIsQuoted(this.content,e)))}_isCurrentUserInitiator(){return i.some(g.default.getMyMris(),(e=>T._testUserIsInitiator(this.content,e)))}_isUserAtMentioned(e,t){const s=t?"?:\\*|":"";return this.messagetype===l.MessageTypes.TeamsHtml?!!i.find(l.getTeamsMentionProperties(this.properties),(t=>t.mri===e)):!!this.content&&null!==this.content.match(`<at id="(${s}${i.escapeRegExp(e)})">.*?</at>`)}static _testUserIsInitiator(e,t){return!!e&&null!==e.match(`.+initiator>${i.escapeRegExp(t)}</.+`)}static _testUserIsQuoted(e,t){const s=d.getSkypeIdFromMri(t);if(!s||!e)return!1;let i,o=!1;for(;(i=_.exec(e))&&!o;){const e=i[1];let t;for(;(t=b.exec(e))&&!o;)o=3===t.length&&"author"===t[1]&&t[2]===s}return b.lastIndex=0,_.lastIndex=0,o}isReactionRead(){const e=this.getLastReactionTimeExcludingCurrentUser();if(i.isUndefined(e))return!0;const t=this.getReactionsReadTimeForCurrentUser()||0;return!!e&&e<=t}getReactionsReadTimeForCurrentUser(){const e=this._getCurrentUserReactionConsumptionHorizonFromProperties(this.properties);return i.isUndefined(e)?0:e}getScheduledCallReadTimeForCurrentUser(){const e=this._getCurrentUserScheduledCallConsumptionHorizonFromProperties(this.properties);return i.isUndefined(e)?0:e}getFileEncryptionKeys(){return this._fileEncryptionKeys}isKnownServerMessageVersion(e){return i.some(this._serverMessages,(t=>t.version===e))}isMergingBotHighlightMessageLocal(e){return d.isAgent(e)&&-1!==this.content.indexOf(d.BotHighlightMessageContent)}getAcknowledgedLies(){return this._acknowledgedLies}isReported(){return!!this.reported}isEmoticonCallReaction(){return void 0!==this.getEmoticonCallReactionKey()}getEmoticonCallReactionKey(){const e=/^<ss type=\"(.*)\">\(([^\(]*)\)<\/ss><c_i/g.exec(this.content),t=/^\((flag_.*)\)<c_i/g.exec(this.content);return e&&e.length>2?e[2]:t?t[1]:void 0}}t.default=T},25759:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChatServicePresenceRequestFactory=void 0;const i=s(496486),o=s(662783),n=s(671830),r=s(395271);class a extends r.PresenceRequestFactory{getPriority(e){return r.PresenceServiceType.ChatService}getServiceType(){return r.PresenceServiceType.ChatService}getMyPresenceStatus(e){return{request:r.PresenceRequestFactory._createRequest("GET","v1/users/ME/presenceDocs/messagingService",e,"getMyPresenceStatus"),responseConverter:e=>e&&n.parseStatus(e.status)}}setMyPresenceStatus(e,t){const s={status:n.encodeStatus(t)};return{request:r.PresenceRequestFactory._createRequest("PUT","v1/users/ME/presenceDocs/messagingService",e,"setMyPresenceStatus",s),responseConverter:()=>t}}getCurrentPresenceForMris(e){const t="v1/users/ME/contacts/ALL/presenceDocs/messagingService?"+i.map(e,(e=>"cMri="+e)).join("&");return{request:r.PresenceRequestFactory._createRequest("GET",t,void 0,"getCurrentPresenceForMris"),responseConverter:e=>{const t={};return i.each(e&&e.Responses||[],(e=>{t[e.Contact]=e.Payload})),t}}}setActiveEndpointTimeout(e,t){const s=`v1/users/ME/endpoints/${e}/active`;return r.PresenceRequestFactory._createRequest("POST",s,e,"setActiveEndpointTimeout",{timeout:t},{timeout:6e4,priority:o.WebRequestPriority.Critical,requirePresenceDocPublished:!0})}}t.ChatServicePresenceRequestFactory=a},765369:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deleteConnectors=t.e2eeReject=t.e2eeConfirm=t.e2eeAccept=t.e2eeInvite=t.getMemberConsumptionHorizons=t.deleteConversation=t.deleteMessage=t.editMessage=t.setMessageProperty=t.postMessageToConversation=t.getConversationMessage=t.getMyConversations=t.pollSubscription=t.updateSubscriptionProperty=t.deleteSubscription=t.createSubscription=t.getEndpointPresenceDoc=t.publishEndpointPresence=t.clearEndpoint=t.deleteEndpoint=t.updateEndpoint=t.createEndpoint=t.enumerateEndpoints=t.getWebhookUrl=t.invokeAgentRequest=t.addNewContact=t.setThreadProperty=t.getThread=t.removeMemberFromThread=t.addMembersToThread=t.addMemberToThread=t.createThread=t.setMyUserRing=t.setMyProperty=t.getMyProperties=t.calcMessageViewParam=t.calcMessagesViewParam=t.calcThreadViewParam=t.calcConvViewParam=t.CSRequestScenarios=void 0;const i=s(496486),o=s(662783),n=s(889391),r=s(351077),a=s(890239),l=s(671830),d=s(478262),c=s(626712);function h(){return i.compact(["supportsExtendedHistory","msnp24Equivalent"]).join("|")}function u(){return"msnp24Equivalent"}function p(){return i.compact(["msnp24Equivalent","supportsMessageProperties"]).join("|")}function g(e,t){return{method:"PUT",path:"v1/users/ME/properties?name="+encodeURIComponent(e),passedData:{[e]:t},scenario:"setMyProperty"}}t.CSRequestScenarios={createEndpoint:"createEndpoint",updateEndpoint:"updateEndpoint",updateSubscription:"updateSubscription",deleteSubscription:"deleteSubscription",postMessageToConversation:"postMessageToConversation",userComposingState:"userComposingState",navigateToChat:"navigateToChat"},t.calcConvViewParam=h,t.calcThreadViewParam=u,t.calcMessagesViewParam=function(){return i.compact(["supportsExtendedHistory","msnp24Equivalent","supportsMessageProperties"]).join("|")},t.calcMessageViewParam=p,t.getMyProperties=function(){return{method:"GET",path:"v1/users/ME/properties",scenario:"getMyProperties"}},t.setMyProperty=g,t.setMyUserRing=function(e){return g(l.ServerUserProps.UserRing,e)},t.createThread=function(e,t,s,o={}){return t&&(o[l.ThreadProps.TopicName]=t),s&&(o[l.ThreadProps.IsSticky]=!0,o[l.ThreadProps.ThreadType]="Chat"),{method:"POST",path:"v1/threads",passedData:{members:i.map(e,((e,t)=>({id:t,role:e===d.ThreadMemberAccessType.Admin?a.ThreadMemberRoles.Admin:a.ThreadMemberRoles.User}))),properties:o},scenario:"createThread"}},t.addMemberToThread=function(e,t,s=!0){return{method:"PUT",path:"v1/threads/"+encodeURIComponent(e)+"/members/"+t,passedData:{role:s?a.ThreadMemberRoles.Admin:a.ThreadMemberRoles.User},scenario:"addMemberToThread",mriForTelemetry:e}},t.addMembersToThread=function(e,t){return{method:"POST",path:"v1/threads/"+encodeURIComponent(e)+"/members",passedData:{members:i.map(t,((e,t)=>({id:t,role:e===d.ThreadMemberAccessType.Admin?a.ThreadMemberRoles.Admin:a.ThreadMemberRoles.User})))},scenario:"addMembersToThread",mriForTelemetry:e}},t.removeMemberFromThread=function(e,t){return{method:"DELETE",path:"v1/threads/"+encodeURIComponent(e)+"/members/"+t,scenario:"removeMemberFromThread",mriForTelemetry:e}},t.getThread=function(e){return{method:"GET",path:"v1/threads/"+encodeURIComponent(e)+"?view="+encodeURIComponent("msnp24Equivalent"),scenario:"getThread",mriForTelemetry:e}},t.setThreadProperty=function(e,t,s){return{method:"PUT",path:"v1/threads/"+encodeURIComponent(e)+"/properties?name="+encodeURIComponent(t),passedData:{[t]:s},scenario:"setThreadProperty",mriForTelemetry:e}},t.addNewContact=function(e){const t="v1/users/ME/contacts/"+e;return{method:"PUT",path:t,passedData:t,scenario:"addNewContact",mriForTelemetry:e}},t.invokeAgentRequest=function(e,t,s,i){return{method:"POST",path:"v1/agents/"+encodeURIComponent(e)+"/invoke",passedData:{conversation:{id:t},value:s,name:i},scenario:"invokeAgentRequest",mriForTelemetry:e}},t.getWebhookUrl=function(e,t){return{method:"POST",path:"v1/threads/"+encodeURIComponent(e)+"/integrations",passedData:t,scenario:"getWebhookUrl"}},t.enumerateEndpoints=function(){return{path:"v1/users/ME/endpoints",method:"GET",timeout:6e4,priority:o.WebRequestPriority.Normal,scenario:"enumerateEndpoints",isV1OnlyRequest:!0}},t.createEndpoint=function(e){return{path:"v1/users/ME/endpoints",method:"POST",passedData:{endpointFeatures:e},timeout:6e4,priority:o.WebRequestPriority.Critical,scenario:t.CSRequestScenarios.createEndpoint,isLogin:!0,isV1OnlyRequest:!0}},t.updateEndpoint=function(e,s){return{path:"v1/users/ME/endpoints/"+e,method:"PUT",passedData:{endpointFeatures:s},timeout:6e4,priority:o.WebRequestPriority.Critical,endpointId:e,scenario:t.CSRequestScenarios.updateEndpoint,isLogin:!0,isV1OnlyRequest:!0}},t.deleteEndpoint=function(e){return{path:"v1/users/ME/endpoints/"+e,method:"DELETE",timeout:6e4,priority:o.WebRequestPriority.Critical,endpointId:e,scenario:"deleteEndpoint",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.clearEndpoint=function(e){return{method:"PUT",path:"v1/users/ME/endpoints/"+e,passedData:{},endpointId:e,scenario:"clearEndpoint",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.publishEndpointPresence=function(e,t){return{method:"PUT",path:"v1/users/ME/endpoints/"+e+"/presenceDocs/messagingService",passedData:t,endpointId:e,timeout:6e4,scenario:"publishEndpointPresence",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.getEndpointPresenceDoc=function(e){return{method:"GET",path:"v1/users/ME/endpoints/"+e+"/presenceDocs/messagingService",endpointId:e,timeout:6e4,scenario:"getEndpointPresenceDoc",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.createSubscription=function(e,t){return{method:"POST",path:"v1/users/ME/endpoints/"+e+"/subscriptions",passedData:t,endpointId:e,scenario:"createSubscription",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.deleteSubscription=function(e,s){return{method:"DELETE",path:"v1/users/ME/endpoints/"+e+"/subscriptions/"+encodeURIComponent(s),endpointId:e,scenario:t.CSRequestScenarios.deleteSubscription,requiresEndpoint:!0,isV1OnlyRequest:!0}},t.updateSubscriptionProperty=function(e,t,s,i){return{method:"PUT",path:"v1/users/ME/endpoints/"+e+"/subscriptions/"+encodeURIComponent(t)+"?name="+encodeURIComponent(s),passedData:{[s]:i},endpointId:e,scenario:"updateSubscriptionProperty",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.pollSubscription=function(e,t,s){let i="v1/users/ME/endpoints/"+encodeURIComponent(e)+"/subscriptions/"+encodeURIComponent(t)+"/poll";return void 0!==s&&(i+="?ackId="+s),{method:"POST",path:i,endpointId:e,timeout:9e4,priority:o.WebRequestPriority.Critical,scenario:"pollSubscription",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.getMyConversations=function(e="All",t=1,s,i=100){let o="v1/users/ME/conversations?view="+encodeURIComponent(h());return o+="&pageSize="+Math.min(i,100),s?o+="&syncState="+encodeURIComponent(s):(o+="&startTime="+t,null!=e&&(o+="&targetType="+encodeURIComponent(e))),{method:"GET",path:o,scenario:"getMyConversations"}},t.getConversationMessage=function(e,t){return{method:"GET",path:"v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t)+"?view="+encodeURIComponent(p()),scenario:"getConversationMessage",mriForTelemetry:e}},t.postMessageToConversation=function(e,s,i=t.CSRequestScenarios.postMessageToConversation,r){let a="v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages";return a=c.default.addUrlParameter(a,"x-ecs-etag",encodeURIComponent(n.default.getCachedEcsConfigEtag()),!0),{method:"POST",path:a,passedData:s,priority:n.default.getS4LMessagingFeaturesNoSubscription().textSendWithCriticalPriority?o.WebRequestPriority.Critical:o.WebRequestPriority.High,scenario:i,mriForTelemetry:e,counterPartyMri:r}},t.setMessageProperty=function(e,t,s,i,o=!1){let a="v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t)+"/properties?name="+encodeURIComponent(s);return o||s!==r.MessageProperties.Emotions||(a=c.default.addUrlParameter(a,"x-ecs-etag",encodeURIComponent(n.default.getCachedEcsConfigEtag()),!0)),{method:o?"DELETE":"PUT",path:a,passedData:{[s]:i},scenario:"setMessageProperty",mriForTelemetry:e}},t.editMessage=function(e,t,s,i){return{method:"PUT",path:"v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t),passedData:{messagetype:s,content:i},scenario:"editMessage",mriForTelemetry:e}},t.deleteMessage=function(e,t){return{method:"DELETE",path:"v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t),scenario:"deleteMessage",mriForTelemetry:e}},t.deleteConversation=function(e){return{method:"DELETE",path:"v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages",scenario:"deleteConversation",mriForTelemetry:e}},t.getMemberConsumptionHorizons=function(e){return{method:"GET",path:"v1/threads/"+encodeURIComponent(e)+"/consumptionhorizons",scenario:"consumptionhorizons"}},t.e2eeInvite=function(e,t,s,i){return{method:"POST",path:"v1/e2ee/v1/invite",passedData:{DeviceId:e,KeyBundle:JSON.stringify(t),InviteeId:s,ThreadId:i},scenario:"e2eeInvite"}},t.e2eeAccept=function(e,t,s){return{method:"PUT",path:"v1/e2ee/v1/invite/"+t,passedData:{DeviceId:e,KeyBundle:JSON.stringify(s)},scenario:"e2eeAccept"}},t.e2eeConfirm=function(e){return{method:"PUT",path:"v1/e2ee/v1/invite/"+e,passedData:{},scenario:"e2eeConfirm"}},t.e2eeReject=function(e){return{method:"DELETE",path:"v1/e2ee/v1/invite/"+e,scenario:"e2eeReject"}},t.deleteConnectors=function(e,t){return{method:"DELETE",path:"v1/threads/"+e+"/integrations/"+t,scenario:"deleteConnectors"}}},213960:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDeviceName=t.getDeviceType=t.toAvailabilityString=t.fromUpsAvailabilityAndActivityEnum=t.fromUpsAvailabilityAndActivityString=t.toUpsUserAvailability=void 0;const i=s(496486),o=s(890239),n=s(746096),r=s(436237),a=s(328575),l=s(853374);function d(e,t){switch(e){case a.Availability.PresenceUnknown:return o.UserStatus.Unknown;case a.Availability.Available:return o.UserStatus.Online;case a.Availability.AvailableIdle:return o.UserStatus.Idle;case a.Availability.Busy:case a.Availability.BusyIdle:case a.Availability.DoNotDisturb:return o.UserStatus.Busy;case a.Availability.BeRightBack:return o.UserStatus.BeRightBack;case a.Availability.Away:return o.UserStatus.Away;case a.Availability.Offline:return t===a.Activity.OffWork?o.UserStatus.Hidden:o.UserStatus.Offline;default:return r.warn(n.LogTraceArea.Presence,`UPS user availability not supported: ${e}`),o.UserStatus.Unknown}}t.toUpsUserAvailability=function(e){switch(e){case o.UserStatus.Offline:return"Offline";case o.UserStatus.Online:return"Available";case o.UserStatus.Busy:return"Busy";case o.UserStatus.Away:return"Away";case o.UserStatus.Idle:return"AvailableIdle";case o.UserStatus.OnThePhone:return"Busy";case o.UserStatus.OutToLunch:return"Away";case o.UserStatus.BeRightBack:return"BeRightBack";case o.UserStatus.Hidden:return"Offline";case o.UserStatus.Unknown:return"PresenceUnknown";default:return l.default.switchStatementExhaustiveChecking(e)}},t.fromUpsAvailabilityAndActivityString=function(e,t){return d(e&&a.Availability[e],t&&a.Activity[t])},t.fromUpsAvailabilityAndActivityEnum=d,t.toAvailabilityString=function(e){switch(i.isString(e)&&void 0!==e?a.Availability[e]:e){case a.Availability.Offline:case a.Availability.PresenceUnknown:case void 0:return"Offline";default:return"Online"}},t.getDeviceType=function(){return a.DeviceType.Web},t.getDeviceName=function(){return"desktop"}},395271:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PresenceRequestFactory=t.PresenceServiceType=void 0,function(e){e[e.ChatService=1]="ChatService",e[e.UPS=2]="UPS"}(t.PresenceServiceType||(t.PresenceServiceType={}));t.PresenceRequestFactory=class{static _createRequest(e,t,s,i,o,n={}){return Object.assign({method:e,path:t,passedData:o,endpointId:s,scenario:i,timeout:6e4,requiresEndpoint:Boolean(s),isV1OnlyRequest:!0},n)}}},535426:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shouldRecreateEndpoint=t.UpsPresenceRequestFactory=void 0;const i=s(481169),o=s(890239),n=s(671830),r=s(213960),a=s(395271),l="v1/me/presence",d="v1/me/forceavailability",c="v1/presence/getpresence",h="v1/me/reportmyactivity",u="v1/me/endpoints",p=e=>`v1/me/endpoints/${m(e)}`,g=e=>`v1/pubsub/subscriptions/${m(e)}`;function m(e){return n.formatEndpointIdRemoveBrackets(e)}class S extends a.PresenceRequestFactory{getPriority(e){return e?0:a.PresenceServiceType.UPS}getServiceType(){return a.PresenceServiceType.UPS}getMyPresenceStatus(e){return{request:a.PresenceRequestFactory._createRequest("GET",l,m(e),"getMyPresenceStatus"),responseConverter:e=>r.fromUpsAvailabilityAndActivityString(e&&e.availability,e&&e.activity)}}setMyPresenceStatus(e,t){const s=this._buildSetMyPresenceStatusPayload(t);return{request:a.PresenceRequestFactory._createRequest("PUT",d,m(e),"setMyPresenceStatus",s),responseConverter:()=>t}}_buildSetMyPresenceStatusPayload(e){return e===o.UserStatus.Hidden?{availability:r.toUpsUserAvailability(e),activity:"OffWork"}:{availability:r.toUpsUserAvailability(e)}}getCurrentPresenceForMris(e){const t=e.map((e=>({mri:e})));return{request:a.PresenceRequestFactory._createRequest("POST",c,void 0,"getCurrentPresenceForMris",t),responseConverter:e=>(0,i.chain)(e,(0,i.filter)((e=>Boolean(e.mri))),(0,i.map)((e=>{var t,s,i,o;return{mri:e.mri,availability:r.toAvailabilityString(null===(t=e.presence)||void 0===t?void 0:t.availability),selfLink:"",lastSeenAt:(null===(s=e.presence)||void 0===s?void 0:s.lastActiveTime)||"",status:n.encodeStatus(r.fromUpsAvailabilityAndActivityString(null===(i=e.presence)||void 0===i?void 0:i.availability,null===(o=e.presence)||void 0===o?void 0:o.activity))||"Unknown"}})),(0,i.keyBy)((e=>e.mri)))}}setActiveEndpointTimeout(e,t){const s={endpointId:m(e),isActive:t};return a.PresenceRequestFactory._createRequest("POST",h,m(e),"setActiveEndpointTimeout",s)}static updateEndpoint(e,t){const s={id:m(e),deviceType:r.getDeviceType(),activityReporting:t};return a.PresenceRequestFactory._createRequest("PUT",u,m(e),"updateEndpoint",s)}static deleteEndpoint(e){return a.PresenceRequestFactory._createRequest("DELETE",p(e),m(e),"deleteEndpoint")}static createSubscription(e,t,s){const i={trouterUri:s+"/ups",shouldPurgePreviousSubscriptions:!0,subscriptionsToAdd:t.map((e=>({mri:e}))),subscriptionsToRemove:[]};return a.PresenceRequestFactory._createRequest("POST",g(e),m(e),"createSubscription",i)}}t.UpsPresenceRequestFactory=S,t.shouldRecreateEndpoint=function(e){var t;return null===(t=e.url)||void 0===t?void 0:t.endsWith(h)}},247477:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTranslationActionString=t.getLegacyMemberUpgradedNodeLocalizeInfo=t.getLegacyMemberAddedNodeLocalizeInfo=t.getJoiningEnabledUpdateNodeLocalizeInfo=t.getHistoryDisclosedUpdateLocalizeInfo=t.getPictureUpdateNodeLocalizeInfo=t.getHandshakeAcceptNodeLocalizedInfo=t.getHandshakeInviteNodeLocalizedInfo=t.getTopicUpdateNodeLocalizeInfo=t.getRoleUpdateNodeLocalizeInfo=t.renderBotDisclosureParts=t.getAddMemberLocalizeInfo=t.getDeleteMemberNodeLocalizeInfo=t.getThreadActivityMemberParts=t.getContactInfo=t.trimToFirstLineIfNeeded=t.TransformerBase=void 0;const i=s(496486),o=s(598925),n=s(351077),r=s(733754);t.TransformerBase=class{_renderPlainText(e,t){const s=e.split(/\r\n|\n|\r|\f|\x0b|\x85|\u2028|\u2029/);return this._renderLineBreakBetweenLines(s,t)}_renderSingleLine(e,t){return{value:e,stopProcessing:!1,renderAsInline:!0}}_renderLineBreak(e){return{value:"\r",stopProcessing:!1,renderAsInline:!0}}_renderLineBreakBetweenLines(e,t){if(!i.isArray(e))return{value:e,stopProcessing:!1,renderAsInline:!0};const s=e;let o=!1;const n=[];i.each(s,((e,i)=>{if(e||1===s.length){const s=this._renderSingleLine(e,t);if(s.stopProcessing)return o=!0,!1;n.push(s.value)}if(i<s.length-1){const e=this._renderLineBreak(t);if(e.stopProcessing)return o=!0,!1;n.push(e.value)}return!0}));return{value:1===n.length?n[0]:n,stopProcessing:o,renderAsInline:!0}}_renderLineBreakBetweenElements(e,t){if(!i.isArray(e))return e;const s=e;let o=!1;const n=[];i.each(s,((e,i)=>{if(e.value||1===s.length){if(e.stopProcessing)return o=!0,!1;n.push(e.value)}if(i<s.length-1){const e=this._renderLineBreak(t);if(e.stopProcessing)return o=!0,!1;n.push(e.value)}return!0}));return{value:1===n.length?n[0]:n,stopProcessing:o,renderAsInline:!0}}},t.trimToFirstLineIfNeeded=function(e,t){let s=e,i=!1;return t&&(s=e.split(/[\r\n]/)[0],i=s.length<e.length),{value:s,stopProcessing:i,renderAsInline:!0}},t.getContactInfo=function(e){let t;return e.fullName&&e.skypeId?t=r.getString("ContentToDisplayTransformerBase.ContactInfo",{fullName:e.fullName,skypeId:e.skypeId}):e.fullName?t=e.fullName:e.skypeId&&(t=r.getString("ContentToDisplayTransformerBase.ContactInfoOnlySkypeId",{skypeId:e.skypeId})),t},t.getThreadActivityMemberParts=function(e,t){const s=e.getRawText(),o=i.reject(t,(e=>e.getRawText()===s)),n=i.map(o,(e=>e.getRawText()));return{authorMri:s,personMris:n}},t.getDeleteMemberNodeLocalizeInfo=function(e,t,s){return i.isUndefined(e)?{key:"ContentToDisplayTransformerBase.RemovedGuestFromConversationMessage",params:{person:t}}:s?{key:"ContentToDisplayTransformerBase.RemovedFromConversationMessage",params:{initiator:e,person:t}}:{key:"ContentToDisplayTransformerBase.RemovedSelfFromConversationMessage",params:{initiator:e}}},t.getAddMemberLocalizeInfo=function(e,t,s){return s?{key:"ContentToDisplayTransformerBase.AddedToConversationMessage",params:{initiator:e,person:t}}:{key:"ContentToDisplayTransformerBase.JoinConversationMessage",params:{initiator:e}}},t.renderBotDisclosureParts=function(e,t){const s=[];return i.each(e,(e=>{s.push.apply(s,r.getParts("ContentToDisplayTransformerBase.BotReceivesAllContentText",{botName:e})),s.push("\n")})),i.each(t,(e=>{let t="ContentToDisplayTransformerBase.BotReceivesAtMentionMessagesText";e.isMagicBot&&e.isMe?t="ContentToDisplayTransformerBase.MagicBotReceivesAtMentionMessagesForMeText":e.isMagicBot&&(t="ContentToDisplayTransformerBase.MagicBotReceivesAtMentionMessagesText"),s.push.apply(s,r.getParts(t,{botName:e.botName,atMentionBotName:e.atMentionBotName})),s.push("\n")})),s},t.getRoleUpdateNodeLocalizeInfo=function(e,t,s){return i.isEmpty(t)?{key:"ContentToDisplayTransformerBase.RoleUpdateSelfMessage",params:{initiator:e,role:s}}:{key:"ContentToDisplayTransformerBase.RoleUpdateMessage",params:{initiator:e,person:t,role:s}}},t.getTopicUpdateNodeLocalizeInfo=function(e,t){return{key:"ContentToDisplayTransformerBase.TopicUpdateMessage",params:{initiator:e,topic:t}}},t.getHandshakeInviteNodeLocalizedInfo=function(e,t){return t?{key:"ContentToDisplayTransformerBase.E2eeInvitationSent",params:{BParty:e}}:{key:"ContentToDisplayTransformerBase.E2eeInvitationReceived",params:{AParty:e}}},t.getHandshakeAcceptNodeLocalizedInfo=function(e,t){return t?{key:"ContentToDisplayTransformerBase.E2eeInvitationAccepted",params:{AParty:e}}:{key:"ContentToDisplayTransformerBase.E2eeInvitationGotAccepted",params:{BParty:e}}},t.getPictureUpdateNodeLocalizeInfo=function(e){return{key:"ContentToDisplayTransformerBase.PictureUpdateMessage",params:{initiator:e}}},t.getHistoryDisclosedUpdateLocalizeInfo=function(e,t){return t?{key:"ContentToDisplayTransformerBase.HistoryDisclosedUpdateMessage",params:{initiator:e}}:{key:"ContentToDisplayTransformerBase.HistoryHiddenUpdateMessage",params:{initiator:e}}},t.getJoiningEnabledUpdateNodeLocalizeInfo=function(e,t){return t?{key:"ContentToDisplayTransformerBase.JoiningEnabledUpdateMessage",params:{initiator:e}}:{key:"ContentToDisplayTransformerBase.JoiningDisabledUpdateMessage",params:{initiator:e}}},t.getLegacyMemberAddedNodeLocalizeInfo=function(e,t){return{key:"ContentToDisplayTransformerBase.LegacyMemberAddedMessage",params:{initiator:e,link:t}}},t.getLegacyMemberUpgradedNodeLocalizeInfo=function(e){return{key:"ContentToDisplayTransformerBase.LegacyMemberUpgradeMessage",params:{initiator:e}}},t.getTranslationActionString=function(e){switch(n.getTranslationSettingsState(e)){case o.TranslationState.Enabled:return r.getString("ContentToDisplayTransformerBase.TranslationsEnabledMessage");case o.TranslationState.Pending:return r.getString("ContentToDisplayTransformerBase.TranslationsRequestedMessage");case o.TranslationState.Cancelled:return r.getString("ContentToDisplayTransformerBase.TranslationRequestCancelled");case o.TranslationState.Declined:return r.getString("ContentToDisplayTransformerBase.TranslationRequestDeclined");case o.TranslationState.Disabled:default:return r.getString("ContentToDisplayTransformerBase.TranslationsDisabledMessage")}}},297297:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderHtml=t.ContentToHtmlTransformer=void 0;const i=s(247915),o=s(823719),n=s(496486),r=s(265976),a=s(898278),l=s(681959),d=s(816402),c=s(770891),h=s(746096),u=s(17213),p=s(436237),g=s(733754),m=s(404057),S=s(311010),f=s(478262),y=`font-family: ${S.default.fontFamily.uidDisplayRegular}; 'font-weight: ${a.FontWeight.regular}; color: #252423`;class v extends l.ContentToTextTransformer{transformRootNode(e){const t=super.transformRootNode(e);if(t.value){const e=`<div style="${y}">${t.value}</div>`;return n.assign({},t,{value:e})}return t}transformQuoteNode(e){if(this._options.trimToFirstLine&&this._options.onlyQuotedContent||this._options.processing.quotes===c.ProcessingLevel.None||this._options.processing.quotes===c.ProcessingLevel.Stripped)return super.transformQuoteNode(e);const t=this._default(e),s=1e3*e.timestamp;return{value:`[${d.default.getDisplayDateStringFull(s)}] ${e.getAuthorNameWithFallbackUnescaped()}:<blockquote style="background-color: rgba(37,36,35,0.05); border-left-color: #e1dfdd; border-left-style: solid; border-left-width: 4px; padding: 8px">${t.value}</blockquote>`,stopProcessing:t.stopProcessing}}transformHtmlNode(e){const t=this._transformHtmlDom(n.cloneDeep(e.getHtmlDom()),!1),s=o.DomUtils.getOuterHTML(t,{decodeEntities:!1,xmlMode:!0}),i=this._renderTextNodes(e.children,this._options.lineBreakString);return{value:s+i.value,stopProcessing:i.stopProcessing}}_transformHtmlDom(e,t){return n.map(e,(e=>{let s=e;return"tag"===e.type&&("img"===e.name&&e.attribs&&e.attribs.itemtype===u.SemanticObjectSchemas.amsImage?s=this._createAmsFallbackLink(e):(e.attribs&&"copy-paste-table"===e.attribs.class||t&&("td"===e.name||"th"===e.name))&&(s=this._annotateCopyPasteTable(e),t=!0)),s.children&&(s.children=this._transformHtmlDom(s.children,t)),s}))}_createAmsFallbackLink(e){const t=r.getDocumentId(e.attribs&&e.attribs.src||"");if(t){const s=r.getDocumentUrls(t,f.UploadFileType.Picture).fallback,n=new i.Text(g.getString("InputEntity.SharedPhotoFallbackText")),a=new i.Text(s),l=new i.Element("a",{href:s}),d=new i.Element("div",{});return o.DomUtils.appendChild(l,a),o.DomUtils.appendChild(d,n),o.DomUtils.appendChild(d,l),o.DomUtils.replaceElement(e,d),d}return e}_annotateCopyPasteTable(e){const t=n.clone(e);return t.attribs?delete t.attribs.class:t.attribs={},t.attribs.style="td"===e.name||"th"===e.name?"padding: 4pt; border: solid 1px rgba(22,35,58,0.36)":"border: solid 1px rgba(22,35,58,0.36); background-color: #fff; color: #252423; border-collapse: collapse",e}}t.ContentToHtmlTransformer=v,t.renderHtml=function(e,t={}){try{const s=n.defaults(t,{utfFallback:t.utfFallback||!1,onlyQuotedContent:e&&e.hasOnlyQuotedContent&&e.hasOnlyQuotedContent(),processing:t.processing||{},lineBreakString:"<br/>"}),i=new v(s);return i.transform(e).value||""}catch(e){p.error(h.LogTraceArea.GenericUnsafe,"ContentToHtmlTransformer: Failed to transform tree: "+m.default.errorAsString(e))}return""}},333372:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toEntities=t.ContentToImBackTransformer=void 0;const i=s(496486),o=s(481169),n=s(681959),r=s(497174),a=s(853374);class l{constructor(){this.transformRootNode=this._default,this.transformUnknownNode=this._default,this.transformHighlightedNode=this._default,this.transformEditMessageMetaDataNode=this._default,this.transformAtMentionNode=this._default,this.transformUserMriNode=this._default,this.transformEmoticonNode=this._default,this.transformFlagNode=this._default,this.transformQuoteNode=this._toEmptyEntity,this.transformLegacyQuoteNode=this._toEmptyEntity,this.transformWikiMarkupNode=this._default,this.transformListWikiMarkupNode=this._default,this.transformLinkNode=this._default,this.transformBingResponseNode=this._default,this.transformAttributionNode=this._default,this.transformAttributionsTextNode=this._default,this.transformAttributionsGroupNode=this._default,this.transformSuggestedTextHighlightNode=this._default,this.transformRosterContextNode=this._default,this.transformLocationContextNode=this._default,this.transformPollNode=this._default,this.transformCallerIDNode=this._default,this.transformTranslationNode=this._default,this.transformHtmlNode=this._default}_default(e){return(0,o.chain)(e.children,(0,o.map)((e=>e&&e.accept(this))),(0,o.compact)(),(0,o.flatten)())}_toUnhandledEntity(e,t){return i.isString(t)||(t=n.renderText(e)),[new r.UnhandledEntity(t)]}_toEmptyEntity(){return[new r.UnhandledEntity("")]}transform(e){return e.accept(this)}transformPlainTextNode(e){return this._toUnhandledEntity(e,e.getRawText())}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformEmoteNode(e){return[new r.UnhandledEntity(a.default.unescapeXml(e.escapedFallbackText))]}transformContextNode(e){return[new r.ContextEntity(e.encodedAttr())]}}t.ContentToImBackTransformer=l,t.toEntities=function(e){return(new l).transform(e)}},881632:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toEntities=t.ContentToInputEntityTransformer=void 0;const i=s(496486),o=s(481169),n=s(681959),r=s(497174),a=s(853374);class l{constructor(e){this._capabilities=e,this.transformRootNode=this._default,this.transformHighlightedNode=this._default,this.transformEditMessageMetaDataNode=this._default,this.transformUserMriNode=this._default,this.transformFlagNode=this._toUnhandledEntity,this.transformLegacyQuoteNode=this._default,this.transformBingResponseNode=this._default,this.transformAttributionsTextNode=this._default,this.transformAttributionsGroupNode=this._default,this.transformContextNode=this._toUnhandledEntity,this.transformRosterContextNode=this._toUnhandledEntity,this.transformLocationContextNode=this._toUnhandledEntity,this.transformSuggestedTextHighlightNode=this._toUnhandledEntity,this.transformUnknownNode=this._default,this.transformSwiftNode=this._default,this.transformPollNode=this._default,this.transformCallerIDNode=this._default,this.transformTranslationNode=this._default,this.transformHtmlNode=this._default}_default(e){return(0,o.chain)(e.children,(0,o.map)((e=>e&&e.accept(this))),(0,o.compact)(),(0,o.flatten)())}_toUnhandledEntity(e,t){return i.isString(t)||(t=n.renderText(e)),[new r.UnhandledEntity(t)]}transform(e){return e.accept(this)}transformPlainTextNode(e){return this._toUnhandledEntity(e,e.getRawText())}transformAtMentionNode(e){var t;let s=null===(t=e.children[0])||void 0===t?void 0:t.getRawText();return e.isAllMention()&&(s=e.getLocalizedAllMention()),[new r.AtMentionEntity(s,e.id,void 0,void 0,e.itemid)]}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformEmoticonNode(e){return this._capabilities.supportEmoticons?[new r.EmoticonEntity(n.renderText(e),e.type,e.tone)]:this._toUnhandledEntity(e)}transformQuoteNode(e){return[new r.QuoteEntity(e)]}transformWikiMarkupNode(e){const t=this._default(e),s=a.default.unescapeXml(e.rawPre),i=e.rawPost&&a.default.unescapeXml(e.rawPost);return[new r.WikiMarkupEntity(t,e.getTag(),s,i)]}transformListWikiMarkupNode(e){return this.transformWikiMarkupNode(e)}transformEmoteNode(e){return[new r.EmoteEntity(e)]}transformLinkNode(e){if(this._capabilities.supportLinkEntity){const t=e.children.length>0?e.children[0].getRawText():e.getSanitizedHref();return[new r.LinkEntity(t,e.getSanitizedHref())]}return this._toUnhandledEntity(e)}transformAttributionNode(e){var t;if(this._capabilities.supportLinkEntity){const s=null===(t=e.children[0])||void 0===t?void 0:t.getRawText();return[new r.AttributionEntity(null!=s?s:e.getSanitizedHref(),e.getSanitizedHref(),e.index)]}return this._toUnhandledEntity(e)}}t.ContentToInputEntityTransformer=l,t.toEntities=function(e,t){return new l(t).transform(e)}},417677:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.quoteMessage=t.quoteRenderer=void 0;const i=s(496486),o=s(671830),n=s(986374),r=s(312762),a=s(853374);t.quoteRenderer=new class{constructor(){this.transformRootNode=this._default,this.transformPlainTextNode=this._default,this.transformSuggestedTextHighlightNode=this._default,this.transformEditMessageMetaDataNode=this._default,this.transformUserMriNode=this._default,this.transformEmoticonNode=this._default,this.transformFlagNode=this._default,this.transformLegacyQuoteNode=this._default,this.transformWikiMarkupNode=this._default,this.transformListWikiMarkupNode=this._default,this.transformLinkNode=this._default,this.transformBingResponseNode=this._default,this.transformAttributionNode=this._default,this.transformAttributionsTextNode=this._default,this.transformAttributionsGroupNode=this._default,this.transformEmoteNode=this._default,this.transformContextNode=this._asEmpty,this.transformRosterContextNode=this._asEmpty,this.transformLocationContextNode=this._asEmpty,this.transformSwiftUriObjectNode=this._default,this.transformSwiftNode=this._default,this.transformScheduledCallInviteNode=this._default,this.transformAdaptiveCardNode=this._asEmpty,this.transformUnknownNode=this._default,this.transformTextWrapperNode=this._default,this.transformTargetUserNode=this._default,this.transformTargetLegacyUserNode=this._default,this.transformTargetRoleNode=this._default,this.transformTargetsNode=this._default,this.transformContactNode=this._default,this.transformContactsNode=this._default,this.transformFileNode=this._default,this.transformFilesNode=this._default,this.transformPollNode=this._default,this.transformMetaNode=this._default,this.transformUriObjectNode=this._default,this.transformUriObjectFileNode=this._default,this.transformPictureNode=this._default,this.transformVideoNode=this._default,this.transformVideoMessageNode=this._default,this.transformAudioNode=this._default,this.transformAudioMessageNode=this._default,this.transformSkypeVideoMessageNode=this._default,this.transformMojiNode=this._default,this.transformStickerNode=this._default,this.transformCallInfoUriObjectNode=this._default,this.transformAddMemberNode=this._default,this.transformDeleteMemberNode=this._default,this.transformRoleUpdateNode=this._default,this.transformTopicUpdateNode=this._default,this.transformHandshakeInviteNode=this._default,this.transformHandshakeAcceptNode=this._default,this.transformHandshakeCompleteNode=this._default,this.transformHandshakeRejectNode=this._default,this.transformPictureUpdateNode=this._default,this.transformHistoryDisclosedUpdateNode=this._default,this.transformJoiningEnabledUpdateNode=this._default,this.transformLegacyMemberAddedNode=this._default,this.transformLegacyMemberUpgradedNode=this._default,this.transformPartNode=this._default,this.transformPartListNode=this._default,this.transformEndedNode=this._default,this.transformNgcUpgradeNode=this._default,this.transformHtmlNode=this._default,this.transformCallerIDNode=this._asEmpty,this.transformMediaAlbumNode=this._asEmpty,this.transformDataNode=this._asEmpty,this.transformGuestNameUpdateNode=this._default,this.transformGuestNameUpdateTargetNode=i.identity}_default(e){const t=i.map(e.children,(e=>e&&e.accept(this)));return e.cloneWithChildren(t)}_asEmpty(e){return r.PlainTextNode.fromPlainText("")}transform(e){return e.accept(this)}transformHighlightedNode(e){const[t]=e.children;if(t)return t.accept(this)}transformAtMentionNode(e){return this._default(r.AtMentionNode.transformToNonAlertingNode(e))}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformQuoteNode(e){return this._asEmpty(e)}transformSmsNode(e){return r.PlainTextNode.fromPlainText(e.smsContentUnescaped)}transformMmsNode(e){return r.MmsNode.parseMms(e.rawContent)}transformTranslationNode(e){return r.TranslationNode.parse(e.translation,e.originalLocale)}transformLocationNode(e){return r.PlainTextNode.fromPlainText(e.addressSanitized)}},t.quoteMessage=function(e,s){const l=o.getSkypeIdFromMri(e.creator);s=i.isString(s)?s:l;const d=Math.round(e.createdTime/1e3),c=n.decode(e);if(c.hasOnlyQuotedContent()&&c.children[0]instanceof r.QuoteNode)return c.children[0];return function(e,s,o,n,l){const d=i.flatten([r.LegacyQuoteNode.parse([r.PlainTextNode.fromPlainText("["+n+"] "+(o||s)+": ")]),t.quoteRenderer.transform(e),r.LegacyQuoteNode.parse([r.PlainTextNode.fromPlainText("\n\n<<< ")])]);let c;if(l.isBookmark()){const e=l.getBookmarkMetadata();c=e&&e.bookmarkSourceConversationId}return new r.QuoteNode(d,s&&a.default.escapeXml(s),o&&a.default.escapeXml(o),n,c||l.conversationId,l.getOriginalServerId(),l.cuid)}(c,l,s,d,e)}},681959:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderText=t.ContentToTextTransformer=void 0;const i=s(823719),o=s(496486),n=s(279957),r=s(796096),a=s(671830),l=s(247477),d=s(435521),c=s(770891),h=s(746096),u=s(373560),p=s(17213),g=s(436237),m=s(733754),S=s(18078),f=s(118317),y=s(404057),v=s(853374);class C extends l.TransformerBase{constructor(e){super(),this.transformHighlightedNode=this._default,this.transformEditMessageMetaDataNode=this._skip,this.transformAtMentionNode=e=>{const t=this._renderTextNodes(e.children);let s=t.value;return e.isAllMention()&&(s=e.getLocalizedAllMention()),Object.assign(Object.assign({},t),{value:s})},this.transformFlagNode=this._default,this.transformLegacyQuoteNode=this._skip,this.transformBingResponseNode=this._default,this.transformAttributionsTextNode=this._default,this.transformContextNode=this._default,this.transformSuggestedTextHighlightNode=this._default,this.transformSwiftNode=this._skip,this.transformAdaptiveCardNode=this._skip,this.transformUnknownNode=this._default,this.transformTextWrapperNode=this._skip,this.transformTargetUserNode=this._skip,this.transformTargetLegacyUserNode=this._skip,this.transformTargetRoleNode=this._skip,this.transformTargetsNode=this._skip,this.transformFileNode=this._default,this.transformScheduledCallInviteNode=this._default,this.transformLocationNode=this._default,this.transformMetaNode=this._skip,this.transformUriObjectNode=this._default,this.transformUriObjectFileNode=this._default,this.transformPictureNode=this._default,this.transformAudioNode=this._default,this.transformAudioMessageNode=this._default,this.transformVideoNode=this._default,this.transformVideoMessageNode=this._default,this.transformMojiNode=this._default,this.transformStickerNode=this._default,this.transformSkypeVideoMessageNode=this._default,this.transformPartNode=this._skip,this.transformEndedNode=this._skip,this.transformPollNode=this._default,this.transformMediaAlbumNode=this._default,this.transformCallInfoUriObjectNode=this._skip,this.transformCallerIDNode=this._default,this.transformDataNode=this._skip,this.transformGuestNameUpdateTargetNode=o.identity,this._options=e}static addUtfFallback(e,t){C._utfFallback[e]=t}_default(e){return this._renderTextNodes(e.children)}_skip(){return{value:void 0,stopProcessing:!1}}_renderTextNodes(e,t=""){const s=[];let i=!1;const o=e.length;for(let t=0;t<o;t++){const o=e[t];let n=o&&o.accept(this);if(n||(g.warn(h.LogTraceArea.GenericUnsafe,"renderText returned falsy",o,this._options),n={value:void 0,stopProcessing:!1}),s.push(n.value),n.stopProcessing){i=!0;break}}return{value:s.join(t),stopProcessing:i}}transform(e){return e.accept(this)}transformRootNode(e){return this._default(e)}transformPlainTextNode(e){const t=this._renderPlainText(e.getRawText(),e);return{value:o.isArray(t.value)?t.value.join(""):t.value,stopProcessing:t.stopProcessing}}_renderLineBreak(e){return this._options.trimToFirstLine?{value:void 0,stopProcessing:!0}:{value:this._options.lineBreakString,stopProcessing:!1}}transformUserMriNode(e){const t=(0,d.displayNameText)(v.default.unescapeXml(e.mri),v.default.unescapeXml(e.textNode.getRawText()));return l.trimToFirstLineIfNeeded(t,!!this._options.trimToFirstLine)}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformEmoticonNode(e){return this._options.utfFallback&&e.type in C._utfFallback?{value:C._utfFallback[e.type],stopProcessing:!1}:this._default(e)}transformQuoteNode(e){if(this._options.trimToFirstLine&&this._options.onlyQuotedContent)return{value:m.getString("ContentToTextTransformer.QuotedMessageReceivedToast"),stopProcessing:!0};switch(this._options.processing.quotes){case c.ProcessingLevel.None:return this._skip();case c.ProcessingLevel.Stripped:const t=this._default(e);return t.stopProcessing?t:{value:t.value+this._options.lineBreakString,stopProcessing:t.stopProcessing}}const t=this._options.lineBreakString,s=this._default(e);return{value:this._options.skipAuthor?"":`[${e.timestamp}] ${e.getAuthorNameWithFallbackUnescaped()}: `+s.value+(s.stopProcessing?"":t+t+"<<< "),stopProcessing:s.stopProcessing}}transformWikiMarkupNode(e){switch(this._options.processing.wikiMarkup){case c.ProcessingLevel.None:return this._skip();case c.ProcessingLevel.Stripped:return this._default(e)}const t=[e.rawPreNode,...e.children];return e.rawPostNode&&t.push(e.rawPostNode),this._renderTextNodes(t)}transformListWikiMarkupNode(e){return this.transformWikiMarkupNode(e)}transformLinkNode(e){return{value:e.getSanitizedHref(),stopProcessing:!1}}transformAttributionNode(e){return e.index?{value:e.getSanitizedHref(),stopProcessing:!1}:this._default(e)}transformAttributionsGroupNode(e){const t=e.children.reduce(((e,t)=>{var s;return(null===(s=e[e.length-1])||void 0===s?void 0:s.stopProcessing)?e:e.concat([null==t?void 0:t.accept(this)])}),[]),s=t.some((e=>null==e?void 0:e.stopProcessing));return{value:t.map((e=>null==e?void 0:e.value)).join(" "),stopProcessing:s}}transformEmoteNode(e){const t=(0,d.displayNameText)(v.default.unescapeXml(e.escapedAuthorMri),v.default.unescapeXml(e.escapedFallbackText)),s=this._renderTextNodes(e.children);return{value:t+" "+s.value,stopProcessing:s.stopProcessing}}transformRosterContextNode(){return{value:void 0,stopProcessing:!0}}transformLocationContextNode(){return{value:void 0,stopProcessing:!0}}transformSwiftUriObjectNode(e){return{value:new C(this._options).transform(e.titleChild).value,stopProcessing:!1}}transformContactNode(e){return{value:l.getContactInfo(e),stopProcessing:!1}}transformContactsNode(e){if(this._options.trimToFirstLine){return{value:m.getString("ContentToDisplayTransformerBase.ContactsSent"),stopProcessing:!0}}let t;if(this._options.message&&this._options.message.creator&&!S.default.isMyMri(this._options.message.creator)){const e="ContentToDisplayTransformerBase.ContactsReceived",s={initiator:(0,d.displayNameText)(this._options.message.creator,this._options.message.creator)};t=(0,u.localizeMessageString)(this._options.message.creator,e,s)}else t=m.getString("ContentToDisplayTransformerBase.ContactsSent");const s=this._renderTextNodes(e.children,", ");return t+=": "+s.value,{value:t,stopProcessing:s.stopProcessing}}transformFilesNode(e){const t=m.getString("ContentToDisplayTransformerBase.FilesReceivedNotSupported");if(this._options.trimToFirstLine)return{value:t,stopProcessing:!0};const s=this._renderLineBreak(e),i=this._renderTextNodes(e.children,", ");return{value:[t,s.value,i.value].join(""),stopProcessing:i.stopProcessing}}transformSmsNode(e){return l.trimToFirstLineIfNeeded(e.smsContentUnescaped,!!this._options.trimToFirstLine)}transformMmsNode(e){return this._renderTextNodes(e.contentNodes)}_getThreadActivityMemberParts(e,t,s){const{authorMri:i,personMris:n}=l.getThreadActivityMemberParts(t,s);return{authorName:(0,d.displayNameText)(i,i),personNames:o.map(n,(e=>(0,d.displayNameText)(e,e))),authorMri:i}}transformAddMemberNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,e.content),r=l.getAddMemberLocalizeInfo(t,s.join(", "),s.length>0);let a=(0,u.localizeMessageParts)(i,r.key,r.params);if(s.length>0){const t=this._renderLineBreak(e);if(!t.stopProcessing){const{allMessagesBotsFormatted:s,atMentionOnlyBotsFormatted:i}=(0,n.getBotsForDisclosure)(e.content,e.conversationId,o.identity,(e=>"@"+e));if(s.length>0||i.length>0){const e=l.renderBotDisclosureParts(s,i);a=a.concat(t.value,o.compact(e))}}}return{value:a.join(""),stopProcessing:!1}}transformDeleteMemberNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,e.content),o=a.isThread(i)?void 0:t,{key:n,params:r}=l.getDeleteMemberNodeLocalizeInfo(o,s.join(", "),s.length>0);return{value:(0,u.localizeMessageParts)(i,n,r).join(""),stopProcessing:!1}}transformRoleUpdateNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,[e.content[0]]),o=e.content[0].roleChild.getRawText(),{key:n,params:r}=l.getRoleUpdateNodeLocalizeInfo(t,s.join(", "),o);return{value:(0,u.localizeMessageParts)(i,n,r).join(""),stopProcessing:!1}}transformTopicUpdateNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),i=e.content.getRawText(),{key:o,params:n}=l.getTopicUpdateNodeLocalizeInfo(t,i);return{value:(0,u.localizeMessageParts)(s,o,n).join(""),stopProcessing:!1}}transformHandshakeInviteNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,e.content),o=S.default.isMyMri(i),{key:n,params:r}=l.getHandshakeInviteNodeLocalizedInfo(o?s[0]:t,o);return{value:(0,u.localizeMessageParts)(i,n,r).join(""),stopProcessing:!1}}transformHandshakeAcceptNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,e.content),o=S.default.isMyMri(i),{key:n,params:r}=l.getHandshakeAcceptNodeLocalizedInfo(o?s[0]:t,o);return{value:(0,u.localizeMessageParts)(i,n,r).join(""),stopProcessing:!1}}transformHandshakeCompleteNode(){return{value:m.getString("ContentToDisplayTransformerBase.E2eeInvitationConfirmed"),stopProcessing:!1}}transformHandshakeRejectNode(){return{value:m.getString("ContentToDisplayTransformerBase.E2eeInvitationRejected"),stopProcessing:!1}}transformPictureUpdateNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),{key:i,params:o}=l.getPictureUpdateNodeLocalizeInfo(t);return{value:(0,u.localizeMessageParts)(s,i,o).join(""),stopProcessing:!1}}transformHistoryDisclosedUpdateNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),{key:i,params:o}=l.getHistoryDisclosedUpdateLocalizeInfo(t,e.nowDisclosed);return{value:(0,u.localizeMessageParts)(s,i,o).join(""),stopProcessing:!1}}transformJoiningEnabledUpdateNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),{key:i,params:o}=l.getJoiningEnabledUpdateNodeLocalizeInfo(t,e.nowEnabled);return{value:(0,u.localizeMessageParts)(s,i,o).join(""),stopProcessing:!1}}transformLegacyMemberAddedNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),i=this.transformLinkNode(e.link),{key:o,params:n}=l.getLegacyMemberAddedNodeLocalizeInfo(t,i.value);return{value:(0,u.localizeMessageParts)(s,o,n).join(""),stopProcessing:i.stopProcessing}}transformLegacyMemberUpgradedNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),{key:i,params:o}=l.getLegacyMemberUpgradedNodeLocalizeInfo(t);return{value:(0,u.localizeMessageParts)(s,i,o).join(""),stopProcessing:!1}}transformPartListNode(e){const t=r.default.calculateCallMarkerInfo(e);return{value:r.CallMarkerDisplayUtils.getText(t.type,t.duration),stopProcessing:!1}}transformNgcUpgradeNode(e){return{value:(0,f.ngcUpgradeMessageText)(e.userMrisOrNames),stopProcessing:!1}}transformTranslationNode(e){return{value:e.translation,stopProcessing:!1}}_getHtmlInnerTextWalker(e,t){o.each(e,(e=>{if(i.DomUtils.isTag(e)){const s=i.DomUtils.getName(e);if("br"===s)t.text+="\n",t.pendingSeparator=void 0;else if("img"===s&&e.attribs&&e.attribs.alt&&e.attribs.itemtype===p.SemanticObjectSchemas.emoji)t.text+=e.attribs.alt;else{const i=["p","div","h1","h2","h3","h4","h5","h6","tr","img"],n=o.indexOf(i,s)>=0?"\n":void 0;t.pendingSeparator=n,e.children&&this._getHtmlInnerTextWalker(e.children,t),t.pendingSeparator=t.pendingSeparator||n}}else{const s=i.DomUtils.getText(e).replace(/\r?\n/g," ");s&&(t.text+=(t.text&&t.pendingSeparator?t.pendingSeparator:"")+s,t.pendingSeparator=void 0)}}))}_getHtmlInnerText(e){const t={text:""};return this._getHtmlInnerTextWalker(e,t),o.trim(t.text," ").replace(/ +(?= )/g,"")}transformHtmlNode(e){let t=this._getHtmlInnerText(e.getHtmlDom());const s=this._renderTextNodes(e.children,this._options.lineBreakString);return s.value&&(t+=this._options.lineBreakString+s.value),{value:t,stopProcessing:s.stopProcessing}}transformGuestNameUpdateNode(e){var t;const s=null===(t=o.first(e.content))||void 0===t?void 0:t.encodedAttr(),i=null==s?void 0:s.newName,n=null==s?void 0:s.oldName;return{value:i&&n?m.getString("ContentToDisplayTransformerBase.GuestNameUpdate",{oldName:n,newName:i}):void 0,stopProcessing:!1}}}C._utfFallback={},t.ContentToTextTransformer=C,t.renderText=function(e,t={}){try{const s=o.defaults(t,{utfFallback:t.utfFallback||!1,onlyQuotedContent:e&&e.hasOnlyQuotedContent&&e.hasOnlyQuotedContent(),processing:t.processing||{},lineBreakString:"\r"}),i=new C(s);return i.transform(e).value||""}catch(e){g.error(h.LogTraceArea.GenericUnsafe,"ContentToTextTransformer: Failed to transform tree: "+y.default.errorAsString(e))}return""}},986374:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.decodeFromContent=t.registerParser=t.Parser=void 0;const i=s(174958),o=s(496486),n=s(889391),r=s(351077),a=s(770891),l=s(746096),d=s(436237),c=s(112692),h=s(404057),u=s(853374),p=s(442222);function g(e,s,o){try{return function(e,s){let o=e||"",n=0;s&&s.skypeeditoffset&&s.skypeeditoffset>0&&(n+=Number(s.skypeeditoffset));let c,h="";if(s&&s.isEmote()){const e=s&&s.skypeemoteoffset;e&&e>0&&(n>0&&d.error(l.LogTraceArea.Deserializer,"Both skypeeditoffset and skypeemoteoffset: which comes first?",i.pii.Omit(JSON.stringify(s))),n+=e,h=o.substring(0,e))}n>0&&(o=o.substring(n));let g=!1;const f=!s||!s.messagetype||r.isXmlMessageType(s.messagetype);if(!s||f){if(o&&o.indexOf("<")>-1){const e=p.parse(o,a.rootTagName);if(e){c=S(m(e,s),s)}else d.log(l.LogTraceArea.Deserializer,"Could not XML parse content",i.pii.Omit(JSON.stringify({content:o,item:s}))),g=!0}}else if(s&&(r.isJsonMessageType(s.messagetype)||r.isHtmlMessageType(s.messagetype))){const e=t.Parser.parseFromMessageType(o,s.messagetype,s);e?c=t.Parser.root([e]):g=!0}if(!c){f||(o=u.default.escapeXml(o));const e=t.Parser.parseXmlText(o);c=S(t.Parser.root([e],g),s)}s&&s.isEmote()&&(c=t.Parser.emote(c,s.creator,h));return c}(e,s)}catch(e){return d.error(l.LogTraceArea.Deserializer,"Failed to parse "+o,h.default.errorAsString(e)),t.Parser.root([],!0)}}function m(e,s){const i=o.clone(e.attributes),n=[];o.each(e.children,(e=>{if(e.isTag){const t=m(e,s);n.push(t)}else{const s=e,i=t.Parser.parseXmlText(s.string);n.push(i)}}));const r=t.Parser.parse(n,i,e.name,s);return r||t.Parser.parseUnknown(n,i,e.name,s)}function S(e,s){if(!n.default.getS4LMessagingFeaturesNoSubscription().transformCorruptedMessages||!s)return e;let a;try{a=r.getMessageTypeGroup(s)}catch(t){return d.error(l.LogTraceArea.Deserializer,"Failed to transform corrupted message - Unknown message type.",i.pii.Omit(JSON.stringify(s))),e}const c=[r.MessageTypeGroups.System,r.MessageTypeGroups.Calling];if(o.includes(c,a)&&e.children&&1===e.children.length){const i=e.children[0];if(i&&s&&!o.includes(i.getMessageTypes(),s.messagetype)){const e=t.Parser.parseUnknown([],{},"",s);return t.Parser.root([e],!1)}}return e}t.Parser=void 0,t.registerParser=function(e){t.Parser=e},t.decodeFromContent=function(e){return g(e,void 0,"message content string")},t.decode=function(e,t,s){if(e instanceof c.default)return g(e.content,e,"messageLocal");{const i={creator:t,conversationId:s,content:e.content,contenttype:e.contenttype,messagetype:e.messagetype,properties:e.properties,skypeeditoffset:e.skypeeditoffset,skypeemoteoffset:e.skypeemoteoffset?parseInt(e.skypeemoteoffset,10):void 0,skypeguid:e.skypeguid,isMessageLie:()=>!e.id,isEmote:()=>!!e.skypeemoteoffset};return g(i.content,i,"messagePosting")}}},497174:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GuestNameUpdateEntity=t.TranslationSettingsEntity=t.DataEntity=t.ContextEntity=t.NewTopicContextEntity=t.BingContextEntity=t.PartListEntity=t.CallInfoEntity=t.CallReactionMetadataEntity=t.SwiftEntity=t.LocationEntity=t.GeoLocationEntity=t.AdaptiveUriObjectEntity=t.PollInputEntity=t.ScheduledCallInviteUriObjectEntity=t.SwiftUriObjectEntity=t.MediaAlbumEntity=t.MediaEntity=t.StickerEntity=t.CallerIDEntity=t.MojiEntity=t.WikiMarkupEntity=t.AttributionEntity=t.LinkEntity=t.SmsEntity=t.ContactEntity=t.QuoteEntity=t.CommandEntity=t.SuggestedTextHighlightEntity=t.FlagEntity=t.EmoticonEntity=t.EmoteEntity=t.AtMentionEntity=t.DoNotFormatEntity=t.EditMessageMetaDataEntity=t.EscapedEntity=t.UnhandledEntity=t.InputEntity=void 0;const i=s(785893),o=s(496486),n=s(516778),r=s(889391),a=s(265976),l=(s(671830),s(681959)),d=s(440276),c=s(816402),h=s(770891),u=s(746096),p=s(436237),g=s(733754),m=s(312762),S=s(526424),f=s(771669),y=s(753891),v=s(279829),C=s(216568),_=s(615301),b=s(640363),T=s(478262),M=s(626712),I=s(853374);class w{constructor(e){this.children=e}renderReact(e,t){return(0,i.jsx)(n.Text,Object.assign({style:e.defaultStyle,textBreakStrategy:"simple"},{children:this.children[0]}),t)}}t.InputEntity=w;class P extends w{constructor(e){super(e?o.isString(e)?[e]:e:[])}text(){return this.children.join("")}decode(){return m.PlainTextNode.fromPlainText(this.text())}appendText(e){e&&this.children.push(e)}renderReact(e,t){return(0,i.jsx)(n.Text,Object.assign({style:e.defaultStyle,textBreakStrategy:"simple"},{children:this.text()}),t)}}t.UnhandledEntity=P;t.EscapedEntity=class extends w{constructor(e){super([e])}text(){return this.children.join("")}decode(){return m.PlainTextNode.fromEscapedXml(this.text())}};t.EditMessageMetaDataEntity=class extends w{constructor(e,t,s=(t?Math.floor(t/1e3):void 0),i=m.EditMessageMetaDataNode.ExpectedT){super([]),this.fallbackSkypeId=e,this.originalArrivalTime=t,this.originalArrivalTimeSeconds=s,this.t=i}text(){return""}decode(){return m.EditMessageMetaDataNode.parse([],{a:I.default.escapeXml(this.fallbackSkypeId),ts_ms:""+this.originalArrivalTime,ts:""+this.originalArrivalTimeSeconds,t:""+this.t})}renderReact(e,t){return null}};t.DoNotFormatEntity=class extends w{constructor(e){super([e])}text(){return this.children[0]}decode(){return m.PlainTextNode.fromEscapedXml(this.text())}};class k extends w{constructor(e,t,s,i,o){super([e]),this.userMri=t,this.shortName=s,this.displayName=i,this.itemid=o}text(){return this.children[0]}decode(){return m.AtMentionNode.parse([m.PlainTextNode.fromPlainText(this.children[0])],{id:I.default.escapeXml(this.userMri),itemid:this.itemid})}clone(e){return new k(e,this.userMri,this.shortName,this.displayName,this.itemid)}renderReact(e,t){return(0,i.jsx)(n.Text,Object.assign({style:o.compact([e.defaultStyle,e.atMentionStyle]),textBreakStrategy:"simple"},{children:this.children[0]}),t)}}t.AtMentionEntity=k;t.EmoteEntity=class extends w{constructor(e){super([e.escapedFallbackText]),this._escapedFallbackText=e.escapedFallbackText,this.fallbackText=I.default.unescapeXml(this._escapedFallbackText)}text(){return""}decode(){return m.PlainTextNode.fromEscapedXml(this._escapedFallbackText)}renderReact(e,t){return null}};t.EmoticonEntity=class extends w{constructor(e,t,s){super([e]),this.emoticonName=t,this.tone=s}text(){const e=this.children[0];if(this.tone&&e.length>2&&"("===o.first(e)&&")"===o.last(e)){const t=S.DiverseToneSeparator+this.tone+")";if(!o.endsWith(e,t))return e.slice(0,-1)+t}return e}defaultToneText(){return this.children[0]}decode(){const e=I.default.escapeXml(this.emoticonName),t=I.default.escapeXml(this.text());return m.EmoticonNode.parse([m.PlainTextNode.fromEscapedXml(t)],{type:e,tone:String(this.tone)})}renderReact(e,t){return(0,i.jsx)(n.Text,Object.assign({style:o.compact([e.defaultStyle,e.emoticonAndFlagStyle]),textBreakStrategy:"simple"},{children:this.children[0]}),t)}};t.FlagEntity=class extends w{constructor(e,t){super([e]),this.flagName=t}text(){return this.children[0]}decode(){return m.FlagNode.parse([m.PlainTextNode.fromPlainText(this.children[0])],{country:I.default.escapeXml(this.flagName)})}renderReact(e,t){return(0,i.jsx)(n.Text,Object.assign({style:e.emoticonAndFlagStyle,textBreakStrategy:"simple"},{children:this.children[0]}),t)}};t.SuggestedTextHighlightEntity=class extends w{constructor(e,t,s){super([e]),this.activityId=t,this.actionsIndexes=s}text(){return this.children[0]}decode(){return m.SuggestedTextHighlightNode.parse([m.PlainTextNode.fromPlainText(this.text())],{actionsIndexes:this.actionsIndexes.join(";"),activityId:this.activityId})}};t.CommandEntity=class extends w{constructor(e,t,s,i){super([e]),this.commandName=t,this.usageHint=s,this.description=i,this.usageHint=this.usageHint||""}text(){return this.children[0]}decode(){return p.log(u.LogTraceArea.InputEntity,"Decode() called on CommandEntity",this),new P(this.text()).decode()}};t.QuoteEntity=class extends w{constructor(e,t="",s,i,o){super([]),this.quoteNode=e,this.quotedMessage=s,this.quotesTriggerType=i,this.quotesMessageType=o,this.authorname=t;const n=e;this.author=n.author,this.timestamp=n.timestamp,this.conversationId=n.conversation,this.messagetimestamp=void 0===n.messageid?void 0:Number(n.messageid)}text(e){const t=e&&e.showQuotedText?h.ProcessingLevel.Stripped:h.ProcessingLevel.None;return l.renderText(this.quoteNode,{processing:{quotes:t}})}textForSMS(){const e=c.default.getAbsoluteDisplayDateTimeString(1e3*this.timestamp),t=l.renderText(this.quoteNode,{processing:{quotes:h.ProcessingLevel.Stripped}});return e+" "+this.authorname+":\n> "+t+"\n"}decode(){return this.quoteNode}};t.ContactEntity=class extends w{constructor(e,t,s,i,o){super([]),this._skypeId=e,this._fullName=t,this._isPstn=s,this._pstnName=i,this._isS4B=o}getSkypeId(){return this._skypeId}getFullName(){return this._fullName}isPstn(){return this._isPstn}isS4B(){return this._isS4B}text(){return""}decode(){const e=m.ContactNode.parse([],{t:m.ContactNode.getEncodedTypeAttr(this._isPstn,this._isS4B),p:this._pstnName,s:this._skypeId,f:this._fullName});return m.ContactsNode.parse([e])}};t.SmsEntity=class extends w{constructor(e,t){super([]),this._smsTextUnescaped=e,this._smsReceipient=t,this._flowId=_.default.getFlowId(),this._deliveryMethodText="reliable",this._uiVersion=b.default.getUIVersion(),this._fingerprint=C.default.CallingFingerprintId.get(),this._restApiVersion="2"}text(e){return this._smsTextUnescaped}decode(){const e=I.default.newGuid(),t=[m.UnknownNode.parse([m.PlainTextNode.fromPlainText("chatservice")],{},"deliveryReportVersion"),m.UnknownNode.parse([m.PlainTextNode.fromPlainText(this._uiVersion)],{},"uiVersion")],{enableSmsFingerprintId:s,smsFingerprintIdTag:i}=r.default.dangerouslyGetS4LMessagingFeatures();return s&&this._fingerprint&&t.push(m.UnknownNode.parse([m.PlainTextNode.fromPlainText(this._fingerprint)],{},i)),m.SmsNode.parse([m.UnknownNode.parse([m.PlainTextNode.fromPlainText(this._restApiVersion)],{},"restApiVersion"),m.UnknownNode.parse([m.PlainTextNode.fromPlainText(this._smsTextUnescaped)],{},"encoded_body"),m.UnknownNode.parse([m.UnknownNode.parse(t,{},"skype"),m.UnknownNode.parse([m.UnknownNode.parse([m.PlainTextNode.fromPlainText(this._flowId)],{},"flowId"),m.UnknownNode.parse([m.PlainTextNode.fromPlainText(this._deliveryMethodText)],{},"deliveryMethod")],{},"control"),m.UnknownNode.parse([m.UnknownNode.parse([m.PlainTextNode.fromPlainText(this._smsTextUnescaped)],{},"body")],{},"content")],{},"defaults"),m.UnknownNode.parse([m.UnknownNode.parse([m.UnknownNode.parse([m.PlainTextNode.fromPlainText(e)],{},"requestId"),m.UnknownNode.parse([m.UnknownNode.parse([m.PlainTextNode.fromPlainText(this._smsReceipient)],{},"address")],{},"recipient")],{},"bulkItem")],{},"bulkItems")],{alt:I.default.escapeXml(this._smsTextUnescaped)})}renderReact(e){return(0,i.jsx)(n.Text,Object.assign({style:o.compact([e.defaultStyle,e.emoticonAndFlagStyle]),textBreakStrategy:"simple"},{children:this._smsTextUnescaped}),"smsEntity")}};t.LinkEntity=class extends w{constructor(e,t){super([e]),this.href=t}text(){return this.children[0]}computeType(){const e=M.default.getURIComponents(this.href);return e&&e.type}decode(){return m.LinkNode.parse([m.PlainTextNode.fromPlainText(this.children[0])],{href:I.default.escapeXml(this.href)})}};t.AttributionEntity=class extends w{constructor(e,t,s){super([e]),this.href=t,this.index=s}text(){return this.children[0]}decode(){return m.AttributionNode.parse([m.PlainTextNode.fromPlainText(this.children[0])],{href:I.default.escapeXml(this.href),index:this.index})}};t.WikiMarkupEntity=class extends w{constructor(e,t,s,i){super(e),this.tag=t,this.raw_pre=s,this.raw_post=i}text(){return this.raw_pre+o.map(this.children,(e=>e.text())).join("")+(this.raw_post||"")}decode(){const e=o.map(this.children,(e=>e.decode()));return m.WikiMarkupNode.parse(e,{raw_pre:I.default.escapeXml(this.raw_pre),raw_post:this.raw_post&&I.default.escapeXml(this.raw_post)},this.tag)}renderReact(e,t){return(0,i.jsx)(n.Text,Object.assign({style:e.defaultStyle,textBreakStrategy:"simple"},{children:this.text()}),t)}};t.MojiEntity=class extends w{constructor(e,t,s,i,o,n,r,a){super([o]),this.id=e,this.uri=t,this.url_thumbnail=s,this.type=i,this.fallbackUrl=o,this.title=n,this.description=r,this.originalName=a}text(){return this.children[0]}decode(){return m.UriObjectNode.parse([m.UnknownNode.parse([m.PlainTextNode.fromPlainText(this.title)],{},"Title"),m.UnknownNode.parse([m.PlainTextNode.fromPlainText(this.description)],{},"Description"),m.LinkNode.parseFromHref(this.fallbackUrl),m.UnknownNode.parse([],{v:I.default.escapeXml(this.originalName)},"OriginalName")],{uri:I.default.escapeXml(this.uri),url_thumbnail:I.default.escapeXml(this.url_thumbnail),type:this.type})}renderReact(e,t){return(0,i.jsx)(n.Text,Object.assign({style:o.compact([e.defaultStyle,e.emoticonAndFlagStyle]),textBreakStrategy:"simple"},{children:this.children[0]}),t)}};t.CallerIDEntity=class extends w{constructor(e){super([e]),this._layoutOption=e}text(){return""}decode(){return m.CallerIDNode.parse([],{layoutOption:this._layoutOption})}};t.StickerEntity=class extends w{constructor(e,t,s,i,o=g.getString("InputEntity.StickerFallbackText"),n=r.default.getS4LMessagingFeaturesNoSubscription().stickersNotSupportedFallbackUrl){super([n]),this.id=e,this.uri=t,this.url_thumbnail=s,this.originalName=i,this.fallbackMessage=o,this.fallbackUrl=n}text(){return this.children[0]}decode(){const e=[m.PlainTextNode.fromPlainText(this.fallbackMessage),m.LinkNode.parseFromHref(this.fallbackUrl)];return this.originalName&&e.push(m.UnknownNode.parse([],{v:I.default.escapeXml(this.originalName)},"OriginalName")),m.UriObjectNode.parse(e,{uri:I.default.escapeXml(this.uri),url_thumbnail:I.default.escapeXml(this.url_thumbnail),type:"Sticker.1"})}renderReact(e,t){return(0,i.jsx)(n.Text,Object.assign({style:o.compact([e.defaultStyle,e.emoticonAndFlagStyle]),textBreakStrategy:"simple"},{children:this.children[0]}),t)}};t.MediaEntity=class extends w{constructor(e,t,s,i,o,n,r,a,l,d){super([s]),this.localUri=e,this.localThumbnailUrl=t,this.fallbackUrl=s,this.azureMSUrl=i,this.uploadType=o,this.filename=n,this.fileSize=r,this.dimensions=a,this.amsDocumentId=l,this.audioMessageDurationMs=d}text(){return this.children[0]}decode(){let e,t,s;switch(this.uploadType){case T.UploadFileType.Picture:t="Picture",e=g.getString("InputEntity.SharedPhotoFallbackText");break;case T.UploadFileType.Video:t="Video",e=g.getString("InputEntity.SharedVideoFallbackText");break;case T.UploadFileType.VideoMessage:t="Video",s="Message",e=g.getString("InputEntity.VideoMessageFallbackText");break;case T.UploadFileType.Audio:t="Audio",e=g.getString("InputEntity.AudioFileFallbackText");break;case T.UploadFileType.AudioMessage:t="Audio",s="Message",e=g.getString("InputEntity.AudioMessageFallbackText");break;case T.UploadFileType.PDF:t="File",s="PDF",e=g.getString("InputEntity.FileFallbackText");break;case T.UploadFileType.Word:t="File",s="Word",e=g.getString("InputEntity.FileFallbackText");break;case T.UploadFileType.Excel:t="File",s="Excel",e=g.getString("InputEntity.FileFallbackText");break;case T.UploadFileType.Powerpoint:t="File",s="Powerpoint",e=g.getString("InputEntity.FileFallbackText");break;case T.UploadFileType.AVI:t="File",s="AVI",e=g.getString("InputEntity.FileFallbackText");break;case T.UploadFileType.Zip:t="File",s="Zip",e=g.getString("InputEntity.FileFallbackText");break;default:case T.UploadFileType.File:t="File",e=g.getString("InputEntity.FileFallbackText")}const i={uri:this.amsDocumentId?a.getLegacyDocumentUrl(this.amsDocumentId):I.default.escapeXml(this.localUri),url_thumbnail:this.amsDocumentId?a.getLegacyDisplayUrl(this.amsDocumentId,this.uploadType):this.localThumbnailUrl&&I.default.escapeXml(this.localThumbnailUrl),url_azurems:this.azureMSUrl&&I.default.escapeXml(this.azureMSUrl),type:t+".1"+(s?"/"+s+".1":""),doc_id:this.amsDocumentId,duration_ms:this.audioMessageDurationMs};this.dimensions&&(i.width=this.dimensions.width.toString(),i.height=this.dimensions.height.toString());const n=this.filename&&I.default.escapeXml(this.filename),r=[m.PlainTextNode.fromPlainText(e),m.LinkNode.parseFromHref(this.fallbackUrl),m.UnknownNode.parse([],{v:n},"OriginalName"),m.UnknownNode.parse([],{v:this.fileSize},"FileSize")];this.uploadType!==T.UploadFileType.Picture||o.isEmpty(n)||r.push(m.MetaNode.parse([],{type:"photo",originalName:n},"meta",void 0));return m.UriObjectNode.parseFromSanitizedParts(r,i,this.localUri,this.localThumbnailUrl,this.azureMSUrl,void 0)}renderReact(e,t){return(0,i.jsx)(n.Text,Object.assign({style:o.compact([e.defaultStyle,e.emoticonAndFlagStyle]),textBreakStrategy:"simple"},{children:this.children[0]}),t)}};t.MediaAlbumEntity=class extends w{constructor(e){super([""]),this.albumId=e}text(){return""}decode(){const e={albumId:this.albumId};return m.MediaAlbumNode.parse([],e)}};class A extends w{constructor(e,t,s,i,o){super(o?[o]:[A.DEFAULT_FALLBACK_URI]),this.conversationId=e,this.skipSanitization=t,this.title=s,this.url_thumbnail=A.DEFAULT_THUMBNAIL_URI,this.fallbackUrl=A.DEFAULT_FALLBACK_URI,i&&(this.url_thumbnail=i),o&&(this.fallbackUrl=o)}text(){return this.children[0]}decode(){const e=g.getString("InputEntity.SwiftFallbackText"),t={type:"SWIFT.1",uri:void 0,url_thumbnail:I.default.escapeXml(this.url_thumbnail)},s=[m.PlainTextNode.fromPlainText(e),m.LinkNode.parseFromHref(this.fallbackUrl),m.UnknownNode.parse([m.PlainTextNode.fromPlainText(this.title)],{},"Title")],i=this._getCardNode();i&&s.push(i);return m.UriObjectNode.parseFromSanitizedParts(s,t,void 0,this.url_thumbnail,void 0,void 0)}renderReact(e,t){return null}}A.DEFAULT_THUMBNAIL_URI="https://urlp.asm.skype.com/v1/url/content?url=https://neu1-urlp.secure.skypeassets.com/static/card-128x128.png",A.DEFAULT_FALLBACK_URI="https://go.skype.com/cards.unsupported";t.SwiftUriObjectEntity=class extends A{constructor(e,t,s,i,o,n){super(t,s,i,o,n),this.swiftMessage=e}_getCardNode(){return m.SwiftNode.parseSwift(this.swiftMessage,this.conversationId,void 0,this.skipSanitization)}};class x extends w{constructor(e,t,s,i="",o,n){super([i]),this._scheduledCallId=e,this._datetimeMs=t,this._reminder=s,this._subject=i,this._canceledTimeMs=o,this._editedTimeMs=n,this._fallbackMessage=g.getString("InputEntity.CallInviteFallbackText"),this._fallbackUrl=r.default.getS4LCMCFeaturesNoSubscription().scheduledCallNotSupportedFallbackUrl}static fromScheduledCall(e){return new x(e.id,e.datetimeMs.toString(),e.reminder.toString(),e.subject,e.canceledTimeMs&&e.canceledTimeMs.toString()||void 0,e.editedTimeMs&&e.editedTimeMs.toString()||void 0)}text(e){return this._subject}decode(){const e=[m.PlainTextNode.fromPlainText(this._fallbackMessage),m.LinkNode.parseFromHref(this._fallbackUrl)],t={type:v.ScheduleCallMessageNodeName,scheduledCallId:this._scheduledCallId,datetimeMs:this._datetimeMs,reminder:this._reminder,subject:this._subject,canceledTimeMs:this._canceledTimeMs,editedTimeMs:this._editedTimeMs};return m.UriObjectNode.parseFromSanitizedParts(e,t,void 0,void 0,void 0,void 0)}}t.ScheduledCallInviteUriObjectEntity=x;t.PollInputEntity=class extends w{constructor(e,t,s,i){super([e]),this._title=e,this._expirationDate=t,this._options=s,this._allowMultupleVotes=i}text(){return this._title}decode(){const e=[];this._title&&e.push(m.PlainTextNode.fromPlainText(this._title));const t={type:y.PollCardNodeName,title:this._title,expirationTimeMs:this._expirationDate,optionsEncoded:f.encodePollOptions(this._options),allowMultipleVotes:this._allowMultupleVotes?"true":"false"};return m.UriObjectNode.parseFromSanitizedParts(e,t,void 0,void 0,void 0,void 0)}};t.AdaptiveUriObjectEntity=class extends A{constructor(e,t,s,i,o,n){super(t,s,i,o,n),this.adaptiveMessage=e}_getCardNode(){return m.AdaptiveCardNode.parseAdaptiveCard(this.adaptiveMessage,this.conversationId,void 0)}};t.GeoLocationEntity=class extends w{constructor(e,t,s,i,o,n,r,a,l,d,c,h,u,p,g,m=[]){super(m),this.isUserLocation=e,this.userMri=t,this.latitude=s,this.longitude=i,this.accuracy=o,this.timestamp=n,this.timezone=r,this.altitude=a,this.locale=l,this.language=d,this.address=c,this.name=h,this.img=u,this.addressFriendlyName=p,this.shortAddress=g}text(){return""}decode(){const e={isUserLocation:this.isUserLocation?"1":"0",latitude:o.isFinite(this.latitude)?Math.round(1e6*this.latitude):void 0,longitude:o.isFinite(this.longitude)?Math.round(1e6*this.longitude):void 0,horizontalAccuracy:o.isFinite(this.accuracy)?this.accuracy:void 0,verticalAccuracy:o.isFinite(this.accuracy)?this.accuracy:void 0,timeStamp:o.isFinite(this.timestamp)?this.timestamp:void 0,altitude:o.isFinite(this.altitude)?Math.round(100*this.altitude):void 0,timezone:o.isNil(this.timezone)?void 0:I.default.escapeXml(this.timezone),locale:o.isNil(this.locale)?void 0:I.default.escapeXml(this.locale),language:o.isNil(this.language)?void 0:I.default.escapeXml(this.language),name:o.isNil(this.name)?void 0:I.default.escapeXml(this.name),address:o.isNil(this.address)?"":I.default.escapeXml(this.address),img:o.isNil(this.img)?void 0:I.default.escapeXml(this.img),addressFriendlyName:o.isNil(this.addressFriendlyName)?"":I.default.escapeXml(this.addressFriendlyName),shortAddress:o.isNil(this.shortAddress)?"":I.default.escapeXml(this.shortAddress),userMri:o.isNil(this.userMri)?void 0:I.default.escapeXml(this.userMri)},t=o.map(this.children,(e=>e.decode()));return m.LocationNode.parse(t,e)}renderReact(e,t){return null}};t.LocationEntity=class extends w{constructor(e,t=[]){super(t),this._attributes=e,this._attributes.allowNoLink=!0}text(){return""}decode(){return m.LocationNode.parse(this.children.map((e=>e.decode())),this._attributes)}};t.SwiftEntity=class extends w{constructor(e,t,s,i=!1){if(super([""]),this.swift=e,this.conversationId=t,this._skipSanitization=i,this._b64="",s)this._b64=s;else{const e=JSON.stringify(this.swift);this._b64=d.btoaUtf8(e)}}text(){return this.children[0]}decode(){return this._decoded||(this._decoded=m.SwiftNode.parseSwift(this.swift,this.conversationId,this._b64,this._skipSanitization)),this._decoded}renderReact(e,t){return null}};t.CallReactionMetadataEntity=class extends w{constructor(e,t=T.ReactionsTextStyle.Default,s=T.ReactionsTextType.Default,i){super([""]),this.id=e,this.style=t,this.internalType=s,this.userMri=i}text(){return""}decode(){return m.UnknownNode.parse([],{id:I.default.escapeXml(this.id),style:this.style,internalType:this.internalType,userMri:this.userMri?I.default.escapeXml(this.userMri):""},"c_i")}renderReact(e,t){return null}};t.CallInfoEntity=class extends w{constructor(e,t,s,i,o,n){super([""]),this.callId=e,this.threadId=t,this.isCast=s,this.timestamp=i,this.label=o,this.locationName=n}text(){return""}decode(){const e=(this.isCast,g.getString("InputEntity.CallMessageFallback"));return m.CallInfoUriObjectNode.parse([m.PlainTextNode.fromPlainText(e)],{uri:void 0,url_thumbnail:void 0,type:"Cast.1",callId:this.callId,threadId:this.threadId,containerType:this.isCast?"Cast":"Call",timestamp:this.timestamp.toString(),label:this.label&&I.default.escapeXml(this.label),locationName:this.locationName&&I.default.escapeXml(this.locationName)})}renderReact(e,t){return null}};t.PartListEntity=class extends w{constructor(e,t,s,i){super(s),this.callId=e,this.type=t,this.alt=i}text(){return""}decode(){const e={callId:this.callId?this.callId:"",type:this.type,alt:this.alt?I.default.escapeXml(this.alt):""};return m.PartListNode.parse(this.children,e)||m.UnknownNode.parse([],e,"PartList")}};t.BingContextEntity=class extends w{constructor(e,t,s,i){super([...(null==t?void 0:t.map((e=>new O(e))))||[],...s?[new R(s.encrypted,s.source)]:[],...i?[new L]:[]]),this.attributes=e}text(){return""}decode(){return m.ContextNode.parse(this.children.map((e=>e.decode())),this.attributes)}renderReact(e,t){return null}};class R extends w{constructor(e,t){super([]),this._location=e,this._source=t}text(){return""}decode(){return m.LocationContextNode.parse([],{encrypted:this._location,source:this._source})}}class O extends w{constructor(e){super([]),this._roster=e}text(){return""}decode(){return m.RosterContextNode.parse([],{id:this._roster.id,name:this._roster.displayName})}}class L extends w{constructor(){super([])}text(){return""}decode(){return m.NewTopicContextNode.parse()}}t.NewTopicContextEntity=L;t.ContextEntity=class extends w{constructor(e){super([]),this.attributes=e}text(e){return""}decode(){return m.ContextNode.parse([],this.attributes)}renderReact(e,t){return null}};t.DataEntity=class extends w{constructor(e,t,s,i){super(s),this.type=e,this.content=t,this.alt=i}text(){return""}decode(){const e={content:this.content||"",type:this.type,alt:this.alt?I.default.escapeXml(this.alt):""};return m.DataNode.parse(e)||m.UnknownNode.parse([],e,"Data")}};t.TranslationSettingsEntity=class extends w{constructor(e,t,s,i){super(s),this.type=e,this.content=t,this.alt=i}text(){return""}decode(){const e={content:this.content||"",type:this.type,alt:this.alt?I.default.escapeXml(this.alt):""};return m.TranslationSettingsNode.parse(e)||m.UnknownNode.parse([],e,"Data")}};t.GuestNameUpdateEntity=class extends w{constructor(e){super(e)}text(){return""}decode(){return m.GuestUpdateNode.parse(this.children,{},"GuestNameUpdate",void 0)}}},923944:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyEditableContentToInputEntities=t.getEditableEntityFromInputEntity=t.getEditableContentFromInputEntities=t.getTextForSms=t.getRawText=t.encodeRawText=t.convertRawTextToInputEntities=t.decodeFromInput=t.test_handleEntities=t.renderReact=t.encode=t.handleLinks=t.hasOnlyEmoticonsOrWhitespaceText=t.handleEmoticons=t.handleSuggestedTextHighlights=void 0;const i=s(496486),o=s(54569),n=s(481169),r=s(986374),a=s(82433),l=s(732183),d=s(497174),c=s(526424),h=s(626712),u=s(606509),p=s(733754),g=/\b(?:www\.|https?\:\/\/)[A-Z\u00a1-\uffff0-9-_.~!*'();:@&+$%,/?#[\]{|}<=>^]+/gi,m=/\b[^@\s]+@\S+\.[a-z]+/gi,S=/\bskype:(?:[^\W\s]|\.|\+|-|\:|\;)+?(?:[^\s\n\#\[\]]*)/gi,f=/\S+/g,y=".,!?:;\"'",v=/\[.*?\]\(\b(?:www\.|https?\:\/\/)[A-Z\u00a1-\uffff0-9-_.~!*'();:@&+$%,/?#[\]{|}<=>^]+?\)/gi,C=/^\b$/;function _(e,t,s){let o=[];return i.each(e,(e=>{if(!(e instanceof d.UnhandledEntity))return void o.push(e);const n=e.text();i.last(o)instanceof d.UnhandledEntity||o.push(new d.UnhandledEntity);let r,a=0;for(;r=t.exec(n);){if(r.index!==a){const e=n.substring(a,r.index);i.last(o).appendText(e)}const e=s(...r),t=i.isArray(e)?e:[e];if(i.head(t)instanceof d.UnhandledEntity){const e=t.shift();i.last(o).appendText(e.text())}o=o.concat(t),i.last(o)instanceof d.UnhandledEntity||o.push(new d.UnhandledEntity),a=r.index+r[0].length}if(a<n.length){const e=n.substring(a);i.last(o).appendText(e)}i.last(o).text()||o.pop()})),o}function b(e,t=0,s=e.length){const i=[];let o=s;for(let n=s-1;n>=t;--n){let t=e.substring(n,o);if(a.default.isEmoticon(t)){for(;n>0;){const s=e.substring(n-1,o);if(!a.default.isEmoticon(s))break;n--,t=e.substring(n,o)}const s=l.getEmoticonTone(t),r=l.getSanitizedEmoticonName(t);i.push(new d.EmoticonEntity(r,a.default.getEmoticonByShortcut(t).id,s)),o=n}else if("("===t[0]){const e=t.match(/^\(flag:(..)\)$/i);if(e){const s=e[1].toLowerCase();a.default.hasCountry(s)&&(i.push(new d.FlagEntity(t,s)),o=n)}}}return i.length?(0!==o&&i.push(new d.UnhandledEntity(e.substring(t,o))),i.reverse()):null}function T(e){for(let t=e.length;t>0;t--){const s=b(e,0,t);if(s)return t!==e.length&&s.push(new d.UnhandledEntity(e.substring(t))),1===s.length?s[0]:s;const i=e[t-1];if(-1===y.indexOf(i))break}return new d.UnhandledEntity(e)}function M(e){return _(e,f,T)}function I(e){let t=e;const s=-1===y.indexOf(i.last(t))?t.length:t.length-1;let o=s;for(;o>=0&&-1!==")>}".indexOf(t[o-1]);o--);if(o<s){const e=function(e,t){const s=i.mapValues(i.groupBy(t),i.constant(0));for(let t=0;t<e.length;t++){const i=e[t];s.hasOwnProperty(i)&&s[i]++}return s}(t.substring(0,o),"()<>{}"),n={")":e["("]-e[")"],">":e["<"]-e[">"],"}":e["{"]-e["}"]};for(;o<s;o++){const e=t[o];if(!(n.hasOwnProperty(e)&&n[e]>0))break;--n[e]}}let n="";o!==t.length&&(n=t.substring(o),t=t.substring(0,o));const r=h.default.createSanitizedHref(t);if(r){const e=new d.LinkEntity(r.text,r.href);return r.trailingCharacters||n?[e,new d.UnhandledEntity(n+(r.trailingCharacters||""))]:e}return new d.UnhandledEntity(e)}function w(e){const t=new d.UnhandledEntity(e),s=_([t],g,I),i=_(s,f,T),o=i[1],n=i[0];let r,a=n.text().trim();const l=p.getString("MessageComposer.DraftDecorator"),c=a.startsWith(l);return c&&(a=a.slice(l.length)),r=a.substring(1,a.length-2).trim(),c&&(r=l.concat(r)),o&&o.href&&n&&r.length>0?new d.LinkEntity(r,o.href):t}function P(e){const t=_(e,v,w),s=_(t,g,I),i=_(s,m,I);return _(i,S,I)}function k(e,t){return x(e,t).encodeToString()}function A(e){const{prefix:t,entities:s}=u.splitWikiMarkupPrefix(e),i=t!==u.WikiPrefix.DoNotFormat?M(s):s,o=t===u.WikiPrefix.None?function(e){return u.encodeWikiMarkupWithoutPrefix(e)}(i):i;return t===u.WikiPrefix.DoNotFormat?[new d.DoNotFormatEntity(k(o,!0))]:P(o)}function x(e,t){if(!e.length)return r.Parser.root([r.Parser.parseXmlText("")]);let s=e;t||(s=A(e));const o=i.map(s,(e=>e.decode()));return r.Parser.root(o)}function R(e){return A([new d.UnhandledEntity(e)])}function O(e,t={}){return(0,n.chain)(e,(0,n.drop)(t.startIndex||0),(0,n.map)((e=>e.text(t))),(0,n.join)(""))}function L(e,t,s){if(e instanceof d.AtMentionEntity){const t=e;return{type:o.EditableEntityType.AtMention,originId:s,displayText:t.text(),userMri:t.userMri,shortName:t.shortName||"",displayName:t.displayName||""}}if(e instanceof d.CommandEntity){const t=e;return{type:o.EditableEntityType.SlashCommand,originId:s,displayText:t.text().trim(),commandName:t.commandName,usageHint:t.usageHint,description:t.description}}if(e instanceof d.EmoteEntity){const t=e;return{type:o.EditableEntityType.Agnostic,originId:s,displayText:t.fallbackText||"?",position:o.AgnosticContentPosition.Leading}}if(e instanceof d.EmoticonEntity){const i=e,n=i.defaultToneText().toLowerCase(),r=t[l.getSanitizedEmoticonName(n)],a=r?l.getEmoticonUrl(r.id,c.EmoticonSize.Small,!0,e.tone,r.etag):void 0;return{type:o.EditableEntityType.Emoticon,originId:s,tone:i.tone,displayText:i.text(),emoticonName:i.emoticonName,url:a}}if(e instanceof d.LinkEntity){const t=e;if(t.text()===t.href||h.default.isUrlValid(t.text())){return{type:o.EditableEntityType.Link,originId:s,displayText:t.text(),href:t.href}}return{type:o.EditableEntityType.PlainText,originId:s,displayText:`[${t.text()}](${t.href})`}}if(e instanceof d.QuoteEntity){return{type:o.EditableEntityType.Agnostic,originId:s,displayText:e.text(),position:o.AgnosticContentPosition.Leading}}if(e instanceof d.UnhandledEntity){const t=e;return{type:o.EditableEntityType.PlainText,displayText:t.text(),originId:s}}if(e instanceof d.WikiMarkupEntity){const t=e;return{type:o.EditableEntityType.PlainText,displayText:t.text(),originId:s}}return{type:o.EditableEntityType.Agnostic,originId:s,displayText:e.text()||"?",position:o.AgnosticContentPosition.InPlaceWithTextStream}}t.handleSuggestedTextHighlights=function(e,t){const s=i.compact(i.map(t,(e=>e.phrase)));if(i.isEmpty(s))return e;const o=function(e){if(e.length>0){const t="("+i.map(e,(e=>i.escapeRegExp(e))).join("|")+")";return new RegExp(t,"g")}return C}(s);return _(e,o,(e=>{const s=i.find(t,(t=>t.phrase===e));return s?new d.SuggestedTextHighlightEntity(s.phrase,s.activityId,s.actionsIndexes):new d.UnhandledEntity(e)}))},t.handleEmoticons=M,t.hasOnlyEmoticonsOrWhitespaceText=function(e){return x(R(e.smsContentUnescaped),!1).hasOnlyEmoticonsOrWhitespaceText()},t.handleLinks=P,t.encode=k,t.renderReact=function(e,t){return e.map(((e,s)=>e.renderReact(t,s)))},t.test_handleEntities=function(e){return A(e)},t.decodeFromInput=x,t.convertRawTextToInputEntities=R,t.encodeRawText=function(e){return k(R(e),!1)},t.getRawText=O,t.getTextForSms=function(e){const t=i.find(e,(e=>e instanceof d.QuoteEntity)),s=O(e);return t?(t.textForSMS()||"")+s:s},t.getEditableContentFromInputEntities=function(e,t,s){return{entities:e.map(((e,t)=>L(e,s,t))),downStreamDataVersion:t}},t.getEditableEntityFromInputEntity=L,t.applyEditableContentToInputEntities=function(e,t){const s=[];return i.each(e.entities,(e=>{let i;switch(e.type){case o.EditableEntityType.Agnostic:{const s=e;void 0!==s.originId&&s.originId<t.length&&(i=t[s.originId]);break}case o.EditableEntityType.AtMention:{const t=e;i=new d.AtMentionEntity(t.displayText,t.userMri,t.shortName,t.displayName);break}case o.EditableEntityType.Emoticon:{const t=e;i=new d.EmoticonEntity(t.displayText,t.emoticonName,t.tone);break}case o.EditableEntityType.Link:{const t=e;i=new d.LinkEntity(t.displayText,t.href);break}case o.EditableEntityType.PlainText:{const t=e;i=new d.UnhandledEntity(t.displayText);break}case o.EditableEntityType.SlashCommand:{const t=e;i=new d.CommandEntity(t.displayText,t.commandName,t.usageHint,t.description);break}}i&&s.push(i)})),s}},312762:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DisplayableMedia=t.UriObjectFileNode=t.ScheduledCallInviteNode=t.AdaptiveCardNode=t.SwiftNode=t.SwiftUriObjectNode=t.UriObjectNode=t.FilesNode=t.FileNode=t.MetaNode=t.LocationNode=t.MmsNode=t.SmsNode=t.ContactsNode=t.ContactNode=t.TargetsNode=t.TargetRoleNode=t.TargetLegacyUserNode=t.TargetUserNode=t.TargetNode=t.TextWrapperNode=t.CallerIDNode=t.ContextNode=t.LocationContextNode=t.NewTopicContextNode=t.RosterContextNode=t.SuggestedTextHighlightNode=t.EmoteNode=t.AttributionsGroupNode=t.AttributionsTextNode=t.AttributionNode=t.BingResponseNode=t.LinkNode=t.ListWikiMarkupNode=t.WikiMarkupNode=t.LegacyQuoteNode=t.HighlightedNode=t.QuoteNode=t.FlagNode=t.EmoticonNode=t.UnicodeEmojiNode=t.UserMriNode=t.AtMentionNode=t.EditMessageMetaDataNode=t.HtmlNode=t.PlainTextNode=t.UnknownNode=t.RootNode=t.InternalNode=t.init=void 0,t.GuestUpdateNode=t.GuestUpdateTargetNode=t.TranslationNode=t.TranslationSettingsNode=t.DataNode=t.PollNode=t.NgcUpgradeSystemMessageNode=t.CallReactionMetadataNode=t.CallInfoUriObjectNode=t.EndedNode=t.PartListNode=t.PartNode=t.LegacyMemberUpgradedNode=t.LegacyMemberAddedNode=t.JoiningEnabledUpdateNode=t.HistoryDisclosedUpdateNode=t.PictureUpdateNode=t.HandshakeRejectNode=t.HandshakeCompleteNode=t.HandshakeAcceptNode=t.HandshakeInviteNode=t.TopicUpdateNode=t.RoleUpdateNode=t.DeleteMemberNode=t.AddMemberNode=t.ThreadActivity=t.SkypeVideoMessageNode=t.StickerNode=t.MojiNode=t.MediaAlbumNode=t.AudioMessageNode=t.AudioNode=t.VideoMessageNode=t.VideoNode=t.PictureNode=t.DisplayableMediaWithThumbnail=void 0;const i=s(823719),o=s(496486),n=s(612852),r=s(281394),a=s(889391),l=s(265976),d=s(481169),c=s(351077),h=s(671830),u=s(440276),p=s(986374),g=s(179662),m=s(770891),S=s(746096),f=s(970004),y=s(750066),v=s(57199),C=s(436237),_=s(733754),b=s(665047),T=s(18078),M=s(395868),I=s(526424),w=s(771669),P=s(649130),k=s(279829),A=s(404057),x=s(767384),R=s(478262),O=s(361694),L=s(626712),F=s(853374),B=s(539549),D=s(741660),E=/content-type=\".*?\"/g;class V{static registerForXml(e,t){return V._XmlParsers[e]=t,e}static registerForXmlWithMessageTypes(e,t,...s){return V._XmlParsers[e]=(e,i,n,r)=>r&&r.messagetype&&o.some(s)&&!o.includes(s,r.messagetype)?void 0:t(e,i,n,r),e}static registerForJson(e,t){return V._JsonParsers[e]=t,"_"+e}static registerInvalid(e){return V._InvalidParsers[e]=!0,e}static getXmlParser(e){return V._XmlParsers.hasOwnProperty(e)?V._XmlParsers[e]:void 0}static getJsonParser(e){return V._JsonParsers.hasOwnProperty(e)?V._JsonParsers[e]:void 0}static isInvalidParser(e){return!!V._InvalidParsers[e]}}V._XmlParsers={},V._JsonParsers={},V._InvalidParsers={};const N=new class{parse(e,t,s,i){V.isInvalidParser(s)&&C.warn(S.LogTraceArea.GenericUnsafe,"Trying to decode an invalid tag",s);const o=V.getXmlParser(s);return o?o(e,t,s,i):void 0}parseXmlText(e){return W.fromEscapedXml(e)}parseFromMessageType(e,t,s){const i=V.getJsonParser(t);return i?i(e,s):void 0}parseUnknown(e,t,s,i){return H.parse(e,t,s,i)}root(e,t=!1){return new j(e,t)}emote(e,t,s){const i=F.default.escapeXml(t),n=F.default.escapeXml(s),r=o.clone(e.children);return r.unshift(new le(i,n)),N.root(r,e.parsingFailed())}};t.init=function(){p.registerParser(N)};class U{constructor(e,t){this.children=e,this._tag=t}getTag(){return this._tag}getMessageTypes(){return U._messageTypes}cloneWithChildren(e){const t=this.getTag(),s=V.getXmlParser(t);return s&&s(e,this.encodedAttr(),this.getTag(),void 0)}encode(){return this._encodeParts(this._encodeChildren(),o.mapValues(this.encodedAttr(),(e=>o.isString(e)||o.isNull(e)||o.isUndefined(e)?e:e.toString())),this.getTag())}encodeToString(){const e=this.encode();return o.isArray(e)?o.flattenDeep(e).join(""):e||""}encodedAttr(){return{}}isEmptyTextNodeOrContainingWhitespacesOnly(){return!1}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!1}getUriObjectNode(e){}_encodeParts(e,t,s,i=!1){if(s){const n=o.map(t,((e,t)=>o.isUndefined(e)||o.isNull(e)?void 0:t+'="'+e+'"')),r=o.compact(n).join(" "),a="<"+s+(r?" "+r:"");return i&&o.isEmpty(e)?[a+"/>"]:[a+">",e,"</"+s+">"]}return e}_encodeChildren(e=!1){const t=o.map(this.children,(e=>e&&e.encode())),s=o.first(t);return e&&1===t.length&&s?s:t}}U._messageTypes=[],t.InternalNode=U;class j extends U{constructor(e,t=!1){super(e,j._defaultTag),this._parsingFailed=t}parsingFailed(){return this._parsingFailed}accept(e){return e.transformRootNode(this)}encode(){return this._encodeChildren(!0)}isEmptyTextNodeOrContainingWhitespacesOnly(){return o.every(this.children,(e=>!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))}isEmptyTextNodeOrContainingSpaceCharsOnly(){return o.every(this.children,(e=>!!e&&e.isEmptyTextNodeOrContainingSpaceCharsOnly()))}hasOnlyEmoticonsOrSpaceChars(){return o.every(this.children,(e=>e instanceof $||!!e&&e.isEmptyTextNodeOrContainingSpaceCharsOnly()))}hasOnlyEmoticonsOrWhitespaceText(){return o.every(this.children,(e=>e instanceof $||!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))}hasOnlyUnicodeEmoji(){return o.every(this.children,(e=>e instanceof X||!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))}getNumberOfEmoticons(){return o.size(o.filter(this.children,(e=>e instanceof $)))}getNumberOfDiverseEmoticons(){const e=o.filter(this.children,(e=>e instanceof $));return o.size(o.filter(e,(e=>e.tone&&e.tone!==I.DefaultDiverseTone)))}getNumberOfUnicodeEmoji(){return o.size(o.filter(this.children,(e=>e instanceof X)))}getNumberOfDirectMentions(){return o.size(o.filter(this.children,(e=>e instanceof q&&F.default.unescapeXml(e.id)!==q.AllMentionId)))}hasAllMention(){return o.some(this.children,(e=>e instanceof q&&F.default.unescapeXml(e.id)===q.AllMentionId))}hasMagicBotMention(){return o.some(this.children,(e=>e instanceof q&&F.default.unescapeXml(e.id)===a.default.getS4LMessagingFeaturesNoSubscription().magicBotId))}getLinkNodeChildren(){return o.filter(this.children,(e=>e instanceof ie))}getNumberOfWebLinks(){return o.size(o.filter(this.getLinkNodeChildren(),(e=>e.getUrlType()===O.UrlType.Web)))}hasOnlyWebLinks(){return o.every(this.children,(e=>e instanceof ie&&e.getUrlType()===O.UrlType.Web))}getWebLinks(){return(0,d.chain)(this.getLinkNodeChildren(),(0,d.filter)((e=>e.getUrlType()===O.UrlType.Web)),(0,d.map)((e=>e.getSanitizedHref())))}hasOnlyQuotedContent(){return o.every(this.children,(e=>e instanceof Y||!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))}getFirstUriObjectChild(e){let t;return o.each(this.children,(s=>(t=s&&s.getUriObjectNode(e),!t))),t}getFirstContactNode(){let e;return o.each(this.children,(t=>(t instanceof ke&&t.children.length&&(e=t.children[0]),!e))),e}getQuoteNodes(){const e=[];return o.each(this.children,(t=>{t instanceof Y&&e.push(t)})),e}hasWikiMarkup(){return o.some(this.children,(e=>e instanceof te))}hasHtmlContent(){return o.some(this.children,(e=>e instanceof G))||o.some(this.getQuoteNodes(),(e=>o.some(e.children,(e=>e instanceof G))))}isOnlyHyperLink(){var e,t;const s=this.children&&this.children[0];if(s&&1===(null===(e=s.children)||void 0===e?void 0:e.length)&&s instanceof ie){return s.getSanitizedHref()!==(s.children[0]instanceof W&&(null===(t=s.children[0])||void 0===t?void 0:t.getEscapedText()))}return!1}static parse(e,t={}){if(o.isEmpty(t))return new j(e,o.some(e,(e=>!e)));C.warn(S.LogTraceArea.GenericUnsafe,"Parsed RootNode has unknown attributes",t)}}j._defaultTag=V.registerForXml(m.rootTagName,j.parse),t.RootNode=j;class H extends U{constructor(e,t,s,i){super(e,s),this.attributes=t,this.item=i}cloneWithChildren(e){return H.parse(e,this.encodedAttr(),this.getTag(),void 0)}accept(e){return e.transformUnknownNode(this)}encodedAttr(){return this.attributes}static parse(e,t,s,i){return new H(e,t,s,i)}}H._defaultTag=V.registerInvalid(""),t.UnknownNode=H;class z extends U{static register(e,t){return V.registerForXmlWithMessageTypes(e,t,c.MessageTypes.RichText)}accept(e){throw"Must override"}}class W extends z{constructor(e,t,s){super([],e),this._escapedText=t,this._text=s}getRawText(){return void 0===this._text&&(this._text=F.default.unescapeXml(this._escapedText)),this._text}getEscapedText(){return void 0===this._escapedText&&(this._escapedText=F.default.escapeXml(this._text)),this._escapedText}static merge(e){const t=o.map(e,(e=>e.encode())).join("");return W.fromEscapedXml(t)}cloneWithChildren(e){return W.fromEscapedXml(this.getEscapedText())}accept(e){return e.transformPlainTextNode(this)}encode(){return this.getTag()===W._lineBreakTag?"<br/>":this.getEscapedText()}isEmptyTextNodeOrContainingWhitespacesOnly(){return""===this.getEscapedText().trim()}isEmptyTextNodeOrContainingSpaceCharsOnly(){return""===this.getEscapedText().replace(/ /g,"")}static parse(e,t,s){if(s===W._lineBreakTag)return new W(W._lineBreakTag,void 0,"\n")}static fromPlainText(e){return new W(W._defaultTag,void 0,e)}static fromEscapedXml(e){return new W(W._defaultTag,e,void 0)}}W._defaultTag=V.registerInvalid("_text"),W._lineBreakTag=z.register("br",W.parse),t.PlainTextNode=W;class G extends z{constructor(e,t){super(e,G._defaultTag),this.children=e,this._dom=t,this._searchQuery="",this._isPrimarySearchResult=!1,this._isQuote=!1}cloneWithChildren(e){const t=new G(e,this._dom);return t._searchQuery=this._searchQuery,t._isPrimarySearchResult=this._isPrimarySearchResult,t._isQuote=this._isQuote,t}accept(e){return e.transformHtmlNode(this)}encode(){return i.DomUtils.getOuterHTML(this.getHtmlDom(),{decodeEntities:!1,xmlMode:!0})}getHtmlDom(){return this._dom.value}cloneAsSearchResult(e,t){const s=this.cloneWithChildren(this.children);return s._searchQuery=e,s._isPrimarySearchResult=t,s}cloneAsQuote(){const e=this.cloneWithChildren(this.children);return e._isQuote=!0,e}getSearchQuery(){return this._searchQuery}isPrimarySearchResult(){return this._isPrimarySearchResult}isQuote(){return this._isQuote}static parse(e,t){let s;const n=new i.DomHandler(((e,t)=>{e?C.warn(S.LogTraceArea.GenericUnsafe,"HtmlNode failed to parse HTML"):s=t})),r=new i.Parser(n,{decodeEntities:!1,xmlMode:!0});r.write(y.default.sanitizeHtml(e)),r.end();const a=[];if(t){const e=c.getTeamsFileProperties(t.properties);o.each(e,(e=>{const t=e.fileInfo&&(e.fileInfo.shareUrl||e.fileInfo.fileUrl);if(t){const s=L.default.createSanitizedHref(t);if(s&&s.href){o.isEmpty(a)||a.push(W.fromPlainText("\n"));const i=e.fileName||s.href,n=W.fromPlainText(i);a.push(new ie([n],t,s.href,s.urlType))}}}))}return s?new G(a,new v.default(s)):void 0}}G._defaultTag=V.registerForJson(c.MessageTypes.TeamsHtml,G.parse),t.HtmlNode=G;class K extends z{constructor(e,t,s,i){super([],K._defaultTag),this.fallbackSkypeId=e,this.originalArrivalTime=t,this.originalArrivalTimeSeconds=s,this.messageTypeEnum=i}accept(e){return e.transformEditMessageMetaDataNode(this)}encodedAttr(){return{a:this.fallbackSkypeId,ts_ms:this.originalArrivalTime,ts:this.originalArrivalTimeSeconds,t:this.messageTypeEnum}}isEmptyTextNodeOrContainingWhitespacesOnly(){return!0}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!0}static parse(e,t){const s=t.a&&o.isString(t.a)&&F.default.unescapeXml(t.a),i=t.ts_ms?parseInt(t.ts_ms,10):void 0,n=t.ts?parseInt(t.ts,10):void 0,r=t.t&&parseInt(t.t,10);if((n||i)&&s&&r===K.ExpectedT)return new K(s,i,n,r)}}K.ExpectedT=61,K._defaultTag=z.register("e_m",K.parse),t.EditMessageMetaDataNode=K;class q extends z{constructor(e,t,s,i){super(e,q._defaultTag),this.children=e,this.id=t,this.isLegacyAtMention=s,this.itemid=i}accept(e){return e.transformAtMentionNode(this)}encodedAttr(){return{id:this.id,itemid:this.itemid}}isAllMention(){return this.id===q.AllMentionId||this.id===q.AllMentionIdNonAlerting}isInQuote(){return this.id===q.DirectMentionIdNonAlerting||this.id===q.AllMentionIdNonAlerting}getLocalizedAllMention(){return _.getString("MessageComposer.QouteAll")}static transformToNonAlertingNode(e){const t=e.isAllMention()?q.AllMentionIdNonAlerting:q.DirectMentionIdNonAlerting;return new q(e.children,t,e.isLegacyAtMention,void 0)}static parse(e,t){if(!e||!t.id)return;let s=!1;if(o.every(e,(e=>e instanceof W))){s="@"===W.merge(e).getRawText()[0]}return new q(e,t.id,s,t.itemid)}}q.AllMentionId="*",q.AllMentionIdNonAlerting="_*_",q.DirectMentionIdNonAlerting=" ",q._defaultTag=z.register("at",q.parse),t.AtMentionNode=q;class Q extends z{constructor(e,t){super([e],Q._defaultTag),this.textNode=e,this.mri=t}accept(e){return e.transformUserMriNode(this)}encodedAttr(){return{mri:this.mri}}static parse(e,t){const s=Se(e);if(s&&t.mri)return new Q(s,t.mri)}}Q._defaultTag=z.register("usermri",Q.parse),t.UserMriNode=Q;class X extends z{constructor(e){super([e],X._defaultTag),this.emojiTextNode=e}accept(e){return e.transformUnicodeEmojiNode(this)}static parse(e){const t=Se(e);if(t)return new X(t)}static fromPlainText(e){return new X(W.fromPlainText(e))}}X._defaultTag=z.register("_emoji",X.parse),t.UnicodeEmojiNode=X;class $ extends z{constructor(e,t,s){super([e],$._defaultTag),this.type=t,this.tone=s}accept(e){return e.transformEmoticonNode(this)}encodedAttr(){return this.tone?{type:this.type,tone:this.tone}:{type:this.type}}static parse(e,t){const s=Se(e);if(s&&t.type){const e=t.tone?M.default.getItemToneFromString(t.tone):void 0;return new $(s,t.type,e)}}}$._defaultTag=V.registerForXml("ss",$.parse),t.EmoticonNode=$;class J extends z{constructor(e,t){super([e],J._defaultTag),this.country=t}accept(e){return e.transformFlagNode(this)}encodedAttr(){return{country:this.country}}static parse(e,t){const s=Se(e);if(s&&t.country)return new J(s,t.country)}}J._defaultTag=V.registerForXml("flag",J.parse),t.FlagNode=J;class Y extends z{constructor(e,t,s,i,o,n,r){super(e,Y._defaultTag),this.author=t,this.authorname=s,this.timestamp=i,this.conversation=o,this.messageid=n,this.cuid=r}getAuthorNameWithFallbackUnescaped(){return F.default.unescapeXml(this.authorname||this.author)}accept(e){return e.transformQuoteNode(this)}encodedAttr(){return{author:this.author,authorname:this.authorname,timestamp:this.timestamp,conversation:this.conversation,messageid:this.messageid,cuid:this.cuid}}static parse(e,t,s,i){const n=t.timestamp?parseInt(t.timestamp,10):void 0;if((t.author||t.authorname)&&o.isFinite(n)){const s=a.default.getS4LMessagingFeaturesNoSubscription().enableParsingHtmlMessages?o.map(e,(e=>{if(e&&"div"===e.getTag()){const t=G.parse(e.encodeToString(),i);return t?t.cloneAsQuote():void 0}return e})):e;return new Y(s,t.author,t.authorname,n,t.conversation,t.messageid,t.cuid)}}}Y._defaultTag=V.registerForXmlWithMessageTypes("quote",Y.parse,c.MessageTypes.RichText,c.MessageTypes.EncryptedText),t.QuoteNode=Y;class Z extends z{constructor(e,t,s,i){super([e],Z._defaultTag),this._isBackgroundTransparent=!!t,this._isOwnMessage=!!s,this._isGlobalSearch=!!i}cloneWithChildren(e){return Z.parse(e,this._isBackgroundTransparent,this._isOwnMessage,this.encodedAttr(),this._isGlobalSearch)}accept(e){return e.transformHighlightedNode(this,this._isBackgroundTransparent,this._isOwnMessage,this._isGlobalSearch)}static fromPlainText(e,t,s,i){return new Z(W.fromPlainText(e),t,s,i)}static parse(e,t,s,i,n){o.isEmpty(i)||C.warn(S.LogTraceArea.GenericUnsafe,"attributes ignored while creating HighlightNode");const r=o.first(e);if(r)return new Z(r,t,s,n)}}Z._defaultTag=V.registerInvalid("_highlighted"),t.HighlightedNode=Z;class ee extends z{constructor(e){super([e],ee._defaultTag)}accept(e){return e.transformLegacyQuoteNode(this)}static parse(e){if(o.every(e,(e=>e instanceof W))){const t=W.merge(e);return new ee(t)}}}ee._defaultTag=V.registerForXmlWithMessageTypes("legacyquote",ee.parse,c.MessageTypes.RichText,c.MessageTypes.EncryptedText),t.LegacyQuoteNode=ee;class te extends z{constructor(e,t,s,i){super(e,t),this.rawPre=s,this.rawPost=i,this.rawPreNode=W.fromEscapedXml(s),i&&(this.rawPostNode=W.fromEscapedXml(i))}accept(e){return e.transformWikiMarkupNode(this)}encodedAttr(){return{raw_pre:this.rawPre,raw_post:this.rawPost}}static parse(e,t,s){const i=t.raw_pre||te._tagToDefaultMarkup[s],n=(i||"").toLowerCase().trim(),r=t.raw_post||te._preToPostDefaultMarkup[n];if(o.includes(te._tags,s)&&i)return new te(e,s,i,r)}}te._tagToDefaultMarkup={b:"*",i:"_",s:"~",pre:"```"},te._preToPostDefaultMarkup={"*":"*",_:"_","~":"~","```":"```","{code}":"{code}","!!":void 0},te._tags=o.map(o.keys(te._tagToDefaultMarkup),(e=>V.registerForXml(e,te.parse))),t.WikiMarkupNode=te;class se extends te{constructor(e,t,s,i,o,n,r){super(e,t,s,i),this.level=o,this.order=n,this.ordered=r,this.rawPreNode="li"===t?W.fromPlainText("  ".repeat(o)+(r?`${n}. `:s)):this.rawPreNode}accept(e){return e.transformListWikiMarkupNode(this)}encodedAttr(){return Object.assign(Object.assign({},super.encodedAttr()),{level:this.level,order:this.order,ordered:+this.ordered})}_updateChildren(e){return se._childrenUpdater[this.getTag()](this.children,e)}static parse(e,t,s){var i,o,n;const r=null!==(i=t.raw_pre)&&void 0!==i?i:se._tagToDefaultMarkup[s],a=(null!=r?r:"").toLowerCase();let l=null!==(o=t.raw_post)&&void 0!==o?o:se._preToPostDefaultMarkup[a];const d=+(t.level||0),c=+(t.order||1),h=!!+(null!==(n=t.ordered)&&void 0!==n?n:"ol"===s);if(l="li"===s&&e.some((e=>e instanceof se))?"":l,e="li"===s?e.map((e=>e instanceof W?W.fromPlainText(e.getRawText().trim()):e)):e.filter((e=>e instanceof se)),se._tags.includes(s))return new se(se._childrenUpdater[s](e,d),s,r||"",l,d,c,h)}static _update(e,t,s,i){const o=e.rawPre||(["ul","ol"].includes(e.getTag())&&t>0?"\n":"");return new se(e._updateChildren(t),e.getTag(),o,e.rawPost,t,s,i)}}se._childrenUpdater={li:(e,t)=>e.map((e=>e instanceof se?se._update(e,t+1,e.order,e.ordered):e)),ul:(e,t)=>e.filter((e=>e instanceof se)).map((e=>se._update(e,t,e.order,!1))),ol:(e,t)=>e.filter((e=>e instanceof se)).map(((e,s)=>se._update(e,t,s+1,!0)))},se._tagToDefaultMarkup={li:"- ",ul:"",ol:""},se._preToPostDefaultMarkup={"- ":"\r","":void 0},se._tags=Object.keys(se._tagToDefaultMarkup).map((e=>V.registerForXml(e,se.parse))),t.ListWikiMarkupNode=se;class ie extends z{constructor(e,t,s,i){super(e,ie._defaultTag),this._href=t,this._sanitizedHref=s,this._urlType=i}getSanitizedHref(){return this._sanitizedHref}getUrlType(){return this._urlType}accept(e){return e.transformLinkNode(this)}encodedAttr(){return{href:this._href}}static parse(e,t){if(t.href){const s=L.default.createSanitizedHref(F.default.unescapeXml(t.href));if(s&&s.href)return new ie(e,t.href,s.href,s.urlType)}}static parseFromHref(e){const t=F.default.escapeXml(e);return ie.parse([W.fromEscapedXml(t)],{href:t})}}ie._defaultTag=V.registerForXml("a",ie.parse),t.LinkNode=ie;class oe extends z{constructor(e){super(e,oe._defaultTag)}accept(e){return e.transformBingResponseNode(this)}static parse(e){return new oe(e)}}oe._defaultTag=V.registerForXml("bing-response",oe.parse),t.BingResponseNode=oe;class ne extends z{constructor(e,t,s,i,o,n,r,a){super(e,ne._defaultTag),this._href=t,this._sanitizedHref=s,this.index=i,this.anchor=o,this.title=n,this.description=r,this.logo=a}getSanitizedHref(){return this._sanitizedHref}accept(e){return e.transformAttributionNode(this)}encodedAttr(){return{href:this._href,index:this.index,anchor:this.anchor}}static parse(e,t){var s;const i=t.index&&F.default.unescapeXml(t.index),o=t.anchor&&F.default.unescapeXml(t.anchor),n=t.title&&F.default.unescapeXml(t.title),r=t.description&&F.default.unescapeXml(t.description),l=t.logo&&F.default.unescapeXml(t.logo);if(a.default.getS4LMessagingFeaturesNoSubscription().enableMagicBotAttributions&&i&&o)if(t.href){const s=L.default.createSanitizedHref(F.default.unescapeXml(t.href));if(null==s?void 0:s.href)return new ne(e,t.href,s.href,i,o,n,r,l)}else if(e.some((e=>e instanceof ie))){const t=null===(s=e.find((e=>e instanceof ie)))||void 0===s?void 0:s.getSanitizedHref();if(t)return new ne(e,t,t,i,o,n,r,l)}}}ne._defaultTag=V.registerForXml("attribution",ne.parse),t.AttributionNode=ne;class re extends z{constructor(e,t,s){super(e,re._defaultTag),this._href=t,this._sanitizedHref=s}getSanitizedHref(){return this._sanitizedHref}accept(e){return e.transformAttributionsTextNode(this)}static parse(e,t){var s;const i=a.default.getS4LMessagingFeaturesNoSubscription().enableMagicBotAttributions,o=t.href&&(null===(s=L.default.createSanitizedHref(F.default.unescapeXml(t.href)))||void 0===s?void 0:s.href);return i?new re(e,t.href,o):void 0}encodedAttr(){return{href:this._href}}}re._defaultTag=V.registerForXml("attributions-text",re.parse),t.AttributionsTextNode=re;class ae extends z{constructor(e){super(e,ae._defaultTag)}accept(e){return e.transformAttributionsGroupNode(this)}static parse(e){const t=a.default.getS4LMessagingFeaturesNoSubscription().enableMagicBotAttributions,s=e.filter((e=>ae._attributionsGroupMembers.some((t=>e instanceof t))));return t?new ae(s):void 0}}ae._attributionsGroupMembers=[ne,re],ae._defaultTag=V.registerForXml("attributions-group",ae.parse),t.AttributionsGroupNode=ae;class le extends z{constructor(e,t){super([],le._defaultTag),this.escapedAuthorMri=e,this.escapedFallbackText=t}cloneWithChildren(e){return new le(this.escapedAuthorMri,this.escapedFallbackText)}accept(e){return e.transformEmoteNode(this)}encode(){}isEmptyTextNodeOrContainingWhitespacesOnly(){return!1}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!1}}le._defaultTag=V.registerInvalid("_emote"),t.EmoteNode=le;class de extends z{constructor(e,t,s){super([e],de._defaultTag),this.textNode=e,this.activityId=t,this._actionsIndexes=s}getActionsIndexes(){return o.compact(o.map(this._actionsIndexes.split(";"),(e=>parseInt(e,10))))}getActivityId(){return this.activityId}getPhrase(){return this.textNode.getRawText()}accept(e){return e.transformSuggestedTextHighlightNode(this)}getAttr(){return{actionsIndex:this._actionsIndexes,activityId:this.activityId}}static parse(e,t){const s=Se(e);if(s&&t.activityId)return new de(s,t.activityId,t.actionsIndex)}}de._defaultTag=z.register("highlightedEntity",de.parse),t.SuggestedTextHighlightNode=de;class ce extends z{constructor(e,t){super([],ce._defaultTag),this.id=e,this.name=t}accept(e){return e.transformRosterContextNode(this)}encodedAttr(){return{id:this.id,name:this.name}}static parse(e,t){if(t.id&&t.name)return new ce(t.id,t.name)}}ce._defaultTag=z.register("roster",ce.parse),t.RosterContextNode=ce;class he extends z{constructor(){super([],he._defaultTag)}static parse(){return new he}}he._defaultTag=z.register("newTopic",he.parse),t.NewTopicContextNode=he;class ue extends z{constructor(e,t){super([],ue._defaultTag),this.encrypted=e,this.source=t}accept(e){return e.transformLocationContextNode(this)}encodedAttr(){return{encrypted:this.encrypted,source:this.source}}static parse(e,t){if(t.encrypted&&t.source)return new ue(t.encrypted,t.source)}}ue._messageTypes=[c.MessageTypes.RichText],ue._defaultTag=V.registerForXmlWithMessageTypes("location",ue.parse,...ue._messageTypes),t.LocationContextNode=ue;class pe extends z{constructor(e,t){super(e,pe._defaultTag),this._attributes=t}getContextForKey(e){const t=F.default.escapeXml(e),s=this._attributes[t];return s?F.default.unescapeXml(""+s):void 0}accept(e){return e.transformContextNode(this)}encodedAttr(){return this._attributes}isEmptyTextNodeOrContainingWhitespacesOnly(){return!0}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!0}static parse(e,t){if(t)return new pe(e,t)}}pe._defaultTag=z.register(g.contextTagName,pe.parse),t.ContextNode=pe;class ge extends z{constructor(e){super([],ge._defaultTag),this.layoutOption=e}cloneWithChildren(){return new ge(this.layoutOption)}accept(e){return e.transformCallerIDNode(this)}encodedAttr(){return{layoutOption:this.layoutOption}}static parse(e,t){return new ge(t.layoutOption||"text")}}ge._defaultTag=V.registerForXml("_callerid",ge.parse),t.CallerIDNode=ge;class me extends U{}function Se(e,t=!1){if(1===e.length){const t=e[0];if(t instanceof W)return t}else{if(0===e.length&&t)return W.fromEscapedXml("");if(o.every(e,(e=>e instanceof W)))return W.merge(e)}}function fe(e,t){const s=e[t];if(s&&1===s.length)return s[0]}function ye(e){const t=o.groupBy(e,(e=>e&&e.getTag())),s=fe(t,_e.tags.EventTime),i=fe(t,_e.tags.Initiator),n=function(e){const t=fe(e,m.multiTargetsTagName),s=e[m.targetTagName];return t&&s?s.concat(t.children):t?t.children:s&&s.length?s:void 0}(t);return s&&i&&n?[s,i,n]:void 0}function ve(e){const t=o.groupBy(e,(e=>e&&e.getTag())),s=fe(t,_e.tags.EventTime),i=fe(t,_e.tags.Initiator),n=fe(t,_e.tags.Value);return s&&i&&n?[s,i,n]:void 0}var Ce;!function(e){e[e.None=0]="None",e[e.NonEmpty=1]="NonEmpty",e[e.Mri=2]="Mri",e[e.Number=3]="Number"}(Ce||(Ce={}));class _e extends me{getRawText(){return this._rawText}getMessageTypes(){return _e._messageTypes}constructor(e,t){super([e],t),this._rawText=e.getRawText()}accept(e){return e.transformTextWrapperNode(this)}static parse(e,t,s){if(!_e._tagChecks.hasOwnProperty(s)){const i=o.includes(_e._registeredTags,s)?"unregistered (but known)":"unknown";return void C.warn(S.LogTraceArea.GenericUnsafe,"TextWrapperNode.parse called with "+i+" tag",e,t,s)}const i=_e._tagChecks[s];let n=Se(e,i.check===Ce.None);if(n){switch(i.check){case Ce.None:case Ce.NonEmpty:break;case Ce.Mri:const e=n.getRawText(),t=/^(\d+:[^;]+)/.exec(e),s=t&&t[1];if(!s||!h.isMri(s))return;e!==s&&(n=W.fromPlainText(s));break;case Ce.Number:if(!o.isFinite(parseInt(n.getRawText(),10)))return}return new _e(n,s)}}}_e._messageTypes=[c.MessageTypes.RoleUpdate,c.MessageTypes.Call],_e.tags={EventTime:"eventtime",Initiator:"initiator",Id:"id",Role:"role",Value:"value",Name:"name",Duration:"duration"},_e._tagChecks={[_e.tags.EventTime]:{check:Ce.Number,messagetypes:[]},[_e.tags.Initiator]:{check:Ce.Mri,messagetypes:[]},[_e.tags.Id]:{check:Ce.Mri,messagetypes:[c.MessageTypes.RoleUpdate]},[_e.tags.Role]:{check:Ce.NonEmpty,messagetypes:[c.MessageTypes.RoleUpdate]},[_e.tags.Value]:{check:Ce.None,messagetypes:[]},[_e.tags.Name]:{check:Ce.NonEmpty,messagetypes:[c.MessageTypes.Call]},[_e.tags.Duration]:{check:Ce.Number,messagetypes:[c.MessageTypes.Call]}},_e._registeredTags=o.map(_e._tagChecks,((e,t)=>e.messagetypes&&e.messagetypes.length?V.registerForXmlWithMessageTypes(t,_e.parse,...e.messagetypes):V.registerForXml(t,_e.parse))),t.TextWrapperNode=_e;class be extends me{constructor(e){super(e,be._defaultTag)}getRawText(){const e=o.head(this.children);if(e.getRawText)return e.getRawText();return C.warn(S.LogTraceArea.GenericUnsafe,"TargetNode.children[0] is not an IPlainTextNode",this),""}getMessageTypes(){return be._messageTypes}static parse(e){return 1===e.length?Te.parseTargetUser(e):2===e.length?Ie.parseTargetRole(e):void 0}}be._messageTypes=[c.MessageTypes.AddMember,c.MessageTypes.RoleUpdate,c.MessageTypes.DeleteMember,c.MessageTypes.LegacyMemberAdded,c.MessageTypes.LegacyMemberUpgraded,c.MessageTypes.HandshakeInvite,c.MessageTypes.HandshakeAccept,c.MessageTypes.HandshakeComplete,c.MessageTypes.HandshakeReject,c.MessageTypes.GuestNameUpdate],be._defaultTag=V.registerForXmlWithMessageTypes(m.targetTagName,be.parse,...be._messageTypes),t.TargetNode=be;class Te extends be{accept(e){return e.transformTargetUserNode(this)}static parseTargetUser(e){const t=Se(e),s=t?t.getRawText():void 0;if(s&&h.isMri(s)&&t)return new Te([t])}}t.TargetUserNode=Te;class Me extends Te{accept(e){return e.transformTargetLegacyUserNode(this)}static parseTargetLegacyUser(e){const t=Se(e);if(t)return new Me([t])}}t.TargetLegacyUserNode=Me;class Ie extends be{constructor(e,t){super([e,t]),this.idChild=e,this.roleChild=t}accept(e){return e.transformTargetRoleNode(this)}static parseTargetRole(e){const t=o.groupBy(e,(e=>e&&e.getTag())),s=fe(t,_e.tags.Id),i=fe(t,_e.tags.Role);if(s&&i)return new Ie(s,i)}}t.TargetRoleNode=Ie;class we extends me{constructor(e){super(e,we._defaultTag)}accept(e){return e.transformTargetsNode(this)}getMessageTypes(){return we._messageTypes}static parse(e){if(e.length>0&&o.every(e,(e=>e instanceof be)))return new we(e)}}we._messageTypes=[c.MessageTypes.AddMember,c.MessageTypes.RoleUpdate,c.MessageTypes.DeleteMember,c.MessageTypes.LegacyMemberAdded,c.MessageTypes.LegacyMemberUpgraded,c.MessageTypes.GuestNameUpdate],we._defaultTag=V.registerForXmlWithMessageTypes(m.multiTargetsTagName,we.parse,...we._messageTypes),t.TargetsNode=we;class Pe extends me{constructor(e,t,s,i){super([],Pe._defaultTag),this.skypeId=e,this.fullName=t,this.isPstn=s,this.isS4B=i,this.fullName&&(this.fullName=F.default.unescapeXml(this.fullName))}static getEncodedTypeAttr(e=!1,t=!1){return e?"":t?"b":"s"}accept(e){return e.transformContactNode(this)}encodedAttr(){return{t:Pe.getEncodedTypeAttr(this.isPstn,this.isS4B),s:this.skypeId,f:this.fullName}}getMessageTypes(){return Pe._messageTypes}static parse(e,t){let s,i,o=!1,n=!1;if("s"===t.t)s=t.s,i=t.f?t.f:"";else if("b"===t.t)s=t.s,i=t.f?t.f:"",n=!0;else{s=i=t.p||t.s,o=!0}if(0===e.length&&(s||i))return new Pe(s,i,o,n)}}Pe._messageTypes=[c.MessageTypes.Contacts,c.MessageTypes.RichText],Pe._defaultTag=V.registerForXmlWithMessageTypes("c",Pe.parse,...Pe._messageTypes),t.ContactNode=Pe;class ke extends me{constructor(e){super(e,ke._defaultTag)}accept(e){return e.transformContactsNode(this)}getMessageTypes(){return ke._messageTypes}static parse(e){if(e.length>0&&o.every(e,(e=>e instanceof Pe)))return new ke(e)}}ke._messageTypes=[c.MessageTypes.Contacts],ke._defaultTag=V.registerForXmlWithMessageTypes("contacts",ke.parse,...ke._messageTypes),t.ContactsNode=ke;class Ae extends me{constructor(e,t){super(e,Ae._defaultTag),this._smsContentEscaped=t,this.smsContentUnescaped=F.default.unescapeXml(this._smsContentEscaped)}accept(e){return e.transformSmsNode(this)}encodedAttr(){return{alt:this._smsContentEscaped}}getMessageTypes(){return Ae._messageTypes}static parse(e,t){const s=o.find(e,(e=>e instanceof H&&"defaults"===e.getTag())),i=s&&o.find(s.children,(e=>e instanceof H&&"content"===e.getTag())),n=i&&o.find(i.children,(e=>e instanceof H&&"body"===e.getTag()));if(n&&n.children&&n.children.length>=1&&n.children[0]instanceof W){const t=n.children[0];return new Ae(e,t.encode())}if(o.isString(t.alt))return new Ae(e,t.alt)}}Ae._messageTypes=[c.MessageTypes.Sms],Ae._defaultTag=V.registerForXmlWithMessageTypes("sms",Ae.parse,...Ae._messageTypes),t.SmsNode=Ae;class xe extends me{constructor(e,t,s){super([],xe._defaultTag),this.rawContent=e,this.content=t,this.contentNodes=s}accept(e){return e.transformMmsNode(this)}encode(){return this.rawContent}getMessageTypes(){return xe._messageTypes}getUriObjectNode(e){let t;return o.each(this.contentNodes,(s=>(t=s.getUriObjectNode(e),!t))),t}static parseMms(e){if(e){const t=A.default.parseJsonErrorable(e);if(!o.isError(t)&&t&&t.content_list){const s=o.map(t.content_list,(e=>{if(!(e&&e.headers&&e.headers.content_type&&e.content&&e.content.location))return null;const t=e.content.location.toLowerCase();if(e.headers.content_type.indexOf("text/plain")>-1){const s=e.content.text;if(s&&"inline"===t)return W.fromPlainText(s)}else if(e.headers.content_type.indexOf("image/")>-1){const s=e;if("ams"===t&&s.content.object_id){const e=l.getDocumentUrls(s.content.object_id,R.UploadFileType.Picture);return We.parse([],{uri:e.original,url_thumbnail:e.preview,type:"Picture.1"})}}return null})),i=o.compact(s);if(!i.length&&t.subject){const e=W.fromPlainText(t.subject);i.push(e)}if(i.length)return new xe(e,t,i)}}return xe._parseFallback(e)}static parse(e,t){return C.warn(S.LogTraceArea.GenericUnsafe,"MmsNode.parse called",e,t),xe._parseFallback(void 0)}static _parseFallback(e){const t=W.fromPlainText(_.getString("MessageContentNodes.MmsFallback"));return new xe(e,void 0,[t])}}xe._messageTypes=[c.MessageTypes.Mms],xe._defaultTag=V.registerForJson(c.MessageTypes.Mms,xe.parseMms),t.MmsNode=xe;class Re extends me{constructor(e,t,s,i,o,n,r,a,l,d){super(e,Re._defaultTag),this._attributes=t,this.isUserLocation=s,this.latitude=i,this.longitude=o,this.addressSanitized=n,this.userMri=r,this.shortAddressSanitized=a,this.addressFriendlyNameSanitized=l,this.bingUrl=d}accept(e){return e.transformLocationNode(this)}encodedAttr(){return this._attributes}getMessageTypes(){return Re._messageTypes}static parse(e,t){if("allowNoLink"in t){return new Re(e,t,!0,void 0,void 0,void 0,void 0,void 0,void 0,"")}const s=o.find(e,(e=>e instanceof ie));if(s){const i=t,n=L.default.getURIComponents(s.getSanitizedHref());if(n&&n.host&&n.pathname&&"www.bing.com"===n.host.toLowerCase()&&("maps/"===n.pathname.toLowerCase()||"maps/default.aspx/"===n.pathname.toLowerCase())){const t="1"===i.isUserLocation;let n=o.isString(i.latitude)?parseInt(i.latitude,10):i.latitude;n=o.isFinite(n)?n:void 0;let r=o.isString(i.longitude)?parseInt(i.longitude,10):i.longitude;r=o.isFinite(r)?r:void 0;const a=i.address&&F.default.unescapeXml(i.address),l=i.userMri&&F.default.unescapeXml(i.userMri),d=i.shortAddress&&F.default.unescapeXml(i.shortAddress),c=i.addressFriendlyName&&F.default.unescapeXml(i.addressFriendlyName);return new Re(e,i,t,n,r,a,l,d,c,s.getSanitizedHref())}}}}Re._messageTypes=[c.MessageTypes.Location],Re._defaultTag=V.registerForXmlWithMessageTypes("location",Re.parse,...Re._messageTypes),t.LocationNode=Re;class Oe extends me{constructor(e,t){super([],Oe._defaultTag),this.type=e,this.originalName=t}accept(e){return e.transformMetaNode(this)}encodedAttr(){return{type:this.type,originalName:this.originalName}}getMessageTypes(){return Oe._messageTypes}static parse(e,t,s,i){let o=t.originalName;if(!o&&i){const e=E.exec(i.content);if(e&&1===e.length){const t=e[0],s=t.substring(t.indexOf("/")+1,t.length-1);o=F.default.newGuid()+"."+s}}if(0===e.length&&t.type&&o)return new Oe(t.type,o)}}Oe._messageTypes=[c.MessageTypes.UriObject],Oe._defaultTag=V.registerForXmlWithMessageTypes("meta",Oe.parse,...Oe._messageTypes),t.MetaNode=Oe;class Le extends me{constructor(e,t,s,i){super([e],Le._defaultTag),this.nameChild=e,this.size=t,this.index=s,this.tid=i}accept(e){return e.transformFileNode(this)}encodedAttr(){return{size:this.size,index:this.index,tid:this.tid}}getMessageTypes(){return Le._messageTypes}static parse(e,t){const s=Se(e);if(s){const e=t.size?parseInt(t.size,10):void 0,i=t.index?parseInt(t.index,10):void 0;if(o.isFinite(e)&&o.isFinite(i)&&t.tid)return new Le(s,e,i,t.tid)}}}Le._messageTypes=[c.MessageTypes.Files],Le._defaultTag=V.registerForXmlWithMessageTypes("file",Le.parse,...Le._messageTypes),t.FileNode=Le;class Fe extends me{constructor(e,t){super(e,Fe._defaultTag),this.alt=t}accept(e){return e.transformFilesNode(this)}encodedAttr(){return{alt:this.alt}}getMessageTypes(){return Fe._messageTypes}static parse(e,t){if((e=o.reject(e,(e=>!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))).length>0&&o.every(e,(e=>e instanceof Le)))return new Fe(e,t.alt)}}Fe._messageTypes=[c.MessageTypes.Files],Fe._defaultTag=V.registerForXmlWithMessageTypes("files",Fe.parse,...Fe._messageTypes),t.FilesNode=Fe;class Be extends me{constructor(e,t,s,i,n){if(super(e,Be._defaultTag),this._attr=t,this._sanitizedUrl=s,this._sanitizedThumbnailUrl=i,this._sanitizedAzureMSUrl=n,this._originalDimensions={width:void 0,height:void 0},t.width&&t.height){const e=parseInt(t.width,10),s=parseInt(t.height,10);e>0&&s>0&&(this._originalDimensions.width=e,this._originalDimensions.height=s)}const r=o.keyBy(e,(e=>e?e.getTag():"undefined")),a=r.OriginalName instanceof H?r.OriginalName:void 0;let l;a&&(l=a.encodedAttr().v,l&&(l=l.replace(/[\u202A-\u202E\u2066-\u2069]/g,""))),this._objectNameUnescaped=l&&F.default.unescapeXml(l),this._amsDocumentId=t.doc_id}getMessageTypes(){return Be._messageTypes}getNameForUI(){return this._objectNameUnescaped}getNameForDownload(){const e=this.getNameForUI();return e&&P.lossyForUserFile(e)}getOriginalDimensions(){return this._originalDimensions}accept(e){return e.transformUriObjectNode(this)}encodedAttr(){return this._attr}getUriObjectNode(e){return this instanceof e?this:void 0}getSubType(){if(this._attr.type){const e=this._attr.type.split("/");return Be._subtypeFromParts(e)}}static _subtypeFromParts(e){return e[1]?e[1].split(".")[0]:""}static parse(e,t,s,i){const o=!!i&&i.isMessageLie()&&T.default.isMyMri(i.creator),n=t.uri&&Be.sanitizeUrl(t.uri,o),r=Be.sanitizeUrl(t.url_thumbnail,o),a=Be.sanitizeUrl(t.url_azurems,o);return!t.doc_id&&n&&(t.doc_id=l.getDocumentId(n)),Be.parseFromSanitizedParts(e,t,n,r,a,i)}static sanitizeUrl(e,t){if(e){const s=F.default.unescapeXml(e);if(t){const e=f.FileUploadCacheUtils.getAbsoluteFromLocalCacheUri(s);if(L.default.isFileOrBlob(e))return e}if(a.default.isTrustedDomain(s,!0))return L.default.sanitizeUrl(s)}}static parseFromSanitizedParts(e,t,s,i,n,r){if(t.type){const o=t.type.split("/"),a=o[0].split(".")[0],l=this._subtypeFromParts(o);if("Sticker"===a)return Je.parseFromSanitizedParts(e,t,s,i);if("Picture"===a)return We.parseFromSanitizedParts(e,t,s,i);if("Video"===a&&l===c.UriObjectTypeSubTypes.Video.Flik)return $e.parseFromSanitizedParts(e,t,s,i);if("Video"===a&&l===c.UriObjectTypeSubTypes.Video.Message)return Ke.parseFromSanitizedParts(e,t,s,i,n);if("Video"===a)return Ge.parseFromSanitizedParts(e,t,s,i,n);if("Audio"===a&&l===c.UriObjectTypeSubTypes.Audio.Message)return Qe.parseFromSanitizedParts(e,t,s,i);if("Audio"===a)return qe.parseFromSanitizedParts(e,t,s,i);if("File"===a||"PDF"===a||"Word"===a||"Excel"===a||"Powerpoint"===a||"Zip"===a)return je.parseFromSanitizedParts(e,t,s,i,n);if("SWIFT"===a)return De.parseFromSanitizedParts(e,t,s,i);if("ScheduledCallInvite"===a)return Ue.parseFromSanitizedParts(e,t,s,i,n,r);if("Poll"===a)return vt.parseFromSanitizedParts(e,t,s,i,n);if("Cast"===a)return St.parseFromSanitizedParts(e,t,s,i)}else{const n=o.find(e,(e=>e instanceof Oe));if(n&&"photo"===n.type)return We.parseFromSanitizedParts(e,t,s,i)}}}Be._messageTypes=[c.MessageTypes.RichText,...c.UriObjectMessageTypes],Be._defaultTag=V.registerForXmlWithMessageTypes("URIObject",Be.parse,...Be._messageTypes),t.UriObjectNode=Be;class De extends Be{constructor(e,t,s,i,o){super(e,t,void 0,s,void 0),this.swiftChild=i,this.titleChild=o}accept(e){return e.transformSwiftUriObjectNode(this)}static parseFromSanitizedParts(e,t,s,i){const n=o.find(e,(e=>e instanceof Ve)),r=o.find(e,(e=>!!e&&"Title"===e.getTag()))||W.fromPlainText(_.getString("SwiftCard.Card"));if(i)return new De(e,t,i,n,r)}getCardType(){var e;if(!(null===(e=this.swiftChild)||void 0===e?void 0:e.swiftMessage))return;const t=this.swiftChild.swiftMessage.attachments;if(t&&t.length){const e=t[0].content;if(e&&e.images&&e.images.length)return e.images[0].type}}}t.SwiftUriObjectNode=De;class Ee extends me{constructor(){super([],Ee._defaultTag)}getMessageTypes(){return Ee._messageTypes}static isAdaptiveCardMessage(e){return!(!e.attachments||!o.isArray(e.attachments))&&o.some(e.attachments,(e=>e.contentType===n.AdaptiveCardContentTypes.adaptive))}_encodeParts(e,t,s,i=!1){return super._encodeParts(e,t,s,!0)}static parse(e,t,s,i){if(!t.b64)return;const o=u.atobUtf8(t.b64),n=o&&A.default.parseJsonErrorToUndefined(o);if(!n)return;const r=i?i.conversationId:void 0;if(Ee.isAdaptiveCardMessage(n))return Ne.parseAdaptiveCard(n,r,t.b64);{const e=i&&i.isMessageLie()&&T.default.isMyMri(i.creator),s=r&&(0,D.isContentChannel)((0,B.default)().getConversation(r))||(null==i?void 0:i.creator)&&(0,D.isTodayBot)(i.creator);return Ve.parseSwift(n,r,t.b64,!1,e,s)}}}Ee._messageTypes=[c.MessageTypes.RichText,c.MessageTypes.Media_Card],Ee._defaultTag=V.registerForXmlWithMessageTypes("Swift",Ee.parse,...Ee._messageTypes);class Ve extends Ee{constructor(e,t,s){super(),this.swiftMessage=e,this.conversationId=t,this.b64=s}accept(e){return e.transformSwiftNode(this)}encodedAttr(){if(!this.b64){const e=JSON.stringify(this.swiftMessage);this.b64=u.btoaUtf8(e)}return{b64:this.b64}}static parseSwift(e,t,s,i,o,n){const r=i?e:x.default.sanitizeSwiftMessage(e,o,n);return r?new Ve(r,t,s):void 0}}t.SwiftNode=Ve;class Ne extends Ee{constructor(e,t,s){super(),this.adaptiveCardMessage=e,this.conversationId=t,this.b64=s}accept(e){return e.transformAdaptiveCardNode(this)}encodedAttr(){if(!this.b64){const e=JSON.stringify(this.adaptiveCardMessage);this.b64=u.btoaUtf8(e)}return{b64:this.b64}}static parseAdaptiveCard(e,t,s){const i=a.default.getS4LMessagingFeaturesNoSubscription().enableAdaptiveCardLibs?e:r.default.sanitizeAdaptiveCardMessage(e);return i?new Ne(i,t,s):void 0}}t.AdaptiveCardNode=Ne;class Ue extends Be{constructor(e,t,s,i,o,n,r,a,l,d,c,h,u){super(e,t,s,i,o),this.subject=n,this.datetimeMs=r,this.reminder=a,this.conversationId=l,this.scheduledCallId=d,this.isSender=c,this.canceledTimeMs=h,this.editedTimeMs=u}accept(e){return e.transformScheduledCallInviteNode(this)}static parseFromSanitizedParts(e,t,s,i,n,r){const a=!!r&&T.default.isMyMri(r.creator),l=r&&r.conversationId,d=t.datetimeMs&&Number(t.datetimeMs)||void 0,c=t.canceledTimeMs&&Number(t.canceledTimeMs)||void 0,h=t.editedTimeMs&&Number(t.editedTimeMs)||void 0,u=t.reminder&&Number(t.reminder)||k.ScheduledCallReminder.Minutes15;if(d&&o.isString(t.scheduledCallId))return new Ue(e,t,s,i,n,o.isString(t.subject)?t.subject:void 0,d,u,l,t.scheduledCallId,a,c,h)}}t.ScheduledCallInviteNode=Ue;class je extends Be{constructor(e,t,s,i,n){super(e,t,s,i,n);const r=o.keyBy(this.children,(e=>e?e.getTag():"undefined")).FileSize;this._fileSubType=this._getFileSubType(t.type);const a=r?parseInt(r.encodedAttr().v,10):0;this._objectSizeUnescaped=o.isFinite(a)?a:0}_getFileSubType(e){var t;switch(null===(t=e.split("/")[1])||void 0===t?void 0:t.split(".")[0]){case"PDF":return R.UploadFileType.PDF;case"AVI":return R.UploadFileType.AVI;case"Zip":return R.UploadFileType.Zip;case"Audio":return R.UploadFileType.Audio;case"Word":return R.UploadFileType.Word;case"Excel":return R.UploadFileType.Excel;case"Powerpoint":return R.UploadFileType.Powerpoint;default:return R.UploadFileType.File}}getFileContentUrlSanitized(){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.File):this._sanitizedUrl||""}getDisplayThumbnailUrlSanitized(){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,this._fileSubType):this._sanitizedThumbnailUrl||""}getFileType(){return R.UploadFileType.File}getFileSubType(){return this._fileSubType}getSizeInBytes(){return this._objectSizeUnescaped}accept(e){return e.transformUriObjectFileNode(this)}static parseFromSanitizedParts(e,t,s,i,o){if(s)return new je(e,t,s,void 0,void 0)}}t.UriObjectFileNode=je;class He extends je{}t.DisplayableMedia=He;class ze extends He{}t.DisplayableMediaWithThumbnail=ze;class We extends ze{constructor(e,t,s,i,n){if(super(e,t,s,i,n),!this._objectNameUnescaped){const e=o.keyBy(this.children,(e=>e?e.getTag():"undefined")),t=e.meta instanceof Oe?e.meta:void 0;t&&t.originalName&&(this._objectNameUnescaped=t.originalName)}this._sanitizedThumbnailUrl||(this._sanitizedThumbnailUrl=this._sanitizedUrl)}getDisplayUrlSanitized(e=!1){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Picture,e?R.MediaViewSize.ThumbnailBlurred:R.MediaViewSize.MobilePreview):this._sanitizedUrl||""}getFullResolutionUrlSanitized(){return a.default.getS4LMessagingFeaturesNoSubscription().enableFullResolutionImageDownload?this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Picture,R.MediaViewSize.Full):this._sanitizedUrl||"":this.getDisplayUrlSanitized()}getDisplayMobilePreviewUrlSanitized(){return this.getDisplayUrlSanitized()}getDisplayUrlAsThumbnailSanitized(){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Picture,R.MediaViewSize.Thumbnail):this._sanitizedUrl||""}getDisplayThumbnailUrlSanitized(e=!1){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Picture,e?R.MediaViewSize.ThumbnailBlurred:R.MediaViewSize.ThumbnailUncropped):this._sanitizedThumbnailUrl||""}getFileType(){return R.UploadFileType.Picture}getNameForUI(){const e=super.getNameForUI();if(!e){return"Skype_Picture_"+(new Date).toISOString().replace(/[:\.\-]/g,"_")+".jpeg"}return e}accept(e){return e.transformPictureNode(this)}static parseFromSanitizedParts(e,t,s,i){if(s||i)return new We(e,t,s,i,void 0)}}We.parse=Be.parse,t.PictureNode=We;class Ge extends ze{getDisplayUrlSanitized(){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Video,R.MediaViewSize.Full):this._sanitizedUrl||""}getFullResolutionUrlSanitized(){return this.getDisplayUrlSanitized()}getDisplayUrlMediaProvider(){return m.MediaProvider.AMS}getDisplayThumbnailUrlSanitized(e=!1){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Video,e?R.MediaViewSize.ThumbnailBlurred:R.MediaViewSize.ThumbnailUncropped):this._sanitizedThumbnailUrl||""}getNameForUI(){const e=super.getNameForUI();return e||"Skype_Video.mp4"}getFileType(){return R.UploadFileType.Video}accept(e){return e.transformVideoNode(this)}static parseFromSanitizedParts(e,t,s,i,o){if(s||i||o)return new Ge(e,t,s,i,o)}}Ge.parse=Be.parse,t.VideoNode=Ge;class Ke extends Ge{getNameForUI(){const e=super.getNameForUI();return e||"Skype_Video_Message.mp4"}accept(e){return e.transformVideoMessageNode(this)}getFileType(){return R.UploadFileType.VideoMessage}static parseFromSanitizedParts(e,t,s,i,o){if(s||i||o)return new Ke(e,t,s,i,o)}}Ke.parse=Be.parse,t.VideoMessageNode=Ke;class qe extends He{getDisplayUrlSanitized(){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Audio,R.MediaViewSize.Full):this._sanitizedUrl||""}getFullResolutionUrlSanitized(){return this.getDisplayUrlSanitized()}accept(e){return e.transformAudioNode(this)}getFileType(){return R.UploadFileType.Audio}static parseFromSanitizedParts(e,t,s,i){if(s)return new qe(e,t,s,void 0,void 0)}}qe.parse=Be.parse,t.AudioNode=qe;class Qe extends qe{constructor(e,t,s,i,o){super(e,t,s,i,void 0),this.audioDurationMs=o}getDisplayUrlSanitized(){return this._amsDocumentId?l.getDisplayUrl(this._amsDocumentId,R.UploadFileType.AudioMessage,R.MediaViewSize.Full):this._sanitizedUrl||""}getAudioTranscritionUrlSanitized(){return this._amsDocumentId?l.getTranscriptionUrl(this._amsDocumentId):this._sanitizedUrl||""}accept(e){return e.transformAudioMessageNode(this)}getFileType(){return R.UploadFileType.AudioMessage}getAudioDurationMs(){return this.audioDurationMs}static parseFromSanitizedParts(e,t,s,i){if(s)return new Qe(e,t,s,void 0,Number(t.duration_ms)||void 0)}}Qe.parse=Be.parse,t.AudioMessageNode=Qe;class Xe extends me{constructor(e,t,s){super(e,Xe._defaultTag),this.attributes=t,this._albumId=s}getMessageTypes(){return Xe._messageTypes}encodedAttr(){return this.attributes}getAlbumId(){return this._albumId}accept(e){return e.transformMediaAlbumNode(this)}static parse(e,t){if(o.isString(t.albumId))return new Xe(e,t,t.albumId)}}Xe._messageTypes=[c.MessageTypes.MediaAlbum],Xe._defaultTag=V.registerForXmlWithMessageTypes("MediaAlbum",Xe.parse,...Xe._messageTypes),t.MediaAlbumNode=Xe;class $e extends Be{constructor(e,t,s,i,o){super(e,t,s,i,void 0),this.type=o}getSourceUrlSanitized(){return this._sanitizedUrl}accept(e){return e.transformMojiNode(this)}static parseFromSanitizedParts(e,t,s,i){if(s)return new $e(e,t,s,i,o.isString(t.type)?t.type:void 0)}}t.MojiNode=$e;class Je extends Be{constructor(e,t,s,i){super(e,t,s,i,void 0)}getSourceUrlSanitized(){return this._sanitizedUrl}accept(e){return e.transformStickerNode(this)}static parseFromSanitizedParts(e,t,s,i){if(s)return new Je(e,t,s,i)}}t.StickerNode=Je;class Ye extends me{constructor(e,t){super(e,Ye._defaultTag),this.attr=t}getMessageTypes(){return Ye._messageTypes}accept(e){return e.transformSkypeVideoMessageNode(this)}encodedAttr(){return this.attr}static parse(e,t){if(o.isString(t.sid)&&0!==t.sid.length)return new Ye(e,t)}}Ye._messageTypes=[c.MessageTypes.SkypeVideoMessage],Ye._defaultTag=V.registerForXmlWithMessageTypes("videomessage",Ye.parse,...Ye._messageTypes),t.SkypeVideoMessageNode=Ye;class Ze extends me{constructor(e,t,s,i){super([].concat(e,t,s),i),this.eventTime=e,this.initiator=t,this.content=s}static isCreatorTrusted(e){return!!e.creator&&h.isThread(e.creator)}}t.ThreadActivity=Ze;class et extends Ze{constructor(e,t,s,i){super(e,t,s,et._defaultTag),this.conversationId=i}getMessageTypes(){return et._messageTypes}accept(e){return e.transformAddMemberNode(this)}static parse(e,t,s,i){const n=ye(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof Te))&&i&&Ze.isCreatorTrusted(i))return new et(e,t,s,i.conversationId)}}}et._messageTypes=[c.MessageTypes.AddMember],et._defaultTag=V.registerForXmlWithMessageTypes("addmember",et.parse,...et._messageTypes),t.AddMemberNode=et;class tt extends Ze{constructor(e,t,s){super(e,t,s,tt._defaultTag)}getMessageTypes(){return tt._messageTypes}accept(e){return e.transformDeleteMemberNode(this)}static parse(e,t,s,i){const n=ye(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof Te))&&i&&Ze.isCreatorTrusted(i))return new tt(e,t,s)}}}tt._messageTypes=[c.MessageTypes.DeleteMember],tt._defaultTag=V.registerForXmlWithMessageTypes("deletemember",tt.parse,...tt._messageTypes),t.DeleteMemberNode=tt;class st extends Ze{constructor(e,t,s){super(e,t,s,st._defaultTag)}getMessageTypes(){return st._messageTypes}accept(e){return e.transformRoleUpdateNode(this)}static parse(e,t,s,i){const n=ye(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof Ie))&&i&&Ze.isCreatorTrusted(i))return new st(e,t,s)}}}st._messageTypes=[c.MessageTypes.RoleUpdate],st._defaultTag=V.registerForXmlWithMessageTypes("roleupdate",st.parse,...st._messageTypes),t.RoleUpdateNode=st;class it extends Ze{constructor(e,t,s){super(e,t,s,it._defaultTag)}getMessageTypes(){return it._messageTypes}accept(e){return e.transformTopicUpdateNode(this)}static parse(e,t,s,i){const o=ve(e);if(o){const[e,t,s]=o;if(i&&Ze.isCreatorTrusted(i))return new it(e,t,s)}}}it._messageTypes=[c.MessageTypes.TopicUpdate],it._defaultTag=V.registerForXmlWithMessageTypes("topicupdate",it.parse,...it._messageTypes),t.TopicUpdateNode=it;class ot extends Ze{constructor(e,t,s){super(e,t,s,ot._defaultTag)}getMessageTypes(){return ot._messageTypes}accept(e){return e.transformHandshakeInviteNode(this)}static parse(e,t,s,i){const n=ye(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof Te))&&i&&Ze.isCreatorTrusted(i))return new ot(e,t,s)}}}ot._messageTypes=[c.MessageTypes.HandshakeInvite],ot._defaultTag=V.registerForXmlWithMessageTypes("handshakeinvite",ot.parse,...ot._messageTypes),t.HandshakeInviteNode=ot;class nt extends Ze{constructor(e,t,s){super(e,t,s,nt._defaultTag)}getMessageTypes(){return nt._messageTypes}accept(e){return e.transformHandshakeAcceptNode(this)}static parse(e,t,s,i){const n=ye(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof Te))&&i&&Ze.isCreatorTrusted(i))return new nt(e,t,s)}}}nt._messageTypes=[c.MessageTypes.HandshakeAccept],nt._defaultTag=V.registerForXmlWithMessageTypes("handshakeaccept",nt.parse,...nt._messageTypes),t.HandshakeAcceptNode=nt;class rt extends Ze{constructor(e,t,s){super(e,t,s,rt._defaultTag)}getMessageTypes(){return rt._messageTypes}accept(e){return e.transformHandshakeCompleteNode(this)}static parse(e,t,s,i){const n=ye(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof Te))&&i&&Ze.isCreatorTrusted(i))return new rt(e,t,s)}}}rt._messageTypes=[c.MessageTypes.HandshakeComplete],rt._defaultTag=V.registerForXmlWithMessageTypes("handshakecomplete",rt.parse,...rt._messageTypes),t.HandshakeCompleteNode=rt;class at extends Ze{constructor(e,t,s){super(e,t,s,at._defaultTag)}getMessageTypes(){return at._messageTypes}accept(e){return e.transformHandshakeRejectNode(this)}static parse(e,t,s,i){const n=ye(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof Te))&&i&&Ze.isCreatorTrusted(i))return new at(e,t,s)}}}at._messageTypes=[c.MessageTypes.HandshakeReject],at._defaultTag=V.registerForXmlWithMessageTypes("handshakereject",at.parse,...at._messageTypes),t.HandshakeRejectNode=at;class lt extends Ze{constructor(e,t,s){super(e,t,s,lt._defaultTag)}getMessageTypes(){return lt._messageTypes}accept(e){return e.transformPictureUpdateNode(this)}static parse(e,t,s,i){const o=ve(e);if(o){const[e,t,s]=o;if(i&&Ze.isCreatorTrusted(i))return new lt(e,t,s)}}}lt._messageTypes=[c.MessageTypes.PictureUpdate],lt._defaultTag=V.registerForXmlWithMessageTypes("pictureupdate",lt.parse,...lt._messageTypes),t.PictureUpdateNode=lt;class dt extends Ze{constructor(e,t,s,i){super(e,t,s,dt._defaultTag),this.nowDisclosed=i}getMessageTypes(){return dt._messageTypes}accept(e){return e.transformHistoryDisclosedUpdateNode(this)}static parse(e,t,s,i){const o=ve(e);if(o){const[e,t,s]=o;if(i&&Ze.isCreatorTrusted(i)){const i=s.getRawText().toLocaleLowerCase();return new dt(e,t,s,"false"!==i)}}}}dt._messageTypes=[c.MessageTypes.HistoryDisclosedUpdate],dt._defaultTag=V.registerForXmlWithMessageTypes("historydisclosedupdate",dt.parse,...dt._messageTypes),t.HistoryDisclosedUpdateNode=dt;class ct extends Ze{constructor(e,t,s,i){super(e,t,s,ct._defaultTag),this.nowEnabled=i}getMessageTypes(){return ct._messageTypes}accept(e){return e.transformJoiningEnabledUpdateNode(this)}static parse(e,t,s,i){const o=ve(e);if(o){const[e,t,s]=o;if(i&&Ze.isCreatorTrusted(i)){const i=s.getRawText().toLocaleLowerCase();return new ct(e,t,s,"false"!==i)}}}}ct._messageTypes=[c.MessageTypes.JoiningEnabledUpdate],ct._defaultTag=V.registerForXmlWithMessageTypes("joiningenabledupdate",ct.parse,...ct._messageTypes),t.JoiningEnabledUpdateNode=ct;class ht extends Ze{constructor(e,t,s){super(e,t,s,ht._defaultTag),this.link=ht._link}getMessageTypes(){return ht._messageTypes}accept(e){return e.transformLegacyMemberAddedNode(this)}static parse(e,t,s,i){const n=ye(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof Me))&&i&&Ze.isCreatorTrusted(i))return new ht(e,t,s)}}}ht._link=ie.parseFromHref("https://www.skype.com/en/download-skype/skype-for-computer/"),ht._messageTypes=[c.MessageTypes.LegacyMemberAdded],ht._defaultTag=V.registerForXmlWithMessageTypes("legacymemberadded",ht.parse,...ht._messageTypes),t.LegacyMemberAddedNode=ht;class ut extends Ze{constructor(e,t,s){super(e,t,s,ut._defaultTag)}getMessageTypes(){return ut._messageTypes}accept(e){return e.transformLegacyMemberUpgradedNode(this)}static parse(e,t,s,i){const n=ye(e);if(n){const[e,t,s]=n;if(o.every(s,(e=>e instanceof Me))&&i&&Ze.isCreatorTrusted(i))return new ut(e,t,s)}}}ut._messageTypes=[c.MessageTypes.LegacyMemberUpgraded],ut._defaultTag=V.registerForXmlWithMessageTypes("legacymemberupgraded",ut.parse,...ut._messageTypes),t.LegacyMemberUpgradedNode=ut;class pt extends me{constructor(e,t,s,i){super([e].concat(t||[]),pt._defaultTag),this.nameChild=e,this.durationChild=t,this.identity=s,this.live_identity=i}getMessageTypes(){return pt._messageTypes}accept(e){return e.transformPartNode(this)}encodedAttr(){return{identity:this.identity,live_identity:this.live_identity}}static parse(e,t){if(2===(e=o.reject(e,(e=>!e||e.isEmptyTextNodeOrContainingWhitespacesOnly()))).length||1===e.length){const s=o.keyBy(e,(e=>e?e.getTag():"undefined")),i=s[_e.tags.Name]instanceof _e?s[_e.tags.Name]:void 0,n=s[_e.tags.Duration]instanceof _e?s[_e.tags.Duration]:void 0;if(i)return new pt(i,n,String(t.identity),String(t.live_identity))}}}pt._messageTypes=[c.MessageTypes.Call],pt._defaultTag=V.registerForXmlWithMessageTypes("part",pt.parse,...pt._messageTypes),t.PartNode=pt;class gt extends me{constructor(e,t,s,i,o){super(e,gt._defaultTag),this.type=t,this.alt=s,this.callId=i,this.conversationId=o}accept(e){return e.transformPartListNode(this)}encodedAttr(){return{type:this.type,alt:this.alt,callId:this.callId}}getMessageTypes(){return gt._messageTypes}static parse(e,t,s,i){let n;if(e=o.reject(e,(e=>!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly())),o.isString(t.callId)&&t.callId.length)n=t.callId;else{if(!i||!o.isString(i.skypeguid)||0===i.skypeguid.length)return;n=i.skypeguid}const r=i?i.conversationId:void 0;if(o.every(e,(e=>e instanceof pt)))return new gt(e,o.isString(t.type)?t.type:void 0,String(t.alt),n,r)}}gt._messageTypes=[c.MessageTypes.Call],gt._defaultTag=V.registerForXmlWithMessageTypes("partlist",gt.parse,...gt._messageTypes),t.PartListNode=gt;class mt extends me{constructor(e){super(e,mt._defaultTag)}accept(e){return e.transformEndedNode(this)}getMessageTypes(){return mt._messageTypes}static parse(e){if(0===e.length)return new mt(e)}}mt._messageTypes=[c.MessageTypes.Call],mt._defaultTag=V.registerForXmlWithMessageTypes("ended",mt.parse,...mt._messageTypes),t.EndedNode=mt;class St extends Be{constructor(e,t,s,i,o,n,r,a){super(e,t,void 0,void 0,void 0),this.callId=s,this.threadId=i,this.containerType=o,this.timestamp=n,this.label=r,this.locationName=a}accept(e){return e.transformCallInfoUriObjectNode(this)}static parseFromSanitizedParts(e,t,s,i){if(!(o.isString(t.callId)&&t.threadId&&h.isThread(t.threadId)&&o.isString(t.containerType)&&o.isString(t.timestamp)))return;const n=o.isString(t.label)?F.default.unescapeXml(t.label):void 0,r=o.isString(t.locationName)?F.default.unescapeXml(t.locationName):void 0,a=Number(t.timestamp);return o.isNaN(a)?void 0:new St(e,t,t.callId,t.threadId,t.containerType,a,n,r)}}t.CallInfoUriObjectNode=St;class ft extends z{constructor(e,t,s,i){super([],ft._defaultTag),this._id=e,this._style=t,this._internalType=s,this._userMri=i}accept(e){return e.transformUnknownNode(this)}encodedAttr(){return{id:this._id,style:this._style,internalType:this._internalType,userMri:this._userMri}}getStyle(){return this._style||R.ReactionsTextStyle.Default}getInternalType(){return this._internalType||R.ReactionsTextType.Default}getUserMri(){return this._userMri}isEmptyTextNodeOrContainingWhitespacesOnly(){return!0}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!0}static parse(e,t){if(0===e.length&&o.isString(t.id))return new ft(t.id,t.style?parseInt(t.style,10):void 0,t.internalType?parseInt(t.internalType,10):void 0,t.userMri)}}ft._defaultTag=V.registerForXml("c_i",ft.parse),t.CallReactionMetadataNode=ft;class yt extends me{constructor(e,t,s,i){super(e,yt._defaultTag),this.type=t,this._rawUserMrisOrNames=s,this.userMrisOrNames=i}encodedAttr(){return{type:this.type,users:this._rawUserMrisOrNames}}accept(e){return e.transformNgcUpgradeNode(this)}static parse(e,t){if("ngcUpgradeMessage"===t.type)return new yt(e,t.type,String(t.users),o.isString(t.users)?F.default.unescapeXml(t.users).split(","):[])}}yt._defaultTag=V.registerForXml("systemMessage",yt.parse),t.NgcUpgradeSystemMessageNode=yt;class vt extends Be{constructor(e,t,s,i,o,n,r,a,l){super(e,t,s,i,o),this.children=e,this.title=n,this.expirationTimeMs=r,this.options=a,this.allowMultipleVotes=l}accept(e){return e.transformPollNode(this)}getAttr(){return{}}static parseFromSanitizedParts(e,t,s,i,n){const r=t.expirationTimeMs&&Number(t.expirationTimeMs)||Date.now(),a=o.isString(t.title)?t.title:"",l=o.isString(t.optionsEncoded)?w.decodePollOptions(t.optionsEncoded):[],d="true"===t.allowMultipleVotes;return new vt(e,t,s,i,n,a,r,l,d)}}t.PollNode=vt;class Ct extends me{constructor(e,t,s,i){super([],i||Ct._defaultTag),this.type=e,this.content=t,this.contentNode=s,this._customTag=i}accept(e){return e.transformDataNode(this)}encode(){return this.content}getMessageTypes(){return Ct._messageTypes}static parse(e){const{type:t,content:s}=e;if(t){const e=parseInt(b.DataMessageContentType[t],10);if(e&&s){const i=W.fromPlainText(t||"");return new Ct(e,s,i)}}return Ct.parseFallback()}static parseData(e){if(e){const t=A.default.parseJsonErrorToUndefined(e);if(t&&t.type){const s=W.fromPlainText(b.DataMessageContentType[t.type]);return new Ct(t.type,e,s)}}return Ct.parseFallback()}static parseFallback(){const e=W.fromPlainText(_.getString("MessageContentNodes.DataFallback"));return new Ct(b.DataMessageContentType.Unknown,"",e)}}Ct._messageTypes=[c.MessageTypes.Data,c.MessageTypes.TranslationSettings],Ct._defaultTag=V.registerForJson(c.MessageTypes.Data,Ct.parseData),t.DataNode=Ct;class _t extends Ct{constructor(e,t,s){super(e,t,s,_t._defaultTagValue),this.type=e,this.content=t,this.contentNode=s}static parse(e){const{type:t,content:s}=e;if(t){const e=parseInt(b.DataMessageContentType[t],10);if(e&&s){const i=W.fromPlainText(t||"");return new _t(e,s,i)}}return Ct.parseFallback()}static parseData(e){if(e){const t=A.default.parseJsonErrorToUndefined(e);if(t&&t.type){const s=W.fromPlainText(b.DataMessageContentType[t.type]);return new _t(t.type,e,s)}}return Ct.parseFallback()}}_t._defaultTagValue=V.registerForJson(c.MessageTypes.TranslationSettings,Ct.parseData),t.TranslationSettingsNode=_t;class bt extends me{constructor(e,t,s){super([],bt._defaultTag),this.translation=e,this.originalLocale=t,this.contentNode=s}accept(e){return e.transformTranslationNode(this)}encode(){return this.translation}getUriObjectNode(e){return this.contentNode.getUriObjectNode(e)}getMessageTypes(){return bt._messageTypes}static parse(e,t){if(e&&t){const s=W.fromPlainText(e);return new bt(e,t,s)}return bt._parseFallback(e)}static parseTranslation(e){if(e){const t=c.getMessageTranslationMetadata(e);if(t){const e=W.fromPlainText(t.translations[0].translation);return new bt(t.translations[0].translation,t.oloc,e)}}return bt._parseFallback(e)}static _parseFallback(e){const t=W.fromPlainText(_.getString("MessageContentNodes.TranslationFallback"));return new bt(e,void 0,t)}}bt._messageTypes=[c.MessageTypes.Translation],bt._defaultTag=V.registerForJson(c.MessageTypes.Translation,bt.parseTranslation),t.TranslationNode=bt;class Tt extends be{constructor(e,t){super([]),this.oldName=e,this.newName=t}accept(e){return e.transformGuestNameUpdateTargetNode(this)}encodedAttr(){return{oldName:this.oldName,newName:this.newName}}}t.GuestUpdateTargetNode=Tt;class Mt extends Ze{constructor(e,t,s){super(e,t,s,Mt._defaultTag)}getMessageTypes(){return Mt._messageTypes}accept(e){return e.transformGuestNameUpdateNode(this)}static parse(e,t,s,i){const o=ye(e);if(o){const[e,t,s]=o;return new Mt(e,t,s)}return new Mt(new _e(W.fromPlainText(""),""),new _e(W.fromPlainText(""),""),[new Tt(String(t.oldName),String(t.newName))])}}Mt._messageTypes=[c.MessageTypes.GuestNameUpdate],Mt._defaultTag=V.registerForXml("guestNameUpdate",Mt.parse),t.GuestUpdateNode=Mt},203109:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extraTextNodeParsing=void 0;const i=s(496486),o=s(481169),n=s(746096),r=s(497174),a=s(923944),l=s(436237),d=s(312762),c=s(404057);class h{constructor(e){this._options=e,this.transformRootNode=this._default,this.transformEditMessageMetaDataNode=i.identity,this.transformHighlightedNode=i.identity,this.transformAtMentionNode=i.identity,this.transformUserMriNode=i.identity,this.transformEmoticonNode=i.identity,this.transformFlagNode=i.identity,this.transformQuoteNode=this._default,this.transformLegacyQuoteNode=i.identity,this.transformWikiMarkupNode=this._default,this.transformListWikiMarkupNode=this._default,this.transformLinkNode=i.identity,this.transformBingResponseNode=i.identity,this.transformAttributionNode=i.identity,this.transformAttributionsTextNode=i.identity,this.transformAttributionsGroupNode=i.identity,this.transformEmoteNode=i.identity,this.transformContextNode=i.identity,this.transformRosterContextNode=i.identity,this.transformLocationContextNode=i.identity,this.transformSwiftUriObjectNode=i.identity,this.transformSwiftNode=i.identity,this.transformAdaptiveCardNode=i.identity,this.transformScheduledCallInviteNode=i.identity,this.transformUnknownNode=i.identity,this.transformTextWrapperNode=i.identity,this.transformTargetUserNode=i.identity,this.transformTargetLegacyUserNode=i.identity,this.transformTargetRoleNode=i.identity,this.transformTargetsNode=i.identity,this.transformContactNode=i.identity,this.transformContactsNode=i.identity,this.transformFileNode=i.identity,this.transformFilesNode=i.identity,this.transformSmsNode=i.identity,this.transformMmsNode=i.identity,this.transformLocationNode=i.identity,this.transformMetaNode=i.identity,this.transformUriObjectNode=i.identity,this.transformUriObjectFileNode=i.identity,this.transformPictureNode=i.identity,this.transformVideoNode=i.identity,this.transformVideoMessageNode=i.identity,this.transformAudioNode=i.identity,this.transformAudioMessageNode=i.identity,this.transformSkypeVideoMessageNode=i.identity,this.transformCallInfoUriObjectNode=i.identity,this.transformMojiNode=i.identity,this.transformStickerNode=i.identity,this.transformAddMemberNode=i.identity,this.transformDeleteMemberNode=i.identity,this.transformRoleUpdateNode=i.identity,this.transformTopicUpdateNode=i.identity,this.transformHandshakeInviteNode=i.identity,this.transformHandshakeAcceptNode=i.identity,this.transformHandshakeCompleteNode=i.identity,this.transformHandshakeRejectNode=i.identity,this.transformPictureUpdateNode=i.identity,this.transformHistoryDisclosedUpdateNode=i.identity,this.transformJoiningEnabledUpdateNode=i.identity,this.transformLegacyMemberAddedNode=i.identity,this.transformLegacyMemberUpgradedNode=i.identity,this.transformPartNode=i.identity,this.transformPartListNode=i.identity,this.transformEndedNode=i.identity,this.transformPollNode=i.identity,this.transformNgcUpgradeNode=i.identity,this.transformSuggestedTextHighlightNode=i.identity,this.transformCallerIDNode=i.identity,this.transformMediaAlbumNode=i.identity,this.transformTranslationNode=i.identity,this.transformDataNode=i.identity,this.transformHtmlNode=i.identity,this.transformGuestNameUpdateNode=i.identity,this.transformGuestNameUpdateTargetNode=i.identity}_default(e){const t=(0,o.chain)(e.children,(0,o.map)((e=>{const t=e&&e.accept(this);return t instanceof d.RootNode?i.compact(t.children):t})),(0,o.compact)(),(0,o.flatten)());return e.cloneWithChildren(t)}transform(e){return e.accept(this)}transformPlainTextNode(e){const t=e.getRawText();if(!t)return e;let s=[new r.UnhandledEntity(t)];this._options.extractEmoticons&&(s=a.handleEmoticons(s)),this._options.extractLinks&&(s=a.handleLinks(s)),this._options.extractSuggestedTextHighlights&&(s=a.handleSuggestedTextHighlights(s,this._options.extractSuggestedTextHighlights));const o=i.map(s,(e=>e.decode()));return 1===o.length?o[0]:d.RootNode.parse(o)}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}}t.extraTextNodeParsing=function(e,t,s,i){try{return new h({extractEmoticons:t,extractLinks:s,extractSuggestedTextHighlights:i}).transform(e)}catch(e){l.error(n.LogTraceArea.GenericUnsafe,"TextEntityExtractionTransformer: Failed to transform tree: "+c.default.errorAsString(e))}return e}},177878:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transformUnicodeEmojis=t.UnicodeEmojiTransformer=void 0;const i=s(160809),o=s(496486),n=s(481169),r=s(746096),a=s(436237),l=s(312762),d=s(404057),c=i();class h{constructor(e){this._options=e,this.transformRootNode=this._default,this.transformHighlightedNode=o.identity,this.transformUnknownNode=o.identity,this.transformEditMessageMetaDataNode=o.identity,this.transformAtMentionNode=o.identity,this.transformUserMriNode=o.identity,this.transformUnicodeEmojiNode=o.identity,this.transformEmoticonNode=o.identity,this.transformFlagNode=o.identity,this.transformQuoteNode=o.identity,this.transformLegacyQuoteNode=o.identity,this.transformWikiMarkupNode=o.identity,this.transformListWikiMarkupNode=o.identity,this.transformLinkNode=o.identity,this.transformBingResponseNode=o.identity,this.transformAttributionNode=o.identity,this.transformAttributionsTextNode=o.identity,this.transformAttributionsGroupNode=o.identity,this.transformEmoteNode=o.identity,this.transformContextNode=o.identity,this.transformRosterContextNode=o.identity,this.transformLocationContextNode=o.identity,this.transformTextWrapperNode=o.identity,this.transformTargetUserNode=o.identity,this.transformTargetLegacyUserNode=o.identity,this.transformTargetRoleNode=o.identity,this.transformTargetsNode=o.identity,this.transformContactNode=o.identity,this.transformContactsNode=o.identity,this.transformFileNode=o.identity,this.transformFilesNode=o.identity,this.transformSmsNode=o.identity,this.transformMmsNode=o.identity,this.transformLocationNode=o.identity,this.transformMetaNode=o.identity,this.transformUriObjectNode=o.identity,this.transformUriObjectFileNode=o.identity,this.transformPictureNode=o.identity,this.transformVideoNode=o.identity,this.transformVideoMessageNode=o.identity,this.transformAudioNode=o.identity,this.transformAudioMessageNode=o.identity,this.transformCallInfoUriObjectNode=o.identity,this.transformMojiNode=o.identity,this.transformStickerNode=o.identity,this.transformSkypeVideoMessageNode=o.identity,this.transformAddMemberNode=o.identity,this.transformDeleteMemberNode=o.identity,this.transformRoleUpdateNode=o.identity,this.transformTopicUpdateNode=o.identity,this.transformHandshakeInviteNode=o.identity,this.transformHandshakeAcceptNode=o.identity,this.transformHandshakeCompleteNode=o.identity,this.transformHandshakeRejectNode=o.identity,this.transformPictureUpdateNode=o.identity,this.transformHistoryDisclosedUpdateNode=o.identity,this.transformJoiningEnabledUpdateNode=o.identity,this.transformLegacyMemberAddedNode=o.identity,this.transformLegacyMemberUpgradedNode=o.identity,this.transformPartNode=o.identity,this.transformPartListNode=o.identity,this.transformEndedNode=o.identity,this.transformSwiftUriObjectNode=o.identity,this.transformSwiftNode=o.identity,this.transformAdaptiveCardNode=o.identity,this.transformScheduledCallInviteNode=o.identity,this.transformNgcUpgradeNode=o.identity,this.transformSuggestedTextHighlightNode=o.identity,this.transformPollNode=o.identity,this.transformCallerIDNode=o.identity,this.transformMediaAlbumNode=o.identity,this.transformTranslationNode=o.identity,this.transformDataNode=o.identity,this.transformHtmlNode=o.identity,this.transformGuestNameUpdateNode=o.identity,this.transformGuestNameUpdateTargetNode=o.identity}static addUtfLookup(e,t){e in h._utfLookup||(h._utfLookup[e]=t)}_default(e){const t=(0,n.chain)(e.children,(0,n.map)((e=>{const t=e&&e.accept(this);return t instanceof l.RootNode?o.compact(t.children):t})),(0,n.compact)(),(0,n.flatten)());return e.cloneWithChildren(t)}transform(e){return e.accept(this)}transformPlainTextNode(e){const t=e.getRawText(),s=this._parseText(t);if(1===s.length)return s[0];return l.RootNode.parse(s)}_parseText(e){if(-1===e.search(c))return[l.PlainTextNode.fromPlainText(e)];const t=[];let s,i=0;for(;s=c.exec(e);){i!==s.index&&t.push(l.PlainTextNode.fromPlainText(e.substring(i,s.index))),i=s.index+s[0].length;const o=e.substring(s.index,i);if(this._options.lookupEmoticons&&o in h._utfLookup){const e=h._utfLookup[o],s=l.PlainTextNode.fromPlainText(`(${e})`);t.push(new l.EmoticonNode(s,e,void 0))}else t.push(l.UnicodeEmojiNode.fromPlainText(o))}return i!==e.length&&t.push(l.PlainTextNode.fromPlainText(e.substring(i,e.length))),c.lastIndex=0,t}}h._utfLookup={},t.UnicodeEmojiTransformer=h,t.transformUnicodeEmojis=function(e,t){try{return new h({lookupEmoticons:t}).transform(e)}catch(e){a.error(r.LogTraceArea.GenericUnsafe,"TextEntityExtractionTransformer: Failed to transform tree: "+d.default.errorAsString(e))}return e}},606509:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.encodeWikiMarkupWithoutPrefix=t.splitWikiMarkupPrefix=t.WikiPrefix=void 0;const i=s(496486),o=s(481169),n=s(497174),r=s(861253);var a,l,d;!function(e){e[e.WT_BOLD=0]="WT_BOLD",e[e.WT_ITALIC=1]="WT_ITALIC",e[e.WT_CODE=2]="WT_CODE",e[e.WT_STRIKE=3]="WT_STRIKE"}(a||(a={})),function(e){e[e.MT_SPAN=0]="MT_SPAN",e[e.MT_ANY=1]="MT_ANY"}(l||(l={})),function(e){e[e.None=0]="None",e[e.DoNotFormat=1]="DoNotFormat",e[e.NoWiki=2]="NoWiki"}(d=t.WikiPrefix||(t.WikiPrefix={}));class c{constructor(e,t,s,i,o=i){this.type=e,this.matchType=t,this.tag=s,this.raw_pre=i,this.raw_post=o,this.tokenSymbol=this.raw_pre[0]}}const h=[new c(a.WT_BOLD,l.MT_SPAN,"b","*"),new c(a.WT_ITALIC,l.MT_SPAN,"i","_"),new c(a.WT_CODE,l.MT_ANY,"pre","{code}"),new c(a.WT_STRIKE,l.MT_SPAN,"s","~"),new c(a.WT_CODE,l.MT_ANY,"pre","```")],u=i.map(h,(e=>e.raw_pre[0])).join(""),p=/[\r\n]/,g=/[,.!?*_{}()]/,m=/[ \f\t\v​\u00a0\u1680​\u180e\u2000-\u200a​\u2028\u2029\u202f\u205f​\u3000\ufeff]/;function S(e,t){return 0===t||-1!=="w \n".indexOf(e[t-1].char)||"!"===e[t-1].char&&(1===t||-1!=="w \n".indexOf(e[t-2].char))||t===e.length-1||-1!=="w \n".indexOf(e[t+1].char)||"!"===e[t+1].char&&(t+2===e.length||-1!=="w \n".indexOf(e[t+2].char))}function f(e){const t=[];return i.each(e,(e=>{const s=i.last(t),o=e.data;if(s instanceof n.UnhandledEntity){if(i.isString(o))return void s.appendText(o);if(o instanceof n.UnhandledEntity)return void s.appendText(o.text())}i.isString(o)?t.push(new n.UnhandledEntity(o)):t.push(o)})),t}function y(e){const t=new n.UnhandledEntity;return i.each(e,(e=>{const s=e.data;i.isString(s)?t.appendText(s):t.appendText(s.text())})),[t]}function v(e,t){let s=t;for(;s+1<e.length&&(0,r.default)(e[s+1],e[s]);)s++;return s}function C(e,t){const s=[];let o=0;const r=e.length;for(let c=0;c<r;c++){const u=i.find(h,(s=>e[c].char===s.raw_pre[0]&&!i.includes(t,s)));if(u&&S(e,c)){for(let i=v(e,c)+1;i<r&&(u.matchType!==l.MT_SPAN||(d=e[i].char,!p.test(d)));i++)if(e[i].char===u.raw_post[0]&&S(e,i)){if(i=v(e,i),o<c){const t=e.slice(o,c);s.push(f(t))}if(c+1<i){const o=e.slice(c+1,i),r=u.type!==a.WT_CODE?C(o,t.concat(u)):y(o),l=new n.WikiMarkupEntity(r,u.tag,u.raw_pre,u.raw_post);s.push([l])}c=i,o=c+1;break}}}var d;return s.length?(o!==e.length&&s.push(f(e.slice(o))),i.flatten(s)):f(e)}function _(e,t,s,i){const o=new RegExp("^"+e+"\\s+\\S"),n=new RegExp("^"+e+"\\s+");return o.test(t)||n.test(t)&&s+1<i}t.splitWikiMarkupPrefix=function(e){const t=i.clone(e),s=t[0]instanceof n.UnhandledEntity?0:t.length>1&&t[0]instanceof n.QuoteEntity&&t[1]instanceof n.UnhandledEntity?1:-1;let o=d.None;if(s>-1){const e=t[s].text();_("!!",e,s,t.length)?o=d.DoNotFormat:_("@@",e,s,t.length)&&(o=d.NoWiki),o!==d.None&&(t[s]=new n.UnhandledEntity(e.substring(3)))}return{entities:t,prefix:o}},t.encodeWikiMarkupWithoutPrefix=function(e){if(!e||!e.length)return e;return C(function(e){return(0,o.chain)(e,(0,o.map)((e=>e instanceof n.UnhandledEntity?e.text():e)),(0,o.flatten)(),(0,o.map)((e=>{if(!i.isString(e)){const t=e;if(t instanceof n.QuoteEntity)return[{char:"h",data:t},{char:"\n",data:""}];if(t instanceof n.EditMessageMetaDataEntity||t instanceof n.ContextEntity)return{char:"w",data:t};const s=t.text();return{char:s&&p.test(s)?"\r":"h",data:t}}const t=e,s=[],o=t.length;for(let e=0;e<o;){let i;if(u.indexOf(t.charAt(e))>-1){const s=h.length;for(let o=0;o<s;o++){const s=h[o];if(s.raw_pre===t.substring(e,e+s.raw_pre.length)?i=s.raw_pre:s.raw_post===t.substring(e,e+s.raw_post.length)&&(i=s.raw_post),i)break}}if(i)s.push({char:t.charAt(e),data:i}),e+=i.length;else{const i=t.charAt(e),o={char:p.test(i)?"\n":g.test(i)?"!":m.test(i)?" ":"a",data:i};s.push(o),e++}}return s})),(0,o.flatten)(),(e=>{const t=[];return i.each(e,(e=>{const s=i.last(t);s&&s.char===e.char&&"\n! a".indexOf(e.char)>-1?s.data=s.data+e.data:t.push(e)})),t}))}(e),[])}},302024:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.messageSupportsReacting=t.SkypeConversationLocal=void 0;const i=s(570655);var o=s(496856);Object.defineProperty(t,"SkypeConversationLocal",{enumerable:!0,get:function(){return o.default}}),i.__exportStar(s(498317),t);var n=s(96944);Object.defineProperty(t,"messageSupportsReacting",{enumerable:!0,get:function(){return n.messageSupportsReacting}})},96944:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.messageSupportsReacting=void 0,t.messageSupportsReacting=function(e,{screenReaderEnabled:t,isNewsChannel:s}){return e&&!t&&!s}},693097:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCreateMenuItems=t.ADD_CELLULAR_SMS_CONVERSATION_COMMAND=t.ADD_CONVERSATION_PRIVATE_COMMAND=t.ADD_CONVERSATION_1ON1_COMMAND=t.ADD_CONVERSATION_GROUP_COMMAND=t.ADD_CONVERSATION_MODERATED_GROUP_COMMAND=void 0;const i=s(257538),o=s(733754);t.ADD_CONVERSATION_MODERATED_GROUP_COMMAND="moderatedgroup",t.ADD_CONVERSATION_GROUP_COMMAND="group",t.ADD_CONVERSATION_1ON1_COMMAND="1on1",t.ADD_CONVERSATION_PRIVATE_COMMAND="private",t.ADD_CELLULAR_SMS_CONVERSATION_COMMAND="cellularSms",t.getCreateMenuItems=function({hasSMS:e}){const s=[{text:(0,o.getString)("MeetNow.HostAMeetingLabel"),command:i.MeetNowButtonActionCommands.CreateMeetNow},{text:(0,o.getString)("MeetNow.JoinAMeetingLabel"),command:i.MeetNowButtonActionCommands.JoinMeetNow},{text:(0,o.getString)("Hub.NewGroupChatLabel"),command:t.ADD_CONVERSATION_GROUP_COMMAND},{text:(0,o.getString)("Hub.NewModeratedGroupChatLabel"),command:t.ADD_CONVERSATION_MODERATED_GROUP_COMMAND},{text:(0,o.getString)("Hub.New1on1ChatLabel"),command:t.ADD_CONVERSATION_1ON1_COMMAND},{text:(0,o.getString)("Hub.NewPrivateChatLabel"),command:t.ADD_CONVERSATION_PRIVATE_COMMAND}];return e&&s.push({text:(0,o.getString)("Hub.NewCellularSmsChatLabel"),command:t.ADD_CELLULAR_SMS_CONVERSATION_COMMAND}),s}},841346:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFilterMenuItems=t.OTHER_COMMANDS=t.SORT_COMMANDS=t.FILTER_COMMANDS=void 0;const i=s(582916),o=s(733754),n=s(793003);function r(e){return[{text:(0,o.getString)("DesktopRecentsFilter.RecentConversations"),command:t.FILTER_COMMANDS.recents,selected:e===i.ConversationsListMode.AllConversations},{text:(0,o.getString)("DesktopRecentsFilter.HiddenConversations"),command:t.FILTER_COMMANDS.archived,selected:e===i.ConversationsListMode.ArchivedConversations}]}function a(e,s){const i=[{text:(0,o.getString)("DesktopRecentsFilter.Time"),command:t.SORT_COMMANDS.time,selected:e===n.RecentsSortBy.Time},{text:(0,o.getString)("DesktopRecentsFilter.Unread"),command:t.SORT_COMMANDS.unread,selected:e===n.RecentsSortBy.Unread}];return s&&i.push({text:(0,o.getString)("DesktopRecentsFilter.Active"),command:t.SORT_COMMANDS.active,selected:e===n.RecentsSortBy.Active}),i}function l(e,s,n){const r=[];return s&&e===i.ConversationsListMode.AllConversations&&r.push({text:(0,o.getString)("MobileRecentsFilter.MarkRead"),command:t.OTHER_COMMANDS.markAllRead}),r.push({text:(0,o.getString)(n?"DesktopRecentsFilter.HideFavorites":"DesktopRecentsFilter.ShowFavorites"),command:t.OTHER_COMMANDS.showCategoriesToggle}),r}t.FILTER_COMMANDS={recents:"recents",archived:"archived"},t.SORT_COMMANDS={time:"time",unread:"unread",active:"active"},t.OTHER_COMMANDS={markAllRead:"markAllRead",showCategoriesToggle:"showCategoriesToggle"},t.getFilterMenuItems=function({viewMode:e,sortBy:t,needActiveSort:s,hasArchivedConversations:n,hasUnread:d,shouldShowCategories:c}){const h=[];return n&&h.push({key:"filterby",items:r(e)}),e===i.ConversationsListMode.AllConversations&&h.push({key:"sortby",title:(0,o.getString)("DesktopRecentsFilter.SortBy"),items:a(t,s)}),h.push({key:"more",title:(0,o.getString)("Global.MoreButtonTitle"),items:l(e,d,c)}),h}},292729:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655);i.__exportStar(s(693097),t),i.__exportStar(s(841346),t)},265976:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAmsDomainUrl=t.getDocumentUrls=t.getDocumentId=t.getLegacyDocumentUrl=t.getDocumentUrl=t.extractAmsDocumentIdFromUrl=t.getTranscriptionUrl=t.getLegacyDisplayUrl=t.getDisplayUrl=t.isStaticAsyncMediaUrl=t.isAsyncMediaUrl=t.getCreateDocumentUrl=t.getCdnUrl=t.getAmsLoginFallbackUrl=t.getFileCacheKeyMediaThumbForId=t.getFileCacheKeyMediaThumb=t.getFileCacheKeyMediaForId=t.getFileCacheKeyMedia=t.checkIfSafeDomainToRender=t.getUploadContentId=t.getDownloadStatusUrl=t.getDownloadUrl=t.getUploadStatusUrl=t.getUploadUrl=t.getDownloadViewId=t.AmsCookieName=t.defaultContentId=void 0;const i=s(496486),o=s(889391),n=s(225638),r=s(746096),a=s(436237),l=s(478262),d=s(327795),c=s(626712);function h(e,s=l.MediaViewSize.Thumbnail){let i;switch(e){case l.UploadFileType.GroupAvatar:i="swx_avatar",s===l.MediaViewSize.Full&&(i="avatar_fullsize");break;case l.UploadFileType.Picture:i="imgt1_anim",s===l.MediaViewSize.Full?i="imgpsh_fullsize_anim":s===l.MediaViewSize.ThumbnailUncropped?i="imgpsh_thumbnail_sx":s===l.MediaViewSize.MobilePreview?i="imgpsh_mobile_save_anim":s===l.MediaViewSize.ThumbnailBlurred&&(i="imgpsh_thumbnail_blurred");break;case l.UploadFileType.Video:case l.UploadFileType.VideoMessage:i="thumbnail",s===l.MediaViewSize.Full?i="video":s===l.MediaViewSize.ThumbnailBlurred&&(i="thumbnail_blurred");break;case l.UploadFileType.Audio:case l.UploadFileType.AudioMessage:i="audio";break;default:i=t.defaultContentId}return i}function u(e,t){return C(e)+"/content/"+g(t)}function p(e,t){return C(e)+"/views/"+t}function g(e){switch(e){case l.UploadFileType.Picture:return"imgpsh";case l.UploadFileType.Thumbnail:return"thumbnail";case l.UploadFileType.Video:return"video";case l.UploadFileType.VideoMessage:return o.default.isDesktopVIMEnabled()?"original":"video";case l.UploadFileType.Audio:case l.UploadFileType.AudioMessage:return"audio";case l.UploadFileType.GroupAvatar:return"avatar";default:return t.defaultContentId}}function m(e,t){return e+t}function S(e,t){return e+t+"_thumb"}function f(){return o.default.getConfigSettingsNoSubscription().loginSkype.host+"login/sso"}function y(){return o.default.getConfigSettingsNoSubscription().asm.cdnUrl}function v(e,t,s=l.MediaViewSize.Thumbnail){return C(e)+"/views/"+h(t,s)}function C(e){const t=o.default.getAsyncMediaFeatures(),s=i.replace(t.ams_doc_url_format,"{0}",t.ams_base_url);return i.replace(s,"{1}",e)}function _(e){return"https://api.asm.skype.com/v1/objects/"+e}t.defaultContentId="original",t.AmsCookieName="skypetoken_asm",t.getDownloadViewId=h,t.getUploadUrl=u,t.getUploadStatusUrl=function(e,t){return u(e,t)+"/status"},t.getDownloadUrl=p,t.getDownloadStatusUrl=function(e,t){return p(e,t)+"/status"},t.getUploadContentId=g,t.checkIfSafeDomainToRender=function(e,t){if(!e)return!1;const s=c.default.isFileOrBlob(e)||!o.default.getS4LMessagingFeatures().enableSafeDomainRendering||o.default.isTrustedDomain(e,!1);if(!s){const s=c.default.getDomainName(e);a.warn(r.LogTraceArea.GenericUnsafe,t,"The domain",s,"is not whitelisted in ECS. The domain needs to be reviewed and approved by InfoSec."),a.track(new d.UnsafeDomain(s,t))}return s},t.getFileCacheKeyMedia=function(e,t){const s=m(e.conversationId,e.cuid);return o.default.getS4LMessagingFeaturesNoSubscription().enableFullResolutionImageDownload&&t?s+"_fullRes":s},t.getFileCacheKeyMediaForId=m,t.getFileCacheKeyMediaThumb=function(e){return S(e.conversationId,e.cuid)},t.getFileCacheKeyMediaThumbForId=S,t.getAmsLoginFallbackUrl=f,t.getCdnUrl=y,t.getCreateDocumentUrl=function(){const e=o.default.getAsyncMediaFeatures();return i.replace(e.ams_create_document_url_format,"{0}",e.ams_base_url)},t.isAsyncMediaUrl=function(e){const t=o.default.getAsyncMediaFeaturesNoSubscription().ams_base_url,s=c.default.getURIComponents(t),i=c.default.getURIComponents(e);return c.default.areHostsSame(s,i)},t.isStaticAsyncMediaUrl=function(e){const t=c.default.getURIComponents(y()),s=c.default.getURIComponents(e);return c.default.areHostsSame(t,s)},t.getDisplayUrl=v,t.getLegacyDisplayUrl=function(e,t,s=l.MediaViewSize.Thumbnail){return _(e)+"/views/"+h(t,s)},t.getTranscriptionUrl=function(e){return C(e)+"/views/transcript"},t.extractAmsDocumentIdFromUrl=function(e){var t;if(!e)return"";const s=null===(t=e.split("/views/"))||void 0===t?void 0:t[0],i=null==s?void 0:s.split("/");return(null==i?void 0:i[i.length-1])||""},t.getDocumentUrl=C,t.getLegacyDocumentUrl=_,t.getDocumentId=function(e){return new n.default(e).getDocumentId()},t.getDocumentUrls=function(e,t=l.UploadFileType.File){const s=C(e);let i,o;t!==l.UploadFileType.GroupAvatar&&t!==l.UploadFileType.Picture&&t!==l.UploadFileType.Video&&t!==l.UploadFileType.VideoMessage||(o=v(e,t,l.MediaViewSize.Thumbnail)),t!==l.UploadFileType.Picture&&t!==l.UploadFileType.Video&&t!==l.UploadFileType.VideoMessage&&t!==l.UploadFileType.Audio&&t!==l.UploadFileType.AudioMessage||(i=v(e,t,l.MediaViewSize.Full));let n="";return n=t===l.UploadFileType.Picture?f()+"?go=xmmfallback?pic="+e:t===l.UploadFileType.VideoMessage?f()+"?go=xmmfallback?vim="+e:t===l.UploadFileType.AudioMessage?f()+"?go=xmmfallback?am="+e:f()+"?go=webclient.xmm&docid="+e,{original:s,fullSize:i,fallback:n,preview:o}},t.isAmsDomainUrl=function(e){return c.default.isUrlValid(e)&&o.default.getAsyncMediaFeaturesNoSubscription().ams_domain_url.some((t=>c.default.getDomainName(e).endsWith(t)))}},260021:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCorrelationIdFromMessageParts=t.getCorrelationIdForMessage=void 0;const i=s(496486),o=s(481169),n=s(671830),r=s(440276),a=s(18078);function l(e,t,s){let l=t;n.isOneOnOneConversation(l)&&!n.isThread(l)&&(a.default.isMyMri(e)||(l=a.default.getSkypeMri()));const d=e+"|"+l+"|"+s;return(0,o.chain)(r.computeSHA256(d),(0,o.take)(16),(0,o.map)((e=>i.padStart(e.toString(16),2,"0"))),(0,o.join)(""))}t.getCorrelationIdForMessage=function(e){return l(e.creator,e.conversationId,e.getOriginalClientMessageId())},t.getCorrelationIdFromMessageParts=l},351077:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isContactMessageType=t.isCallMessageType=t.isCallInfoForCallMessageType=t.isCallInfoMessageType=t.isScheduledCallMetadataType=t.isThreadActivityType=t.isHtmlMessageType=t.isJsonMessageType=t.isXmlMessageType=t.isDeletedMessage=t.getEditTime=t.getMessageTranslationMetadata=t.getTranslationSettingsState=t.getTranslationSettingsMetadata=t.getForwardMetadata=t.getUrlPreviewMetadata=t.getSmsDeliveryReport=t.getScheduledCallMetadata=t.getPollMetadata=t.getBookmarkSourceMetadata=t.getBookmarkMetadata=t.isPollUsingCustomProp=t.flattenEmotionMetadata=t.getCleanedEmotionMetadata=t.getEmotionMetadata=t.getScheduledCallConsumptionHorizons=t.getScheduledCallInviteData=t.getForwardedTeamsProperties=t.getTeamsFileProperties=t.getTeamsMentionProperties=t.getJsonFromMessageProperty=t.removeVoteForUser=t.addOrUpdateVoteForUser=t.getBookmarkMetadataForUser=t.addOrUpdateBookmarkMetadataForUser=t.removeBookmarkMetadataForUser=t.addOrUpdateEmotionMetadataForUser=t.removeEmotionMetadataForUser=t.addEmotionMetadataForUser=t.MessageAnnotations=t.MessageTypeGroups=t.UriObjectTypeSubTypes=t.UriObjectMessageTypes=t.MessageTypes=t.MessageBaseTypes=t.ContentTypes=t.TeamsMentionTypes=t.TeamsItemTypes=t.TeamsMessageProperties=t.MessageProperties=void 0,t.shouldMediaBeSentAsync=t.shouldServerMessageBeFilteredOut=t.getUriObjectMessageTypeGroup=t.isWrittenTextMessageType=t.getMessageTypeGroup=t.isHighlightMessageType=t.isEventCallEndedMessageType=t.isEventCallStartedMessageType=t.hasEmoticons=t.contentContainsUriObjectExceptFile=t.contentContainsUriObject=t.hasAllAtMention=t.hasQuote=t.hasAtMention=t.isSmsDeliveredSuccessfully=t.isCallOrSmsMessageType=t.isEncryptedMessageType=t.isRichTextMessageType=t.isGuestNameUpdateMessageType=t.isTranslationMessageType=t.isCaptionMessageType=t.isPollType=t.isScheduledCallType=t.isMessageSms=t.isJoiningEnabledUpdateMessageType=t.isTopicUpdateMessageType=t.isHistoryDisclosedHiddenUpdateType=t.isJoinedCreatorMessageType=t.isAddMemberMessageType=void 0;const i=s(496486),o=s(889391),n=s(598925),r=s(481169),a=s(746096),l=s(436237),d=s(19524),c=s(404057),h=s(13348);var u,p;function g(e,s,o=t.MessageAnnotations.Like,n,r){let a=i.find(e,(e=>e.key===o));a||(a={key:o,users:[]},e.push(a));const l=Date.now(),d=i.isNumber(n)?n:l,c=i.find(a.users,(e=>e.mri===s));return c?(c.time=d,c.value=void 0===r?""+l:r):a.users.push({mri:s,value:void 0===r?""+l:r,time:d}),e}function m(e,t){const s=e?e[t]:void 0;if(s)return i.isString(s)?c.default.parseJsonErrorToUndefined(s):i.cloneDeep(s)}function S(e){return m(e,t.MessageProperties.ScheduledCallInviteData)}function f(e){const s=m(e,t.MessageProperties.Emotions);return i.isArray(s)?s:[]}function y(e){const s=m(e,t.MessageProperties.PollData);return!i.isUndefined(s)}function v(e){const s=m(e,t.MessageProperties.Poll);return i.isArray(s)?s:[]}function C(e){const t=c.default.parseJsonErrorToUndefined(e);if(t&&t.data)return t.data}t.MessageProperties={Emotions:"emotions",UrlPreviews:"urlpreviews",ForwardMetadata:"forwardMetadata",Prototype:"prototype_skypex",CastParentThreadId:"castParentThreadId",SuggestedActions:"suggestedActions",EditTime:"edittime",DeleteTime:"deletetime",SmsDeliveryReports:"smsdeliveryreports",CellularRelayStatus:"cellularRelayStatus",PollData:"inlinePollData",ScheduledCallInviteData:"scheduledCallInviteData",AlbumId:"albumId",Skypeemoteoffset:"skypeemoteoffset",EventId:"eventId",IsVideoCall:"isVideoCall",Poll:"poll",Starred:"starred",AdditionalData:"additionalData",BingImageTrackingMetadata:"additionalData"},t.TeamsMessageProperties={Mentions:"mentions",Files:"files"},t.TeamsItemTypes={Emoticon:"http://schema.skype.com/Emoji",Mention:"http://schema.skype.com/Mention",File:"http://schema.skype.com/File"},t.TeamsMentionTypes={Person:"person",Channel:"channel",Team:"team"},t.ContentTypes={Text:"text",Xml:"text/xml; charset=UTF-8",Event:"json/event"},t.MessageBaseTypes={Message:"Message",Event:"Event"},function(e){e.Text="Text",e.RichText="RichText",e.PopCard="PopCard",e.Notice="Notice",e.SignalRelay="Signal/Relay",e.LegacyNudge="Nudge",e.Poll="Poll",e.UriObject="RichText/UriObject",e.Media_Card="RichText/Media_Card",e.Media_FlikMsg="RichText/Media_FlikMsg",e.Media_GenericFile="RichText/Media_GenericFile",e.ScheduledCallInvite="RichText/ScheduledCallInvite",e.SkypeVideoMessage="Event/SkypeVideoMessage",e.Media_Video="RichText/Media_Video",e.VideoMessage="RichText/Media_Video",e.CastRecording="RichText/Media_CallRecording",e.Media_Audio="RichText/Media_AudioMsg",e.AudioMessage="RichText/Media_AudioMsg",e.VoiceMail="RichText/Media_VoiceMail",e.Call="Event/Call",e.Typing="Control/Typing",e.ClearTyping="Control/ClearTyping",e.LiveState="Control/LiveState",e.Contacts="RichText/Contacts",e.Files="RichText/Files",e.Sms="RichText/Sms",e.Mms="RichText/Mms",e.Location="RichText/Location",e.CallerID="RichText/CallerID",e.MediaAlbum="RichText/Media_Album",e.AddMember="ThreadActivity/AddMember",e.DeleteMember="ThreadActivity/DeleteMember",e.RoleUpdate="ThreadActivity/RoleUpdate",e.TopicUpdate="ThreadActivity/TopicUpdate",e.PictureUpdate="ThreadActivity/PictureUpdate",e.HistoryDisclosedUpdate="ThreadActivity/HistoryDisclosedUpdate",e.JoiningEnabledUpdate="ThreadActivity/JoiningEnabledUpdate",e.LegacyMemberAdded="ThreadActivity/LegacyMemberAdded",e.LegacyMemberUpgraded="ThreadActivity/LegacyMemberUpgraded",e.HighlightsFollow="ThreadActivity/HighlightsFollow",e.HighlightsAdd="ThreadActivity/HighlightsAdd",e.HighlightsRefuseFollow="ThreadActivity/HighlightsRefuseFollow",e.HighlightsRemoveFollow="ThreadActivity/HighlightsRemoveFollow",e.HighlightsRefuseAdd="ThreadActivity/HighlightsRefuseAdd",e.HighlightsRemoveAdd="ThreadActivity/HighlightsRemoveAdd",e.ScheduledCallNowReminder="ThreadActivity/ScheduledCallNowReminder",e.ScheduledCallUpdate="ThreadActivity/ScheduledCallUpdate",e.ScheduledCallCancellation="ThreadActivity/ScheduledCallCancellation",e.ScheduledCallRSVP="ThreadActivity/ScheduledCallRSVP",e.HandshakeInvite="ThreadActivity/E2EEHandshakeInvite",e.HandshakeAccept="ThreadActivity/E2EEHandshakeAccept",e.HandshakeComplete="ThreadActivity/E2EEHandshakeComplete",e.HandshakeReject="ThreadActivity/E2EEHandshakeReject",e.ModeratedThreadUpdate="ThreadActivity/ModeratedThreadUpdate",e.CallInfo="RichText/Cast",e.InviteFreeText="InviteFreeRelationshipChanged/Initialized",e.InviteFreeConversationAccepted="InviteFreeRelationshipChanged/ConversationAccepted",e.EncryptedText="EndToEndEncryption/EncryptedText",e.EncryptedMedia="EndToEndEncryption/EncryptedMedia",e.EncryptedCall="Event/EncryptedCall",e.TeamsHtml="RichText/Html",e.TeamsFile="Spaces/File",e.TeamsMeetingMemberLeft="ThreadActivity/MemberLeft",e.TeamsMeetingMemberJoined="ThreadActivity/MemberJoined",e.TeamsTabUpdated="ThreadActivity/TabUpdated",e.Caption="Caption",e.SignalCaption="Signal/Caption",e.Translation="Translation",e.Data="Data",e.TranslationSettings="TranslationSettings",e.HistoryActivityDeleteMessage="HistoryActivity/DeleteMessage",e.GuestNameUpdate="Guest/NameUpdate",e.MagicBotEvent="Event/BingBot"}(u||(u={})),t.MessageTypes=u,t.UriObjectMessageTypes=[t.MessageTypes.UriObject,t.MessageTypes.EncryptedMedia,t.MessageTypes.Media_Card,t.MessageTypes.Media_FlikMsg,t.MessageTypes.Media_GenericFile,t.MessageTypes.Media_Video,t.MessageTypes.Media_Audio,t.MessageTypes.VideoMessage,t.MessageTypes.CastRecording,t.MessageTypes.AudioMessage,t.MessageTypes.CallInfo,t.MessageTypes.ScheduledCallInvite,t.MessageTypes.Poll,t.MessageTypes.Data,t.MessageTypes.TranslationSettings,t.MessageTypes.MediaAlbum],t.UriObjectTypeSubTypes={Video:{CallRecording:"CallRecording",Flik:"Flik",Message:"Message"},Audio:{Message:"Message"}},function(e){e[e.None=1]="None",e[e.Text=2]="Text",e[e.System=3]="System",e[e.Picture=4]="Picture",e[e.Video=5]="Video",e[e.Audio=6]="Audio",e[e.Moji=7]="Moji",e[e.Calling=8]="Calling",e[e.UriFile=9]="UriFile",e[e.SwiftCard=10]="SwiftCard",e[e.Location=11]="Location",e[e.SMS=12]="SMS",e[e.CallerID=13]="CallerID",e[e.Sticker=14]="Sticker",e[e.CellularMessage=15]="CellularMessage",e[e.Contact=16]="Contact",e[e.ScheduledCallInvite=17]="ScheduledCallInvite",e[e.Poll=18]="Poll",e[e.Gif=19]="Gif",e[e.Engagement=20]="Engagement",e[e.MediaAlbum=21]="MediaAlbum",e[e.Translation=22]="Translation"}(p=t.MessageTypeGroups||(t.MessageTypeGroups={})),t.MessageAnnotations={ReactionsConsumptionHorizon:"reactionsConsumptionHorizon",Like:"like",Heart:"heart",ViewCount:"viewCount",Bookmark:"bookmark",ScheduledCallInviteAccepted:"scheduledCallInviteAccepted",ScheduledCallInviteDeclined:"scheduledCallInviteDeclined"},t.addEmotionMetadataForUser=function(e,s,i=t.MessageAnnotations.Like,o){return g(e,s,i,void 0,o)},t.removeEmotionMetadataForUser=function(e,s,o=t.MessageAnnotations.Like){const n=i.find(e,(e=>e.key===o));return n&&(i.remove(n.users,(e=>e.mri===s)),0===n.users.length&&i.remove(e,(e=>e.key===o))),e},t.addOrUpdateEmotionMetadataForUser=g,t.removeBookmarkMetadataForUser=function(e,s){const o=t.MessageAnnotations.Bookmark,n=i.find(e,(e=>e.key===o));return n&&(i.remove(n.users,(e=>e.mri===s)),0===n.users.length&&i.remove(e,(e=>e.key===o))),e},t.addOrUpdateBookmarkMetadataForUser=function(e,s,o){const n=t.MessageAnnotations.Bookmark;let r=i.find(e,(e=>e.key===n));r||(r={key:n,users:[]},e.push(r));const a=Date.now(),l=i.find(r.users,(e=>e.mri===s));return l?(l.time=a,l.value=JSON.stringify(i.merge(c.default.parseJsonErrorToUndefined(l.value),o))):r.users.push({mri:s,value:JSON.stringify(o),time:a}),e},t.getBookmarkMetadataForUser=function(e,s){const o=v(e),n=i.find(o,(e=>e.key===t.MessageAnnotations.Bookmark));if(!n)return;const r=i.find(n.users,(e=>e.mri===s));return r?c.default.parseJsonErrorToUndefined(r.value):void 0},t.addOrUpdateVoteForUser=function(e,t,s){let o=i.find(e,(e=>e.key===s));o||(o={key:s,users:[]},e.push(o));const n=i.indexOf(e,o),r=Date.now();let a=i.find(o.users,(e=>e.mri===t));if(a)a=Object.assign(Object.assign({},a),{time:r});else{const e={mri:t,time:r},s=[...o.users,e];o=Object.assign(Object.assign({},o),{users:s})}return e[n]=o,e},t.removeVoteForUser=function(e,t,s){const o=i.find(e,(e=>e.key===s));if(o){i.find(o.users,(e=>e.mri===t))&&i.remove(o.users,(e=>e.mri===t))}return e},t.getJsonFromMessageProperty=m,t.getTeamsMentionProperties=function(e){return m(e,t.TeamsMessageProperties.Mentions)},t.getTeamsFileProperties=function(e){return m(e,t.TeamsMessageProperties.Files)},t.getForwardedTeamsProperties=function(e){return i.pick(e,[t.TeamsMessageProperties.Mentions,t.TeamsMessageProperties.Files])},t.getScheduledCallInviteData=S,t.getScheduledCallConsumptionHorizons=function(e){const t=S(e);return t&&t.consumptionHorizons?t.consumptionHorizons:{}},t.getEmotionMetadata=f,t.getCleanedEmotionMetadata=function(e){return i.filter(f(e),(e=>e.key!==t.MessageAnnotations.ViewCount&&e.key!==t.MessageAnnotations.ReactionsConsumptionHorizon))},t.flattenEmotionMetadata=function(e){return(0,r.chain)(e,(0,r.map)((e=>i.map(e.users,(t=>({key:e.key,time:t.time||0,mri:t.mri}))))),(0,r.flatten)(),(0,r.sortBy)((e=>e.time)))},t.isPollUsingCustomProp=y,t.getBookmarkMetadata=function(e){return m(e,t.MessageProperties.Starred)},t.getBookmarkSourceMetadata=v,t.getPollMetadata=function(e){const s=y(e)?m(e,t.MessageProperties.PollData):m(e,t.MessageProperties.Emotions);return i.isArray(s)?s:[]},t.getScheduledCallMetadata=function(e){const s=m(e,t.MessageProperties.Emotions);return i.isArray(s)?s:[]},t.getSmsDeliveryReport=function(e){const s=m(e,t.MessageProperties.SmsDeliveryReports);if(s&&s.length>0&&s[0].users&&s[0].users.length>0)return c.default.parseJsonErrorToUndefined(s[0].users[0].value)},t.getUrlPreviewMetadata=function(e){const s=m(e,t.MessageProperties.UrlPreviews);return i.isArray(s)?s:[]},t.getForwardMetadata=function(e){return m(e,t.MessageProperties.ForwardMetadata)||{isForwarded:!1}},t.getTranslationSettingsMetadata=C,t.getTranslationSettingsState=function(e){const t=C(e);if(t){const e=parseInt(n.TranslationState[t.newTranslationState],10);if(e in n.TranslationState)return e}},t.getMessageTranslationMetadata=function(e){const t=c.default.parseJsonErrorToUndefined(e);if(t&&t.translations)return t},t.getEditTime=function(e){const s=m(e,t.MessageProperties.EditTime);if(s)return s};const _=/<\/?e_m[^<>]*>/gi,b=/(<legacyquote[^>]*?\/>|<legacyquote[^>]*>[^]*?<\/legacyquote>)/gi;function T(e){const s=(e||"").toLowerCase();return i.includes([t.MessageTypes.Mms.toLowerCase(),t.MessageTypes.Translation.toLowerCase(),t.MessageTypes.Data.toLowerCase(),t.MessageTypes.TranslationSettings.toLowerCase()],s)}function M(e){if(!o.default.getS4LMessagingFeaturesNoSubscription().enableParsingHtmlMessages)return!1;return(e||"").toLowerCase()===t.MessageTypes.TeamsHtml.toLowerCase()}function I(e){return e.messagetype===t.MessageTypes.CallInfo}function w(e){return e.messagetype===t.MessageTypes.Call||e.messagetype===t.MessageTypes.EncryptedCall}function P(e,s,o){return e===t.MessageTypes.AddMember&&i.includes(s,`<target>${o}</target>`)}function k(e,s){return e===t.MessageTypes.HistoryDisclosedUpdate&&i.includes(s,"<value>false</value>")}function A(e){return e===t.MessageTypes.TopicUpdate}function x(e){return e===t.MessageTypes.Sms}function R(e){return e===t.MessageTypes.GuestNameUpdate}function O(e){return/<URIObject/.test(e)}function L(e){if(!e||!e.messagetype)return p.None;const s=e.messagetype;switch(s){case t.MessageTypes.UriObject:return B(e);case t.MessageTypes.Media_FlikMsg:return p.Moji;case t.MessageTypes.Media_GenericFile:case t.MessageTypes.EncryptedMedia:return p.UriFile;case t.MessageTypes.Media_Video:case t.MessageTypes.VideoMessage:case t.MessageTypes.CastRecording:return p.Video;case t.MessageTypes.Media_Audio:case t.MessageTypes.AudioMessage:return p.Audio;case t.MessageTypes.MediaAlbum:return p.MediaAlbum;case t.MessageTypes.CallInfo:case t.MessageTypes.Call:case t.MessageTypes.EncryptedCall:return p.Calling;case t.MessageTypes.Media_Card:return p.SwiftCard;case t.MessageTypes.CallerID:return p.CallerID;case t.MessageTypes.RichText:case t.MessageTypes.Text:case t.MessageTypes.InviteFreeText:case t.MessageTypes.EncryptedText:case t.MessageTypes.ScheduledCallInvite:case t.MessageTypes.Poll:case t.MessageTypes.Caption:case t.MessageTypes.SignalCaption:return B(e);case t.MessageTypes.MagicBotEvent:return(i=e).messagetype===t.MessageTypes.MagicBotEvent&&Object.values(h.OneOnOneMagicBotControls).includes(i.content)?p.None:B(i);case t.MessageTypes.Location:return p.Location;case t.MessageTypes.Contacts:return p.Contact;case t.MessageTypes.Files:return p.Text;case t.MessageTypes.Sms:return p.SMS;case t.MessageTypes.Mms:return function(e){return-1!==e.content.indexOf('"object_id"')?p.Picture:p.SMS}(e);case t.MessageTypes.AddMember:case t.MessageTypes.DeleteMember:case t.MessageTypes.RoleUpdate:case t.MessageTypes.TopicUpdate:case t.MessageTypes.PictureUpdate:case t.MessageTypes.HistoryDisclosedUpdate:case t.MessageTypes.JoiningEnabledUpdate:case t.MessageTypes.LegacyMemberAdded:case t.MessageTypes.LegacyMemberUpgraded:case t.MessageTypes.HighlightsFollow:case t.MessageTypes.HighlightsRefuseFollow:case t.MessageTypes.HighlightsRemoveFollow:case t.MessageTypes.HighlightsRefuseAdd:case t.MessageTypes.HighlightsRemoveAdd:case t.MessageTypes.HandshakeInvite:case t.MessageTypes.HandshakeAccept:case t.MessageTypes.HandshakeComplete:case t.MessageTypes.HandshakeReject:case t.MessageTypes.ModeratedThreadUpdate:case t.MessageTypes.ScheduledCallNowReminder:case t.MessageTypes.ScheduledCallCancellation:case t.MessageTypes.ScheduledCallUpdate:case t.MessageTypes.ScheduledCallRSVP:case t.MessageTypes.Data:case t.MessageTypes.TranslationSettings:case t.MessageTypes.GuestNameUpdate:return p.System;case t.MessageTypes.HighlightsAdd:case t.MessageTypes.LegacyNudge:case t.MessageTypes.Typing:case t.MessageTypes.ClearTyping:case t.MessageTypes.SignalRelay:case t.MessageTypes.LiveState:case t.MessageTypes.SkypeVideoMessage:case t.MessageTypes.VoiceMail:case t.MessageTypes.InviteFreeConversationAccepted:return p.None;case t.MessageTypes.Notice:case t.MessageTypes.PopCard:return p.Engagement;case t.MessageTypes.Translation:return p.Translation;case t.MessageTypes.TeamsHtml:return p.Text;case t.MessageTypes.TeamsFile:case t.MessageTypes.TeamsMeetingMemberLeft:case t.MessageTypes.TeamsMeetingMemberJoined:case t.MessageTypes.TeamsTabUpdated:return l.log(a.LogTraceArea.ChatService,`Unsupported 'Teams' MessageType received: ${s}`),p.None;case t.MessageTypes.HistoryActivityDeleteMessage:return l.log(a.LogTraceArea.ChatService,`Unsupported 'Windows Phone' MessageType received: ${s}`),p.None;default:return l.error(a.LogTraceArea.ChatService,"Unhandled Message Type: "+e.messagetype),p.None}var i}t.isDeletedMessage=function(e){if(!e.content)return!0;if(!e.skypeeditoffset&&!e.skypeemoteoffset&&"<"!==e.content[0])return!1;const t=(0|Number(e.skypeeditoffset))+(0|Number(e.skypeemoteoffset));return e.content.length<=t||"<"===e.content[t]&&">"===i.last(e.content)&&0===e.content.substring(t).replace(_,"").replace(b,"").length},t.isXmlMessageType=function(e){if(M(e))return!1;const s=(e||"").toLowerCase();return s!==t.MessageTypes.Text.toLowerCase()&&s!==t.MessageTypes.InviteFreeText.toLowerCase()&&!T(e)&&0!==s.indexOf("control")},t.isJsonMessageType=T,t.isHtmlMessageType=M,t.isThreadActivityType=function(e){return 0===(e||"").toLowerCase().indexOf("threadactivity")||R(e)},t.isScheduledCallMetadataType=function(e){return-1!==(e||"").toLowerCase().indexOf("scheduledcall")},t.isCallInfoMessageType=I,t.isCallInfoForCallMessageType=function(e){return I(e)&&-1!==e.content.indexOf('containerType="Call')},t.isCallMessageType=w,t.isContactMessageType=function(e){return e.messagetype===t.MessageTypes.Contacts},t.isAddMemberMessageType=function(e){return e===t.MessageTypes.AddMember},t.isJoinedCreatorMessageType=P,t.isHistoryDisclosedHiddenUpdateType=k,t.isTopicUpdateMessageType=A,t.isJoiningEnabledUpdateMessageType=function(e){return e===t.MessageTypes.JoiningEnabledUpdate},t.isMessageSms=x,t.isScheduledCallType=function(e){return e===t.MessageTypes.ScheduledCallInvite},t.isPollType=function(e){return e===t.MessageTypes.Poll},t.isCaptionMessageType=function(e){return e===t.MessageTypes.Caption||e===t.MessageTypes.SignalCaption},t.isTranslationMessageType=function(e){return e===t.MessageTypes.Translation},t.isGuestNameUpdateMessageType=R,t.isRichTextMessageType=function(e=""){return 0===e.indexOf("RichText")},t.isEncryptedMessageType=function(e=""){return 0===e.indexOf("EndToEndEncryption")},t.isCallOrSmsMessageType=function(e){return w(e)||x(e.messagetype)},t.isSmsDeliveredSuccessfully=function(e){const{status:t,errorCategory:s}=e;return t===d.SkypeSmsDeliveryStatus.Success&&s===d.SkypeSmsErrorCategory.NoError||s===d.SkypeSmsErrorCategory.NumberBlocked},t.hasAtMention=function(e){return/<at\s+id/.test(e)},t.hasQuote=function(e){return/<quote\s+author/.test(e)},t.hasAllAtMention=function(e){return/<at\s+id="\*"/.test(e)},t.contentContainsUriObject=O,t.contentContainsUriObjectExceptFile=function(e){return O(e)&&!/^[^>]+type=['"]File['"\.]/i.test(e)},t.hasEmoticons=function(e){return/<ss\s+type=\".*\"/.test(e)||/<span[^>]*>\s*<img[^>]*itemid=".*"/.test(e)},t.isEventCallStartedMessageType=function(e){return e&&e.messagetype===t.MessageTypes.Call&&(0===e.content.indexOf("<partlist ")&&-1!==e.content.indexOf('type="started"',10)||0===e.content.indexOf('<partlist alt=""></partlist>'))},t.isEventCallEndedMessageType=function(e){return e&&""!==e.content&&e.messagetype===t.MessageTypes.Call&&0===e.content.indexOf("<partlist ")&&-1!==e.content.indexOf('type="ended"',10)},t.isHighlightMessageType=function(e){const t=L(e);return t===p.Picture||t===p.Video},t.getMessageTypeGroup=L;const F=[t.MessageTypes.RichText,t.MessageTypes.Text,t.MessageTypes.InviteFreeText,t.MessageTypes.EncryptedText,t.MessageTypes.MagicBotEvent];function B(e){if(!e.content||!i.startsWith(e.content,"<URIObject"))return p.Text;const t=e.content.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),s=e.content.match(/<meta[^>]*?\stype=\"([^"]+?)\"/i);if(!t)return s&&"photo"===s[1]?p.Picture:e.content.match(/<Swift/)?p.SwiftCard:p.Text;const o=t[1].split(".")[0];return"File"===o?p.UriFile:"Picture"===o?p.Picture:"Video"===o?p.Video:"SWIFT"===o?p.SwiftCard:"Sticker"===o?p.Sticker:"ScheduledCallInvite"===o?p.ScheduledCallInvite:"Poll"===o?p.Poll:"Video.1/Flik.1"===t[1]||"Video.1/Flik.2"===t[1]?p.Moji:p.Text}t.isWrittenTextMessageType=function(e){return i.includes(F,e)},t.getUriObjectMessageTypeGroup=B,t.shouldServerMessageBeFilteredOut=function(e,t){const s=t.createdDate(),n=t.creator();if(s&&e.createdTime-s<o.default.getS4LCMCFeatures().serverMessagesAfterThreadCreationTimeWindow){const t=[P,A,k];return i.some(t,(t=>t(e.messagetype,e.content,n)))}return!1},t.shouldMediaBeSentAsync=function(e,t,s,i){return(t<e||!s)&&!i}},92427:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t){const s=Object.keys(t).filter((t=>void 0!==e[t])).map((s=>({v1:e[s],v2:t[s]})));this._mappingToV1=s.reduce(((e,t)=>(e[t.v2]=t.v1,e)),{}),this._mappingToV2=s.reduce(((e,t)=>(e[t.v1]=t.v2,e)),{})}_doPropertyNamesOverlap(e,t){return Object.values(e).some((e=>Object.values(t).includes(e)))}mapToV1(e){const t=this._mappingToV1[e];return null!=t?t:e}mapToV2(e){const t=this._mappingToV2[e];return null!=t?t:e}}},671830:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isUserMri=t.isAllGlobalClearMri=t.asSkypeId=t.asSkypeThreadId=t.asSkypeThreadIdMaybe=t.asMri=t.asMriMaybe=t.isSkypeId=t.isMri=t.replaceNamespace=t.sanitizeMri=t.idAndNamespaceToMri=t.skypeIdToMri=t.getThreadPropsInConversationView=t.ThreadPropsInConversationView=t.ConnectorPrefixes=t.SubscriptionTypes=t.ServerUserProps=t.UserProps=t.newConnectionAcceptedPropValue=t.ConversationPropsMapping=t.ConversationPropsV2=t.ConversationProps=t.ThreadPropsMapping=t.ThreadPropsV2=t.ThreadProps=t.ConnectorThreadPropPrefix=t.V2ThreadIdSuffix=t.BookmarksThreadId=t.P2PSkypeThreadIdSuffix=t.SkypeThreadIdSuffix=t.OneToOneThreadIdSuffix=t.EncryptedThreadIdSuffix=t.ReactionThreadIdSuffix=t.HighlightsThreadIdSuffix=t.SkonsoleMri=t.AllGlobalClearMri=t.ThreadTypes=t.Namespaces=t.ChatServiceErrors=t.BotHighlightMessageContent=t.MaxChatServiceInitialPropsLoadTimeoutInMs=t.RecentMessageHistoryTimePeriodHighlights=t.RecentMessageHistoryTimePeriod=t.MinimumConversationsToTryToShow=t.BeginningOfTime=t.GuestUserMriPrefix=t.OrgIdUserPrefix=t.CIDPostfix=t.CIDPrefix=void 0,t.isBrickedOneToOneThread=t.isOneToOneThread=t.isEncryptedThread=t.isSmsMmsThread=t.isReactionsThread=t.isMyHighlightThread=t.isMergingBotHighlightMessageRaw=t.isBotHighlightsThread=t.isHighlightsThread=t.getConversationLinkWithNewId=t.getCreatorMriForMessageFromLink=t.getConnectorIntegrationIdFromMri=t.getMriFromS4BId=t.getMriFromPhoneNumberString=t.getMriFromPhoneNumber=t.getPhoneNumberFromMri=t.getSkypeIdFromMri=t.isOrgIdUserMri=t.isGuestUserMri=t.isS4BBridgeMri=t.isMsaMri=t.isSkypeIdMri=t.isBlockedPSTNMri=t.isCallLog=t.isEcho=t.isBotChat=t.isConnector=t.isGalleryInConversationSupported=t.isSearchInConversationSupported=t.isAgent=t.isThread=t.isGroupConversation=t.getMyBotId=t.isMyBotConversation=t.isBookmarkConversation=t.isOneOnOneConversation=t.stripMriNamespace=t.getMriNamespace=t.splitSkypeId=t.splitMri=t.isHiddenBotMri=t.isConciergeBotMri=t.isReadOnlyConversation=t.isValidNamespaceMri=t.isMriWithUserMetadata=t.isDisplayableStrippedMri=t.isConversationWithPhoneNumber=t.isPhoneMri=t.isOneToOneThreadUserMriNamespace=t.isMriNamespaceUser=void 0,t.findPushSubscriptionInfo=t.createLongPollSubscriptionParams=t.createPushSubscriptionParams=t.ChannelTypes=t.getRegistrationTokenFromHeader=t.getSkypetokenFromAuthenticationHeader=t.REGISTRATION_TOKEN_HEADER_PREFIX=t.SKYPE_TOKEN_HEADER_PREFIX=t.getClientCapabilities=t.getClientInfoString=t.areEndpointPresenceDocsEqual=t.buildEndpointPresenceDocData=t.getEndpointFeaturesList=t.getExpiresFromRegToken=t.getEndpointIdFromRegToken=t.filterMembersProp=t.encodeEndpointInfoForLog=t.encodeSyncStateForLog=t.decodeSyncState=t.getHoverTitle=t.getLastSeenPresenceText=t.encodeStatus=t.parseStatus=t.parseAvailability=t.unescapeTextWithoutXml=t.getParsedConversationId=t.parseConversationId=t.getNewestConsumptionHorizon=t.isConsumptionHorizonNewer=t.getCuidFromConsumptionHorizon=t.getConsumptionHorizonUpdateTime=t.getServerTimestampFromConsumptionHorizon=t.getConsumptionHorizonForMessageAndCHID=t.getConsumptionHorizonForMessage=t.getCHIDForMessage=t.getCuidForMessage=t.updateConsumptionHorizonWithCurrentClientTime=t.buildOneOnOneEncryptedThreadId=t.buildOneOnOneThreadId=t.isComposingStateSupported=t.getReactionsThreadMriForCallId=t.getReactionThreadIdForCallId=t.getSkypeIdFromHighlightsThreadMri=t.getHighlightsThreadMriForSkypeId=t.getMemberMrisWithoutMe=t.getSkypeMriFromBotHighlightsThreadMri=t.isV2OneToOneThread=t.isV2Thread=t.isP2PSkypeThread=t.isSkypeThread=void 0,t.filterSkypeIdMris=t.getProperty=t.isMessageFromOrigin=t.calculateEndpointUrl=t.isNotFound=t.getRedirectUrl=t.isEndpointMissing=t.isRedirect=t.getEnvironmentNameFromUrl=t.getConnectionTypeFromUrl=t.getTcidDataFromServerMessageResponse=t.isValidPresenceMri=t.getTextualEndpointInfo=t.getEndpointIdFromPresenceDoc=t.formatEndpointIdRemoveBrackets=t.formatEndpointId=t.areEndpointIdsEqual=t.getMriTypeForTelemetry=t.getThreadSuffix=t.isDogfoodCloudUrl=t.getEpidFromUri=void 0;const i=s(496486),o=s(482897),n=s(889391),r=s(902040),a=s(351077),l=s(890239),d=s(440276),c=s(746096),h=s(861253),u=s(647662),p=s(733754),g=s(18078),m=s(808222),S=s(640363),f=s(626712),y=s(853374),v=s(92427);var C;let _;var b,T;t.CIDPrefix=":cid-(",t.CIDPostfix=")@outlook.com",t.OrgIdUserPrefix="orgid:",t.GuestUserMriPrefix="guest:",t.BeginningOfTime=2,t.MinimumConversationsToTryToShow=50,t.RecentMessageHistoryTimePeriod=12096e5,t.RecentMessageHistoryTimePeriodHighlights=6048e5,t.MaxChatServiceInitialPropsLoadTimeoutInMs=5e4,t.BotHighlightMessageContent='highlight="true"',function(e){e[e.CT_UNKNOWN=0]="CT_UNKNOWN",e[e.CT_DESKTOP=1]="CT_DESKTOP",e[e.CT_WEB_MESSENGER=2]="CT_WEB_MESSENGER",e[e.CT_WINDOWS_MOBILE=3]="CT_WINDOWS_MOBILE",e[e.CT_XBOX=4]="CT_XBOX",e[e.CT_ZUNE=5]="CT_ZUNE",e[e.CT_IPHONE=6]="CT_IPHONE",e[e.CT_MAC_MESSENGER=7]="CT_MAC_MESSENGER",e[e.CT_SMS_MESSENGER=8]="CT_SMS_MESSENGER",e[e.CT_MODERN_MESSENGER=9]="CT_MODERN_MESSENGER",e[e.CT_SKYPE_OTHER=10]="CT_SKYPE_OTHER",e[e.CT_SKYPE_WINDOWS=11]="CT_SKYPE_WINDOWS",e[e.CT_SKYPE_WIN8=12]="CT_SKYPE_WIN8",e[e.CT_SKYPE_MAC=13]="CT_SKYPE_MAC",e[e.CT_SKYPE_LINUX=14]="CT_SKYPE_LINUX",e[e.CT_SKYPE_WINDOWS_PHONE=15]="CT_SKYPE_WINDOWS_PHONE",e[e.CT_SKYPE_IOS=16]="CT_SKYPE_IOS",e[e.CT_SKYPE_ANDROID=17]="CT_SKYPE_ANDROID",e[e.CT_SKYPE_SKYPEKIT=18]="CT_SKYPE_SKYPEKIT",e[e.CT_LAST=19]="CT_LAST"}(C||(C={})),function(e){e[e.AccessDenied=209]="AccessDenied",e[e.InvalidSyncToken=230]="InvalidSyncToken",e[e.ThreadAlreadyExists=409]="ThreadAlreadyExists",e[e.EndpointMissing=729]="EndpointMissing",e[e.InitiatorNotPartOfThread=730]="InitiatorNotPartOfThread",e[e.ThreadNotFound=732]="ThreadNotFound",e[e.UserInAnotherCloud=752]="UserInAnotherCloud",e[e.PerUserLoginLimitExceeded=803]="PerUserLoginLimitExceeded",e[e.QuarantineLimitExceeded=804]="QuarantineLimitExceeded",e[e.StaleUic=923]="StaleUic"}(b=t.ChatServiceErrors||(t.ChatServiceErrors={})),function(e){e[e.MSA=1]="MSA",e[e.S4B_Bridge=2]="S4B_Bridge",e[e.PSTN=4]="PSTN",e[e.SkypeId=8]="SkypeId",e[e.Thread=19]="Thread",e[e.LegacyShortCircuit=20]="LegacyShortCircuit",e[e.OneToOneTextMessage=21]="OneToOneTextMessage",e[e.GroupTextMessage=22]="GroupTextMessage",e[e.Bot=28]="Bot",e[e.PersonalUserStream=48]="PersonalUserStream"}(T=t.Namespaces||(t.Namespaces={}));const M="CallEnded_";function I(e,t){return t+":"+e}function w(e,t){const s=e.replace("#T/","");return P(s)?s:I(s,t)}function P(e){return r.ValidMriRegExp.test(e)}function k(e){return e&&P(e)?e:void 0}function A(e){return e}function x(e){return e}function R(e){return e}function O(e){return e===T.MSA||e===T.S4B_Bridge||e===T.SkypeId||e===T.Bot||e===T.LegacyShortCircuit||e===T.PSTN}function L(e){if(!P(e))return!1;return B(e)===T.PSTN}function F(e){const t=e.indexOf(":"),s=e.substring(0,t);return{namespace:Number(s),id:e.substring(t+1)}}function B(e){return F(e).namespace}function D(e){return F(e).id}function E(e){const t=B(e);return O(t)||q(e)||J(e)||K(e)||L(e)||t===T.OneToOneTextMessage}function V(e){return e===t.BookmarksThreadId}function N(e){return n.default.getS4LMessagingFeaturesNoSubscription().enableMyBot&&e===U()}function U(){const e=n.default.getS4LMessagingFeaturesNoSubscription().myBotId;return e?w(e,T.Bot):e}function j(e){return B(e)===T.Thread}function H(e){return B(e)===T.Bot&&!i.startsWith(D(e),t.ConnectorPrefixes.IntegrationNamespace)}function z(e){return B(e)===T.SkypeId}function W(e){const s=F(e);return s.namespace===T.SkypeId&&i.startsWith(s.id,t.GuestUserMriPrefix)}function G(e){return j(e)&&i.endsWith(e,t.HighlightsThreadIdSuffix)}function K(e){return j(e)&&i.endsWith(e,t.EncryptedThreadIdSuffix)}function q(e){return j(e)&&i.endsWith(e,t.OneToOneThreadIdSuffix)}function Q(e){return j(e)&&i.endsWith(e,t.SkypeThreadIdSuffix)||$(e)||X(e)}function X(e){return j(e)&&i.endsWith(e,t.P2PSkypeThreadIdSuffix)}function $(e){return j(e)&&i.endsWith(e,t.V2ThreadIdSuffix)}function J(e){return/19:uni01_.+@thread.v2/.test(e)}function Y(e){return I(e+t.HighlightsThreadIdSuffix,T.Thread)}function Z(e){return e.replace(/-/g,"")}function ee(e,t){const s=e<t?e+"|"+t:t+"|"+e;return d.byteArrayToHexString(d.computeSHA256(s)).toLowerCase()}function te(e,t,s){return e+":"+t+s}function se(e){if(a.isEventCallEndedMessageType(e)){return(e.skypeguid?M+e.skypeguid:void 0)||e.clientmessageid||e.id}return e.skypeeditedid||e.clientmessageid||e.id}function ie(e,t){return e+";"+Date.now()+";"+t}function oe(e){if(!e)return 0;const t=e.split(";")[0];return Number(t)}function ne(e){if(!e)return"0";return e.split(";")[2]}function re(e,t){if(e===t)return!1;const s=oe(e),i=oe(t);return!(s>i)&&(s!==i||ne(e)!==ne(t))}function ae(e){return i.split(e,";")[0]}t.ThreadTypes={Reactions:"cast",Phone:"phone",LegacyMeetNow:"meeting"},t.AllGlobalClearMri="ALL",t.SkonsoleMri="99:skonsole@skonsole.skonsole",t.HighlightsThreadIdSuffix="@highlights.skype",t.ReactionThreadIdSuffix="@cast.skype",t.EncryptedThreadIdSuffix="@encrypted.skype",t.OneToOneThreadIdSuffix="@oneToOne.skype",t.SkypeThreadIdSuffix="@thread.skype",t.P2PSkypeThreadIdSuffix="@p2p.thread.skype",t.BookmarksThreadId="48:starred",t.V2ThreadIdSuffix="@thread.v2",t.ConnectorThreadPropPrefix="integration",t.ThreadProps={BannedUserList:"banneduserlist",ConvView_MemberCount:"membercount",ConvView_MemberListString:"members",Creator:"creator",CreatedAt:"createdat",DisableAnonymousJoin:"disableanonymousjoin",HistoryDisclosed:"historydisclosed",IsContentChannel:"isContentChannel",IsSticky:"isStickyThread",JoinEnabled:"joiningenabled",LastJoinAt:"lastjoinat",LastLeaveAt:"lastleaveat",LiveState:"awareness_conversationLiveState",MagicBotEnabled:"magicbotenabled",MessageTranslationLocale:"messageTranslationLocale",ModeratedThread:"moderatedthread",ParentThreadId:"castParentThreadId",Picture:"picture",SecureDeviceSwitch:"secureDeviceSwitch",SecureHandshake:"encryptionHandshake",SecureHandshakeOnceEstablished:"encryptionHandshakeOnceEstablished",Source:"source",ThreadDetailsVersion:"version",ThreadType:"threadType",TopicName:"topic",Translated:"translated"},t.ThreadPropsV2={LiveState:"awareness_conversationLiveState:0"},t.ThreadPropsMapping=new v.default(t.ThreadProps,t.ThreadPropsV2),t.ConversationProps={Alerts:"alerts",Archived:"archived",Color:"color",ConsumptionHorizon:"consumptionhorizon",ConversationBlocked:"conversationblocked",ConversationStatus:"conversationstatus",ConversationStatusProperties:"conversationstatusproperties",DeleteTimestamp:"clearedat",Favorite:"favorite",IsEmptyConversation:"isemptyconversation",LiveState:"awareness_conversationLiveState",MessageTranslationLocale:"messageTranslationLocale",NewConnectionMessageId:"new-connection-message-id",OneToOneThreadId:"onetoonethreadid",Participants:"participants",Pinned:"pinned",Subscription:"subscription",SuggestedActions:"suggestedactions",SuggestionsAugmentation:"suggestionsaugmentation",Translated:"translated"},t.ConversationPropsV2={Pinned:"ispinned",DeleteTimestamp:"clearHistoryTime",LiveState:"awareness_conversationLiveState:0"},t.ConversationPropsMapping=new v.default(t.ConversationProps,t.ConversationPropsV2),t.newConnectionAcceptedPropValue="0",t.UserProps={AlertsLastReadTime:"alertsLastReadTime",BingBackgroundsEffectDismissed:"bingBackgroundsEffectSeen",BingSearchHistoryEnabled:"bingSearchHistoryEnabled",BingSearchTrendingEnabled:"bingSearchTrendingEnabled",CallNotificationsWhileDND:"callNotificationsWhileDND",CallTranslatorAlwaysStart:"callTranslatorAlwaysStart",CallTranslatorBotSpokenLanguageLocale:"callTranslatorBotSpokenLanguageLocale",CallTranslatorBotSubtitleLanguageLocale:"callTranslatorBotSubtitleLanguageLocale",CallTranslatorBotTranslationVoice:"callTranslatorBotTranslationVoice",CallTranslatorCaptionsPositionMode:"callTranslatorCaptionsPositionMode",CallTranslatorPrivacyConsent:"callTranslatorPrivacyConsent",CallTranslatorSpokenLanguage:"callTranslatorSpokenLanguage",CallTranslatorTranslationConsent:"callTranslatorTranslationConsent",CallTranslatorTranslationConsentChangeDate:"callTranslatorTranslationConsentChangeDate",CallTranslatorTranslationAutoDetectEnabled:"callTranslatorTranslationAutoDetectEnabled",CallTranslatorTranslationAutoDetectOffered:"callTranslatorTranslationAutoDetectOffered",CallTranslatorTruVoiceConsent:"callTranslatorTruVoiceConsent",CallTranslatorTruVoiceConsentChangeDate:"callTranslatorTruVoiceConsentChangeDate",CallTranslatorTranslationEnabled:"callTranslatorTranslationEnabled",CallTranslatorTruVoiceOffered:"callTranslatorTruVoiceOffered",CaptureFirstRunLevel:"captureFirstRunLevel",CaptureMarkupTooltipDismissed:"captureMarkupTooltipDismissed",CelebrationNotificationLastShownTime:"celebrationNotificationLastShownTime",ChatNotificationsWhileDND:"chatNotificationsWhileDND",ChatServiceRingChangedManually:"dogfoodUserRingForced",CoachMarksSeen:"coachMarksSeen",ContentChannelsFRECompleted:"contentChannelsFRECompleted",DisplayUrlPreviewsEnabled:"displayUrlPreviewsEnabled",E911Acknowledged:"e911Acknowledged",EmergencyCallDefaultCountryChanged:"emergencyCallDefaultCountryChanged",EnableSubtitlesForAllCalls:"enableSubtitlesForAllCalls",OnlyShowSubtitlesForOtherParticipants:"onlyShowSubtitlesForOtherParticipants",IntegrationAuthConsent:"integrationAuthConsent",IntegrationIdAuthStatePairs:"integrationIdAuthStatePairs",InterstitialForLargeGroupRinglessCallsShown:"interstitialForLargeGroupRinglessCallsShown",InterstitialForSmallGroupRinglessCallsShown:"interstitialForSmallGroupRinglessCallsShown",InviteSharingDisabled:"inviteSharingDisabled",IsSetupWizardCompleted:"isSetupWizardCompleted",LastEngagementProcessedMessageOnWebTimestamp:"lastEngagementProcessedMessageOnWebTimestamp",LastTodayTabBadgeShownTimestamp:"lastTodayTabBadgeShownTimestamp",Locale:"locale",MagicBotWelcomeCardSeen:"magicBotWelcomeCardSeen",MagicBotCampaignReceived:"magicBotCampaignReceived",MagicBotConsent:"magicBotConsent",MagicBotConvListUnpin:"magicBotConvListUnpin",MagicBotWaitlistStatus:"magicBotWaitlistStatus",Market:"market",MsaProfile:"msaProfile",MediaEditorFirstRunLevel:"mediaEditorFirstRunLevel",MessageHintsData:"messageHintsData",MiniContextMenuEnabled:"miniContextMenuEnabled",MybotBotConvListUnpin:"myBotConvListUnpin",NotifyOnPresenceChange:"notifyOnPresenceChange",OldFriendBackNotification:"oldFriendBackNotification",OnboardingUserProfileScreenSeen:"onboardingUserProfileScreenSeen",PresentDNDSetting:"presentDNDSetting",PstnTranslationSettings:"pstnTranslationSettings",ReadReceiptsEnabled:"readReceiptsEnabled",Reactions:"customReactions",CustomCallReactions:"customCallReactions",ReactionPushNotificationsEnabled:"reactionPushNotificationsEnabled",ReadReceiptsUserPreference:"readReceipsUserPreference",SendOptionalTelemetry:"sendOptionalTelemetry",ScheduledCallReminders:"scheduledCallReminders",ScheduleNextCallDisplayedTimes:"scheduleNextCallDisplayedTimes",ScheduleNextCallCurrentSuccessfulCalls:"scheduleNextCallCurrentSuccessfulCalls",ScheduledCallBannerDismissStates:"scheduledCallBannerDismissStates",SuggestionsEnabled:"suggestionsEnabled",ShowTodayBadge:"showTodayBadge",Timezone:"timezone",ToneRewriteSuggestionsEnabled:"toneRewriteSuggestionsEnabled",TranslatedConversationBannerDismissStates:"translatedConversationBannerDismissStates",UserAppearancePreferences:"userAppearancePreferences"},t.ServerUserProps={Cid:"cid",CidHex:"cidHex",UserRing:"userRing",SkypeName:"skypeName",UedPushEnabled:"uedPushEnabled"},t.SubscriptionTypes={Loud:"loud",Normal:"normal",Muted:"muted"},t.ConnectorPrefixes={IntegrationNamespace:"integration:"},t.ThreadPropsInConversationView=[t.ThreadProps.LastJoinAt,t.ThreadProps.LastLeaveAt,t.ThreadProps.ThreadDetailsVersion,t.ThreadProps.ThreadType,t.ThreadProps.ConvView_MemberCount,t.ThreadProps.ConvView_MemberListString,t.ThreadProps.LiveState],t.getThreadPropsInConversationView=function(){return n.default.getS4LMessagingFeaturesNoSubscription().enableJoinEnabledThreadPropInConversationView?[...t.ThreadPropsInConversationView,t.ThreadProps.JoinEnabled]:t.ThreadPropsInConversationView},t.skypeIdToMri=function(e){return I(e,T.SkypeId)},t.idAndNamespaceToMri=I,t.sanitizeMri=w,t.replaceNamespace=function(e,t,s){const i=F(e);return i.namespace===t?w(i.id,s):e},t.isMri=P,t.isSkypeId=function(e){return r.ValidSkypeIdRegExp.test(e)},t.asMriMaybe=k,t.asMri=A,t.asSkypeThreadIdMaybe=function(e){const t=k(e);return t&&j(t)?t:void 0},t.asSkypeThreadId=x,t.asSkypeId=R,t.isAllGlobalClearMri=function(e){return e===t.AllGlobalClearMri},t.isUserMri=function(e){return O(B(e))},t.isMriNamespaceUser=O,t.isOneToOneThreadUserMriNamespace=function(e){const t=B(e);return t===T.S4B_Bridge||t===T.PSTN||t===T.SkypeId||t===T.Bot},t.isPhoneMri=L,t.isConversationWithPhoneNumber=function(e){return L(e)},t.isDisplayableStrippedMri=function(e){const t=B(e);return t===T.MSA||t===T.S4B_Bridge||t===T.PSTN||t===T.SkypeId||t===T.OneToOneTextMessage},t.isMriWithUserMetadata=function(e){const t=B(e);return t===T.MSA||t===T.SkypeId||t===T.S4B_Bridge},t.isValidNamespaceMri=function(e){return!!P(e)&&B(e)in T},t.isReadOnlyConversation=function(e){return e===S.default.getEchoMri()},t.isConciergeBotMri=function(e){return-1!==n.default.getEngagementFeaturesNoSubscription().engagementSenderIdentity.indexOf(e)},t.isHiddenBotMri=function(e){return-1!==n.default.getS4LCaapFeaturesNoSubscription().botIdsToHide.indexOf(e)},t.splitMri=F,t.splitSkypeId=function(e){const t=e.indexOf(":");return t>=0?{prefix:e.substring(0,t),suffix:e.substring(t+1)}:{suffix:e}},t.getMriNamespace=B,t.stripMriNamespace=D,t.isOneOnOneConversation=E,t.isBookmarkConversation=V,t.isMyBotConversation=N,t.getMyBotId=U,t.isGroupConversation=function(e){return!E(e)&&!V(e)},t.isThread=j,t.isAgent=H,t.isSearchInConversationSupported=function(e){return z(e)||Q(e)||q(e)},t.isGalleryInConversationSupported=function(e){return z(e)||K(e)||Q(e)||q(e)||N(e)},t.isConnector=function(e){return B(e)===T.Bot&&i.startsWith(D(e),t.ConnectorPrefixes.IntegrationNamespace)},t.isBotChat=function(e){return i.startsWith(e,`${T.Bot}:`)},t.isEcho=function(e){return S.default.getEchoMri()===e},t.isCallLog=function(e){return S.default.getCallLogMri()===e},t.isBlockedPSTNMri=function(e){return S.default.getBlockedPSTNMri()===e},t.isSkypeIdMri=z,t.isMsaMri=function(e){return B(e)===T.MSA},t.isS4BBridgeMri=function(e){return B(e)===T.S4B_Bridge},t.isGuestUserMri=W,t.isOrgIdUserMri=function(e){const s=F(e);return s.namespace===T.SkypeId&&i.startsWith(s.id,t.OrgIdUserPrefix)},t.getSkypeIdFromMri=function(e){if(B(e)===T.SkypeId)return D(e)},t.getPhoneNumberFromMri=function(e){const t=F(e);if(t.namespace===T.PSTN||t.namespace===T.OneToOneTextMessage)return t.id},t.getMriFromPhoneNumber=function(e){return T.PSTN+":"+e.number},t.getMriFromPhoneNumberString=function(e){return T.PSTN+":"+e},t.getMriFromS4BId=function(e){return I(e,T.S4B_Bridge)},t.getConnectorIntegrationIdFromMri=function(e){const t=D(e),s=t.indexOf(":");return t.substring(s+1)},t.getCreatorMriForMessageFromLink=function(e){return i.first(i.last(e.split("/")).split(";"))},t.getConversationLinkWithNewId=function(e,t){const s=e.split("/");return s.pop(),i.join([...s,t],"/")},t.isHighlightsThread=G,t.isBotHighlightsThread=function(e){if(!G(e))return!1;const t=D(e);return!!P(t)&&H(t)},t.isMergingBotHighlightMessageRaw=function(e,s){return H(e)&&-1!==s.content.indexOf(t.BotHighlightMessageContent)},t.isMyHighlightThread=function(e){return!!j(e)&&e===Y(g.default.getSkypeId())},t.isReactionsThread=function(e){return j(e)&&i.endsWith(e,t.ReactionThreadIdSuffix)},t.isSmsMmsThread=function(e){const t=F(e);return t.namespace===T.OneToOneTextMessage||t.namespace===T.GroupTextMessage},t.isEncryptedThread=K,t.isOneToOneThread=q,t.isBrickedOneToOneThread=function(e){return n.default.getS4LMessagingFeaturesNoSubscription().enableBrickingOneToOneThreads&&q(e)},t.isSkypeThread=Q,t.isP2PSkypeThread=X,t.isV2Thread=$,t.isV2OneToOneThread=J,t.getSkypeMriFromBotHighlightsThreadMri=function(e){const s=e.indexOf(t.HighlightsThreadIdSuffix);if(B(e)===T.Thread&&-1!==s&&s===e.length-t.HighlightsThreadIdSuffix.length)return D(e.substring(0,s))},t.getMemberMrisWithoutMe=function(e){return i.filter(e,(e=>!g.default.isMyMri(e)))},t.getHighlightsThreadMriForSkypeId=Y,t.getSkypeIdFromHighlightsThreadMri=function(e){const s=e.indexOf(t.HighlightsThreadIdSuffix);if(B(e)===T.Thread&&-1!==s&&s===e.length-t.HighlightsThreadIdSuffix.length)return D(e.substring(0,s))},t.getReactionThreadIdForCallId=Z,t.getReactionsThreadMriForCallId=function(e){return I(Z(e)+t.ReactionThreadIdSuffix,T.Thread)},t.isComposingStateSupported=function(e,t){if(!t)return!1;const s=B(e);return s===T.SkypeId?e!==S.default.getEchoMri():s===T.Thread||s===T.MSA||s===T.Bot||s===T.S4B_Bridge&&t},t.buildOneOnOneThreadId=function(e){return te(T.Thread,ee(e,g.default.getSkypeMri()),t.OneToOneThreadIdSuffix)},t.buildOneOnOneEncryptedThreadId=function(e){return te(T.Thread,ee(e,g.default.getSkypeMri()),t.EncryptedThreadIdSuffix)},t.updateConsumptionHorizonWithCurrentClientTime=function(e){if(!e)return"0";const t=e.split(";");return t[0]+";"+Date.now()+";"+t[2]},t.getCuidForMessage=function(e){return se(e)},t.getCHIDForMessage=se,t.getConsumptionHorizonForMessage=function(e){return ie(e.id,se(e))},t.getConsumptionHorizonForMessageAndCHID=ie,t.getServerTimestampFromConsumptionHorizon=oe,t.getConsumptionHorizonUpdateTime=function(e){if(!e)return 0;const t=e.split(";")[1];return Number(t)},t.getCuidFromConsumptionHorizon=ne,t.isConsumptionHorizonNewer=re,t.getNewestConsumptionHorizon=function(e,t){return re(e,t)?t:e},t.parseConversationId=ae,t.getParsedConversationId=function(e){if(e.conversationLink){const t=i.last(e.conversationLink.split("/"));if(t){return ae(t)}}};const le=/<[^<>]+>/g;t.unescapeTextWithoutXml=function(e){if(!e)return"";const t=e.replace(le,"");return y.default.unescapeXml(t)},t.parseAvailability=function(e){return"Online"===e?l.UserAvailability.Online:"Offline"===e?l.UserAvailability.Offline:void 0};const de={Offline:l.UserStatus.Offline,Online:l.UserStatus.Online,Busy:l.UserStatus.Busy,Away:l.UserStatus.Away,Idle:l.UserStatus.Idle,OnThePhone:l.UserStatus.OnThePhone,OutToLunch:l.UserStatus.OutToLunch,BeRightBack:l.UserStatus.BeRightBack,Hidden:l.UserStatus.Hidden},ce=i.invert(de);function he(e,t,s,i,o){if(!e)return"";const n=u.getLocalizeParamForGender(s);return e.status===l.UserStatus.Online||i?p.getString(t&&!o?"UserPresence.ActiveCaps":"UserPresence.Active",{gender:n}):e.status===l.UserStatus.Busy?p.getString(t&&!o?"UserPresence.DoNotDisturbCaps":"UserPresence.DoNotDisturb",{gender:n}):e.status===l.UserStatus.Unknown?p.getString("UserPresence.Unknown"):function(e,t,s,i){const o=Date.now().valueOf()-(e.lastSeenAtUtc||0),n=Math.round(o/6e4);if(n<60){const e=i?"UserPresence.LastSeenMinutesAceessibilityLabel":s?"UserPresence.LastSeenMinutesCaps":"UserPresence.LastSeenMinutes";return p.getString(e,{count:Math.max(n,1),gender:t})}const r=Math.round(o/36e5);if(r<24){const e=i?"UserPresence.LastSeenHoursAceessibilityLabel":s?"UserPresence.LastSeenHoursCaps":"UserPresence.LastSeenHours";return p.getString(e,{count:Math.max(r,1),gender:t})}const a=Math.round(o/864e5);if(a<7){const e=i?"UserPresence.LastSeenDaysAceessibilityLabel":s?"UserPresence.LastSeenDaysCaps":"UserPresence.LastSeenDays";return p.getString(e,{count:Math.max(a,1),gender:t})}return p.getString(s?"UserPresence.LastSeenLongTimeCaps":"UserPresence.LastSeenLongTime",{gender:t})}(e,n,t,o)}function ue(e,t){if(!e)return;const s=e.split(";");for(let e=0;e<s.length;e++){const i=s[e].split("=");if(2===i.length&&i[0].trim()===t)return i[1]}}function pe(){if(void 0===_){let e=C.CT_UNKNOWN;e=C.CT_WEB_MESSENGER,_=e.toString()}return _}function ge(e){return t=>{if(!t)return;const s=t.indexOf(e);return-1!==s?t.substring(s+e.length):void 0}}function me(e){return"{"===e[0]?e:"{"+e+"}"}function Se(e){const t=e.selfLink.split("/");return t[i.findIndex(t,(e=>"endpoints"===e))+1]}function fe(e){return e.headers.location}t.parseStatus=function(e){const t=de[e];return i.isNumber(t)?t:void 0},t.encodeStatus=function(e){const t=ce[e];return i.isString(t)?t:void 0},t.getLastSeenPresenceText=he,t.getHoverTitle=function(e,t){if(!e)return;const s=i.isNil(e.mappedStatus)?e.status:e.mappedStatus,o=he(e,!1,t),n=u.getLocalizeParamForGender(t);return s===l.UserStatus.Online?p.getString("UserPresence.Active",{gender:n}):s===l.UserStatus.Busy?p.getString("UserPresence.DoNotDisturb",{gender:n}):s===l.UserStatus.Away?p.getString("UserPresence.Away",{gender:n})+", "+o:s===l.UserStatus.Idle?p.getString("UserPresence.RecentlyActive",{gender:n})+", "+o:void 0},t.decodeSyncState=function(e){const t=e.match(/syncState=([^&]+)/);return t&&t.length>=2?t[1]:void 0},t.encodeSyncStateForLog=function(e){if(void 0===e)return String(e);const t=[];for(let s=0;s<e.length;s+=64)t.push(e.substring(s,s+64));return t.join("-")},t.encodeEndpointInfoForLog=function(e){const t=i.pick(e,["id","exists","featureFlags","presenceDocPublished","ecsEtag","reason","tcid","restEndpointUrl"]);return JSON.stringify(t)},t.filterMembersProp=function(e){return i.map(e,(e=>({id:e.id,role:e.role})))},t.getEndpointIdFromRegToken=function(e){return ue(e,"endpointId")},t.getExpiresFromRegToken=function(e){const t=ue(e,"expires");return t?Number(t):void 0},t.getEndpointFeaturesList=function(){const e=["Agent","Presence2015","MessageProperties","CustomUserProperties","Casts","ModernBots","AutoIdleForWebApi","secureThreads","notificationStream"];n.default.getS4LContactsFeatures().enableInviteFree&&e.push("InviteFree"),n.default.getS4LMessagingFeaturesNoSubscription().enableReadReceipts&&e.push("SupportsReadReceipts");const t=n.default.getS4LMessagingFeaturesNoSubscription().ued;return t&&t.enabled&&e.push("ued"),e.join(",")},t.buildEndpointPresenceDocData=function(e){return{id:"messagingService",privateInfo:{epname:S.default.getDeviceName()},publicInfo:{capabilities:e.join("|"),typ:pe(),skypeNameVersion:S.default.getClientVersionAndPlatform()+"/SkypeX",nodeInfo:"xx",version:"15"}}},t.areEndpointPresenceDocsEqual=function(e,t){return!e&&!t||!(!e||!t)&&(e.id===t.id&&(!!(0,h.default)(e.publicInfo,t.publicInfo)&&e.privateInfo.epname===t.privateInfo.epname))},t.getClientInfoString=function(){const e="skype4life",t=S.default.getClientVersionAndPlatform()+"//"+e,s=S.default.getPlatformType()===c.PlatformType.iOS||S.default.getPlatformType()===c.PlatformType.Android?2:1,i=n.default.getHeaders().CountryCode||"Unknown",r=o.default.getDefaultId();let a="os="+S.default.getPlatformTypeName()+"; osVer="+S.default.getOSVersion()+"; proc=x86; lcid="+p.getLocale()+"; deviceType="+s+"; country="+i+"; clientName="+e+"; clientVer="+t;return r&&(a+="; timezone="+r),a},t.getClientCapabilities=function(){const{enableParsingHtmlMessages:e}=n.default.getS4LMessagingFeaturesNoSubscription();return e?"RenderHtml":void 0},t.SKYPE_TOKEN_HEADER_PREFIX="skypetoken=",t.REGISTRATION_TOKEN_HEADER_PREFIX="registrationToken=",t.getSkypetokenFromAuthenticationHeader=ge(t.SKYPE_TOKEN_HEADER_PREFIX),t.getRegistrationTokenFromHeader=ge(t.REGISTRATION_TOKEN_HEADER_PREFIX),t.ChannelTypes={PushNotification:"PushNotification",HttpLongPoll:"HttpLongPoll"},t.createPushSubscriptionParams=function(e,s,i){return{channelType:t.ChannelTypes.PushNotification,eventServiceName:"pnh",template:e,eventChannel:s,interestedResources:i,conversationType:l.DefaultConversationType}},t.createLongPollSubscriptionParams=function(e){return{channelType:t.ChannelTypes.HttpLongPoll,interestedResources:e,conversationType:l.DefaultConversationType}},t.findPushSubscriptionInfo=function(e){const s=i.find(e,(e=>e.channelType.toLowerCase()===t.ChannelTypes.PushNotification.toLowerCase()));return{pushSubscriptionId:s?s.id.toString():void 0,pushSubscriptionParams:s?{channelType:s.channelType,eventChannel:s.eventChannel,eventServiceName:s.eventServiceName,interestedResources:s.interestedResources,template:s.template}:void 0}},t.getEpidFromUri=function(e){const t=e.split("{");if(t.length>1){const e=t[1].split("}");if(e.length>1)return e[0]}},t.isDogfoodCloudUrl=function(e){const t=f.default.getURIComponents(e);return!(!t||!t.host)&&t.host.indexOf("df-")>=0},t.getThreadSuffix=function(e){if(j(e)){const t=i.split(e,";")[0],s=t.indexOf("@");return-1===s?"NoThreadSuffix":t.substring(s+1)}},t.getMriTypeForTelemetry=function(e){if(j(e)){const t=i.split(e,";")[0],s=t.indexOf("@");return-1===s?"UnknownThread":t.substring(s+1)}{const t=B(e);return t in T?T[t]:"UnknownMri"}},t.areEndpointIdsEqual=function(e,t){return void 0===e||void 0===t?e===t:me(e)===me(t)},t.formatEndpointId=me,t.formatEndpointIdRemoveBrackets=function(e){return e&&i.trim(e,"{}")},t.getEndpointIdFromPresenceDoc=Se,t.getTextualEndpointInfo=function(e,t=!1){let s=me(Se(e));t&&(s=s.substring(1,6));const o=e.publicInfo.skypeNameVersion.split("/"),n=Number(o[0]),r=n?i.findKey(m.platformId,(e=>e===n)):o.length>=3?o[2]:"undefined";return s+" ("+e.publicInfo.skypeNameVersion?r+": "+e.publicInfo.skypeNameVersion:e.privateInfo.epname+")"},t.isValidPresenceMri=function(e){return B(e)===T.MSA||B(e)===T.S4B_Bridge?r.ValidPresenceResourceRegExp.test(e):P(e)},t.getTcidDataFromServerMessageResponse=function(e){return{contextId:e.headers.contextid,date:e.headers.date}},t.getConnectionTypeFromUrl=function(e){return/.*[/\.]messenger\..*/.test(e)?c.ChatServiceConnectionType.ChatServiceV1:/.*[/\.]msgapi\..*/.test(e)?c.ChatServiceConnectionType.MessagingApi:c.ChatServiceConnectionType.Unknown},t.getEnvironmentNameFromUrl=function(e){return e?/.*[/\.]msgapi\.int\..*/.test(e)?"int":/.*[/\.]canary\.msgapi\..*/.test(e)?"canary":/.*[/\.]pilot1\.msgapi\..*/.test(e)?"pilot1":/.*[/\.]pilot2\.msgapi\..*/.test(e)?"pilot2":/.*[/]msgapi\..*/.test(e)?"prod":"unknown":"none"},t.isRedirect=function(e){return 404===e.statusCode&&fe(e)},t.isEndpointMissing=function(e){return 404===e.statusCode&&e.errorCode===b.EndpointMissing},t.getRedirectUrl=fe,t.isNotFound=function(e){return 404===e.statusCode&&!fe(e)},t.calculateEndpointUrl=function(e){return(e.protocol||"https")+"://"+function(e){if(e&&e.length>0&&"/"!==e.charAt(e.length-1))return e+"/";return e}(e.host)+(e.path||"")},t.isMessageFromOrigin=function(e,t){return i.some(e.details,(e=>e.origin===t))},t.getProperty=function(e,t,s){var i;if(!t)return;return n.default.getS4LMessagingFeaturesNoSubscription().enableV2PropMapping&&null!==(i=t[s.mapToV2(e)])&&void 0!==i?i:t[e]},t.filterSkypeIdMris=function(e){return e.filter((e=>z(e)&&!W(e)))}},465848:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateUnreadMessageCounts=t.calculateCountsForConversation=t.MaxUnreadMessageCount=t.BlankCounts=void 0;const i=s(174958),o=s(496486),n=s(873713),r=s(397691),a=s(671830),l=s(562141),d=s(924339),c=s(440276),h=s(746096),u=s(172711),p=s(436237),g=s(914976);t.BlankCounts={convHashUsedForCalc:void 0,consumptionHorizonTimestamp:0,unreadCount:0,unreadCountOverflowed:!1,highPriorityUnreadCount:0,hasUnread:0,lastHighlightMessage:void 0,numMessagesSentByUser:0};const m=2592e6,S=100;function f(e,s,i){const o=e.conv;if(!o.lastMessage&&!e.counts)return r.Resolved({counts:void 0,earlyExit:!0,msg:"Skipping due to no lastMessage"});const n=function(e){let t=e.conv.convViewVersion.toString()+";"+(e.conv.lastMessage?e.conv.lastMessage.createdTime.toString():"0")+";"+e.conv.getConsumptionHorizon()+";"+e.conv.getConversationProperty(a.ConversationProps.Alerts)+";"+e.conv.getConversationProperty(a.ConversationProps.Subscription)+";"+e.conv.getConversationProperty(a.ConversationProps.ConversationBlocked)+";"+e.conv.getConversationProperty(a.ConversationProps.ConversationStatus)+";"+(e.conv.isCurrentUserMember()?"1":"0");e.conv.isThread()&&(t+=";"+e.conv.getThreadProperty(a.ThreadProps.LastJoinAt)+";"+e.conv.getThreadProperty(a.ThreadProps.LastLeaveAt));e.syncInfo&&e.syncInfo.messageHistoryStartTime&&(t+=";"+e.syncInfo.messageHistoryStartTime.toString());e.conv.isHighlightsThread()&&(t+=";H1");e.conv.isMuted()&&(t+=";M2");const s=c.computeSHA256(t);return c.byteArrayToBase64String(s)}(e);if(!s&&e.counts&&e.counts.convHashUsedForCalc===n)return r.Resolved({counts:e.counts,earlyExit:!0,msg:"Skipping due to matching cache"});const l=d.isConversationDisplayable(o),h=l||o.isHighlightsThread(),p=l,g=o.getConsumptionHorizon();let m=a.getServerTimestampFromConsumptionHorizon(g);if(!l&&!o.isHighlightsThread()||o.isArchived()||o.isHighlightsThread()&&!o.isBotHighlightsThread()&&!o.isCurrentUserMember())return r.Resolved({counts:t.BlankCounts,earlyExit:!0,msg:"Skipping due to not caring about it"});const S=Date.now();let f;const C=a.getCuidFromConsumptionHorizon(g);return f=C?i.getMessageByCuid(o.id,C).then((e=>{e&&e.createdTime>m&&(m=e.createdTime)})):r.Resolved(),f.then((()=>{if(o.isHighlightsThread()&&!a.isMyHighlightThread(o.id)){const e=u.getHighlightTimeWindow();m<e&&(m=e)}const e=t.MaxUnreadMessageCount+1;return r.all([h?i.getCountOfMessagesForConversationAfterTimeNormalPri(o.id,m,e):0,p?i.getCountOfMessagesForConversationAfterTimeHighPri(o.id,m):0,l?y(i,o):0,o.isHighlightsThread()?v(i,o,m):void 0])})).then((([e,s,i,r])=>{const a=e+s,l="Recalculated ("+(Date.now()-S)+"ms): Unread: "+a+", HiPri: "+s+", MyMessages: "+i+(o.isHighlightsThread()?", lastHighlightMessage: "+(r?r.cuid:0):""),d=a>0&&h&&!o.isMuted();return{counts:{convHashUsedForCalc:n,consumptionHorizonTimestamp:m,unreadCount:Math.min(a,t.MaxUnreadMessageCount),unreadCountOverflowed:a>t.MaxUnreadMessageCount,highPriorityUnreadCount:s,lastHighlightMessage:r,hasUnread:d?1:0,numMessagesSentByUser:i},earlyExit:!1,msg:l}}))}function y(e,t){return t?e.getCountOfMessagesForConversationISentSinceTime(t.id,Date.now()-m):r.Rejected("Conversation null in getCountOfSentMessages")}function v(e,t,s){return e.getMessagesForConversationBeforeTime(t.id,Number.MAX_VALUE,S,!1).then((e=>{let i;return a.isMyHighlightThread(t.id)?i=o.find(e,(e=>e.isHighlightMessage()&&!e.isDeletedMessage())):o.each(e,(e=>{e.isHighlightMessage()&&!e.isDeletedMessage()&&(!i||e.createdTime>s)&&(i=e)})),i}))}t.MaxUnreadMessageCount=99,t.calculateCountsForConversation=f,t.validateUnreadMessageCounts=function(e){const t=o.keyBy(e,(e=>e.conv.id)),s=o.filter(o.keys(t),(e=>!!t[e]));return p.log(h.LogTraceArea.ConversationCalculations,"validateUnreadMessageCounts start"),l.default.openTransaction([l.Stores.Messages],!1).then((l=>r.all(o.map(s,(e=>f(t[e],!0,l)))).then((r=>{let l=0,d=0,c=!0;return o.each(s,((s,o)=>{const n=t[s].counts,u=r[o].counts;u&&(n&&function(e,t){if(!e)return!0;if(!t)return!1;if(e.unreadCount!==t.unreadCount||e.highPriorityUnreadCount!==t.highPriorityUnreadCount||e.hasUnread!==t.hasUnread)return!1;if(void 0!==e.unreadCountOverflowed&&void 0!==t.unreadCountOverflowed&&e.unreadCountOverflowed!==t.unreadCountOverflowed)return!1;return!0}(n,u)?(u.hasUnread&&p.log(h.LogTraceArea.ConversationCalculations,"Unread count for "+g.mriOrId(s)+" is "+u.unreadCount+" based on convHash "+u.convHashUsedForCalc),1===e.length&&p.log(h.LogTraceArea.ConversationCalculations,"  Current conversation "+i.pii.Omit(JSON.stringify(t[s])))):(p.log(h.LogTraceArea.ConversationCalculations,"Found inconsistent unread message counts for conversation "+g.mriOrId(s)),p.log(h.LogTraceArea.ConversationCalculations,"  Saved "+JSON.stringify(n)),p.log(h.LogTraceArea.ConversationCalculations,"  Computed "+JSON.stringify(u)),p.log(h.LogTraceArea.ConversationCalculations,"  Conversation "+i.pii.Omit(JSON.stringify(t[s]))),c=!1),a.isHighlightsThread(s)||(n&&n.hasUnread&&l++,u.hasUnread&&d++))})),l!==d&&(p.log(h.LogTraceArea.ConversationCalculations,"Found inconsistent unread conversation count. Was "+l+" but should be "+d),c=!1),n.default.getCount().then((e=>(l!==e&&(p.log(h.LogTraceArea.ConversationCalculations,"Found inconsistent home screen badge count. Old was "+l+" but actual badge count was "+e),c=!1),d!==e&&(p.log(h.LogTraceArea.ConversationCalculations,"Found inconsistent home screen badge count. New was "+d+" but actual should be "+e),c=!1),c&&p.log(h.LogTraceArea.ConversationCalculations,"Message counts appear to be consistent"),c)))})).fail((()=>{p.log(h.LogTraceArea.ConversationCalculations,"validateUnreadMessageCounts failed")}))))}},913991:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getQuoteContentNodeRenderDimensions=t.getContactNodeRenderDimensions=t.ContactNodeSizes=t.contactNodeHeight=t.getUrlPreviewNodeRenderDimensions=t.UrlPreviewNodeSizes=t.getAudioNodeRenderDimensions=t.getFileNodeRenderDimensions=t.FileNodeSizes=t.fileNodeWidthSmall=t.fileNodeWidth=t.getScaledThumbnailDimensions=t.prepareSwiftCardNodeDimensionsFunction=t.prepareMediaNodeDimensionsFunction=t.availableSpaceUtilization=t.ThumbnailMinHeight=t.ThumbnailMinWidth=t.CompositeGalleryThumbnailWidth=t.CompositeGalleryThumbnailHeight=t.UndefinedDimensions=void 0;const i=s(35566),o=s(770891),n=s(312762);t.UndefinedDimensions={width:void 0,height:void 0};t.CompositeGalleryThumbnailHeight=200,t.CompositeGalleryThumbnailWidth=300;const r={height:t.CompositeGalleryThumbnailHeight,width:t.CompositeGalleryThumbnailWidth},a=300,l=300;function d(e,s){const{width:o,height:n}=e;if(!o||!n)return t.UndefinedDimensions;const r=!s||void 0===s.width||s.width*t.availableSpaceUtilization>a?a:s.width*t.availableSpaceUtilization,d=!s||void 0===s.height||s.height>l?l:s.height,c=i.default.fitToContainer({width:o,height:n},{width:r,height:d});return c.width<t.ThumbnailMinWidth&&(c.width=t.ThumbnailMinWidth),c.height<t.ThumbnailMinHeight&&(c.height=t.ThumbnailMinHeight),c}t.ThumbnailMinWidth=60,t.ThumbnailMinHeight=60,t.availableSpaceUtilization=.55,t.prepareMediaNodeDimensionsFunction=function(e){if(e.renderOrigin===o.MessageRenderOrigin.CompositeGalleryCanvas)return()=>r;const s=e.decodedNode.getFirstUriObjectChild(n.PictureNode),i=s&&s.getOriginalDimensions();let a;return a=void 0===i||void 0===i.width||void 0===i.height?{width:t.CompositeGalleryThumbnailWidth,height:t.CompositeGalleryThumbnailHeight}:{width:i.width,height:i.height},(e,t)=>d(a,e)},t.prepareSwiftCardNodeDimensionsFunction=function(e,s){let i;return i=void 0===e||void 0===e.width||void 0===e.height?{width:t.CompositeGalleryThumbnailWidth,height:t.CompositeGalleryThumbnailHeight}:{width:e.width,height:e.height},d(i,s)},t.getScaledThumbnailDimensions=d,t.fileNodeWidth=245,t.fileNodeWidthSmall=200,t.FileNodeSizes={Regular:{width:t.fileNodeWidth,height:void 0},Small:{width:t.fileNodeWidthSmall,height:void 0},Gallery:{width:void 0,height:void 0}};t.getFileNodeRenderDimensions=(e,s)=>{if(s===o.MessageRenderOrigin.CompositeGalleryCanvas||s===o.MessageRenderOrigin.StackGalleryCanvas)return t.FileNodeSizes.Gallery;let i=t.FileNodeSizes.Regular;return e&&e.width&&e.width<400&&(i=t.FileNodeSizes.Small),i},t.getAudioNodeRenderDimensions=t.getFileNodeRenderDimensions;t.UrlPreviewNodeSizes={Regular:{width:300,height:150},Small:{width:200,height:125},Gallery:{width:void 0,height:150}};t.getUrlPreviewNodeRenderDimensions=(e,s)=>{if(s===o.MessageRenderOrigin.CompositeGalleryCanvas||s===o.MessageRenderOrigin.StackGalleryCanvas)return t.UrlPreviewNodeSizes.Gallery;let i=t.UrlPreviewNodeSizes.Regular;return e&&e.width&&e.width<500&&(i=t.UrlPreviewNodeSizes.Small),i};t.contactNodeHeight=175,t.ContactNodeSizes={Regular:{width:214,height:t.contactNodeHeight},Small:{width:200,height:t.contactNodeHeight},Gallery:{width:void 0,height:150}};t.getContactNodeRenderDimensions=(e,s)=>e&&e.width&&e.width<400?t.ContactNodeSizes.Small:t.ContactNodeSizes.Regular;t.getQuoteContentNodeRenderDimensions=()=>c;const c={width:150,height:100}},236974:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(195121),n=s(775463),r=s(732183),a=s(526424),l=s(415963),d=s(794050);class c{constructor(e){this._lastResultType=void 0,this._scenario=new d.default(l.ScenarioName.EmoticonRendering),this._requestedIconData={requestedIconId:e.id,requestedIconSize:e.size,requestedIconType:a.EmoticonType[e.type],requestedIconCacheStatus:"not_checked"}}initialize(e){this._stepsSeq=o.default.isImageCached(e).then((e=>{this._requestedIconData.requestedIconCacheStatus=String(e)})).catch((()=>{this._requestedIconData.requestedIconCacheStatus="cache_error"}))}_isResultFinal(e){return!!e&&e.type===a.ResultIconType.Final}_getResultType(e){return e?a.ResultIconType[e.type]:"Placeholder"}queueSendingTelemetry(e){const t=this._scenario.getCurrentDuration(),s=this._lastResultType;this._stepsSeq=this._stepsSeq.then((()=>e?o.default.isImageCached((0,r.getUrl)(e.icon)).then((i=>{this._sendTelemetry(e,s,String(i),t)})).catch((()=>{this._sendTelemetry(e,s,"cache_error",t)})):this._sendTelemetry(e,s,"",t))),this._lastResultType=this._getResultType(e)}_sendTelemetry(e,t,s,o){if(this._scenario.isResolved())return;const n=Object.assign(Object.assign({},this._requestedIconData),{resultType:this._getResultType(e),prevResultType:String(t)});e&&i.assign(n,{resultIconId:e.icon.id,resultIconSize:e.icon.size,resultIconType:a.EmoticonType[e.icon.type],resultIconCacheStatus:s}),this._scenario.hasStarted()?this._isResultFinal(e)?this._scenario.finish(n,o):this._scenario.markStepCompleted("intermediateStep",n,o):(this._scenario.setDuplicateStepMarkingEnabled(!0),this._scenario.start(n))}finishScenario(){this._stepsSeq=this._stepsSeq.then((()=>{this._scenario.isResolved()||this._scenario.finish()}))}}t.default=class{constructor(e,t){this._sampleRate=e,this._getEmoticonInfo=t}_initTelemetry(){if(this._sampleRate>0&&0===Math.floor(this._sampleRate*n.getRandomValues(new Array(1))[0]/256)){const e=this._getEmoticonInfo();e?(this._collectTelemetry=!0,this._impl=new c(e),this._impl.initialize((0,r.getUrl)(e))):this._collectTelemetry=!1}else this._collectTelemetry=!1}finishAndResetTelemetry(){this._impl&&this._impl.finishScenario(),this._impl=void 0,this._collectTelemetry=void 0}updateTelemetry(e){void 0===this._collectTelemetry&&this._initTelemetry(),this._impl&&this._impl.queueSendingTelemetry(e)}}},639024:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getEmoticonAccessibilityLabel=t.getEmoticonInfoAccessibilityLabel=void 0;const i=s(496486),o=s(733754),n=s(526424);function r(e,t){if(i.includes(n.DiverseToneSuffixes,t)&&t!==n.DefaultDiverseTone){const s="AccessibilityLabel.EmoticonTone"+t;return o.getStringUnsafe(s,{emoticonName:e})}return e}t.getEmoticonInfoAccessibilityLabel=function(e){if(e.description)return r(e.description,e.tone)},t.getEmoticonAccessibilityLabel=r},732183:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBaseUrl=t.setBaseUrl=t.getDefaultEmoticonSize=t.getEmoticonUrl=t.parseUrl=t.getUrl=t.getSanitizedEmoticonName=t.getEmoticonTone=void 0;const i=s(889391),o=s(395868),n=s(526424),r=s(758962),a=s(29130),l=s(626712);let d=i.default.getConfigSettingsNoSubscription().pes.emoticonBaseUrl;function c(e){const t=e.length;if(t>4&&e[t-3]===n.DiverseToneSeparator){const s=o.default.getItemToneFromString(e[t-2]);if(void 0!==s&&n.DiverseToneSuffixes.indexOf(s)>-1)return s}}function h(e){const t=d+"/",s=e.type===n.EmoticonType.Animated?r.EmoticonUrl.animSuffix:"",i=r.EmoticonUrl.flatSuffix,o=e.tone&&1!==e.tone?r.EmoticonUrl.diverseSuffix+e.tone:"",a=`${r.EmoticonUrl.profilePrefix}${e.size}${s}${i}${o}`;return`${t}${encodeURIComponent(e.id)}/views/${a}?etag=${e.etag?e.etag:"v1"}`}t.getEmoticonTone=c,t.getSanitizedEmoticonName=function(e){const t=c(e);return t?e.replace(n.DiverseToneSeparator+t+")",")"):e},t.getUrl=h,t.parseUrl=function(e){if(!l.default.isUrlValid(e))return;const t=e.split("/");if(9!==t.length)return;const s=decodeURIComponent(t[t.length-3]),i=t[t.length-1].split("?")[0].split("_"),o=Number(i[1]);let a;const d=e=>{const t=e.substring(r.EmoticonUrl.diverseSuffix.length-1);return Number(t)};let c;if(3===i.length)c=!1;else if(5===i.length){if("_"+i[2]!==r.EmoticonUrl.animSuffix)return;c=!0,a=d(i[4])}else{if(4!==i.length)return;if("_"+i[2]===r.EmoticonUrl.flatSuffix)a=d(i[3]);else{if("_"+i[2]!==r.EmoticonUrl.animSuffix)return;c=!0}}const h=l.default.getURIComponents(e);if(!h)return;const u=h.queryParameterKeyValues,p="etag";if(!u||!(p in u))return;const g=u[p];return{id:s,size:o,type:c?n.EmoticonType.Animated:n.EmoticonType.Static,etag:g,tone:a}},t.getEmoticonUrl=function(e,t,s,i,o){return h({id:e,size:(0,r.getPixelSize)(t),type:s?n.EmoticonType.Static:n.EmoticonType.Animated,etag:o,tone:i})},t.getDefaultEmoticonSize=function(e){return a.default.isMobileScreenSize(e)?n.EmoticonSize.Large:n.EmoticonSize.Small},t.setBaseUrl=function(e){d=e},t.getBaseUrl=function(){return d}},319596:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.forwardMessages=void 0;const i=s(496486),o=s(764097),n=s(351077),r=s(746096),a=s(436237),l=s(733754),d=s(795691),c=s(5899),h=s(932293),u=s(478262),p=s(853374);function g(e,t,s,i,o,n){const r=c.default.getShareParametersForMedia(e,t,s,o,n);r&&i.push(r)}t.forwardMessages=function(e,t,s,m,S,f){const y=1===e.length,v=[];let C;const _=p.default.newCauseId();let b,T=!0;const M=i.filter(e,(e=>!e.forwardAlbumId||e.message.isAlbum())).length;let I=l.getString("StreamItem.ForwardMessagesHeader",{count:M});if(e&&e.length>0&&(i.each(e,((e,i)=>{switch(C=(0,n.getMessageTypeGroup)(e.message),C){case n.MessageTypeGroups.MediaAlbum:e.forwardAlbumId&&v.push(c.default.getShareParametersForAlbumMsg(e.message,t,e.forwardAlbumId));break;case n.MessageTypeGroups.Location:y&&(I=l.getString("StreamItem.ForwardLocationMessageHeader")),v.push(c.default.getShareParametesForLocation(e.message,t)),b=d.SharePreviewType.Location;break;case n.MessageTypeGroups.Picture:g(e.message,t,y,v,S.rootViewId,e.forwardAlbumId),b=d.SharePreviewType.Photo;break;case n.MessageTypeGroups.Video:g(e.message,t,y,v,S.rootViewId,e.forwardAlbumId),b=d.SharePreviewType.Video;break;case n.MessageTypeGroups.Audio:g(e.message,t,y,v,S.rootViewId),b=v[i].fileType===u.UploadFileType.AudioMessage?d.SharePreviewType.AudioMessage:d.SharePreviewType.Audio;break;case n.MessageTypeGroups.UriFile:g(e.message,t,y,v,S.rootViewId),b=d.SharePreviewType.File;break;case n.MessageTypeGroups.SwiftCard:let r;if(b=d.SharePreviewType.SwiftCards,!h.default.isNodeTextMessage(e.node)){let i;o.default.isAdaptiveCard(e.node)?(i=c.default.getShareParametersForAdaptiveMessage(e.message,e.node,s),r=o.default.isAdaptiveCardCarousel(e.node)):(i=c.default.getShareParametersForSwiftMessage(e.message,e.node,t,s,_,y),r=h.default.isSwiftCarousel(e.node)),i&&v.push(i)}y&&r&&(I=l.getString("SwiftCard.ShareCards"));break;case n.MessageTypeGroups.Contact:y&&(I=l.getString("StreamItem.ForwardMessageContact"));const a=c.default.getShareParametesForContactMessage(e.message,t);if(!a)return;T=!1,v.push(a),b=d.SharePreviewType.Contact;break;case n.MessageTypeGroups.Text:v.push(c.default.getShareParametersForText(e.message,e.node,t)),b=d.SharePreviewType.Text}})),y||(b=d.SharePreviewType.MultipleMessages)),y&&C?a.log(r.LogTraceArea.GenericUnsafe,`ShareMessageUtils.forwardMultipleMessages for single message of\n                message type , ${n.MessageTypeGroups[C]} causeId: ${_}`):a.log(r.LogTraceArea.GenericUnsafe,`ShareMessageUtils.forwardMultipleMessages for multiple messages\n              causeId: ${_}`),0===v.length)return void(m&&m());const w="_streamItemMultipleMessages"===t?r.SharePanelEntryOrigin.MultiSelect:r.SharePanelEntryOrigin.MessageActionMenu;return c.default.shareMultipleMessages(v,I,_,w,m,S,b,T,f)}},172711:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getHighlightTimeWindow=void 0;t.getHighlightTimeWindow=function(){return Date.now()-6048e5}},750066:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlSanitizer=void 0;const i=s(496486),o=s(391036),n=s(17213);class r{constructor(){this._defaultAllowedTags=[],this._defaultAllowedAttributes=[],this._addTags=[],this._addAttributes=[],this._allowedSrcProtocols=["data","cid","blob","http","https","ftp","ftps"],this._allowedHrefProtocols=["http","https","mailto","onenote","tel","ftp","ftps"],this._transformATag=(e,t={})=>(t.href&&(t.href=this.sanitizeHrefUrl(t.href),t.title=this._getIdnSafeTitle(t.href)),{tagName:e,attribs:t=this._addTargetAndRelAttributes(t)}),this._transformAllTags=(e,t)=>(t&&t.style&&(t.style=this._sanitizeStyle(t.style)),{tagName:e,attribs:t}),this._semanticObjectSchemas=i.values(n.SemanticObjectSchemas),this._initCustomData(),this._sanitizeHtmlConfig=this._buildSanitizeHtmlConfig()}sanitizeHtml(e){return e?o(e,this._sanitizeHtmlConfig):e}sanitizeHrefUrl(e,t=!1){return function(e,t){if(!e)return"";if(e.startsWith("/"))return e;const s=e.indexOf(":");if(s<=0)return"";e=e.replace(/(\')/g,"%27"),e=e.replace(/(\")/g,"%22");const i=e.substring(0,s).toLowerCase();for(const s of t)if(i===s)return e;if("http"===i)return`https${e.substring(s)}`;return""}(e,t?["mailto"]:this._allowedHrefProtocols)}_addTargetAndRelAttributes(e){return i.find(this._semanticObjectSchemas,(t=>t===e[n.Attributes.itemtype]))||(e.target="_blank",e.rel="noreferrer noopener"),e}_getIdnSafeTitle(e){let t=e;if(!e||e.startsWith("/"))return t;const s=function(e,t,s,i){try{return t(new URL(s,i))}catch(t){return e}}(void 0,(e=>e),e);return s&&s.hostname&&(s.hostname.startsWith("xn--")||s.hostname.indexOf(".xn--"))&&(t=s.href),t.toLowerCase()}_stripComments(e){let t="code";return i.reduce(e.split(""),((e,s,i,o)=>{switch(t){case"code":return"/"===s&&"*"===o[i+1]?(t="comment",e):`${e}${s}`;case"comment":return"/"===s&&"*"===o[i-1]&&(t="code"),e}}),"")}_sanitizeStyle(e){let t=e.replace(/(url|attr)\([^)]*\)?/gi,";");t=t.replace(/position\s*:\s*(\\66|f)\s*(\\69|i)\s*(\\78|x)\s*(\\65|e)\s*(\\64|d)\s*/gi,"position:absolute");const s=this._stripComments(t).split(";").filter((e=>{const t=e.split(":");return-1!==n.AllowedStyles.indexOf(t[0].trim())}));return i.join(s,";")}_initCustomData(){this._defaultAllowedTags=n.AllowedHtmlElements,this._defaultAllowedAttributes=n.AllowedHtmlAttributes,this._addTags=["URIObject","Title","Swift","Description","ended","partlist","part","name","duration","OriginalName","Identifiers","Id","RecordingContent","item","RecordingStatus","AddCustomApp","DeleteCustomApp","UpgradeCustomAppV2","eventtime","initiator","target","targetName","DeprecatedTargetName","UpdateFavDefault","isDefault"],this._addAttributes=[n.IgnoreSemanticLinkAttr,"url_thumbnail","b64","identity","uri","v"]}_buildSanitizeHtmlConfig(){return{allowedTags:this._defaultAllowedTags.concat(this._addTags),allowedAttributes:{"*":this._defaultAllowedAttributes.concat(this._addAttributes)},allowedSchemes:this._allowedHrefProtocols,allowedSchemesByTag:{img:this._allowedSrcProtocols},parser:{lowerCaseTags:!1},nonTextTags:["style","script","textarea","ts-hint"],transformTags:{a:this._transformATag,"*":this._transformAllTags}}}}t.HtmlSanitizer=r,t.default=new r},17213:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AllowedStyles=t.AllowedHtmlAttributes=t.AllowedHtmlElements=t.Attributes=t.IgnoreSemanticLinkAttr=t.SemanticObjectSchemas=void 0,function(e){e.mention="http://schema.skype.com/Mention",e.inputExtension="http://schema.skype.com/InputExtension",e.amsVideo="http://schema.skype.com/AMSVideo",e.amsImage="http://schema.skype.com/AMSImage",e.emoji="http://schema.skype.com/Emoji",e.live="http://schema.skype.com/Live"}(t.SemanticObjectSchemas||(t.SemanticObjectSchemas={})),t.IgnoreSemanticLinkAttr="data-ignore-semantic-link",function(e){e.color="color",e.bgColor="background-color",e.itemProps="data-itemprops",e.itemtype="itemtype",e.mentionId="data-mention-id",e.height="height",e.itemid="itemid",e.itemscope="itemscope",e.src="src",e.style="style",e.width="width"}(t.Attributes||(t.Attributes={}));t.AllowedHtmlElements=["a","abbr","acronym","address","area","article","aside","b","bdi","bdo","big","blockquote","br","caption","center","cite","code","col","colgroup","dd","del","dfn","dir","div","dl","dt","em","figcaption","figure","font","footer","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","img","img","ins","kbd","label","li","map","map","mark","menu","nav","ol","p","pre","q","rp","rp","rt","rt","ruby","s","samp","section","small","span","strike","strong","sub","sup","table","tbody","td","tfoot","th","thead","time","tr","tt","u","ul","var","wbr","mention","semantic-object"];t.AllowedHtmlAttributes=["abbr","align","alt","axis","bgcolor","border","cellpadding","cellspacing","class","clear","color","cols","colspan","compact","content","contenteditable","coords","data-ams-src","data-itemprops","data-preview-src","data-src","data-ts-imgid","data-ts-imglen","dir","face","headers","height","href","hreflang","hspace","ismap","itemid","itemprop","itemscope","itemtype","lang","language","nohref","nowrap","rel","rev","rows","rowspan","rules","scope","scrolling","shape","size","span","src","start","style","summary","target","title","type","usemap","valign","value","vspace","width","mri","type","originalsrc"],t.AllowedStyles=["@font-face","@font-feature-values","@keyframes","align-content","align-items","align-self","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","animation","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","background","border-bottom-color","border-bottom-left","border-bottom-right","border-bottom-style","border-bottom-width","border-bottom","border-collapse","border-color","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-image","border-left-color","border-left-style","border-left-width","border-left","border-radius","border-right-color","border-right-style","border-right-width","border-right","border-spacing","border-style","border-top-color","border-top-left","border-top-right","border-top-style","border-top-width","border-top","border-width","border","bottom","box-decoration-break","box-shadow","break-after","break-before","break-inside","caption-side","clear","clip","color","column-count","column-fill","column-gap","column-rule-color","column-rule-style","column-rule-width","column-rule","column-span","column-width","columns","counter-increment","counter-reset","direction","display","empty-cells","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","flex","float","font-family","font-feature-settings","font-kerning","font-language-override","font-size-adjust","font-size","font-stretch","font-style","font-synthesis","font-variant-alternates","font-variant-caps","font-variant-east","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variant","font-weight","font","hanging-punctuation","height","hyphens","image-orientation","image-rendering","image-resolution","justify-content","left","letter-spacing","line-break","line-height","list-style-image","list-style-position","list-style-type","list-style","margin-bottom","margin-left","margin-right","margin-top","margin","marquee-direction","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","object-fit","object-position","opacity","order","overflow-wrap","overflow-x","overflow-y","overflow","padding-bottom","padding-left","padding-right","padding-top","padding","position","right","tab-size","table-layout","text-align-last","text-align","text-combine-upright","text-combine-upright","text-decoration-color","text-decoration-line","text-decoration-style","text-decoration","text-indent","text-justify","text-orientation","text-shadow","text-transform","text-underline-position","top","unicode-bidi","user-select","vertical-align","visibility","white-space","widows","width","word-break","word-spacing","word-wrap","writing-mode"]},786994:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.copyAllowed=void 0;const i=s(496486),o=s(351077),n=[o.MessageTypes.Text,o.MessageTypes.RichText,o.MessageTypes.UriObject,o.MessageTypes.Sms,o.MessageTypes.EncryptedText,o.MessageTypes.MagicBotEvent];t.copyAllowed=(e,t)=>e&&i.includes(n,t)},538165:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isMessageInSendingState=void 0;const i=s(770891);t.isMessageInSendingState=function(e,t){return t!==i.MessageRenderOrigin.CallCanvas&&e.isMessageLie()&&!e.isSendRejected()&&!e.isEphemeral()}},463189:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(974634),o=s(746096),n=s(436237);const r=new class{constructor(){this._focusMessageComposerEvent=new i.default}focusMessageComposerEvent(){return this._focusMessageComposerEvent}focusMessageComposer(){n.log(o.LogTraceArea.Navigation,"MobileContentPanelHelper focusMessageComposer"),this._focusMessageComposerEvent.fire(!0)}blurMessageComposer(){n.log(o.LogTraceArea.Navigation,"MobileContentPanelHelper blurMessageComposer"),this._focusMessageComposerEvent.fire(!1)}};t.default=r},395868:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=new class{getItemToneFromString(e){const t=parseInt(e,10);return this.getItemToneFromNumber(t)}getItemToneFromNumber(e){let t;return void 0!==e&&e>0&&e<=6&&(t=e),t}};t.default=s},903404:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.computeMarks=void 0;const i=s(496486),o=s(889391),n=s(18078);t.computeMarks=function(e,t){let s=0,r=-1;const a={},l=[],d=1e3*o.default.getS4LMessagingFeaturesNoSubscription().readReceiptsAllowedLieTime,c=(e,t,s)=>{if(!n.default.isMyMri(t)){const i=a[e]||{readReceipts:[]};i.readReceipts.push({mri:t,timestamp:s}),a[e]=i}};if(i.each(e,((e,o)=>{for(;s<t.length&&e.createdTime>t[s].consumptionHorizon;){if(r>=0){const e=t[s];c(r,e.id,e.consumptionHorizonUpdateTime)}s++}const n=i.find(t,(t=>t.id===e.creator)),h=n?n.consumptionHorizonUpdateTime:0,u=e.createdTime-h;return!i.includes(l,e.creator)&&a[r]&&u>0&&u<d&&!i.isEmpty(i.remove(a[r].readReceipts,(t=>t.mri===e.creator)))&&(i.isEmpty(a[r].readReceipts)&&delete a[r],l.push(e.creator),c(o,e.creator,e.createdTime)),s!==t.length&&(e.countsForReadReceipts()&&(r=o),!0)})),r>=0)for(;s<t.length;){const e=t[s];c(r,e.id,e.consumptionHorizonUpdateTime),s++}return a}},768794:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(436237),o=s(149643),n=s(793003),r=s(853374);class a{static trackSortByFilter(e){if(!a._isSortByFilterTracked){let t;switch(a._isSortByFilterTracked=!0,e){case n.RecentsSortBy.Time:t=o.RecentConversationsFilterAction.SortByTime;break;case n.RecentsSortBy.Unread:t=o.RecentConversationsFilterAction.SortByUnread;break;case n.RecentsSortBy.Active:t=o.RecentConversationsFilterAction.SortByActive;break;default:t=r.default.switchStatementExhaustiveChecking(e)}i.track(new o.RecentConversationsFilterEvent(t))}}static trackRowSize(e){if(!a._isRowSizeTracked){let t;switch(a._isRowSizeTracked=!0,e){case n.RowSize.Default:t=o.RecentConversationsFilterAction.RowSizeDefault;break;case n.RowSize.Compact:case n.RowSize.ExtraCompact:t=o.RecentConversationsFilterAction.RowSizeCompact;break;default:t=r.default.switchStatementExhaustiveChecking(e)}i.track(new o.RecentConversationsFilterEvent(t))}}static trackShowCategories(e){if(!a._isShowCategoriesTracked){a._isShowCategoriesTracked=!0;const t=e?o.RecentConversationsFilterAction.ShowCategories:o.RecentConversationsFilterAction.HideCategories;i.track(new o.RecentConversationsFilterEvent(t))}}}a._isSortByFilterTracked=!1,a._isRowSizeTracked=!1,a._isShowCategoriesTracked=!1,t.default=a},477275:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(174958),o=s(496486),n=s(351077),r=s(816402),a=s(986374),l=s(746096),d=s(436237),c=s(312762),h=s(279829),u=s(71987),p=s(404057),g=s(853374);t.default=class{static _updateInvitations(e,t,s,i){const n=o.find(t,(e=>e.key===i));return n&&o.each(n.users,(t=>{const i=e[t.mri];(!i||t.time&&(!i.updatedTimeMs||t.time>i.updatedTimeMs))&&(e[t.mri]={invitationStatus:s,updatedTimeMs:t.time})})),e}static containsScheduledCallData(e){return!!e.properties}static extractScheduledCallFromMessage(e){const t=a.decode(e).getFirstUriObjectChild(c.ScheduledCallInviteNode);if(!t)return void d.error(l.LogTraceArea.ScheduleCall,"Received ScheduledCall message but it does not have a URIObject.");const s=e.properties&&e.properties[n.MessageProperties.ScheduledCallInviteData];if(!s)return void d.error(l.LogTraceArea.ScheduleCall,`Missing ScheduledCallInviteData property in scheduled call message,id: ${t.scheduledCallId},subject: ${t.subject?i.pii.Omit(t.subject):"''"},datetimeMs: ${r.default.getAbsoluteDisplayDateTimeString(t.datetimeMs)}`);const o=p.default.parseJsonErrorToUndefined(s);if(!this._validateScheduledCallInviteData(o,t))return;const m=e.getScheduledCallsResponses();return o.invitations=this._updateInvitations(o.invitations,m,h.ScheduledCallInvitationStatus.Accepted,n.MessageAnnotations.ScheduledCallInviteAccepted),o.invitations=this._updateInvitations(o.invitations,m,h.ScheduledCallInvitationStatus.Declined,n.MessageAnnotations.ScheduledCallInviteDeclined),{id:t.scheduledCallId,convId:e.conversationId,cuid:e.cuid,organizer:e.creator,invitations:o.invitations,consumptionHorizons:o.consumptionHorizons,datetimeMs:t.datetimeMs,reminder:t.reminder,subject:t.subject?g.default.unescapeXml(t.subject):u.default.getScheduledCallSubject(t.subject),canceledTimeMs:t.canceledTimeMs,editedTimeMs:t.editedTimeMs}}static _validateScheduledCallInviteData(e,t){if(e&&void 0!==e.invitations&&void 0!==e.consumptionHorizons)return!0;if(!e)return d.error(l.LogTraceArea.ScheduleCall,`ScheduledCallInviteData property is undefined,id: ${t.scheduledCallId},subject: ${t.subject?i.pii.Omit(t.subject):"''"},datetimeMs: ${r.default.getAbsoluteDisplayDateTimeString(t.datetimeMs)}`),!1;const s=`Unexpected content in the ScheduledCallInviteData property:id: ${t.scheduledCallId},subject: ${t.subject?i.pii.Omit(t.subject):"''"},datetimeMs: ${r.default.getAbsoluteDisplayDateTimeString(t.datetimeMs)},'invitations' property is undefined: ${!e.invitations},'consumptionHorizons' property is undefined: ${!e.consumptionHorizons}`;return d.error(l.LogTraceArea.ScheduleCall,s),!1}}},842987:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transferServicesMeta=t.DownloadActionType=t.PostingActionType=t.BackgroundTransferActionType=void 0;const i=s(496486);t.BackgroundTransferActionType="backgroundTransfer",t.PostingActionType="messagePost",t.DownloadActionType="fileDownload",t.transferServicesMeta=function(e){const s={hasTransfer:!1,hasPost:!1,hasDownload:!1};return i.each(e,(e=>(e===t.BackgroundTransferActionType&&(s.hasTransfer=!0),e===t.PostingActionType&&(s.hasPost=!0),e===t.DownloadActionType&&(s.hasDownload=!0),!i.every(s)&&void 0))),s}},510609:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasOnlyWebLink=t.getUrlPreviewInformationFromMetadata=t.getUrlPreviewInformation=t.getUrlPreviewInformationForMessage=void 0;const i=s(496486),o=s(312762),n=s(361694);function r(e,t){const s=e.getUrlPreviewMetadata(t);return s&&a(s,t)}function a(e,t){const s=function(e){return!(!e||!e.status_code||"200"!==e.status_code&&"ok"!==e.status_code.toLowerCase())}(e),o=function(e){return!!e&&!i.isEmpty(e.thumbnail)}(e);return{url:t,urlPreviewMetadata:e,isValid:s,hasThumbnail:o}}t.getUrlPreviewInformationForMessage=function(e,t){const s={},a=[];return i.each(t.children,(t=>{if(t instanceof o.LinkNode&&t.getUrlType()===n.UrlType.Web){const i=t.getSanitizedHref();if(!s[i]){s[i]=!0;const t=r(e,i);t&&a.push(t)}}})),a},t.getUrlPreviewInformation=r,t.getUrlPreviewInformationFromMetadata=a,t.hasOnlyWebLink=function(e,t){return!i.isEmpty(e)&&1===e.length&&1===i.sumBy(t.children,(e=>e instanceof o.EditMessageMetaDataNode?0:1))}},291319:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(770891),n=s(626712),r=["youtube.com","m.youtube.com","www.youtube.com","youtu.be"],a=/^(?:(?:https?:)?\/\/)?(?:(?:www|m)\.)?(?:(?:youtube\.com|youtu.be))(?:\/(?:[\w\-]+\?v=|embed\/|v\/)?)([\w\-]+)(?:\S+)?$/;class l{static isYoutubeUrl(e){if(!n.default.isUrlValid(e))return!1;const t=n.default.getURIComponents(e);return!(!t||!t.host)&&i.includes(r,t.host)}static getYoutubeVideoPropsFromUrl(e){if(!l.isYoutubeUrl(e))return;const t=this._getVideoIdFromYoutubeLink(e);return t?{contentType:o.PipContentType.Youtube,videoUrl:e,videoId:t}:void 0}static getYoutubeVideoPropsFromUrlPreviewData(e){const t=e.url;if(!l.isYoutubeUrl(t))return;const s=this._getVideoIdFromYoutubeLink(t);return s?{contentType:o.PipContentType.Youtube,videoUrl:t,videoId:s,videoPreviewUrl:e.urlPreviewMetadata.thumbnail}:void 0}static _getVideoIdFromYoutubeLink(e){const t=e.match(a);if(t&&t.length>1)return t[1]}}t.default=l},572335:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(609748),o={asmImageProxy:"https://urlp.asm.skype.com/v1/url/content",audioSendTimeout:5e3,audioMessageMaxRecordingTimeMs:12e4,backgroundHeadlessPosting:!1,backgroundPostingOnPushDebounceTimeout:3e4,backgroundTransfersInFlightLimit:0,bingImageAppId:"NO_APP_ID",bingImageBaseUrl:"https://www.bingapis.com/api/v7/images",bingMapsImageryRestApiBaseUrl:"https://dev.virtualearth.net/REST/v1/Imagery/Map/CanvasLight",bingMapsLocationRestApiBaseUrl:"https://dev.virtualearth.net/REST/v1/Locations",bingMapsPoweredByImageUrl:"https://dev.virtualearth.net/Branding/logo_powered_by.png",bingMapsRestApiKey:"NO_API_KEY",bingPlacesAppId:"NO_APP_ID",bingSearch:{host:"https://www.bing.com/search?q=",tryOpenInAppBrowser:!0,clickLinkTenantIdRightClickSidebar:"SKCONS",clickLinkTenantIdRightClickBrowser:"SKCONB"},bingSearchMessageHint:{enabled:!1,maxShownTimes:1,timeToShowHintInMs:216e5},browserMultiTabNotifications:{enabled:!1,activeTabRefreshInterval:4e4,activeTabExpirationInterval:6e4},callingSendTimeout:3e3,captivePortalQuestionnaireFrequency:0,clearPushRegistrations:!1,composerAutoCompletionDelay:500,consumePresenceFromPush:!1,contactSendTimeout:3e3,convPanelLoggingLevel:"on",disableGifsInMediaPicker:!1,emoticonForDefaultCard:"like",emoticonForEmptyCallsTab:"call",emoticonForEmptyChatsTab:"like",emoticonForEmptyContactsTab:"party",emoticonForEmptyNotificationsTab:"bell",emoticonForEmptyPhoneTab:"canyoutalk",emoticonForMeetNowCard:"mansurfer",emoticonForMeetNowExtendedCard:"mansurfer",emoticonForMobileLandlinesCard:"whosthis",emoticonForOnboardingContactsTab:"like",emoticonForOnboardingPermissionsTab:"camera",emoticonForOnboardingDiagnosticTab:"smilerobot",emoticonForSkypeToPhoneCard:"avocadolove",emoticonForSkypeNumberCard:"whosthis",emoticonForWhatsNewCard:"launch",emoticonsOnlyEmoticonSize:2,enableAudioMessageWaveAndSpeed:!1,enableAltMsgView:!1,enableAdaptiveCardLibs:!1,enableAddAllDeviceContacts:!0,enableAddedToConversationNotification:!1,enableAndroidCustomDownloadFolder:!1,enableAndroidExpandedNotifications:!1,enableAndroidMessagingStyleNotifications:!1,enableAudioMessageDuration:!1,enableAutoDownloadFiles:!1,enableAutoDownloadFilesInCall:!1,enableAudioTranscription:!1,enableAutoDownloadOnDesktopAndMobile:!1,enableBingSearchMessages:!1,enableAutoPlayVoiceMessagesInRow:!1,enableBigUnicodeEmoticons:!0,enableBrickingOneToOneThreads:!0,enableCacheableReactionPopup:!0,enableCaptivePortalQuestionnaire:!1,enableContactAddDragAndDrop:!1,enableContactShareDragAndDrop:!0,enableConversationsCategoriesIcon:!1,enableConversationSwitchWithoutRemount:!1,enableConversationTabsDropdown:!1,enableCustomFileDownloadLocation:!1,enableDebugMessageActions:!1,enableDefferedComposerOnAndroid:!1,enableDirectBookmarkDelete:!1,enableDoubleTapReaction:!1,enableDraftMessagesPersistentStorage:!1,enableDragAndDropFromDesktopToRecentLists:!0,enableDragAndDropTextAndLink:!1,enableEdgeFeaturesForOpenLink:!1,enableEmoticonGroups:!1,enableFastMessageSendSuccessPropagation:!1,enableForwardingHtmlMessages:!1,enableForwardingQuotes:!1,enableForwardItemIconForStreamItems:!1,enableFullChatUx:!1,enableFullResolutionImageDownload:!0,enableGifOptimisation:!1,enableGifPlayer:!1,enableGreetingCard:!1,enableGroupedConversations:!0,enableHandlingHTMLonPaste:!1,enableImageForwarding:!1,enableImagePasteMobile:!1,enableIndividualPesItemTelemetry:!1,enableJoinEnabledThreadPropInConversationView:!1,enableKeepUnsentMessagesAtEndOfStream:!1,enableKeyboardNavigationBetweenConversations:!1,enableLocationSharingOnDesktopAndWeb:!1,enableMagicBot:!0,enableMagicBotAttributions:!1,enableMagicBotBanner:!1,enableMagicBotChatlistSuggestionsDebouncing:!1,enableMagicBotFallbackLocationClient:!1,enableMagicBotGroupAutoAdd:!1,enableMagicBotLinkShare:!1,enableMagicBotOneOnOneAutoAdd:!1,enableMagicBotReportReasons:!1,enableMagicBotSuccessBingButton:!1,enableMagicBotSuggestionsOnChatListPanel:!1,enableMagicBotToolbox:!1,enableMagicBotToolboxGroup:!1,enableMagicBotToolboxInBinglessGroups:!1,enableMagicPreviewLogo:!1,enableMagicSkypeLogo:!1,enableMarkAsReadNotificationAction:!1,enableMediaFileRedesign:!1,enableMediaPreviewDrafts:!1,enableMediaPreviewDraftsPersistentStorage:!1,enableMessageSendE2EPerfTracking:!1,enableMiniContextMenu:!1,enableMobileSearchInConversation:!1,enableModeratedGroupChats:!1,enableNewCallsTabPanel:!1,enableNewCallsCreditOffers:!1,enableNewConversationCreation:!1,enableNewEmoticonBackgroundRenderLogic:!1,enableNewSendingStateStrategy:!1,enableNoNetworkInfoOnSendingMessage:!1,enableNotificationPeriods:!1,enableNotificationPrompt:!1,enableNotificationUtfFallback:!1,enableNotCheckingIsConversationEmpty:!1,enableOpenLocationCardInFindPanel:!1,enableOverflowMenuGrid:!1,enableParsingHtmlMessages:!1,enablePesGifPagination:!1,enablePesGifs:!1,enableQuotingHtmlMessages:!1,enableReactionAnnouncements:!0,enableReactionOverlays:!0,enableReactionsInBottomSheet:!1,enableReactionsHoverSummary:!0,enableReactWithClickOnSummary:!1,enableReadReceipts:!0,enableRecyclerListViewGlobal:!1,enableRecyclerListViewUseCases:[],enableRefreshedLandingPage:!1,enableReportMessage:!0,enableRevealHistoryInConversation:!1,enableSafeDomainRendering:!1,enableSecureThreadsInsecureStorage:!1,enableShareMediaPreview:!0,enableMyBot:!1,enableShowFloatTooltips:!1,enableSkypeClipsRecord:!1,enableSmallEmoticonsInDesktopPicker:!1,enableSmallEmoticonsInMobilePicker:!1,enableSmsFingerprintId:!1,enableToneRewrite:!1,enableV2PropMapping:!1,globalMessageSearch:{initialPageSize:30,nextPageSize:20},hideHeaderInLandscape:!1,hideConversationsListSectionHeaders:!1,hidePrivateConversationsOnOtherEndpoints:!1,hideReportedMessages:!1,imageCaching:{cachedStatusMaxAge:3600,prefetchRetryCount:3,prefetchRetryCountNoConnection:1,prefetchRetryLongDelay:3e5,prefetchRetryShortDelay:1e3,queryCacheInFlightLimit:32},inConversationMessageSearch:{initialPageSize:40,nextPageSize:0},limitForFilePicker:20,locationSendTimeout:3e3,locationMaxAgeInMinutes:20,myBotId:"28:e7a9407c-2467-4a04-9546-70081f4ea80d",magicBotId:"28:cf0e6215-34fe-409b-9e4b-135d7f3aa13b",magicBotCampaignId:"SkypeEngagementSystem-Test",magicBotWaitListRefreshIntervalInMinutes:720,magicBotCampaignImageUrl:"https://secure.skypeassets.com/content/dam/engagement/bingchatinskype/c3fd07e6-cb13-4744-a37a-50cee4ec62bf__bingbotintroductionimagetransparentbackground.png",magicBotApi:"https://open-ai-connect.skype.com/api/",magicBotFallbackLocationApi:"https://www.bing.com/shop/",magicBotSuggestionshDebounceTimeout:5e3,magicBotToolboxTooltipOnInteractionCount:2,magicBotTelemetrySamplingOverride:!1,maxMessagesToLoadFromDBForMediaSearch:25,maxNumberEmoticonsPerMessage:50,maxNumberOfCustomReactions:60,maxRecentConversationsToShow:50,magicBotPreviewLink:"https://go.skype.com/bingchatlearnmore",mediaBarMenuOrder:i.MediaBarDefaultOrder,mediaBarNewItems:[],messageHintsPriority:[],messageReactionsHintsMaxShownTimes:0,messageReadDelay:750,messageReadEventTimeout:5e3,messageStreamFontSizeMultiplier:{smaller:.7,small:.85,normal:1,large:1.2,larger:1.45},messageStreamStoreCacheMaxMessageCount:300,messageStreamStoreCacheSize:10,modernizeIllustrations:!1,modernizeSearchPanel:!1,mojiSendTimeout:3e3,nativeEmoticonCacheLoggingSampleRate:0,nativeEmoticonCacheTelemetrySampleRate:0,nonBlockingUploadsFromSize:3e6,noneGroupSendCallback:3e3,notifyForAdditionalReactions:!1,numberOfIconsInMediaBar:7,oldContentPanelForceHideTimeout:1e3,onlySendWithBackgroundSession:!1,openYouTubeLinksInPip:!1,openLinkWithEdgeSidebar:!1,overflowMenuOrder:i.OverflowMenuDefaultOrder,pesGifItemsLimit:20,pesPickerCategoryOrder:i.PesPickerCategoryDefaultOrder,personalizationPickerCategoryOrder:i.PersonalizationPickerCategoryDefaultOrder,pictureSendTimeout:5e3,pollCardSendTimeout:3e3,pollWinnerEmoticonName:"party",pollNoVotesEmoticonName:"tumbleweed",reactionPacks:[["cry","sarcastic","surprised","cwl","heart","yes"],["rock","facepalm","porgsurprised","monkey","star","no"],["bow","gran","dance","party","highfive","ttm"]],readReceiptsAllowedLieTime:60,recentConversationsIncrementor:20,reduceMessagePostTimeout:!1,retryAddMembersToThread:!1,safeDisplayDomains:["bot-framework.azureedge.net","avatar.skype.com","api.skype.com","botavatar.azureedge.net"],scdPingIntervalInDays:14,sendingLieMaxDuration:3e3,setOverflowMenuButtonToPlainColor:!1,showMediaPickerInRightControlsForMobile:!1,showNewChatFirstInPlusMenu:!1,singleEmoticonSize:2,skypeClipsUrl:"https://taoofskype.bing-shopping.microsoft-falcon.io/",skypetokenAllowedDomains:["avatar.skype.com"],smsFingerprintIdTag:"systemId",startBotIds:["28:f53e4183-c614-4b16-87bb-707c1def4034","28:35fc925b-a175-4e75-9463-82df3c540f2f"],staticSuggestions:[],staticSuggestionsDelay:2e3,stickerSendTimeout:3e3,stickersNotSupportedFallbackUrl:"https://go.skype.com/you.received.sticker",swiftCardSendTimeout:3e3,syncSettings:{skipConvTypeCast:!0,skipConvTypeSmsMms:!0,skipCastSync:!0,skipSmsMmsSync:!0,forceOnUiStarted:!1,forceOnForeground:!1},systemSendTimeout:3e3,tenorBaseUrl:"https://api.tenor.com/v1/",tenorApiKey:"NO_API_KEY",tenorSearchEndpoint:"search",tenorTrendingEndpoint:"trending",tenorContentFilter:"high",textSendTimeout:3e3,toneRewriteApi:"https://www.bing.com/api/swiftkey/v1",toneRewriteLoadingCaptionIntervalMs:3e3,toneRewriteTones:["professional","casual","funny","social post","witty","polite"],toneRewriteQueryMaxChars:200,toneRewriteQueryMaxWords:50,toneRewriteQueryMinChars:2,toneRewriteQueryMinWords:3,transformCorruptedMessages:!0,textSendWithCriticalPriority:!1,ued:{enabled:!1,consumeEvents:!1,isExclusive:!1,enablePush:!1},unsafeFiles:[],uriFileSendTimeout:3e3,useColorfulSendButton:!1,useNewVideoMessageIcon:!1,usePesForBingGifSuggestions:!1,videoSendTimeout:5e3};t.default=o},292681:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CapturedContentHandlerForMarkupOnly=void 0;const i=s(550785),o=s(397691);t.CapturedContentHandlerForMarkupOnly=class{constructor(e){this._handler=e}handleCapturedContent(e,t){return e.forEach((e=>{(0,i.isNativeBlob)(e.file)&&this._handler(e.file.uri,e.file.size||0,e.dimensions.width,e.dimensions.height,t)})),o.Resolved()}handleMediaSelection(){return o.Rejected()}}},314920:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CapturedContentHandlerForPosting=void 0;const i=s(550785),o=s(397691),n=s(698172),r=s(746096),a=s(708681),l=s(381157),d=s(206286),c=s(415963);class h{constructor(e,t,s){this._conversationId=e,this._callId=t,this._parentConversationId=s}handleCapturedContent(e,t,s,i){if(0===e.length)return o.Rejected("No file to process");const n=e.map((e=>{switch(e.file.type.split("/",1)[0]){case"image":return this._postImageNewFlow(e);case"video":return o.Resolved(e);default:return o.Rejected()}}));return o.all(n).then((e=>d.default.sendPreviewsWithData(this._conversationId,e,void 0)))}handleMediaSelection(e,t,s,i){const o=h._makeScenarioInfo(t),n=this._makePostProperties(t);return l.default.postMediaSelections(e,this._conversationId,r.PostSource.MediaPicker,{callId:this._callId,scenarioInfo:o,properties:n},i,s)}static _makeScenarioInfo(e){const t={name:e?c.ScenarioName.SendVideo:c.ScenarioName.SendPicture};return e||(t.secondaryScenariosToSpawnAtCreation=[{name:c.ScenarioName.SendPictureUI}]),t}_makePostProperties(e){return!e&&this._callId&&this._parentConversationId?n.default.getReactionsThreadPostParams(this._parentConversationId):void 0}_downsizeImage(e){return(0,i.isNativeBlob)(e.file)?a.default.downsizeImageIfNeeded(e.file.uri,e.file.name,e.dimensions.width,e.dimensions.height,e.file.size):o.Rejected()}_postImageNewFlow(e){return this._downsizeImage(e)}}t.CapturedContentHandlerForPosting=h},198447:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CapturedContentHandlerForSharing=void 0;const i=s(550785),o=s(397691),n=s(733754),r=s(5899);function a(e){return e&&(0,i.isNativeBlob)(e.file)?e.file.uri:void 0}t.CapturedContentHandlerForSharing=class{constructor(e,t){this._componentContext=e,this._onShareComplete=t}handleCapturedContent(e,t,s){const i=e.map((e=>{switch(e.file.type.split("/",1)[0]){case"image":return this._shareImage(e,s);case"video":return this._shareVideo(e,s);default:return o.Rejected()}}));return o.all(i).then((()=>o.Resolved()))}handleMediaSelection(e,t){const s=n.getString(t?"CapturePreview.ShareVideoTitle":"CapturePreview.SharePhotoTitle");return r.default.shareMediaSelection(e,s,this._onShareComplete,void 0,this._componentContext),o.Resolved()}_shareImage(e,t){(0,i.isNativeBlob)(e.file)&&r.default.sharePhoto(e.file.uri,a(e.thumbnail),e.file.size,e.dimensions.width,e.dimensions.height,n.getString("CapturePreview.SharePhotoTitle"),this._onShareComplete,void 0,t,this._componentContext)}_shareVideo(e,t){(0,i.isNativeBlob)(e.file)&&r.default.shareVideo(e.file.uri,a(e.thumbnail),e.file.size||0,e.dimensions.width,e.dimensions.height,n.getString("CapturePreview.ShareVideoTitle"),this._onShareComplete,void 0,t,this._componentContext)}}},422801:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(174958),o=s(496486),n=s(583367),r=s(267728),a=s(168950),l=s(516778),d=s(662783),c=s(974634),h=s(397691),u=s(300060),p=s(889391),g=s(598925),m=s(905531),S=s(260021),f=s(476621),y=s(36593),v=s(890239),C=s(25759),_=s(749868),b=s(765369),T=s(61375),M=s(859631),I=s(671830),w=s(10102),P=s(539549),k=s(746096),A=s(436237),x=s(998754),R=s(861253),O=s(704329),L=s(812056),F=s(656032),B=s(18078),D=s(17791),E=s(513651),V=s(583181),N=s(666765),U=s(216568),j=s(496856),H=s(422538),z=s(404057),W=s(478262),G=s(327795),K=s(912770),q=s(994214),Q=s(590424),X=s(381660),$=s(571046),J=s(931693),Y={statusCode:0,statusText:"",errorMessage:"Endpoint does not exist.",headers:{},url:"",method:"",canceled:!1,timedOut:!1,body:void 0},Z={statusCode:0,statusText:"",errorMessage:"Endpoing presence doc not published",headers:{},url:"",method:"",canceled:!1,timedOut:!1,body:void 0};t.default=new class{constructor(){this._requestingWakelock=!1,this._releasingWakelock=!1,this._restLongPollResult=v.LongPollResult.Success,this._restConnectionState=v.SubscriptionState.None,this.subscriptionStateChanged=new c.default,this.disconnected=new c.default,this.reconnected=new c.default,this._wasConnected=!1,this.controlMessagesReceived=new c.default,this.incomingCallMessageReceived=new c.default,this.userPresenceReceived=new c.default,this.extendedPresenceDocReceived=new c.default,this.inviteFreeQuarantineTriggered=new c.default,this._trackedConvPropSets={},this._trackedThreadPropSets={},this.releasingWakelock=new c.default,this._longRunningRequests={},this._loggingOut=!1,this._subscriptions=[],this._restConnectionStateChanged=(e,t)=>{this._restConnectionState=e,this._restLongPollResult=t,this._connectionStateChanged()},this.feedInitialEndpointUrl=e=>{this._initialEndpointUrl=e},this.handleLocationChange=(e,t,s)=>{t===k.ChatServiceConnectionType.MessagingApi?this._messagingRestClient.handleLocationChange(e):this._restTransport.handleLocationChange(e,s)},this._handleInviteFreeQuarantine=()=>{this.inviteFreeQuarantineTriggered.fire()},this.handleTrouterEvent=(e,t,s)=>{const n=k.MessageOrigin.Trouter,r=z.default.parseJsonErrorable(e);o.isError(r)?A.error(k.LogTraceArea.ChatService,"Failed to parse Trouter event."):(r.cv=t,r.messageStoreUsed=s,(0,X.transformEvent)(r)?this._handleEvents([r],n):A.warn(k.LogTraceArea.ChatService,`Event will be ignored - cv: ${r.cv}, event: ${i.pii.Omit(JSON.stringify(r))}`))},this._handleEvents=(e,t=k.MessageOrigin.LongPoll)=>{const s={},n=[],r={};o.each(e,(e=>{switch(A.log(k.LogTraceArea.ChatService,`handle ${k.MessageOrigin[t]} Event: ${e.resourceType} ${e.cv?" , MS-CV: "+e.cv:""}`),e.resourceType){case"CustomUserProperties":o.extend(s,e.resource);break;case"ConversationUpdate":{const t=e.resource;A.log(k.LogTraceArea.ChatService,`Conv: ${i.pii.Mri(t.id)}, Version: ${t.version}`),f.default.queueConvUpdate(t)}break;case"ThreadUpdate":{const t=e.resource;A.log(k.LogTraceArea.ChatService,`Conv: ${i.pii.Mri(t.id)}, Version: ${t.version}`),f.default.queueThreadUpdate(t)}break;case"NewMessage":case"MessageUpdate":const a=(0,J.tweakMagicBotOneOnOneMessage)(e.resource);if(0===a.messagetype.indexOf("Control/")||(0,$.isMagicBotOneOnOneControlMessage)(a))n.push(a);else if(0===a.messagetype.indexOf("ThreadActivity/MemberConsumptionHorizonUpdate")){const e=I.getParsedConversationId(a);if(!e){A.log(k.LogTraceArea.ReadReceipts,"Failed to parse conversationLink: "+i.pii.Omit(a.conversationLink));break}const t=z.default.parseJsonErrorable(a.content);if(o.isError(t)){A.log(k.LogTraceArea.ReadReceipts,"Failed to parse consumptionHorizon: "+i.pii.Omit(a.content));break}const s={id:t.user,consumptionhorizon:t.consumptionhorizon};A.log(k.LogTraceArea.ReadReceipts,"Event: Message: Conv: "+i.pii.Mri(e)+", Id: "+a.id+", content: "+i.pii.Omit(a.content)+", consumptionHorizon: "+t.consumptionhorizon),f.default.queueMemberConsumptionHorizonUpdate(e,s)}else if(0===a.messagetype.indexOf("Signal/Flamingo"))A.log(k.LogTraceArea.ChatService,"Received Signal/Flamingo message, ID: "+a.id),this.incomingCallMessageReceived.fire(a);else{const s=I.getParsedConversationId(a);if(!s){A.log(k.LogTraceArea.ReadReceipts,"Failed to parse conversationLink: "+i.pii.Omit(a.conversationLink));break}const n=I.getCreatorMriForMessageFromLink(a.from),r=a.clientmessageid;A.log(k.LogTraceArea.ChatService,"Event: Message: Conv: "+i.pii.Mri(s)+", Id: "+a.id+", CMID: "+r+", CorrelationId:"+S.getCorrelationIdFromMessageParts(n,s,r)+", type: "+e.resourceType+", time: "+e.time);const l=Date.now().valueOf();A.log(k.LogTraceArea.LowBandwidth,"<NFR> || Receive_IM || Latency_Timestamp || "+l+" || Latency || "+(l-o.toNumber(a.id)));const d={message:a,origin:t,isOtherEndpointActive:!1,correlationVector:e.cv,messageStoreUsed:e.messageStoreUsed};f.default.queueMessagesForConversation(s,[d])}break;case"EndpointPresence":case"ReadReceipt":break;case"UserPresence":const l=e.resource,d=l.selfLink.split("/")[5];r[d]=l;break;default:A.warn(k.LogTraceArea.ChatService,`${t} Unhandled Event, MS-CV: ${e.cv}`,e)}})),o.isEmpty(s)||f.default.queuePartialUserPropertySet(s),n.length>0&&this.controlMessagesReceived.fire(n),o.isEmpty(r)||this.userPresenceReceived.fire(r),f.default.processQueuedBundle()},this._updateMyPropertiesRequestSuccessHandler=e=>(e&&(this._lastUserPropertiesUpdateTime=Date.now()),f.default.setNewUserPropertySet(e).then((()=>{if(this._fetchAndUpdatePropertiesDeferred){const e=this._fetchAndUpdatePropertiesDeferred;this._fetchAndUpdatePropertiesDeferred=void 0,e.resolve(void 0)}})).catch((e=>{if(this._fetchAndUpdatePropertiesDeferred){const t=this._fetchAndUpdatePropertiesDeferred;this._fetchAndUpdatePropertiesDeferred=void 0,t.reject(e)}}))),this._updateMyPropertiesRequestFailureHandler=e=>{if(!this._fetchPropertiesPromise&&this._fetchAndUpdatePropertiesDeferred){const t=this._fetchAndUpdatePropertiesDeferred;this._fetchAndUpdatePropertiesDeferred=void 0,t.reject(e)}},this.errorHandler=new y.ChatServiceErrorHandler(this.handleLocationChange,this._handleInviteFreeQuarantine),this._restTransport=new E.default(this,this._handleEvents,this._restConnectionStateChanged,this.errorHandler),this._messagingRestClient=new F.default(this.errorHandler),H.RegisterStartupable(this,"ChatService",[f.default,x.default,D.default,U.default,q.default,N.default]),O.default.registerForLogout(this,"ChatService")}startup(){this._initialEndpointUrl&&N.default.setRestEndpointUrl(this._initialEndpointUrl),N.default.endpointInfoChanged.subscribe(((e,t)=>{this._restTransport.endpointInfoUpdated(e,t),this._pushSubscription&&this._pushSubscription.endpointInfoUpdated(e,t),M.default.endpointInfoUpdated(e,t),this._checkTransportState();const s=t.id,i=e.id;i&&s&&!I.areEndpointIdsEqual(i,s)&&Q.getDurableEndpointId().then((e=>{(I.areEndpointIdsEqual(e,i)||I.areEndpointIdsEqual(e,s))&&(A.log(k.LogTraceArea.ChatService,"Deleting old endpoint "+s),this.serviceDeleteEndpoint(s).then((()=>{A.log(k.LogTraceArea.ChatService,"Endpoint ID "+s+" successfully deleted")})).catch((e=>{A.log(k.LogTraceArea.ChatService,"Failed to delete endpoint ID "+s+": "+z.default.errorAsString(e))})))}))})),this._restTransport.startup(),this._messagingRestClient.startup(),this._pushSubscription=new _.default(this,"Push",Q.calculatePnhInterestedResources());const e=f.default.conversationsUpdated.subscribe((e=>{this._receivedConversationUpdates(e)}));this._subscriptions.push(e);const t=f.default.getRawConversationMetaMemoryCache();this._receivedConversationUpdates(t),this._connectivitySubToken=D.default.subscribe((()=>{D.default.getPassedConnectivityCheck()?(D.default.isNetworkingAvailable()&&(A.log(k.LogTraceArea.ChatService,"ReportedConnectivityStore reported connectivity, kicking transports"),this._resetBackoffTimers()),this._checkTransportState()):A.log(k.LogTraceArea.ChatService,"ReportedConnectivityStore reported captive portal, no action")}));const s=u.default.subscribeForChanges("ChatService",(e=>{e===l.Types.AppActivationState.Active&&(A.log(k.LogTraceArea.ChatService,"ActivationState reported active, kicking transports"),this._resetBackoffTimers()),this._checkTransportState()}));this._subscriptions.push(s);const i=n.default.onResume.subscribe((e=>{A.log(k.LogTraceArea.ChatService,"Resuming from sleep, kicking transports causeId: "+e),this._resetBackoffTimers(),this._checkTransportState()}));return this._subscriptions.push(i),this._appConfigSubToken=p.default.subscribe((()=>{this._checkIsConnectedStatus(),this._checkTransportState(),this._updateUedPushPropIfNeeded()})),this._capabilitiesSubToken=m.default.subscribe((()=>{this._checkTransportState()})),this._tokenStoreSubToken=q.default.subscribe((()=>{this._checkTransportState()}),q.TriggerKeys.SkypeTokenKey),this._stateStoreSubToken=V.default.subscribe((()=>{this._checkTransportState()}),V.TriggerKeys.UIDisplayedKey),this._checkTransportState(),this._updateUedPushPropIfNeeded(),h.Resolved()}getRestTransport(){return this._restTransport}serviceSetActiveEndpointTimeout(e,t){const s=(new C.ChatServicePresenceRequestFactory).setActiveEndpointTimeout(e,t);return this.performRequest(s).then(o.noop)}_resetBackoffTimers(){this._restTransport.resetBackoffTimers(),this._messagingRestClient.resetBackoffTimers()}_checkTransportState(){if(!this._loggingOut&&q.default.hasUsableSkypeToken()&&V.default.isUIDisplayed())l.App.getActivationState(),l.Types.AppActivationState.Active,this._restTransport.setConnectionEnabled(!0,"Foreground");else{const e=this._loggingOut?"logout":q.default.hasUsableSkypeToken()?V.default.isUIDisplayed()?"test":"no UI":"no token";if(this._restTransport.setConnectionEnabled(!1,e),this._loggingOut)return}if(this.isConnected())this._wakelockId||this._requestingWakelock||(this._requestingWakelock=!0,A.log(k.LogTraceArea.ChatService,"Requesting Wakelock"),r.default.requestMaxTime("Transport").finally((()=>{this._requestingWakelock=!1})).then((e=>{A.log(k.LogTraceArea.ChatService,"Got Wakelock: "+e),this._wakelockId&&(A.error(k.LogTraceArea.ChatService,"Got wakelock when already had wakelock: "+this._wakelockId),r.default.release(this._wakelockId,"Transport:duplicate")),this._wakelockId=e,this._checkTransportState()}),(e=>{A.error(k.LogTraceArea.ChatService,"Failed to get wakelock - "+(e?z.default.errorAsString(e):""))})));else if(this._wakelockId&&!this._releasingWakelock){this._releasingWakelock=!0;const e=p.default.getConfigSettingsNoSubscription().chat.backgroundReleaseWakeLockTime,t=this._wakelockId;A.log(k.LogTraceArea.ChatService,"Releasing Wakelock: "+t),this.releasingWakelock.fire(),a.default.setTimeout((()=>{r.default.release(t,"Transport").finally((()=>{this._releasingWakelock=!1})).then((()=>{A.log(k.LogTraceArea.ChatService,"Released Wakelock: "+t),this._wakelockId===t?this._wakelockId=void 0:A.error(k.LogTraceArea.ChatService,"Released wakelock when we had a different wakelock: "+this._wakelockId),this._checkTransportState()}),(e=>{A.error(k.LogTraceArea.ChatService,"Failed to release wakelock ("+t+") - "+z.default.errorAsString(e))}))}),e)}}pokeLongRunningRequest(e){this._longRunningRequests[e]||(this._longRunningRequests[e]=!0,this._checkTransportState())}removeLongRunningRequest(e){this._longRunningRequests[e]&&(delete this._longRunningRequests[e],this._checkTransportState())}logout(e,t,s){this._loggingOut=!0,this._restTransport.logout(),f.default.setBundleProcessingEnabled(!1);const i=N.default.getEndpointId();N.default.logout(e);const n=U.default.deleteIds({chatServiceSessionInfo:!0},!s),r=[];return i&&r.push(this.serviceDeleteEndpoint(i)),n.always((()=>h.raceTimer(h.all(r),500))).then(o.noop)}_receivedConversationUpdates(e){o.each(o.toArray(e),(e=>{e&&(o.each(e.conv.getPendingConvPropLies(),((t,s)=>{this._trackConversationPropertySet(e.conv.id,s,t.value,t.additionalParams)})),o.each(e.conv.getPendingThreadPropLies(),((t,s)=>{this._isThreadIconLie(t,s)||j.ThreadPropLiesAllowed[s]!==j.PropLieType.Local&&this._trackThreadPropertySet(e.conv.id,s,t.value)})))}))}_isThreadIconLie(e,t){return e.value&&o.startsWith(e.value.toString(),"blob:")&&t===I.ThreadProps.Picture}_connectionStateChanged(){A.log(k.LogTraceArea.ChatService,"Connection State Changed: REST: "+v.SubscriptionState[this._restConnectionState]+", LP result: "+v.LongPollResult[this._restLongPollResult]),this._checkIsConnectedStatus(),this.subscriptionStateChanged.fire()}_checkIsConnectedStatus(){const e=this.isConnected();this._wasConnected!==e&&(A.log(k.LogTraceArea.ChatService,"IsConnected changed: "+this._wasConnected+" -> "+e),this._wasConnected=e,e?this.reconnected.fire():this.disconnected.fire())}_updateUedPushPropIfNeeded(){var e;const t=null===(e=p.default.getS4LMessagingFeaturesNoSubscription().ued)||void 0===e?void 0:e.enablePush;t!==this._prevUedPushFlag&&(this._prevUedPushFlag=t,this.serviceSetUedPush(t))}isConnected(){return this._restConnectionState===v.SubscriptionState.CreatedActive}getSubscriptionState(){return this._restConnectionState}getLongPollResult(){return this._restLongPollResult}debug_getCurrentCloudUrl(){return this._restTransport.debug_getCurrentCloudUrl()}restoreEndpoints(e,t){return M.default.restoreEndpoint(e,this._restTransport,t)}fetchMemberConsumptionHorizon(e){this._serviceGetMemberConsumptionHorizons(e).then((t=>{A.log(k.LogTraceArea.ReadReceipts,"Fetched consumption horizons for: "+i.pii.Mri(e)+", content: ",o.map(t,(e=>({id:i.pii.Mri(e.id),consumptionhorizon:e.consumptionhorizon})))),o.each(t,(t=>{f.default.queueMemberConsumptionHorizonUpdate(e,t)})),f.default.processQueuedBundle()})).catch((t=>{A.warn(k.LogTraceArea.ChatService,"Failed to fetch consumption horizons for: "+i.pii.Mri(e)+" Error code: "+t.errorCode+" Message: "+t.errorMessage)}))}setConversationProperty(e,t,s,o){return A.log(k.LogTraceArea.ChatService,"setConversationProperty "+(j.ConvPropLiesAllowed[t]?"with":"without")+" lie: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))+(o?", params: "+JSON.stringify(o):"")),j.ConvPropLiesAllowed[t]?f.default.setConversationPropertyLie(e,t,s,o).then((()=>{const i=f.default.getLastConversationPropertyLie(e,t);return!i||i.value===s&&i.additionalParams===o||(s=i.value,o=i.additionalParams,A.log(k.LogTraceArea.ChatService,"setConversationProperty: lie updated to last know value")),this._trackConversationPropertySet(e,t,s,o)})):this._serviceSetConversationProperty(e,t,s,o)}_trackConversationPropertySet(e,t,s,o){const n=this._trackedConvPropSets[e]||(this._trackedConvPropSets[e]={});let r=n[t];return r&&(0,R.default)(r.value,s)&&(0,R.default)(r.additionalParams,o)||(r=n[t]={value:s,additionalParams:o,defer:h.Defer(),inFlight:!1},A.log(k.LogTraceArea.ChatService,"Tracking Conversation Property Set: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))+(o?", params: "+JSON.stringify(o):"")),this._checkOnConvPropSet(e,t,s,o)),r.defer.promise()}_checkOnConvPropSet(e,t,s,o){const n=this._trackedConvPropSets[e];if(!n)return;const r=n[t];r&&(0,R.default)(r.value,s)&&(0,R.default)(r.additionalParams,o)&&(r.inFlight||(r.waitUntil&&r.waitUntil>Date.now()?K.default.setExpiration((()=>{this._checkOnConvPropSet(e,t,s,o)}),r.waitUntil):(A.log(k.LogTraceArea.ChatService,"Setting Conversation Prop on Server: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))+(o?", params: "+i.pii.Omit(JSON.stringify(o)):"")),r.inFlight=!0,this._serviceSetConversationProperty(e,t,s,o).then((()=>{f.default.confirmConversationPropertyLie(e,t,s,o).then((()=>{A.log(k.LogTraceArea.ChatService,"Confirmed Setting Conversation Prop on Server: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))+(o?", params: "+i.pii.Omit(JSON.stringify(o)):"")),r.defer.resolve(void 0)})).always((()=>{delete n[t]}))}),(i=>{if(0===i.statusCode)return r.inFlight=!1,r.retryTimer?r.retryTimer.calculateNext():r.retryTimer=this._createNewPropExponentialTime(),r.waitUntil=Date.now()+r.retryTimer.getTime(),void this._checkOnConvPropSet(e,t,s,o);f.default.revertConversationPropertyLie(e,t,s,o).then((()=>{r.defer.reject("Error changing conversation property: "+z.default.errorAsString(i))})).always((()=>{delete n[t]}))})))))}_createNewPropExponentialTime(){return new d.ExponentialTime(1e3,6e4)}setThreadProperty(e,t,s){return A.log(k.LogTraceArea.ChatService,"setThreadProperty "+(j.ThreadPropLiesAllowed[t]?"with":"without")+" lie: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))),j.ThreadPropLiesAllowed[t]?f.default.setThreadPropertyLie(e,t,s).then((()=>this._trackThreadPropertySet(e,t,s))):this._serviceSetThreadProperty(e,t,s)}_trackThreadPropertySet(e,t,s){const o=this._trackedThreadPropSets[e]||(this._trackedThreadPropSets[e]={});let n=o[t];return n&&(0,R.default)(n.value,s)||(n=o[t]={value:s,defer:h.Defer(),inFlight:!1},A.log(k.LogTraceArea.ChatService,"Tracking Thread Property Set: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))),this._checkOnThreadPropSet(e,t,s)),n.defer.promise()}_checkOnThreadPropSet(e,t,s){const o=this._trackedThreadPropSets[e];if(!o)return;const n=o[t];n&&(0,R.default)(n.value,s)&&(n.inFlight||(n.waitUntil&&n.waitUntil>Date.now()?K.default.setExpiration((()=>{this._checkOnThreadPropSet(e,t,s)}),n.waitUntil):(A.log(k.LogTraceArea.ChatService,"Setting Thread Prop on Server: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))),n.inFlight=!0,this._serviceSetThreadProperty(e,t,s).then((()=>{f.default.confirmThreadPropertyLie(e,t,s).then((()=>{A.log(k.LogTraceArea.ChatService,"Confirmed setting Thread Prop on Server: "+i.pii.Mri(e)+": "+t+" => "+i.pii.Omit(JSON.stringify(s))),n.defer.resolve(void 0)})).always((()=>{delete o[t]}))}),(i=>{if(0===i.statusCode)return n.inFlight=!1,n.retryTimer?n.retryTimer.calculateNext():n.retryTimer=this._createNewPropExponentialTime(),n.waitUntil=Date.now()+n.retryTimer.getTime(),void this._checkOnThreadPropSet(e,t,s);f.default.revertThreadPropertyLie(e,t,s).then((()=>{n.defer.reject("Error changing Thread property: "+z.default.errorAsString(i))})).always((()=>{delete o[t]}))})))))}setMessageProperty(e,t,s,i,o){return(e.properties||{})[t]===s?h.Resolved():f.default.setMessagePropertyLie(e.conversationId,e.cuid,t,i).then((()=>this.serviceSetMessageProperty(e.conversationId,e.getServerIdForPropertyChanges(),t,s,o).catch((s=>(f.default.revertMessagePropertyLie(e.conversationId,e.cuid,t,i),h.Rejected("Error changing message property: "+z.default.errorAsString(s)))))))}setConversationIconLie(e,t){const s=I.ThreadProps.Picture;f.default.setThreadPropertyLie(e,s,t).then((()=>f.default.confirmThreadPropertyLie(e,s,t)),(i=>i&&f.default.revertThreadPropertyLie(e,s,t)))}setConversationLiveState(e,t){return I.isThread(e)?this.setThreadProperty(e,I.ThreadProps.LiveState,t):this.setConversationProperty(e,I.ConversationProps.LiveState,t)}setConversationLiveStateLie(e,t){const s=I.ThreadProps.LiveState;f.default.setThreadPropertyLie(e,s,t).then((()=>f.default.confirmThreadPropertyLie(e,s,t)),(i=>i&&f.default.revertThreadPropertyLie(e,s,t)))}setConversationLeaveTimeLie(e,t){const s=I.ThreadProps.LastLeaveAt;f.default.setThreadPropertyLie(e,s,t).then((()=>f.default.confirmThreadPropertyLie(e,s,t)),(i=>i&&f.default.revertThreadPropertyLie(e,s,t)))}setFakeConsumptionHorizonBeforeFirstEverMessage(e,t,s=!1){if(t.isEphemeral())return void A.warn(k.LogTraceArea.ConsumptionHorizon,"setFakeConsumptionHorizonBeforeFirstEverMessage "+i.pii.Mri(e)+" tried to set a consumption horizon on an ephemeral message "+t.getOriginalClientMessageId());const n=t.getOriginalServerId(),r=t.getCHID();if(!r||!n)return void A.warn(k.LogTraceArea.ConsumptionHorizon,"setFakeConsumptionHorizonBeforeFirstEverMessage "+i.pii.Mri(e)+" tried to set a consumption horizon on an incomplete message: clientMessageId:"+t.getOriginalClientMessageId()+", serverId: "+n+", chid: "+r);const a=(o.toNumber(n)-1).toString(),l=(o.toNumber(r)-1).toString(),d=I.getConsumptionHorizonForMessageAndCHID(a,l);this.setConsumptionHorizon(e,d,s)}setConsumptionHorizonToMessage(e,t,s=!1){const i=t.getConsumptionHorizonString();i&&this.setConsumptionHorizon(e,i,s)}setConsumptionHorizon(e,t,s=!1){const o=f.default.getConversationMetaFromMemoryCache(e);A.log(k.LogTraceArea.ConsumptionHorizon,"setConsumptionHorizon "+i.pii.Mri(e)+" to "+t+" canBeOlder="+s+" oldCH="+(o?o.conv.getConsumptionHorizon():"unknown"));const n={bookmark:s?"true":"false","x-ecs-etag":p.default.getCachedEcsConfigEtag()};return this.setConversationProperty(e,I.ConversationProps.ConsumptionHorizon,t,n)}setConversationAlerts(e,t){return this.setConversationProperty(e,I.ConversationProps.Alerts,t?"true":"false")}removeConversationIcon(e){return this.setThreadProperty(e,I.ThreadProps.Picture,null)}setThemeColor(e,t){return this.setConversationProperty(e,I.ConversationProps.Color,w.serializeColorInfo(t))}setJoinEnabled(e,t){return this.setThreadProperty(e,I.ThreadProps.JoinEnabled,t?"true":"false")}setMagicBotEnabled(e,t){return this.setThreadProperty(e,I.ThreadProps.MagicBotEnabled,t?"true":"false")}setBannedSkypeIds(e,t){const s=o.map(t,(e=>I.sanitizeMri(e,I.Namespaces.SkypeId)));return this.setThreadProperty(e,I.ThreadProps.BannedUserList,o.join(s,","))}discloseHistory(e,t){return this.setThreadProperty(e,I.ThreadProps.HistoryDisclosed,t?"true":"false")}setDisableGuestJoin(e,t){return this.setThreadProperty(e,I.ThreadProps.DisableAnonymousJoin,t?"true":"false")}setModeratedThreadProperty(e,t){return this.setThreadProperty(e,I.ThreadProps.ModeratedThread,t?"true":"false")}renameConversation(e,t){return this.setThreadProperty(e,I.ThreadProps.TopicName,t)}setConversationSubscription(e,t){return this.setConversationProperty(e,I.ConversationProps.Subscription,t).then((()=>this.setConversationAlerts(e,t!==I.SubscriptionTypes.Muted)))}setConversationArchived(e,t){return this.setConversationProperty(e,I.ConversationProps.Archived,t?Date.now():"")}setConversationPinned(e,t){return this.setConversationProperty(e,I.ConversationProps.Pinned,t?"true":"false")}setConversationFavorite(e,t){const s=this.setConversationProperty(e,I.ConversationProps.Favorite,t?"true":"false");return h.all([this.setConversationPinned(e,t),s]).then(o.noop)}setConversationStatus(e,t){return this.setConversationProperty(e,I.ConversationProps.ConversationStatus,k.ConversationStatus[t])}setConversationBlocked(e,t){return this.setConversationProperty(e,I.ConversationProps.ConversationBlocked,t?"true":"false")}setTranslationState(e,t){return I.isThread(e)?this.setThreadProperty(e,I.ThreadProps.Translated,g.TranslationState[t]):this.setConversationProperty(e,I.ConversationProps.Translated,g.TranslationState[t])}setMessageTranslationLocale(e,t){const s=!t||o.isEmpty(t)?null:t;return I.isThread(e)?this.setThreadProperty(e,I.ThreadProps.MessageTranslationLocale,s):this.setConversationProperty(e,I.ConversationProps.MessageTranslationLocale,s)}fetchAndUpdateMyProperties(e){if(this._fetchAndUpdatePropertiesDeferred)return this._fetchAndUpdatePropertiesDeferred.promise();if(!e&&this._lastUserPropertiesUpdateTime){const e=p.default.getConfigSettingsNoSubscription().chat.userPropertiesExpirationTime;if(e&&Date.now()<this._lastUserPropertiesUpdateTime+e)return h.Resolved()}const t=h.Defer();return this._fetchAndUpdatePropertiesDeferred=t,this._fetchPropertiesPromise=this.serviceGetMyProperties(),this._fetchPropertiesPromise.finally((()=>{this._fetchPropertiesPromise=void 0})).then(this._updateMyPropertiesRequestSuccessHandler,this._updateMyPropertiesRequestFailureHandler),t.promise()}getChatServiceErrorResponseMetadata(e){return y.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(e)}performRequest(e,t){if(e.requiresEndpoint&&!N.default.endpointExists())return A.log(k.LogTraceArea.ChatService,"Trying to perform a request: "+e.scenario+" that requires an endpoint , when the endpoint does not exist!"),A.track(new G.DevDebug("CSRequestNoEndpoint",e.scenario)),h.Rejected(Y);if(p.default.getConfigSettingsNoSubscription().endpointPresence.ensurePresencePublished&&e.requirePresenceDocPublished&&!N.default.presenceDocPublished())return A.log(k.LogTraceArea.ChatService,"Trying to perform a request: "+e.scenario+" that requires presence doc to be published"),A.track(new G.DevDebug("CSRequestPresenceDocNotPublished",e.scenario)),h.Rejected(Z);const s={telemetryAttributes:t,scenario:e.scenario,mriForTelemetry:e.mriForTelemetry,isLoginRequest:e.isLogin,isSkypetokenOnlyRequest:e.isSkypetokenOnlyRequest,counterPartyMri:e.counterPartyMri},i=p.default.getConfigSettingsNoSubscription().chat.msgApiConfig,o=i&&i.enabled;return e.isV1OnlyRequest||!o?this._restTransport.performRequest(e,s):this._messagingRestClient.performRequest(e,s)}performPostingServiceMessageRequest(e,t){const s={source:T.PostMessageToConversationSource[t]};return this.performRequest(e,s)}performRequestBackground(e,t,s,i){const n={};s.endpointId&&(n.endpointId=s.endpointId);const r=o.extend(n,i),a=p.default.getConfigSettingsNoSubscription().chat.msgApiConfig,l=a&&a.enabled;return s.isV1OnlyRequest||!l?this._restTransport.performRequestBackground(e,t,s,r):this._messagingRestClient.performRequestBackground(e,t,s,r)}serviceGetMyProperties(){return this.performRequest(b.getMyProperties()).then((e=>e.body))}serviceSetMyProperty(e,t){return this.performRequest(b.setMyProperty(e,t)).then(o.noop)}serviceSetUedPush(e){return this.serviceSetMyProperty(I.ServerUserProps.UedPushEnabled,e?"True":"false")}serviceSetMyUserRing(e){return this.performRequest(b.setMyUserRing(e)).then(o.noop)}serviceEnumerateEndpoints(){return this.performRequest(b.enumerateEndpoints()).then((e=>({endpoints:e.body,tcid:I.getTcidDataFromServerMessageResponse(e)})))}serviceCreateEndpoint(e){return this.performRequest(b.createEndpoint(e)).then((e=>{const t={CSScenario:b.CSRequestScenarios.createEndpoint};return{endpointId:this._getLastResourceIdFromServerMessageResponse(e,t),tcid:I.getTcidDataFromServerMessageResponse(e)}}))}serviceUpdateEndpoint(e,t){return this.performRequest(b.updateEndpoint(e,t)).then((e=>({endpoint:e.body,tcid:I.getTcidDataFromServerMessageResponse(e)})))}serviceDeleteEndpoint(e){return this.performRequest(b.deleteEndpoint(e)).then(o.noop)}serviceClearEndpoint(e){return this.performRequest(b.clearEndpoint(e)).then(o.noop)}servicePublishEndpointPresence(e,t){return this.performRequest(b.publishEndpointPresence(e,t)).then(o.noop)}serviceGetEndpointPresenceDoc(e){return this.performRequest(b.getEndpointPresenceDoc(e)).then((e=>e.body))}serviceCreateSubscription(e,t){return this.performRequest(b.createSubscription(e,t)).then((t=>{const s=I.getTcidDataFromServerMessageResponse(t),i={CSScenario:b.CSRequestScenarios.updateSubscription,Epid:e},o=this._getLastResourceIdFromServerMessageResponse(t,i);return o?{subscriptionId:o,tcid:s}:h.Rejected(t)}))}serviceDeleteSubscription(e,t){return this.performRequest(b.deleteSubscription(e,t)).then(o.noop)}serviceUpdateSubscriptionProperty(e,t,s,i){return this.performRequest(b.updateSubscriptionProperty(e,t,s,i)).then((e=>I.getTcidDataFromServerMessageResponse(e)))}servicePollSubscription(e,t,s){return this.performRequest(b.pollSubscription(e,t,s)).then((e=>e.body))}serviceGetMyConversations(e="All",t=1,s,i=100){return this.performRequest(b.getMyConversations(e,t,s,i)).then((e=>({body:e.body,headers:e.headers})))}_serviceSetConversationProperty(e,t,s,i){var n;(null===(n=p.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===n?void 0:n.enabled)&&(t=I.ConversationPropsMapping.mapToV2(t));const r=o.map(i,((e,t)=>"&"+encodeURIComponent(t)+"="+encodeURIComponent(e))).join(""),a="v1/users/ME/conversations/"+encodeURIComponent(e)+"/properties?name="+encodeURIComponent(t)+r;return this.performRequest({method:"PUT",path:a,passedData:{[t]:s},scenario:"setConversationProperty"}).then(o.noop)}serviceGetConversationMessages(e,t=1,s,i=100,o){let n="v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages?view="+encodeURIComponent(b.calcMessagesViewParam());return n+="&pageSize="+Math.min(i,100),s&&(n+="&syncState="+encodeURIComponent(s)),n+="&startTime="+t,o&&o<=W.NumberShim.MAX_SAFE_INTEGER&&(n+="&endTime="+o),this.performRequest({method:"GET",path:n,scenario:"getConversationMessages"}).then((e=>e.body))}serviceGetConversationMessagesEarlierThanTime(e,t=1,s,i=100,o=Number.MAX_VALUE){return this._serviceLoopConversationMessagesEarlierThanTime(e,t,o,s,i,[],0)}_serviceLoopConversationMessagesEarlierThanTime(e,t,s,i,n,r,a){return this.serviceGetConversationMessages(e,t,i,n,s).then((i=>{i.messages.length&&r.push(i.messages);const l=a+i.messages.length;if(l<n&&i._metadata.backwardLink){const a=i.messages.length?Number(o.minBy(i.messages,(e=>e.version)).version):s,d=I.decodeSyncState(i._metadata.syncState);return this._serviceLoopConversationMessagesEarlierThanTime(e,t,a,d,n,r,l)}return{messages:o.flatten(r),_metadata:i._metadata}}))}serviceGetConversationMessagesLaterThanTime(e,t,s,i,o=100,n=!1){return n?this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,s,void 0,i,o):this._serviceLoopConversationMessagesLaterThanTime(e,t,s,i,o,[],0)}_serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,s,i,n,r=100){return this.serviceGetConversationMessages(e,t,n,r,s).then((a=>{if(a.messages.length){if(a.messages.length<r&&!a._metadata.backwardLink)return a;{const i=Math.min(Number(o.maxBy(a.messages,(e=>e.version)).version)+2,s),l=Math.floor((i+t)/2),d=s;return this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,l,d,n,r)}}if(a._metadata.backwardLink){const o=I.decodeSyncState(a._metadata.syncState);return this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,s,i,o,r)}if(i){const t=s,o=i<=W.NumberShim.MAX_SAFE_INTEGER?Math.floor((i+s)/2):i;return this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,o,i,n,r)}return a}))}_serviceLoopConversationMessagesLaterThanTime(e,t,s,i,n,r,a){return this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,s,void 0,i,n).then((i=>{if(i.messages.length){r.push(i.messages);const l=a+i.messages.length;if(l<n){const a=i.messages.length?Number(o.maxBy(i.messages,(e=>e.id)).id):t,d=I.decodeSyncState(i._metadata.syncState);return this._serviceLoopConversationMessagesLaterThanTime(e,a,s,d,n,r,l)}}return{messages:o.flatten(r),_metadata:i._metadata}}))}serviceGetConversationMessage(e,t){return this.performRequest(b.getConversationMessage(e,t)).then((e=>e.body))}servicePostMessageToConversation(e,t,s,i=b.CSRequestScenarios.postMessageToConversation){const o={source:T.PostMessageToConversationSource[s]},n=this._getP2PThreadCounterPartyMri(e),r=b.postMessageToConversation(e,t,i,n);return this.performRequest(r,o).then((e=>{const t={CSScenario:b.CSRequestScenarios.postMessageToConversation},s=this._getLastResourceIdFromServerMessageResponse(e,t);return Object.assign(Object.assign({},e),{body:{serverId:s}})}))}_shouldCreateThreadForMri(e){const t=p.default.getConfigSettingsNoSubscription().chat.msgApiConfig;return!!(null==t?void 0:t.enabled)&&(t.enableP2PThreadsWithUsers&&I.isSkypeIdMri(e)||t.enableP2PThreadsWithBots&&I.isBotChat(e)||t.enableP2PThreadsWithPstn&&I.isPhoneMri(e)||t.enableP2PThreadsWithS4B&&I.isS4BBridgeMri(e))}createThreadIfNeeded(e,t){if(this._shouldCreateThreadForMri(e)){const s=(0,P.default)().getV2ThreadMapping().getThreadIdByMri(e);return A.log(k.LogTraceArea.ChatService,`[p2p chats] Does p2p thread exist already: ${Boolean(s)}`),s?h.Resolved({threadId:s}):this._createP2PThread(e,t)}return h.Resolved({threadId:e})}_createP2PThread(e,t){const s=B.default.getSkypeMri(),i=T.CreateThreadSource.CreateP2PChat,o={[s]:W.ThreadMemberAccessType.Admin,[e]:W.ThreadMemberAccessType.Admin};return this.serviceCreateThread(o,undefined,i,{},t,!0).then((e=>f.default.waitForJoinedKnowledgeOfConversation(e.threadId))).then((e=>(A.log(k.LogTraceArea.ChatService,`[p2p chats] Created p2p chat: ${e.id}`),{threadId:e.id})))}_getP2PThreadCounterPartyMri(e){var t;if(!(null===(t=p.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===t?void 0:t.enabled))return;const s=(0,P.default)().getConversation(e);if(s)return s.isV2OneToOneThread()?(0,P.default)().getV2ThreadMapping().getMriByThreadId(e):void 0;A.log(k.LogTraceArea.ChatService,`[p2p chats] Conversation not found in conversations store: ${e}`)}serviceDeleteMessage(e,t){const s=b.deleteMessage(e,t);return this.performRequest(s)}serviceSetMessageProperty(e,t,s,i,n=!1){const r={propKey:s},a=b.setMessageProperty(e,t,s,i,n);return this.performRequest(a,r).then(o.noop)}serviceSetMessagePropertyBackground(e,t,s,i,o,n,r=!1,a){return this.performRequestBackground(e,t,b.setMessageProperty(s,i,o,n,r),a)}_getAddMembersPartialFailures(e){return 207===e.statusCode&&e.body&&e.body.multipleStatus?o.filter(e.body.multipleStatus,(e=>0!==e.statusCode)):[]}serviceCreateThread(e,t,s,i={[I.ThreadProps.HistoryDisclosed]:"true",[I.ThreadProps.JoinEnabled]:"true"},n,r=!1){const a=p.default.getS4LMessagingFeaturesNoSubscription().retryAddMembersToThread,l={source:T.CreateThreadSource[s]};i[I.ThreadProps.ThreadType]&&(l[I.ThreadProps.ThreadType]=i[I.ThreadProps.ThreadType]),i[I.ThreadProps.Source]&&(l.Partner=i[I.ThreadProps.Source]);const d=b.createThread(e,t,r,i);return n&&(d.scenario=n),this.performRequest(d,l).then((e=>{const t=I.asSkypeThreadId(this._getLastResourceIdFromServerMessageResponse(e,{CSScenario:"createThread"})),s=this._getAddMembersPartialFailures(e);if(a&&s.length){const e={};return o.each(s,(t=>e[t.id]=W.ThreadMemberAccessType.User)),this.serviceAddMembersToThread(t,e,!1).then((e=>({threadId:t,failedMembers:e})))}return{threadId:t,failedMembers:s}}))}serviceGetThread(e){return this.performRequest(b.getThread(e)).then((e=>e.body))}_serviceSetThreadProperty(e,t,s){var i;if(!I.isThread(e))return h.Rejected("ID passed isn't a thread");(null===(i=p.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===i?void 0:i.enabled)&&(t=I.ThreadPropsMapping.mapToV2(t));const n={propKey:t},r=b.setThreadProperty(e,t,s);return this.performRequest(r,n).then(o.noop)}serviceAddMemberToThread(e,t,s,i=!0){const o={source:T.AddMemberToThreadSource[s]},n=b.addMemberToThread(e,t,i);return this.performRequest(n,o).then((()=>{A.track(new L.AddContactsTelemetry(s,e))}),(o=>i?this.serviceAddMemberToThread(e,t,s,!1):h.Rejected(o)))}serviceAddMembersToThread(e,t,s=!1,i,n){const r=b.addMembersToThread(e,t);return n&&(r.scenario=n),this.performRequest(r,i).then((t=>{const i=this._getAddMembersPartialFailures(t);if(s&&i.length){const t={};return o.each(i,(e=>t[e.id]=W.ThreadMemberAccessType.User)),this.serviceAddMembersToThread(e,t,!1)}return i}))}serviceRemoveMemberFromThread(e,t,s){const i={source:T.RemoveMemberFromThreadSource[s]},o=b.removeMemberFromThread(e,t);return this.performRequest(o,i).then((()=>{if(B.default.isMyMri(t)){const t=(0,P.default)().getConversation(e);if(t){const s=t.getLastJoinAt();s&&this.setConversationLeaveTimeLie(e,String(s+1))}}})).catch((e=>404===e.statusCode&&e.errorCode&&736===e.errorCode?h.Resolved():h.Rejected(e)))}serviceDeleteConversation(e,t){var s;if(null===(s=p.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===s?void 0:s.enabled)return this.setConversationProperty(e,I.ConversationPropsV2.DeleteTimestamp,Date.now());const i={source:T.DeleteConversationSource[t]},n=b.deleteConversation(e);return this.performRequest(n,i).then(o.noop)}serviceAddNewContact(e,t){const s={source:T.AddNewContactSource[t]},i=b.addNewContact(e);return this.performRequest(i,s).then(o.noop)}serviceInvokeAgent(e,t,s,i,o){const n={source:T.InvokeAgentSource[i]},r=b.invokeAgentRequest(e,t,s,o);return this.performRequest(r,n).then((e=>e.body))}serviceGetWebhookUrl(e,t){const s=b.getWebhookUrl(e,t);return this.performRequest(s).then((e=>e.body))}_serviceGetMemberConsumptionHorizons(e){return this.performRequest(b.getMemberConsumptionHorizons(e)).then((e=>e.body.consumptionhorizons))}_getLastResourceIdFromServerMessageResponse(e,t){const s=e.headers.location;if(!s){const s=I.getTcidDataFromServerMessageResponse(e),i=Object.assign({CSContextId:s.contextId,CSDate:s.date,StatusCode:e.statusCode},t);return A.track(new G.DevDebug("Empty location header",JSON.stringify(i))),""}return decodeURIComponent(o.last(s.split("/")))}serviceSendE2eeInvite(e,t,s,i){const o=b.e2eeInvite(s,e,t);return this.performRequest(o)}serviceSendE2eeReject(e){const t=b.e2eeReject(e);return this.performRequest(t)}serviceSendE2eeAccept(e,t,s){const i=b.e2eeAccept(s,e,t);return this.performRequest(i)}serviceSendE2eeConfirm(e){const t=b.e2eeConfirm(e);return this.performRequest(t)}serviceDeleteConnectors(e,t){const s=b.deleteConnectors(e,t);return this.performRequest(s).then(o.noop)}test_getRestTransport(){return this._restTransport}test_getTransport(){const e=p.default.getConfigSettingsNoSubscription().chat.msgApiConfig;return e&&e.enabled?this._messagingRestClient:this._restTransport}test_setPushSubscription(e){this._pushSubscription=e}test_reset(){this._loggingOut=!1,N.default.test_reset();const e=this._subscriptions;this._subscriptions=[],o.each(e,(e=>e.unsubscribe())),this._tokenStoreSubToken&&(q.default.unsubscribe(this._tokenStoreSubToken),this._tokenStoreSubToken=void 0),this._appConfigSubToken&&(p.default.unsubscribe(this._appConfigSubToken),this._appConfigSubToken=void 0),this._capabilitiesSubToken&&(m.default.unsubscribe(this._capabilitiesSubToken),this._capabilitiesSubToken=void 0),this._connectivitySubToken&&(D.default.unsubscribe(this._connectivitySubToken),this._connectivitySubToken=void 0),this._stateStoreSubToken&&(V.default.unsubscribe(this._stateStoreSubToken),this._stateStoreSubToken=void 0)}}},476621:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(174958),o=s(496486),n=s(974634),r=s(397691),a=s(559294),l=s(142826),d=s(889391),c=s(63413),h=s(260021),u=s(351077),p=s(890239),g=s(609959),m=s(671830),S=s(562141),f=s(465848),y=s(185455),v=s(362843),C=s(36763),_=s(125793),b=s(470942),T=s(579041),M=s(746096),I=s(897811),w=s(657347),P=s(436237),k=s(998754),A=s(861253),x=s(994847),R=s(51470),O=s(178735),L=s(18078),F=s(496856),B=s(112692),D=s(422538),E=s(404057),V=s(640363),N=s(478262),U=s(626712),j=s(853374);t.default=new class{constructor(){this._lastFetchedTimestamp=N.NumberShim.MAX_SAFE_INTEGER,this._userProperties={},this.userPropertiesChanged=new n.default,this.messagesProcessed=new n.default,this.messagesProcessedWithBundleInfo=new n.default,this.conversationsUpdated=new n.default,this.alertsUpdated=new n.default,this.decryptionFailed=new n.default,this.callLogsReceived=new n.default,this.guestNameUpdate=new n.default,this._conversationMetaMap={},this._conversationMetaLoadPromises={},this._conversationIdsToEnsureLoaded=[],this._waitingForJoinedKnowledgeList={},this._waitingForJoinedAndRealKnowledgeList={},this._bundleProcessingEnabled=!0,this._alertsTrackedByAlertsStore=[],this._ensureConversationsLoadedDebounced=o.debounce((()=>{const e=this._conversationIdsToEnsureLoaded;this._conversationIdsToEnsureLoaded=[],P.log(M.LogTraceArea.GenericUnsafe,"Ensuring Conversations Loaded: "+o.join(o.map(e,(e=>i.pii.Mri(e))),", ")),this.getConversationMetasAsync(e).then((()=>{if(this._ensureConvLoadedDefer){const e=this._ensureConvLoadedDefer;this._ensureConvLoadedDefer=void 0,e.resolve(void 0)}}))})),this._setUpPendingBundle(),D.RegisterStartupable(this,"ChatServiceDataService",[c.default,T.default,k.default])}startup(){return this._userProperties=k.default.getData(S.InternalKeys.Prefs)||{},r.Resolved()}test_flushConversationCache(){this.conversationsUpdated.dispose(),this.messagesProcessed.dispose(),this.messagesProcessedWithBundleInfo.dispose(),this._loadingNeedsSyncConversationsPromise=void 0,this._conversationMetaMap={}}loadAndCacheAllNonHighlightsConversations(){const e=Date.now()-y.ConversationHistoryTimeSpanImportant;let t;return this._loadAndCacheAllConversationsPromise||(this._loadAndCacheAllConversationsPromise=S.default.getAllNonHighlightConversationMetas().then((t=>{this._lastFetchedTimestamp=Math.min(e,this._lastFetchedTimestamp),this._cacheLoadedConvs(t)})),t=this._loadAndCacheAllConversationsPromise,this._loadAndCacheAllConversationsPromise.finally((()=>{this._loadAndCacheAllConversationsPromise=void 0}))),t||this._loadAndCacheAllConversationsPromise}recalculateCountsForConversations(e){return o.each(e,(e=>{this._queueRecalculateConversationCounts(e)})),this.processQueuedBundle()}loadAndCacheNeedsSyncConversations(){return this._loadingNeedsSyncConversationsPromise||(this._loadingNeedsSyncConversationsPromise=S.default.openTransaction([S.Stores.Conversations],!1).then((e=>e.getNeedsSyncConversations().then((t=>{e.markCompleted(),this._cacheLoadedConvs(t)}))))),this._loadingNeedsSyncConversationsPromise}setAlertsTrackedByAlertsStore(e){this._alertsTrackedByAlertsStore=e}_cacheLoadedConvs(e){e=o.compact(e),o.isEmpty(e)||(o.remove(e,(e=>e.conv&&e.conv.id in this._conversationMetaMap)),o.each(e,(e=>{this._conversationMetaMap[e.conv.id]=e})),this.conversationsUpdated.fire(e))}_checkJoinedConvUpdates(e){o.each(e,(e=>{if(!e)return;const t=this._waitingForJoinedKnowledgeList[e.conv.id];t&&e&&e.conv.isCurrentUserMember()&&(delete this._waitingForJoinedKnowledgeList[e.conv.id],t.resolve(e.conv));const s=this._waitingForJoinedAndRealKnowledgeList[e.conv.id];s&&e&&e.conv.isCurrentUserMember()&&!e.conv.isFake&&(delete this._waitingForJoinedAndRealKnowledgeList[e.conv.id],s.resolve(e.conv))}))}createFakeConversation(e){if(this._conversationMetaMap[e])return;const t=y.default.newFakeEmptyMeta(e);this._conversationMetaMap[e]=t,this.conversationsUpdated.fire([t])}ensureConversationLoadedOrFaked(e){return this.getConversationMetaAsync(e).then((t=>!t&&(this.createFakeConversation(e),!0)))}ensureConversationLoaded(e){return this.getConversationMetaFromMemoryCache(e)?r.Resolved():(this._conversationIdsToEnsureLoaded.push(e),this._ensureConvLoadedDefer||(this._ensureConvLoadedDefer=r.Defer()),this._ensureConversationsLoadedDebounced(),this._ensureConvLoadedDefer.promise())}waitForJoinedKnowledgeOfConversation(e){return this.getConversationMetaAsync(e).then((t=>t&&t.conv.isCurrentUserMember()?r.Resolved(t.conv):(this._waitingForJoinedKnowledgeList[e]||(this._waitingForJoinedKnowledgeList[e]=r.Defer()),this._waitingForJoinedKnowledgeList[e].promise())))}waitForJoinedKnowledgeOfRealConversation(e){return this.getConversationMetaAsync(e).then((t=>t&&t.conv.isCurrentUserMember()&&!t.conv.isFake?r.Resolved(t.conv):(this._waitingForJoinedAndRealKnowledgeList[e]||(this._waitingForJoinedAndRealKnowledgeList[e]=r.Defer()),this._waitingForJoinedAndRealKnowledgeList[e].promise())))}getUserProperties(){return this._userProperties}getUserProperty(e){return this._userProperties[e]}hasFetchedUserPropertiesAtLeastOnce(){return!o.isEmpty(this._userProperties)}getConversationMetaAsync(e,t){return this.getConversationMetasAsync([e],t).then((t=>t[e]))}getConversationMetasAsync(e,t){const s=o.uniq(o.filter(e,(e=>!(e in this._conversationMetaMap)))),i=!t,[n,a]=o.partition(s,(e=>i&&this._conversationMetaLoadPromises[e])),l=o.map(n,(e=>{const t=this._conversationMetaLoadPromises[e];if(t)return t.then(o.noop);a.push(e)}));if(a.length>0){const e=(t?t.getConversationMetas(a):S.default.getConversationMetas(a)).then((e=>{const t=o.values(e);return this._cacheLoadedConvs(t),this._checkJoinedConvUpdates(t),o.each(a,(e=>{e in this._conversationMetaMap||(this._conversationMetaMap[e]=void 0);this._conversationMetaLoadPromises[e]&&delete this._conversationMetaLoadPromises[e]})),e}));o.each(a,(t=>{t in this._conversationMetaMap||(this._conversationMetaLoadPromises[t]=e.then((e=>e[t])))})),l.push(e.then(o.noop))}return r.all(l).then((()=>{const t={};return o.each(e,(e=>{t[e]=this._conversationMetaMap[e]})),t}))}getLastFetchedTimestamp(){return this._lastFetchedTimestamp}getConversationMetaFromMemoryCache(e){return this._conversationMetaMap[e]}getRawConversationMetaMemoryCache(){return this._conversationMetaMap}setBundleProcessingEnabled(e){this._bundleProcessingEnabled=e}processQueuedBundle(){return this._processBundle()}queueConvUpdate(e){const t=this._getPendingBundleConv(e.id);(!t.conversationUpdate||t.conversationUpdate.version<e.version)&&(t.conversationUpdate=e)}queueThreadUpdate(e){const t=this._getPendingBundleConv(e.id);(!t.threadUpdate||t.threadUpdate.version<e.version)&&(t.threadUpdate=e)}queueConvSyncInfoChange(e,t,s=!1){this._getPendingBundleConv(e).syncInfo=t}queueMessagesForConversation(e,t){const s=this._getPendingBundleConv(e);s.messageActions||(s.messageActions={}),o.each(t,(t=>{this._addServerMessageToPendingBundle(e,t)}))}queueMessagesForConversationAndWait(e,t){return this.queueMessagesForConversation(e,t),this._processBundle()}queuePartialUserPropertySet(e){let t;t=this._pendingBundle&&this._pendingBundle.newUserPropSet?this._pendingBundle.newUserPropSet:this._processingBundle&&this._processingBundle.newUserPropSet?this._processingBundle.newUserPropSet:this._userProperties;const s=o.extend({},t,e);(0,A.default)(this._pendingBundle.newUserPropSet||this._userProperties,s)||(this._pendingBundle.newUserPropSet=s)}queueMemberConsumptionHorizonUpdate(e,t){const s=this._getPendingBundleConv(e);s.memberConsumptionHorizons||(s.memberConsumptionHorizons={}),s.memberConsumptionHorizons[t.id]=t}setConvSyncInfo(e,t){return this.queueConvSyncInfoChange(e,t),this._processBundle()}setNewUserPropertySet(e){return e?(delete e.lastActivityAt,delete e.lastActivityAt2,(0,A.default)(this._pendingBundle.newUserPropSet||this._userProperties,e)?r.Resolved():(this._pendingBundle.newUserPropSet=e,this._processBundle())):r.Resolved()}setConvListSyncInfo(e){return this._pendingBundle.convListSyncInfo=e,this._processBundle()}brickConversation(e){return this._getPendingBundleConv(e).brickConversation=!0,this._processBundle()}setConversationPropertyLie(e,t,s,i){const o=this._getPendingBundleConv(e),n={value:s,additionalParams:i};return o.conversationPropLieInfo?o.conversationPropLieInfo[t]=n:o.conversationPropLieInfo={[t]:n},this._processBundle()}confirmConversationPropertyLie(e,t,s,i){const o=this._getPendingBundleConv(e),n={value:s,additionalParams:i};return o.conversationPropLieConfirms?o.conversationPropLieConfirms[t]=n:o.conversationPropLieConfirms={[t]:n},this._processBundle()}revertConversationPropertyLie(e,t,s,i){const o=this._getPendingBundleConv(e),n={value:s,additionalParams:i};return o.conversationPropLieReverts?o.conversationPropLieReverts[t]=n:o.conversationPropLieReverts={[t]:n},this._processBundle()}getLastConversationPropertyLie(e,t){const s=this._getPendingBundleConv(e);return s.conversationPropLieInfo&&s.conversationPropLieInfo[t]}setThreadPropertyLie(e,t,s){const i=this._getPendingBundleConv(e),o={value:s};return i.threadPropLieInfo?i.threadPropLieInfo[t]=o:i.threadPropLieInfo={[t]:o},this._processBundle()}confirmThreadPropertyLie(e,t,s){const i=this._getPendingBundleConv(e),o={value:s};return i.threadPropLieConfirms?i.threadPropLieConfirms[t]=o:i.threadPropLieConfirms={[t]:o},this._processBundle()}revertThreadPropertyLie(e,t,s){const i=this._getPendingBundleConv(e),o={value:s};return i.threadPropLieReverts?i.threadPropLieReverts[t]=o:i.threadPropLieReverts={[t]:o},this._processBundle()}processPushNotificationMessage(e,t,s,i){const o={message:e,origin:s,isOtherEndpointActive:!e.isactive,correlationVector:i,messageStoreUsed:!1};return this._addServerMessageToPendingBundle(t,o),this._processBundle()}processPushNotificationConsumptionHorizon(e,t,s){if(this._conversationMetaMap[e]&&s&&s<=this._conversationMetaMap[e].conv.convViewVersion)return r.Resolved();const i=this._getPendingBundleConv(e);return i.consumptionHorizonVersion&&s&&s<=i.consumptionHorizonVersion?r.Resolved():(i.consumptionHorizonUpdate=t,i.consumptionHorizonVersion=s,this._processBundle())}confirmMessageSend(e,t,s,o,n,r){P.log(M.LogTraceArea.ChatService,"confirmMessageSend: convId:"+i.pii.Mri(t)+" cuid:"+s+" serverId:"+o+" clientMessageId:"+n),d.default.getS4LMessagingFeaturesNoSubscription().enableFastMessageSendSuccessPropagation&&this.notifyMessageSend(e,t,o,n,r);const a=this._getPendingBundleConvMessageActions(t,s);return a.confirmSendId=o,a.confirmSendCMID=n,a.confirmSendVersion=r,this._processBundle()}notifyMessageSend(e,t,s,i,o){if(e.skypeeditedid)return;const n=this.getConversationMetaFromMemoryCache(t),r=Math.max(Date.now(),n?n.conv.getTimestamp()+1:0);let a=B.default.fromFirstLie(e,t,L.default.getSkypeMri(),r);a=a.acknowledgeMessageLie(i,s,o);const l={message:a,reactionUpdates:p.EmptyReactionsUpdate,isOtherEndpointActive:!1,details:[{origin:M.MessageOrigin.LocalChange,clientMessageId:i,correlationVector:void 0,messageStoreUsed:void 0}]};this.messagesProcessed.fire([l.message],a.cuid),this.messagesProcessedWithBundleInfo.fire([l])}rejectMessageSend(e,t,s,o){const n=m.getCuidForMessage(t);P.log(M.LogTraceArea.ChatService,"rejectMessageSend: convId:"+i.pii.Mri(e)+" cuid:"+n);const r=this._getPendingBundleConvMessageActions(e,n);return r.rejectSendCMID=t.clientmessageid,r.rejectSendTimestamp=s,r.rejectSendRetryInfo=o,this._processBundle()}applyMessageLie(e,t){return R.default.notifyMessageLieReachedChatServiceDataService(t.clientmessageid),this._applyMessageLie(e,t)}applyMessageLieWithPropertyLie(e,t,s,i){return this._applyMessageLie(e,t,s,i)}markMessageAsReported(e,t,s){return this._getPendingBundleConvMessageActions(e,t).isReported=s,this._processBundle()}applyMessageLieAndNotifyPrematurely(e,t,s){R.default.notifyMessageLieReachedChatServiceDataService(s.clientmessageid);const o={message:B.default.fromFirstLie(s,e,L.default.getSkypeMri(),t),reactionUpdates:p.EmptyReactionsUpdate,isOtherEndpointActive:!1,details:[{origin:M.MessageOrigin.LocalChange,clientMessageId:s.clientmessageid,correlationVector:void 0,messageStoreUsed:void 0}]};return P.log(M.LogTraceArea.ChatService,`Sending premature message lie. ConvId: ${i.pii.Mri(e)} clientmessageid: ${s.clientmessageid}`),this.messagesProcessed.fire([o.message]),this.messagesProcessedWithBundleInfo.fire([o]),this._applyMessageLie(e,s)}_applyMessageLie(e,t,s,o){const n=m.getCuidForMessage(t);P.log(M.LogTraceArea.ChatService,"applyMessageLie: convId:"+i.pii.Mri(e)+" cuid:"+n);const r=this._getPendingBundleConvMessageActions(e,n);return r.applyMessageLies?r.applyMessageLies.push(t):r.applyMessageLies=[t],s?this.setMessagePropertyLie(e,n,s,o):this._processBundle()}revertMessageLie(e,t,s){const i=this._getPendingBundleConvMessageActions(e,t);return i.revertMessageLies?i.revertMessageLies.push(s):i.revertMessageLies=[s],this._processBundle()}setMessagePropertyLie(e,t,s,i){const o=this._getPendingBundleConvMessageActions(e,t);return o.setPropDeltas?o.setPropDeltas.push({key:s,value:i}):o.setPropDeltas=[{key:s,value:i}],this._processBundle()}revertMessagePropertyLie(e,t,s,i){const o=this._getPendingBundleConvMessageActions(e,t);return o.revertPropDeltas?o.revertPropDeltas.push({key:s,value:i}):o.revertPropDeltas=[{key:s,value:i}],this._processBundle()}setFileEncryptionKeys(e,t,s){return this._getPendingBundleConvMessageActions(e,t).fileEncryptionKeys=s,this._processBundle()}_setUpPendingBundle(){this._pendingBundle={}}_getPendingBundleConv(e){this._pendingBundle.convs||(this._pendingBundle.convs={});let t=this._pendingBundle.convs[e];return t||(t={},this._pendingBundle.convs[e]=t),t}_getPendingBundleConvMessageActions(e,t){const s=this._getPendingBundleConv(e);s.messageActions||(s.messageActions={});let i=s.messageActions[t];return i||(i={},s.messageActions[t]=i),i}_addServerMessageToPendingBundle(e,t){const s=m.getCuidForMessage(t.message);if(m.isEncryptedThread(e)){const e=t.message;if(_.default.shouldIgnoreMessage(e))return}const i=this._getPendingBundleConvMessageActions(e,s);i.serverMessages?i.serverMessages.push(t):i.serverMessages=[t]}_queueRecalculateConversationCounts(e){this._getPendingBundleConv(e).recalculateCounts=!0}test_processServerMessage(e,t=M.MessageOrigin.LongPoll,s=void 0){const i=o.isArray(e)?e:[e];return o.each(i,(e=>{const i=m.getParsedConversationId(e);if(i){const o={message:e,origin:t,isOtherEndpointActive:!1,messageStoreUsed:s};this._addServerMessageToPendingBundle(i,o)}})),this._processBundle()}_preProcessBundle(e){const t=[];return o.each(e.convs,((e,s)=>{if(m.isAllGlobalClearMri(s)||!m.isEncryptedThread(s))return;const i=[];o.each(e.messageActions,((e,t)=>{const n=[],a=[];o.each(e.serverMessages,(e=>{const i=e.message.messagetype,l=i===u.MessageTypes.EncryptedText,d=i===u.MessageTypes.EncryptedMedia,c=i===u.MessageTypes.EncryptedCall;if(!l&&!d&&!c)return;const h=e.message,p=h.fromdeviceid,g=h.content,f=h.encryptedkey,y=c?u.MessageTypes.Call:i;if(p&&f){let i,l;n.push(this.getConversationMetaAsync(s).then((n=>n?(i=n.conv.getLastEncryptionHandshakeChange(),l=Number(h.id),i&&l&&i>l?(a.push(e),void P.log(M.LogTraceArea.E2EEncryption,`Discarding CMID(${h.clientmessageid}), it's from older secure session`)):S.default.getMessageByCuid(n.conv.id,t).then((s=>{const i=m.getCreatorMriForMessageFromLink(h.from),l=L.default.isMyMri(i);if(s){if(l)return void(e.message=Object.assign(Object.assign({},e.message),{content:s.content,messagetype:y}));if(s.isKnownServerMessageVersion(e.message.version))return P.log(M.LogTraceArea.E2EEncryption,`Ignoring already known server message version ${e.message.version} for CMID ${h.clientmessageid}`),void a.push(e)}else if(l)return P.log(M.LogTraceArea.E2EEncryption,`Ignoring own server message with unprocessed lie, CMID ${h.clientmessageid}`),void a.push(e);return v.default.decryptMessageForConv(n.conv,g,f).then((s=>{let i;if(d){const e=E.default.parseJsonErrorable(s);if(o.isError(e))return r.Rejected(e);i=e.originalContent,this.setFileEncryptionKeys(n.conv.id,t,e)}else i=s;e.message=Object.assign(Object.assign({},e.message),{content:i,messagetype:y})}))}))):r.Rejected(`No meta found for conv id ${s}`))).catch((t=>{if(_.default.isFatalDecryptionError(t)){const e=E.default.errorAsString(t);P.error(M.LogTraceArea.E2EEncryption,`Failed to decrypt message, CMID(${h.clientmessageid}, arrival ts ${l}, handshake ts ${i}),`,e),P.track(new C.E2eeDecryptionFailure(e)),this.decryptionFailed.fire(s)}else P.log(M.LogTraceArea.E2EEncryption,`Non-fatal error decrypting message, probably a dupe, CMID(${h.clientmessageid}),`,E.default.errorAsString(t));a.push(e)})))}})),i.push(r.all(n).then((()=>{e.serverMessages=o.difference(e.serverMessages,a),o.isEmpty(e.serverMessages)&&delete e.serverMessages})))})),t.push(r.all(i).then((()=>{e.messageActions&&(e.messageActions=o.omitBy(e.messageActions,(e=>o.isEmpty(e))))})))})),r.all(t).then(o.noop)}_processBundle(){if(this._processingBundle||!this._bundleProcessingEnabled)return this._pendingBundle.deferral||(this._pendingBundle.deferral=r.Defer()),this._pendingBundle.deferral.promise();if(o.isEmpty(this._pendingBundle.convs)&&!this._pendingBundle.convListSyncInfo&&!this._pendingBundle.newUserPropSet)return r.Resolved();this._processingBundle=this._pendingBundle;const e=this._processingBundle;e.deferral||(e.deferral=r.Defer());const t=e.deferral;this._setUpPendingBundle();const s=Date.now();return P.log(M.LogTraceArea.ChatService,"Starting ProcessBundle: "+o.keys(e.convs).length+" Convs"+(e.convListSyncInfo?", ConvListSyncInfo":"")+(e.newUserPropSet?", NewUserPropSet":"")),w.default.indicateBusyOperation(),this._preProcessBundle(e).then((()=>{const n=[S.Stores.Conversations,S.Stores.Messages,S.Stores.InternalData,S.Stores.Alerts];return e.convs&&V.default.getCallLogMri()in e.convs&&n.push(S.Stores.CallLogs),S.default.openTransaction(n,!0).then((n=>{const v=Date.now(),C=[],_=[],T=new x.default((e=>e.guid)),w=[],A=[],R=this.getConversationMetasAsync(o.keys(e.convs),n),D=o.map(e.convs,((e,t)=>{if(m.isAllGlobalClearMri(t))return;if(!m.isMri(t))return void P.error(M.LogTraceArea.ChatService,"Attempted to process a conversation with an invalid mri: "+i.pii.Mri(t));P.log(M.LogTraceArea.ChatService,"Processing ConvBundle: "+i.pii.Mri(t)+": "+o.compact([e.messageActions?o.keys(e.messageActions).length+" MessageActions":void 0,e.conversationUpdate?"ConversationUpdate":void 0,e.conversationPropLieInfo?o.keys(e.conversationPropLieInfo).length+" ConversationPropLieInfo":void 0,e.conversationPropLieConfirms?o.keys(e.conversationPropLieConfirms).length+" ConversationPropLieConfirms":void 0,e.conversationPropLieReverts?o.keys(e.conversationPropLieReverts).length+" ConversationPropLieReverts":void 0,e.threadUpdate?"ThreadUpdate":void 0,e.threadPropLieInfo?o.keys(e.threadPropLieInfo).length+" ThreadPropLieInfo":void 0,e.threadPropLieConfirms?o.keys(e.threadPropLieConfirms).length+" ThreadPropLieConfirms":void 0,e.threadPropLieReverts?o.keys(e.threadPropLieReverts).length+" ThreadPropLieReverts":void 0,e.syncInfo?"SyncInfo":void 0,e.brickConversation?"Brick":void 0,e.recalculateCounts?"RecalculateCounts":void 0]).join(", "));const s=R.then((e=>e[t])),c=e.conversationUpdate&&e.conversationUpdate.lastMessage&&m.getCuidForMessage(e.conversationUpdate.lastMessage),S=o.keys(e.messageActions);c&&!o.includes(S,c)&&S.push(c);const v=S.length?n.getMessagesByCuid(t,S):void 0,k=e.messageActions?n.getAlertsForConversation(t):void 0;return r.all([s,v,k]).then((([s,S,v])=>{let k=s?s.conv:void 0,x=!1,R=!1;const D=o.keyBy(S,(e=>e.cuid));let E=!!v;v&&T.trackOriginalItems(v.concat(this._alertsTrackedByAlertsStore));const V=[];let N=e.syncInfo||(s?s.syncInfo:void 0),U=!1;const j=e.conversationUpdate;if(j){let e;j.properties&&j.properties[m.ConversationProps.ConsumptionHorizon]&&P.log(M.LogTraceArea.ConsumptionHorizon,"Merging CH: "+j.properties[m.ConversationProps.ConsumptionHorizon]),c&&(e=D[c]),k?(P.log(M.LogTraceArea.ChatService,"Merging Conversation: "+i.pii.Mri(j.id)+", Version: "+k.convViewVersion+" => "+j.version+(k.isThread()?", ThreadVersion: "+k.getThreadProperty(m.ThreadProps.ThreadDetailsVersion)+" => "+j.threadProperties[m.ThreadProps.ThreadDetailsVersion]:"")),k=k.mergeConversationUpdate(j,e)):(P.log(M.LogTraceArea.ChatService,"New Conversation from ConvView: "+i.pii.Mri(j.id)+": Version: "+j.version+(m.isThread(j.id)?", ThreadVersion: "+j.threadProperties[m.ThreadProps.ThreadDetailsVersion]:"")),k=F.default.fromRawConversation(j,e)),x=!0}const H=[],z=e.threadUpdate;if(z&&(k?(P.log(M.LogTraceArea.ChatService,"Merging Thread: "+i.pii.Mri(z.id)+", Details Version: "+k.threadDetailsVersion+" => "+z.version),U=0!==k.threadDetailsVersion&&z.properties[m.ThreadProps.HistoryDisclosed]!==k.getThreadProperty(m.ThreadProps.HistoryDisclosed),k=k.mergeThreadUpdate(z)):(P.log(M.LogTraceArea.ChatService,"New Conversation from Thread: "+i.pii.Mri(z.id)+", Details Version: "+z.version),k=F.default.fromRawThread(z))),!k){if(e.consumptionHorizonUpdate&&!e.messageActions&&!e.brickConversation)return void P.log(M.LogTraceArea.ChatService,"Skipped creating empty conversation from CH push: "+i.pii.Mri(t));P.log(M.LogTraceArea.ChatService,"New Conversation from Nothing: "+i.pii.Mri(t)),k=F.default.newFakeEmptyConversation(t)}if(o.each(e.conversationPropLieConfirms,((e,t)=>{k=k.confirmConvPropertyLieApplied(t,e.value,e.additionalParams)})),o.each(e.conversationPropLieReverts,((e,t)=>{k=k.revertConvPropertyLie(t,e.value,e.additionalParams)})),o.each(e.conversationPropLieInfo,((e,t)=>{k=k.setConvPropertyLie(t,e.value,e.additionalParams)})),o.each(e.threadPropLieConfirms,((e,t)=>{k=k.confirmThreadPropertyLieApplied(t,e.value)})),o.each(e.threadPropLieReverts,((e,t)=>{k=k.revertThreadPropertyLie(t,e.value)})),o.each(e.threadPropLieInfo,((e,t)=>{k=k.setThreadPropertyLie(t,e.value)})),e.consumptionHorizonUpdate&&(k=k.mergeConsumptionHorizonPush(e.consumptionHorizonUpdate,e.consumptionHorizonVersion)),e.brickConversation&&(k=k.brickConversation(),N={messagesStale:!1,messagesSyncState:void 0,messageHistoryStartTime:Number.MAX_VALUE}),e.memberConsumptionHorizons&&(k=k.mergeMemberConsumptionHorizons(o.values(e.memberConsumptionHorizons))),e.messageActions){this._remapCallEndedEventMessage(e.messageActions,D);let s=0;o.each(e.messageActions,((e,i)=>{let n;i in D&&(n=D[i]);let r=n,l=M.MessageOrigin.LocalChange,c=!1;const p=[];if(o.each(e.serverMessages,(e=>{if(l=e.origin,c=c||e.isOtherEndpointActive,p.push({origin:e.origin,clientMessageId:e.message.clientmessageid,correlationVector:e.correlationVector,messageStoreUsed:e.messageStoreUsed}),r)r=r.applyServerMessage(e.message);else if(r=B.default.fromFirstServerMessage(e.message),!r)return;if(l===M.MessageOrigin.PushNotification&&P.track(new I.FundamentalsMessagePushDebug(r.getLatestRelevantClientMessageId()||"",h.getCorrelationIdForMessage(r),"ServerMessageApplied")),m.isCallLog(t)){const e=u.getJsonFromMessageProperty(r.properties,"call-log");e?(e.messageCuid=r.cuid,w.push(e),P.log(M.LogTraceArea.Calling,`Accepted calllog ${e.callId} state: ${e.callState} direction:${e.callType}`)):P.warn(M.LogTraceArea.Calling,"Expected message with property: call-log")}})),o.isEmpty(p)&&p.push({origin:l,clientMessageId:r&&r.getLatestRelevantClientMessageId()||void 0,correlationVector:void 0,messageStoreUsed:void 0}),o.each(e.applyMessageLies,(e=>{r?r=r.applyMessageForPostingLie(e):(s=(s||Math.max(Date.now(),k.getTimestamp()))+1,r=B.default.fromFirstLie(e,t,L.default.getSkypeMri(),s))})),r){if(o.each(e.revertMessageLies,(e=>{r=r.revertMessageForPostingLie(e)})),o.each(e.setPropDeltas,(e=>{r=r.applyPropertyLie(e.key,e.value)})),o.each(e.revertPropDeltas,(e=>{r=r.revertPropertyLie(e.key,e.value)})),e.confirmSendId&&e.confirmSendCMID&&(r=r.acknowledgeMessageLie(e.confirmSendCMID,e.confirmSendId,e.confirmSendVersion)),e.rejectSendTimestamp&&e.rejectSendCMID&&(r=r.rejectMessageSend(e.rejectSendCMID,e.rejectSendTimestamp,e.rejectSendRetryInfo)),r&&m.isConciergeBotMri(r.creator)){const e=d.default.getEngagementFeatures();let t=!1;if(e.conciergeBotSettings.enableVisibility){const s=O.default.getUserPreferencesLocalNoSubscription(),i=s.enablePushEngagementNotifications&&s.enableInAppEngagementNotifications,n=o.some(e.conciergeBotSettings.allowedRecentMessageTypes,(e=>r&&e===r.messagetype));t=!i&&n}if(o.some(e.conciergeBlockedMessageTypes,(e=>r&&e===r.messagetype))||t)return void P.track(new b.EngagementMessageTelemetryEvent({eventType:b.EngagementMessageTelemetryEventType.ChatServiceBlockedMessage,messageType:r.messagetype,messageCorrelationId:h.getCorrelationIdFromMessageParts(r.creator,r.conversationId,r.cuid)}))}if(e.fileEncryptionKeys&&(r=r.addFileKeyMaterial(e.fileEncryptionKeys)),o.isUndefined(e.isReported)||(r=r.markAsReported(e.isReported)),r!==n&&k.getDeletedTimestamp()<r.createdTime){const e={message:r,isOtherEndpointActive:c,reactionUpdates:r.getReactionUpdates(n),messageAlreadySeen:!!n,details:p};_.push(e),u.isGuestNameUpdateMessageType(r.messagetype)&&A.push(r),u.isCaptionMessageType(r.messagetype)||(V.push(r),k=k.mergeMessageLocal(r,!1)),a.calcAlertsForUpdatedMessage(k,r,T),o.some(p,(e=>e.origin===M.MessageOrigin.PushNotification))&&P.track(new I.FundamentalsMessagePushDebug(r.getLatestRelevantClientMessageId()||"",h.getCorrelationIdForMessage(r),"MessageUpdatePushed"))}else{const e=M.MessageOrigin[l]+(r===n?", NoChange":"");l===M.MessageOrigin.LocalChange&&r===n||P.track(new I.FundamentalsDebugEvent("MessageNotUpdated",e))}}else P.error(M.LogTraceArea.ChatService,"Somehow we are working on a message that we can't get a local version of...")}))}if(V.length>0&&H.push(n.putMessages(V)),k.lastMessage&&!k.lastMessage.isShownInPreview(k.isTranslated())){const e=k.lastMessage.isReported();R=!e,H.push(this._getLastDisplayableMessage(Number.MAX_VALUE,n,k,_).then((e=>{k&&(e?(P.log(M.LogTraceArea.ChatService,`Bumped lastMessage for ${i.pii.Mri(k.id)} back to ${e.createdTime}`),k=k.mergeMessageLocal(e,!0)):(P.log(M.LogTraceArea.ChatService,`Removed lastMessage ${k.lastMessage&&k.lastMessage.cuid} for ${i.pii.Mri(k.id)}`),k=k.dropLastMessage()))})))}if(e.conversationUpdate&&k.isDeleted()){const e=n.getMessagesForConversationBeforeTime(k.id,k.getDeletedTimestamp(),void 0,!1).then((e=>n.removeMessages(e)));H.push(e)}return r.all(H).then((()=>{const a=k.lastMessage,d=a&&a.getLatestServerMessageVersion(),c=Math.max(d&&Number(d)||0,k.getTimestamp())>Date.now()-m.RecentMessageHistoryTimePeriod,h=k.isCurrentUserMember();if(s&&s.syncInfo&&!s.conv.isCurrentUserMember()&&h&&(N=void 0),N){const e=k&&k.isHistoryDisclosed(),s=U&&e?Math.max(N.messageHistoryStartTime,k.getThreadProperty(m.ThreadProps.LastJoinAt)||Number.MAX_VALUE):N.messageHistoryStartTime;if(!N.messagesStale&&x&&(c||R)){const e=c?p.MessagesStaleReason.NeedSync:p.MessagesStaleReason.ReceivedUnreconciledEdit;P.log(M.LogTraceArea.ChatService,"Need new messages sync for conv "+i.pii.Mri(t)+", messagesStaleReason: "+p.MessagesStaleReason[e]),N={messagesStale:!0,messagesStaleReason:e,messagesSyncState:N.messagesSyncState,messageHistoryStartTime:s}}else U&&e&&(P.log(M.LogTraceArea.ChatService,"History was "+(e?"disclosed":"hidden")+" for conv "+i.pii.Mri(t)),N={messagesStale:!0,messagesStaleReason:p.MessagesStaleReason.HistoryDisclosedChanged,messagesSyncState:N.messagesSyncState,messageHistoryStartTime:s})}else if(h){let e;c?e=p.MessagesStaleReason.NeedSync:R?e=p.MessagesStaleReason.ReceivedUnreconciledEdit:this._isConversationPossiblyUnread(k)&&(e=p.MessagesStaleReason.ConversationPossiblyUnread);const s=void 0!==e;P.log(M.LogTraceArea.ChatService,"No syncInfo for conv "+i.pii.Mri(t)+", messagesStale: "+s.toString()+", messagesStaleReason: "+(void 0===e?"undefined":p.MessagesStaleReason[e])),N={messagesStale:s,messagesStaleReason:e,messagesSyncState:void 0,messageHistoryStartTime:Number.MAX_VALUE}}else N={messagesStale:!1,messagesSyncState:void 0,messageHistoryStartTime:Number.MAX_VALUE};const u=s?s.updateConversationAndSyncInfo(k,N):y.default.firstTimeMeta(k,N,void 0);return f.calculateCountsForConversation(u,!!e.messageActions||!!e.recalculateCounts,n).then((e=>{e.earlyExit||P.log(M.LogTraceArea.ChatService,"Calculated counts: "+i.pii.Mri(t)+": "+e.msg);const a=u.updateCounts(e.counts);if(s&&s.syncInfo.messagesStaleReason===p.MessagesStaleReason.ConversationPossiblyUnread&&N&&!N.messagesStale){const e=!(!a.counts||!a.counts.hasUnread);P.log(M.LogTraceArea.ChatService,"Got counts for possibly unread conversation: "+i.pii.Mri(t)+"; Has unread messages: "+(e?"Yes":"No"));const s=new g.ChatServiceForceSyncConversationEvent("ConversationPossiblyUnread",e);P.track(s)}else if(s&&s.syncInfo.messagesStaleReason===p.MessagesStaleReason.ReceivedUnreconciledEdit&&N&&!N.messagesStale){const e=new g.ChatServiceForceSyncConversationEvent("ReceivedUnreconciledEdit",!0);P.track(e)}const d=!!s&&(s.conv.isCurrentUserMember()&&!s.conv.isDeleted()),c=!(a.conv.isCurrentUserMember()&&!a.conv.isDeleted())&&d,h=!!a.counts&&(!s||!s.counts||a.counts&&a.counts.consumptionHorizonTimestamp!==s.counts.consumptionHorizonTimestamp);let m;return m=E||!c&&!h?r.Resolved():n.getAlertsForConversation(a.conv.id).then((e=>{E=!0,T.trackOriginalItems(e.concat(this._alertsTrackedByAlertsStore))})),m.then((()=>{if(c&&o.each(T.getAllItems(),(e=>{e.message&&e.message.conversationId===t&&T.deleteItem(e)})),h){const e=o.filter(T.getAllItems(),(e=>!!e.message&&e.message.conversationId===t&&e.alertType===l.AlertType.HighPriorityMessage&&!!e.isRead!=e.message.createdTime<=a.counts.consumptionHorizonTimestamp));o.each(e,(e=>{const t=e.applyRead(e.message.createdTime<=a.counts.consumptionHorizonTimestamp);T.updateItem(t)}))}a!==s&&C.push(a)}))}))}))}))}));let E;r.all(D).then((()=>{E=Date.now();const i=[];if(C.length>0){i.push(n.putConversationMetas(C));const e={};o.each(C,(t=>{const s=t.conv.getConversationBlocked();void 0!==s&&(e[t.conv.id]=s)})),o.isEmpty(e)||i.push(c.default.internal_updateConversationBlockStatus(e,n))}const a=T.getDeltas();return a.deletes.length>0&&i.push(n.removeAlerts(a.deletes)),(a.adds.length>0||a.updates.length>0)&&i.push(n.putAlerts(a.adds.concat(o.map(a.updates,(e=>e.updated))))),e.newUserPropSet&&i.push(k.default.putData(S.InternalKeys.Prefs,e.newUserPropSet,n)),e.convListSyncInfo&&i.push(k.default.putData(S.InternalKeys.ConversationListSyncInfo,e.convListSyncInfo,n)),o.isEmpty(w)||i.push(n.putCallLogs(w)),r.all(i).then((()=>{o.each(C,(e=>{this._conversationMetaMap[e.conv.id]=e}));const i=[];e.newUserPropSet&&(o.each(this._userProperties,((t,s)=>{this._userProperties[s]!==e.newUserPropSet[s]&&i.push(s)})),o.each(e.newUserPropSet,((e,t)=>{t in this._userProperties||i.push(t)})),this._userProperties=e.newUserPropSet);const r=v-s,l=E-v,d=Date.now()-E,c=l+d;if(P.log(M.LogTraceArea.ChatService,"Finished Processing Bundle: "+c+"ms ("+r+"ms OpenTransLock, "+l+"ms Processing, "+d+"ms Persisting): "+o.compact([C.length?C.length+" ConvMetas":void 0,_.length?_.length+" Messages":void 0,a.adds.length?a.adds.length+" New Alerts":void 0,a.updates.length?a.updates.length+" Changed Alerts":void 0,a.deletes.length?a.deletes.length+" Deleted Alerts":void 0,i.length?i.length+" UserPropKeys":void 0]).join(", ")),C.length>0&&(this.conversationsUpdated.fire(C,n),this._checkJoinedConvUpdates(C)),_.length>0){const e=o.map(_,(e=>e.message));this.messagesProcessedWithBundleInfo.fire(_),this.messagesProcessed.fire(e)}(a.adds.length>0||a.updates.length>0||a.deletes.length>0)&&this.alertsUpdated.fire(a),e.newUserPropSet&&this.userPropertiesChanged.fire(i),o.isEmpty(w)||this.callLogsReceived.fire(w),A.length>0&&this.guestNameUpdate.fire(A),t.resolve(void 0)}))})).catch((e=>{this._handleBundlingError(t,e,"processing")})).finally((()=>{this._finishProcessingBundle()}))}))})).catch((e=>{this._handleBundlingError(t,e,"PreProcessing"),this._finishProcessingBundle()})),t.promise()}_getLastDisplayableMessage(e,t,s,i){return t.getMessagesForConversationBeforeTime(s.id,e,25,!1).then((e=>{if(0===e.length)return r.Resolved(void 0);const n=o.map(o.filter(i,(e=>e.message.conversationId===s.id)),(e=>e.message)),a=o.filter(e,(e=>!o.find(n,(t=>t.cuid===e.cuid)))),l=o.filter([...n,...a],(e=>e.isShownInPreview(s.isTranslated())));if(l.length>0){const e=o.maxBy(l,(e=>e.createdTime));return r.Resolved(e)}{const o=Math.min.apply(Math,e.map((e=>e.createdTime)));return this._getLastDisplayableMessage(o-1,t,s,i)}}))}_handleBundlingError(e,t,s){const i="Error "+s+" bundle: "+E.default.errorAsString(t);P.error(M.LogTraceArea.ChatService,i),P.track(new g.ChatServiceBundleProcessingErrorEvent(i)),e.reject(t)}_finishProcessingBundle(){this._processingBundle=void 0,this._processBundle()}_isBundleActionable(e,t){return t||!!e.serverMessages||!!e.applyMessageLies}_remapCallEndedEventMessage(e,t){o.each(o.keys(e),(s=>{const i=e[s];if(!i.serverMessages)return;const n=i.serverMessages;o.each(n,(t=>{if(void 0===t)return;if(!u.isEventCallEndedMessageType(t.message))return;t.message=Object.assign(Object.assign({},t.message),{skypeeditedid:void 0,clientmessageid:j.default.newClientMessageId()});const r=m.getCuidForMessage(t.message);if(s===r)return;P.log(M.LogTraceArea.ChatService,`_remapCallEndedEventMessage moving end call event message from ${s} to ${r}`);r in e||(e[r]=Object.assign(Object.assign({},i),{serverMessages:[]}));const a=e[r];a.serverMessages||(a.serverMessages=[]),a.serverMessages.push(t),o.pull(n,t)})),o.isEmpty(n)&&(delete e[s].serverMessages,this._isBundleActionable(e[s],!!t[s])||(delete e[s],P.log(M.LogTraceArea.ChatService,`_remapCallEndedEventMessage removing bundle from ${s} since it is not actionable.`)))}))}_isConversationPossiblyUnread(e){if(e&&e.lastMessage){if(m.isConciergeBotMri(e.id))return!1;if(m.isHiddenBotMri(e.id))return!1;const t=e.getConsumptionHorizon(),s=m.getCuidFromConsumptionHorizon(t);if("0"!==s){const i=e.lastMessage.getOriginalClientMessageId();return!(m.getServerTimestampFromConsumptionHorizon(t)>=e.lastMessage.createdTime)&&(!!i&&s!==i)}}return!1}getChatServiceHost(){const e=this.getUserProperty(m.ServerUserProps.UserRing),t=o.isUndefined(e)?void 0:p.UserRing[o.toNumber(e)]||e;return t?t===p.UserRing.PROD?U.default.getHost(d.default.getConfigSettingsNoSubscription().chat.productionHost):U.default.getHost(d.default.getConfigSettingsNoSubscription().chat.dogfoodHost):void 0}}},36593:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChatServiceErrorHandler=t.RetryAfterTimer=t.BackoffTimerWrapper=t.ChatServiceErrorTypes=void 0;const i=s(174958),o=s(496486),n=s(662783),r=s(397691),a=s(889391),l=s(609959),d=s(671830),c=s(746096),h=s(436237),u=s(17791),p=s(666765),g=s(912770),m=s(994214),S=s(236533);var f;!function(e){e[e.EndpointMissing=0]="EndpointMissing",e[e.LocationChanged=1]="LocationChanged",e[e.InvalidRegToken=2]="InvalidRegToken",e[e.AuthenticationFailure=3]="AuthenticationFailure",e[e.TooManyRequests=4]="TooManyRequests",e[e.LoginRateLimitExceeded=5]="LoginRateLimitExceeded",e[e.LoginRequestError=6]="LoginRequestError",e[e.SkypeTokenRevoked=7]="SkypeTokenRevoked"}(f=t.ChatServiceErrorTypes||(t.ChatServiceErrorTypes={}));const y="Unknown";class v{constructor(e,t){this._exponentialTimer=e,this._debugName=t,this._backoffMinTime=0,this._bumpCount=0}reset(){this._exponentialTimer.reset(),this._backoffMinTime=0,this._bumpCount=0}getPromise(){return Date.now()>=this._backoffMinTime?r.Resolved(void 0):(this._waitingForBackoff||(this._waitingForBackoff=r.Defer()),this._waitingForBackoff.promise())}bumpTimer(e){const t=Date.now()+this._exponentialTimer.getTimeAndCalculateNext();t>this._backoffMinTime&&(this._backoffMinTime=t,h.log(c.LogTraceArea.ChatServiceTransport,e+": "+this._debugName+" : Backing off until "+new Date(this._backoffMinTime)),this._checkBackoff()),this._bumpCount++}getBackoffMinTime(){return this._backoffMinTime}getBumpCount(){return this._bumpCount}_checkBackoff(){this._isSleepingUntilMinTime||(this._isSleepingUntilMinTime=!0,g.default.sleepUntil(this._backoffMinTime).then((()=>{if(this._isSleepingUntilMinTime=!1,Date.now()<this._backoffMinTime)this._checkBackoff();else if(this._waitingForBackoff){h.log(c.LogTraceArea.ChatServiceTransport,this._debugName+" timer reset, firing blocked requests.");const e=this._waitingForBackoff;this._waitingForBackoff=void 0,e.resolve(void 0)}})))}test_getTimer(){return this._exponentialTimer}test_setBackoffMinTime(e){this._backoffMinTime=e}}t.BackoffTimerWrapper=v;class C{constructor(){this._retryAfter={}}addBackoff(e,t){this._retryAfter[e]=Date.now()+t*S.SECOND,h.log(c.LogTraceArea.ChatService,`[${C.TAG}] Retry '${e}' in ${t} seconds`)}getPromise(e){const t=e.scenario,s=this._retryAfter[t];if(!s)return r.Resolved();if(Date.now()>=s)return delete this._retryAfter[t],r.Resolved();const i=s-Date.now();h.log(c.LogTraceArea.ChatService,`[${C.TAG}] Retry timer promise will resolve in ${i} ms`);const o=r.Defer();return setTimeout((()=>{h.log(c.LogTraceArea.ChatService,`[${C.TAG}] Retry timer promise resolved`),o.resolve(void 0)}),i),o.promise()}}C.TAG="retry-after",t.RetryAfterTimer=C;class _{constructor(e,t){this._handleLocationChange=e,this._handleInviteFreeQuarantine=t}getSkypetokenFromHeaders(e){const t=e.Authentication;return d.getSkypetokenFromAuthenticationHeader(t)}getRegistrationTokenFromHeaders(e){const t=e.RegistrationToken;return d.getRegistrationTokenFromHeader(t)?t:void 0}augmentErrorResponse(e,t){e.statusText=e.headers.statustext;let s="";if(!t&&e.body){const t=e;t.body.errorCode&&(t.errorCode=t.body.errorCode),t.body.message&&(t.errorMessage=t.body.message),s=", Body: "+t.errorCode+"/"+t.errorMessage}h.log(c.LogTraceArea.ChatService,"Chat Service Response: "+e.statusCode+"/"+e.statusText+i.pii.Omit(s)+", ContextId: "+e.headers.contextid+", Date: "+e.headers.date)}static getChatServiceErrorResponseMetadata(e){var t;let s,i;return e&&(s=e.errorMessage||e.errorInfo,!s&&e.timedOut&&(s="Request timeout"),e.headers&&(e.headers["ms-cv"]?i=e.headers["ms-cv"]:e.headers["MS-CV"]&&(i=e.headers["MS-CV"]))),{contextId:e&&e.headers&&e.headers.contextid?e.headers.contextid:y,date:e&&e.headers&&e.headers.date?e.headers.date:y,retryAfter:null===(t=null==e?void 0:e.headers)||void 0===t?void 0:t["retry-after"],errorCode:e&&void 0!==e.errorCode?e.errorCode:-1,errorMessage:s||y,statusCode:e&&void 0!==e.statusCode?e.statusCode:-1,statusText:e&&e.statusText?e.statusText:y,msCv:i,canceled:null==e?void 0:e.canceled,timedOut:null==e?void 0:e.timedOut}}handleChatServiceFailure(e,t,s,i,n,r,g){const S=_.getChatServiceErrorResponseMetadata(t);h.warn(c.LogTraceArea.ChatService,e+": ChatServiceErrorHandler: Failed to perform chat service request "+r.scenario+". "+JSON.stringify(S)+" "+JSON.stringify(r.telemetryAttributes));const v=r.mriForTelemetry?d.getMriTypeForTelemetry(r.mriForTelemetry):void 0,{reportInternalFailures:C,reportUnknownInternalFailures:b,reportSystemExceptionInternalFailures:T,chatServiceRedirectTimerEnabled:M}=a.default.getConfigSettingsNoSubscription().chat,I=r.mriForTelemetry&&d.isGroupConversation(r.mriForTelemetry),w=u.default.isNetworkingAvailable();if(!t.statusCode||d.isRedirect(t)||d.isEndpointMissing(t)){if(S&&C&&w||I){const e=new l.ChatServiceInternalFailureEvent(r.scenario,v,r.telemetryAttributes,S,g,u.default.getNetworkType(),w),t=S.errorMessage===y,s=o.startsWith(S.errorMessage,"System.Exception");(t&&b||s&&T||!t&&!s||I)&&h.track(e)}}else h.track(new l.ChatServiceFailureEvent(r.scenario,v,r.telemetryAttributes,S,g));const P=d.getTcidDataFromServerMessageResponse(t);if(t&&t.errorCode===d.ChatServiceErrors.EndpointMissing&&n&&p.default.markEndpointMissing(n,P),d.isRedirect(t)){const s=d.getRedirectUrl(t);return h.warn(c.LogTraceArea.ChatService,e+": ChatServiceErrorHandler: Chat Service is redirecting us to another cloud: "+s),this._handleLocationChange(s,g,P),M&&_._redirectTimer.bumpTimer(e),f.LocationChanged}if(_._redirectTimer.reset(),401===t.statusCode||403===t.statusCode){let o=!1;if(t.statusText){const e=t.statusText.toLowerCase();0!==e.indexOf("invalid registration token")&&-1===e.indexOf("registrationtoken and/or cookie must be set")&&-1===e.indexOf("registration token is expired")||(o=!0)}if(t.errorCode===d.ChatServiceErrors.StaleUic&&(o=!0),o)return h.warn(c.LogTraceArea.ChatService,e+": ChatServiceErrorHandler: Chat Service doesn't like our registration token -- "+(i?"Nuking and waiting for it to refresh.":"We didn't send one, ")+" Skypetoken: "+(s?"Sent with request":"Not sent with request")),i&&p.default.markRegistrationTokenExpired(i),f.InvalidRegToken}if(401===t.statusCode&&!t.errorCode){let o=!1;if(t.statusText){-1!==t.statusText.toLowerCase().indexOf("skypetokenrevoked")&&(o=!0)}const n=o||s;if(h.warn(c.LogTraceArea.ChatService,e+"ChatServiceErrorHandler: Got 401 from request -- "+(n?"nuking skypetoken":i?"nuking registration token":"but no token provided")),n){if(m.default.skypeTokenInvalid(s),o)return f.SkypeTokenRevoked}else if(i)return p.default.markRegistrationTokenExpired(i),f.InvalidRegToken;return f.AuthenticationFailure}return 429===t.statusCode?t.errorCode===d.ChatServiceErrors.PerUserLoginLimitExceeded?(_._loginTimer.bumpTimer(e),f.LoginRateLimitExceeded):(this._handleRetryAfter(t,r)||_._429Timer.bumpTimer(e),f.TooManyRequests):(403===t.statusCode&&t.errorCode===d.ChatServiceErrors.QuarantineLimitExceeded&&this._handleInviteFreeQuarantine(),r.isLoginRequest?(_._loginTimer.bumpTimer(e),f.LoginRequestError):void 0)}_handleRetryAfter(e,t){var s;if(!(null===(s=a.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===s?void 0:s.enabled))return!1;const i=t.scenario,o=e.headers["retry-after"],n=o?Number(o):void 0;return n?(_._retryAfterTimer.addBackoff(i,n),!0):(h.log(c.LogTraceArea.ChatService,`[${C.TAG}] retry-after header was not set for scenario '${i}'`),!1)}getLoginTimer(){return _._loginTimer}get429Timer(){return _._429Timer}getRedirectTimer(){return _._redirectTimer}getRetryAfterTimer(){return _._retryAfterTimer}}_._429Timer=new v(new n.ExponentialTime(500,3e4),"429 timer"),_._loginTimer=new v(new n.ExponentialTime(500,1e5),"Login timer"),_._redirectTimer=new v(new n.ExponentialTime(500,6e4),"Redirect timer"),_._retryAfterTimer=new C,t.ChatServiceErrorHandler=_},483169:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(422801),r=s(671830),a=s(172685),l=s(861253),d=s(954416),c=s(666765),h=s(422538);t.default=new class{constructor(){this._checkState=()=>{if(this._blockUntilValidEndpointDefer&&this._hasPushEndpoint()){const e=this._blockUntilValidEndpointDefer;this._blockUntilValidEndpointDefer=void 0,e.resolve(void 0)}},this._cleanupPushEndpoints=()=>this._blockUntilValidEndpoint().then((()=>this._hasPushEndpoint()?n.default.serviceEnumerateEndpoints().then((e=>{const t=c.default.getEndpointInfo(),s=d.default.getPushTransportPath();return this._hasPushEndpoint(t,s)?o.all(i.map(e.endpoints,(o=>{if(r.areEndpointIdsEqual(o.id,t.id)){const t=r.findPushSubscriptionInfo(o.subscriptions),s=c.default.getEndpointInfo();if(s.pushSubscriptionId!==t.pushSubscriptionId||!(0,l.default)(s.pushSubscriptionParams,t.pushSubscriptionParams)){const s=i.assign({pushSubscriptionId:void 0,pushSubscriptionParams:void 0,reason:"Endpoint cleanup",tcid:e.tcid},t);c.default.updateEndpointInfo(s)}return}if(!o.subscriptions||1!==o.subscriptions.length)return;const a=r.findPushSubscriptionInfo(o.subscriptions).pushSubscriptionParams;if(a&&this._isValidPushSubscription(a)&&a.eventChannel===s){const e=r.formatEndpointId(o.id);return n.default.serviceDeleteEndpoint(e).catch(i.noop)}}))):o.Rejected()})).then(i.noop):o.Rejected())),h.RegisterStartupable(this,"ChatServicePushEndpointCleanupService",[n.default,d.default])}startup(){return c.default.endpointInfoChanged.subscribe(this._checkState),d.default.pushTransportPathChanged.subscribe(this._checkState),a.default.setRefreshOptions("ChatServicePushEndpointCleanupService",{interval:864e5,callback:this._cleanupPushEndpoints,taskTypeFlags:a.TaskTypeFlags.UsesNetworking}),o.Resolved()}_blockUntilValidEndpoint(){if(this._hasPushEndpoint())return o.Resolved();this._blockUntilValidEndpointDefer||(this._blockUntilValidEndpointDefer=o.Defer());const e=this._blockUntilValidEndpointDefer.promise();return this._checkState(),e}_hasPushEndpoint(e=c.default.getEndpointInfo(),t=d.default.getPushTransportPath()){return!!(e.exists&&e.id&&e.pushSubscriptionParams&&this._isValidPushSubscription(e.pushSubscriptionParams))&&!!t}_isValidPushSubscription(e){return e.channelType===r.ChannelTypes.PushNotification&&!!e.eventChannel}}},749868:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(426426),o=s(671830),n=s(954416),r=s(666765);class a extends i.default{constructor(e,t,s){super(e,t),this._interestedResources=s,n.default.pushTransportPathChanged.subscribe((()=>{this._updateDesiredParams()}));const i=r.default.getEndpointInfo();this._subscriptionInfoUpdated(a._getSavedSubInfo(i)),this._updateDesiredParams()}static _getSavedSubInfo(e){if(e.pushSubscriptionId)return{endpointId:e.id,subscriptionId:e.pushSubscriptionId,params:e.pushSubscriptionParams}}endpointInfoUpdated(e,t){this._subscriptionInfoUpdated(a._getSavedSubInfo(e)),super.endpointInfoUpdated(e,t)}_updateDesiredParams(){const e=n.default.getPushTransportPath();e&&this._setDesiredSubParameters(o.createPushSubscriptionParams("Skype4Life",e,this._interestedResources))}_subscriptionAllowed(){return!!n.default.getPushTransportPath()&&super._subscriptionAllowed()}_updateActiveSubscriptionInfo(e,t,s){super._updateActiveSubscriptionInfo(e,t,s),r.default.setPushSubscriptionInfo(e,t,s)}}t.default=a},859631:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RestoreEndpointStatus=void 0;const i=s(496486),o=s(267728),n=s(168950),r=s(397691),a=s(889391),l=s(746096),d=s(436237),c=s(666765),h=s(235478),u=s(994214);var p;!function(e){e[e.ChatServiceAndPushSubscriptionsRestored=0]="ChatServiceAndPushSubscriptionsRestored",e[e.ChatServiceSubscriptionOnlyRestored=1]="ChatServiceSubscriptionOnlyRestored",e[e.PushServiceSubscriptionOnlyRestored=2]="PushServiceSubscriptionOnlyRestored",e[e.FailedOrTimedOut=3]="FailedOrTimedOut",e[e.Unknown=4]="Unknown"}(p=t.RestoreEndpointStatus||(t.RestoreEndpointStatus={}));t.default=new class{restoreEndpoint(e,t,s){if(d.log(l.LogTraceArea.ChatService,"Received command to restore endpoints! ContextId: "+e),h.default.resume(),this._restoreEndpointDeferred)return d.log(l.LogTraceArea.ChatService,"Restore already in progress. Ignoring "+e),this._restoreEndpointDeferred.promise();const n=c.default.getEndpointInfo();this._restoreEndpointDeferred=r.Defer(),this._scenario=s,this._scenario.endpointMissing(n.id),n.id&&c.default.markEndpointMissing(n.id);const g=!u.default.hasUsableSkypeToken();u.default.skypeTokenInvalid(u.default.getRawSkypeToken()),u.default.performWhenValidSkypeTokenArrives().then((()=>(this._scenario&&this._scenario.gotSkypeToken(g),t.createOrUpdateEndpoint(n.id,n.ecsEtag||"").fail((e=>{this._scenario&&this._scenario.failed("Endpoint request failed",{statusCode:e.statusCode||"",contextId:e&&e.headers&&e.headers.contextid?e.headers.contextid:""})}))))).then((e=>{c.default.updateEndpointInfo(i.assign({},e,{reason:e.reason+" from restoreEndpoint"}))}));const m=o.default.requestMaxTime("RestoreEndpoint");return this._raceBackgroundTimer(this._restoreEndpointDeferred.promise(),a.default.getConfigSettingsNoSubscription().chat.restoreEndpointsTimeout).then((e=>{var t,s;if(this._restoreEndpointStatus=null!==(t=this._restoreEndpointStatus)&&void 0!==t?t:p.FailedOrTimedOut,this._scenario){if(e.timedOut){if(this._scenario.timedOut(),this._restoreEndpointDeferred){const e=this._restoreEndpointDeferred;this._restoreEndpointDeferred=void 0,e.reject(this._restoreEndpointStatus)}}else this._restoreEndpointStatus=null!==(s=e.result)&&void 0!==s?s:p.FailedOrTimedOut;this._scenario.finish()}return this._scenario=void 0,h.default.flush().then((()=>this._restoreEndpointStatus))})).always((e=>m.then((e=>o.default.release(e,"RestoreEndpoint"))).always((()=>e))))}endpointInfoUpdated(e,t){if(this._restoreEndpointDeferred&&(!t.exists&&e.exists&&this._scenario&&(this._scenario.endpointRestored(e.id),this._restoreEndpointStatus=p.ChatServiceSubscriptionOnlyRestored),!t.pushSubscriptionId&&e.pushSubscriptionId)){this._scenario&&this._scenario.pushSubscriptionRestored(e.pushSubscriptionId),this._restoreEndpointStatus=this._restoreEndpointStatus===p.ChatServiceSubscriptionOnlyRestored?p.ChatServiceAndPushSubscriptionsRestored:p.PushServiceSubscriptionOnlyRestored;const t=this._restoreEndpointDeferred;this._restoreEndpointDeferred=void 0,t.resolve(this._restoreEndpointStatus)}}_raceBackgroundTimer(e,t){const s=r.Defer(),i=n.default.setTimeout((()=>{s.resolve({timedOut:!0})}),t),o=e.then((e=>(n.default.clearTimeout(i),{timedOut:!1,result:e})));return r.race([o,s.promise()])}}},426426:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(174958),o=s(496486),n=s(583367),r=s(662783),a=s(36593),l=s(890239),d=s(671830),c=s(746096),h=s(436237),u=s(861253),p=s(916724),g=s(17791),m=s(666765),S=s(912770);t.default=class{constructor(e,t,s,i){this._restClient=e,this._subName=t,this._stateChangedCallback=s,this._longPollEventsCallback=i,this._checkStateRunning=!1,this._checkStateQueued=!1,this._exponentialTime=new r.ExponentialTime(1e3,3e5),this._dontCreateSubUntil=0,this._dontUpdateSubUntil=0,this._updateExponentialTime=new r.ExponentialTime(1e3,3e5),this._dontDeleteSubUntil=0,this._lastLongPollAttemptResult=l.LongPollResult.Success,this._dontLongPollUntil=0,this._longPollExponentialTime=new r.ExponentialTime(1e3,3e5),this._subscriptionState=l.SubscriptionState.None,this._checkState=()=>{this._checkStateKickTimer&&(S.default.clearTimeout(this._checkStateKickTimer),this._checkStateKickTimer=void 0),this._longPollEventsCallback&&(this._checkStateKickTimer=S.default.setTimeout((()=>{this._checkStateKickTimer=void 0,this._subscriptionAllowed()&&h.warn(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Kick Timer Activated..."),this._checkState()}),12e4)),this._checkStateRunning?this._checkStateQueued=!0:(this._checkStateRunning=!0,this._checkStateInner(),this._checkStateRunning=!1,this._checkStateQueued&&(this._checkStateQueued=!1,this._checkState()))},n.default.onResume.subscribe((e=>{h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" Resuming from sleep, kicking subscriptions causeId: "+e),this.cancelPendingLongPollRequest("DeviceUtilities.onResume"),this._resetBackoffs(),this._checkState()})),g.default.subscribe((()=>{g.default.isNetworkingAvailable()&&(this.cancelPendingLongPollRequest("Networking is available again"),this._resetBackoffs(),this._checkState())}));const o=m.default.getEndpointInfo();h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" started up with endpoint Info: "+d.encodeEndpointInfoForLog(o))}_subscriptionInfoUpdated(e){this._activeSub=e}endpointInfoUpdated(e,t){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" using new endpoint Info: "+d.encodeEndpointInfoForLog(e)),this._checkState()}_setDesiredSubParameters(e){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" got desired sub parameters: "+i.pii.Omit(JSON.stringify(e))),this._desiredSubParameters=e,this._checkState()}_subscriptionAllowed(){return m.default.endpointExists()?this._activeSub&&this._activeSub.endpointId!==m.default.getEndpointId()?(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" not allowed: Endpoint Id Mismatch"),!1):0!==this._desiredSubParameters.interestedResources.length||(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" not allowed: No interestedResources"),!1):(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" not allowed: Endpoint Doesn't exist"),!1)}_resetBackoffs(){this._dontCreateSubUntil=0,this._dontUpdateSubUntil=0,this._dontDeleteSubUntil=0,this._dontLongPollUntil=0,this._exponentialTime.reset(),this._updateExponentialTime.reset(),this._longPollExponentialTime.reset()}_updateActiveSubscriptionInfo(e,t,s){this._activeSub=e}_setState(e){this._subscriptionState!==e&&(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" state changed from: "+l.SubscriptionState[this._subscriptionState]+", to: "+l.SubscriptionState[e]),this._subscriptionState=e,this._stateChangedCallback&&this._stateChangedCallback(this._subscriptionState,this._lastLongPollAttemptResult))}_checkStateInner(){if(this._checkStateRerunTimer&&(S.default.clearExpiration(this._checkStateRerunTimer),this._checkStateRerunTimer=void 0),!this._desiredSubParameters)return void h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" skipping checkState: No Current Desired Subscription Parameters");if(!this._subscriptionAllowed()){if(this.cancelPendingLongPollRequest("subscription not allowed"),this._subscriptionCreationInFlight){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending subscription creation in flight");const e=this._subscriptionCreationInFlight;this._subscriptionCreationInFlight=void 0,e.cancel()}if(this._subscriptionUpdateInterestedResourcesInFlight){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending subscription update in flight");const e=this._subscriptionUpdateInterestedResourcesInFlight;this._subscriptionUpdateInterestedResourcesInFlight=void 0,e.cancel()}return this._activeSub?(this._setState(l.SubscriptionState.Deleting),this._subscriptionDeleteInFlight?void h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending subscription delete in flight"):this._dontDeleteSubUntil>Date.now()?void(this._checkStateRerunTimer=S.default.setExpiration(this._checkState,this._dontDeleteSubUntil)):void this._checkState_deleteSubscription()):void this._setState(l.SubscriptionState.None)}if(!this._activeSub||!(0,u.default)(o.omit(this._desiredSubParameters,"interestedResources"),o.omit(this._activeSub.params,"interestedResources"))){if(this._setState(l.SubscriptionState.Creating),this._subscriptionDeleteInFlight){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending subscription delete in flight for creation");const e=this._subscriptionDeleteInFlight;this._subscriptionDeleteInFlight=void 0,e.cancel()}if(this._subscriptionUpdateInterestedResourcesInFlight){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending subscription update in flight for creation");const e=this._subscriptionUpdateInterestedResourcesInFlight;this._subscriptionUpdateInterestedResourcesInFlight=void 0,e.cancel()}return this._subscriptionCreationInFlight?void h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending subscription creation in flight"):this._dontCreateSubUntil>Date.now()?void(this._checkStateRerunTimer=S.default.setExpiration(this._checkState,this._dontCreateSubUntil)):void this._checkState_createSubscription()}if(!(0,u.default)(this._desiredSubParameters.interestedResources,this._activeSub.params?this._activeSub.params.interestedResources:[])&&(this._subscriptionCreationInFlight?h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending subscription creation in flight"):this._subscriptionUpdateInterestedResourcesInFlight?h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending subscription update in flight"):this._dontUpdateSubUntil>Date.now()?this._checkStateRerunTimer=S.default.setExpiration(this._checkState,this._dontUpdateSubUntil):this._checkState_updateSubscriptionInterestedResources()),this._setState(this._lastLongPollAttemptResult===l.LongPollResult.Success?l.SubscriptionState.CreatedActive:l.SubscriptionState.CreatedLongPollTrouble),this._longPollEventsCallback){if(this._longPollInFlight)return void h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending long poll in flight");if(this._dontLongPollUntil>Date.now())return void(this._checkStateRerunTimer=S.default.setExpiration(this._checkState,this._dontLongPollUntil));this._checkState_startLongPoll()}}_checkState_deleteSubscription(){if(!m.default.endpointExists())return h.log(c.LogTraceArea.ChatServiceSubscriptions,"Endpoint missing, deleting subscription locally"),void this._updateActiveSubscriptionInfo(void 0,"Endpoint missing");h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" deleting subscription: "+this._activeSub.endpointId+"/"+this._activeSub.subscriptionId),this._subscriptionDeleteInFlight=this._restClient.serviceDeleteSubscription(this._activeSub.endpointId,this._activeSub.subscriptionId).then(o.noop),this._subscriptionDeleteInFlight.finally((()=>{this._subscriptionDeleteInFlight=void 0})).then((()=>{this.cancelPendingLongPollRequest("Delete subscription"),this._resetBackoffs(),h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" deleted subscription!"),this._updateActiveSubscriptionInfo(void 0,"Deleted subscription"),this._checkState()}),(e=>{e&&!e.canceled&&(404===e.statusCode?(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" failed to delete -- already missing!"),this._updateActiveSubscriptionInfo(void 0,"Failed to delete",d.getTcidDataFromServerMessageResponse(e))):403===e.statusCode?(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" access forbidden -- giving up!"),this._updateActiveSubscriptionInfo(void 0,"Access forbidden",d.getTcidDataFromServerMessageResponse(e))):(this._dontDeleteSubUntil=Date.now()+this._exponentialTime.getTimeAndCalculateNext(),0===e.statusCode?h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" Delete failed due to connectivity issues. Retrying at "+new Date(this._dontDeleteSubUntil)):h.warn(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Delete failure: "+e.statusCode+"/"+e.statusText+", "+e.errorCode+"/"+e.errorMessage+". Retrying at "+new Date(this._dontDeleteSubUntil))),this._checkState())}))}_checkState_createSubscription(){const e=m.default.getEndpointId(),t=this._desiredSubParameters;h.log(c.LogTraceArea.ChatServiceSubscriptions,"Creating subscription "+this._subName+". EndpointId: "+e+", Type: "+t.channelType+", Resources: "+i.pii.Omit(t.interestedResources.join(","))),this._subscriptionCreationInFlight=this._restClient.serviceCreateSubscription(e,t),this._subscriptionCreationInFlight.finally((()=>{this._subscriptionCreationInFlight=void 0})).then((s=>{this._resetBackoffs();const i=s.subscriptionId;h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Created: "+e+"/"+i),this._updateActiveSubscriptionInfo({endpointId:e,subscriptionId:i,params:t},"Subscription created",s.tcid),this._lastLongPollAttemptResult=l.LongPollResult.Success,this._checkState()}),(t=>{if(t&&!t.canceled)404===t.statusCode?(h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" failed to create -- Endpoint is missing!",a.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t)),m.default.markEndpointMissing(e,d.getTcidDataFromServerMessageResponse(t))):201===t.errorCode?h.error(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+": Bad request body on subscription creation. Err: ",a.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t)):(this._dontCreateSubUntil=Date.now()+this._exponentialTime.getTimeAndCalculateNext(),0===t.statusCode?h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" creation failed due to connectivity issues. Retrying at "+new Date(this._dontCreateSubUntil)):h.warn(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Creation failure: "+t.statusCode+"/"+t.statusText+", "+t.errorCode+"/"+t.errorMessage+". Retrying at "+new Date(this._dontCreateSubUntil))),this._checkState();else{const e=t&&t.canceled?"canceled":"no error";h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" failed to create -- "+e)}}))}_checkState_updateSubscriptionInterestedResources(){const e=m.default.getEndpointId(),t=this._desiredSubParameters;h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Updating. EndpointId: "+e+", Params: "+i.pii.Omit(JSON.stringify(t))),this._subscriptionUpdateInterestedResourcesInFlight=this._restClient.serviceUpdateSubscriptionProperty(e,this._activeSub.subscriptionId,"interestedResources",t.interestedResources),this._subscriptionUpdateInterestedResourcesInFlight.finally((()=>{this._subscriptionUpdateInterestedResourcesInFlight=void 0})).then((s=>{this._updateExponentialTime.reset(),this._activeSub?(h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Updated: "+e+"/"+this._activeSub.subscriptionId),this._updateActiveSubscriptionInfo({endpointId:e,subscriptionId:this._activeSub.subscriptionId,params:t},"Subscription property updated",s)):h.warn(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Updated with dead activeSub"),this._checkState()}),(t=>{t.canceled||(404===t.statusCode?(h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" failed to update -- Endpoint is missing!",a.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t)),m.default.markEndpointMissing(e,d.getTcidDataFromServerMessageResponse(t))):(this._dontUpdateSubUntil=Date.now()+this._updateExponentialTime.getTimeAndCalculateNext(),0===t.statusCode?h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" update failed due to connectivity issues. Retrying at "+new Date(this._dontUpdateSubUntil)):h.warn(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Update failure: "+t.statusCode+"/"+t.statusText+", "+t.errorCode+"/"+t.errorMessage+". Retrying at "+new Date(this._dontUpdateSubUntil))),this._checkState())}))}cancelPendingLongPollRequest(e){if(this._longPollInFlight){h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending long poll in flight: "+e);const t=this._longPollInFlight;this._longPollInFlight=void 0,t.cancel()}}_checkState_startLongPoll(){this._lastLongPollAttemptResult!==l.LongPollResult.Success&&h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" attempting long poll while in recovery mode...");const e=this._activeSub.endpointId,t=Date.now();let s;this._longPollInFlight=this._restClient.servicePollSubscription(e,this._activeSub.subscriptionId,this._lastLongPollAckId),this._longPollInFlight.finally((()=>{s=Date.now()-t,this._longPollInFlight=void 0})).then((e=>{const t=new p.KpiLongPoll(e&&e.eventMessages||[],s);h.track(t),this._longPollExponentialTime.reset(),this._lastLongPollAttemptResult!==l.LongPollResult.Success&&(h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" long poll recovered"),this._lastLongPollAttemptResult=l.LongPollResult.Success),e&&e.eventMessages&&e.eventMessages.length>0&&(this._longPollEventsCallback(e.eventMessages),this._lastLongPollAckId=o.maxBy(e.eventMessages,(e=>e.id)).id),this._checkState()})).catch((t=>{if(t.canceled&&!t.timedOut)return;h.log(c.LogTraceArea.ChatServiceSubscriptions,"_checkState_startLongPoll error:",a.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t));const i=new p.KpiLongPollFailure(t.statusCode,s);h.track(i),450===t.errorCode?(h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" backing subscription has gone away. Recreating."),this._updateActiveSubscriptionInfo(void 0,"Longpoll 450",d.getTcidDataFromServerMessageResponse(t))):201===t.errorCode||729===t.errorCode?(h.log(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" failure that indicates that the endpoint is gone. Recreating the endpoint...",a.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t)),this._updateActiveSubscriptionInfo(void 0,"Longpoll 201 or 729",d.getTcidDataFromServerMessageResponse(t)),m.default.markEndpointMissing(e,d.getTcidDataFromServerMessageResponse(t))):(this._lastLongPollAttemptResult=0===t.statusCode?l.LongPollResult.FailureExternal:l.LongPollResult.FailureErrorCode,this._dontLongPollUntil=Date.now()+this._longPollExponentialTime.getTimeAndCalculateNext(),0===t.statusCode?h.log(c.LogTraceArea.ChatServiceSubscriptions,this._subName+" poll failed due to connectivity issues. Retrying at "+new Date(this._dontLongPollUntil)):h.warn(c.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Poll failure: "+t.statusCode+"/"+t.statusText+", "+t.errorCode+"/"+t.errorMessage+". Retrying at "+new Date(this._dontLongPollUntil))),this._checkState()}))}}},581697:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(174958),o=s(496486),n=s(516778),r=s(662783),a=s(974634),l=s(397691),d=s(300060),c=s(889391),h=s(63413),u=s(422801),p=s(476621),g=s(890239),m=s(671830),S=s(211705),f=s(562141),y=s(887399),v=s(746096),C=s(897811),_=s(436237),b=s(998754),T=s(916724),M=s(18078),I=s(415963),w=s(583181),P=s(422538),k=s(888398),A=s(912770),x=s(273096),R=s(853374),O=s(449682),L=s(931693),F=18e5;t.default=new class{constructor(){this._syncDataAccumulator=new S.default,this.syncStarted=new a.default,this.syncComplete=new a.default,this._firstConversationListSync=!0,this._conversationListWaitForSyncUtc=0,this._conversationListExponentialTime=new r.ExponentialTime(1e3,3e5),this._conversationListStale=!1,this._conversationListSyncing=!1,this._conversationListSyncedAtLeastOnce=!1,this._conversationSyncInfoTransient={},this.conversationListSyncStarted=new a.default,this.conversationListSyncComplete=new a.default,this._messagesStale={},this._messagesSyncing={},this._waitingForMessageSync={},this._desiredMessageHistoryStartTime={},this._threadDetailsStale={},this._threadDetailsSyncing={},this._syncFailed={},this.startedSyncingConversation=new a.default,this.finishedSyncingConversation=new a.default,this._prioritizedConversationIds={},this._checkSyncProgressInside=!1,this._checkSyncProgressPending=!1,this._syncExponentialBackoff=new r.ExponentialTime(100,3e5),this._checkProgressAfter=0,this._receivedConversationUpdates=e=>{let t=!1;o.each(o.toArray(e),(e=>{if(e)if(0===e.conv.convViewVersion&&e.conv.threadDetailsVersion>0)this.forceConversationListSync();else{if(!e.conv.isCurrentUserMember()||M.default.isMyMri(e.conv.id))return delete this._messagesStale[e.conv.id],void delete this._threadDetailsStale[e.conv.id];if(e.syncInfo&&e.syncInfo.messagesSyncState||!e.needsSyncMessages()||(0,y.isConversationObjectBlocked)(e.conv)){const s=this._conversationSyncInfoTransient[e.conv.id];s&&(s.messages&&(s.messages.chatServiceErrorCount=0,t=!0,this._checkSyncStartingForConversation(e.conv.id),this._messagesStale[e.conv.id]=!0),s.thread&&(s.thread.chatServiceErrorCount=0,t=!0,this._checkSyncStartingForConversation(e.conv.id),this._threadDetailsStale[e.conv.id]=!0))}else this._checkSyncStartingForConversation(e.conv.id),this._messagesStale[e.conv.id]=!0,t=!0}})),t&&(_.log(v.LogTraceArea.ChatService,"Kicking sync: _receivedConversationUpdates"),this._checkSyncProgress())},this._onConnected=()=>{this._conversationListWaitForSyncUtc=0,this._conversationListExponentialTime.reset(),this._resetBackoffTimer(),this._nextForcedConversationListSyncTimer&&(A.default.clearTimeout(this._nextForcedConversationListSyncTimer),this._nextForcedConversationListSyncTimer=void 0),o.each(p.default.getRawConversationMetaMemoryCache(),(e=>{e&&this._markMessagesAndDetailsStaleAsNeeded(e)})),_.log(v.LogTraceArea.ChatService,"Kicking sync: _onConnected"),this.forceConversationListSync()},this._onMessageLoss=()=>{_.log(v.LogTraceArea.ChatService,"Trouter reported a message loss, starting conversation sync"),this.forceConversationListSync()},this._markFullSyncOnce=o.once((e=>this._syncDataAccumulator.markFullSync(e))),this._markFirstSyncOnce=o.once((()=>this._syncDataAccumulator.markFirstSync())),P.RegisterStartupable(this,"ChatServiceSyncService",[h.default,p.default,b.default])}startup(){return this._conversationListSyncInfo=b.default.getData(f.InternalKeys.ConversationListSyncInfo),_.log(v.LogTraceArea.ChatService,"Sync state loaded: "+JSON.stringify(this._conversationListSyncInfo)),this._connectedSubToken=u.default.reconnected.subscribe(this._onConnected),this._convSubToken=p.default.conversationsUpdated.subscribe(this._receivedConversationUpdates),O.default.messageLost.subscribe(this._onMessageLoss),w.default.performAfterUIStarted((()=>{p.default.loadAndCacheNeedsSyncConversations(),_.log(v.LogTraceArea.ChatService,"Kicking sync: UI started");const e=c.default.getS4LMessagingFeatures().syncSettings;e&&e.forceOnUiStarted?this.forceConversationListSync():this._checkSyncProgress()})),this._appStateSubToken=d.default.subscribeForChanges("ChatServiceSyncService",(e=>{if(e===n.Types.AppActivationState.Active){this._conversationListExponentialTime.reset(),this._resetBackoffTimer(),_.log(v.LogTraceArea.ChatService,"Kicking sync: app foregrounded");const e=c.default.getS4LMessagingFeatures().syncSettings;e&&e.forceOnForeground?this.forceConversationListSync():this._checkSyncProgress()}else 0})),l.Resolved()}prioritizeMeetNowThreadDetails(e){this._meetNowThreadId=e,this._checkSyncProgress()}prioritizeConversation(e,t=!0,s=!1){let o=s,n=t;if(this._threadDetailsStale[e]||(o=!1),this._messagesStale[e]||(n=!1),o||n){this._prunePriorizedConvList();const t=Date.now(),s=this._prioritizedConversationIds[e];s?(s.priorityTime=t,n&&(s.needMessages=!0),o&&(s.needThreadDetails=!0)):this._prioritizedConversationIds[e]={priorityTime:t,needMessages:n,needThreadDetails:o},_.log(v.LogTraceArea.ChatService,`Kicking sync: prioritizeConversation for ${i.pii.Mri(e)}`),this._checkSyncProgress()}}haveAllMessagesForConversation(e){const t=p.default.getConversationMetaFromMemoryCache(e);return!!t&&t.syncInfo.messageHistoryStartTime===m.BeginningOfTime}getEarliestKnownMessageTime(e){const t=p.default.getConversationMetaFromMemoryCache(e);return t?t.syncInfo.messageHistoryStartTime:Number.MAX_VALUE}getSyncState(e){const t=p.default.getConversationMetaFromMemoryCache(e);return t&&t.syncInfo.messagesSyncState}syncBackwards(e){return _.log(v.LogTraceArea.ChatService,"SyncBackwards: "+i.pii.Mri(e)),p.default.getConversationMetaAsync(e).then((t=>{if(!t)return!1;if(t.conv.isBricked||t.syncInfo.messageHistoryStartTime===m.BeginningOfTime)return!1;if((0,y.isConversationObjectBlocked)(t.conv))return!1;this._checkSyncStartingForConversation(e),this._messagesStale[e]=!0;return this._getOrCreateSyncInfoTransient(e).nextSyncSinglePage=!0,_.log(v.LogTraceArea.ChatService,"Kicking sync: syncBackwards"),this._checkSyncProgress(),!0}))}forceConversationListSync(){this._checkSyncStartingForConversationList(),this._conversationListStale=!0,_.log(v.LogTraceArea.ChatService,"Kicking sync: forceConversationListSync"),this._checkSyncProgress()}forceResyncConversation(e){const t=p.default.getConversationMetaFromMemoryCache(e);t&&p.default.processQueuedBundle().then((()=>{this._forceResyncMeta(t,!0),p.default.processQueuedBundle(),_.log(v.LogTraceArea.ChatService,"Kicking sync: forceResyncConversation: "+i.pii.Mri(e)),this._checkSyncProgress()}))}forceResyncAllConversations(){p.default.processQueuedBundle().then((()=>{o.each(p.default.getRawConversationMetaMemoryCache(),(e=>this._forceResyncMeta(e))),p.default.processQueuedBundle(),_.log(v.LogTraceArea.ChatService,"Kicking sync: forceResyncAllConversations"),this._checkSyncProgress()}))}forceThreadDetailsFetchIfNeeded(e){const t=p.default.getConversationMetaFromMemoryCache(e);t&&t.conv.isThread()&&t.conv.areThreadDetailsStale()&&!t.conv.isBricked&&t.conv.isCurrentUserMember()&&(this._checkSyncStartingForConversation(t.conv.id),this._threadDetailsStale[t.conv.id]=!0,_.log(v.LogTraceArea.ChatService,"Kicking sync: forceThreadDetailsFetchIfNeeded"),this._checkSyncProgress())}waitForMessageSyncToFinish(e){this._waitingForMessageSync[e]||(this._waitingForMessageSync[e]=l.Defer());const t=this._waitingForMessageSync[e].promise(),s=this.waitForConversationListSyncToFinish().then((()=>this.isSyncingMessagesForConversation(e)&&this._waitingForMessageSync[e]?this._waitingForMessageSync[e].promise():this._syncFailed[e]?l.Rejected():l.Resolved()));return l.race([t,s]).then(o.noop)}waitForConversationListSyncToFinish(){return u.default.isConnected()&&!this._conversationListStale?l.Resolved():(this._waitingConversationListSync||(this._waitingConversationListSync=l.Defer()),this._waitingConversationListSync.promise())}isCurrentlySyncing(){return!!this._syncStartTime}isConversationListDirty(){return this._conversationListStale}hasConversationListSyncFinishedAtLeastOnce(){return this._conversationListSyncedAtLeastOnce}isSyncingMessages(){return!o.isEmpty(this._messagesStale)}isSyncingMessagesForConversation(e){return!!this._messagesStale[e]}isSyncingThreadDetailsForConversation(e){return!!this._threadDetailsStale[e]}_prunePriorizedConvList(){const e=Date.now()-6e4;o.each(this._prioritizedConversationIds,((t,s)=>{t.priorityTime<e&&delete this._prioritizedConversationIds[s]}))}_getOrCreateSyncInfoTransient(e){let t=this._conversationSyncInfoTransient[e];return t||(t={},this._conversationSyncInfoTransient[e]=t),t}_checkSyncInfoTransientForClearing(e){o.isEmpty(this._conversationSyncInfoTransient[e])&&delete this._conversationSyncInfoTransient[e]}_forceResyncMeta(e,t=!1){if(!e||!e.conv.isCurrentUserMember())return;const s=e.syncInfo.messagesStale||t||e.conv.getTimestamp()>Date.now()-m.RecentMessageHistoryTimePeriod,i={messagesStale:s,messagesStaleReason:s?g.MessagesStaleReason.NeedSync:void 0,messagesSyncState:"",messageHistoryStartTime:Number.MAX_VALUE};i.messagesStale&&!(0,y.isConversationObjectBlocked)(e.conv)&&(this._checkSyncStartingForConversation(e.conv.id),this._messagesStale[e.conv.id]=!0),e.conv.isThread()&&(this._checkSyncStartingForConversation(e.conv.id),this._threadDetailsStale[e.conv.id]=!0),p.default.queueConvSyncInfoChange(e.conv.id,i,!0)}_markMessagesAndDetailsStaleAsNeeded(e){M.default.isMyMri(e.conv.id)||(e.needsSyncMessages()&&!(0,y.isConversationObjectBlocked)(e.conv)&&(this._checkSyncStartingForConversation(e.conv.id),this._messagesStale[e.conv.id]=!0),e.needsSyncThreadDetails()&&(this._checkSyncStartingForConversation(e.conv.id),this._threadDetailsStale[e.conv.id]=!0))}_checkSyncStartingForConversationList(){this._conversationListStale||this._conversationListSyncing||(_.log(v.LogTraceArea.ChatService,"Conversation List Sync: Started"),this.conversationListSyncStarted.fire(),this._checkSyncStarting())}_checkSyncFinishedForConversationList(){if(!this._conversationListStale&&!this._conversationListSyncing){if(_.log(v.LogTraceArea.ChatService,"Conversation List Sync: Completed"),this.conversationListSyncComplete.fire(),this._conversationListSyncedAtLeastOnce=!0,this._waitingConversationListSync){const e=this._waitingConversationListSync;this._waitingConversationListSync=void 0,e.resolve(void 0)}this._checkSyncFinished()}}_checkSyncStartingForConversation(e){this._threadDetailsStale[e]||this._threadDetailsSyncing[e]||this._messagesStale[e]||this._messagesSyncing[e]||(_.log(v.LogTraceArea.ChatService,"Started syncing conversation: "+i.pii.Mri(e)),this.startedSyncingConversation.fire(e),this._checkSyncStarting())}_checkSyncFinishedForConversation(e){if(!this._messagesStale[e]&&!this._messagesSyncing[e]){if(this._waitingForMessageSync[e]){const t=this._waitingForMessageSync[e];delete this._waitingForMessageSync[e],this._syncFailed[e]?t.reject():t.resolve(void 0)}this._threadDetailsStale[e]||this._threadDetailsSyncing[e]||(_.log(v.LogTraceArea.ChatService,"Finished syncing conversation: "+i.pii.Mri(e)),this.finishedSyncingConversation.fire(e),this._checkSyncFinished())}}_checkSyncStarting(){this._syncStartTime||(_.log(v.LogTraceArea.ChatService,"Sync Starting"),this._syncStartTime=Date.now(),this._startTelemetry(),this.syncStarted.fire())}_checkSyncFinished(){this._syncStartTime&&!this._conversationListStale&&!this._conversationListSyncing&&o.isEmpty(this._messagesStale)&&o.isEmpty(this._messagesSyncing)&&o.isEmpty(this._threadDetailsStale)&&o.isEmpty(this._threadDetailsSyncing)&&(_.log(v.LogTraceArea.ChatService,`Sync Finished: ${(Date.now()-this._syncStartTime)/1e3}s`),this._syncStartTime=void 0,this._stopTelemetry(),this.syncComplete.fire())}_checkSyncProgress(){if(w.default.isUIDisplayed()){if(this._checkSyncProgressInside)return this._checkSyncProgressPending=!0,void _.log(v.LogTraceArea.ChatService,"Sync not kicked: Pending");this._checkSyncProgressInside=!0,this._checkSyncProgressInner(),this._checkSyncProgressInside=!1,this._checkSyncProgressPending&&(this._checkSyncProgressPending=!1,_.log(v.LogTraceArea.ChatService,"Kicking sync: Pending"),this._checkSyncProgress())}else _.log(v.LogTraceArea.ChatService,"Sync not kicked: UI not displayed")}_checkSyncProgressInner(){if(this._checkSyncProgressCallbackTimer&&(A.default.clearExpiration(this._checkSyncProgressCallbackTimer),this._checkSyncProgressCallbackTimer=void 0),!c.default.getConfigSettingsNoSubscription().chat.syncWhenNoSubscription&&!u.default.isConnected())return void _.log(v.LogTraceArea.ChatService,"Sync not kicked: no active transport");const e=Date.now();if(c.default.getConfigSettingsNoSubscription().chat.syncBackoffOnNoNetwork&&this._checkProgressAfter>e)return _.log(v.LogTraceArea.ChatService,"Sync not kicked: no network"),void(this._checkSyncProgressCallbackTimer=A.default.setExpiration((()=>this._checkSyncProgress()),this._checkProgressAfter));const t=c.default.getConfigSettingsNoSubscription().chat.syncFreeFetchesConfig,s=x.default.isUserComposing();let i=s?t.bandwidthAwareFetchesREST:t.maxFetchesREST;this._conversationListSyncing&&i--;const n=o.keys(this._messagesSyncing).length;i-=n;const r=o.keys(this._threadDetailsSyncing).length;if(i-=r,i<=0)return void _.log(v.LogTraceArea.ChatService,"Sync not kicked: no free fetches; Conv List Syncing: "+(this._conversationListSyncing?"Yes":"No")+"; Active message syncs: "+n+"; Active thread details syncs: "+r+"; MeetNow thread is syncing: "+!(!this._meetNowThreadId||!this._threadDetailsSyncing[this._meetNowThreadId])+"; User is composing: "+s);if(this._meetNowThreadId&&!this._threadDetailsSyncing[this._meetNowThreadId]){const e=this._meetNowThreadId;this._checkSyncStartingForConversation(e),this._threadDetailsSyncing[e]=!0,delete this._syncFailed[e],i--,this._fetchThreadDetails(e).finally((()=>{delete this._threadDetailsSyncing[e],this._meetNowThreadId=void 0,this._checkSyncFinishedForConversation(e),this._checkSyncProgress()}))}let a=Number.MAX_VALUE;if(this._conversationListStale&&!this._conversationListSyncing&&(this._nextForcedConversationListSyncTimer&&(A.default.clearTimeout(this._nextForcedConversationListSyncTimer),this._nextForcedConversationListSyncTimer=void 0),this._conversationListWaitForSyncUtc>e?(_.log(v.LogTraceArea.ChatService,"Conversation List Sync not kicked: need to wait "+(e-this._conversationListWaitForSyncUtc)+"ms"),a=Math.min(a,this._conversationListWaitForSyncUtc)):(this._checkSyncStartingForConversationList(),this._conversationListSyncing=!0,this._conversationListSyncStarted=Date.now(),i--,this._syncConversationList().finally((()=>{this._conversationListSyncing=!1;const e=this._conversationListSyncStarted?Date.now()-this._conversationListSyncStarted:0;this._conversationListSyncStarted=void 0,this._checkSyncFinishedForConversationList(),this._checkSyncProgress(),this._conversationListStale||(_.log(v.LogTraceArea.ChatService,"Conversation list sync done in "+e+" ms - all up to date: next run scheduled in "+F+"ms"),e>=F?(_.log(v.LogTraceArea.ChatService,"Restarting conversation list sync as last one took too long"),this.forceConversationListSync()):this._nextForcedConversationListSyncTimer=A.default.setTimeout((()=>this.forceConversationListSync()),F))})))),i<=0)return void _.log(v.LogTraceArea.ChatService,"Message/thread sync not kicked: no free fetches");const l=t=>{if(this._messagesSyncing[t])return;const s=this._conversationSyncInfoTransient[t];s&&s.messages&&s.messages.fetchAfterUtc>e?a=Math.min(a,s.messages.fetchAfterUtc):(this._checkSyncStartingForConversation(t),this._messagesSyncing[t]=!0,delete this._syncFailed[t],i--,this._startMessagesSync(t).finally((()=>{delete this._messagesSyncing[t],this._checkSyncFinishedForConversation(t),this._checkSyncProgress()})))},d=t=>{if(this._threadDetailsSyncing[t])return;const s=this._conversationSyncInfoTransient[t];s&&s.thread&&s.thread.fetchAfterUtc>e?a=Math.min(a,s.thread.fetchAfterUtc):(this._checkSyncStartingForConversation(t),this._threadDetailsSyncing[t]=!0,delete this._syncFailed[t],i--,this._fetchThreadDetails(t).finally((()=>{delete this._threadDetailsSyncing[t],this._checkSyncFinishedForConversation(t),this._checkSyncProgress()})))};if(!o.isEmpty(this._prioritizedConversationIds)){this._prunePriorizedConvList();const e=o.sortBy(o.keys(this._prioritizedConversationIds),(e=>-this._prioritizedConversationIds[e].priorityTime));o.each(e,(e=>(this._prioritizedConversationIds[e].needThreadDetails&&(this._threadDetailsStale[e]?d(e):this._prioritizedConversationIds[e].needThreadDetails=!1),this._prioritizedConversationIds[e].needMessages&&(this._messagesStale[e]?i>0&&l(e):this._prioritizedConversationIds[e].needMessages=!1),this._prioritizedConversationIds[e].needMessages||this._prioritizedConversationIds[e].needThreadDetails||delete this._prioritizedConversationIds[e],i>0)))}if(i>0){const e=o.sortBy(o.keys(this._messagesStale),(e=>-this._getConversationSyncSortRank(e)));o.each(e,(e=>(l(e),i>0)))}if(i>0){const e=o.sortBy(o.keys(this._threadDetailsStale),(e=>-this._getConversationSyncSortRank(e)));o.each(e,(e=>(d(e),i>0)))}_.log(v.LogTraceArea.ChatService,"CheckSyncProgress: Conversation List: "+(this._conversationListSyncing?"Syncing":this._conversationListStale?"Stale":"Done")+", Messages: "+o.keys(this._messagesStale).length+" Stale/"+o.keys(this._messagesSyncing).length+" Syncing, Details: "+o.keys(this._threadDetailsStale).length+" Stale/"+o.keys(this._threadDetailsSyncing).length+" Syncing"),a!==Number.MAX_VALUE&&(_.log(v.LogTraceArea.ChatService,"Next sync in "+(Date.now()-a)+"ms"),this._checkSyncProgressCallbackTimer=A.default.setExpiration((()=>this._checkSyncProgress()),a))}_getConversationSyncSortRank(e){return p.default.getConversationMetaFromMemoryCache(e).conv.getSortRank()}_syncConversationList(){const e=this._firstConversationListSync?25:100;this._firstConversationListSync=!1;const t=c.default.getS4LMessagingFeatures().syncSettings,s=["Passport","Skype","Lync","Thread","Agent","ShortCircuit","PSTN"];t&&t.skipConvTypeSmsMms||s.push("SmsMms"),s.push("Flxt","NotificationStream"),t&&!t.skipConvTypeCast&&s.push("Cast"),s.push("ModernBots","secureThreads"),c.default.getS4LContactsFeatures().enableInviteFree&&s.push("InviteFree");const n=s.join("|");let r=this._conversationListSyncInfo?this._conversationListSyncInfo.state:"";return this._conversationListSyncInfo&&this._conversationListSyncInfo.types!==n&&(_.log(v.LogTraceArea.ChatService,"Flushing sync state due to changed conversation types list"),r=""),this._markFullSyncOnce(o.isEmpty(r)),_.log(v.LogTraceArea.ChatService,"Syncing Conversation List, sync state: "+m.encodeSyncStateForLog(r)),u.default.serviceGetMyConversations(n,1,r,e).then((e=>{var t;const s=e.body;if(!s||!s._metadata||o.isNil(s._metadata.syncState))return _.warn(v.LogTraceArea.ChatService,"Conversation List Sync: received empty response "+(s?s._metadata?"syncState":"metadata":"body")),void(this._conversationListWaitForSyncUtc=Date.now()+this._conversationListExponentialTime.getTimeAndCalculateNext());_.log(v.LogTraceArea.ChatService,"Conversation List Sync: "+(s.conversations?s.conversations.length:0)+" updated conversations: "+o.join(o.map(s.conversations,(e=>i.pii.Mri(e.id))),", ")+(s._metadata.backwardLink?", more available":"")),null===(t=this._syncScenario)||void 0===t||t.markStepCompleted("Fetched"),this._conversationListExponentialTime.reset(),o.each(s.conversations,(e=>{m.isAllGlobalClearMri(e.id)||p.default.queueConvUpdate(e)}));const r={state:m.decodeSyncState(s._metadata.syncState),types:n};return p.default.setConvListSyncInfo(r).always((()=>{var e;this._conversationListSyncInfo=r,o.each(s.conversations,(e=>{const t=p.default.getConversationMetaFromMemoryCache(e.id);t?this._markMessagesAndDetailsStaleAsNeeded(t):_.log(v.LogTraceArea.ChatService,"Cannot mark messages/details as stale - no cached conv meta: "+i.pii.Mri(e.id))})),null===(e=this._syncScenario)||void 0===e||e.markStepCompleted("BundleProcessed");!!s._metadata.backwardLink||(this._conversationListStale=!1,this._checkSyncFinishedForConversationList())}))})).catch((e=>{e.errorCode&&_.track(new T.KpiChatSyncFailure(e.errorCode.toString())),e.errorCode===m.ChatServiceErrors.InvalidSyncToken?(_.warn(v.LogTraceArea.ChatService,"Conversation List Sync: Bad Sync key, resetting"),this._conversationListSyncInfo=void 0,b.default.putData(f.InternalKeys.ConversationListSyncInfo,this._conversationListSyncInfo),this._checkSyncStartingForConversationList(),this._conversationListStale=!0):(0===e.statusCode?_.log(v.LogTraceArea.ChatService,"Conversation List Sync: Failed due to connectivity issues. Retrying..."):_.warn(v.LogTraceArea.ChatService,"Conversation List Sync: Transient Error: "+e.statusCode+"/"+e.statusText+(e.errorCode?", "+e.errorCode+"/"+e.errorMessage:"")),this._conversationListWaitForSyncUtc=Date.now()+this._conversationListExponentialTime.getTimeAndCalculateNext())}))}_fetchThreadDetails(e){return _.log(v.LogTraceArea.ChatService,"Fetching Thread Details for: "+i.pii.Mri(e)),u.default.serviceGetThread(e).then((t=>(this._resetBackoffTimer(),this._conversationSyncInfoTransient[e]&&(delete this._conversationSyncInfoTransient[e].thread,this._checkSyncInfoTransientForClearing(e)),p.default.queueThreadUpdate(t),p.default.processQueuedBundle().always((()=>{delete this._threadDetailsStale[e],this._checkSyncFinishedForConversation(e)}))))).catch((t=>{if(t.errorCode&&_.track(new T.KpiChatSyncFailure(t.errorCode.toString())),this._bumpBackoffTimerIfNeeded(t.statusCode),this._isPermanentError(e,t.errorCode))return _.log(v.LogTraceArea.ChatService,"Permanent Error on Thread Details: "+i.pii.Mri(e)+": "+t.statusCode+"/"+t.statusText+(t.errorCode?", "+t.errorCode+"/"+t.errorMessage:"")),this._conversationSyncInfoTransient[e]&&(delete this._conversationSyncInfoTransient[e].thread,this._checkSyncInfoTransientForClearing(e)),p.default.brickConversation(e).always((()=>{delete this._threadDetailsStale[e],this._checkSyncFinishedForConversation(e)}));{_.warn(v.LogTraceArea.ChatService,"Error Syncing Thread Details for "+i.pii.Mri(e)+": "+t.statusCode+"/"+t.statusText+(t.errorCode?", "+t.errorCode+"/"+t.errorMessage:""));const s=this._getOrCreateSyncInfoTransient(e);s.thread||(s.thread={fetchAfterUtc:0,exponentialTime:new r.ExponentialTime(3e3,3e5),chatServiceErrorCount:0}),s.thread.fetchAfterUtc=Date.now()+s.thread.exponentialTime.getTimeAndCalculateNext(),0!==t.statusCode&&s.thread.chatServiceErrorCount++,s.thread.chatServiceErrorCount>=3&&(_.log(v.LogTraceArea.ChatService,"Too many transient thread details fetch errors, giving up for now: "+i.pii.Mri(e)),this._syncFailed[e]=!0,delete this._threadDetailsStale[e],this._checkSyncFinishedForConversation(e))}}))}_getDesiredMessageHistoryStartTime(e,t){return this._desiredMessageHistoryStartTime[t]||e.messageHistoryStartTime}_startMessagesSync(e){const t=p.default.getConversationMetaFromMemoryCache(e);let s,n,r=!1;const a=!t.syncInfo.messagesSyncState,l=this._getDesiredMessageHistoryStartTime(t.syncInfo,e);this._conversationSyncInfoTransient[e]&&this._conversationSyncInfoTransient[e].nextSyncSinglePage?(s=m.BeginningOfTime,n=30,r=!0):a?(s=Date.now()-m.RecentMessageHistoryTimePeriod,n=20):(s=l,n=20);const d=t.conv.getConsumptionHorizonTimestamp(),c=d?d-1e3:Date.now();return c<s&&(s=c),_.log(v.LogTraceArea.ChatService,"Syncing Messages for "+i.pii.Mri(e)+", Lower bound: "+s+", PageSize "+n+", Stale: "+t.syncInfo.messagesStale+", HistoryStartTime: "+t.syncInfo.messageHistoryStartTime+", DesiredHistoryStartTime: "+l+", SyncState: "+m.encodeSyncStateForLog(t.syncInfo.messagesSyncState)+", StaleReason: "+(void 0===t.syncInfo.messagesStaleReason?"undefined":g.MessagesStaleReason[t.syncInfo.messagesStaleReason])),u.default.serviceGetConversationMessages(e,s,t.syncInfo.messagesSyncState,n).then((n=>{if(!n||!n._metadata||!n.messages)return _.warn(v.LogTraceArea.ChatService,"Syncing Messages for "+i.pii.Mri(e)+" received empty response "+(n?n._metadata?"messages":"metadata":"body")),void this._handleTransientMessageSyncError(e,0);this._resetBackoffTimer(),this._conversationSyncInfoTransient[e]&&(delete this._conversationSyncInfoTransient[e].messages,delete this._conversationSyncInfoTransient[e].nextSyncSinglePage,this._checkSyncInfoTransientForClearing(e));const d=!!n._metadata.backwardLink;let h,u,S;if(n.messages.length>0){const t=e,s=o.map(n.messages,(e=>({message:(0,L.tweakMagicBotOneOnOneMessage)(e,!1),origin:v.MessageOrigin.ChatSync,isOtherEndpointActive:!1,reactionUpdates:g.EmptyReactionsUpdate,clientMessageIds:[e.clientmessageid],messageStoreUsed:!1})));p.default.queueMessagesForConversation(t,s),this._accumulateTelemetryData(e,n.messages.length),h=Number(o.minBy(n.messages,(e=>Number(e.version))).version)}d?(u=h||Number.MAX_VALUE,S=R.default.clampValue(l,Date.now()-m.RecentMessageHistoryTimePeriod,u)):(u=Math.min(h||Number.MAX_VALUE,s),S=u);const f=d&&!r&&(!a||u>c),y={messagesStale:f,messagesStaleReason:f?t.syncInfo.messagesStaleReason:void 0,messagesSyncState:m.decodeSyncState(n._metadata.syncState),messageHistoryStartTime:u};return _.log(v.LogTraceArea.ChatService,"Synced Messages for "+i.pii.Mri(e)+": More: "+d+", Count: "+n.messages.length+", Stale: "+f+", HistoryStartTime: "+u+", SyncState: "+m.encodeSyncStateForLog(y.messagesSyncState)),this._desiredMessageHistoryStartTime[e]=S,p.default.queueConvSyncInfoChange(e,y),p.default.processQueuedBundle().always((()=>{y.messagesStale||(delete this._messagesStale[e],this._checkSyncFinishedForConversation(e))}))})).catch((t=>{if(t.errorCode&&_.track(new T.KpiChatSyncFailure(t.errorCode.toString())),this._bumpBackoffTimerIfNeeded(t.statusCode),this._isPermanentError(e,t.errorCode))return _.log(v.LogTraceArea.ChatService,"Permanent Error Syncing Messages: "+i.pii.Mri(e)+": "+t.statusCode+"/"+t.statusText+(t.errorCode?", "+t.errorCode+"/"+t.errorMessage:"")),this._conversationSyncInfoTransient[e]&&(delete this._conversationSyncInfoTransient[e].messages,delete this._conversationSyncInfoTransient[e].nextSyncSinglePage,this._checkSyncInfoTransientForClearing(e)),p.default.brickConversation(e).always((()=>{delete this._messagesStale[e],this._checkSyncFinishedForConversation(e)}));if(t.errorCode===m.ChatServiceErrors.InvalidSyncToken){_.log(v.LogTraceArea.ChatService,"Bad message sync key for conversation: ",i.pii.Mri(e));const t=p.default.getConversationMetaFromMemoryCache(e),s={messagesStale:!0,messagesStaleReason:g.MessagesStaleReason.NeedSync,messagesSyncState:void 0,messageHistoryStartTime:t.syncInfo.messageHistoryStartTime};return p.default.setConvSyncInfo(e,s)}_.warn(v.LogTraceArea.ChatService,"Error Syncing Messages for "+i.pii.Mri(e)+": "+t.errorCode+" - "+t.errorMessage+", "+t.statusCode+"/"+t.statusText),this._handleTransientMessageSyncError(e,t.statusCode)}))}_handleTransientMessageSyncError(e,t){const s=this._getOrCreateSyncInfoTransient(e);s.messages||(s.messages={fetchAfterUtc:0,exponentialTime:new r.ExponentialTime(3e3,3e5),chatServiceErrorCount:0}),s.messages.fetchAfterUtc=Date.now()+s.messages.exponentialTime.getTimeAndCalculateNext(),0!==t&&s.messages.chatServiceErrorCount++,s.messages.chatServiceErrorCount>=3&&(_.log(v.LogTraceArea.ChatService,"Too many transient message sync errors, giving up for now: "+i.pii.Mri(e)),this._syncFailed[e]=!0,delete this._messagesStale[e],this._checkSyncFinishedForConversation(e))}_isPermanentError(e,t){return!(t!==m.ChatServiceErrors.AccessDenied&&t!==m.ChatServiceErrors.InitiatorNotPartOfThread&&t!==m.ChatServiceErrors.ThreadNotFound)&&(!m.isOneOnOneConversation(e)||(_.track(new C.FundamentalsDebugEvent("BrickOneOnOne","Namespace: "+m.getMriNamespace(e))),!1))}_bumpBackoffTimerIfNeeded(e){(0===e||e>=500&&e<600)&&(this._checkProgressAfter=Date.now()+this._syncExponentialBackoff.getTimeAndCalculateNext())}_resetBackoffTimer(){this._syncExponentialBackoff.reset(),this._checkProgressAfter=0}_startTelemetry(){this._syncTelemetryEvent||(this._syncTelemetryEvent=new T.KpiChatSync),this._syncScenario||(this._syncScenario=new k.default(I.ScenarioName.InitialRecentsSync),this._syncScenario.start())}_stopTelemetry(){this._markFirstSyncOnce(),this._trackSyncTelemetry(),this._stopSyncScenario(),this._syncDataAccumulator.reset()}_stopSyncScenario(){this._syncScenario&&(this._syncScenario.finish(this._syncDataAccumulator.getData()),this._syncScenario=void 0)}_trackSyncTelemetry(){this._syncTelemetryEvent&&(this._syncTelemetryEvent.endSync(this._syncDataAccumulator.getData()),_.track(this._syncTelemetryEvent),this._syncTelemetryEvent=void 0)}_accumulateTelemetryData(e,t){this._syncDataAccumulator.accumulateData(e,t)}test_reset(){this._appStateSubToken&&this._appStateSubToken.unsubscribe(),this._connectedSubToken&&this._connectedSubToken.unsubscribe(),this._convSubToken&&this._convSubToken.unsubscribe(),this._messagesStale={},this._threadDetailsStale={},this._messagesSyncing={},this._threadDetailsSyncing={},this._conversationSyncInfoTransient={},this._resetBackoffTimer(),this._conversationListWaitForSyncUtc=0,this._conversationListExponentialTime.reset()}}},199146:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(516778),n=s(300060),r=(s(889391),s(426426)),a=s(671830),l=(s(746096),s(436237),s(861253));class d extends r.default{constructor(e,t,s,r,a,l=i.noop){super(e,t,l,a),this._baseInterestedResources=s,this._enabled=r,this._presenceTrackedMrisDesired=[],n.default.subscribeForChanges("LongPollSubscription",(e=>{e===o.Types.AppActivationState.Active&&this._resetBackoffs(),this._checkState()})),this._updateDesiredParams()}logout(){this._subscriptionInfoUpdated(void 0),this.setEnabled(!1),this.cancelPendingLongPollRequest("logout")}setEnabled(e){this._enabled!==e&&(this._enabled=e,this._checkState())}setPresenceMriTrackingList(e){(0,l.default)(e,this._presenceTrackedMrisDesired)||(this._presenceTrackedMrisDesired=e,this._updateDesiredParams())}setInterestedResources(e){this._baseInterestedResources=e,this._updateDesiredParams()}_updateDesiredParams(){const e=this._baseInterestedResources.concat(i.map(this._presenceTrackedMrisDesired,(e=>"/v1/users/ME/contacts/"+e)));this._setDesiredSubParameters(a.createLongPollSubscriptionParams(e))}_subscriptionAllowed(){return!!this._enabled&&super._subscriptionAllowed()}}t.default=d},656032:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(174958),o=s(496486),n=s(662783),r=s(397691),a=s(889391),l=s(36593),d=s(612228),c=s(671830),h=s(746096),u=s(666765),p=s(13159),g=s(590424),m=s(853374),S=s(626712),f=s(436237),y=s(897811),v=s(609959);class C extends p.SkypeRestClient{constructor(e){super(C._getEcsEndpointUrl()),this._errorHandler=e,this._lastEcsHostUrl=void 0,this._customErrorHandler=(e,t)=>{this._updateRegistrationToken(t);const s=e.getOptions(),i=t.requestOptions,o=this._customErrorHandlerHelper(t,e,s);switch(o){case n.ErrorHandlingType.DoNotRetry:i.reliabilityTracker.failed(t);break;case n.ErrorHandlingType.PauseUntilResumed:case n.ErrorHandlingType.RetryCountedWithBackoff:case n.ErrorHandlingType.RetryUncountedImmediately:case n.ErrorHandlingType.RetryUncountedWithBackoff:i.reliabilityTracker.retry(t);break;default:m.default.switchStatementExhaustiveChecking(o)}return o},this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler,this._defaultOptions.augmentErrorResponse=this._errorHandler.augmentErrorResponse}startup(){a.default.subscribe((()=>{this._resetEndpointUrlIfEcsChanged(!1)})),this._resetEndpointUrlIfEcsChanged(!0)}static _getEcsEndpointUrl(){var e,t;return null!==(t=null===(e=a.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===e?void 0:e.host)&&void 0!==t?t:""}_resetEndpointUrlIfEcsChanged(e){const t=C._getEcsEndpointUrl();t!==this._lastEcsHostUrl&&(f.log(h.LogTraceArea.ChatServiceTransport,"[MFE] ECS configuration of host URL have changed: "+i.pii.Omit(this._lastEcsHostUrl||"")+" => "+i.pii.Omit(t)),this._trackRedirectEvent(e?"startup":"ecs",this._lastEcsHostUrl,t),this._lastEcsHostUrl=t,this._endpointUrl=t)}handleLocationChange(e){const t=S.default.getURIComponents(e),s=S.default.getURIComponents(this._endpointUrl);if(!t||!s||!t.host)return void f.warn(h.LogTraceArea.ChatServiceTransport,"[MFE] failed to parse redirect url "+i.pii.Omit(e));const o=c.calculateEndpointUrl({protocol:t.protocol,host:t.host,path:s.pathname});if(this._endpointUrl===o)return f.warn(h.LogTraceArea.ChatServiceTransport,"[MFE] got redirected to the same location "+i.pii.Omit(o)),void f.track(new y.FundamentalsDebugEvent("MfeSameLocationRedirect",s.host+"/"));f.log(h.LogTraceArea.ChatServiceTransport,"[MFE] Endpoint URL changed: "+i.pii.Omit(this._endpointUrl)+" => "+i.pii.Omit(o)),this._trackRedirectEvent("service",this._endpointUrl,o),this._endpointUrl=o}resetBackoffTimers(){this._errorHandler.getLoginTimer().reset()}_trackRedirectEvent(e,t,s){f.track(new v.ChatServiceRedirectEvent({source:e,targetEnvironment:c.getEnvironmentNameFromUrl(s),previousEnvironment:c.getEnvironmentNameFromUrl(t),targetUrl:i.pii.Omit(s),previousUrl:t?i.pii.Omit(t):void 0}))}_getHeaders(e){const t=super._getHeaders(e);t.Authentication=g.getSkypetokenHeaderValue();const s=u.default.getRegistrationToken();a.default.getConfigSettingsNoSubscription().chat.authentication.useRegToken&&s&&(t.RegistrationToken=s),t.ClientInfo=c.getClientInfoString(),t["X-ECS-Etag"]=a.default.getCachedEcsConfigEtag();const i=c.getClientCapabilities();return i&&(t["X-Client-Capabilities"]=i),t.BehaviorOverride="redirectAs404",t["MS-IC3-Product"]="Sfl",e.counterPartyMri&&(t["Counterparty-User-Id"]=e.counterPartyMri),t}_blockRequestUntil(e){const t=[super._blockRequestUntil(e)];return t.push(this._errorHandler.get429Timer().getPromise(),this._errorHandler.getRetryAfterTimer().getPromise(e)),e.isLoginRequest&&t.push(this._errorHandler.getLoginTimer().getPromise()),r.all(t).then(o.noop)}_customErrorHandlerHelper(e,t,s){const i=this._errorHandler.getRegistrationTokenFromHeaders(t.getRequestHeaders()),o=this._errorHandler.getSkypetokenFromHeaders(t.getRequestHeaders()),r=this._errorHandler.handleChatServiceFailure("MessagingRestClient",e,o,i,u.default.getEndpointInfo().id,s,h.ChatServiceConnectionType.MessagingApi);if(r===l.ChatServiceErrorTypes.LocationChanged&&e.headers.location)return t.setUrl(e.headers.location),n.ErrorHandlingType.RetryUncountedImmediately;switch(r){case l.ChatServiceErrorTypes.TooManyRequests:case l.ChatServiceErrorTypes.LoginRateLimitExceeded:case l.ChatServiceErrorTypes.LoginRequestError:return n.ErrorHandlingType.RetryUncountedWithBackoff}return(0,n.DefaultErrorHandler)(t,e)}_processSuccessResponse(e){e.requestOptions.reliabilityTracker.succeeded(e),this._errorHandler.get429Timer().reset(),this._updateRegistrationToken(e)}_updateRegistrationToken(e){if(a.default.getConfigSettingsNoSubscription().chat.authentication.useRegToken&&e.headers&&e.headers["set-registrationtoken"]){const t=e.headers["set-registrationtoken"];u.default.setRegistrationToken(t)}}performRequest(e,t){const s={scenario:e.scenario,reliabilityTracker:new d.default(e.scenario,h.ChatServiceConnectionType.MessagingApi),contentType:e.mediaType};return s.reliabilityTracker.begin(),g.applyRestRequestTimeoutOverride(e.scenario,s),super.performRequest(e,o.extend(s,t)).done((()=>{s.reliabilityTracker.ensureResolved()})).fail((e=>{e.invalidNullBody?s.reliabilityTracker.ensureResolved():s.reliabilityTracker.ensureRejected()}))}performRequestBackground(e,t,s,i){return i=i||{},g.applyRestRequestTimeoutOverride(s.scenario,i),super.performRequestBackground(e,t,s,i)}}t.default=C},513651:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(174958),o=s(496486),n=s(662783),r=s(397691),a=s(889391),l=s(36593),d=s(890239),c=s(612228),h=s(671830),u=s(746096),p=s(897811),g=s(436237),m=s(199146),S=s(178735),f=s(415963),y=s(666765),v=s(13159),C=s(404057),_=s(794050),b=s(919358),T=s(994214),M=s(590424),I=s(626712),w=s(853374),P=new n.ExponentialTime(1e3,2e4);class k extends v.SkypeRestClient{constructor(e,t,s,o){super(y.default.calcChatV1EndpointUrl()),this._chatServiceClient=e,this._handleEvents=t,this._subscriptionStateChanged=s,this._errorHandler=o,this._connectivityEnabled=!1,this._checkStateInside=!1,this._checkStatePending=!1,this._timeToConnectedTelemetry=new _.default(f.ScenarioName.TimeToConnected),this._nextAllowedPresencePublish=0,this._uedIsExclusive=!1,this._restEndpointUrlChangedCallback=()=>{const e=y.default.calcChatV1EndpointUrl();g.log(u.LogTraceArea.ChatServiceTransport,"RestEndpointUrlChanged callback fired."),e!==this._endpointUrl&&(g.log(u.LogTraceArea.ChatServiceTransport,`Updating endpoint URL to ${i.pii.Omit(e)}`),this.handleLocationChange(e))},this._customErrorHandler=(e,t)=>{b.default.putCurrentServiceTime(Date.parse(t.headers.date),0),this._updateRegistrationToken(t);const s=e.getOptions(),i=t.requestOptions,o=this._customErrorHandlerHelper(t,e,s);switch(o){case n.ErrorHandlingType.DoNotRetry:i.reliabilityTracker.failed(t);break;case n.ErrorHandlingType.PauseUntilResumed:case n.ErrorHandlingType.RetryCountedWithBackoff:case n.ErrorHandlingType.RetryUncountedImmediately:case n.ErrorHandlingType.RetryUncountedWithBackoff:i.reliabilityTracker.retry(t);break;default:w.default.switchStatementExhaustiveChecking(o)}return o},this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler,this._defaultOptions.augmentErrorResponse=this._errorHandler.augmentErrorResponse}startup(){const{chatServiceHostRefreshEnabled:e,chatServiceHostRefreshInterval:t,authentication:s}=a.default.getConfigSettings().chat;e&&!t&&y.default.setRestEndpointUrl(y.default.calcChatV1EndpointUrl()),this._endpointUrl=y.default.getRestEndpointUrl()||y.default.calcChatV1EndpointUrl(),s.useRegToken||(g.log(u.LogTraceArea.ChatServiceTransport,"Registration token auth disabled, setting reg token to undefined"),y.default.setRegistrationToken(void 0)),T.default.subscribe((()=>{y.default.setRegistrationToken(void 0),this._checkState()}),T.TriggerKeys.SkypeTokenKey),a.default.subscribe((()=>{const{blacklistedHosts:e,chatServiceHostRefreshEnabled:t,authentication:s}=a.default.getConfigSettings().chat;s.useRegToken||(g.log(u.LogTraceArea.ChatServiceTransport,"Registration token auth disabled, setting reg token to undefined"),y.default.setRegistrationToken(void 0));const i=a.default.getS4LMessagingFeaturesNoSubscription().ued;this._uedIsExclusive!==(i&&i.isExclusive)&&(this._uedIsExclusive=i&&i.isExclusive,this._longPollSubscription&&this._longPollSubscription.setInterestedResources(this._calculateInterestedResources())),o.includes(e,this._endpointUrl)&&this.handleLocationChange(y.default.calcChatV1EndpointUrl()),t&&!this._handleLocationChange?this._handleLocationChange=y.default.restEndpointUrlChanged.subscribe(this._restEndpointUrlChangedCallback):!t&&this._handleLocationChange&&(this._handleLocationChange.unsubscribe(),this._handleLocationChange=void 0),this._checkState()}));const i=a.default.getConfigSettings().chat.blacklistedHosts;o.includes(i,this._endpointUrl)&&this.handleLocationChange(y.default.calcChatV1EndpointUrl());const n=y.default.getEndpointInfo(),r=a.default.getS4LMessagingFeaturesNoSubscription().ued;this._uedIsExclusive!==(r&&r.isExclusive)&&(this._uedIsExclusive=r&&r.isExclusive),S.default.subscribe((()=>{this._longPollSubscription&&(this._longPollSubscription.setInterestedResources(this._calculateInterestedResources()),g.log(u.LogTraceArea.ChatServiceTransport,"MyUserPreferencesLocalStore: kick checkState in RestTransport"),this._checkState())})),g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Started Up. EndpointInfo: "+h.encodeEndpointInfoForLog(n)),this._longPollSubscription=new m.default(this._chatServiceClient,"LongPoll",this._calculateInterestedResources(),this._connectivityEnabled,this._handleEvents,((e,t)=>{(e===d.SubscriptionState.CreatedActive||d.SubscriptionState.CreatedLongPollTrouble)&&this._timeToConnectedTelemetry.hasStarted()&&(this._timeToConnectedTelemetry.finish(),this._timeToConnectedTelemetry.reset()),this._subscriptionStateChanged(e,t)})),this._pendingPresenceMriTrackingList&&(this._longPollSubscription.setPresenceMriTrackingList(this._pendingPresenceMriTrackingList),this._pendingPresenceMriTrackingList=void 0)}logout(){this.setConnectionEnabled(!1,"logout"),this._longPollSubscription&&this._longPollSubscription.logout()}handleLocationChange(e,t){const s=I.default.getURIComponents(e),o=I.default.getURIComponents(this._endpointUrl);if(s&&o&&s.host){const e=h.calculateEndpointUrl({protocol:s.protocol,host:s.host,path:o.pathname});if(this._endpointUrl!==e)return g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Endpoint URL Changed: "+i.pii.Omit(this._endpointUrl)+" => "+i.pii.Omit(e)),this._endpointUrl=e,y.default.setRestEndpointUrl(e),!0;if(g.warn(u.LogTraceArea.ChatServiceTransport,"RestTransport got response to change endpoint to the same thing: "+i.pii.Omit(e)),g.track(new p.FundamentalsDebugEvent("ChatServiceSameLocationRedirect",o.host+"/")),a.default.getConfigSettingsNoSubscription().chat.recreateEndpointOnSameLocationRedirect){const e=y.default.getEndpointInfo().id;M.getDurableEndpointId().then((s=>{let i;i=e&&h.areEndpointIdsEqual(e,s)?this._chatServiceClient.serviceDeleteEndpoint(e).then((()=>{g.warn(u.LogTraceArea.ChatServiceTransport,"Deleted endpoint ID "+e+" before recreating")})).catch((t=>{g.log(u.LogTraceArea.ChatServiceTransport,"Failed to delete endpoint ID "+e+" before recreating: "+C.default.errorAsString(t))})):r.Resolved(),i.then((()=>{const e=y.default.calcChatV1EndpointUrl();this._endpointUrl!==e&&(this._endpointUrl=e,y.default.setRestEndpointUrl(this._endpointUrl)),y.default.updateEndpointInfo({id:void 0,exists:!1,featureFlags:void 0,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,reason:"Redirect to same URL",tcid:t})}))}))}}return!1}debug_getCurrentCloudUrl(){return this._endpointUrl}setPresenceMriTrackingList(e){this._longPollSubscription?this._longPollSubscription.setPresenceMriTrackingList(e):this._pendingPresenceMriTrackingList=e}resetBackoffTimers(){this._errorHandler.getLoginTimer().reset(),this._checkState()}isConnectionEnabled(){return this._connectivityEnabled}setConnectionEnabled(e,t){if(this._connectivityEnabled!==e){if(e){const e={ConnectionType:"REST",ReasonForConnecting:t};this._timeToConnectedTelemetry.start(e)}else this._timeToConnectedTelemetry.hasStarted()&&(this._timeToConnectedTelemetry.fail(t),this._timeToConnectedTelemetry.reset());this._connectivityChangeReason=t,g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport setConnectionEnabled: "+e+", reason: "+t),this._connectivityEnabled=e,this._longPollSubscription&&this._longPollSubscription.setEnabled(this._connectivityEnabled),this._checkState()}}endpointInfoUpdated(e,t){g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Endpoint Info Updated: "+h.encodeEndpointInfoForLog(e)),this._longPollSubscription&&this._longPollSubscription.endpointInfoUpdated(e,t),this._checkState()}_getEndpointFeaturesList(){return h.getEndpointFeaturesList()}_calculateInterestedResources(){return M.calculateInterestedResources(!this._uedIsExclusive)}_endpointPresencePublished(e,t){const s=y.default.getEndpointInfo();h.areEndpointIdsEqual(s.id,e)?s.exists?(g.log(u.LogTraceArea.ChatService,"Endpoint "+e+" presence published"),y.default.updateEndpointInfo({presenceDocPublished:t,reason:"Presence published"})):g.warn(u.LogTraceArea.ChatServiceTransport,"_endpointPresencePublished called with non-existing endpoint"):g.warn(u.LogTraceArea.ChatServiceTransport,"_endpointPresencePublished called with stale endpointid")}_checkState(){this._checkStateInside?this._checkStatePending=!0:(this._checkStateInside=!0,M.calculateDesiredEndpointId().then((e=>{this._checkStateInner(e),this._checkStateInside=!1,this._checkStatePending&&(this._checkStatePending=!1,this._checkState())})))}_checkStateInner(e){if(!(this._connectivityEnabled&&T.default.hasUsableSkypeToken())){if(g.log(u.LogTraceArea.ChatServiceTransport,"Cancelling requests in flight, reason: "+this._connectivityChangeReason),this._endpointCreationInFlight){const e=this._endpointCreationInFlight;this._endpointCreationInFlight=void 0,e.cancel()}if(this._presencePublishInFlight){const e=this._presencePublishInFlight;this._presencePublishInFlight=void 0,e.cancel()}return}const t=y.default.getEndpointInfo(),s=this._getEndpointFeaturesList(),i=a.default.getCachedEcsConfigEtag(),n=a.default.getConfigSettings().chat.updateEndpointOnEcsEtagChange;if(!t.exists||!t.id||!h.areEndpointIdsEqual(t.id,e)||t.featureFlags!==s||n&&t.ecsEtag!==i){if(this._endpointCreationInFlight)return;return g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Creating/Updating Endpoint. Features: "+s+(t.id?", Given Id: "+t.id:"")+", Desired Id: "+e),this._endpointCreationInFlight=this.createOrUpdateEndpoint(e,i),void this._endpointCreationInFlight.finally((()=>{this._endpointCreationInFlight=void 0})).then((t=>(this._errorHandler.getLoginTimer().reset(),M.getDurableEndpointId().then((s=>{(!e||!y.default.endpointExists()||h.areEndpointIdsEqual(t.id,y.default.getEndpointId())||h.areEndpointIdsEqual(s,t.id)||h.areEndpointIdsEqual(s,y.default.getEndpointId()))&&(g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Endpoint Created/Updated: "+h.encodeEndpointInfoForLog(t)),y.default.updateEndpointInfo(t))}))))).catch((e=>{e&&0!==e.statusCode?g.warn(u.LogTraceArea.ChatServiceTransport,"Endpoint Creation failure: "+e.statusCode+"/"+e.statusText+", "+e.errorCode+"/"+e.errorMessage):g.log(u.LogTraceArea.ChatServiceTransport,"Endpoint Creation failure: Empty error or connectivity issues. Reconnecting.")})).finally((()=>{this._checkState()}))}const r=t.id,l=M.calculateDesiredEndpointPresenceDoc(),d=h.areEndpointPresenceDocsEqual(t.presenceDocPublished,l);if(!d){if(this._presencePublishInFlight)return;if(Date.now()<this._nextAllowedPresencePublish){if(o.isUndefined(this._delayedPresencePublish)){const e=this._nextAllowedPresencePublish-Date.now();g.log(u.LogTraceArea.ChatServiceTransport,`Delaying presence publishing for ${e} ms`),this._delayedPresencePublish=o.delay((()=>this._checkState()),e)}return}return this._delayedPresencePublish=void 0,g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Publishing Presence on Endpoint: "+JSON.stringify(l)),void this._publishEndpointPresence(r,l)}}_publishEndpointPresence(e,t){this._presencePublishInFlight=this._chatServiceClient.servicePublishEndpointPresence(e,t),this._presencePublishInFlight.finally((()=>{this._presencePublishInFlight=void 0})).then((()=>{this._errorHandler.getLoginTimer().reset(),P.reset(),h.areEndpointIdsEqual(e,y.default.getEndpointId())?(g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Presence Published on Endpoint: "+e),this._endpointPresencePublished(e,t)):this._checkState()})).catch((t=>{if(this._nextAllowedPresencePublish=Date.now()+P.getTimeAndCalculateNext(),t&&404===t.statusCode)return g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Presence Publish reported missing endpoint: "+e),void y.default.markEndpointMissing(e,h.getTcidDataFromServerMessageResponse(t));t&&0!==t.statusCode?g.warn(u.LogTraceArea.ChatServiceTransport,"Presence Publish failure: "+t.statusCode+"/"+t.statusText+", "+t.errorCode+"/"+t.errorMessage+". Retrying..."):g.log(u.LogTraceArea.ChatServiceTransport,"Presence Publish failure: Empty error or connectivity issues. Retrying..."),this._checkState()}))}createOrUpdateEndpoint(e,t){const s=this._getEndpointFeaturesList();return g.log(u.LogTraceArea.ChatServiceTransport,"RestTransport Creating/Updating Endpoint. Features: "+s+(e?", Given Id: "+e:"")),e?this._chatServiceClient.serviceUpdateEndpoint(e,s).then((e=>{const i=h.findPushSubscriptionInfo(e.endpoint.subscriptions);return o.assign({id:e.endpoint.id,exists:!0,featureFlags:s,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,ecsEtag:t,reason:"REST update endpoint",tcid:e.tcid},i)})):this._chatServiceClient.serviceCreateEndpoint(s).then((e=>({id:e.endpointId,exists:!0,featureFlags:s,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,ecsEtag:t,reason:"REST create endpoint",tcid:e.tcid})))}_getHeaders(e){const t=super._getHeaders(e);t.Authentication=M.getSkypetokenHeaderValue();const s=a.default.getConfigSettingsNoSubscription().chat.authentication,i=y.default.getRegistrationToken();return s.useRegToken&&i&&!e.isSkypetokenOnlyRequest&&(t.RegistrationToken=i),e.endpointId&&(t.EndpointId=e.endpointId),t.ClientInfo=h.getClientInfoString(),t.BehaviorOverride="redirectAs404",t["X-ECS-Etag"]=a.default.getCachedEcsConfigEtag(),t}_blockRequestUntil(e){const t=[super._blockRequestUntil(e)];return t.push(this._errorHandler.get429Timer().getPromise()),this._errorHandler.getRedirectTimer().getBumpCount()>1&&t.push(this._errorHandler.getRedirectTimer().getPromise()),e.isLoginRequest&&t.push(this._errorHandler.getLoginTimer().getPromise()),r.all(t).then(o.noop)}_customErrorHandlerHelper(e,t,s){const i=this._errorHandler.getRegistrationTokenFromHeaders(t.getRequestHeaders()),o=this._errorHandler.getSkypetokenFromHeaders(t.getRequestHeaders()),r=this._errorHandler.handleChatServiceFailure("RestTransport",e,o,i,y.default.getEndpointInfo().id,s,u.ChatServiceConnectionType.ChatServiceV1);if(r===l.ChatServiceErrorTypes.LocationChanged&&e.headers.location)return t.setUrl(e.headers.location),n.ErrorHandlingType.RetryUncountedImmediately;switch(r){case l.ChatServiceErrorTypes.TooManyRequests:case l.ChatServiceErrorTypes.LoginRateLimitExceeded:case l.ChatServiceErrorTypes.LoginRequestError:return n.ErrorHandlingType.RetryUncountedWithBackoff}return(0,n.DefaultErrorHandler)(t,e)}_processSuccessResponse(e){e.requestOptions.reliabilityTracker.succeeded(e),b.default.putCurrentServiceTime(Date.parse(e.headers.date),0),this._errorHandler.get429Timer().reset(),this._errorHandler.getRedirectTimer().reset(),this._updateRegistrationToken(e)}_updateRegistrationToken(e){if(a.default.getConfigSettingsNoSubscription().chat.authentication.useRegToken&&e.headers&&e.headers["set-registrationtoken"]){const t=e.headers["set-registrationtoken"];y.default.setRegistrationToken(t)}}performRequest(e,t){const s={scenario:e.scenario,reliabilityTracker:new c.default(e.scenario,u.ChatServiceConnectionType.ChatServiceV1),contentType:e.mediaType};return s.reliabilityTracker.begin(),e.endpointId&&(s.endpointId=e.endpointId),M.applyRestRequestTimeoutOverride(e.scenario,s),super.performRequest(e,o.extend(s,t)).done((()=>{s.reliabilityTracker.ensureResolved()})).fail((e=>{e.invalidNullBody?s.reliabilityTracker.ensureResolved():s.reliabilityTracker.ensureRejected()}))}performRequestBackground(e,t,s,i){return i=i||{},M.applyRestRequestTimeoutOverride(s.scenario,i),super.performRequestBackground(e,t,s,i)}}t.default=k},590424:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyRestRequestTimeoutOverride=t.getSkypetokenHeaderValue=t.calculateDesiredEndpointId=t.getDurableEndpointId=t.calculatePnhInterestedResources=t.calculateV2InterestedResources=t.calculateInterestedResources=t.calculateDesiredEndpointPresenceDoc=void 0;const i=s(496486),o=s(397691),n=s(889391),r=s(890239),a=s(671830),l=s(666765),d=s(216568),c=s(994214),h=s(853374);function u(){return d.default.EdfRegistrationId.waitUntilSet().then((()=>{const e=d.default.EdfRegistrationId.get();return e&&h.default.isFormattedGuid(e)?a.formatEndpointId(e):void 0}))}t.calculateDesiredEndpointPresenceDoc=function(){return a.buildEndpointPresenceDocData(["Audio","Video"])},t.calculateInterestedResources=function(e,t){const s=i.map(t,(e=>"/v1/users/ME/contacts/"+e));return e?r.PrimaryResourcesToTrack.concat(s):s},t.calculateV2InterestedResources=function(){return r.PrimaryResourcesToTrack},t.calculatePnhInterestedResources=function(){return r.PnhResourcesToTrack},t.getDurableEndpointId=u,t.calculateDesiredEndpointId=function(){const e=n.default.getConfigSettingsNoSubscription().chat.durableEndpointId,t=l.default.getEndpointInfo().id;return t?e.recreateToMatchEnabled?u().then((s=>e.enabled?s||t:a.areEndpointIdsEqual(t,s)?void 0:t)):o.Resolved(t):e.enabled?u().then((e=>e)):o.Resolved(void 0)},t.getSkypetokenHeaderValue=function(){return a.SKYPE_TOKEN_HEADER_PREFIX+c.default.getRawSkypeToken()},t.applyRestRequestTimeoutOverride=function(e,t){const s=n.default.getConfigSettingsNoSubscription().chat.RESTRequestTimeouts;s&&(t.timeout=s.scenarioTimeouts&&s.scenarioTimeouts[e]||t.timeout,t.timeout=t.timeout||s.defaultTimeout)}},429791:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toAccessibilityTraits=t.getAccessibilityLabelForReaction=t.toAccessibilityLabel=t.ContentToAccessibilityLabelTransformer=void 0;const i=s(496486),o=s(889391),n=s(225638),r=s(325489),a=s(796096),l=s(351077),d=s(681959),c=s(816402),h=s(952262),u=s(435521),p=s(639024),g=s(82433),m=s(770891),S=s(746096),f=s(552115),y=s(462937),v=s(436237),C=s(733754),_=s(518606),b=s(312762),T=s(18078),M=s(677914),I=s(71987),w=s(886045),P=s(404057),k=s(932293);class A extends d.ContentToTextTransformer{constructor(){super(...arguments),this.transformPictureNode=e=>({value:C.getString("AccessibilityLabel.Picture"),stopProcessing:!1}),this.transformMediaAlbumNode=e=>{const t=e.getAlbumId();let s="";if(t){const e=_.default.getAllMediaMessagesForAlbum(t).length;s=C.getString("AccessibilityLabel.Photos",{count:e})}return{value:s,stopProcessing:!1}},this.transformVideoNode=e=>({value:e.getSubType()===l.UriObjectTypeSubTypes.Video.CallRecording?C.getString("AccessibilityLabel.CallRecording",{numberOfDays:o.default.getS4LCMCFeatures().callRecorderRetentionDurationDays}):C.getString("AccessibilityLabel.Video"),stopProcessing:!1}),this.transformVideoMessageNode=e=>({value:C.getString("AccessibilityLabel.VideoMessage"),stopProcessing:!1}),this.transformAudioNode=e=>({value:C.getString("AccessibilityLabel.Audio"),stopProcessing:!1}),this.transformAudioMessageNode=e=>{const t=e.getAudioDurationMs(),s=t?Math.round(t/1e3):0,i=c.default.getFormattedDuration(s,!0);return{value:C.getString("AccessibilityLabel.AudioMessage",{duration:i}),stopProcessing:!1}},this.transformUriObjectFileNode=e=>{const t=new n.default(e.getFileContentUrlSanitized()).getDocumentId(),s=f.default.formatFileSize(e.getSizeInBytes(),1).formattedString;let i;i=t&&y.default.getLocalUri(t)?C.getString("AccessibilityLabel.OpenFile",{fileSize:s}):C.getString("AccessibilityLabel.DownloadFile",{fileSize:s});return{value:C.getString("AccessibilityLabel.Document",{documentName:e.getNameForUI(),fileLabel:i}),stopProcessing:!1}},this.transformLocationNode=e=>({value:C.getString("AccessibilityLabel.Location",{locationName:e.addressFriendlyNameSanitized,address:e.addressSanitized}),stopProcessing:!1}),this.transformMojiNode=e=>({value:C.getString("AccessibilityLabel.Moji",{mojiName:e.getNameForUI()}),stopProcessing:!1}),this.transformStickerNode=e=>({value:C.getString("AccessibilityLabel.Sticker",{stickerName:e.getNameForUI()}),stopProcessing:!1}),this.transformAtMentionNode=e=>{const t=this._renderTextNodes(e.children);let s=t.value;return e.isAllMention()&&(s=e.getLocalizedAllMention()),{value:"("+s+")",stopProcessing:t.stopProcessing}},this.transformScheduledCallInviteNode=e=>{let t="";const s=M.default.getScheduledCallById(e.scheduledCallId);return s&&(t=I.default.getAccessibilityLabelForScheduledCall(s)),{value:t,stopProcessing:!1}},this.transformPollNode=e=>({value:C.getString("Poll.StreamItemAccessibilityLabel",{question:e.title}),stopProcessing:!1}),this.transformCallerIDNode=e=>({value:C.getString("CallerIdPrompt.CallerIDInChatIntro"),stopProcessing:!1})}_renderTextNodes(e){return super._renderTextNodes(e," ")}transformEmoticonNode(e){let t=e.type;const s=g.default.getEmoticonByName(e.type);s&&s.description&&(t=s.description);const i=p.getEmoticonAccessibilityLabel(t,e.tone);return{value:C.getString("AccessibilityLabel.Emoticon",{emoticonName:i}),stopProcessing:!1}}transformQuoteNode(e){const t=this._default(e);return{value:C.getString("AccessibilityLabel.QuotedMessage",{quotedName:e.getAuthorNameWithFallbackUnescaped(),quoteContent:t.value}),stopProcessing:!1}}transformWikiMarkupNode(e){return{value:this._default(e).value||"",stopProcessing:!1}}transformListWikiMarkupNode(e){return this.transformWikiMarkupNode(e)}transformSwiftUriObjectNode(e){if(k.default.isUriNodeTextMessage(e))return this._renderTextNodes(k.default.getTextNodes(e));return{value:C.getString("AccessibilityLabel.Bot"),stopProcessing:!1}}transformPartListNode(e){let t;if(a.default.calculateCallMarkerInfo(e).type===a.CallMarkerType.Missed)t=C.getString("AccessibilityLabel.CallMissed");else t=C.getString("AccessibilityLabel.Call");return{value:t,stopProcessing:!1}}transformContactsNode(e){const t=this._renderTextNodes(e.children);return{value:C.getString("ContactCard.ContactCardAccessibilityLabel",{contactValue:t.value}),stopProcessing:t.stopProcessing}}}function x(e,t){const s=h.default.getMemberShortNameForConversation(e,t.users[0].mri);let i,o=0,n="AccessibilityLabel.Reactions1User";const r=t.users.length;r>1&&(i=h.default.getMemberShortNameForConversation(e,t.users[1].mri),n="AccessibilityLabel.Reactions2Users"),r>2&&(o=t.users.length-2,n="AccessibilityLabel.ReactionsMultipleUsers");const a=g.default.getEmoticonByName(t.key),l={count:t.users.length,firstUser:s,secondUser:i,remainingCount:o,reactionName:a&&a.description?a.description:t.key};return C.getString(n,l)}t.ContentToAccessibilityLabelTransformer=A,t.toAccessibilityLabel=function(e,t){const s=t.message;let o="";try{const s=i.defaults(t,{options:t,processing:{},onlyEmoticons:e.hasOnlyEmoticonsOrWhitespaceText(),utfFallback:!1,onlyQuotedContent:e.hasOnlyQuotedContent(),lineBreakString:"",includeSenderInformationInAccessibilityLabel:!0,includeReactionInformationInAccessibilityLabel:!0,includeMediaAlbumItemCountInAccessibilityLabel:!0,messageAccessibilityType:m.MessageAccessibilityType.Text}),n=new A(s);o=n.transform(e).value||""}catch(e){v.error(S.LogTraceArea.GenericUnsafe,"ContentToAccessibilityLabelTransformer: Failed to transform tree: "+P.default.errorAsString(e))}const n=s.isSendRejected(),d=s.isUnsent(),h=i.find(e.children,(e=>e instanceof b.PartListNode));if(h){const e=r.default.getCallLog(h.callId),t=a.default.calculateCallMarkerInfo(h,e);o=a.CallMarkerDisplayUtils.getTextForAccessibilityLabel(t.type)}if(t.message.isAlbum()&&!t.includeMediaAlbumItemCountInAccessibilityLabel&&(o=C.getString("AccessibilityLabel.MediaAlbumPhotosNoCount")),s.isReported()&&(o=C.getString("MessageContentNodes.ReportedMessageFallback")),!t.includeSenderInformationInAccessibilityLabel)return n?C.getString("AccessibilityLabel.FailedTextMessage",{messageContent:o}):d&&w.default.shouldAnnounceForAccessibility()?C.getString("AccessibilityLabel.TextMessageSending",{messageContent:o}):o;let p=s.creator,g=s.createdTime;const f=s.isBookmarkSourceForCurrentUser(),y=s.isBookmark();let _,M;if(y){const e=l.getBookmarkMetadata(s.properties),t=e&&e.bookmarkSourceCreatorId,o=e&&e.bookmarkSourceComposeTime;t&&(p=t,_=e&&e.bookmarkSourceConversationName),o&&(g=i.toNumber(o))}const I={senderName:(0,u.displayNameText)(p,p),timestamp:y?c.default.getDisplayDateStringDayMonthYearFormat(g):c.default.getDisplayTimeString(g),messageContent:o};if(y)I.receiverConversationName=!_&&T.default.isMyMri(s.creator)?C.getString("DisplayInfoStore.ListMyName"):_,M=C.getString("AccessibilityLabel.BookmarkMessage",I);else switch(t.messageAccessibilityType){case m.MessageAccessibilityType.Media:M=d?C.getString("AccessibilityLabel.MediaMessageSending",I):C.getString("AccessibilityLabel.MediaMessage",I);break;case m.MessageAccessibilityType.Call:M=C.getString("AccessibilityLabel.CallMessage",I);break;default:M=n?C.getString("AccessibilityLabel.FailedTextMessage",{messageContent:C.getString("AccessibilityLabel.TextMessage",I)}):d&&w.default.shouldAnnounceForAccessibility()?C.getString("AccessibilityLabel.TextMessageSending",{messageContent:C.getString("AccessibilityLabel.TextMessage",I)}):l.isThreadActivityType(s.messagetype)||s.isEmote()?C.getString("AccessibilityLabel.SystemMessage",I):s.isEdited()?C.getString("AccessibilityLabel.EditedTextMessage",I):s.messagetype===l.MessageTypes.CallerID?o:C.getString("AccessibilityLabel.TextMessage",I)}if(f&&(M=C.getString("AccessibilityLabel.BookmarkedMessage",{messageContent:M})),!t.includeReactionInformationInAccessibilityLabel)return M;const k=s.getReactions();return M+i.map(k,(e=>x(t.message.conversationId,e))).join("")},t.getAccessibilityLabelForReaction=x,t.toAccessibilityTraits=function(e){}},781725:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toForwardContactInfo=t.toForwardMediaInfo=t.toForwardLocationInfo=t.toForwardUrlInfo=t.toForwardQuoteMessageEntities=t.ContentToForwardMessageTransformer=void 0;const i=s(496486),o=s(265976),n=s(481169),r=s(351077),a=s(671830),l=s(417677),d=s(681959),c=s(986374),h=s(952262),u=s(746096),p=s(497174),g=s(436237),m=s(751176),S=s(312762),f=s(527683),y=s(478262),v=s(510609),C=s(853374);t.ContentToForwardMessageTransformer=class{constructor(){this.transformRootNode=this._default,this.transformHighlightedNode=this._default,this.transformEditMessageMetaDataNode=this._default,this.transformUserMriNode=this._default,this.transformEmoticonNode=this._toUnhandledEntity,this.transformFlagNode=this._toUnhandledEntity,this.transformLegacyQuoteNode=this._default,this.transformBingResponseNode=this._default,this.transformAttributionsTextNode=this._default,this.transformAttributionsGroupNode=this._default,this.transformAtMentionNode=this._default,this.transformEmoteNode=this._toUnhandledEntity,this.transformSuggestedTextHighlightNode=this._toUnhandledEntity,this.transformContextNode=this._toUnhandledEntity,this.transformRosterContextNode=this._default,this.transformLocationContextNode=this._default,this.transformUnknownNode=this._default,this.transformSwiftNode=this._default,this.transformPollNode=this._default,this.transformCallerIDNode=this._default,this.transformHtmlNode=this._default}_default(e){return(0,n.chain)(e.children,(0,n.map)((e=>e&&e.accept(this))),(0,n.compact)(),(0,n.flatten)())}_toUnhandledEntity(e,t){return i.isString(t)||(t=d.renderText(e)),[new p.UnhandledEntity(t)]}transform(e){return e.accept(this)}transformPlainTextNode(e){return this._toUnhandledEntity(e,e.getRawText())}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformQuoteNode(e){return[new p.QuoteEntity(e)]}transformWikiMarkupNode(e){const t=this._default(e),s=C.default.unescapeXml(e.rawPre),i=e.rawPost&&C.default.unescapeXml(e.rawPost);return[new p.WikiMarkupEntity(t,e.getTag(),s,i)]}transformListWikiMarkupNode(e){return this.transformWikiMarkupNode(e)}transformLinkNode(e){const t=d.renderText(e);return[new p.LinkEntity(t,e.getSanitizedHref())]}transformAttributionNode(e){const t=d.renderText(e);return[new p.AttributionEntity(t,e.getSanitizedHref(),e.index)]}},t.toForwardQuoteMessageEntities=function(e){const t=h.default.getDisplayName(e.creator,!0),s=l.quoteMessage(e,t);return new p.QuoteEntity(s,t,e)},t.toForwardUrlInfo=function(e){const t=c.decode(e),s=v.getUrlPreviewInformationForMessage(e,t);if(v.hasOnlyWebLink(s,t)&&s[0].isValid)return s[0]},t.toForwardLocationInfo=function(e){const t=c.decode(e),s=i.find(t.children,(e=>e instanceof S.LocationNode));if(s&&s.latitude&&s.longitude){let t;t=m.default.getImageUriForLocation(s.latitude,s.longitude,e.cuid);return{snapshotUri:t,topAddress:s.addressFriendlyNameSanitized,bottomAddress:s.shortAddressSanitized}}},t.toForwardMediaInfo=function(e){const t=c.decode(e).getFirstUriObjectChild(S.UriObjectFileNode);let s,i;if(t)switch(t.getFileType()){case y.UploadFileType.Picture:case y.UploadFileType.VideoMessage:case y.UploadFileType.Video:t instanceof S.DisplayableMediaWithThumbnail&&(i=t.getDisplayThumbnailUrlSanitized());break;case y.UploadFileType.AudioMessage:t instanceof S.AudioMessageNode&&(s=t.getAudioDurationMs())}const n=r.getMessageTypeGroup(e);if(!t||!t.getFileContentUrlSanitized)return void g.error(u.LogTraceArea.GenericUnsafe,"No url available for this media type message:",n,"most likely an issue from the sender");const a=t.getFileContentUrlSanitized(),l=a&&o.getDocumentId(a);if(!l)return void g.error(u.LogTraceArea.GenericUnsafe,"Invalid media entity document id being forwarded.");const d=t.getOriginalDimensions(),h=d&&d.height&&d.width?d:void 0;return{objectId:l,fileType:t.getFileType(),filename:t.getNameForUI(),dimensions:h,fileSize:t.getSizeInBytes(),localMediaThumbnailUri:i,durationMs:s}},t.toForwardContactInfo=function(e){const t=c.decode(e).getFirstContactNode();if(!t)return;let s;if(t.isPstn&&t.skypeId&&""!==t.skypeId){const e={number:f.default.normalizePartialNumberWithCountryCode(t.skypeId),type:y.PhoneNumberTypes.Other};s=a.getMriFromPhoneNumber(e)}else s=a.skypeIdToMri(t.skypeId);return{skypeId:t.skypeId||"",fullName:t.fullName||"",isPstn:t.isPstn,isS4B:t.isS4B,userMri:s}}},251577:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCacheKeyFullResOrDisplayable=t.getLocalDisplayableOrFullResUri=t.isDisplayableOrFullResImageCached=void 0;const i=s(889391),o=s(265976),n=s(907234);t.isDisplayableOrFullResImageCached=function(e){return i.default.getS4LMessagingFeaturesNoSubscription().enableFullResolutionImageDownload?n.default.isKnown(o.getFileCacheKeyMedia(e,!1))||n.default.isKnown(o.getFileCacheKeyMedia(e,!0)):n.default.isKnown(o.getFileCacheKeyMedia(e,!1))},t.getLocalDisplayableOrFullResUri=function(e,t=!1){return i.default.getS4LMessagingFeaturesNoSubscription().enableFullResolutionImageDownload?n.default.getLocalUri(o.getFileCacheKeyMedia(e,t))||n.default.getLocalUri(o.getFileCacheKeyMedia(e,!t)):n.default.getLocalUri(o.getFileCacheKeyMedia(e,!1))},t.getCacheKeyFullResOrDisplayable=function(e){return i.default.getS4LMessagingFeaturesNoSubscription().enableFullResolutionImageDownload&&n.default.isKnown(o.getFileCacheKeyMedia(e,!0))?o.getFileCacheKeyMedia(e,!0):o.getFileCacheKeyMedia(e,!1)}},841190:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.attemptTokenRefresh=void 0;const i=s(397691),o=s(472918),n=s(265976),r=s(746096),a=s(436237),l=s(914976);t.attemptTokenRefresh=function(e){return n.isAsyncMediaUrl(e)?(a.log(r.LogTraceArea.GenericUnsafe,"AMS file did not load, we try to set auth cookie and try again",l.dev_unknownOmit(e)),o.default.setAuthCookieDebounced()):i.Rejected(void 0)}},120948:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.postAudio=void 0;const i=s(397691),o=s(690247),n=s(746096),r=s(812056),a=s(785207);function l(e,t){const s={name:t},i=o.default.getRecordingResult();a.default.postUpload([e],i.data,n.PostSource.AudioMessageComposer,!0,{scenarioInfo:s},void 0,{messageDurationMs:i.durationMs,contentType:r.MessageComposerSentContentType.Audio})}t.postAudio=function(e,t){if(o.default.getRecordingState()===o.RecordingState.HasAudio)return l(e,t),i.Resolved();const s=i.Defer(),n=o.default.subscribe((()=>{switch(o.default.getRecordingState()){case o.RecordingState.None:o.default.unsubscribe(n),s.reject();break;case o.RecordingState.HasAudio:o.default.unsubscribe(n),l(e,t),s.resolve(void 0)}}));return s.promise()}},343632:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getAvatarColorsFromMri=t.defaultAvatarColors=t.getLocalizedColorName=t.getInputEntityUrl=t.canGenerateAvatars=void 0;const i=s(732183),o=s(497174),n=s(733754),r=s(526424),a=s(135455),l=s(581760);t.canGenerateAvatars=function(){return!!HTMLCanvasElement.prototype.toBlob},t.getInputEntityUrl=function(e,t=r.EmoticonSize.ExtraExtraLarge,s=a.StickerSize.ThumbLarge){return e instanceof o.EmoticonEntity?(0,i.getEmoticonUrl)(e.emoticonName,t,!0,e.tone):e instanceof o.StickerEntity&&(0,a.getStickerUrl)(e.uri,s,!1,!0)||""},t.getLocalizedColorName=function(e){switch(e){case"White":return n.getString("Color.White");case"Red":return n.getString("Color.Red");case"Orange":return n.getString("Color.Orange");case"Yellow":return n.getString("Color.Yellow");case"Yellowgreen":return n.getString("Color.Yellowgreen");case"Green":return n.getString("Color.Green");case"Bluegreen":return n.getString("Color.Bluegreen");case"Blue":return n.getString("Color.Blue");case"Blueviolet":return n.getString("Color.Blueviolet");case"Violet":return n.getString("Color.Violet");case"Redviolet":return n.getString("Color.Redviolet")}return""},t.defaultAvatarColors=[{key:"Red",textColor:l.Color.avatarRed,background:[l.Color.avatarRedLighter,l.Color.avatarRedLight]},{key:"Orange",textColor:l.Color.avatarOrange,background:[l.Color.avatarOrangeLighter,l.Color.avatarOrangeLight]},{key:"brown",textColor:l.Color.avatarBrown,background:[l.Color.avatarBrownLighter,l.Color.avatarBrownLight]},{key:"Olive",textColor:l.Color.avatarOlive,background:[l.Color.avatarOliveLighter,l.Color.avatarOliveLight]},{key:"Green",textColor:l.Color.avatarGreen,background:[l.Color.avatarGreenLighter,l.Color.avatarGreenLight]},{key:"Teal",textColor:l.Color.avatarTeal,background:[l.Color.avatarTealLighter,l.Color.avatarTealLight]},{key:"Cyan",textColor:l.Color.avatarCyan,background:[l.Color.avatarCyanLighter,l.Color.avatarCyanLight]},{key:"Blue",textColor:l.Color.avatarBlue,background:[l.Color.avatarBlueLighter,l.Color.avatarBlueLight]},{key:"Blueviolet",textColor:l.Color.avatarBlueviolet,background:[l.Color.avatarBluevioletLighter,l.Color.avatarBlueLight]},{key:"purple",textColor:l.Color.avatarPurple,background:[l.Color.avatarPurpleLighter,l.Color.avatarPurpleLight]},{key:"Fuchsia",textColor:l.Color.avatarFuchsia,background:[l.Color.avatarFuchsiaLighter,l.Color.avatarFuchsiaLight]},{key:"Violet",textColor:l.Color.avatarViolet,background:[l.Color.avatarVioletLighter,l.Color.avatarVioletLight]}],t.getAvatarColorsFromMri=function(e){const s=e.includes("@")?e.indexOf("@"):e.length,i=e.substring(s-3,s);let o=0;for(const e of i)o+=e.charCodeAt(0);return t.defaultAvatarColors[o%t.defaultAvatarColors.length]}},587430:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSourceMessageDate=t.bookmarkMessageAction=void 0;const i=s(496486),o=s(397691),n=s(929815),r=s(351077),a=s(436237),l=s(733754),d=s(812056),c=s(886045),h=s(422538);t.bookmarkMessageAction=function(e,t,s){return h.EnsureStarted(n.default).then((()=>o.all(i.map(e,(e=>{const s=e.message,i=s.isBookmarkSourceForCurrentUser();if(s.isBookmark()||i){let e=s.createdTime;if(i){const t=s.getBookmarkSourceMetadataForCurrentUser();t&&t.id&&(e=Number(t.id))}return n.default.deleteBookmark(s).then((()=>{c.default.maybeAnnounceForAccessibility(l.getString("StreamItem.RemoveBookmarkConfirmation")),a.track(new d.MessageActionTelemetry(s.conversationId,s,e,t,d.MessageActionType.RemoveBookmark))}))}return n.default.bookmarkMessage(s,e.forwardAlbumId).then((()=>{a.track(new d.MessageActionTelemetry(s.conversationId,s,s.createdTime,t,d.MessageActionType.AddBookmark))}))}))))).then((()=>{s&&s()}))},t.getSourceMessageDate=function(e){const t=r.getBookmarkMetadata(e);return t?t.bookmarkSourceComposeTime:void 0}},893733:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContactMessageRenderingOptions=t.SwiftMessageRenderingOptions=t.PollRenderingOptions=t.ScheduledCallRenderingOptions=t.CallInfoRenderingOptions=t.FileMessageRenderingOptions=t.LocationRenderingOptions=void 0;const i=s(496486),o=s(516778),n=s(764097),r=s(465127),a=s(351077),l=s(671830),d=s(228229),c=s(913991),h=s(770891),u=s(915877),p=s(312762),g=s(563032),m=s(600750),S=s(932293),f=(0,u.lazyProperties)({radius:()=>(0,u.lazyProperties)({swiftCarousel:()=>o.Styles.createViewStyle({borderRadius:0})}),containerPadding:()=>(0,u.lazyProperties)({cardWithSender:()=>o.Styles.createViewStyle({paddingTop:10})})});class y extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showTouchFeedbackOnPress:!0,showLocationCard:!0,showOuterButtons:this._outerButtonsFit,accessibilityLabelType:h.MessageAccessibilityType.Media};return i.assign({},e,t)}getMessageActions(e){const t=this._outerButtonsFit,s=!this._outerButtonsFit,i=this._defaultSupportsAddReactionsInActionMenu||this._defaultSupportsPostingReactions&&s;return{actionMenuCommands:this.getActionMenuCommands({supportsPostingReactions:i,supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsQuotes:!0,copyCommand:this._defaultSupportsCopy?m.CommandTypes.CopyLocation:void 0,supportsBookmarks:this._defaultSupportsBookmark}),outerButtonCommands:t?this.getActionsForButtonsToBeRenderedInMessageView(this._supportsForward,this._defaultSupportsAddReactionInMessageView,!0).concat(e.outerButtonCommands):[]}}}y.messageTypeGroup=a.MessageTypeGroups.Location,t.LocationRenderingOptions=y;class v extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showOuterButtons:this._outerButtonsFit,accessibilityLabelType:h.MessageAccessibilityType.Media,availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:c.getFileNodeRenderDimensions,isDraggingEnabled:this._defaultSupportsDragging,sendingStatus:r.getOverriddenFileSendingStatus(e.sendingStatus)};return i.assign({},e,t)}getMessageActions(e){const t=l.isEncryptedThread(this._messageProperties.skypeMessage.conversationId),s=r.isFileAvailable(this._messageProperties.skypeMessage.createdTime),i=this._supportsForward&&!t&&s,o=this._defaultSupportsAddReactionsInActionMenu||this._defaultSupportsPostingReactions&&!this._outerButtonsFit;let n=this.getActionMenuCommands({supportsPostingReactions:o,supportsForward:i,supportsQuotes:!0,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,saveAsCommand:undefined,openFileLocationCommand:r.canOpenFileLocation(this._messageProperties.decodedNode)?m.CommandTypes.OpenFileLocation:void 0,supportsBookmarks:this._defaultSupportsBookmark});n=n.concat(e.actionMenuCommands);return{actionMenuCommands:n,outerButtonCommands:this._outerButtonsFit?this.getActionsForButtonsToBeRenderedInMessageView(i,this._defaultSupportsAddReactionInMessageView,!0).concat(e.outerButtonCommands):[]}}}v.messageTypeGroup=a.MessageTypeGroups.UriFile,t.FileMessageRenderingOptions=v;class C extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showReactionsOnMessage:!1,showMessageSender:!1,showMessageSenderIcon:!1,showMessageTimestamp:!1,sendingStatus:e.sendingStatus===g.MessageRenderSendingStatus.Sending?g.MessageRenderSendingStatus.None:e.sendingStatus,removeMessageSpacer:!0,messageContentExpandedToAvailableArea:!0,accessibilityLabelType:h.MessageAccessibilityType.Call};return i.assign({},e,t)}getMessageActions(e){let t=this.getActionMenuCommands({supportsPostingReactions:!1,supportsBookmarks:!1});t=t.concat(e.actionMenuCommands);return{actionMenuCommands:t,outerButtonCommands:this._outerButtonsFit?this.getActionsForButtonsToBeRenderedInMessageView(!1,!1,!1).concat(e.outerButtonCommands):e.outerButtonCommands}}}C.messageTypeGroup=a.MessageTypeGroups.Calling,t.CallInfoRenderingOptions=C;class _ extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showReactionsOnMessage:!1,sendingStatus:e.sendingStatus===g.MessageRenderSendingStatus.Sending?g.MessageRenderSendingStatus.None:e.sendingStatus,accessibilityLabelType:h.MessageAccessibilityType.Media,includeAccessibilityPropertiesOnMessageHeader:!0},s=this._messageProperties.decodedNode.getFirstUriObjectChild(p.ScheduledCallInviteNode);return s&&!i.isUndefined(s.canceledTimeMs)&&(t.showMessageSender=!1,t.showMessageTimestamp=!1,t.showMessageSenderIcon=!1,t.showStreamItemAccessory=!1),i.assign({},e,t)}getMessageActions(e){let t=this.getActionMenuCommands({supportsRemove:!1,supportsQuotes:!0,supportsCancelScheduledCall:this._messageProperties.postedByCurrentUser,supportsEditScheduledCall:!0,supportsBookmarks:!1});return t=t.concat(e.actionMenuCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}_.messageTypeGroup=a.MessageTypeGroups.ScheduledCallInvite,t.ScheduledCallRenderingOptions=_;class b extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showReactionsOnMessage:!1,sendingStatus:e.sendingStatus===g.MessageRenderSendingStatus.Sending?g.MessageRenderSendingStatus.None:e.sendingStatus,accessibilityLabelType:h.MessageAccessibilityType.Media,messageContainerStyle:f.containerPadding.cardWithSender,includeAccessibilityPropertiesOnMessageHeader:!0};return this._messageProperties.decodedNode.getFirstUriObjectChild(p.PollNode)&&(t.showStreamItemAccessory=!0),i.assign({},e,t)}getMessageActions(e){let t=this.getActionMenuCommands({supportsRemove:!1,supportsQuotes:!0,supportsCancelPoll:this._defaultSupportsRemove,supportsBookmarks:!1});return t=t.concat(e.actionMenuCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}b.messageTypeGroup=a.MessageTypeGroups.Poll,t.PollRenderingOptions=b;class T extends d.DefaultMessageRenderingOptions{constructor(e){super(e),this.messageProperties=e,this._isAdaptiveNodeCard=n.default.isAdaptiveCard(this._messageProperties.decodedNode),this._isAdaptiveNodeCarousel=n.default.isAdaptiveCardCarousel(this._messageProperties.decodedNode),this._isSwiftNodeCard=S.default.isSwiftCard(this._messageProperties.decodedNode),this._isSwiftNodeCarousel=S.default.isSwiftCarousel(this._messageProperties.decodedNode),this._showOuterButtons=!this._isSwiftNodeText&&(!this._isSwiftNodeCarousel||this._isSwiftNodeCarousel&&(this.messageProperties.isNewsBot||this.messageProperties.isNewsChannel)),this._isSwiftNodeText=S.default.isNodeTextMessage(this._messageProperties.decodedNode)&&!this._isSwiftNodeCarousel,this._swiftCardAttribution=S.default.getSwiftCardAttribution(this.messageProperties.decodedNode)}getMessageSpecificViewRenderingOptions(e){let t;return t=this._isAdaptiveNodeCard?{renderMessageBackground:!1,messageContentExpandedToAvailableArea:this._isAdaptiveNodeCarousel,showOuterButtons:!this._isAdaptiveNodeCarousel&&this._outerButtonsFit,showReactionButtonInsideMessageView:!this._showOuterButtons&&this._defaultSupportsAddReactionInMessageView,removeMessageSpacer:!0,includeAccessibilityPropertiesOnMessageHeader:!0,messageContainerStyle:f.containerPadding.cardWithSender,messageContainerRadiusStyle:this._isAdaptiveNodeCarousel?[f.radius.swiftCarousel]:void 0,contentScrollEnabled:this._isAdaptiveNodeCarousel}:{renderMessageBackground:this._messageProperties.isNewsChannel||this._messageProperties.isNewsBot||this._isSwiftNodeText,messageContentExpandedToAvailableArea:this._isSwiftNodeCarousel,showOuterButtons:this._showOuterButtons&&this._outerButtonsFit,showReactionButtonInsideMessageView:!this._showOuterButtons&&this._defaultSupportsAddReactionInMessageView,removeMessageSpacer:this._isSwiftNodeCard||this._isSwiftNodeCarousel,messageContainerRadiusStyle:!this._isSwiftNodeCarousel||this._messageProperties.isNewsChannel||this._messageProperties.isNewsBot?e.messageContainerRadiusStyle:[f.radius.swiftCarousel],includeAccessibilityPropertiesOnMessageHeader:this._isSwiftNodeCard||this._isSwiftNodeCarousel,messageContainerStyle:this._isSwiftNodeText?void 0:f.containerPadding.cardWithSender,contentScrollEnabled:this._isSwiftNodeCarousel,swiftCardAttribution:this._swiftCardAttribution,shouldAnimateEmoticons:!0,availableSpace:this._messageProperties.containerMaxDimensions,showReactionsOnMessage:this._messageProperties.isNewsChannel||e.showReactionsOnMessage,overlayReactionsOnMessage:this._messageProperties.isNewsChannel||e.overlayReactionsOnMessage},i.assign({},e,t)}getMessageActions(e){const t=this._supportsForward&&S.default.isShareable(this._messageProperties.decodedNode),s=this._defaultSupportsAddReactionsInActionMenu||this._defaultSupportsPostingReactions&&this._showOuterButtons&&!this._outerButtonsFit,i=this._isSwiftNodeText&&this._defaultSupportsCopy?m.CommandTypes.Copy:void 0;let o=this.getActionMenuCommands({supportsPostingReactions:s,supportsForward:t,supportsRemove:this._defaultSupportsRemove,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages&&!this.messageProperties.isNewsChannel&&!this.messageProperties.isNewsBot,copyCommand:i,supportsQuotes:!this.messageProperties.isNewsChannel&&!this.messageProperties.isNewsBot,supportsViewLink:!1,supportsBookmarks:this._defaultSupportsBookmark});o=o.concat(e.actionMenuCommands);return{actionMenuCommands:o,outerButtonCommands:this._outerButtonsFit&&this._showOuterButtons?this.getActionsForButtonsToBeRenderedInMessageView(t,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands):e.outerButtonCommands}}}T.messageTypeGroup=a.MessageTypeGroups.SwiftCard,t.SwiftMessageRenderingOptions=T;class M extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showOuterButtons:this._outerButtonsFit,accessibilityLabelType:h.MessageAccessibilityType.Media,availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:c.getContactNodeRenderDimensions};return i.assign({},e,t)}getMessageActions(e){const t=this._supportsForward,s=this._defaultSupportsAddReactionsInActionMenu||this._defaultSupportsPostingReactions&&!this._outerButtonsFit;let i=this.getActionMenuCommands({supportsPostingReactions:s,supportsForward:t,supportsQuotes:!0,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsBookmarks:this._defaultSupportsBookmark});i=i.concat(e.actionMenuCommands);return{actionMenuCommands:i,outerButtonCommands:this._outerButtonsFit?this.getActionsForButtonsToBeRenderedInMessageView(t,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands):[]}}}M.messageTypeGroup=a.MessageTypeGroups.Contact,t.ContactMessageRenderingOptions=M},465127:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getOverriddenFileSendingStatus=t.isFileAvailable=t.canOpenFileLocation=void 0;const i=s(889391),o=(s(225638),s(816402)),n=(s(462937),s(312762),s(563032));t.canOpenFileLocation=function(e){return!1},t.isFileAvailable=function(e){const t=i.default.getS4LCMCFeaturesNoSubscription().callRecorderRetentionDurationDays;return o.default.getDaysDifferenceToNow(e)<t},t.getOverriddenFileSendingStatus=function(e){return e===n.MessageRenderSendingStatus.Sending?n.MessageRenderSendingStatus.None:e}},381660:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transformEvent=void 0;const i=s(496486),o=s(436237),n=s(746096),r=s(404057),a=s(351077),l=s(671830),d=s(18078),c=s(539549),h=s(609959);function u(e,t,s,o){try{const r=e,h=function(e,t){const s=null!=t?t:e.to;if(l.isOneToOneThread(s)){const t=l.getCreatorMriForMessageFromLink(e.from);let o=t;if((d.default.isMyMri(t)||l.isOneToOneThread(o))&&(o=(0,c.default)().getOtherPartyMriFromOneToOneThreadId(s),i.isUndefined(o)))return;return l.getConversationLinkWithNewId(e.conversationLink,o)}return e.conversationLink}(e,t);return void 0===h?(m("Empty transformed conversationLink",t,s,o),!1):(r.messagetype=(n=e.messagetype).endsWith("/None")?n.substring(0,n.indexOf("/None")):n,r.conversationLink=h,r.skypeemoteoffset=(0,a.getJsonFromMessageProperty)(e.properties,a.MessageProperties.Skypeemoteoffset),r.eventId=p(e.properties,a.MessageProperties.EventId),r.isVideoCall=p(e.properties,a.MessageProperties.IsVideoCall),!0)}catch(e){return m("Failed to transform a message",t,s,o,r.default.errorAsString(e)),!1}var n}function p(e,t){const s=null==e?void 0:e[t];if(s)return r.default.asString(s)}function g(e){e.lastMessage=null}function m(e,t,s,i,r){o.warn(n.LogTraceArea.ChatService,`Event transformation failed for reason: ${e}, cv: ${s}, eventType: ${i}, error: ${r}`),o.track(new h.ChatServiceTransformationFailureEvent({reason:e,cv:s,resourceType:i,error:r,threadSuffix:t?l.getThreadSuffix(t):void 0,mriNamespace:t?l.getMriNamespace(t):void 0}))}t.transformEvent=function(e){switch(e.resourceType){case"CustomUserProperties":case"ThreadUpdate":break;case"ConversationUpdate":const t=e.resource;if(l.isOneToOneThread(t.id)){const s=(0,c.default)().getOtherPartyMriFromOneToOneThreadId(t.id);if(i.isUndefined(s))return m("Missing 1:1 mapping",t.id,e.cv,e.resourceType),!1;t.id=s}t.lastMessage&&(!i.isEmpty(t.lastMessage)&&u(t.lastMessage,t.id,e.cv,e.resourceType)||g(t),function(e){if(!e.lastMessage)return;"0"===e.lastMessage.id&&g(e)}(t));break;case"NewMessage":case"MessageUpdate":if(!u(e.resource,void 0,e.cv,e.resourceType))return!1;break;default:return m("Unknown event resource type",void 0,e.cv,e.resourceType),!1}return!0}},871908:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setConversationSubscription=t.addMemberToThread=t.deleteBookmark=t.deleteBookmarkSource=t.markMessageBookmarked=t.markMessageReported=t.markScheduledCallAsRead=t.respondToScheduledCallProp=t.toggleVoteInReactionsProp=t.toggleVoteInPollCustomProp=t.setVote=t.markReactionsAsRead=t.changeEmotionAnnotation=t.removeEmotionAnnotation=t.addEmotionAnnotation=t.uploadConversationIcon=t.markMessageUnreadFromGivenMessage=t.markMessageUnreadFromConversationLastMessage=t.markMessageUnread=t.markConversationRead=t.didUserSendSmsInLast30Days=t.getSkypeBotConversation=t.setUserComposingStateIfSupported=t.removeParticipantFromConversation=t.deleteConversationAsync=t.leaveConversationAsync=void 0;const i=s(496486),o=s(397691),n=s(219784),r=s(18078),a=s(812056),l=s(901246),d=s(735370),c=s(889391),h=s(216568),u=s(562141),p=s(436237),g=s(733754),m=s(914976),S=s(404057),f=s(898278),y=s(746096),v=s(821780),C=s(366355),_=s(211375),b=s(853374),T=s(765369),M=s(265976),I=s(351077),w=s(671830),P=s(61375),k=s(720603),A=s(422801),x=s(476621),R=s(926459),O=s(539549),L=s(666765),F=s(891114);function B(e){if(e.countsForUnreadCounts())return D(e),o.Resolved(!0);return u.default.getMessagesNotSentByMe(e.conversationId,e.createdTime,10,!0).then((t=>(function(e,t){const s=i.findIndex(e,(e=>e.countsForUnreadCounts()));if(s>=0&&e.length>s+1)return A.default.setConsumptionHorizonToMessage(t.conversationId,e[s+1],!0),!0;return!1}(t,e)||A.default.setFakeConsumptionHorizonBeforeFirstEverMessage(e.conversationId,e,!0),!0))).fail((t=>{p.warn(y.LogTraceArea.ConsumptionHorizon,"Could not mark message unread: "+m.mriOrId(e.conversationId)+" "+S.default.errorAsString(t))}))}function D(e){return u.default.getMessagesForConversationBeforeTime(e.conversationId,e.createdTime,1,!0).then((t=>t.length>0?(A.default.setConsumptionHorizonToMessage(t[0].conversationId,t[0],!0),t[0].createdTime):(A.default.setFakeConsumptionHorizonBeforeFirstEverMessage(e.conversationId,e,!0),e.createdTime))).fail((t=>{p.warn(y.LogTraceArea.ConsumptionHorizon,"Could not mark message unread: "+m.mriOrId(e.conversationId)+" "+S.default.errorAsString(t))}))}function E(e,t,s){var n;const a=I.getEmotionMetadata(e.properties),l=r.default.getSkypeMri(),d=I.addEmotionMetadataForUser(i.cloneDeep(a),l,t,s);if(!d)return o.Rejected();const h=i.find(d,(e=>e.key===t));if(!h)return o.Rejected();if(!i.find(h.users,(e=>e.mri===l)))return o.Rejected();(null===(n=c.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===n?void 0:n.enabled)&&void 0===s&&(s=String(Date.now()));const u=JSON.stringify({key:t,value:s});return A.default.setMessageProperty(e,I.MessageProperties.Emotions,u,JSON.stringify(d))}function V(e,t){const s=I.getEmotionMetadata(e.properties),n=r.default.getSkypeMri();if(t===I.MessageAnnotations.Heart){i.some(s,(e=>e.key===I.MessageAnnotations.Like&&i.some(e.users,(e=>e.mri===n))))&&(t=I.MessageAnnotations.Like)}const a=I.removeEmotionMetadataForUser(i.cloneDeep(s),n,t);if(!a)return o.Rejected();const l=i.find(a,(e=>e.key===t));if(l){if(i.find(l.users,(e=>e.mri===n)))return o.Rejected()}const d=JSON.stringify({key:t});return A.default.setMessageProperty(e,I.MessageProperties.Emotions,d,JSON.stringify(a),!0)}function N(e,t,s){const n=I.getEmotionMetadata(e.properties),a=r.default.getSkypeMri(),l=i.find(n,(e=>e.key===s));if(l){if(i.find(l.users,(e=>e.mri===a)))return o.Rejected()}let d=I.removeEmotionMetadataForUser(i.cloneDeep(n),a,t);if(!d)return o.Rejected();if(d=I.addEmotionMetadataForUser(i.cloneDeep(d),a,s),!d)return o.Rejected();const c=JSON.stringify({key:t}),h=JSON.stringify({key:s}),u=e.getServerIdForPropertyChanges();if(!u)return o.Rejected();const p=I.MessageProperties.Emotions;return x.default.setMessagePropertyLie(e.conversationId,e.cuid,p,JSON.stringify(d)).then((()=>{A.default.serviceSetMessageProperty(e.conversationId,u,p,c,!0).catch((()=>{const t=JSON.stringify(d);x.default.revertMessagePropertyLie(e.conversationId,e.cuid,p,t)})),A.default.serviceSetMessageProperty(e.conversationId,u,p,h).catch((()=>{const t=JSON.stringify(d);x.default.revertMessagePropertyLie(e.conversationId,e.cuid,p,t)}))}))}function U(e,t,s){let i=I.getPollMetadata(e.properties);if(!i)return o.Rejected();const n=r.default.getSkypeMri();t&&(i=I.removeVoteForUser(i,n,t)),s&&(i=I.addOrUpdateVoteForUser(i,n,s));const a=JSON.stringify(i);return A.default.setMessageProperty(e,I.MessageProperties.PollData,a,a)}function j(e,t,s){return t&&s?N(e,t,s):t?V(e,t):s?E(e,s):o.Rejected()}function H(e,t,s){return I.getPollMetadata(e.properties)&&t!==s?j(e,t,s):o.Rejected()}t.leaveConversationAsync=function(e,t){const s=(0,O.default)().getConversation(e);let o=r.default.getSkypeMri();if(s){const e=i.find(s.getThreadMembers(),(e=>r.default.isMyMri(e.id)&&w.getMriNamespace(e.id)!==w.Namespaces.MSA));e&&(o=e.id)}return v.default.deleteMyConfiguredConnectors(e).always((()=>{A.default.serviceRemoveMemberFromThread(e,o,t).fail((e=>{p.error(y.LogTraceArea.ChatService,"Error leaving conversation: "+S.default.errorAsString(e)),n.default.showErrorAlert(g.getString("InfoPanel.LeaveFailed"),f.MainRootViewId)}))}))},t.deleteConversationAsync=function(e,t,s){return A.default.serviceDeleteConversation(e,t).then((()=>{p.track(new F.ConversationDeleted(e,t,s)),_.setFocus(_.FocusEvent.ConversationDeleted)})).fail((i=>{p.error(y.LogTraceArea.ChatService,"Error deleting conversation: "+S.default.errorAsString(i)),p.track(new F.ConversationDeletionFailed(e,i.statusCode,t,s)),n.default.showErrorAlert(g.getString("InfoPanel.DeleteConversationFailed"),f.MainRootViewId)}))},t.removeParticipantFromConversation=function(e,t,s){let i=o.Rejected();return t&&e?(0,O.default)().isConversationKnown(t)?i=w.isConnector(e)?v.default.deleteConnectorFromChatService(t,e):v.default.deleteConversationConfiguredConnectorsForUser(t,e).always((()=>A.default.serviceRemoveMemberFromThread(t,e,s))):p.error(y.LogTraceArea.ChatService,"We somehow don't know about the conversation..."):p.error(y.LogTraceArea.ChatService,"Could not remove user because conversation or user mri were not provided as a prop"),i},t.setUserComposingStateIfSupported=function(e,t){if(!w.isComposingStateSupported(t,e))return;if(A.default.errorHandler.get429Timer().getBackoffMinTime()>Date.now())return void p.error(y.LogTraceArea.ChatService,"set UserComposingState - ignoring when throttled by chat service");const s={messagetype:e?I.MessageTypes.Typing:I.MessageTypes.ClearTyping,contenttype:"Application/Message",composetime:(new Date).toISOString(),content:"",properties:{}};A.default.servicePostMessageToConversation(t,s,P.PostMessageToConversationSource.UserComposingState,T.CSRequestScenarios.userComposingState).then(i.noop).catch(i.noop),p.track(new a.MessageTyping(t,h.default.EdfRegistrationId.get(),L.default.getEndpointId()))},t.getSkypeBotConversation=function(){const e=w.sanitizeMri(c.default.getConfigSettingsNoSubscription().feedbackBot.id,w.Namespaces.Bot);return x.default.getConversationMetaAsync(e).then((e=>e?e.conv:void 0))},t.didUserSendSmsInLast30Days=function(e){return u.default.getMessagesSentByMeSinceTime(e,Date.now()-2592e6,void 0,!1).then((e=>i.some(e,(e=>I.getMessageTypeGroup(e)===I.MessageTypeGroups.SMS))))},t.markConversationRead=function(e){p.log(y.LogTraceArea.ConsumptionHorizon,"Marking conversation read "+m.mriOrId(e)),u.default.getMessagesForConversationBeforeTime(e,Number.MAX_VALUE,50,!1).then((t=>{const s=i.find(t,(e=>!!e.getOriginalServerId()));if(s){A.default.setConsumptionHorizonToMessage(e,s,!1);const t=s.getConsumptionHorizonString();p.track(new F.ConversationMarkedRead(e,t))}else{const t=(0,O.default)().getConversation(e);if(t&&t.lastMessage)if(t.lastMessage.getOriginalServerId()){A.default.setConsumptionHorizonToMessage(e,t.lastMessage,!1);const s=t.lastMessage.getConsumptionHorizonString();p.track(new F.ConversationMarkedRead(e,s))}else p.warn(y.LogTraceArea.ConsumptionHorizon,"Could not mark conversation read, as last message does not have a CH timestamp "+m.mriOrId(e));else p.warn(y.LogTraceArea.ConsumptionHorizon,"Could not mark conversation read, no last message "+m.mriOrId(e))}}))},t.markMessageUnread=function(e){const t=R.default.getPreviousConsumptionHorizon(e);if(t)A.default.setConsumptionHorizon(e,t,!0),R.default.onMarkConversationUnread(e);else{const t=(0,O.default)(),s=t.getConversation(e),i=s&&s.lastMessage||t.getFakeLastMessageFallback(e);i&&B(i).then((t=>{t&&R.default.onMarkConversationUnread(e)}))}},t.markMessageUnreadFromConversationLastMessage=B,t.markMessageUnreadFromGivenMessage=D,t.uploadConversationIcon=function(e,t,s){const i=b.default.newGuid();return k.default.createDocumentGetIdAsync([e],t.file.name,s,void 0,i).then((o=>k.default.uploadDocumentAsync(o,s,t.file,void 0,i).then((()=>{const t=M.getDocumentUrls(o,s);return A.default.setThreadProperty(e,w.ThreadProps.Picture,"URL@"+t.original)}))))},t.addEmotionAnnotation=E,t.removeEmotionAnnotation=V,t.changeEmotionAnnotation=N,t.markReactionsAsRead=function(e){const t=Date.now(),s=String(t),o=i.filter(I.getEmotionMetadata(e.properties),(e=>e.key!==I.MessageAnnotations.ReactionsConsumptionHorizon));o.push({key:I.MessageAnnotations.ReactionsConsumptionHorizon,users:[{mri:e.creator,value:s,time:t}]});const n=JSON.stringify({key:I.MessageAnnotations.ReactionsConsumptionHorizon,value:s,time:t});return A.default.setMessageProperty(e,I.MessageProperties.Emotions,n,JSON.stringify(o))},t.setVote=function(e,t,s){return I.isPollUsingCustomProp(e.properties)?U(e,t,s):H(e,t,s)},t.toggleVoteInPollCustomProp=U,t.toggleVoteInReactionsProp=H,t.respondToScheduledCallProp=function(e,t,s){return I.getScheduledCallMetadata(e.properties)&&s!==t?j(e,s,t):o.Rejected()},t.markScheduledCallAsRead=function(e){const t=I.getScheduledCallInviteData(e.properties),s={consumptionHorizons:{[r.default.getSkypeMri()]:Date.now()}},o=i.merge({},t,s),n=JSON.stringify(o);return A.default.setMessageProperty(e,I.MessageProperties.ScheduledCallInviteData,n,n)},t.markMessageReported=function(e,t){x.default.markMessageAsReported(e.conversationId,e.cuid,t)},t.markMessageBookmarked=function(e,t){const s=r.default.getSkypeMri(),n=I.MessageAnnotations.Bookmark,a=I.getBookmarkSourceMetadata(e.properties),l=I.addOrUpdateBookmarkMetadataForUser(i.cloneDeep(a),s,t);if(!l)return p.error(y.LogTraceArea.Bookmarks,"Failed to update bookmark annotations metadata."),o.Rejected();const d=i.find(l,(e=>e.key===n));if(!d)return p.error(y.LogTraceArea.Bookmarks,"Failed to find bookmark message annotation."),o.Rejected();const c=i.find(d.users,(e=>e.mri===s));if(!c)return p.error(y.LogTraceArea.Bookmarks,"Failed to find bookmark message annotation for current user."),o.Rejected();const h=JSON.stringify({key:n,value:c.value});return A.default.setMessageProperty(e,I.MessageProperties.Poll,h,JSON.stringify(l))},t.deleteBookmarkSource=function(e){if(!e)return p.log(y.LogTraceArea.ChatService,"SkypeMessageLocal needs to be provided for deleting bookmark source."),o.Rejected();const t=I.getBookmarkSourceMetadata(e.properties),s=r.default.getSkypeMri(),n=I.MessageAnnotations.Bookmark,a=I.removeBookmarkMetadataForUser(i.cloneDeep(t),s),l=i.find(a,(e=>e.key===n));if(l){if(i.find(l.users,(e=>e.mri===s)))return o.Resolved()}const d=JSON.stringify({key:n});return A.default.setMessageProperty(e,I.MessageProperties.Poll,d,JSON.stringify(a),!0)},t.deleteBookmark=function(e){if(!e)return p.error(y.LogTraceArea.ChatService,"Bookmark message ID is required for delete operation."),o.Rejected();const t=w.BookmarksThreadId,{enableDirectBookmarkDelete:s}=c.default.getS4LMessagingFeatures();if(p.log(y.LogTraceArea.ChatService,`Deleting bookmark message. id:${e} isDirectDelete:${s}`),s)return A.default.serviceDeleteMessage(t,e).then(i.noop).catch((e=>{p.error(y.LogTraceArea.ChatService,`There was an error while removing bookmark message. Error: ${S.default.errorAsString(e)}`)}));{const s=I.MessageProperties.DeleteTime,i=Date.now();return A.default.serviceSetMessageProperty(t,e,s,i).catch((e=>{p.error(y.LogTraceArea.ChatService,`There was an error while removing bookmark message. Error: ${S.default.errorAsString(e)}`)}))}},t.addMemberToThread=function(e,t,s){return A.default.serviceAddMemberToThread(e,t,s,!1)},t.setConversationSubscription=function(e,t){return A.default.setConversationSubscription(e,t).then((()=>{const s=d.getConversationTypeForTelemetry(e);p.track(new l.ChatNotificationsToggleSetting(t!==w.SubscriptionTypes.Muted,void 0,e,t,C.NotificationsSource.BotChatSettingsPanel,s))}))}},887399:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isConversationObjectBlocked=t.isConversationBlocked=t.isConversationBlockedAsync=void 0;const i=s(397691),o=s(63413),n=s(671830),r=s(539549),a=s(422538);t.isConversationBlockedAsync=function(e){return i.all([(0,r.default)().getConversationPotentiallyBeforeStartupAsync(e),a.EnsureStarted(o.default)]).then((([e])=>(0,r.default)().isConversationBlocked(e)))},t.isConversationBlocked=function(e){if(n.isGroupConversation(e))return o.default.isMriBlocked(e);if(n.isThread(e)){const t=(0,r.default)().getConversation(e),s=t?t.getOtherPartyMri():void 0;return!!s&&o.default.isMriBlocked(s)}return o.default.isMriBlocked(e)},t.isConversationObjectBlocked=function(e){return(0,r.default)().isConversationBlocked(e)}},675049:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(898278),n=s(331751),r=s(539549),a=s(557102);t.default=class{static rootViewIdForConversationMri(e){if(!e)return o.MainRootViewId;const t=(0,r.default)().getConversation(e),s=n.default.getAllSiblingConversations(e),l=a.ConversationUtils.getOrderedConversationIds(s,t);return l.length?i.first(l):e}}},557102:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationUtils=void 0;const i=s(496486),o=s(516778),n=s(397691),r=s(889391),a=s(47447),l=s(481169),d=s(422801),c=s(476621),h=s(871908),u=s(61375),p=s(671830),g=s(562141),m=s(185455),S=s(423353),f=s(924339),y=s(341706),v=s(125793),C=s(733754),_=s(18078),b=s(527683),T=s(711828),M=s(478262),I=s(626712),w=s(172758);class P{static getPotentialExistingConversations(e,t=!1){return e&&1===e.length&&c.default.getConversationMetaAsync(e[0]).then((e=>e?[e.conv]:[])),P.getRecentConversationMetas().then((s=>(0,l.chain)(s,(0,l.filter)((s=>{if(t&&s.conv.topicName())return!1;const o=s.conv.getMemberMris();return o.length-1===e.length&&i.intersection(o,e).length===e.length})),(0,l.map)((e=>e.conv)))))}static getRecentConversationMetas(){const e=Date.now()-m.ConversationHistoryTimeSpanImportant;if(c.default.getLastFetchedTimestamp()<e){const e=c.default.getRawConversationMetaMemoryCache(),t=i.values(e).filter((e=>e&&f.isConversationDisplayable(e.conv)&&!e.conv.isHighlightsThread()));return n.Resolved(t)}return g.default.getRecentNonHighlightConversationMetas(p.MinimumConversationsToTryToShow).then((e=>i.filter(e,(e=>f.isConversationDisplayable(e.conv)))))}static createConversation(e,t,s,o=!1,a=u.CreateThreadSource.CreateNewConversation,l={[p.ThreadProps.HistoryDisclosed]:"false",[p.ThreadProps.JoinEnabled]:"true"},h){let g,m=[];return o&&(l[p.ThreadProps.ModeratedThread]="true"),d.default.serviceCreateThread(e,s,a,l,h).then((e=>{g=e.threadId;const s=0===i.size(t)?n.Resolved([]):d.default.serviceAddMembersToThread(g,t,r.default.getS4LMessagingFeaturesNoSubscription().retryAddMembersToThread,{},h);return d.default.discloseHistory(e.threadId,!0),s.then((e=>(m=e,c.default.waitForJoinedKnowledgeOfConversation(g))))})).then((()=>({threadId:g,failedMembers:m})))}static setConversationProps(e,t,s){if(t&&d.default.setThemeColor(e,t),s)return h.uploadConversationIcon(e,s,M.UploadFileType.GroupAvatar)}static getConversationTypeForUI(e){return p.isEncryptedThread(e)?S.ConversationUIType.Private:p.isConversationWithPhoneNumber(e)?S.ConversationUIType.Phone:p.isOneOnOneConversation(e)?S.ConversationUIType.OneOnOneSkype:p.isGroupConversation(e)?S.ConversationUIType.Group:S.ConversationUIType.Other}static getConversationNameForTab(e,t="",s){switch(P.getConversationTypeForUI(e)){case S.ConversationUIType.Private:return C.getString("ContentPanelHeader.PrivateConversationTab");case S.ConversationUIType.Phone:const e=t.slice(-2);return s?C.getString("ContentPanelHeader.SMSConversationTabWithNumber",{digits:e}):C.getString("ContentPanelHeader.SMSConversationTab");case S.ConversationUIType.OneOnOneSkype:return C.getString("ContentPanelHeader.SkypeConversationTab");default:return C.getString("ContentPanelHeader.GenericConversationTab")}}static getConversationForGivenType(e,t){return i.find(e,(e=>this.getConversationTypeForUI(e.id)===t))}static getDeleteConfirmationTitle(e){if(e.length>1)return C.getString("InfoPanel.DeleteAll");const t=e[0];switch(P.getConversationTypeForUI(t)){case S.ConversationUIType.Private:return C.getString("InfoPanel.DeleteConfirmationDialogTitleE2EE");case S.ConversationUIType.Phone:return C.getString("InfoPanel.DeleteConfirmationDialogTitleSMS");case S.ConversationUIType.OneOnOneSkype:return C.getString("InfoPanel.DeleteConfirmationDialogTitleSkype");default:return C.getString("InfoPanel.ClearGroupConfirmationDialogTitle")}}static getConversationTitleForSelection(e){switch(P.getConversationTypeForUI(e.mri)){case S.ConversationUIType.Private:return C.getString("InfoPanel.PrivateChat");case S.ConversationUIType.Phone:const t=p.getPhoneNumberFromMri(e.otherPartyMri||e.mri),s=(t?b.default.parseAndFormat(t,b.PhoneNumberFormat.INTERNATIONAL)||t:void 0)||"";return C.getString("InfoPanel.SMSChat",{phoneNumber:s});default:return C.getString("InfoPanel.SkypeChat")}}static getIconForConversation(e){if(!e)return T.SkypeIcon.Message;switch(P.getConversationTypeForUI(e.id)){case S.ConversationUIType.Private:return T.SkypeIcon.Lock;case S.ConversationUIType.Phone:return T.SkypeIcon.MobileSmsNew;default:return T.SkypeIcon.Message}}static getIconForConversationMri(e){return p.isPhoneMri(e)?T.SkypeIcon.MobileSmsNew:p.isEncryptedThread(e)?T.SkypeIcon.Lock:T.SkypeIcon.Message}static isPSTNGroup(e){if(e){const t=e.getMemberMrisWithoutMe();return t.length>0&&i.every(t,(e=>p.isPhoneMri(e)))}return!1}static getOrderedConversations(e,t){let s=i.find(e,(e=>e.isOneOnOne()&&!e.isEncryptedThread()&&!e.isLogicalOneOnOneSmsConversation())),o=i.find(e,(e=>e.isEncryptedThread()&&y.default.shouldShowPrivateConv(e.id))),n=i.filter(e,(e=>e.isLogicalOneOnOneSmsConversation()));if(t){const e=t.isOneOnOne()&&!t.isEncryptedThread()&&!t.isLogicalOneOnOneSmsConversation();!s&&e?s=t:!o&&t.isEncryptedThread()?o=t:i.isEmpty(n)&&t.isLogicalOneOnOneSmsConversation()&&(n=[t])}return i.compact([s,o,...n])}static getOrderedConversationIds(e,t){return this.getOrderedConversations(e,t).map((e=>e.id))}static hasMultipleAudioCallOptions(e){if(p.isOneOnOneConversation(e)&&!p.isEncryptedThread(e)){const t=w.default.getDisplayableUserByMri(e);if(p.isPhoneMri(e)){if(t.phoneNumbers&&t.phoneNumbers.length>1)return!0}else{if(t.getHasPhoneNumbers())return!0;if(a.CallingCapabilities.encryptedCallingSupported()&&p.isSkypeIdMri(e)){const t=p.buildOneOnOneEncryptedThreadId(e);if(y.default.getHandshakeState(t)===v.SecureHandshakeState.Completed)return!0}}}return!1}static createNewGroupConversationFromOneOnOne(e,t){return P.getPotentialExistingConversations(e).then((t=>{const s=i.first(t);if(s)return n.Resolved(s.id);const o={};o[_.default.getSkypeMri()]=M.ThreadMemberAccessType.Admin;const r={};let a;return i.each(e,(e=>{r[e]=p.isPhoneMri(e)?M.ThreadMemberAccessType.User:M.ThreadMemberAccessType.Admin})),P.createConversation(o,r,"",!1).then((e=>(a=e.threadId,P.setConversationProps(a,void 0,void 0)))).then((()=>n.Resolved(a)))}))}static openClearLeaveConversationLearnMore(){o.Linking.openUrl(I.default.appendLanguageUrlParameter(r.default.getConfigSettingsNoSubscription().chat.msgDeletionLearnMoreLink))}}t.ConversationUtils=P},924339:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getConversationAlwaysHiddenStatus=t.getConversationDisplayableStatus=t.isConversationDisplayable=void 0;const i=s(889391),o=s(63413),n=s(671830),r=s(18078),a=s(539549),l={};function d(e){const t=c(e.id);if(t.hidden)return{isDisplayable:!1,debugReason:t.reason};if(e.isOneOnOne()){const t=e.getOtherPartyMri();if(!t)return{isDisplayable:!1,debugReason:"unknown other party"};if(o.default.isMriBlocked(t))return{isDisplayable:!1,debugReason:"contact blocked"};if(!i.default.getS4LMessagingFeaturesNoSubscription().enableNotCheckingIsConversationEmpty&&e.isEmptyConversation()&&!e.isThread())return{isDisplayable:!1,debugReason:"empty 1:1"};const s=i.default.getEngagementFeatures();if(n.isConciergeBotMri(e.id)&&!s.conciergeBotSettings.enableVisibility)return{isDisplayable:!1,debugReason:"hidden Skype Bot"};if(n.isHiddenBotMri(e.id))return{isDisplayable:!1,debugReason:"hidden bot"}}else{if(e.isThread()&&e.getThreadProperty(n.ThreadProps.ThreadType)===n.ThreadTypes.Reactions)return{isDisplayable:!1,debugReason:"reactions thread"};if(o.default.isMriBlocked(e.id))return{isDisplayable:!1,debugReason:"chat blocked"};if(!e.isCurrentUserMember())return{isDisplayable:!1,debugReason:"not a member"}}return e.isDeleted()&&!(0,a.default)().isClearApplicableAndKeepInRecents(e.id)?{isDisplayable:!1,debugReason:"conversation deleted"}:function(e){var t;if(!(null===(t=i.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===t?void 0:t.enabled))return!1;const s=(0,a.default)().getV2ThreadMapping();return e.isOneToOneUserConvWithThreadIdSupport()&&Boolean(s.getThreadIdByMri(e.id))}(e)?{isDisplayable:!1,debugReason:"replicated chat"}:{isDisplayable:!0,debugReason:""}}function c(e){const t=n.getMriNamespace(e);return l[t]?n.isHighlightsThread(e)?{hidden:!0,reason:"Highlights thread"}:n.isReactionsThread(e)?{hidden:!0,reason:"Call reactions (cast) thread"}:n.isOneToOneThread(e)?{hidden:!0,reason:"OneToOne thread"}:r.default.isMyMri(e)?{hidden:!0,reason:"Conversation with self"}:e===i.default.getConfigSettingsNoSubscription().cortana.mri?{hidden:!0,reason:"Cortana conversation"}:{hidden:!1,reason:""}:{hidden:!0,reason:"Not visible thread namespace "+t}}l[n.Namespaces.MSA]=!1,l[n.Namespaces.S4B_Bridge]=!0,l[n.Namespaces.PSTN]=!0,l[n.Namespaces.SkypeId]=!0,l[n.Namespaces.Thread]=!0,l[n.Namespaces.OneToOneTextMessage]=!1,l[n.Namespaces.GroupTextMessage]=!1,l[n.Namespaces.Bot]=!0,t.isConversationDisplayable=function(e){return d(e).isDisplayable},t.getConversationDisplayableStatus=d,t.getConversationAlwaysHiddenStatus=c},882261:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTwinCamSyncMessage=t.createTranslationSettingsMessage=t.tests_createMessageFromContent=t.createNewsMessages=t.createSkypeClipsRecordMessage=t.createSendCreditMessage=t.createForwardMessageInfo=t.createForwardSwiftMessageInfo=t.hasDoNotFormatPrefixOrIsDoNotFormatEntity=t.createSwiftResponseMessageInfo=t.shouldAddExtraAtMention=t.createAdaptiveFakeMessage=t.createGuestNameUpdateMessage=t.createPollMessage=t.createScheduledCallInviteMessage=t.createSwiftFakeMessage=t.createMediaAlbumMessage=t.createFakeMediaDraftMessage=t.createFakeDraftMessage=t.createInviteFakeMessage=t.createScheduledCallFakeMessageInfo=t.createScheduledCallFakeMessage=t.createLinkFakeMessage=t.createP2PMessage=t.createEmoteMessageInfo=t.createMagicBotEventMessage=t.createCallerIdMessage=t.createCallMessageInfo=t.createDeleteMessageInfo=t.createEditMessageInfo=t.createForwardMessageInfoFromEntities=t.createMessageFromServerMessage=t.createMessageInfo=t.createMessageInfoFromEscapedText=void 0;const i=s(496486),o=s(397691),n=s(766900),r=s(1706),a=s(889391),l=s(598925),d=s(351077),c=s(671830),h=s(898278),u=s(333372),p=s(986374),g=s(952262),m=s(770891),S=s(746096),f=s(84457),y=s(497174),v=s(923944),C=s(733754),_=s(312762),b=s(606509),T=s(237436),M=s(665047),I=s(18078),w=s(827357),P=s(876817),k=s(112692),A=s(404057),x=s(134329),R=s(478262),O=s(203109),L=s(626712),F=s(853374),B=s(846116);function D(e,t,s,i=!1,o){const n=V(e);if(!n.length&&i)return z(e,t,s,d.MessageTypes.Text,void 0,void 0,void 0,void 0,void 0,void 0,void 0,o);const r=new y.UnhandledEntity(s);return n.unshift(r),H(e,t,n,d.MessageTypes.RichText)}function E(e,t,s,i=d.MessageTypes.RichText,o,n,r){return H(e,t,V(e,s),i,void 0,void 0,void 0,void 0,o,n,r)}function V(e,t=[]){const s=[];if(e===c.sanitizeMri(a.default.getConfigSettingsNoSubscription().feedbackBot.id,c.Namespaces.Bot)&&!i.some(t,(e=>e instanceof y.ContextEntity))){let e={};e={ClientLanguage:C.getLocale()};const t=f.default.getCurrentSessionId();t&&(e.feedbackId=t),s.push(new y.ContextEntity(e))}return t.concat(s)}function N(e,t,s,i=e.messagetype){return H(e.conversationId,t,s,i,e,e.skypeemoteoffset)}function U(e,t,s,i){return H(e,t,s,d.MessageTypes.RichText,void 0,i)}function j(e,t,s){const{enableMagicBotOneOnOneAutoAdd:i,enableMagicBot:o}=a.default.getS4LMessagingFeaturesNoSubscription(),n=!(0,B.isMagicBotConversation)(e)&&(0,B.isMagicBotConversation)(t)&&i&&o;return(c.isThread(e)||n)&&c.isAgent(t)&&!s}function H(e,t,s,o,n,r,a,l,c,u,p){const g=i.some(s,(e=>e instanceof y.AtMentionEntity));let m,S=o;if(n&&(o===d.MessageTypes.Text||o===d.MessageTypes.RichText)){const e=n.getOriginalServerMessage(),t=e&&new Date(e.originalarrivaltime).getTime()||n.createdTime;i.remove(s,(e=>e instanceof y.EditMessageMetaDataEntity));const o=new y.EditMessageMetaDataEntity(I.default.getSkypeId(),t);s.push(o),S=d.MessageTypes.RichText}return m=S===d.MessageTypes.Text&&i.every(s,(e=>e instanceof y.UnhandledEntity))?i.map(s,(e=>e.text())).join(""):v.encode(s,!!u),{conversationId:e,postSource:t,conversationOrigin:w.default.dangerouslyGetActiveConversationContextOrigin(h.MainRootViewId),messageForPosting:W(m,g,S,n?n.getOriginalClientMessageId():void 0,r,e,a,c,p),inputEntities:s,isForward:l,editedMessageCuid:n?n.cuid:void 0,previousMessageBeingEditedProperties:n?n.properties:void 0,editedMessageTimestamp:n?n.createdTime:void 0,editedMessageServerId:n?n.getOriginalServerId():void 0,editedMessageVersion:n?n.getLatestServerMessageVersion():void 0}}function z(e,t,s,o,n,r,a,l,c,u,p,g){let m={};p&&(m[d.MessageProperties.AlbumId]=p),g&&(m=i.merge(g,m));const S=d.hasAtMention(s);return{conversationId:e,postSource:t,conversationOrigin:w.default.dangerouslyGetActiveConversationContextOrigin(h.MainRootViewId),messageForPosting:W(s,S,o,n?n.getOriginalClientMessageId():void 0,r,e,a,m),editedMessageCuid:n?n.cuid:void 0,previousMessageBeingEditedProperties:n?n.properties:void 0,editedMessageTimestamp:n?n.createdTime:void 0,isForward:l,forwardMediaInfos:c,swiftMessageDecoded:u,editedMessageServerId:n?n.getOriginalServerId():void 0,editedMessageVersion:n?n.getLatestServerMessageVersion():void 0}}function W(e,t,s,i,o,n,r,a,l){let h;h=l||F.default.newClientMessageId();const u=Date.now(),p=new Date(u).toISOString();let m;n&&c.isOneOnOneConversation(n)&&!c.isAgent(n)&&(m=g.default.getDisplayName(n));return{clientmessageid:h,composetime:p,content:e,messagetype:s,contenttype:d.ContentTypes.Text,imdisplayname:g.default.getDisplayName(I.default.getSkypeMri()),receiverdisplayname:m,"Has-Mentions":t?"true":void 0,skypeemoteoffset:o?o.toString():void 0,skypeeditedid:i||void 0,skypeguid:r||void 0,properties:a||void 0,from:void 0,fromline:void 0}}t.createMessageInfoFromEscapedText=D,t.createMessageInfo=E,t.createMessageFromServerMessage=function(e,t,s,i,o){const n=W(s.content,!1,s.messagetype,void 0,void 0,e,void 0,i,o);return{conversationId:e,postSource:t,conversationOrigin:S.NavigationConversationOrigin.Unknown,messageForPosting:n}},t.createForwardMessageInfoFromEntities=function(e,t,s,i=d.MessageTypes.RichText,o){return H(e,t,V(e,s),i,void 0,void 0,void 0,!0,o)},t.createEditMessageInfo=N,t.createDeleteMessageInfo=function(e,t){const s=[];if(e.isEmote()){const t=e.content.substring(0,e.skypeemoteoffset);s.push(new y.UnhandledEntity(t))}return i.assign(N(e,t,s),{isDelete:!0})},t.createCallMessageInfo=function(e,t,s,i,o,n){return H(e,t,s,i,n,void 0,o)},t.createCallerIdMessage=function(e,t,s=S.PostSource.EphemeralMessage){return H(e,s,[new y.CallerIDEntity(t)],d.MessageTypes.CallerID)},t.createMagicBotEventMessage=function(e,t,s){return H(e,t,s,d.MessageTypes.MagicBotEvent,void 0,1)},t.createEmoteMessageInfo=U,t.createP2PMessage=function(e,t,s){const i=I.default.getSkypeMri();return o.all([g.default.getDisplayableNamePotentiallyBeforeStartupAsync(i),g.default.getDisplayableNamePotentiallyBeforeStartupAsync(s)]).then((([s,i])=>U(e,t,[new y.UnhandledEntity(C.getString("Notifications.P2PCallMessage",{callee:s,caller:i}))],s.length+1)))},t.createLinkFakeMessage=function(e,t,s,i,o){const n=D(e,t,s);return k.default.fromFirstLie(n.messageForPosting,n.conversationId,i,o,!0)},t.createScheduledCallFakeMessage=function(e,t,s){return k.default.fromFirstLie(e.messageForPosting,e.conversationId,t,s,!0)},t.createScheduledCallFakeMessageInfo=function(e,t,s,i){return H(e,s,[new y.UnhandledEntity(i)],t)},t.createInviteFakeMessage=function(e,t,s,i,o){const n=D(e,t,s||C.getString("ContactsStore.DefaultInviteMessage"));return k.default.fromFirstLie(n.messageForPosting,n.conversationId,i,o,!0)},t.createFakeDraftMessage=function(e,t){const s=[new y.UnhandledEntity(C.getString("MessageComposer.DraftDecorator")),...t.inputEntities],i=E(e,S.PostSource.MessageComposer,s);return k.default.fromFirstLie(i.messageForPosting,i.conversationId,I.default.getSkypeMri(),t.timestamp||Date.now(),!0)},t.createFakeMediaDraftMessage=function(e,t,s){const i=L.default.getFileUrl(t.data),o=[];o.push(new y.UnhandledEntity(C.getString("MessageComposer.DraftDecorator")+" ")),o.push(new y.MediaEntity(i,void 0,i,void 0,R.UploadFileType.File,C.getString("MessageComposer.MediaDraftLabel"),void 0,void 0,void 0,void 0));const n=E(e,S.PostSource.MessageComposer,o,d.MessageTypes.UriObject,void 0,void 0,void 0);return k.default.fromFirstLie(n.messageForPosting,n.conversationId,I.default.getSkypeMri(),s||Date.now(),!0)},t.createMediaAlbumMessage=function(e,t,s,o,n){let r={};return r[d.MessageProperties.AlbumId]=s,o&&(r=i.merge(o,r)),E(e,t,[new y.MediaAlbumEntity(s)],d.MessageTypes.MediaAlbum,r,void 0,n)},t.createSwiftFakeMessage=function(e,t,s){const i=x.getTestMessage(s);if(i){return H(e,t,[new y.SwiftUriObjectEntity(i,e,!0)],d.MessageTypes.Media_Card)}},t.createScheduledCallInviteMessage=function(e,t,s,o,n,r,a,l,h){if(r&&r[e]&&c.isThread(e))return;const u=new y.ScheduledCallInviteUriObjectEntity(s,o.toString(),n.toString(),l,i.isUndefined(h)?void 0:h.toString()),p={invitations:r,consumptionHorizons:a},g={};return g[d.MessageProperties.ScheduledCallInviteData]=JSON.stringify(p),H(e,t,[u],d.MessageTypes.ScheduledCallInvite,void 0,void 0,void 0,void 0,g)},t.createPollMessage=function(e,t,s,i,o,n){return H(e,t,[new y.PollInputEntity(s,o.toString(),i,n)],d.MessageTypes.Poll,void 0,void 0,void 0,void 0,{})},t.createGuestNameUpdateMessage=function(e,t,s,i){const o=[new _.TextWrapperNode(_.PlainTextNode.fromPlainText(i),_.TextWrapperNode.tags.Initiator),new _.TextWrapperNode(_.PlainTextNode.fromPlainText(Date.now().toString()),_.TextWrapperNode.tags.EventTime),new _.GuestUpdateTargetNode(t,s)],n=new y.GuestNameUpdateEntity(o);return H(e,S.PostSource.GuestNameUpdate,[n],d.MessageTypes.GuestNameUpdate,void 0,void 0,void 0,void 0,undefined)},t.createAdaptiveFakeMessage=function(e,t,s){const i=n.getTestMessage(s);if(i){return H(e,t,[new y.AdaptiveUriObjectEntity(i,e,!0)],d.MessageTypes.Media_Card)}},t.shouldAddExtraAtMention=j,t.createSwiftResponseMessageInfo=function(e,t,s,o,n,a){let l;if(n&&j(e,n,a)){const e=r.default.getAgentDescriptionForMri(n);l=new y.AtMentionEntity(e.getDisplayName(),e.getMri()),s=" "+s}let c=p.decodeFromContent(s);c=O.extraTextNodeParsing(c,!0,!0);const h=u.toEntities(c).concat(o);if(function(e,t){return i.some(e.children,(e=>e instanceof _.UnknownNode||e instanceof _.ContextNode))||i.some(t,(e=>e instanceof y.ContextEntity))}(c,h)){const s=l?v.encode([l],!0):"",o=i.filter(h,(e=>e instanceof y.ContextEntity)),n=v.encode(V(e,o),!0);i.remove(c.children,(e=>e instanceof _.ContextNode));return z(e,t,s+c.encodeToString()+n,d.MessageTypes.RichText)}return l&&h.unshift(l),E(e,t,h,d.MessageTypes.RichText)},t.hasDoNotFormatPrefixOrIsDoNotFormatEntity=function(e){return b.splitWikiMarkupPrefix(e).prefix===b.WikiPrefix.DoNotFormat||1===e.length&&e[0]instanceof y.DoNotFormatEntity},t.createForwardSwiftMessageInfo=function(e,t,s,i=d.MessageTypes.RichText,o,n){return z(e,t,s,i,void 0,void 0,void 0,!0,n,o)},t.createForwardMessageInfo=function(e,t,s,i=d.MessageTypes.RichText,o,n,r){return z(e,t,s,i,void 0,void 0,void 0,!0,o,void 0,n,r)},t.createSendCreditMessage=function(e,t,s,i,o){const n=P.getSwiftMessage(s,i,o);return H(e,t,[new y.SwiftUriObjectEntity(n,e,!0,n.summary)],d.MessageTypes.Media_Card)},t.createSkypeClipsRecordMessage=function(e,t,s,i){return H(e,i,[new y.LinkEntity(t,s)],d.MessageTypes.RichText)},t.createNewsMessages=function(e,t,s){const i=a.default.getS4LCommerceFeatures().pullNewsConfig;return T.loadNews(s,i).then((s=>{const i=new Array;return s.forEach((s=>{const o={type:m.SwiftMessageTypes.card,summary:s.abstract,attachments:[{contentType:m.SwiftContentTypes.hero,content:{title:s.title,subtitle:s.abstract,image:{url:s.images[0].url,alt:s.title},tap:{type:m.SwiftActionTypes.openUrl,value:s.url}}}]},n=new y.SwiftUriObjectEntity(o,e,!0,o.summary),r=H(e,t,[n],d.MessageTypes.Media_Card);i.push(r)})),i}))},t.tests_createMessageFromContent=function(e,t,s,i,o,n,r,a,l,d,c){return z(e,t,s,i,o,n,r,a,l,d,void 0,c)},t.createTranslationSettingsMessage=function(e,t,s,i,o=!1,n=d.MessageTypes.TranslationSettings){const r={type:M.DataMessageContentType.TranslationSettings,data:{newTranslationState:l.TranslationState[i],messageTranslationLocale:s,isUpdate:o,isOldVersion:!1}};return H(e,t,[new y.TranslationSettingsEntity(M.DataMessageContentType[M.DataMessageContentType.TranslationSettings],A.default.asString(r),[])],n)},t.createTwinCamSyncMessage=function(e,t){return H(e,t,[new y.DataEntity(M.DataMessageContentType[M.DataMessageContentType.TwinCamSync],"{}",[])],d.MessageTypes.Data)}},228229:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownMessageTypeRenderingOptions=t.DefaultMessageRenderingOptions=void 0;const i=s(516778),o=s(889391),n=s(47447),r=s(351077),a=s(671830),l=s(770891),d=s(915877),c=s(563032),h=s(106658),u=s(674323),p=s(18078),g=s(785207),m=s(600750),S=s(640363),f=s(680837),y=s(846116),v=s(302024),C=(0,d.lazyProperties)({radius:()=>(0,d.lazyProperties)({containerStyle:()=>i.Styles.createViewStyle({borderTopLeftRadius:h.messageBorderRadius,borderTopRightRadius:h.messageBorderRadius,borderBottomRightRadius:h.messageBorderRadius,borderBottomLeftRadius:h.messageBorderRadius}),othersMessageStyle:()=>i.Styles.createViewStyle({borderTopLeftRadius:0}),currentUserMessage:()=>i.Styles.createViewStyle({borderBottomRightRadius:0}),othersMessageRTL:()=>i.Styles.createViewStyle({borderTopRightRadius:0}),currentUserMessageRTL:()=>i.Styles.createViewStyle({borderBottomLeftRadius:0})}),containerPadding:()=>(0,d.lazyProperties)({firstInGroup:()=>i.Styles.createViewStyle({paddingTop:10}),notFirstInGroup:()=>i.Styles.createViewStyle({paddingTop:1})})});class _{constructor(e){this._messageProperties=e,this._getDefaultRadiusStylesForMessage=()=>{const e=[C.radius.containerStyle];if(!this.renderedInCompositeGallery()){const t=S.default.isRTL();this._messageProperties.postedByCurrentUser&&!this._isBookmark&&!this.renderedInStackGallery()?e.push(t?C.radius.currentUserMessageRTL:C.radius.currentUserMessage):e.push(t?C.radius.othersMessageRTL:C.radius.othersMessageStyle)}return e};const t=a.isEncryptedThread(this._messageProperties.skypeMessage.conversationId);this._messagingFeatures=o.default.getS4LMessagingFeaturesNoSubscription(),this._isNewsChannel=this._messageProperties.isNewsChannel,this._outerButtonsFit=!!this._messageProperties.layoutWidth&&this._messageProperties.layoutWidth>355;const s=a.isS4BBridgeMri(this._messageProperties.skypeMessage.conversationId),i=o.default.getEngagementFeatures().conciergeBotSettings.enableMessageReactions&&a.isConciergeBotMri(this._messageProperties.skypeMessage.conversationId),l=o.default.getS4LMessagingFeatures().enableMagicBot&&(0,y.getMagicBotId)()===this._messageProperties.skypeMessage.creator;this._defaultSupportsShowingReactionsSummary=!this._messageProperties.disableReactions&&!this._messageProperties.isReadOnly&&!t&&!this._messageProperties.isConversationBlocked&&(!this._messageProperties.postedByBot||i||l)&&!this._messageProperties.skypeMessage.isEmote()&&!s,this._defaultSupportsOverlayingReactionsSummary=!1,this._defaultSupportsPostingReactions=this._defaultSupportsShowingReactionsSummary&&!this._messageProperties.postedByCurrentUser,this._defaultSupportsAddReactionsInActionMenu=this._defaultSupportsPostingReactions&&!!this._messageProperties.screenReaderEnabled,this._defaultSupportsAddReactionInMessageView=(0,v.messageSupportsReacting)(this._defaultSupportsPostingReactions,this._messageProperties),this._isMessageSent=!this._messageProperties.skypeMessage.isSendRejected()&&!this._messageProperties.skypeMessage.isMessageLie()&&!this._messageProperties.skypeMessage.isEphemeral(),this._isBookmark=this._messageProperties.skypeMessage.isBookmark(),this._isBookmarkSource=this._messageProperties.skypeMessage.isBookmarkSourceForCurrentUser(),this._supportsForward=!this._messageProperties.disableForward&&this._isMessageSent&&!t,this._defaultSupportsEdit=!t&&!r.isHtmlMessageType(this._messageProperties.skypeMessage.messagetype),this._defaultSupportsSelectMultipleMessages=this._messageProperties.isSelectMultipleMessagesEnabled&&!a.isPhoneMri(this._messageProperties.skypeMessage.conversationId),this._defaultSupportsRemove=(!!this._messageProperties.postedByCurrentUser||!!this._messageProperties.isModerator)&&!this._messageProperties.isConversationBlocked&&this._isMessageSent&&!this._messageProperties.isReadOnly&&!s&&!t,this._defaultSupportsCopy=n.UICapabilities.copyTextToClipboardSupported(),this._enableReactionOverlay=this._messagingFeatures.enableReactionOverlays,this._defaultSupportsDragging=!t,this._defaultSupportsBookmark=this._isMessageSent,this._enableDebugMessageActions=this._messagingFeatures.enableDebugMessageActions}getRenderingOptions(){const e=this._getDefaultMessageViewRenderingOptions(),t=this._getDefaultMessageActions();return{messageViewRenderingOptions:this.getMessageSpecificViewRenderingOptions(e),messageActions:this.getMessageActions(this._getDefaultMessageActions()),renderOnlyUrlPreview:this.renderOnlyUrlPreview(),urlPreviewRenderInformation:this.getUrlPreviewRenderInformation(e,t)}}getActionMenuCommands(e){const t=[];if(this._isBookmark)return this.getActionMenuCommandsForBookmarkMessage(e);if(e.supportsSearchSelection&&t.push(m.CommandTypes.SearchSelection),e.supportsPostingReactions&&t.push(m.CommandTypes.AddReaction),e.supportsForward&&t.push(m.CommandTypes.Forward),e.supportsSave&&t.push(m.CommandTypes.SaveMedia),e.saveAsCommand&&t.push(e.saveAsCommand),e.openFileLocationCommand&&t.push(e.openFileLocationCommand),e.supportsRemove&&t.push(m.CommandTypes.Remove),e.supportsEdit&&t.push(m.CommandTypes.Edit),e.supportsQuotes&&t.push(m.CommandTypes.Quote),!e.supportsBookmarks||this._isBookmark||this._isNewsChannel||t.push(m.CommandTypes.Bookmark),e.supportsTranslation&&t.push(m.CommandTypes.Translate),e.supportsTranslateOne&&t.push(m.CommandTypes.TranslateOne),e.supportsQuotesSelection&&t.push(m.CommandTypes.QuoteSelection),e.copyCommand&&t.push(e.copyCommand),this._defaultSupportsSelectMultipleMessages){(e.copyCommand||e.supportsRemove||e.supportsForward)&&e.supportsSelectMessages&&t.push(m.CommandTypes.SelectMessages)}return e.supportsViewLink&&t.push(m.CommandTypes.ViewLink),e.supportsCancelScheduledCall&&t.push(m.CommandTypes.CancelScheduledCall),e.supportsEditScheduledCall&&t.push(m.CommandTypes.EditScheduledCall),e.supportsCancelPoll&&t.push(m.CommandTypes.CancelPoll),this._enableDebugMessageActions&&(t.push(m.CommandTypes.DebugDumpMessage),t.push(m.CommandTypes.DebugDumpMessagePretty)),t}getActionsForButtonsToBeRenderedInMessageView(e,t,s){const i=[];return this._isBookmark||(e&&i.push(m.CommandTypes.Forward),t&&i.push(m.CommandTypes.AddReaction)),i}renderOnlyUrlPreview(){return!1}getUrlPreviewRenderInformation(e,t){return[]}getActionMenuCommandsForBookmarkMessage(e){const t=[];return e.supportsForward&&t.push(m.CommandTypes.Forward),e.supportsSave&&t.push(m.CommandTypes.SaveMedia),e.saveAsCommand&&t.push(e.saveAsCommand),t.push(m.CommandTypes.Bookmark),e.copyCommand&&t.push(e.copyCommand),t}_getDefaultMessageActions(){const e=[],t=this._messageProperties.skypeMessage.isEphemeral(),s=this._messageProperties.skypeMessage.isMessageLie(),i=this._messageProperties.skypeMessage.isSendRejected();return s&&!t&&(i?(g.default.canRetry(this._messageProperties.skypeMessage.getSendRetryInfo())&&e.push(m.CommandTypes.RetryFailedSend),e.push(m.CommandTypes.CancelFailedSend)):this._messageProperties.skypeMessage.isEdited()?e.push(m.CommandTypes.CancelEdit):e.push(m.CommandTypes.CancelSend)),s||t||i||this._isBookmark||(this._messageProperties.isReportEnabled&&!this._messageProperties.postedByCurrentUser&&e.push(m.CommandTypes.Report),this._messageProperties.postedByCurrentUser||r.isThreadActivityType(this._messageProperties.skypeMessage.messagetype)||this.renderedInCompositeGallery()||this.renderedInStackGallery()||e.push(m.CommandTypes.MarkReadToHere),(this.renderedInStackGallery()||this.renderedInCompositeGallery())&&e.push(m.CommandTypes.ViewInChat)),{actionMenuCommands:e,outerButtonCommands:[]}}_getDefaultMessageViewRenderingOptions(){const e=this._messageProperties.skypeMessage,t=!e.isEmote();let s,i=!!this._messageProperties.postedByCurrentUser;this._isBookmark&&(s=r.getBookmarkMetadata(e.properties)),s&&s.bookmarkSourceCreatorId&&(i=p.default.isMyMri(s.bookmarkSourceCreatorId));const o=this.renderedInCompositeGallery()||this.renderedInStackGallery()||this._isBookmark||this._isBookmarkSource&&!this._messageProperties.postedByCurrentUser||this._messageProperties.messageFirstInGroup&&!this._messageProperties.postedByCurrentUser&&t,n=o&&!this.renderedInCompositeGallery(),a=!this._messageProperties.postedByCurrentUser&&!this.renderedInCompositeGallery(),d=t&&(o||this._messageProperties.messageFirstInGroup&&this._messageProperties.postedByCurrentUser||this._messageProperties.messageFirstInGroup&&this._messageProperties.messageLastInGroup)||this._isBookmarkSource&&this._messageProperties.postedByCurrentUser;let h=c.MessageRenderSendingStatus.None;e.isSendRejected()?h=c.MessageRenderSendingStatus.Failed:this._messageProperties.renderOrigin!==l.MessageRenderOrigin.CallCanvas&&e.isMessageLie()&&!e.isEphemeral()&&(h=c.MessageRenderSendingStatus.Sending);const g={messageCreatorMri:e.creator,postedByBot:!!this._messageProperties.postedByBot,postedByCurrentUser:i,messageRenderOrigin:this._messageProperties.renderOrigin,theme:this._messageProperties.colorTheme,themeColors:this._messageProperties.themeColors,themeStyles:this._messageProperties.themeStyles,messageStreamHasUnderlay:!!this._messageProperties.hasUnderlay,flipBubbleColors:this._messageProperties.flipBubbleColors},m=u.getBackgroundColorStyleForMessage(g),S=this.renderedInCompositeGallery()||this.renderedInStackGallery()?f.default.flexOne:void 0;return{renderMessageBackground:!0,showMessageSender:o,showMessageSenderIcon:n,allowMarginForSenderIcon:a,showMessageTimestamp:d,alignHeaderLeft:this.renderedInCompositeGallery()||this.renderedInStackGallery(),showDesktopButton:!e.isEphemeral()&&!this.renderedInCompositeGallery(),showStreamItemAccessory:!this.renderedInCompositeGallery()&&!this.renderedInStackGallery()&&!this.renderedInBookmarkConversationOnDesktop(),showReactionsOnMessage:this._defaultSupportsShowingReactionsSummary,overlayReactionsOnMessage:this._defaultSupportsOverlayingReactionsSummary,removeMessageSpacer:this.renderedInCompositeGallery()||this.renderedInStackGallery(),accessibilityLabelType:l.MessageAccessibilityType.Text,skipAccessibilityLabelForMessageView:!1,sendingStatus:h,shouldAnimateEmoticons:this._messageProperties.isCurrentUserActive&&(this._messageProperties.isLastMessage||!1),viewColorProperties:m,messageContainerStyle:this._messageProperties.messageFirstInGroup||o?C.containerPadding.firstInGroup:C.containerPadding.notFirstInGroup,messageContainerRadiusStyle:this._getDefaultRadiusStylesForMessage(),outerWrapperOverideStyle:S,showOuterButtons:this._defaultSupportsAddReactionInMessageView||this._isBookmark,showEditIndicator:!1,showDivider:this._isBookmark&&!this._messageProperties.isLastMessage}}renderedInStackGallery(){return this._messageProperties.renderOrigin===l.MessageRenderOrigin.StackGalleryCanvas}renderedInCompositeGallery(){return this._messageProperties.renderOrigin===l.MessageRenderOrigin.CompositeGalleryCanvas}renderedInBookmarkConversationOnDesktop(){return this._isBookmark&&!0}}t.DefaultMessageRenderingOptions=_;class b extends _{getMessageSpecificViewRenderingOptions(e){return e}getMessageActions(e){return e}}b.messageTypeGroup=r.MessageTypeGroups.None,t.UnknownMessageTypeRenderingOptions=b},788660:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(974634),n=s(314920),r=s(898278),a=s(820770),l=s(521468),d=s(746096),c=s(753559),h=s(923944),u=s(436237),p=s(913131),g=s(381157),m=s(104735),S=s(827357),f=s(857946),y=s(415963),v=s(853374);class C{static performShareNavigationAction(e,t="",s){let o=1;switch(e.type){case"text":e.text?this._processTextShareEvent(e.text,s):this._processShortcutShareEvent(s);break;case"media":if(!e.data||i.isEmpty(e.data))break;o=e.data.length,this._isFileTypeIncluded(e.data)?this._processFileShareEvent(e.data,s):1===e.data.length?this._processSingleMediaShareEvent(e.data[0],t,s):this._processMultipleMediaShareEvent(e.data,t,s);break;default:v.default.switchStatementExhaustiveChecking(e.type)}u.track(new l.DirectShareTelemetry(e.type,o))}static fileDirectShareEvent(){return this._fileShareEvent}static sendSharedFiles(e,t){g.default.postShareEventMediaSelections(e,[t],{name:y.ScenarioName.ShareToSkypeMedia},v.default.newCauseId())}static _processTextShareEvent(e,t){const s={entities:[{type:p.EditableEntityType.PlainText,displayText:e}],downStreamDataVersion:0},i={conversationId:t,inputEntities:(0,h.convertRawTextToInputEntities)(e),inputEntitiesDataVersion:0,messages:void 0,type:f.SavedMessageType.None,timestamp:Date.now()};a.default.saveMessageInput(t,i),a.default.updateInputEntitiesFromContent(t,s).commit(t).storeSavedMessage(t),m.default.navigateToConversation({convId:t,causeId:v.default.newCauseId(),shouldAutoFocusInput:!0})}static _processShortcutShareEvent(e){m.default.navigateToConversation({convId:e,causeId:v.default.newCauseId(),shouldAutoFocusInput:!0})}static _processSingleMediaShareEvent(e,t,s){const i=this._getCapturePreviewParams(e,t,s);m.default.navigateToCapturePreview(i)}static _processMultipleMediaShareEvent(e,t,s){const o={mediaPreviews:i.map(e,(e=>{const o=this._getCapturePreviewParams(e,t,s),n={mediaSelection:this._getMediaSelectionParams(e,t)};return i.extend(n,o)})),conversationId:s,onReject:()=>this._onMediaPreviewReject(s)};m.default.navigateToCaptureMultiPreview(o)}static _processFileShareEvent(e,t){const s=v.default.newCauseId();S.default.getActiveConversationId(r.MainRootViewId)!==t?m.default.navigateToConversation({convId:t,causeId:s,directShareEventData:e}):this._fileShareEvent.fire(e)}static _getCapturePreviewParams(e,t,s){return{capturedContentHandler:new n.CapturedContentHandlerForPosting(s),localMediaObjectUri:t+e.uri,localMediaThumbnailUri:t+(e.thumbnailUri||e.uri),width:e.width,height:e.height,fileSize:e.size,entryPoint:d.PostSource.DirectShare,skipShareWithPanel:!0,fileExtension:c.default.extractFileExtension(e.name),conversationId:s,localMediaIsVideo:"video"===e.type,onCaptureFlowComplete:()=>this._onSendFlowComplete(s),onReject:()=>this._onMediaPreviewReject(s)}}static _getMediaSelectionParams(e,t){return{fileName:e.name,id:e.uri,node:{node:{image:{contentType:e.type+"/"+c.default.extractFileExtension(e.uri),duration:0,height:e.height,size:e.size,thumbnailUri:t+(e.thumbnailUri||e.uri),uri:t+e.uri,width:e.width},isPhoto:"image"===e.type,timestamp:Date.now()}}}}static _onSendFlowComplete(e){const t=v.default.newCauseId();u.log(d.LogTraceArea.DirectShareUtils,"DirectShareUtils._onSendFlowComplete: Sending selected files",t),m.default.navigateToConversation({convId:e,causeId:t})}static _onMediaPreviewReject(e){const t=v.default.newCauseId();u.log(d.LogTraceArea.DirectShareUtils,"DirectShareUtils._onMediaPreviewReject: Rejecting selected files",t),m.default.navigateToConversation({convId:e,causeId:t})}static _isFileTypeIncluded(e){return i.some(e,(e=>"image"!==e.type&&"video"!==e.type))}}C._fileShareEvent=new o.default,t.default=C},103291:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DropTargetOrigin=t.DragDropType=t.DropEffect=void 0;const i=s(496486),o=s(477517),n=s(889391),r=s(351077),a=s(671830),l=s(781725),d=s(882261),c=s(954543),h=s(746096),u=s(436237),p=s(812056),g=s(785207),m=s(404057),S=s(478262),f=s(172758),y=s(820770),v=s(853374),C=s(104735);var _;t.DropEffect="copy",function(e){e.FileFromDesktop="filefromdesktop",e.FileFromConversationToRecents="filefromconversationtorecents",e.ContactFromRecentsToConversation="contactfromrecentstoconversation",e.Unknown="unknown",e.TextOrLink="textorlink"}(_=t.DragDropType||(t.DragDropType={})),function(e){e[e.AvatarPicker=0]="AvatarPicker",e[e.MessagePanel=1]="MessagePanel",e[e.DesktopGalleryPanel=2]="DesktopGalleryPanel",e[e.ConversationListItem=3]="ConversationListItem"}(t.DropTargetOrigin||(t.DropTargetOrigin={}));t.default=new class{getDataTransferType(e){return o.DragDropEvent.isContactEntityInDataTransfer(e)?_.ContactFromRecentsToConversation:this.isDataTransferFileFromConversationToRecents(e)?_.FileFromConversationToRecents:this.isTextOrLink(e)?_.TextOrLink:this.isDataTransferFilesFromDesktop(e)?_.FileFromDesktop:_.Unknown}isDataTransferFilesFromDesktop(e){return!(e.dataTransfer&&!e.dataTransfer.items||0===e.dataTransfer.items.length||i.every(e.dataTransfer.items,(e=>"string"===e.kind)))}isDataTransferFileFromConversationToRecents(e){return e.dataTransfer&&e.dataTransfer.items&&1===e.dataTransfer.items.length&&e.dataTransfer.items[0].type===_.FileFromConversationToRecents}isTextOrLink(e){var t;return(null===(t=null==e?void 0:e.dataTransfer)||void 0===t?void 0:t.items)&&e.dataTransfer.items.length>0&&i.every(e.dataTransfer.items,(e=>{if("string"===e.kind)return!0;if("file"===e.kind){const t=e.getAsFile();return null==t?void 0:t.name.endsWith(".url")}return!1}))}isDragAndDropContactsEnabled(){return n.default.getS4LMessagingFeaturesNoSubscription().enableContactShareDragAndDrop&&!0}addDragAndDropContactInformation(e,t,s,i){const n=a.isPhoneMri(t),r=a.isS4BBridgeMri(t),l={skypeId:a.stripMriNamespace(t),fullName:s,isPstn:n,isS4B:r,userMri:t};o.DragDropEvent.addDragAndDropContactInformation(e,l),u.track(new c.DragAndDropTelemetry(c.DragAction.DragStart,i,c.DragType.Contact))}isContactEntityInDataTransfer(e){return o.DragDropEvent.isContactEntityInDataTransfer(e)}extractContactEntityFromDataTransfer(e){if(!o.DragDropEvent.isContactEntityInDataTransfer(e))return;const t=e.dataTransfer.getData(_.ContactFromRecentsToConversation),s=m.default.parseJsonErrorToUndefined(t);if(!s)return void u.error(h.LogTraceArea.MessagePanel,"Failed to create information for dropping message of type");const{userMri:i}=s;if(!i||!a.isMri(i))return;const n=f.default.getDisplayableUserByMri(i);return n?{skypeId:a.stripMriNamespace(i),fullName:n.getDisplayName(),isPstn:a.isPhoneMri(i),isS4B:a.isS4BBridgeMri(i),userMri:n.getMri()}:void 0}addDragAndDropFileInformation(e,s){e.dataTransfer.effectAllowed=t.DropEffect,e.dataTransfer.dropEffect=t.DropEffect;const i=l.toForwardMediaInfo(s);if(!i)return void u.error(h.LogTraceArea.MessagePanel,"Failed to create information for dragging message of type"+s.messagetype);const o={message:s,forwardInfo:i};e.dataTransfer.setData(_.FileFromConversationToRecents,JSON.stringify(o)),u.track(new c.DragAndDropTelemetry(c.DragAction.DragStart,c.DragOrigin.MessageStream,this._convertMessageTypeToTelemetryType(i)))}dropFileFromConversationToRecents(e,t,s){let o=s;t&&(o=t.getData(_.FileFromConversationToRecents));const n=m.default.parseJsonErrorToUndefined(o);if(!n||i.isEmpty(n))return void u.error(h.LogTraceArea.MessagePanel,"Failed to create information for dropping message of type");const{message:a,forwardInfo:l}=n;if(!(i.isEmpty(l)||i.isEmpty(a)||i.isEmpty(a.content))&&i.isString(a.content)&&i.includes(r.UriObjectMessageTypes,a.messagetype)){try{g.default.postMessage(d.createForwardMessageInfo(e,h.PostSource.DragDropFromConversationToRecentLists,n.message.content,n.message.messagetype,[n.forwardInfo]))}catch(e){return void u.error(h.LogTraceArea.MessagePanel,"Failed to post message after dropping file to recents - "+m.default.errorAsString(e))}u.track(new p.MessageActionTelemetry(e,n.message,n.message.createdTime,p.MessageActionOrigin.MessageStream,p.MessageActionType.DragDropFromConversationToRecentLists))}}isFileEntityFromConversationInDataTransfer(e){return this.getDataTransferType(e)===_.FileFromConversationToRecents}isDragAndDropFilesFromConversationToRecentListsEnabled(){return!0}dropTextOrLinkToConversation(e,t){const s={entities:t.extractedEntities,downStreamDataVersion:0,pastedTextType:t.pastedTextType};y.default.clearMessageInput(e),y.default.updateInputEntitiesFromContent(e,s).commit(e).storeSavedMessage(e),C.default.navigateToConversation({convId:e,causeId:v.default.newCauseId(),shouldAutoFocusInput:!0})}_convertMessageTypeToTelemetryType(e){switch(e.fileType){case S.UploadFileType.Picture:return c.DragType.Picture;case S.UploadFileType.Video:return c.DragType.Video}return c.DragType.File}}},220076:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getEstablishedEncryptedThreadId=t.createAndNavigateToPrivateConversation=void 0;const i=s(496486),o=s(397691),n=s(219784),r=s(476621),a=s(671830),l=s(341706),d=s(667121),c=s(125793),h=s(746096),u=s(436237),p=s(647662),g=s(733754),m=s(104735),S=s(921090),f=s(886045),y=s(404057),v=s(912770),C=s(172758),_=s(853374);t.createAndNavigateToPrivateConversation=function(e,t,s){const b=_.default.newCauseId();u.log(h.LogTraceArea.Navigation,"E2eeUIUtils.createAndNavigateToPrivateConversation, causeId: "+b);const T=S.rootViewIdForComponentContext(s),M=a.buildOneOnOneEncryptedThreadId(e);return r.default.getConversationMetaAsync(M).then((a=>{a||m.default.navigateToLoadingPanel(g.getString("SetConversationParticipantsPanel.CreatingNewConversation"),T);const S=a&&l.default.getHandshakeState(M)!==c.SecureHandshakeState.None?o.Resolved(M):d.default.sendInvite(e,t),_=e=>{f.default.isMobileScreenReaderEnabled()?i.delay(e,250):e()},I=e=>{m.default.navigateToHub(b),_((()=>n.default.showErrorAlert(e,T)))};return S.then((()=>o.race([r.default.waitForJoinedKnowledgeOfConversation(M),v.default.sleep(15e3)]))).then((e=>{e?m.default.navigateToConversation({convId:M,origin:h.NavigationConversationOrigin.NewPrivateConversation,causeId:b}):I(g.getString("E2eeNewConversation.ConversationInvitationTimedOut"))})).catch((t=>{if(405===t.statusCode){u.log(h.LogTraceArea.Navigation,"E2eeUIUtils.createAndNavigateToPrivateConversation error, causeId: "+b),m.default.goBack(b,s);const t=C.default.getFullUserProfileByMri(e),i=t.firstName||t.getDisplayName(),o=p.getLocalizeParamForGender(t.gender);_((()=>{n.default.showOKAlert(g.getString("E2eeNewConversation.InvitationNotSent"),g.getString("E2eeNewConversation.UpgradeNeeded",{buddy:i,gender:o}),T)}))}else if(409===t.statusCode&&666===t.errorCode)d.default.sendAccept(M,h.E2EEAcceptOrigin.Invitation).then((()=>{m.default.navigateToConversation({convId:M,origin:h.NavigationConversationOrigin.NewPrivateConversation,causeId:b})}));else{const e=g.getString("E2eeNewConversation.ConversationInvitationFailed",{reason:y.default.errorAsString(t)});_((()=>I(e)))}}))}))},t.getEstablishedEncryptedThreadId=function(e){const t=a.buildOneOnOneEncryptedThreadId(e);return r.default.getConversationMetaAsync(t).then((e=>{if(e&&l.default.getHandshakeState(t)===c.SecureHandshakeState.Completed)return t}))}},708681:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(274840),o=s(397691),n=s(746096),r=s(753559),a=s(436237),l=s(404057),d=s(640363),c=s(626712);t.default=class{static downsizeImageIfNeeded(e,t,s,d,c){const h=r.default.getFileContentType(t),u=this._getImageDownsizeDimensions(s,d,h);return this._shouldDownsize(s,d,u.resizeWidth,u.resizeHeight)?(e=this._getCorrectedUri(e),i.default.createResizedImage(e,u.resizeWidth,u.resizeHeight,"JPEG",60).then((e=>this._createFileData(e.uri,e.name||"image.jpg",void 0,e.size,u.resizeWidth,u.resizeHeight))).catch((i=>(a.log(n.LogTraceArea.ImageResizeUtils,"Compression failed: "+l.default.errorAsString(i)+"Sending the original media"),this._createFileData(e,t,h,c,s,d))))):o.Resolved(this._createFileData(e,t,h,c,s,d))}static _shouldDownsize(e,t,s,i){return e>0&&t>0&&(e>s||t>i)}static _getCorrectedUri(e){return d.default.getPlatformType()!==n.PlatformType.Android||c.default.isUrlValid(e)||c.default.isFileOrBlob(e)?e:"file://"+e}static _createFileData(e,t,s,i,o,n){return{file:{uri:e,name:t,size:i,type:s||r.default.getFileContentType(t)},extension:r.default.extractFileExtension(t),dimensions:{width:o,height:n}}}static _getImageDownsizeDimensions(e,t,s,i=2048){let o,n;return e<=0||t<=0?(n=0,o=0):s===r.default.imageContentTypes.gif?(n=e,o=t):t>i||e>i?t>e?(n=e*i/t,o=i):(n=i,o=t*i/e):(n=e,o=t),{resizeWidth:n,resizeHeight:o}}static test_shouldDownsize(e,t,s,i){return this._shouldDownsize(e,t,s,i)}static test_getCorrectedUri(e){return this._getCorrectedUri(e)}static test_createFileData(e,t,s,i,o,n){return this._createFileData(e,t,s,i,o,n)}static test_getImageDownsizeDimensions(e,t,s,i){return this._getImageDownsizeDimensions(e,t,s,i)}}},751176:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MapHeight=t.LocationHeight=t.FooterHeight=t.LocationSuffix=t.MapWidth=t.LatitudeLongitudeDelta=void 0;const i=s(496486),o=s(889391),n=s(907234),r=s(993924),a=s(57175),l=s(178735),d=s(581736),c=s(626712);t.LatitudeLongitudeDelta=3/69,t.MapWidth=200,t.LocationSuffix="_location_snapshot",t.FooterHeight=62,t.LocationHeight=182,t.MapHeight=t.LocationHeight-t.FooterHeight;const h=1e6;t.default=new class{getBingMapsImageUrl(e,t,s){const{urlBase:i,apiKey:n}=o.default.getBingMapsConfig();if("NO_API_KEY"!==n)return c.default.addUrlParameters(i,{key:n,mapSize:`${t},${s}`,mapArea:`${e.latitude-e.latitudeDelta/2},${e.longitude-e.longitudeDelta/2},${e.latitude+e.latitudeDelta/2},${e.longitude+e.longitudeDelta/2}`})}getBingMapsLocationUrl(e,t){const s={cp:e.latitude+"~"+e.longitude,dir:"0",lvl:"15",where1:t?encodeURI(t):e.latitude+","+e.longitude};return c.default.addUrlParameters("https://www.bing.com/maps/default.aspx",s)}getImageUriForLocation(e,s,i){const o=this.getFileIdForLocation(i);return n.default.isKnown(o)?n.default.getLocalUri(o):this.getBingMapsImageUrl(this.getLocationRegionFromLatLong(e,s),t.MapWidth,t.MapHeight)}getImageUriForLocationForwardAndroid(e,s){return this.getBingMapsImageUrl(this.getLocationRegionFromLatLong(e,s),t.MapWidth,t.MapHeight)}getLocationRegionFromLatLong(e,s){return{latitude:i.toNumber(e)/h,longitude:i.toNumber(s)/h,latitudeDelta:t.LatitudeLongitudeDelta,longitudeDelta:t.LatitudeLongitudeDelta*(t.MapWidth/t.MapHeight)}}getFileIdForLocation(e){return e+t.LocationSuffix}getLocationPermissionStatus(e){var t;const s=null===(t=l.default.getUserPreferencesLocal().msaProfileKey)||void 0===t?void 0:t.ageGroup;return a.MsaProfileHelper.isChild(s)?r.PermissionStatus.Denied:d.default.permissionStatus(e)}}},633596:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getStyleForDimensions=t.getThumbnailMaxWidth=t.defaultStyles=t.defaultDim=t.CompositeGalleryThumbnailWidth=t.CompositeGalleryThumbnailHeight=t.ThumbnailMinHeight=t.ThumbnailMinWidth=void 0;const i=s(516778),o=s(898278),n=s(915877),r=s(29130);t.ThumbnailMinWidth=60,t.ThumbnailMinHeight=60;const a={};t.CompositeGalleryThumbnailHeight=200,t.CompositeGalleryThumbnailWidth=300;function l(e,t){return t||r.default.isSmallDeviceNoSubscription(e)?200:r.default.isMediumPhoneDeviceNoSubscription(e)?250:300}t.defaultDim={compositeGalleryThumbnail:{height:t.CompositeGalleryThumbnailHeight,width:t.CompositeGalleryThumbnailWidth},inCallConvThumbnail:{height:133,width:200}},t.defaultStyles=(0,n.lazyProperties)({pictureDefaultThumbnail:()=>i.Styles.createImageStyle({height:l(o.MainRootViewId),width:l(o.MainRootViewId)}),compositeGalleryThumbnail:()=>i.Styles.createImageStyle({height:t.CompositeGalleryThumbnailHeight,width:t.CompositeGalleryThumbnailWidth})}),t.getThumbnailMaxWidth=l,t.getStyleForDimensions=function(e){const t=function(e){const t=`${e.width||"_"}x${e.height||"_"}`;return t}(e);if(!a[t]){const{width:s,height:o}=e;a[t]=s&&o?i.Styles.createViewStyle({width:s,height:o},!1):s?i.Styles.createViewStyle({width:s},!1):o?i.Styles.createViewStyle({height:o},!1):i.Styles.createViewStyle({},!1)}return a[t]}},381157:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(41217),n=s(267728),r=s(397691),a=s(219784),l=s(889391),d=s(502278),c=s(272675),h=s(671830),u=s(898278),p=s(882261),g=s(746096),m=s(753559),S=s(708681),f=s(436237),y=s(650556),v=s(733754),C=s(318743),_=s(971349),b=s(785207),T=s(886045),M=s(404057),I=s(853374),w=s(53332),P="processingVideo";class k{static postMediaSelections(e,t,s,o,a,d){const c=n.default.requestMaxTime("mediaPickerPost:manyMedia"),h=i.isArray(e)?e:[e],u=i.some(h,(e=>e.node&&!e.node.node.isPhoto));if(s!==g.PostSource.ShareWith){const e=l.default.getS4LMessagingFeaturesNoSubscription().limitForFilePicker;f.track(new C.FilesSentViaPicker(C.FilePickerOrigin.MediaPickerItem,e,!1,i.map(h,(e=>m.default.extractFileExtension(e.fileName)))))}let p;if(u)if(k._canSendVideo(t,h)){k._startSharingProcess(!0);const e=i.map(h,(e=>k._postMediaSelection(e,t,s,o,a,d)));p=r.all(e).always((()=>{k.hideProcessingDialog(!0)}))}else{const e=r.Defer();k._showVideoPostError((()=>{e.reject()})),p=e.promise()}else{const e=i.map(h,(e=>k._postMediaSelection(e,t,s,o,a,d)));p=r.all(e).always(i.noop)}return p.finally((()=>{c.then((e=>n.default.release(e,"mediaPickerPost:manyMedia")))}))}static postShareEventMediaSelections(e,t,s,o){const a=n.default.requestMaxTime("mediaPickerPost:share"),l=i.some(e,(e=>"video"===e.type));k._startSharingProcess(l);let d=[];return i.sumBy(e,(e=>"video"===e.type||"image"===e.type?1:0))>1?i.each(t,(t=>{const n=!h.isAgent(t),a=I.default.newGuid(),l={scenarioInfo:s,properties:n?{albumId:a}:void 0},c=k._postShareEventMediaSelections(e,[t],l,o);if(n){const s=()=>r.Resolved().then((()=>{const e=p.createMediaAlbumMessage(t,g.PostSource.ShareToSkype,a);b.default.postMessage(e)})),o=i.findIndex(e,(e=>"video"===e.type||"image"===e.type))+1;c.splice(o,0,s)}const u=i.reduce(c,((e,t)=>e.then(t)),r.Resolved());d.push(u)})):d=k._postShareEventMediaSelections(e,t,{scenarioInfo:s},o).map((e=>e())),r.all(d).always((()=>{k.hideProcessingDialog(!0)})).finally((()=>{a.then((e=>n.default.release(e,"mediaPickerPost:share")))}))}static _postShareEventMediaSelections(e,t,s,o){return i.map(e,(e=>{const i=m.default.extractFileNameWithExtension(e.name),n=m.default.extractFileExtension(i),r=m.default.getFileContentType(i);if("video"===e.type){const a=e.thumbnailWidth?e.thumbnailWidth:e.width,l=e.thumbnailHeight?e.thumbnailHeight:e.height;return k._canVideoReencode(t,e.width,e.height)?()=>k._reencodeAndPostVideo(e.uri,e.width,e.height,e.size,e.thumbnailUri,a,l,i,n,r,t,g.PostSource.ShareToSkype,0,s.scenarioInfo,s.properties,o):()=>k._postVideoFromMediaPicker(e.uri,e.width,e.height,i,n,e.size,e.thumbnailUri,a,l,r,t,g.PostSource.ShareToSkype,s.scenarioInfo,s.properties)}if("image"===e.type)return()=>k._postImageFromMediaPicker(e.uri,i,e.width,e.height,n,t,g.PostSource.ShareToSkype,s);{const o={file:{uri:e.uri,name:i,size:e.size,type:e.type},extension:n};return e.width&&e.height&&(o.dimensions={width:e.width,height:e.height}),()=>b.default.postUpload(t,o,g.PostSource.ShareToSkype,!1,{scenarioInfo:s.scenarioInfo}).then((()=>{T.default.maybeAnnounceForAccessibility(v.getString("MessageComposer.FileSentLabel"))}))}}))}static _postMediaSelection(e,t,s,o,n,r){const a=e.node,l=a.node.image.uri,c=e.fileName||m.default.extractFileName(l),h=m.default.extractFileExtension(c),u=m.default.getFileContentType(c),p=i.isArray(t)?t:[t];let g;if(m.default.isVideoExtension(h)){const e=a,t=e.node.image.width,i=e.node.image.height,n=e.node.image.size,d=e.node.image.thumbnailUri;g=k._canVideoReencode(p,t,i)?k._reencodeAndPostVideo(l,t,i,n,d,t,i,c,h,u,p,s,e.node.image.duration,o.scenarioInfo,o.properties,r):k._postVideoFromMediaPicker(l,t,i,c,h,e.node.image.size,d,t,i,u,p,s,o.scenarioInfo,o.properties)}else{const e=a.node.image.width,t=a.node.image.height;g=k._postImageFromMediaPicker(l,c,e,t,h,p,s,o)}return g.always((()=>{o.callId?d.default.updateCallTelemetry(o.callId,"MediaPicker",(e=>e.postMediaPickerPhotoReaction())):n&&f.track(n)}))}static _postVideoFromMediaPicker(e,t,s,i,o,n,r,a,l,d,c,h,u,p){const g={file:{uri:e,size:n,name:i,type:d},extension:o,dimensions:{width:t,height:s}};if(r){const e=m.default.extractFileNameWithExtension(r),t=m.default.extractFileExtension(e),s=m.default.getFileContentType(e);g.thumbnail={file:{uri:r,name:e,type:s,size:0},extension:t,dimensions:{width:a,height:l}}}return b.default.postVideoWithThumbnail(c,g,h,!1,u,void 0,void 0,p).then((()=>{T.default.maybeAnnounceForAccessibility(v.getString("MessageComposer.FileSentLabel"))}))}static _postImageFromMediaPicker(e,t,s,i,o,n,r,a){return(s<=0||i<=0)&&f.track(new _.UnrecognizedMediaDimension(o,r)),S.default.downsizeImageIfNeeded(e,t,s,i,void 0).then((e=>this._postImage(e,n,r,a)),(e=>{f.log(g.LogTraceArea.MediaPickerPostUtils,"postImageFromMediaPicker failed: "+M.default.errorAsString(e))}))}static hideProcessingDialog(e){let t=!1;return y.LoadingDialog.isDisplayed(P,u.MainRootViewId)&&(y.LoadingDialog.dismiss(P,u.MainRootViewId),t=!0),t}static _reencodeAndPostVideo(e,t,s,i,n,r,a,l,d,h,u,p,m,S,y,v){const C=new c.VideoReencode(m?1e3*m:0);return o.default.reencodeVideo(e,void 0,w.default.reencodeOptions(),v).then((i=>{C.setStatus(!0);const o=i.width?i.width:t,r=i.height?i.height:s,a=i.uri?i.uri:e,c=i.thumbnailUri?i.thumbnailUri:n;k._postVideoFromMediaPicker(a,o,r,l,d,i.fileSize,c,o,r,h,u,p,S,y)})).catch((o=>{const c=M.default.errorAsString(o);C.setStatus(!1,c),f.error(g.LogTraceArea.MediaPickerPostUtils,"ReencodeVideo failed - "+c),k._postVideoFromMediaPicker(e,t,s,l,d,i,n,r,a,h,u,p,S,y)})).always((()=>{f.track(C)}))}static _startSharingProcess(e){e&&(y.LoadingDialog.dismiss(P,u.MainRootViewId),y.LoadingDialog.show({dialogId:P,dialogText:v.getString("CapturePreview.PreparingVideo"),showActivityIndicator:!0,showCancelButton:!1},u.MainRootViewId,!0))}static _canSendVideo(e,t){return!(!e||!t)}static _showVideoPostError(e){f.log(g.LogTraceArea.Capture,"CapturePreview not sending captured video");const t=[{text:v.getString("CapturePreview.HighlightsDialogConfirmButtonTitle"),onPress:()=>{e()}}],s=v.getString("CapturePreview.ItemCannotBeSelected");a.default.showWithOptions({title:v.getString("CapturePreview.UnableToAddToHighlightsDialogTitle"),dialogAccessibilityTitle:s,message:s,buttons:t,rootViewId:u.MainRootViewId,useFocussedWindowFallback:!0})}static _canVideoReencode(e,t,s){return!1}static _postImage(e,t,s,i){return b.default.postUpload(t,e,s,!1,i).then((()=>{T.default.maybeAnnounceForAccessibility(v.getString("MessageComposer.FileSentLabel"))}))}static test_postImageFromMediaPicker(e,t,s,i,o,n,r,a){this._postImageFromMediaPicker(e,t,s,i,o,n,r,a)}}t.default=k},396919:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaAlbumRenderingOptions=t.StickerRenderingOptions=t.MojiRenderingOptions=t.AudioMessageRenderingOptions=t.VideoMessageRenderingOptions=t.PictureMessageRenderingOptions=void 0;const i=s(496486),o=s(516778),n=s(351077),r=s(228229),a=s(913991),l=s(770891),d=s(766649),c=s(915877),h=s(183503),u=s(563032),p=s(600750),g=s(913991),m=(0,c.lazyProperties)({messageContentSpacing:()=>o.Styles.createViewStyle({paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0})});function S(e){return e===u.MessageRenderSendingStatus.Sending?u.MessageRenderSendingStatus.None:e}class f extends r.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t=this._messagingFeatures.enableImageForwarding&&this._supportsForward,s={renderMessageBackground:!1,overlayReactionsOnMessage:this._defaultSupportsShowingReactionsSummary&&this._enableReactionOverlay,showTouchFeedbackOnPress:!0,showOuterButtons:this._defaultSupportsAddReactionInMessageView||t,includeCursor:!0,accessibilityLabelType:l.MessageAccessibilityType.Media,sendingStatus:S(e.sendingStatus),availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:(0,a.prepareMediaNodeDimensionsFunction)(this._messageProperties),isDraggingEnabled:this._defaultSupportsDragging};return i.assign({},e,s)}getMessageActions(e){const t=this._messagingFeatures.enableImageForwarding&&this._supportsForward,s=d.default.isUsingGogoNetwork();let i=this.getActionMenuCommands({supportsPostingReactions:this._defaultSupportsAddReactionsInActionMenu&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery(),supportsForward:this._supportsForward&&!s,supportsQuotes:!0,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsSave:this._isMessageSent&&!s,supportsRemove:this._defaultSupportsRemove,copyCommand:void 0,openFileLocationCommand:h.canOpenFileLocation(this._messageProperties.skypeMessage)?p.CommandTypes.OpenMediaLocation:void 0,saveAsCommand:void 0,supportsBookmarks:this._defaultSupportsBookmark});return i=i.concat(e.actionMenuCommands),e.outerButtonCommands=this.getActionsForButtonsToBeRenderedInMessageView(t,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands),{actionMenuCommands:i,outerButtonCommands:e.outerButtonCommands}}}f.messageTypeGroup=n.MessageTypeGroups.Picture,t.PictureMessageRenderingOptions=f;class y extends r.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,overlayReactionsOnMessage:this._defaultSupportsShowingReactionsSummary&&this._enableReactionOverlay,showTouchFeedbackOnPress:!0,showOuterButtons:this._defaultSupportsAddReactionInMessageView||this._supportsForward,includeCursor:!0,accessibilityLabelType:l.MessageAccessibilityType.Media,sendingStatus:S(e.sendingStatus),availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:(0,a.prepareMediaNodeDimensionsFunction)(this._messageProperties),isDraggingEnabled:this._defaultSupportsDragging};return i.assign({},e,t)}getMessageActions(e){let t=this.getActionMenuCommands({supportsPostingReactions:this._defaultSupportsAddReactionsInActionMenu&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery(),supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsSave:this._isMessageSent,saveAsCommand:void 0,openFileLocationCommand:h.canOpenFileLocation(this._messageProperties.skypeMessage)?p.CommandTypes.OpenMediaLocation:void 0,supportsRemove:this._defaultSupportsRemove,supportsQuotes:!0,supportsBookmarks:this._defaultSupportsBookmark});return t=t.concat(e.actionMenuCommands),e.outerButtonCommands=this.getActionsForButtonsToBeRenderedInMessageView(this._supportsForward,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}y.messageTypeGroup=n.MessageTypeGroups.Video,t.VideoMessageRenderingOptions=y;class v extends r.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={includeCursor:!0,overlayReactionsOnMessage:this._defaultSupportsShowingReactionsSummary&&this._enableReactionOverlay,calcRenderDim:g.getAudioNodeRenderDimensions,messageContentSpacingStyle:m.messageContentSpacing,accessibilityLabelType:l.MessageAccessibilityType.Media};return i.assign({},e,t)}getMessageActions(e){const t=d.default.isUsingGogoNetwork();let s=this.getActionMenuCommands({supportsPostingReactions:this._defaultSupportsAddReactionsInActionMenu&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery(),supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsSave:this._isMessageSent&&!t,saveAsCommand:void 0,supportsRemove:this._defaultSupportsRemove,supportsQuotes:!0,supportsBookmarks:this._defaultSupportsBookmark});return s=s.concat(e.actionMenuCommands),e.outerButtonCommands=this.getActionsForButtonsToBeRenderedInMessageView(!1,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands),{actionMenuCommands:s,outerButtonCommands:e.outerButtonCommands}}}v.messageTypeGroup=n.MessageTypeGroups.Audio,t.AudioMessageRenderingOptions=v;class C extends r.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){return i.assign({},e,{renderMessageBackground:!1,showReactionsOnMessage:!1})}getMessageActions(e){let t=this.getActionMenuCommands({supportsRemove:this._defaultSupportsRemove,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsBookmarks:this._defaultSupportsBookmark});return t=t.concat(e.actionMenuCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}C.messageTypeGroup=n.MessageTypeGroups.Moji,t.MojiRenderingOptions=C;class _ extends r.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){return i.assign({},e,{renderMessageBackground:!1,showReactionsOnMessage:!1})}getMessageActions(e){let t=this.getActionMenuCommands({supportsRemove:this._defaultSupportsRemove,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsBookmarks:this._defaultSupportsBookmark});return t=t.concat(e.actionMenuCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}_.messageTypeGroup=n.MessageTypeGroups.Sticker,t.StickerRenderingOptions=_;class b extends r.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,overlayReactionsOnMessage:this._defaultSupportsShowingReactionsSummary&&this._enableReactionOverlay,showTouchFeedbackOnPress:!0,showOuterButtons:this._defaultSupportsAddReactionInMessageView||this._supportsForward,includeCursor:!0,accessibilityLabelType:l.MessageAccessibilityType.Media,sendingStatus:S(e.sendingStatus),availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:(0,a.prepareMediaNodeDimensionsFunction)(this._messageProperties),isDraggingEnabled:this._defaultSupportsDragging};return i.assign({},e,t)}getMessageActions(e){let t=this.getActionMenuCommands({supportsPostingReactions:this._defaultSupportsAddReactionsInActionMenu,supportsSave:void 0,saveAsCommand:void 0,supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsBookmarks:this._defaultSupportsBookmark});return t=t.concat(e.actionMenuCommands),e.outerButtonCommands=this.getActionsForButtonsToBeRenderedInMessageView(this._supportsForward,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}b.messageTypeGroup=n.MessageTypeGroups.MediaAlbum,t.MediaAlbumRenderingOptions=b},183503:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSaveToDirectoryLocalizationString=t.getSaveToDirectoryLocalizationKeys=t.isCommandSupported=t.canOpenFileLocation=void 0;const i=s(496486),o=(s(265976),s(351077)),n=s(898278),r=(s(462937),s(733754)),a=s(178735),l=s(711828),d=s(889391);function c(e){const{enableReactionsInBottomSheet:t}=d.default.getS4LMessagingFeaturesNoSubscription();let s;if((0,o.getMessageTypeGroup)(e)===o.MessageTypeGroups.Picture)return{key:"StreamItem.OpenInNewTab",params:s,icon:t?l.SkypeIcon.TabAdd:n.SXMenuIcon.Open};const i=t?l.SkypeIcon.Save:n.SXMenuIcon.Save;const r=a.default.getUserPreferencesLocalNoSubscription();r&&r.fileDownloadDisplayNameDesktop&&(s={downloadFolder:r.fileDownloadDisplayNameDesktop});if(e&&e.isAlbum()){return{key:!1?"StreamItem.SaveAllToDownloadsCustomFolder":"StreamItem.SaveAll",params:s,icon:i}}return{key:s?"StreamItem.SaveToDownloadsCustomFolder":"StreamItem.Save",params:s,icon:i}}t.canOpenFileLocation=function(e){return!1},t.isCommandSupported=function(e,t){return!!e&&i.findIndex(e.actionMenuCommands,(e=>e===t))>-1},t.getSaveToDirectoryLocalizationKeys=c,t.getSaveToDirectoryLocalizationString=function(e){const t=c(e);return r.getString(t.key,t.params)}},764387:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(351077),n=s(986374),r=s(770891),a=s(746096),l=s(436237),d=s(945983),c=s(312762),h=s(853374);function u(e,t){let s={isEmpty:!e};return e&&(s={hasContent:e.content&&e.content.length>0,firstFourChars:e.content&&e.content.substring(0,4),contentType:e.contenttype,messageType:e.messagetype}),`Error decoding ${t} node from item with info ${JSON.stringify(s)}`}t.default=class{static getMediaDescriptorForItem(e){let t,s;switch(o.getMessageTypeGroup(e)){case o.MessageTypeGroups.Picture:s=n.decode(e);const i=s.getFirstUriObjectChild(c.PictureNode);t=this._getPictureDescriptor(i,e);break;case o.MessageTypeGroups.Video:s=n.decode(e);const r=s.getFirstUriObjectChild(c.VideoNode);t=this._getVideoDescriptor(r,e);break;case o.MessageTypeGroups.Audio:s=n.decode(e);const a=s.getFirstUriObjectChild(c.AudioNode);t=this._getAudioDescriptor(a,e)}return t}static _getPictureDescriptor(e,t){if(!e)return void l.error(a.LogTraceArea.MediaViewerPanel,u(t,"picture"));return{mediaType:d.MediaViewerTypes.Picture,thumbnailUrl:e.getDisplayThumbnailUrlSanitized(),displayResolutionUrl:e.getDisplayUrlSanitized(),fullResolutionUrl:e.getFullResolutionUrlSanitized(),downloadFileName:e.getNameForDownload(),originalSize:this._dimensionsForOptionalDimensions(e.getOriginalDimensions()),id:t.cuid,originalSizeInBytes:e.getSizeInBytes()}}static _getVideoDescriptor(e,t){if(!e)return void l.error(a.LogTraceArea.MediaViewerPanel,u(t,"video"));const s=e.getDisplayUrlSanitized(),i=e.getDisplayUrlMediaProvider();l.log(a.LogTraceArea.MediaViewerPanel,"Video "+i+" "+s);let o=e.getNameForDownload();o||(o="video_"+h.default.newGuid()+".mp4",l.debug((()=>"MediaViewerUtils - received a file without downloadFileName, new value: "+o)));return{mediaType:d.MediaViewerTypes.Video,thumbnailUrl:e.getDisplayThumbnailUrlSanitized(),downloadFileName:o,originalSize:this._dimensionsForOptionalDimensions(e.getOriginalDimensions()),videoUrl:s,id:t.cuid,videoProvider:i,amsReferences:t.amsreferences,originalSizeInBytes:e.getSizeInBytes()}}static _getAudioDescriptor(e,t){if(!e)return void l.error(a.LogTraceArea.MessageStream,u(t,"audio"));return{audioUrl:e.getDisplayUrlSanitized(),mediaType:d.MediaViewerTypes.Audio,downloadFileName:e.getNameForDownload(),id:t.cuid}}static isMediaItem(e){const t=o.getMessageTypeGroup(e);return(t===o.MessageTypeGroups.Picture||t===o.MessageTypeGroups.Video||e.messagetype===o.MessageTypes.CastRecording)&&o.contentContainsUriObjectExceptFile(e.content)}static isVideo(e){return o.getMessageTypeGroup(e)===o.MessageTypeGroups.Video}static isFile(e){return o.getMessageTypeGroup(e)===o.MessageTypeGroups.UriFile}static isLink(e){if(o.getMessageTypeGroup(e)===o.MessageTypeGroups.Text&&-1!==e.content.indexOf("<a ")){const t=n.decode(e);return t.getWebLinks()&&t.getWebLinks().length>0}return!1}static isSwiftCard(e){return o.getMessageTypeGroup(e)===o.MessageTypeGroups.SwiftCard}static isSwiftCardWithLink(e){if(o.getMessageTypeGroup(e)===o.MessageTypeGroups.SwiftCard){const t=n.decode(e).getFirstUriObjectChild(c.SwiftUriObjectNode);if(t&&t.swiftChild){const e=t.swiftChild.swiftMessage;if(e)return i.some(e.attachments,(e=>this.isSwiftCardAttachmentALink(e)))}}return!1}static isDecodedRootNodeASwiftCardWithLink(e){const t=e.getFirstUriObjectChild(c.SwiftUriObjectNode);if(t&&t.swiftChild){const e=t.swiftChild.swiftMessage;if(e)return i.some(e.attachments,(e=>this.isSwiftCardAttachmentALink(e)))}return!1}static isSwiftCardAttachmentALink(e){if(!e.content)return!1;if(e.content.tap&&e.content.tap.type===r.SwiftActionTypes.openUrl)return!0;if(e.content.images&&e.content.images[0]){const t=e.content.images[0].tap;if(t&&t.type===r.SwiftActionTypes.openUrl)return!0}return!1}static _dimensionsForOptionalDimensions(e){return i.isUndefined(e.width)||i.isUndefined(e.height)?void 0:{width:e.width,height:e.height}}}},947193:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getConversationMaxMessageLength=t.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives=t.getEditableContentFromEditableEntities=t.getEditableEntityFromInputEntityAndConsiderAlternatives=void 0;const i=s(496486),o=s(732183),n=s(139597),r=s(497174),a=s(923944);function l(e,t,s){const i=a.getEditableEntityFromInputEntity(e,t,s);if(!(e instanceof r.EmoticonEntity))return i;const o=i;return Object.assign(Object.assign({},o),{url:d(o.url)})}function d(e){if(i.isUndefined(e))return;const t=o.parseUrl(e);if(i.isUndefined(t))return e;const s=n.default.requestEmoticon(e,t).result;return i.isUndefined(s)?e:o.getUrl(s.icon)}t.getEditableEntityFromInputEntityAndConsiderAlternatives=l,t.getEditableContentFromEditableEntities=function(e,t){return{entities:e,downStreamDataVersion:t}},t.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives=function(e,t){return e.map(((e,s)=>l(e,t,s)))},t.getConversationMaxMessageLength=function(e){return e?25e3:400}},232638:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.areNotificationsEnabled=t.getReasonForNotificationsDisabled=t.getLastReactionUserMri=t.sendRawMessageFromEntities=t.sendRawMessage=t.recomputeAndroidNotifications=t.getMessageNotificationType=t.getNotificationAction=t.getLatestMessageTimestamp=void 0;const i=s(496486),o=s(269521),n=s(397691),r=s(889391),a=s(351077),l=s(671830),d=s(562141),c=s(882261),h=s(82433),u=s(746096),p=s(436237),g=s(733754),m=s(178735),S=s(597223),f=s(213847),y=s(333326),v=s(333326),C=s(785207),_=s(422538),b=s(640363),T=s(478262),M=s(853374);function I(e){if((0,f.isLastMessageUpdateReaction)(e)){const t=e.getLastReactionTimeExcludingCurrentUser();if(t)return t}return e.createdTime}t.getLatestMessageTimestamp=I;const w={action:S.MessageNotificationAction.Ignore,snoozeUntil:void 0,notificationType:S.MessageNotificationType.RegularMessage};function P(e){return(0,f.isLastMessageUpdateReaction)(e)?S.MessageNotificationType.Reaction:e.isCurrentUserQuoted()?S.MessageNotificationType.Quote:e.isCurrentUserMentioned()?S.MessageNotificationType.Mention:S.MessageNotificationType.RegularMessage}t.getNotificationAction=function(e,t,s){return _.EnsureStarted([m.default]).then((()=>{const i=m.default.getUserPreferencesLocal();if(e&&!i.ignoreActiveEndpointFiltering)return p.log(u.LogTraceArea.Notifications,"Notification ignored, there is an active endpoint on another device"),w;{const e=t.getSubscription(),i=s.getMessageNotificationClass();return e===l.SubscriptionTypes.Muted?(p.log(u.LogTraceArea.Notifications,"Notification ignored, current chat is muted"),w):a.isAddMemberMessageType(s.messagetype)?{action:S.MessageNotificationAction.InterruptUser,snoozeUntil:void 0,notificationType:S.MessageNotificationType.AddToConversation}:i!==T.MessageNotificationClass.SystemInformational||t.isEncryptedThread()&&s.isE2eeHandshakeTypeAllowedForNotification()?t.isReactionsThread()?(p.log(u.LogTraceArea.Notifications,"Notification ignored, reactions thread"),w):t.isOneOnOne()||e!==l.SubscriptionTypes.Normal||i===T.MessageNotificationClass.MentionedOrQuoted||(0,f.isLastMessageUpdateReaction)(s)?a.isScheduledCallType(s.messagetype)?(p.log(u.LogTraceArea.Notifications,"Notification is from a scheduled call, inform user."),{action:S.MessageNotificationAction.InterruptUser,snoozeUntil:void 0,notificationType:S.MessageNotificationType.ScheduledCall}):d.default.getConversationMeta(t.id).then((e=>{if(!e||!e.counts)return p.log(u.LogTraceArea.Notifications,"Notification ignored, no counts"),w;const t=Number(e.counts.consumptionHorizonTimestamp),i=I(s);if(t>=i)return p.log(u.LogTraceArea.Notifications,"Notification ignored, message already viewed, consumptionHorizonTime ("+t+") >= newMessageTimestamp ("+i+")"),w;{const e=P(s);return p.log(u.LogTraceArea.Notifications,"Previous message is old, preparing to display current notification to user"),{action:S.MessageNotificationAction.InterruptUser,snoozeUntil:void 0,notificationType:e}}})).catch((()=>(p.log(u.LogTraceArea.Notifications,"Notification ignored, unknown failure"),w))):(p.log(u.LogTraceArea.Notifications,'Notification ignored, group message notification with no mention or quote ("smart" setting turned on)'),w):(p.log(u.LogTraceArea.Notifications,"Notification ignored, system info"),w)}}))},t.getMessageNotificationType=P;let k=!1;function A(e,t,s){1!==i.sum(i.map([t,s],(e=>void 0===e)))&&p.error(u.LogTraceArea.Notifications,"sendMessageInternal received invalid input");const r=n.Defer();return _.EnsureStarted([C.default,h.default]).then((()=>{const n=u.PostSource.ReplyFromNotification;let a;a=void 0!==t?c.createMessageInfoFromEscapedText(e,n,t):c.createMessageInfo(e,n,s);const l=a.messageForPosting.clientmessageid,d=C.default.postUpdated.subscribe((e=>{e.isFinished&&i.each(e.messagesForPosting,((e,t)=>{const s=e.clientmessageid;s===l&&(d.unsubscribe(),r.resolve(s))}))})),h={category:v.LocalNotificationIds.CHAT_ERROR_CATEGORY_IDENTIFIER,id:M.default.newGuid(),message:g.getString("Notifications.ReplyNotSent"),priority:o.NotificationPriority.Max};C.default.postMessage(a,h)})),r.promise()}function x(e=!1){const t=m.default.getUserPreferencesLocal();if(!t.enableChatNotifications)return u.MessageProcessResult.ChatNotificationsDisabled;t.disableChatNotificationsUntil}t.recomputeAndroidNotifications=function(e,t,s){if(b.default.getPlatformType()!==u.PlatformType.Android)return n.Resolved();if(k)return n.Resolved();const a=r.default.getS4LMessagingFeaturesNoSubscription().enableAndroidExpandedNotifications,l=a&&t;let d;if(s&&(s.enableExpandedNotifications=a),k=!0,1!==e.length||l)if(0===e.length)o.LocalNotifications.cancel({id:y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER});else{if(!l){const t=e[e.length-1];o.LocalNotifications.cancel({id:t.conversationId+t.messageTimestamp}),o.LocalNotifications.cancel({id:y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER})}const t=[],r=[];let a,c="",h=!1,p=0;i.each(e,(e=>{const s={category:e.category,title:e.title,message:e.message,id:e.id};e.messageTimestamp>p&&(c=e.messageCreatorName||"",p=e.messageTimestamp,e.serviceSpecificData&&(h=e.serviceSpecificData.eventType===u.NotificationTypeAppLaunched.Reaction)),t.push(s),r.push(e.conversationId)}));let m=!1;s&&!l&&(s.sound&&(a=s.sound),void 0!==s.enableVibration&&(m=s.enableVibration));const S={category:y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER,id:l?y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER:M.default.newGuid(),priority:o.NotificationPriority.Max,sound:a,silent:!a,enableVibration:m,enableExpandedNotifications:!!l,messageTimestamp:p};S.groupedNotifications=t,S.title=g.getString("Notifications.MultiNotificationTitle",{count:i.size(i.uniq(r))}),S.message=g.getString(h?"Notifications.MultiReactionNotificationMessage":"Notifications.MultiNotificationMessage",{creator:c||g.getString("Notifications.UnknownUser")}),S.enableLight=!0,S.icon=void 0,l&&s&&(v.printNotificationTrace(s,"recomputeAndroidNotification grouped current"),d=o.LocalNotifications.show(s)),v.printNotificationTrace(S,"recomputeAndroidNotification grouped");const f=o.LocalNotifications.show(S);d=d?n.all([f,d]).then(i.noop):f}else{const t=s||e[0];v.printNotificationTrace(t,"recomputeAndroidNotification single"),o.LocalNotifications.cancel({id:y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER}),d=o.LocalNotifications.show(t)}return k=!1,d||n.Resolved()},t.sendRawMessage=function(e,t){return A(e,t,void 0)},t.sendRawMessageFromEntities=function(e,t){return A(e,void 0,t)},t.getLastReactionUserMri=function(e){const t=e.getCleanedEmotionAnnotations(),s=i.maxBy(i.flatMap(t,(e=>i.map(e.users,(e=>e)))),(e=>e.time||Number.MAX_VALUE));if(s)return s.mri},t.getReasonForNotificationsDisabled=x,t.areNotificationsEnabled=function(){return void 0===x()}},314572:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageInitiator=t.isAddCurrentUserThreadActivity=void 0;const i=s(496486),o=s(351077),n=s(986374),r=s(312762),a=s(18078);t.isAddCurrentUserThreadActivity=function(e){if(!o.isAddMemberMessageType(e.messagetype))return!1;const t=n.decode(e),s=i.first(t.children);return s instanceof r.AddMemberNode&&!!i.find(s.content,(e=>a.default.isMyMri(e.getRawText())))},t.getMessageInitiator=function(e){const t=n.decode(e),s=t.children&&t.children.length>0?t.children[0]:void 0;if(s instanceof r.ThreadActivity){const e=s.initiator.getRawText();return e||void 0}}},229206:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageRenderingOptions=void 0;const i=s(893733),o=s(351077),n=(s(351077),s(228229)),r=s(396919),a=s(653859);t.getMessageRenderingOptions=function(e){if(e.skypeMessage.isReported())return a.getReportedMessageRenderingOptions(e);return function(e,t){switch(t){case r.PictureMessageRenderingOptions.messageTypeGroup:return new r.PictureMessageRenderingOptions(e);case r.VideoMessageRenderingOptions.messageTypeGroup:return new r.VideoMessageRenderingOptions(e);case r.AudioMessageRenderingOptions.messageTypeGroup:return new r.AudioMessageRenderingOptions(e);case r.MojiRenderingOptions.messageTypeGroup:return new r.MojiRenderingOptions(e);case r.StickerRenderingOptions.messageTypeGroup:return new r.StickerRenderingOptions(e);case r.MediaAlbumRenderingOptions.messageTypeGroup:return new r.MediaAlbumRenderingOptions(e);case i.ScheduledCallRenderingOptions.messageTypeGroup:return new i.ScheduledCallRenderingOptions(e);case i.PollRenderingOptions.messageTypeGroup:return new i.PollRenderingOptions(e);case i.LocationRenderingOptions.messageTypeGroup:return new i.LocationRenderingOptions(e);case i.CallInfoRenderingOptions.messageTypeGroup:return new i.CallInfoRenderingOptions(e);case i.FileMessageRenderingOptions.messageTypeGroup:return new i.FileMessageRenderingOptions(e);case i.SwiftMessageRenderingOptions.messageTypeGroup:return new i.SwiftMessageRenderingOptions(e);case i.ContactMessageRenderingOptions.messageTypeGroup:return new i.ContactMessageRenderingOptions(e);case a.TextMessageRenderingOptions.messageTypeGroup:return new a.TextMessageRenderingOptions(e);case a.SystemMessageRenderingOptions.messageTypeGroup:return new a.SystemMessageRenderingOptions(e);case a.SMSMessageRenderingOptions.messageTypeGroup:return new a.SMSMessageRenderingOptions(e);case a.CallerIDRenderingOptions.messageTypeGroup:return new a.CallerIDRenderingOptions(e);case a.EngagementMessageRenderingOptions.messageTypeGroup:return new a.EngagementMessageRenderingOptions(e);case n.UnknownMessageTypeRenderingOptions.messageTypeGroup:default:return new n.UnknownMessageTypeRenderingOptions(e)}}(e,o.getMessageTypeGroup(e.skypeMessage)).getRenderingOptions()}},359405:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getGalleryItemTimestamp=t.getMessageTimestamp=void 0;const i=s(397691),o=(s(496486),s(562141)),n=s(746096),r=s(436237),a=s(404057),l=s(914976);t.getMessageTimestamp=function(e,t){const s=e.MessageId,d=e.ServerMessageId?Number(e.ServerMessageId):void 0;return s?o.default.getMessageByCuid(t,s).then((e=>e?{timestamp:e.createdTime}:i.Rejected(void 0))).catch((e=>{const o=e?`err=${a.default.errorAsString(e)}`:"";return r.log(n.LogTraceArea.ContentPanel,`_getMessageTimestamp could not fetch message conversationId=${l.mriOrId(t)} cuid=${s} id=${d} ${o}`),i.Resolved({timestamp:d,cuid:s})})):i.Resolved({timestamp:d})},t.getGalleryItemTimestamp=function(e,t,s){return e?o.default.getMessageByCuid(t,e).then((e=>e?{timestamp:e.createdTime}:i.Rejected(void 0))).catch((o=>{const d=o?`err=${a.default.errorAsString(o)}`:"";return r.log(n.LogTraceArea.ContentPanel,`_getMessageTimestamp could not fetch message conversationId=${l.mriOrId(t)} cuid=${e} id=${s} ${d}`),i.Resolved({timestamp:s,cuid:e})})):i.Resolved({timestamp:s})}},798603:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shouldCancelMessageSelection=void 0,t.shouldCancelMessageSelection=function(e,t){return t!==e}},371639:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFontLarge=t.isFontSmall=t.getStyle=t.getStyleFromStyle=t.getSize=t.getMultiplier=t.setFontSize=void 0;const i=s(346338),o=s(516778),n=s(889391),r=s(436237),a=s(106658),l=s(901246),d=s(178735);function c(e){const t=n.default.getS4LMessagingFeaturesNoSubscription().messageStreamFontSizeMultiplier;switch(e){case a.MessageStreamFontSize.Smaller:return t.smaller;case a.MessageStreamFontSize.Small:return t.small;case a.MessageStreamFontSize.Large:return t.large;case a.MessageStreamFontSize.Larger:return t.larger;case a.MessageStreamFontSize.Normal:default:return t.normal}}function h(e,t){return Math.round(e*c(t))}function u(e,t){return o.Styles.createTextStyle({fontSize:h(e,t)},!1)}t.setFontSize=function(e,t){d.default.setUserPreferencesLocal({messageStreamFontSize:e}),r.track(new l.FontSizeSetting(e,t))},t.getMultiplier=c,t.getSize=h,t.getStyleFromStyle=function(e,t){const s=i.default.getFontSize(e);if(s)return u(s,t)},t.getStyle=u,t.isFontSmall=function(e){return e===a.MessageStreamFontSize.Small||e===a.MessageStreamFontSize.Smaller},t.isFontLarge=function(e){return e===a.MessageStreamFontSize.Large||e===a.MessageStreamFontSize.Larger}},50353:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(516778),n=s(397691),r=s(889391),a=s(476621),l=s(746096),d=s(436237),c=s(129510),h=s(481884),u=s(914976),p=s(422538);t.default=new class{constructor(){this._stores=new c.LinkedHashMap,this._removeLastCachedConversationOnGet=!1,this._conversationUpdatedCallback=e=>{i.each(e,(e=>{if(e.conv.isDeleted())if(e.conv.id===this._lastCachedConversationId)d.log(l.LogTraceArea.MessageStreamStoreCache,"Conversation updated callback for conversation delete"+u.mriOrId(e.conv.id)),this._removeLastCachedConversationOnGet=!0;else{const t=this._stores.remove(e.conv.id);t&&(d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying MessageStreamStore for "+u.mriOrId(e.conv.id)+" as conversation got deleted"),t.destroy())}}))},this._updateSettings=()=>{const e=r.default.getS4LMessagingFeaturesNoSubscription();this._maxCacheSize=e.messageStreamStoreCacheSize,this._maxMessageCountPerStore=e.messageStreamStoreCacheMaxMessageCount},this._destroyAllUnusedStores=()=>{for(d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying unused cached stores because of low memory");this._stores.length()>1;){this._stores.removeFirst().destroy()}},p.RegisterStartupable(this,"MessageStreamStoreCache",[a.default])}startup(){return r.default.subscribe(this._updateSettings),a.default.conversationsUpdated.subscribe(this._conversationUpdatedCallback),o.App.memoryWarningEvent.subscribe(this._destroyAllUnusedStores),this._updateSettings(),n.Resolved()}cachedStoreFor(e,t){if(this._removeLastCachedConversationOnGet){this._removeLastCachedConversationOnGet=!1;const e=this._stores.removeLast();e&&(d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying MessageStreamStore for "+u.mriOrId(e.getConversationId())+" as _removeLastCachedConversationOnGet == true for "+u.mriOrId(this._lastCachedConversationId)),e.destroy())}let s=this._stores.remove(e);const i=u.mriOrId(e)+" at="+(t||"EndOfTime");return s&&this._isCachedItemUseableFor(s,t)?d.log(l.LogTraceArea.MessageStreamStoreCache,"Reusing existing MessageStreamStore for "+i):(s&&s.destroy(),d.log(l.LogTraceArea.MessageStreamStoreCache,"Creating new MessageStreamStore for "+i+", was cached before: "+!!s),s=new h.MessageStreamStore(e,t)),this._removeStoresThatAreTooBigToBeCached(),this._removeFirstStoreIfNotEnoughSpace(),this._lastCachedConversationId=e,this._stores.addLast(e,s),s}_isCachedItemUseableFor(e,t){const s=e.getMessages();return 0===s.length?e.getTargetMessageTimestamp()===t:!(t&&i.first(s).createdTime>t||t&&i.last(s).createdTime<t||!t&&!e.isLatestMessageTheEnd())&&(!e.probablyShouldNotCache()||(d.log(l.LogTraceArea.MessageStreamStoreCache,"Invalidating MessageStreamStore for "+u.mriOrId(e.getConversationId())+" because it has a possible gap."),!1))}_removeStoresThatAreTooBigToBeCached(){const e=this._stores;for(this._stores=new c.LinkedHashMap;e.length()>0;){const t=e.removeFirst(),s=t.getMessages().length;s>this._maxMessageCountPerStore?(d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying MessageStreamStore for "+u.mriOrId(t.getConversationId())+" because its too big ("+s+" > "+this._maxMessageCountPerStore+" messages)"),t.destroy()):this._stores.addLast(t.getConversationId(),t)}}_removeFirstStoreIfNotEnoughSpace(){if(this._stores.length()>this._maxCacheSize){const e=this._stores.removeFirst();d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying MessageStreamStore for "+u.mriOrId(e.getConversationId())+" to free up space in the cache (max "+this._maxCacheSize+")"),e.destroy()}}}},353743:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetEmoticonSuggestions=void 0;const i=s(496486),o=s(82433),n=s(497174),r=s(395868),a=s(526424);t.GetEmoticonSuggestions=function(e,t,s){const l=[];if(!t)return l;if(1===(e=e.toLowerCase()).length&&e[0]>="a"&&e[0]<="z")return l;const d=o.default.getEmoticonsNoSubscription(),c={};i.each(d,((t,s)=>{e.length>=s.length||0!==s.indexOf(e)||c[t.id]||(c[t.id]=s)}));let h=i.sortBy(c,(e=>e.length));if(0===h.length&&"("===i.first(e))if(i.last(e)===a.DiverseToneSeparator){const t=e.slice(0,-1)+")",s=d[t];if(s&&s.diverse)return i.each(a.DiverseToneSuffixes,(i=>{const o=new n.EmoticonEntity(t,s.id,i);l.push({entity:o,charsToReplace:e.length,replacementText:o.text()})})),l}else if(e.length>1&&":"===e.charAt(e.length-2)){const t=e.slice(0,-2)+")",s=d[t];if(s&&s.diverse){const o=r.default.getItemToneFromString(e.charAt(e.length-1));if(i.includes(a.DiverseToneSuffixes,o)){const i=new n.EmoticonEntity(t,s.id,o);l.push({entity:i,charsToReplace:e.length,replacementText:i.text()})}return l}}return h.length>s&&(h=h.slice(0,s)),i.each(h,(t=>{const s=o.default.getEmoticonByShortcutNoSubscription(t);if(!s)return;const i=new n.EmoticonEntity(t,s.id,s.tone);l.push({entity:i,charsToReplace:e.length,replacementText:t})})),l}},674323:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBackgroundColorStyleForMessage=void 0;const i=s(516778),o=s(23293),n=s(770891),r=s(89808),a=s(581760),l=s(163841),d=s(897634);function c({postedByCurrentUser:e,postedByBot:t},s){return!!t||(e&&s||!e&&!s)}t.getBackgroundColorStyleForMessage=function(e){let t,s;e.postedByCurrentUser||e.theme===l.Theme.Mono?(t=r.default.getColorInfo(),s=r.default.getPrimaryColor()):(t=o.default.getColorInfo(e.messageCreatorMri),s=o.default.getPrimaryColor(e.messageCreatorMri));const h=function(e,t){return"classic"!==t.key&&e}(!!e.flipBubbleColors,t),u=!h,p=e.messageRenderOrigin!==n.MessageRenderOrigin.StackGalleryCanvas&&e.messageRenderOrigin!==n.MessageRenderOrigin.CompositeGalleryCanvas,g=c(e,h)||(m=e.theme,d.isAccessibleTheme(m));var m;let S,f;const y=e.themeStyles.secondaryTextColorStyle;S=e.postedByBot&&e.themeStyles.bubbleTextColorBotStyle?e.themeColors.bubbleTextColorBot:e.postedByCurrentUser&&p&&!u||e.postedByCurrentUser&&!p&&d.isAccessibleTheme(e.theme)||!e.postedByCurrentUser&&h?e.themeColors.bubbleTextColorSelf:e.themeStyles.bubbleTextColorOtherStyle?e.themeColors.bubbleTextColorOther:e.themeColors.primaryTextColor;const v=(!e.postedByCurrentUser&&!h||e.postedByCurrentUser&&h)&&d.isDarkTheme(e.theme)&&"classic"!==r.default.getColorInfo().key?a.Color.white:e.themeColors.textPrimary,C=i.Styles.createTextStyle({color:v},!1);e.postedByCurrentUser||d.isDelphiTheme(e.theme)||(f=e.theme===l.Theme.AccessibleDark?C:i.Styles.createTextStyle({color:a.Color.white},!1));const _=e.messageStreamHasUnderlay?a.Color.transparent:e.themeColors.messageStreamBackgroundColor,b=function(e,t){return c(e,t)?e.themeColors.surfaceSecondary:e.themeColors.bubble}(e,h);return{messageTextOverrideColorStyle:C,linkOverrideColorStyle:f,quoteAttributeOverrideColorStyle:y,userIconBackgroundColor:_,bubbleColor:b,disableGradient:g,userPrimaryColor:s,quoteColor:S}}},866127:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(809206),o=s(889391),n=s(343632),r=s(360305),a=s(330124);t.default=new class{canModernizeConversationList(){return!this._isSupportedPlatform()||r.default.isTablet()&&!a.default.isUsingStackNavigationContext()}canSetEmoticonAvatarForGroupProfile(){const e=o.default.getS4LMeetNowFeatures().mobileMeetingAvatarAndTitlePickerEnabled,t=(0,n.canGenerateAvatars)();return a.default.isMobileEnvironmentWithStackNavigation()&&t?!e&&r.default.isTabletNoSubscription():t}modernizeChatHeaderMobileVersion(){return this._isSupportedPlatform()&&!(r.default.isTablet()&&!a.default.isUsingStackNavigationContext())}_isSupportedPlatform(){return i.default.isMobile()}}},844972:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isRegularMemberInModeratedGroup=t.isCurrentUserAdminInModeratedGroup=t.isModerated=void 0;const i=s(889391),o=s(18078);t.isModerated=e=>i.default.getS4LMessagingFeaturesNoSubscription().enableModeratedGroupChats&&!!(null==e?void 0:e.isModerated());t.isCurrentUserAdminInModeratedGroup=e=>(0,t.isModerated)(e)&&!!(null==e?void 0:e.isAdmin(o.default.getSkypeMri()));t.isRegularMemberInModeratedGroup=e=>(0,t.isModerated)(e)&&!(null==e?void 0:e.isAdmin(o.default.getSkypeMri()))},503644:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MriThreadMapping=void 0;const i=s(496486);t.MriThreadMapping=class{constructor(){this._threadIdByMri={},this._mriByThreadId={}}add(e,t){this._threadIdByMri[e]=t,this._mriByThreadId[t]=e}hasThreadId(e){return!i.isUndefined(this._mriByThreadId[e])}getMriByThreadId(e){return this._mriByThreadId[e]}getThreadIdByMri(e){return this._threadIdByMri[e]}}},62658:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(640363),o=s(671830);t.default=new class{shouldShowFreHeader(e,t){return!!e&&(!t||t!==i.default.getAppVersion())}canDeleteContractWithMybot(e,t=!1,s=!1){const i=!!e&&o.isMyBotConversation(e);return!t&&s&&!i}}},783294:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getGifSwiftMessage=t.getInlineSearchPreviewDimensions=t.getGifAttribution=t.getNoSearchResultsAnnouncementKey=t.getSearchResultsAnnouncementKey=t.searchInPackDescriptionAndItemMetadata=t.searchInPackTitleAndDescription=t.searchInPackTitleAndItemKeyword=t.defaultTabType=void 0;const i=s(496486),o=s(583367),n=s(82433),r=s(770891),a=s(753559),l=s(733754),d=s(572666),c=s(526424),h=s(758962),u=s(713130),p=s(404057);function g(){return l.getString("PesPicker.TenorAttribution")}t.defaultTabType=h.TabType.Emoticon,t.searchInPackTitleAndItemKeyword=function(e,t){return t=p.default.deburr(t),i.map(e,(e=>{let s=i.filter(e.packs,(e=>!!e.description&&e.description.toLowerCase().indexOf(t)>-1));const o=i.differenceBy(e.packs,s,(e=>e.id));return s=i.map(o,(e=>{const s=i.filter(e.items,(e=>{const s=(o=e,n.default.getEmoticonByName(o));var o;if(s){const e=s.description&&p.default.deburr(s.description).toLowerCase().indexOf(t)>-1;let o,n;return e||(o=i.findIndex(s.keywords,(e=>p.default.deburr(e).indexOf(t)>-1))>-1),e||o||(n=i.findIndex(s.shortcuts,(e=>e.indexOf(t)>-1))>-1),e||!!o||!!n}return!1}));return Object.assign(Object.assign({},e),{items:s})})).concat(s),s=i.filter(s,(e=>e.items&&e.items.length>0)),Object.assign(Object.assign({},e),{packs:s})}))},t.searchInPackTitleAndDescription=function(e,t){return i.map(e,(e=>{let s=i.filter(e.packs,(e=>!!e.description&&e.description.toLowerCase().indexOf(t)>-1));const o=i.differenceBy(e.packs,s,(e=>e.id));return s=i.map(o,(e=>{const s=i.filter(e.items,(e=>{const s=(o=e,d.default.getMoji(o));var o;if(s){const e=s.pickerTitle&&s.pickerTitle.toLowerCase().indexOf(t)>-1,o=!e&&i.findIndex(s.keywords,(e=>e.indexOf(t)>-1))>-1;return e||o}return!1}));return Object.assign(Object.assign({},e),{items:s})})).concat(s),s=i.filter(s,(e=>e.items&&e.items.length>0)),Object.assign(Object.assign({},e),{packs:s})}))},t.searchInPackDescriptionAndItemMetadata=function(e,t){return i.map(e,(e=>{let s=i.filter(e.packs,(e=>!!e.description&&e.description.toLowerCase().indexOf(t)>-1));const o=i.differenceBy(e.packs,s,(e=>e.id));return s=i.map(o,(e=>{const s=i.filter(e.items,(e=>{const s=(i=e,u.default.getSticker(i));var i;if(s){const e=!!s.name&&s.name.toLowerCase().indexOf(t)>-1,i=!e&&!!s.description&&s.description.toLowerCase().indexOf(t)>-1;return e||i}return!1}));return Object.assign(Object.assign({},e),{items:s})})).concat(s),s=i.filter(s,(e=>e.items&&e.items.length>0)),Object.assign(Object.assign({},e),{packs:s})}))},t.getSearchResultsAnnouncementKey=function(e){switch(e){case h.TabType.Emoticon:return"PesSearch.SearchResultsAnnouncementEmoticons";case h.TabType.ChatSticker:return"PesSearch.SearchResultsAnnouncementStickers";case h.TabType.Moji:return"PesSearch.SearchResultsAnnouncementMojis";case h.TabType.Gif:return"PesSearch.SearchResultsAnnouncementGifs";default:return"PesSearch.DefaultPickerNoResultsSearchAccessibility"}},t.getNoSearchResultsAnnouncementKey=function(e){switch(e){case h.TabType.Emoticon:return"PesSearch.EmoticonPickerNoResultsSearchAccessibility";case h.TabType.ChatSticker:return"PesSearch.StickerPickerNoResultsSearchAccessibility";case h.TabType.Moji:return"PesSearch.MojiPickerNoResultsSearchAccessibility";case h.TabType.Gif:return"PesSearch.GifPickerNoResultsSearchAccessibility";default:return"PesSearch.DefaultPickerNoResultsSearchAccessibility"}},t.getGifAttribution=g,t.getInlineSearchPreviewDimensions=function(e,t){return t&&e===o.DeviceOrientation.Landscape?c.PesCarouselGifSizeLandscape:c.PesCarouselGifSizePortrait},t.getGifSwiftMessage=function(e){const t=g();return{type:r.SwiftMessageTypes.card,attachments:[{contentType:r.SwiftContentTypes.flex,content:{shareable:!0,subtitle:t,images:[{alt:e.title,url:e.full.url,tap:{type:r.SwiftActionTypes.showImage},type:a.default.imageContentTypes.gif,stillUrl:e.full.stillUrl,frames:e.full.frames}],aspect:e.full.width+":"+e.full.height,dimensions:{width:e.full.width,height:e.full.height}}}]}}},382677:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getReactionTone=t.isTonedReaction=t.getCustomReactionsStore=t.getReactionName=t.separateReactionNameAndTone=t.updateReactionNameWithTone=t.addRemoveReactionFromMessage=void 0;const i=s(871908),o=s(671830),n=s(351077),r=s(685329),a=s(317219),l=s(746096),d=s(436237),c=s(884912),h=s(395868),u=s(18078),p=":";function g(e,t){return t?e+p+t:e}function m(e){return-1!==e.indexOf(p)&&(e=e.replace(/\:./,"")),e}function S(e){const t=e.indexOf(p);let s;return-1!==t&&(s=+e.charAt(t+1)),s?h.default.getItemToneFromNumber(s):void 0}function f(e,t,s,i){const o=e.reactionAction;o.success=s,t.recordReactionAdded(o),d.track(t),i&&i(!!o.success),o.success||d.error(l.LogTraceArea.ChatService,(e.reactionAction.reactionAdded,"react "))}t.addRemoveReactionFromMessage=function(e,t,s){const r=e.message;if(u.default.isMyMri(r.creator)||o.isPhoneMri(r.conversationId)||r.messagetype===n.MessageTypes.TeamsHtml)return;const a=e.reactionAction,l=g(a.reaction,a.reactionTone);a.reactionAdded?i.addEmotionAnnotation(r,l).then((()=>{f(e,t,!0,s)})).fail((()=>{f(e,t,!1,s)})):i.removeEmotionAnnotation(r,l).then((()=>{f(e,t,!0,s)})).fail((()=>{f(e,t,!1,s)}))},t.updateReactionNameWithTone=g,t.separateReactionNameAndTone=function(e){return{reactionTone:S(e),reactionNameWithoutTone:m(e)}},t.getReactionName=m,t.getCustomReactionsStore=function(e){return e===c.CustomReactionsType.Call?(0,r.default)():(0,a.default)()},t.isTonedReaction=function(e){return void 0!==S(e)},t.getReactionTone=S},655759:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.forwardContact=t.shareContact=void 0;const i=s(351077),o=s(882261),n=s(497174),r=s(923944),a=s(785207);t.shareContact=function(e,t,s){const r=new n.ContactEntity(e.skypeId,e.fullName,e.isPstn,e.skypeId,e.isS4B),l=o.createMessageInfo(t,s,[r],i.MessageTypes.Contacts);a.default.postMessage(l)},t.forwardContact=function(e,t,s){const l=r.encode([new n.ContactEntity(e.skypeId,e.fullName,e.isPstn,e.skypeId,e.isS4B)],!1),d=o.createForwardMessageInfo(t,s,l,i.MessageTypes.Contacts);a.default.postMessage(d)}},5899:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(203092),n=s(219784),r=s(351077),a=s(781725),l=s(882261),d=s(746096),c=s(497174),h=s(497174),u=s(436237),p=s(733754),g=s(312762),m=s(812056),S=s(10909),f=s(104735),y=s(795691),v=s(921090),C=s(785207),_=s(316392),b=s(932293),T=s(853374);class M{static getShareParametersForAdaptiveMessage(e,t,s){const n=t.getFirstUriObjectChild(g.SwiftUriObjectNode);if(n){const t=i.find(n.children,(e=>e instanceof g.AdaptiveCardNode));if(t&&t.adaptiveCardMessage){const i=()=>{o.TrackForwarding(e.creator)};return{messageContent:e.content,messageType:e.messagetype,adaptiveCardMessage:t.adaptiveCardMessage,conversationId:s,onShareCompleteForMessage:i}}}}static forwardDocument(e,t,s){const i=T.default.newCauseId();u.log(d.LogTraceArea.GenericUnsafe,"ShareMessageUtils.forwardMediaMessage, causeId: "+i);const o=this.getShareParametersForMedia(e,t,!0,s.rootViewId);o&&f.default.navigateToShareWithPanel({multipleMessagesParameters:[o],shareMessageTitle:p.getString("StreamItem.ForwardMessagesHeader",{count:1}),navigationDirection:_.StackNavigationDirection.Present,causeId:i,entryPoint:d.SharePanelEntryOrigin.DocumentActionMenu,sharePreviewType:y.SharePreviewType.File},s)}static showErrorForForwardMedia(e){n.default.showOKAlert(p.getString("ShareMessageUtils.FailedForwardMediaTitle"),p.getString("ShareMessageUtils.FailedFowardMediaDescription"),e)}static getShareParametersForSwiftMessage(e,t,s,o,n,r){const a=t.getFirstUriObjectChild(g.SwiftUriObjectNode);if(a){let s;const l=i.find(a.children,(e=>e instanceof g.SwiftNode));if(l&&l.swiftMessage){const a=i.map(l.swiftMessage.attachments,(e=>e.unsanitizedAttachment)),c={type:l.swiftMessage.type,summary:l.swiftMessage.summary,attachments:a},h=i.flatMap(a,(e=>b.default.getForwardMediaInfos(e))),u=()=>{o&&r&&f.default.navigateToConversation({convId:o,origin:d.NavigationConversationOrigin.SwiftForwardComplete,causeId:n})};if(!b.default.isSwiftCarousel(t)){const e=l.swiftMessage.attachments;e&&e.length&&(s=b.default.getImageUrl(e[0]))}return{messageContent:e.content,messageType:e.messagetype,swiftMessage:c,forwardMediaInfos:h,conversationId:o,onShareCompleteForMessage:u,localMediaThumbnailUri:s}}}}static shareSwiftMessageWithConfig(e){this._shareSwiftMessage(e.message,e.shareMessageTitle,e.sharePanelEntryOrigin,e.onShareComplete,e.onPostComplete,e.onShareCancel,e.conversationId,e.componentContext,e.isMagicBotShare)}static getShareParametersForText(e,t,s){let i,o,n;const l=a.toForwardUrlInfo(e);return l?i=l.url:(n=t.hasOnlyQuotedContent(),o=a.toForwardQuoteMessageEntities(e)),{message:e,inputEntities:o,messageType:r.MessageTypes.RichText,onShareCompleteForMessage:t=>{const i=new m.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,s,m.MessageActionType.Forward,t);u.track(i)},urlPreviewData:l,url:i,sendAsForwardedQuote:n}}static getShareParametersForAlbumMsg(e,t,s){return{messageContent:l.createMediaAlbumMessage(e.conversationId,d.PostSource.ForwardAlbum,s).messageForPosting.content,messageType:r.MessageTypes.MediaAlbum,onShareCompleteForMessage:s=>{const i=new m.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,t,m.MessageActionType.Forward,s);u.track(i)},albumId:s}}static shareMultipleMessages(e,t,s,i,o,n,r,a,l){f.default.navigateToShareWithPanel({multipleMessagesParameters:e,shareMessageTitle:t,navigationDirection:_.StackNavigationDirection.Present,onShareComplete:o,causeId:s,sharePreviewType:r,showForwardPreview:a,entryPoint:i,onExternalShare:l},n)}static getShareParametesForLocation(e,t){const s=a.toForwardLocationInfo(e);return{messageContent:e.content,messageType:r.MessageTypes.Location,onShareCompleteForMessage:s=>{const i=new m.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,t,m.MessageActionType.Forward,s);u.track(i)},locationInfo:s,localMediaThumbnailUri:s?s.snapshotUri:void 0}}static shareLocation(e,t,s){const i=[this.getShareParametesForLocation(e,t)],o=T.default.newCauseId();u.log(d.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareLocation, causeId: "+o),f.default.navigateToShareWithPanel({multipleMessagesParameters:i,shareMessageTitle:p.getString("StreamItem.ForwardLocationMessageHeader"),navigationDirection:_.StackNavigationDirection.Present,causeId:o,entryPoint:d.SharePanelEntryOrigin.LocationActionMenu,sharePreviewType:y.SharePreviewType.Location},s)}static getShareParametesForContactEntity(e,t,s){return{messageType:r.MessageTypes.Contacts,onShareCompleteForMessage:s||void 0,inputEntities:e,contactInfo:{skypeId:e.getSkypeId(),fullName:e.getFullName(),isPstn:e.isPstn(),isS4B:e.isS4B(),userMri:t}}}static getShareParametesForContactMessage(e,t,s){const i=a.toForwardContactInfo(e);if(!i)return;const o=new c.ContactEntity(i.skypeId,i.fullName,i.isPstn,i.isPstn?i.skypeId:"",i.isS4B);return{messageType:r.MessageTypes.Contacts,onShareCompleteForMessage:s||(s=>{const i=new m.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,t,m.MessageActionType.Forward,s);u.track(i)}),inputEntities:o,contactInfo:{skypeId:o.getSkypeId(),fullName:o.getFullName(),isPstn:o.isPstn(),userMri:i.userMri,isS4B:o.isS4B()}}}static shareContact(e,t,s,i){const o=T.default.newCauseId(),n=[this.getShareParametesForContactEntity(e,s,i)];f.default.navigateToShareWithPanel({multipleMessagesParameters:n,shareMessageTitle:p.getString("StreamItem.ForwardMessageContact"),navigationDirection:_.StackNavigationDirection.Present,causeId:o,entryPoint:d.SharePanelEntryOrigin.UserProfile,sharePreviewType:y.SharePreviewType.Contact,showForwardPreview:!1},t,!0)}static shareSwiftMessageToConversation(e,t,s){const i=new h.SwiftUriObjectEntity(e,t,!0,e.summary),o=l.createMessageInfo(t,d.PostSource.ShareSwiftMessage,[i],r.MessageTypes.Media_Card);C.default.postMessage(o),s&&s(e,{clientMessageId:o.messageForPosting.clientmessageid,conversationId:o.conversationId})}static shareAdaptiveMessageToConversation(e,t,s){const i=new h.AdaptiveUriObjectEntity(e,t,!0),o=l.createMessageInfo(t,d.PostSource.ShareSwiftMessage,[i],r.MessageTypes.Media_Card);C.default.postMessage(o),s&&s(e,{clientMessageId:o.messageForPosting.clientmessageid,conversationId:o.conversationId})}static shareMessageFromBrowser(e,t,s){const i=T.default.newCauseId();u.log(d.LogTraceArea.Navigation,"ShareMessageUtils.shareMessageFromBrowser, causeId: "+i),e.forward||!e.conversationId?M.shareSwiftMessageWithConfig({message:e.swiftMessage,shareMessageTitle:p.getString("InAppWebBrowser.ShareCardPanelTitle"),sharePanelEntryOrigin:d.SharePanelEntryOrigin.AddInMenu,onShareComplete:()=>{if(e.shareAndStay||f.default.closeInAppBrowser(i,s),e.showCompleteToast){const e=v.rootViewIdForComponentContext(s);S.default.scheduleTextMessage(p.getString("InAppWebBrowser.CardSharedTitle"),void 0,e)}},onPostComplete:t=>{e.onCardPostComplete&&e.onCardPostComplete(e,t)},onShareCancel:()=>{e.onShareCancel&&e.onShareCancel()},componentContext:s}):(e.shareAndStay||f.default.closeInAppBrowser(i,s),t?M.shareAdaptiveMessageToConversation(e.adaptiveMessage,e.conversationId,((t,s)=>{e.onCardPostComplete&&e.onCardPostComplete(e,[s])})):e.swiftMessage&&M.shareSwiftMessageToConversation(e.swiftMessage,e.conversationId,((t,s)=>{e.onCardPostComplete&&e.onCardPostComplete(e,[s])})))}static shareUrl(e,t,s,i,o,n,a,l,c){const h=T.default.newCauseId();u.log(d.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareUrl, causeId: "+h);const p={url:e,messageType:r.MessageTypes.RichText,conversationId:n};f.default.navigateToShareWithPanel({multipleMessagesParameters:[p],shareMessageTitle:t,navigationDirection:_.StackNavigationDirection.Present,onShareComplete:s,onPostComplete:i,onShareCancel:o,causeId:h,entryPoint:l||d.SharePanelEntryOrigin.InAppBrowserActionMenu,sharePreviewType:y.SharePreviewType.Text,onExternalShare:c},a)}static shareUrlToConversation(e,t,s){const i=new h.LinkEntity(e,e),o=l.createMessageInfo(t,d.PostSource.ShareUrl,[i],r.MessageTypes.RichText);C.default.postMessage(o),s&&s({clientMessageId:o.messageForPosting.clientmessageid,conversationId:o.conversationId})}static shareUrlFromInAppBrowser(e,t){const s=T.default.newCauseId();u.log(d.LogTraceArea.Navigation,"ShareMessageUtils.shareUrlFromInAppBrowser, causeId: "+s),e.forward||!e.conversationId?M.shareUrl(e.url,p.getString("InAppWebBrowser.ShareLinkPanelTitle"),(()=>{var i;if(e.shareAndStay||f.default.closeInAppBrowser(s,t),e.showCompleteToast){const e=v.rootViewIdForComponentContext(t);S.default.scheduleTextMessage(p.getString("InAppWebBrowser.LinkSharedTitle"),void 0,e)}null===(i=e.onShareComplete)||void 0===i||i.call(e)}),(t=>{e.onUrlPostComplete&&e.onUrlPostComplete(e,t)}),(()=>{e.onShareCancel&&e.onShareCancel()}),void 0,t,e.sharePanelEntryOrigin,e.onExternalShare):(e.shareAndStay||f.default.closeInAppBrowser(s,t),M.shareUrlToConversation(e.url,e.conversationId,(t=>{e.onUrlPostComplete&&e.onUrlPostComplete(e,[t])})))}static sharePhoto(e,t,s,i,o,n,a,l,c,h){const p=T.default.newCauseId();u.log(d.LogTraceArea.GenericUnsafe,"ShareMessageUtils.sharePhoto, causeId: "+p);const g={localMediaObjectUri:e,localMediaThumbnailUri:t,fileSize:s,width:i,height:o,messageType:r.MessageTypes.UriObject,conversationId:l,cameraMode:c};f.default.navigateToShareWithPanel({multipleMessagesParameters:[g],shareMessageTitle:n,navigationDirection:_.StackNavigationDirection.Push,onShareComplete:a,causeId:p,entryPoint:d.SharePanelEntryOrigin.CapturePhotoOrVideo},h)}static shareVideo(e,t,s,i,o,n,a,l,c,h){const p=T.default.newCauseId();u.log(d.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareVideo, causeId: "+p);const g={localMediaObjectUri:e,localMediaThumbnailUri:t,fileSize:s,width:i,height:o,messageType:r.MessageTypes.Media_Video,conversationId:l,cameraMode:c};f.default.navigateToShareWithPanel({multipleMessagesParameters:[g],shareMessageTitle:n,navigationDirection:_.StackNavigationDirection.Push,onShareComplete:a,causeId:p,entryPoint:d.SharePanelEntryOrigin.CapturePhotoOrVideo},h)}static shareMediaSelection(e,t,s,i,o){const n=T.default.newCauseId();u.log(d.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareMediaSelection, causeId: "+n);const a={mediaSelection:e,messageType:e.node.node.isPhoto?r.MessageTypes.UriObject:r.MessageTypes.Media_Video,conversationId:i};f.default.navigateToShareWithPanel({multipleMessagesParameters:[a],shareMessageTitle:t,navigationDirection:_.StackNavigationDirection.Push,onShareComplete:s,causeId:n,entryPoint:d.SharePanelEntryOrigin.MessageActionMenu},o)}static _shareSwiftMessage(e,t,s,o,n,a,l,c,h){const p=T.default.newCauseId();u.log(d.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareSwiftMessage, causeId: "+p);const g=i.flatMap(e.attachments,(e=>b.default.getForwardMediaInfos(e))),m={swiftMessage:e,messageType:r.MessageTypes.Media_Card,forwardMediaInfos:g,conversationId:l,onShareCompleteForMessage:o};f.default.navigateToShareWithPanel({multipleMessagesParameters:[m],shareMessageTitle:t,navigationDirection:_.StackNavigationDirection.Present,onPostComplete:n,onShareCancel:a,causeId:p,entryPoint:s,isMagicBotShare:h},c)}}M.getShareParametersForMedia=(e,t,s,i,o)=>{const n=a.toForwardMediaInfo(e);if(s&&!n)return void M.showErrorForForwardMedia(i);const r=Object.assign({},n);return{messageContent:e.content,messageType:e.messagetype,forwardMediaInfos:[r],onShareCompleteForMessage:s=>{const i=new m.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,t,m.MessageActionType.Forward,s);u.track(i)},localMediaThumbnailUri:r&&r.localMediaThumbnailUri,fileName:r&&r.filename,fileSize:r&&r.fileSize,fileType:r&&r.fileType,audioMessageDuration:r&&r.durationMs,albumId:o}},t.default=M},994165:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(351077),r=s(882261),a=s(746096),l=s(497174),d=s(733754),c=s(381157),h=s(795691),u=s(785207),p=s(415963),g=s(853374),m="image",S="video";class f{static processShareEvent(e,t=""){switch(e.type){case"text":return this._processTextShareEvent(e);case"media":return this._processMediaShareEvent(e,t);default:return g.default.switchStatementExhaustiveChecking(e.type)}}static _processTextShareEvent(e){return{multipleMessagesParameters:[{messageContent:e.text}],sharePreviewType:h.SharePreviewType.Text,directShareMri:e.directShareMri}}static _processMediaShareEvent(e,t){if(!e.data||i.isEmpty(e.data))return;return{multipleMessagesParameters:this._formatMediaMessageParameters(e.data,t),sharePreviewType:this._findMediaPreviewType(e.data),directShareMri:e.directShareMri}}static _formatMediaMessageParameters(e,t){return i.map(e,(e=>({localMediaThumbnailUri:t+(e.thumbnailUri||e.uri),fileName:e.name,fileSize:e.size})))}static _findMediaPreviewType(e){return i.every(e,(e=>e.type===m))?h.SharePreviewType.Photo:i.every(e,(e=>e.type===S))?h.SharePreviewType.Video:i.every(e,(e=>e.type===S||e.type===m))?h.SharePreviewType.MixedVideoAndPhoto:i.some(e,(e=>"file"===e.type))?h.SharePreviewType.File:h.SharePreviewType.Text}static postSharedMessage(e,t,s){return"media"===e.type?this._postSharedMedia(e.data,t,s):o.Resolved()}static _postSharedMedia(e,t,s){return c.default.postShareEventMediaSelections(e,t,{name:p.ScenarioName.ShareToSkypeMedia},s)}static getPreviewInfoTitle(e,t){return e&&1===e.length?e[0].fileName||"":this._getTitleWithShareItemsCount(e,t)}static _getTitleWithShareItemsCount(e,t){let s;switch(t){case h.SharePreviewType.Photo:s=d.getString("ShareWithPanel.PhotoCount",{count:e.length});break;case h.SharePreviewType.Video:s=d.getString("ShareWithPanel.VideoCount",{count:e.length});break;default:s=d.getString("ShareWithPanel.GenericCount",{count:e.length})}return s}static getPreviewInfoSizeInBytes(e){let t=0;return i.each(e,(e=>{e.fileSize&&(t+=e.fileSize)})),t}static sendPreviewTextMessage(e,t){const s=[new l.UnhandledEntity(t)];i.each(e,(e=>{u.default.postMessageFromInput(e,a.PostSource.ShareToSkype,s,n.MessageTypes.RichText,{name:p.ScenarioName.ForwardAdditionalText})}))}static shareMessageEntities(e,t,s,i=n.MessageTypes.RichText){const o=s?n.getForwardedTeamsProperties(s.properties):void 0,l=r.createForwardMessageInfoFromEntities(e,a.PostSource.ShareWith,t,i,o);return u.default.postMessage(l),{clientMessageId:l.messageForPosting.clientmessageid||"",conversationId:e}}static sendUrlAsLink(e,t){const s=[new l.LinkEntity(e,e)];return f.shareMessageEntities(t,s,void 0)}static sendUrlAsLinkMultipleConvs(e,t){i.each(t,(t=>{this.sendUrlAsLink(e,t)}))}}t.default=f},135455:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultEmoticonSize=t.getStickerUrl=t.StickerSize=void 0;const i=s(889391),o=s(758962),n=s(675865);var r;!function(e){e[e.ThumbLarge=0]="ThumbLarge",e[e.ThumbSmall=1]="ThumbSmall",e[e.ThumbNail=2]="ThumbNail",e[e.Large=3]="Large"}(r=t.StickerSize||(t.StickerSize={}));const a=i.default.getConfigSettingsNoSubscription().pes.rewriteRules;t.getStickerUrl=function(e,t,s,i,l){const d=o.rewriteUrl(e,a);let c;return c=t===r.ThumbLarge?`${d}/views/thumblarge?etag=${l||"v1"}`:t===r.ThumbSmall?`${d}/views/thumbsmall?etag=${l||"v1"}`:t===r.ThumbNail?`${d}/views/thumbnail?etag=${l||"v1"}`:`${d}/views/large?etag=${l||"v1"}`,n.default.getAuthenticatedUrl(c)},t.getDefaultEmoticonSize=function(){return r.ThumbLarge}},782176:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(889391),o=s(753559),n=s(178735),r=3600;t.default=class{static changeExtensionForTelemetry(e){const t=i.default.getAsyncMediaFeatures().max_extension_length;return e?e.length<=t?e:"..."+e.substring(e.length-t).toLowerCase():""}static extractExtensionForTelemetry(e){const t=o.default.extractFileExtension(e,!0);return this.changeExtensionForTelemetry(t)}static currentMediaProfile(){const e=i.default.getS4LCMCFeatures().picturePrefetch,t=n.default.getUserPreferencesLocal().picturePrefetchMode||i.default.getS4LCMCFeatures().picturePrefetch.status;let s="ppref_"+t;if("Off"!==t){const t=Math.round(e.maxTimeIntervalPriorToStartupSec/r);s=s+"_"+e.maxQueuedEntriesCount+"_"+t+"h"}return s+"_"+("pcache_"+Math.round(i.default.getS4LCMCFeatures().picturePrefetchCacheExpiryTimeSec/r)+"h_vcache_"+Math.round(i.default.getS4LCMCFeatures().videoPrefetchCacheExpiryTimeSec/r)+"h")}}},653859:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EngagementMessageRenderingOptions=t.getReportedMessageRenderingOptions=t.CallerIDRenderingOptions=t.SMSMessageRenderingOptions=t.SystemMessageRenderingOptions=t.TextMessageRenderingOptions=void 0;const i=s(496486),o=s(516778),n=s(889391),r=s(351077),a=s(671830),l=s(228229),d=s(913991),c=s(770891),h=s(923944),u=s(915877),p=s(733754),g=s(312762),m=s(563032),S=s(106658),f=s(600750),y=s(640363),v=s(360305),C=s(510609),_=(0,u.lazyProperties)({radius:()=>(0,u.lazyProperties)({currentUserUrlPreviewThumbnail:()=>o.Styles.createViewStyle({borderTopLeftRadius:S.messageBorderRadius,borderTopRightRadius:S.messageBorderRadius}),otherUserUrlPreviewThumbnail:()=>o.Styles.createViewStyle({borderTopLeftRadius:0,borderTopRightRadius:S.messageBorderRadius}),currentUserSubsequentMessage:()=>o.Styles.createViewStyle({borderTopRightRadius:0,borderBottomRightRadius:0}),currentUserSubsequentMessageRTL:()=>o.Styles.createViewStyle({borderTopLeftRadius:0,borderBottomLeftRadius:0}),othersSubsequentMessage:()=>o.Styles.createViewStyle({borderBottomLeftRadius:0}),othersSubsequentMessageRTL:()=>o.Styles.createViewStyle({borderBottomRightRadius:0})})});class b extends l.DefaultMessageRenderingOptions{constructor(e){super(e),this.messageProperties=e,e.isDisplayUrlPreviewsEnabled&&(this._urlPreviewData=C.getUrlPreviewInformationForMessage(e.skypeMessage,e.decodedNode),this._hasOnlyOneWebLink=C.hasOnlyWebLink(this._urlPreviewData,e.decodedNode),this._renderOnlyUrlPreview=this._hasOnlyOneWebLink&&this._urlPreviewData[0].isValid&&!e.decodedNode.isOnlyHyperLink())}_getTextMessageRadiusStyle(e){const t=y.default.isRTL();return this._messageProperties.skypeMessage.isBookmark()||(this._messageProperties.postedByCurrentUser?this._messageProperties.messageFirstInGroup||e.push(t?_.radius.currentUserSubsequentMessageRTL:_.radius.currentUserSubsequentMessage):this._messageProperties.messageLastInGroup||e.push(t?_.radius.othersSubsequentMessageRTL:_.radius.othersSubsequentMessage)),e}getMessageSpecificViewRenderingOptions(e){const t=this._messageProperties.skypeMessage.isEmote(),s=this._messageProperties.decodedNode.hasOnlyEmoticonsOrWhitespaceText(),o=n.default.getS4LMessagingFeaturesNoSubscription().enableNewEmoticonBackgroundRenderLogic?this._messageProperties.decodedNode.hasOnlyEmoticonsOrSpaceChars():s,a=this._messageProperties.decodedNode.hasOnlyUnicodeEmoji(),l=this._messageProperties.decodedNode.getNumberOfEmoticons(),c=this._messageProperties.decodedNode.getNumberOfUnicodeEmoji(),h=!(t||o&&l<=3||a&&c<=3),u=r.hasQuote(this._messageProperties.skypeMessage.content),p=this._messageProperties.skypeMessage.isEdited(),g=this._defaultSupportsShowingReactionsSummary&&!s&&!a;return i.assign({},e,{renderMessageBackground:h,messageContentCentered:t,messageContainerRadiusStyle:e.messageContainerRadiusStyle&&this._getTextMessageRadiusStyle(e.messageContainerRadiusStyle),showReactionsOnMessage:g,overlayReactionsOnMessage:g&&this._enableReactionOverlay,overrideLongPressForLinks:!1,showEditIndicator:p},u?{availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:d.prepareMediaNodeDimensionsFunction(this._messageProperties)}:{},this._messageProperties.decodedNode.hasHtmlContent()?{availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:(e,t)=>e}:{})}getMessageActions(e){const t=this._defaultSupportsAddReactionsInActionMenu&&!this._messageProperties.decodedNode.hasOnlyEmoticonsOrWhitespaceText()&&!this._messageProperties.decodedNode.hasOnlyUnicodeEmoji(),s=!this._messageProperties.skypeMessage.isEmote(),i=this._messageProperties.decodedNode.hasOnlyQuotedContent(),o=this._messageProperties.decodedNode.hasOnlyEmoticonsOrWhitespaceText(),r=this._messageProperties.decodedNode.hasOnlyUnicodeEmoji(),a=this._defaultSupportsAddReactionInMessageView&&this._defaultSupportsShowingReactionsSummary&&!o&&!r,l=this._messageProperties.hasTranslation,d=this._messageProperties.decodedNode.hasHtmlContent(),c=!i&&s&&!this._messageProperties.isReadOnly&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery()&&(!d||this._messagingFeatures.enableQuotingHtmlMessages),h=super.getActionMenuCommands({supportsPostingReactions:t&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery(),supportsForward:this._supportsForward&&(!i||this._messagingFeatures.enableForwardingQuotes)&&(!d||this._messagingFeatures.enableForwardingHtmlMessages)&&s,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsEdit:this.supportsEdit(),supportsQuotes:c,supportsQuotesSelection:c&&!l,supportsSearchSelection:this.supportsSearchSelection(),copyCommand:this._defaultSupportsCopy?f.CommandTypes.Copy:void 0,supportsBookmarks:!0,supportsTranslation:this._messageProperties.hasTranslation&&v.default.isTablet(),supportsTranslateOne:n.default.getS4LCMCFeaturesNoSubscription().enableOneMessageTranslation});return e.actionMenuCommands=h.concat(e.actionMenuCommands),a&&(e.outerButtonCommands=this.getActionsForButtonsToBeRenderedInMessageView(!1,this._defaultSupportsAddReactionInMessageView,!0).concat(e.outerButtonCommands)),e}supportsSearchSelection(){return n.default.getS4LMessagingFeaturesNoSubscription().enableBingSearchMessages&&!this._messageProperties.decodedNode.hasOnlyEmoticonsOrWhitespaceText()&&!this._messageProperties.skypeMessage.isEmote()&&!this._messageProperties.isReadOnly&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery()&&(!this._messageProperties.decodedNode.hasHtmlContent()||this._messagingFeatures.enableQuotingHtmlMessages)}renderOnlyUrlPreview(){return this._renderOnlyUrlPreview}supportsEdit(){const e=this._messageProperties.decodedNode instanceof g.NgcUpgradeSystemMessageNode;return this._defaultSupportsEdit&&(!!this._messageProperties.postedByCurrentUser||!!this._messageProperties.isModerator)&&!this.renderedInStackGallery()&&!this.renderedInCompositeGallery()&&!e&&!this._messageProperties.isReadOnly&&!a.isS4BBridgeMri(this._messageProperties.skypeMessage.conversationId)}getUrlPreviewRenderInformation(e,t){if(i.isEmpty(this._urlPreviewData)||this._messageProperties.skypeMessage.isEmote())return[];const s=[],o=this._defaultSupportsPostingReactions&&this._renderOnlyUrlPreview,n=this._defaultSupportsShowingReactionsSummary&&this._renderOnlyUrlPreview,r=e.sendingStatus===m.MessageRenderSendingStatus.Sending;return i.each(this._urlPreviewData,(a=>{if(a&&a.isValid){const l={renderMessageBackground:!1,showMessageSender:e.showMessageSender&&this._renderOnlyUrlPreview,showMessageSenderIcon:e.showMessageSenderIcon&&this._renderOnlyUrlPreview,showMessageTimestamp:e.showMessageTimestamp&&this._renderOnlyUrlPreview,sendingStatus:!this._renderOnlyUrlPreview&&r?m.MessageRenderSendingStatus.None:e.sendingStatus,obfuscateUrlPreview:!this._messageProperties.postedByCurrentUser&&!this._messageProperties.isConversationAccepted,urlPreviewThumbnailRadiusStyle:this._messageProperties.postedByCurrentUser&&!this.renderedInStackGallery()?_.radius.currentUserUrlPreviewThumbnail:_.radius.otherUserUrlPreviewThumbnail,showOuterButtons:this._outerButtonsFit,skipAccessibilityLabelForMessageView:!0,accessibilityLabelType:c.MessageAccessibilityType.Url,showReactionsOnMessage:n,overlayReactionsOnMessage:n&&this._enableReactionOverlay,availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:d.getUrlPreviewNodeRenderDimensions},h=this._defaultSupportsCopy?f.CommandTypes.CopyLink:void 0,u=this.getActionMenuCommands({copyCommand:h,supportsBookmarks:this._defaultSupportsBookmark}),g=this._renderOnlyUrlPreview?this.getActionMenuCommands({supportsPostingReactions:o&&(this._messageProperties.screenReaderEnabled||!this._outerButtonsFit),supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsEdit:this.supportsEdit(),supportsQuotes:!this.renderedInCompositeGallery()&&!this.renderedInStackGallery()&&!this._messageProperties.isReadOnly,copyCommand:h,supportsBookmarks:this._defaultSupportsBookmark}).concat(t.actionMenuCommands):u,S=i.truncate(a.url,{length:100,omission:p.getString("Global.TruncationText")}),y={outerButtonCommands:this._outerButtonsFit?this.getActionsForButtonsToBeRenderedInMessageView(this._supportsForward&&this._renderOnlyUrlPreview,this._defaultSupportsAddReactionInMessageView&&this._renderOnlyUrlPreview,!0).concat(t.outerButtonCommands):[],actionMenuCommands:g,actionMenuTitle:S},v={viewRenderOptions:i.assign({},e,l),urlPreviewActions:y,urlPreviewData:a};s.push(v)}})),s}}b.messageTypeGroup=r.MessageTypeGroups.Text,t.TextMessageRenderingOptions=b;class T extends l.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){return i.assign({},e,{renderMessageBackground:!1,messageContentCentered:!0,showReactionsOnMessage:!1,showMessageSender:!1,showMessageSenderIcon:!1,showMessageTimestamp:!1})}getMessageActions(e){}}T.messageTypeGroup=r.MessageTypeGroups.System,t.SystemMessageRenderingOptions=T;class M extends l.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t=r.getSmsDeliveryReport(this._messageProperties.skypeMessage.properties);if(this._messageProperties.decodedNode.children.length>0){const s=!h.hasOnlyEmoticonsOrWhitespaceText(this._messageProperties.decodedNode.children[0]);return i.assign({},e,{renderMessageBackground:s,smsDeliveryStatus:t})}return e}getMessageActions(e){const t=!this._messageProperties.isReadOnly&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery(),s=r.getSmsDeliveryReport(this._messageProperties.skypeMessage.properties),i=s&&!r.isSmsDeliveredSuccessfully(s),o=super.getActionMenuCommands({supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,copyCommand:this._defaultSupportsCopy?f.CommandTypes.Copy:void 0,supportsQuotes:t,supportsQuotesSelection:t,supportsRemove:i,supportsBookmarks:this._defaultSupportsBookmark});return e.actionMenuCommands=o.concat(e.actionMenuCommands),e}}M.messageTypeGroup=r.MessageTypeGroups.SMS,t.SMSMessageRenderingOptions=M;class I extends l.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){return i.assign({},e,{renderMessageBackground:!1,messageContentCentered:!0,showReactionsOnMessage:!1,showMessageSender:!1,showMessageSenderIcon:!1,showMessageTimestamp:!1,messageContentExpandedToAvailableArea:!0,includeAccessibilityPropertiesOnMessageHeader:!1,skipAccessibilityLabelForMessageView:!1})}getMessageActions(e){const t=super.getActionMenuCommands({supportsForward:!1,supportsSelectMessages:!1,copyCommand:void 0,supportsQuotes:!1,supportsQuotesSelection:!1,supportsRemove:!1,supportsBookmarks:!1});return e.actionMenuCommands=t.concat(e.actionMenuCommands),e}}I.messageTypeGroup=r.MessageTypeGroups.CallerID,t.CallerIDRenderingOptions=I;class w extends b{getMessageSpecificViewRenderingOptions(e){return i.assign({},e,{renderMessageBackground:!0})}getMessageActions(e){return{actionMenuCommands:[f.CommandTypes.ShowReported],outerButtonCommands:[]}}}t.getReportedMessageRenderingOptions=function(e){const t=new w(e);return i.assign({},t.getRenderingOptions(),{renderOnlyUrlPreview:void 0,urlPreviewRenderInformation:[]})};class P extends l.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){return e}getMessageActions(e){return e}}P.messageTypeGroup=r.MessageTypeGroups.Engagement,t.EngagementMessageRenderingOptions=P},372210:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isUserInputEmptyOrHasWhitespaceOnly=void 0;const i=s(497174);t.isUserInputEmptyOrHasWhitespaceOnly=function(e){return e.every((e=>e instanceof i.UnhandledEntity&&!e.text().trim()))}},53332:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(889391),o=s(552115),n=s(478262);t.default=class{static reencodeOptions(){const e=i.default.getS4LCMCFeatures().videoReencodeConfig;return{profile:e.profile,maxFileSize:o.default.getMaximumFileSizeForType(n.UploadFileType.File),highQualitySource:e.highQualitySource,customWidth:e.outputWidth,customHeight:e.outputHeight,customVideoBitrate:e.videoBitrate,customAudioBitrate:e.audioBitrate,minSizeDecreaseRatio:e.minSizeDecreaseRatio}}static shouldReencodeUpload(e,t){return e===n.UploadFileType.VideoMessage&&t}}},102102:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.maybeAddMyBotToRecents=void 0;const i=s(491632),o=s(746096),n=s(400984),r=s(302024),a=s(671830),l=s(63413),d=s(539549);t.maybeAddMyBotToRecents=function(e,t){if(i.Instrumentation.log(o.LogTraceArea.ConversationsListItem,"[ConversationsListHelper] [_maybeAddMyBotToRecents]",`convs.length=${e.length}, enabled=${t}`),!t)return;const s=(0,a.getMyBotId)(),c=(0,d.default)().getConversation(s);(function(e,t,s){const r=n.default.isContact(e),a=l.default.isMriBlocked(e),d=!!(null==s?void 0:s.isDeleted()),c=!t.some((t=>t.id===e)),h=null==s?void 0:s.isArchived();if(i.Instrumentation.log(o.LogTraceArea.ConversationsListItem,"[ConversationsListHelper] [_shouldAddMyBotToRecents]",`convs.length=${t.length}, isBotNotInList=${c},`,`isBotContact=${r}, isBotBlocked=${a}, isBotDeleted=${d},isBotArchived=${h},isfav=${null==s?void 0:s.isFavorite()}`),(0===t.length||c)&&r&&!a&&!d&&!h)return!0;return!1})(s,e,c)&&(c?e.push(c):e.push(r.SkypeConversationLocal.newFakeEmptyConversation(s,void 0)),i.Instrumentation.log(o.LogTraceArea.ConversationsListItem,"[ConversationsListHelper] [_maybeAddMyBotToRecents] adding my bot conversation to recents list"))}},472918:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(889391),n=s(720603),r=s(265976),a=s(562141),l=s(746096),d=s(54799),c=s(994214);class h extends d.ImageCookieSetterService{constructor(){super("AmsImageCookieService",a.InternalKeys.AMSCookieSkypeToken,l.LogTraceArea.AsyncMediaClient,o.default.getAsyncMediaFeatures().ams_base_url,r.AmsCookieName)}setCookieFlag(e){c.default.setAMSCookieSet(e)}sendAuthCookieRequest(e){return n.default.setAuthCookie(e).then(i.noop)}}t.default=new h},266737:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AppActivity=void 0;const i=s(496486),o=s(516778),n=s(300060),r=s(562141),a=s(998754),l=s(680457),d=s(640363);class c{constructor(e){this._maxValues=e,this._history=[]}getHistory(){return this._history}setHistory(e){this._history=i.takeRight(e,this._maxValues)}addActivity(e,t=Date.now()){this._history.push({timestamp:t,activity:e}),this.setHistory(this._history)}getDuration(e,t,s,o){let n=0,r=0;return s<=e?0:(i.each(this._history,(a=>{if(!n&&a.timestamp<s&&i.includes(t,a.activity))n=a.timestamp;else if(n&&i.includes(o,a.activity)){if(a.timestamp>=e){const t=a.timestamp<=s?a.timestamp:s;r+=e>n?t-e:t-n}n=0}})),n&&n<s&&(r+=s-(e>n?e:n)),r)}hasActivity(e,t,s){return i.some(this._history,(o=>o.timestamp>=e&&o.timestamp<=t&&i.includes(s,o.activity)))}}var h;!function(e){e[e.Start=1]="Start",e[e.Exit=2]="Exit",e[e.Foreground=3]="Foreground",e[e.Background=4]="Background"}(h=t.AppActivity||(t.AppActivity={}));t.default=new class{constructor(){this._history=new c(10)}init(e,t,s,i){const o=a.default.getDataExclusive(r.InternalKeys.AppActivity);this._history.setHistory(o?o.slice():[]),this._postingTrigger=l.PostingTrigger.None,e.subscribe((()=>{this._appStateSub||this._subscribeAppState()})),t.subscribe((()=>{const e=i();e&&!this._appStateSub?this._subscribeAppState():!e&&this._appStateSub&&(this._appStateSub.unsubscribe(),this._appStateSub=void 0,this._history.setHistory([]),this._lastActivity=void 0)})),s.subscribe((()=>{this._postingTrigger=l.PostingTrigger.None}))}getBackgroundTime(e,t=Date.now()){return this._history.getDuration(e,[h.Background],t,[h.Foreground,h.Exit])}hasAppStart(e,t=Date.now()){const s=d.default.getAppInitTime();return s>=e&&s<=t}getPostingTrigger(){return this._postingTrigger}setPostingTrigger(e){this._postingTrigger=e}test_setData(e){this._history.setHistory(e)}_subscribeAppState(){this._addActivity(this._fromActivationState(o.App.getActivationState())),this._appStateSub=n.default.subscribeForChanges("AppActivityHistoryService",(e=>{this._addActivity(this._fromActivationState(e)),e===o.Types.AppActivationState.Active&&(this._postingTrigger=l.PostingTrigger.None)}))}_fromActivationState(e){return e===o.Types.AppActivationState.Background?h.Background:h.Foreground}_addActivity(e){e!==this._lastActivity&&(this._lastActivity=e,this._history.addActivity(e),a.default.putData(r.InternalKeys.AppActivity,this._history.getHistory()))}}},153338:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(174958),o=s(496486),n=s(516778),r=s(397691),a=s(891114),l=s(886045),d=s(889391),c=s(952262),h=s(436237),u=s(733754),p=s(10909),g=s(422538),m=s(746096),S=s(422801),f=s(476621),y=s(331751),v=s(539549);t.default=new class{constructor(){g.RegisterStartupable(this,"ArchiveConversationService",[f.default,c.default,v.default,y.default])}startup(){return r.Resolved()}_setConversationArchived(e,t){if(e.isOneOnOne()&&d.default.getS4LMessagingFeatures().enableGroupedConversations&&!e.isMyBotThread()){const s=o.map(y.default.getAllSiblingConversations(e.id),(e=>S.default.setConversationArchived(e.id,t)));return r.all(s).then(o.noop)}return S.default.setConversationArchived(e.id,t)}_announceForAccessibility(e,t){if(l.default.shouldAnnounceForAccessibility()){const s=c.default.getDisplayName(e)||"",i=u.getString("AccessibilityLabel.ConversationHiddenAnnouncement",{conversationName:s}),o=u.getString("AccessibilityLabel.ConversationUnhiddenAnnouncement",{conversationName:s}),r=t?i:o;n.Accessibility.announceForAccessibility(r)}}_showUndoArchiveToast(e,t){const s={duration:5e3,textMessage:u.getString("HideConversation.ToastMessage"),actionLabel:u.getString("HideConversation.ToastUndoLabel"),key:"undo_archive_conversation",onPress:this.unarchiveConversation.bind(this,e,m.UnarchiveConversationOrigin.UndoPill),rootViewId:t};p.default.scheduleMessage(s)}_trackConversationArchived(e,t){h.track(new a.ConversationArchived(e.id,t,e.isOneOnOne()))}_trackConversationUnarchived(e,t){h.track(new a.ConversationUnarchived(e.id,t,e.isOneOnOne()))}archiveConversation(e,t,s){h.log(m.LogTraceArea.ArchiveConversation,"Attempting to archive "+i.pii.Mri(e)+" origin: "+m.ArchiveConversationOrigin[t]);const o=(0,v.default)().getConversation(e);o&&this._setConversationArchived(o,!0).then((()=>{this._announceForAccessibility(e,!0),this._showUndoArchiveToast(e,s),this._trackConversationArchived(o,t)}))}unarchiveConversation(e,t){h.log(m.LogTraceArea.ArchiveConversation,"Attempting to unarchive "+i.pii.Mri(e)+" origin: "+m.UnarchiveConversationOrigin[t]);const s=(0,v.default)().getConversation(e);s&&this._setConversationArchived(s,!1).then((()=>{this._announceForAccessibility(e,!1),this._trackConversationUnarchived(s,t)}))}}},246549:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.maxConcurrentDownloads=void 0;const i=s(174958),o=s(496486),n=s(974634),r=s(397691),a=s(606452),l=s(746096),d=s(436237),c=s(916724),h=s(422538),u=s(782176),p=s(853374);t.maxConcurrentDownloads=2;t.default=new class{constructor(){this.downloadCancelled=new n.default,this._pendingItems=[],this._downloadingItems=[],h.RegisterStartupable(this,"AutoDownloadService",[a.default])}startup(){return a.default.downloadUpdated.subscribe((e=>{this._handleFileDownloadUpdate(e)})),r.Resolved()}isQueued(e){const t=[...this._pendingItems,...this._downloadingItems];return!o.isEmpty(o.find(t,(t=>t.key===e)))}cancelDownload(e){const t=o.find(this._downloadingItems,(t=>t.key===e));t&&this._cancelDownloadForKey(t.key)}cancelDownloadsByTag(e){o.each(o.cloneDeep(this._downloadingItems),(t=>{t.tag===e&&this._cancelDownloadForKey(t.key)})),o.each(o.cloneDeep(this._pendingItems),(t=>{t.tag===e&&o.remove(this._pendingItems,(t=>t.tag===e))}))}downloadItem(e){this.isQueued(e.key)||(this._pendingItems.push(e),this._downloadNext())}hasDownloadsOnQueue(e){return o.some([...this._downloadingItems,...this._pendingItems],["tag",e])}_removeItemFromDownloads(e){o.remove(this._downloadingItems,(t=>t.key===e))}_cancelDownloadForKey(e){this._isDownloading(e)&&(a.default.cancelDownloadForKey(e,this._genCauseId()),this.downloadCancelled.fire(e),this._removeItemFromDownloads(e))}_isDownloading(e){return a.default.isDownloading(e)}_genCauseId(){return p.default.newCauseId()}_downloadItem(e){this._downloadingItems.push(e),a.default.downloadAmsContentToPublicFolder(e.key,e.filename,e.url,this._genCauseId(),void 0,e.encryptionData)}_downloadNext(){if(this._downloadingItems.length>=t.maxConcurrentDownloads)return;const e=this._pendingItems.shift();e&&this._downloadItem(e)}_handleFileDownloadUpdate(e){if(e.isFinished){const t=o.find(this._downloadingItems,(t=>t.key===e.key));t&&(this._removeItemFromDownloads(t.key),this._downloadNext(),e.downloadTransfer&&e.downloadTransfer.success?this._sendTelemetryEvent(!0,l.MessagingFailureReason.None,e):this._sendTelemetryEvent(!1,l.MessagingFailureReason.AMSFailure,e))}}_sendTelemetryEvent(e,t,s){const o=i.pii.Omit(s.targetUri||""),n=new c.FileReceived(o,void 0,u.default.extractExtensionForTelemetry(s.filename));n.setDownloadDuration(Date.now()-s.startTime),n.setIntent(l.MediaDownloadIntent.AutoDownload),n.setSuccess(e,t,s.finishedAttemptsSoFar,s.responseStatusCode),d.track(n)}}},833598:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.subscriberType=void 0;const i=s(496486),o=s(362520),n=s(397691),r=s(889391),a=s(544135),l=s(994224),d=s(746096),c=s(462937),h=s(753559),u=s(469382),p=s(436237),g=s(17791),m=s(422538),S=s(626712);t.subscriberType="backgroundEffects_downloader";t.default=new class{constructor(){this._queue={},this._items={},this._backgroundEffecs=[],this._downloadItemsFromEcs=()=>{const{backgroundEffects:e}=r.default.getS4LCMCFeatures();(this._isBackgroundReplacementCapable()||e)&&(this._backgroundEffecs=e.filter((e=>!!e.url&&"gif"!==h.default.extractFileExtension(e.url,!0))),this._backgroundEffecs.forEach((e=>this._maybeDownloadItem(e))))},this._maybeDownloadItem=e=>{if(!g.default.isNetworkConnected())return;const{category:t,filename:s,url:o}=this._getFileNameAndCategory(e.url),n=i.filter(this._items,(e=>e.originalUrl===o));if(i.isEmpty(n)||"remove"!==e.action||i.each(n,(e=>{const t={fileUri:e.localUri,fileSizeInBytes:e.sizeInBytes,lastUpdatedTime:e.lastUpdatedTimestamp};return u.fileExists(t).then((t=>{if(t)c.default.removeTrackedFile(c.default.getBackgroundEffectPrefix(e.localUri));else{const t=c.default.getBackgroundEffectPrefix(e.localUri);l.default.DeviceStore.getBackgroundEffectType()===t&&l.default.DeviceStore.setBackgroundEffectType(d.BackgroundEffect.Off)}})),c.default.removeTrackedFile(c.default.getBackgroundEffectPrefix(e.localUri))})),"remove"===e.action&&e.filename){const t=this.getPredefinedImagesTempFolderPath(e.filename);t&&c.default.removeTrackedFile(c.default.getBackgroundEffectPrefix(t));const i=this.getPredefinedImagesTempFolderPath(s);i&&c.default.removeTrackedFile(c.default.getBackgroundEffectPrefix(i))}if(i.isEmpty(n)&&"add"===e.action){const i=this.getPredefinedImagesTempFolderPath(s);if(!i)return;const n={fileUri:i};u.fileExists(n).then((n=>{if(n){const n=c.default.getBackgroundEffectPrefix(i);c.default.addFileInformationForTracking(n,i,s,{originalUrl:o,category:t,order:e.order})}else this._queueItem(e)}))}},this._queueItem=e=>{const{filename:t,url:s}=this._getFileNameAndCategory(e.url),i=this._getTransferObject(t,s),o=a.default.startTransfer(i);this._queue[o]=Object.assign({},e)},this._getTransferObject=(e,s)=>({subscriberType:t.subscriberType,context:void 0,action:"GET",downloadToUri:!0,url:s,filename:this.getPredefinedImagesTempFolderPath(e),downloadToPublicFolder:!0,headers:{responseType:"blob"}}),m.RegisterStartupable(this,"BackgroundEffectsProviderService",[a.default,c.default,g.default])}startup(){return this._items=c.default.getAllBackgroundEffectsFiles(),this._downloadItemsFromEcs(),g.default.subscribe((()=>{g.default.isNetworkingAvailable()&&this._downloadItemsFromEcs()})),a.default.subscribe(t.subscriberType,((e,t,s,i)=>{if(this._isBackgroundReplacementCapable()&&this._queue[e])if(s&&i.body){const{uri:t}=i.body,s=c.default.getBackgroundEffectPrefix(t);if(this._items[s])return;const{action:o,order:n,url:r}=this._queue[e],{category:a,filename:l,url:h}=this._getFileNameAndCategory(r),u={originalUrl:h,category:a,order:n};c.default.addFileInformationForTracking(s,t,l,u),p.log(d.LogTraceArea.Calling," - BackgroundTransferService: download success for background effect filename: "+l+"url: "+h+" action: "+o)}else s||p.error(d.LogTraceArea.Calling," - BackgroundTransferService: download failed for background effect filename: "+this._queue[e].filename+"url: "+this._queue[e].url+" action: "+this._queue[e].action)})),c.default.subscribe((()=>{this._items=c.default.getAllBackgroundEffectsFiles()})),r.default.subscribe(this._downloadItemsFromEcs),n.Resolved()}_isBackgroundReplacementCapable(){return r.default.getS4LCMCFeatures().enableBackgroundReplacement}getPredefinedImagesTempFolderPath(e){const t=this.getPredefinedDownloadPath();return t?o.join(t,e):void 0}getPredefinedDownloadPath(){return"undefined"!=typeof window&&void 0!==window.electronApi?window.electronApi.ipcProvider.downloadManager.getPredefinedImagesTempFolderPath.send():i.isUndefined(null===window||void 0===window?void 0:window.indexedDB)?void 0:"/tmp"}_getFullUrl(e){return S.default.isHttp(e)?e:r.default.getS4LCMCFeaturesNoSubscription().backgroundEffectsUri+e}_getFileNameAndCategory(e){const[t,s]=e.split("/").slice(-2);return{category:t,filename:s,url:this._getFullUrl(e)}}}},329675:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BING_CATEGORY_NAME=t.subscriberType=void 0;const i=s(662783),o=s(496486),n=s(397691),r=s(398861),a=s(889391),l=s(833598),d=s(544135),c=s(994224),h=s(109520),u=s(440276),p=s(746096),g=s(462937),m=s(469382),S=s(436237),f=s(733754),y=s(18078),v=s(17791),C=s(422538),_=s(404057),b=s(912770);t.subscriberType="bingBackgroundEffects_downloader",t.BING_CATEGORY_NAME="bing";class T{constructor(){this._queue={},this._allItems={},this._items=[],this._imageInfos={},this._itemsRemoved=[],this._apiCallErrorCount=0,this._maybeDownloadItem=e=>{if(!v.default.isNetworkConnected())return;const s=t.BING_CATEGORY_NAME,i=this._getFileName(e),n=this._getImageUrl(e),r=o.filter(this._items,(e=>e.originalUrl===n));if(o.isEmpty(r)){const t=l.default.getPredefinedImagesTempFolderPath(i);if(!t)return;const o={fileUri:t};m.fileExists(o).then((o=>{if(o){const o=g.default.getBackgroundEffectPrefix(t);g.default.addFileInformationForTracking(o,t,i,{originalUrl:n,category:s,order:parseInt(e.isoDate,10),isoDate:e.isoDate})}else this._queueItem(e)}))}},this._queueItem=e=>{const s=this._getFileName(e),i=this._getImageUrl(e),o=d.default.startTransfer({subscriberType:t.subscriberType,context:void 0,action:"GET",downloadToPublicFolder:!0,downloadToUri:!0,url:i,filename:l.default.getPredefinedImagesTempFolderPath(s)});this._queue[o]=Object.assign({},e)},this._bingHost=a.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.host,this._httpClient=new i.GenericRestClient(this._bingHost),C.RegisterStartupable(this,"BingBackgroundEffectsProviderService",[d.default,g.default,v.default])}refreshInitiatedEvent(){return this._refreshInitiatedEvent||(this._refreshInitiatedEvent=new r.SubscribableEvent),this._refreshInitiatedEvent}startup(){return a.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.enableImageDownload&&this._isBackgroundReplacementCapable()?(this._connectivityStoreSubscription=v.default.subscribe((()=>{v.default.isNetworkingAvailable()&&this._refresh()})),d.default.subscribe(t.subscriberType,((e,s,i,o)=>{if(this._isBackgroundReplacementCapable()&&this._queue[e]){const s=this._queue[e],n=t.BING_CATEGORY_NAME,r=this._getFileName(s),a=this._getImageUrl(s);if(i&&o.body){const{uri:e}=o.body,t=g.default.getBackgroundEffectPrefix(e);if(this._allItems[t])return;g.default.addFileInformationForTracking(t,e,r,{originalUrl:a,category:n,order:parseInt(s.isoDate,10),isoDate:s.isoDate}),S.log(p.LogTraceArea.Calling,` - BingBackgroundTransferService: download success for Bing background effect filename: ${r}, url: ${a}, date: ${s.isoDate}`)}i||S.error(p.LogTraceArea.Calling,` - BingBackgroundTransferService: download failed for background effect filename: ${r}, url: ${a}, date: ${s.isoDate}`)}})),this._fileTrackerSubscription=g.default.subscribe((()=>{S.log(p.LogTraceArea.Calling," - BingBackgroundTransferService: FileTrackerStore callback"),this._getBingBackgroundEffects(),this._changeActiveBackgroundIfNeeeded(),this._startupDone||(this._refresh(),this._startupDone=!0)})),f.localeChangedEvent.subscribe((()=>{this._refresh()})),n.Resolved()):n.Resolved()}test_reset(){this._connectivityStoreSubscription&&(v.default.unsubscribe(this._connectivityStoreSubscription),this._connectivityStoreSubscription=void 0),this._fileTrackerSubscription&&(g.default.unsubscribe(this._fileTrackerSubscription),this._fileTrackerSubscription=void 0),this._rescheduleTimer&&(b.default.clearTimeout(this._rescheduleTimer),this._rescheduleTimer=void 0),this._itemsRemoved=[],this._imageInfos={},this._apiCallErrorCount=0}_refresh(){this._apiCallErrorCount=0,this._getPicturesFromBing()}_getBingBackgroundEffects(){this._allItems=g.default.getAllBackgroundEffectsFiles(),this._items=o.filter(this._allItems,(e=>e.category===t.BING_CATEGORY_NAME)),S.log(p.LogTraceArea.Calling,` - BingBackgroundTransferService: Available ${this._allItems.length} Bing images`)}_getFileName(e){return`Bing - ${e.caption.replace(/[^a-zA-Z ]/g,"")}.jpg`}_getImageUrl(e){return this._bingHost+e.imageUrls.landscape.highDef}static _getMarket(){var e;let t=f.getLocale();if(f.isEnglishLanguage()){const s=f.getLanguageFromLocale(),i=null===(e=a.default.getHeaders().CountryCode)||void 0===e?void 0:e.toLowerCase();if(!i)return;t=`${s}-${i}`}return t}_getPicturesFromBing(){this._rescheduleTimer&&b.default.clearTimeout(this._rescheduleTimer);if(!v.default.isNetworkConnected())return;const e=T._getMarket();if(!e)return void S.warn(p.LogTraceArea.Calling,"BingBackgroundEffectsProviderService._getPicturesFromBing market is undefined, ignoring the request to fetch background");const t=a.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds,s=t.path.replace("[LOCALE]",e);this._httpClient.performApiGet(s).then((s=>{if(!s||!s.statusCode||200!==s.statusCode)return void this._handleApiDownloadError(new Error((null==s?void 0:s.statusMessage)||""),(null==s?void 0:s.statusCode)||0,0,e);let i;S.track(new h.BingBackgroundsDownloadApiEvent(e,this._apiCallErrorCount,s.statusCode,s.data.images.length,void 0)),this._apiCallErrorCount=0;let n=[];if(s.data.images.length>0){let e=0;if(a.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.pickImageBasedOnUserIdHash){const t=y.default.getSkypeId(),i=u.hashCode(t);e=Math.abs(i)%s.data.images.length}i=s.data.images[e]}if(this._resetImages(),i){this._addImage(i,e),S.log(p.LogTraceArea.Calling," - BingBackgroundTransferService: Will download image.");const t=this._getImageUrl(i);n=[...o.filter(this._items,(e=>e.originalUrl===t)),...n]}const r=o.differenceWith(this._items,n,o.isEqual);S.log(p.LogTraceArea.Calling,` - BingBackgroundTransferService: Will remove ${r.length} images.`);for(const e of r)S.log(p.LogTraceArea.Calling,` - BingBackgroundTransferService: Removing image: ${e.localFileName}`),this._itemsRemoved.push(e.id),g.default.removeTrackedFile(g.default.getBackgroundEffectPrefix(e.localUri),!0);i&&this._maybeDownloadItem(i),this.refreshInitiatedEvent().fire(o.values(this._imageInfos),n,r),this._rescheduleTimer=b.default.setTimeout((()=>{this._getPicturesFromBing()}),t.syncIntervalMs)})).catch((t=>this._handleApiDownloadError(t,void 0,void 0,e)))}_handleApiDownloadError(e,t,s,i){this._apiCallErrorCount+=1;const o=_.default.asString(e),n=this._apiCallErrorCount*this._apiCallErrorCount*1e3;S.error(p.LogTraceArea.Calling,` - BingBackgroundTransferService: bing images query failed. Error count: ${this._apiCallErrorCount}. Error: ${o}`),S.track(new h.BingBackgroundsDownloadApiEvent(i,this._apiCallErrorCount,t,s,o));const r=a.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds;this._apiCallErrorCount<r.maxImageDownloadRetries&&(this._rescheduleTimer=b.default.setTimeout((()=>{this._getPicturesFromBing()}),n))}_changeActiveBackgroundIfNeeeded(){if(0===this._items.length)return;const e=c.default.DeviceStore.getBackgroundEffectType(),t=this._itemRemoved(e);S.log(p.LogTraceArea.Calling,` - BingBackgroundTransferService: current background: ${e}, itemRemoved: ${t}`),e&&t&&this._setNewBackgroundEffect()}_setNewBackgroundEffect(){const e=this.getNextIsoDate();if(S.log(p.LogTraceArea.Calling,` - BingBackgroundTransferService: next isoDate: ${e}`),e){const t=this.getImageIdFromIsoDate(e);t&&(S.log(p.LogTraceArea.Calling,` - BingBackgroundTransferService: setting new bg effect: ${t}`),c.default.DeviceStore.setBackgroundEffectType(t))}else S.log(p.LogTraceArea.Calling," - BingBackgroundTransferService: setting bg effect Blur"),c.default.DeviceStore.setBackgroundEffectType(p.BackgroundEffect.Blur)}getNextIsoDate(e){const t=o.sortBy(o.keys(this._imageInfos),(e=>e));if(e){const s=o.indexOf(t,e);let i=s;return i=s+1===t.length?0:s+1,o.nth(t,i)}return o.last(t)}getPreviousIsoDate(e){const t=o.sortBy(o.keys(this._imageInfos),(e=>e));if(e){const s=o.indexOf(t,e);let i=s;return i=0===s?t.length-1:s-1,o.nth(t,i)}return o.first(t)}_isBackgroundReplacementCapable(){return a.default.getS4LCMCFeaturesNoSubscription().enableBackgroundReplacement}_getImageMetadataFromId(e){if(!e)return;const t=o.filter(this._items,(t=>t.id===e))[0];return(null==t?void 0:t.originalUrl)?t:void 0}_itemRemoved(e){return!!o.includes(this._itemsRemoved,e)}getImageIsoDateFromId(e){const t=this._getImageMetadataFromId(e);if(t)return t.isoDate}getImageIdFromIsoDate(e){const t=o.filter(this._items,(t=>t.isoDate===e))[0];if(t)return t.id}_resetImages(){this._imageInfos={},this._itemsRemoved=[]}_addImage(e,t){const s=e;s.market=t,this._imageInfos[e.isoDate]=s}getImageFromId(e){const t=this.getImageIsoDateFromId(e);if(t)return this._imageInfos[t]}getBingBackgroundImageInfoFromId(e,t,s){const i=this.getImageFromId(e);if(i)return{callId:t,userId:s,caption:i.caption,copyright:i.copyright,isoDate:i.isoDate,market:i.market,link:i.clickUrl}}}t.default=new T},157924:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(809206),o=s(496486),n=s(889391),r=s(671830),a=s(584876),l=s(733754),d=s(788952),c=s(46929),h=s(18078),u=s(711828);class p extends a.HintsProvider{constructor(){super(...arguments),this._timeBeforeShowHintAgain=n.default.getS4LMessagingFeatures().bingSearchMessageHint.timeToShowHintInMs}getHint(){if(!i.BrowserEnvironment.isMobile())return c.default.getMessageHintsUserData(d.MessageHintsTypes.HighlightToBingSearch)}getMessageToShowHint(e,t){const s=Date.now(),i=this._getMessageToShowHint(e);if(!(i&&(null==t?void 0:t.hintLastShownTime)&&s-t.hintLastShownTime<this._timeBeforeShowHintAgain))return i||void 0}_getMessageToShowHint(e){const t=e.getItemList().filter((e=>e instanceof d.MessageViewItemInfo&&!h.default.isMyMri(e.skypeMessage.creator)&&"Event/Call"!==e.skypeMessage.messagetype&&!(0,r.isBotChat)(e.skypeMessage.conversationId)));return(0,o.last)(t)}updateHint(e,t,s){const i=n.default.getS4LMessagingFeatures().bingSearchMessageHint.maxShownTimes,o=d.MessageHintsTypes.HighlightToBingSearch,r=this._updateHintDataForMessage(e,null==s?void 0:s.skypeMessage.cuid,t,i);return c.default.setMessagesHintData(o,r),r}_updateHintDataForMessage(e,t,s,i){if(s.wasFeatureUsedByUser)return s;const o=Date.now(),n=Object.assign({},s);if(n.hintWasShownTimes>=i)return n.wasFeatureUsedByUser=!0,n;return(!n.hintLastShownTime||o-n.hintLastShownTime>this._timeBeforeShowHintAgain)&&(n.hintMessageId=t,n.hintConversationId=e,n.hintLastShownTime=o,n.hintWasShownTimes++),n}getMessageHintDataToDisplay(){return{icon:u.SkypeIcon.Highlight,hintMessage:l.getString("MessageStream.HighlightAndRightClick")}}}t.default=new p},929815:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(889391),r=s(476621),a=s(871908),l=s(351077),d=s(581697),c=s(671830),h=s(562141),u=s(539549),p=s(882261),g=s(952262),m=s(746096),S=s(436237),f=s(18078),y=s(785207),v=s(914976),C=s(422538),_=s(172758),b=s(853374);t.default=new class{constructor(){this._appConfigChanged=()=>{this._messagesProcessedToken?(this._messagesProcessedToken.unsubscribe(),this._messagesProcessedToken=void 0):(this._messagesProcessedToken=r.default.messagesProcessed.subscribe(this._chatServiceDataServiceMessagesProcessed),d.default.prioritizeConversation(c.BookmarksThreadId,!0,!1))},this._chatServiceDataServiceMessagesProcessed=e=>o.all(i.map(i.filter(e,(e=>e.isBookmark()||e.isBookmarkSourceDeletedMessageForCurrentUser())),(e=>e.isBookmark()?this._processBookmarkMsgUpdate(e):e.isBookmarkSourceDeletedMessageForCurrentUser()?this._processBookmarkSourceMsgDeletion(e):void 0))),C.RegisterStartupable(this,"BookmarksService",[r.default,u.default,g.default,_.default])}startup(){return n.default.subscribe(this._appConfigChanged),this._appConfigChanged(),o.Resolved()}bookmarkMessage(e,t){const s=e.getLatestServerMessage();if(!s)return S.error(m.LogTraceArea.Bookmarks,"Cannot bookmark message without having server message"),o.Resolved();const n={};t&&(n[l.MessageProperties.AlbumId]=t);const r=i.cloneDeep(s),d=b.default.newClientMessageId();return a.markMessageBookmarked(e,{cuid:d}).then((()=>{S.log(m.LogTraceArea.Bookmarks,"Bookmarking new message."),this._traceBookmarkSourceMessage(e);const s={bookmarkSourceClientMessageId:e.cuid,bookmarkSourceServerMessageId:e.getLatestServerMessageId(),bookmarkSourceComposeTime:e.createdTime,bookmarkSourceConversationId:e.conversationId,bookmarkSourceCreatorId:e.creator},i=(0,u.default)().getConversation(e.conversationId);let o;i&&(i.isThread()||f.default.isMyMri(e.creator))&&(s.bookmarkSourceConversationName=g.default.getDisplayName(_.default.getConversationOwner(e.conversationId))),n[l.MessageProperties.Starred]=JSON.stringify(s),o=t&&e.isAlbum()?p.createMediaAlbumMessage(c.BookmarksThreadId,m.PostSource.Bookmarks,t,n,d):p.createMessageFromServerMessage(c.BookmarksThreadId,m.PostSource.Bookmarks,r,n,d),y.default.postMessage(o)}))}deleteBookmark(e){let t,s;return o.Resolved().then((()=>{if(e.isBookmark()){const i=l.getBookmarkMetadata(e.properties);if(t=e.getOriginalServerId(),i){const{bookmarkSourceConversationId:e,bookmarkSourceClientMessageId:t}=i;return h.default.getMessageByCuid(e,t).then((e=>{s=e}))}}else{s=e;const i=e.getBookmarkSourceMetadataForCurrentUser();if(!i)return;i.cuid&&i.id&&(t=i.id)}})).then((()=>o.all([a.deleteBookmark(t),a.deleteBookmarkSource(s)])))}_processBookmarkMsgUpdate(e){const t=l.getBookmarkMetadata(e.properties);if(this._traceBookmarkMessage(e,t),!t)return o.Resolved();const s=t.bookmarkSourceClientMessageId,i=t.bookmarkSourceConversationId;if(!s||!i)return o.Resolved();const n=e.getLatestServerMessageId();return n?h.default.getMessageByCuid(i,s).then((e=>{if(!e)return;const t=e.getBookmarkSourceMetadataForCurrentUser();return t&&t&&!t.id?a.markMessageBookmarked(e,{id:n}):void 0})):o.Resolved()}_processBookmarkSourceMsgDeletion(e){const t=e.getBookmarkSourceMetadataForCurrentUserFromPreviousMessage();return this._traceBookmarkSourceMessage(e),t&&t.id?(S.log(m.LogTraceArea.Bookmarks,"Bookmark source deleted, deleting bookmark."),a.deleteBookmark(t.id)):(S.log(m.LogTraceArea.Bookmarks,"Bookmark source message metadata not found for current user"),o.Resolved())}_traceBookmarkSourceMessage(e){S.log(m.LogTraceArea.Bookmarks,`BookmarkSourceMessage(cuid:${e.cuid} id:${e.getLatestServerMessageId()})`)}_traceBookmarkMessage(e,t){S.log(m.LogTraceArea.Bookmarks,`BookmarkMessage(cuid:${e.cuid} id:${e.getLatestServerMessageId()} sourceConversationId:${v.mriOrId(null==t?void 0:t.bookmarkSourceConversationId)}, sourceMessageCreatorId:${v.mriOrId(null==t?void 0:t.bookmarkSourceCreatorId)})`)}test_reset(){this._messagesProcessedToken=void 0}}},939848:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.subscribeToContentSetEvent=t.triggerContentSetEvent=void 0;const i=s(974634),o=s(366355),n=s(436237),r=new i.default;t.triggerContentSetEvent=(e,t=!1)=>{n.log(o.LogTraceArea.MessageComposer,"ComposerSubscribableEvents.triggerContentSetEvent"),r.fire(e,t)};t.subscribeToContentSetEvent=e=>r.subscribe(e)},926459:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(974634),o=s(671830);t.default=new class{constructor(){this._consumptionHorizons={},this._markConversationUnreadCallbacks={},this.markConversationUnreadCallback=(e,t)=>(this._markConversationUnreadCallbacks[e]=new i.default,this._markConversationUnreadCallbacks[e].subscribe(t)),this.onMarkConversationUnread=e=>{const t=this._markConversationUnreadCallbacks[e];t&&t.fire()}}setPreviousConsumptionHorizon(e,t){this._consumptionHorizons[e]=t}getPreviousConsumptionHorizon(e){if(this._consumptionHorizons[e])return o.updateConsumptionHorizonWithCurrentClientTime(this._consumptionHorizons[e])}}},310066:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.destroyConversationsListStore=t.getConversationsListStore=void 0;const i=s(124615);let o;t.getConversationsListStore=function(){return o||(o=new i.ConversationsListWithFiltersStore),o},t.destroyConversationsListStore=function(){o=void 0}},606452:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(174958),o=s(496486),n=s(168409),r=s(662783),a=s(974634),l=s(397691),d=s(472918),c=s(889391),h=s(717135),u=s(720603),p=s(225638),g=s(544135),m=s(422801),S=s(357569),f=s(440276),y=s(36763),v=s(746096),C=s(907234),_=s(462937),b=s(436237),T=s(368645),M=s(699097),I=s(17791),w=s(422538),P=s(404057),k=s(478262),A=s(912770),x=s(994214),R=s(842987),O=s(626712),L=s(853374),F="downloadService_amsGetStatusDownload",B="downloadService_download",D=[F,B],E={[F]:v.DownloadTransferSource.AMSGetStatus,[B]:v.DownloadTransferSource.AmsDownload},V={priority:r.WebRequestPriority.High,timeout:3e4},N={priority:r.WebRequestPriority.High,progressTimeout:2e4,timeout:0};class U extends S.default{constructor(){super(D,v.LogTraceArea.DownloadService),this._fileDownloads={},this._fileDownloadsCleaningUp={},this.downloadUpdated=new a.default,this.transferFinished=new a.default,w.RegisterStartupable(this,"DownloadService",[d.default,g.default,m.default,C.default,_.default,T.default,M.default,I.default])}startup(){return I.default.subscribe((()=>{I.default.isNetworkingAvailable()&&(this._resetBackoffs("ReportedConnectivityStore"),this._seeIfAnythingNeedsDoing())})),m.default.reconnected.subscribe((()=>{this._resetBackoffs("ChatService.reconnected"),this._seeIfAnythingNeedsDoing()})),x.default.subscribe((()=>{x.default.hasUsableSkypeToken()&&this._seeIfAnythingNeedsDoing()}),x.TriggerKeys.SkypeTokenKey),T.default.subscribe(R.DownloadActionType,((e,t)=>{const s=L.default.newCauseId();b.log(this._logTraceArea,"start fileDownload(s), restoredFromDatabase: "+t+", causeId: "+s),o.each(e,(e=>{if(b.log(this._logTraceArea,"Tracking Download: "+e.id+" , targetUri: "+e.targetUri+", restoredFromDatabase: "+t),e.startTime||(e.startTime=Date.now()),e.isCleaningUp)return e.isCleaningUp=!1,void this._cancelDownload(e,s);if(e.androidDownloadToPublicFolder&&(e.downloadToPublicFolder=e.androidDownloadToPublicFolder),e.contentUrl&&!e.amsViewId){const t=new p.default(e.contentUrl);e.amsViewId=t.getViewId()}e.downloadTempLocalUri||e.downloadToPublicFolder||e.amsObjectId||e.targetUri?(S.default.migrateTransfer(e.amsGetStatusTransfer),S.default.migrateTransfer(e.downloadTransfer),S.default.isTransferLost(e.amsGetStatusTransfer)&&(e.amsGetStatusTransfer=void 0,this._shouldCancelLostTransfer())||S.default.isTransferLost(e.downloadTransfer)&&(e.downloadTransfer=void 0,this._shouldCancelLostTransfer())?this._cancelDownload(e,s):(e.startedMovingDownload&&!e.isCached&&(e.startedMovingDownload=!1),this._isTransferCompletedSuccessfully(e.downloadTransfer)&&!e.downloadTempLocalUri&&e.expiration&&(e.downloadTransfer=void 0),o.isUndefined(e.needsDecryption)||delete e.needsDecryption,this._fileDownloads[e.id]=e,this._checkForNeededWork(e.id),this.downloadUpdated.fire(e))):this._cancelDownload(e,s)}))})),g.default.subscribe(F,((e,t,s,i,n)=>{const r=F,a=this._fileDownloads[t];if(!a)return void(this._fileDownloadsCleaningUp[t]||b.warn(this._logTraceArea,"Got DocumentStatusInfo for missing AmsGetStatus Download: ",t));s&&o.isEmpty(i.body)&&(b.log(this._logTraceArea,"AmsGetStatus missing body, success = false: "+a.id),s=!1);const l=h.ASMClient.getTracingHeaders(n);b.log(this._logTraceArea,"AmsGetStatus completed:",a.id+", success: "+s+", DocumentStatusInfo result: "+JSON.stringify(i.body)+", requestId:"+l.requestId+", correlationId:"+l.correlationId+", transactionId:"+l.transactionId);const d=a.amsGetStatusTransfer;d&&d.id===e?(this._transferFinished(a,d,r,s,i,n),s?a.targetUri=i.body.view_location:u.default.checkAuthFailure(i.statusCode,n),this._downloadUpdated(a),this._checkForNeededWork(t)):b.warn(this._logTraceArea,"Got DocumentStatusInfo with transfer id mismatch: "+t+", expected: "+e+", current: "+(d&&d.id))})),g.default.subscribe(B,((e,t,s,i,n)=>{const r=B,a=this._fileDownloads[t];if(!a)return void b.warn(this._logTraceArea,"Got Download response for missing download: "+t);s&&o.isEmpty(i.body)&&(b.log(this._logTraceArea,"Download missing body, success = false: "+a.id),s=!1);const l=h.ASMClient.getTracingHeaders(n);b.log(this._logTraceArea,"Download completed: "+a.id+", success: "+s+", localUri result: "+JSON.stringify(i.body)+", requestId:"+l.requestId+", correlationId:"+l.correlationId+", transactionId:"+l.transactionId);const d=a.downloadTransfer;if(d&&d.id===e){if(this._transferFinished(a,d,r,s,i,n),s)a.downloadTempLocalUri=i.body.uri;else{const e=u.default.checkAuthFailure(i.statusCode,n);(e||307===i.statusCode)&&a.amsViewId&&(b.log(this._logTraceArea,"Will redo AmsGetStatus: "+a.id+", "+(e?"auth failure (possible redirect)":"redirect")),S.default.redoTransfer(a.amsGetStatusTransfer),a.targetUri=void 0)}this._downloadUpdated(a),this._checkForNeededWork(a.id)}else b.warn(this._logTraceArea,"Got Download response with transfer id mismatch: "+t+", expected: "+e+", current: "+(d&&d.id))})),l.Resolved()}_decryptFile(e){let t;if(e.fileEncryptionData){const s=f.base64StringToByteArray(e.fileEncryptionData.fileKey64),i=f.base64StringToByteArray(e.fileEncryptionData.fileIv64),o=f.base64StringToByteArray(e.fileEncryptionData.fileAuthKey64),r=f.base64StringToByteArray(e.fileEncryptionData.fileHMAC64),a=f.base64StringToByteArray(e.fileEncryptionData.fileHash64),d=L.default.newGuid()+".bin",c=e.downloadTempLocalUri;t=c?n.FileEncryption.getTempLocation(d).then((e=>n.FileEncryption.decryptFile(c,e,n.FileEncryption.getDefaultAlgo(),i,s,o,r,a).then((()=>n.FileEncryption.moveFile(e,c))))):l.Rejected("Can not find original url")}else t=l.Rejected("Incomplete file key material");t.then((()=>{e.needsDecryption=!1,this._downloadUpdated(e),this._checkForNeededWork(e.id)})).catch((t=>{const s=P.default.errorAsString(t);b.track(new y.E2eeDecryptionFailure(s)),b.error(this._logTraceArea,"Failed to decrypt file "+e.id,s),this._removeWithoutSuccess(e,B,!0)}))}downloadAmsContentToPublicFolder(e,t,s,o,n,r,a){O.default.isUrlValid(s)?this._downloadFile(e,void 0,t,!0,void 0,void 0,void 0,s,n,r,a,o):b.error(this._logTraceArea,`${i.pii.Omit(s)} is not a valid url`)}downloadAmsContentToCache(e,t,s,o,n,r,a,l,d,c){O.default.isUrlValid(r)?this._downloadFile(e,void 0,t,!1,s,o,n,r,l,d,c,a):b.error(this._logTraceArea,`${i.pii.Omit(r)} is not a valid url`)}androidDownloadAmsContentToPublicFolder(e,t,s,o,n,r,a){O.default.isUrlValid(s)?M.default.requestCameraRollPermission().then((i=>{this._downloadFile(e,void 0,t,!0,void 0,void 0,void 0,s,n,r,a,o)})):b.error(this._logTraceArea,`${i.pii.Omit(s)} is not a valid url`)}_downloadFile(e,t,s,o,n,r,a,l,d,h,u,g){const m=c.default.getS4LMessagingFeaturesNoSubscription().enableAndroidCustomDownloadFolder,S=Date.now(),f=new p.default(l),y=f.getDocumentId(),v=f.getViewId(),C=L.default.newGuid();if(!t&&!y){const e="DownloadService: Failed to find AMS download location for: "+l;return void b.error(this._logTraceArea,e)}const _={downloadType:u,key:e,filename:s,expiration:n,cacheEvictionKind:r,cacheEvictionRank:a,downloadToPublicFolder:o,downloadPublicFolderUseSkypeFolder:m,maxRetries:d,contentUrl:l,startTime:S,transactionId:C,amsObjectId:y,amsViewId:v,targetUri:t,fileEncryptionData:h};b.log(this._logTraceArea,"New download: key: "+i.pii.Omit(e)+"filename: "+i.pii.Omit(s)+", expiration: "+n+", targetUri: "+t+", amsObjectId: "+y+", amsViewId: "+v+", contentUrl: "+i.pii.Omit(l)+" DownloadToPublicFolder "+_.downloadToPublicFolder+" DownloadPublicFolderUseSkypeFolder "+_.downloadPublicFolderUseSkypeFolder+" transactionId "+_.transactionId+" starttime "+_.startTime+" iscleanup "+_.isCleaningUp+" causeId: "+g),T.default.persistAndStartAction(R.DownloadActionType,_)}androidDownloadAsmContentToPublicFolder(e,t,s,i,o){M.default.requestCameraRollPermission().then((n=>{this._downloadFileFromTargetUri(e,s,t,!0,void 0,void 0,void 0,s,i,o)}))}downloadAsmContentToCache(e,t,s,i,o,n,r,a){this._downloadFileFromTargetUri(e,n,t,!1,s,i,o,n,r,a)}_downloadFileFromTargetUri(e,t,s,o,n,r,a,l,d,h){if(this.isDownloading(e))return void b.error(this._logTraceArea,"Already downloading file for that key: "+i.pii.Omit(e));const u=c.default.getS4LMessagingFeaturesNoSubscription().enableAndroidCustomDownloadFolder,g=Date.now(),m=new p.default(l),S=m.getDocumentId(),f=m.getViewId(),y={downloadType:h,key:e,filename:s,expiration:n,cacheEvictionKind:r,cacheEvictionRank:a,downloadToPublicFolder:o,downloadPublicFolderUseSkypeFolder:u,maxRetries:d,contentUrl:l,startTime:g,transactionId:L.default.newGuid(),amsObjectId:S,amsViewId:f,targetUri:t};b.log(this._logTraceArea,"New download: key: "+i.pii.Omit(e)+"filename: "+i.pii.Omit(s)+", expiration: "+n+", targetUri: "+t+", amsObjectId: "+S+", amsViewId: "+f+", contentUrl: "+i.pii.Omit(l)+" DownloadToPublicFolder "+y.downloadToPublicFolder+" DownloadPublicFolderUseSkypeFolder "+y.downloadPublicFolderUseSkypeFolder+" transactionId "+y.transactionId+" starttime "+y.startTime+" iscleanup "+y.isCleaningUp),T.default.persistAndStartAction(R.DownloadActionType,y)}isDownloading(e){return!!this._getFileDownloadForKey(e)}hasDownloadOfType(e){return o.some(this._fileDownloads,(t=>t.downloadType===e))}_getFileDownloadForKey(e){return o.find(this._fileDownloads,(t=>t.key===e))}getFileDownloadByUrl(e){return o.find(this._fileDownloads,(t=>e===t.targetUri||e===t.contentUrl))}getUrlsForDownloadKey(e){const t=this._getFileDownloadForKey(e);if(!t)return;const s=[t.targetUri,t.contentUrl];return o.compact(s)}debug_allFileDownloads(){return this._fileDownloads}debug_allFileDownloadsCleaningUp(){return this._fileDownloadsCleaningUp}debug_allDownloadFailedRetryInfo(){return this._retryInfo}cancelDownloadForKey(e,t){const s=this._getFileDownloadForKey(e);return s?(b.log(this._logTraceArea,"Canceling key: "+i.pii.Omit(e)+", found file download: "+s.id+", causeId: "+t),this._cancelDownload(s,t),!0):(b.warn(this._logTraceArea,"Attempted to cancel key "+i.pii.Omit(e)+" but no pending file download found! causeID: "+t),!1)}_cancelDownload(e,t){const s=[e.amsGetStatusTransfer,e.downloadTransfer];o.each(s,(e=>{e&&e.id&&!e.finished&&g.default.transferIsTracked(e.id)&&g.default.cancelTransfer(e.id,t)})),this._cleanupDownload(e,!0)}_downloadUpdated(e,t=!1){T.default.updateAction(e),t||this.downloadUpdated.fire(e)}_resetBackoffs(e){b.log(this._logTraceArea,"Resetting backoffs due to: "+e),super._resetBackoffs()}_seeIfAnythingNeedsDoing(){const e=o.keys(this._fileDownloads);o.each(e,(e=>{this._checkForNeededWork(e)}))}_checkForNeededWork(e){const t=this._fileDownloads[e];if(t.expiration&&t.expiration<Date.now())return b.log(this._logTraceArea,"PesEffect Download expired before (re)starting: "+e+" "+t.targetUri),void this._cleanupDownload(t,!0);if(t.amsObjectId&&t.amsViewId&&!t.targetUri){const e=F,s=t.amsGetStatusTransfer;if(!this._isTransferCompletedSuccessfully(s)){if(this._isTransferCompletedWithoutSuccess(t.id,s,e))return void this._removeWithoutSuccess(t,e,S.default.isTransferPermanentFailure(s));if(this._isTransferReadyToStart(t.id,s,e,!0)){t.amsGetStatusId||(t.amsGetStatusId=L.default.newGuid());const i=Object.assign(Object.assign({},V),{transactionId:t.transactionId,correlationId:t.amsGetStatusId});t.amsGetStatusTransfer=this._createTrackedBackgroundTransfer(u.default.getStatusBackground(e,t.id,t.amsObjectId,t.amsViewId,i),s),this._downloadUpdated(t)}return}}{const s=B,i=t.downloadTransfer;if(!this._isTransferCompletedSuccessfully(i)){if(this._isTransferCompletedWithoutSuccess(t.id,i,s))return void this._removeWithoutSuccess(t,s,S.default.isTransferPermanentFailure(i));if(this._isTransferReadyToStart(t.id,i,s,!0)){t.downloadId||(t.downloadId=L.default.newGuid());const o=Object.assign(Object.assign({},N),{transactionId:t.transactionId,correlationId:t.downloadId});b.log(this._logTraceArea,"PesEffect Start download "+e+" "+t.targetUri+" ",t.downloadToPublicFolder),t.downloadTransfer=this._createTrackedBackgroundTransfer(u.default.downloadBackground(s,t.id,t.targetUri,t.filename,t.downloadToPublicFolder,t.downloadPublicFolderUseSkypeFolder,void 0,o),i),this._downloadUpdated(t)}return}}t.needsDecryption||(o.isUndefined(t.needsDecryption)&&(t.needsDecryption=!!t.fileEncryptionData,t.needsDecryption)?this._decryptFile(t):t.expiration&&C.default.isLocalCacheSupported()?C.default.isKnown(t.key)?(b.error(this._logTraceArea,"just got the file, but FileCache already has something for that key?"),t.isCached=!0,this.downloadUpdated.fire(t),this._cleanupDownload(t)):(t.startedMovingDownload=!0,C.default.save(t.key,t.downloadTempLocalUri,t.filename,t.expiration,!1,t.cacheEvictionKind,t.cacheEvictionRank).then((()=>{this._fileDownloads[e]&&(t.isCached=!0,this.downloadUpdated.fire(t),this._cleanupDownload(t))}),(s=>{const i=!!this._fileDownloads[e];b.warn(this._logTraceArea,"Failed to move file into cache: "+e+", downloadStillKnown: "+i+", error: "+P.default.errorAsString(s)),i&&(t.downloadTransfer=void 0,t.downloadTempLocalUri=void 0,t.isCached=!1,t.startedMovingDownload=!1,this._checkForNeededWork(t.id))}))):(this._cleanupDownload(t),t.downloadToPublicFolder&&_.default.addFileInformationForTracking(t.key,t.downloadTempLocalUri,t.filename)))}_removeWithoutSuccess(e,t,s){s?e.permanentFailureTransferType=t:e.maxRetriesExceededTransferType=t,b.log(this._logTraceArea,"Giving up: "+e.id+", transferType: "+t+", isPermanentFailure: "+!!s),this._cleanupDownload(e,!0)}_cleanupDownload(e,t=!1){e.isFinished=!0,delete this._fileDownloads[e.id],this._fileDownloadsCleaningUp[e.id]=e,this._cleanupRetryInfo(e.id);const s=C.default.isKnown(e.key);b.log(this._logTraceArea,"Cleaning up: "+e.id+", removeFromCache: "+t+", wasCleaningUp: "+e.isCleaningUp+", isCachedFileKnown: "+s),t&&s?e.isCleaningUp||(e.isCleaningUp=!0,this._downloadUpdated(e,!0),C.default.remove(e.key).catch((t=>{b.warn(this._logTraceArea,"Failed to remove file from cache (ignored during cleanup): "+e.id+", error: "+P.default.errorAsString(t))})).always((()=>{this._cleanupDownload(e,!1)}))):(delete this._fileDownloadsCleaningUp[e.id],T.default.removeAction(e.id),e.isCleaningUp=!0,this.downloadUpdated.fire(e))}_getMaxRetries(e,t){const s=c.default.getS4LCMCFeatures().retryPolicy;if(t===B){const t=this._fileDownloads[e];return t&&o.isNumber(t.maxRetries)?t.maxRetries:o.isNumber(s.maxRetries[B])?s.maxRetries[B]:s.maxRetriesDefault}return k.NumberShim.MAX_SAFE_INTEGER}_getMaxTransferTime(e,t){const s=c.default.getS4LCMCFeatures().retryPolicy;return o.isNumber(s.maxTransferTime[t])?s.maxTransferTime[t]:s.maxPostElapsedTime}_transferFinished(e,t,s,i,o,n){const r=S.default.isPermanentFailure(o),a=this._handleTransferFinished(e.id,t,s,i,r,0,o);!a.transfer.success&&a.canRetry&&a.retryInfo&&A.default.setExpiration((()=>{this._fileDownloads[e.id]&&this._checkForNeededWork(e.id)}),a.retryInfo.nextAttempt);const l=E[s];return e.responseStatusCode=o.statusCode,e.finishedAttemptsSoFar=t.finishedAttemptsSoFarCount,this.transferFinished.fire(e,l,a,o,n),a}_shouldCancelLostTransfer(){return!1}}t.default=new U},21535:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(397691),o=s(717135),n=s(357569),r=s(606452),a=s(437614),l=s(746096),d=s(436237),c=s(914976),h=s(422538);t.default=new class{constructor(){this._failedTransfers={},h.RegisterStartupable(this,"DownloadTelemetryService",[r.default])}startup(){return r.default.transferFinished.subscribe(((e,t,s,i,o)=>{const r=this._getTransferId(e,t),h=this._getErrorMetadata(t,i,o);if(n.default.isTransferPermanentFailure(s.transfer)){d.warn(l.LogTraceArea.DownloadService,"Permanent failure: "+e.id+", source: "+l.DownloadTransferSource[t]+", status code: "+i.statusCode+", metadata: "+c.dev_unknownOmit(JSON.stringify(h)));const o=new a.PermanentDownloadFailure(t,e.startTime,s.transfer.finishedAttemptsSoFarCount,i.statusCode,i.statusText,h);d.track(o)}else if(s.transfer.success){if(this._failedTransfers[r]){const o=new a.DownloadRecovered(t,e.startTime,s.transfer.finishedAttemptsSoFarCount,i.statusCode,i.statusText,h);d.track(o),delete this._failedTransfers[r]}}else this._failedTransfers[r]={transferInfo:s,response:i}})),i.Resolved()}_getErrorMetadata(e,t,s){switch(e){case l.DownloadTransferSource.AmsDownload:case l.DownloadTransferSource.AMSGetStatus:const e=o.ASMClient.getTracingHeaders(s);return{requestId:e.requestId,correlationId:e.correlationId,transactionId:e.transactionId};default:return}}_getTransferId(e,t){return e.id+"_"+l.DownloadTransferSource[t]}}},928802:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(562141),o=s(857946);t.default=new class{storeSavedMessage(e,t){const s=(0,o.convertSavedMessageInputToDbSkypeDraftsInput)(e,t);return i.default.putDraftMessage(s)}deleteSavedMessage(e){return i.default.deleteDraftMessage(e)}loadSavedMessageInputs(){return i.default.getAllDraftMessages().then((e=>e.map(o.convertDbSkypeDraftsInputToSavedMessageInput)))}}},362843:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_E2eeCipherService=void 0;const i=s(358072),o=s(496486),n=s(901455),r=s(775463),a=s(397691),l=s(440276),d=s(657916),c=s(125793),h=s(298249),u=s(579041),p=s(18078),g=s(422538),m=s(404057),S=r.subtle,f="aes-cbc",y=32,v=32;class C{constructor(){g.RegisterStartupable(this,"E2eeCipherService",[c.default,u.default])}startup(){return this._storage=d.E2eeSessionStorage.getStorage(p.default.getSkypeId()),i.SignalProtocolLib.initialize(n),a.Resolved()}encryptMessageForConv(e,t){const s=e.getEncryptionHandshake();if(!s)return a.Rejected("No secure handshake in conversation");const i=c.default.getBuddyAddress(s);if(i.mri&&i.devId){const e=r.getRandomValues(new Array(16)),s=r.getRandomValues(new Array(y)),o=r.getRandomValues(new Array(v));return this._encryptWithAes(t,s,e).then((t=>this._signWithHMAC(new Uint8Array(o).buffer,new Uint8Array(e).buffer,t).then((n=>this._computeDigest(new Uint8Array(e).buffer,t,n).then((r=>{const a=l.mergeArrays([new Uint8Array(s).buffer,new Uint8Array(o).buffer,r,new Uint8Array(e).buffer,n]);return this._encryptBufferWithSignal(i,a.buffer).then((e=>{const s={[i.devId]:e};return{ciphertext:l.Uint8ArrayToBase64String(new Uint8Array(t)),keys:s}}))}))))))}return a.Rejected("Missing receiver information in handshake")}decryptMessageForConv(e,t,s){const i=e.getEncryptionHandshake();if(!i)return a.Rejected("No secure handshake in conversation");const o=c.default.getBuddyAddress(i),n=c.default.getDeviceId();if(o.mri&&o.devId){if(!(n in s))return a.Rejected("Missing message key");const e=s[n];return this._decryptBufferWithSignal(o,e).then((e=>{const s=new Uint8Array(e);if(144!==s.length)return a.Rejected("Unsupported message key length");const[i,o,n,r,d]=this._splitKeyMaterial(s),c=l.base64StringToUint8Array(t);return this._computeDigest(r,c.buffer,d).then((e=>this._compareArrays(e,n)?this._signWithHMAC(o,r,c.buffer).then((e=>this._compareArrays(e,d)?this._decryptWithAes(c,i,r):a.Rejected("HMAC mismatch"))):a.Rejected("Hash mismatch")))}))}return a.Rejected("Missing receiver information in handshake")}encryptMessage(e,t){return this._encryptBufferWithSignal(e,new Uint8Array(r.textToBytes(t)).buffer)}decryptMessage(e,t){return this._decryptBufferWithSignal(e,t).then((e=>r.bytesToText(o.toArray(new Uint8Array(e)))))}_encryptBufferWithSignal(e,t){const s=new i.SignalProtocolAddress(e.mri,e.devId),o=new i.SessionCipher(this._storage,s);try{return a.fromThenable(o.encrypt(t,"binary")).then((e=>l.btoaUtf8(JSON.stringify(e))))}catch(e){return a.Rejected(e)}}_decryptBufferWithSignal(e,t){const s=new i.SignalProtocolAddress(e.mri,e.devId),n=new i.SessionCipher(this._storage,s),r=l.atobUtf8(t),d=m.default.parseJsonErrorable(r);if(o.isError(d))return a.Rejected(d);try{const e=3===d.type?n.decryptPreKeyWhisperMessage(d.body,"binary"):n.decryptWhisperMessage(d.body,"binary");return a.fromThenable(e)}catch(e){return a.Rejected(e)}}_encryptWithAes(e,t,s){const i={name:f,iv:s,length:t.length};return a.fromThenable(S.importKey("raw",new Uint8Array(t),i,!1,["encrypt"])).then((t=>a.fromThenable(S.encrypt(i,t,new Uint8Array(r.textToBytes(e))))))}_decryptWithAes(e,t,s){const i={name:f,iv:s,length:t.byteLength};return a.fromThenable(S.importKey("raw",t,i,!1,["decrypt"])).then((t=>a.fromThenable(S.decrypt(i,t,e)).then((e=>r.bytesToText(o.toArray(new Uint8Array(e)))))))}_signWithHMAC(e,t,s){return a.fromThenable(S.importKey("raw",e,h.HMAC_ALGO,!1,["sign"])).then((e=>{const i=l.mergeArrays([t,s]);return a.fromThenable(S.sign(h.HMAC_ALGO,e,i))}))}_computeDigest(e,t,s){const i=l.mergeArrays([e,t,s]);return a.fromThenable(S.digest(h.DIGEST_ALGO,i))}_splitKeyMaterial(e){return[new Uint8Array(e.subarray(0,y)).buffer,new Uint8Array(e.subarray(y,64)).buffer,new Uint8Array(e.subarray(64,96)).buffer,new Uint8Array(e.subarray(96,112)).buffer,new Uint8Array(e.subarray(112,144)).buffer]}_compareArrays(e,t){if(e.byteLength!==t.byteLength)return!1;const s=new Uint8Array(e),i=new Uint8Array(t);let o=!0;for(let e=0;e<s.byteLength;++e)o=o&&s[e]===i[e];return o}}t.Test_E2eeCipherService=C;const _=new C;t.default=new class{encryptMessageForConv(e,t){return this._ensureServiceStarted().then((()=>_.encryptMessageForConv(e,t)))}decryptMessageForConv(e,t,s){return this._ensureServiceStarted().then((()=>_.decryptMessageForConv(e,t,s)))}encryptMessage(e,t){return this._ensureServiceStarted().then((()=>_.encryptMessage(e,t)))}decryptMessage(e,t){return this._ensureServiceStarted().then((()=>_.decryptMessage(e,t)))}_ensureServiceStarted(){return g.EnsureStarted(_)}}},858449:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(775463),o=s(397691),n=s(476621),r=s(440276),a=s(362843),l=s(667121),d=s(125793),c=s(746096),h=s(914976),u=s(422538);t.default=new class{constructor(){u.RegisterStartupable(this,"E2eeMediaCipherService",[d.default,n.default])}startup(){return o.Resolved()}generateCallKey(e){return r.byteArrayToBase64String(i.getRandomValues(new Array(48)))}encryptCallKeyForThread(e,t){return this._getReceiverAddress(e).then((s=>a.default.encryptMessage(s,t).catch((t=>(l.default.sendReject(e,c.E2EERejectionReason.EncryptionFailed),o.Rejected(t))))))}decryptCallKeyForThread(e,t){return this._getReceiverAddress(e).then((e=>a.default.decryptMessage(e,t)))}_getReceiverAddress(e){return n.default.getConversationMetaAsync(e).then((t=>{if(!t)return o.Rejected(`No conversation found for ${h.mriOrId(e)}`);const s=t.conv.getEncryptionHandshake();if(!s)return o.Rejected(`No secure handshake in conversation ${h.mriOrId(e)}`);const i=d.default.getBuddyAddress(s);return i.mri&&i.devId?i:o.Rejected(`Missing receiver information in handshake for ${h.mriOrId(e)}`)}))}}},667121:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_E2eeSessionService=void 0;const i=s(727484),o=s(201646),n=s(358072),r=s(496486),a=s(901455),l=s(974634),d=s(397691),c=s(422801),h=s(476621),u=s(581697),p=s(539549),g=s(440276),m=s(816402),S=s(657916),f=s(36763),y=s(125793),v=s(746096),C=s(436237),_=s(178735),b=s(18078),T=s(422538),M=s(404057),I=s(912770);i.extend(o);class w{constructor(){this._loadingPrivateConvs={},this.identityUpdated=new l.default,this.conversationStored=new l.default,T.RegisterStartupable(this,"E2eeSessionService",[c.default,h.default,u.default,p.default,y.default,_.default])}startup(){return this._storage=S.E2eeSessionStorage.getStorage(b.default.getSkypeId()),h.default.decryptionFailed.subscribe((e=>{this.sendReject(e,v.E2EERejectionReason.DecryptionFailed)})),n.SignalProtocolLib.initialize(a),d.Resolved()}sendInvite(e,t){let s;return this._ensureInit().then((()=>this._getInviteKeyBundle(e).then((t=>(s=t.PreKeyId,c.default.serviceSendE2eeInvite([t],e,y.default.getDeviceId()).then((e=>e.body.ThreadId))))).done((e=>{this._addLocalPrivateConversations(e,!0),C.track(new f.E2eeInvite(t))})).fail((e=>{C.track(new f.E2eeInvite(t,!0,M.default.errorAsString(e))),this._storage.removePreKey(s)}))))}sendAccept(e,t,s=!1){let i;return this._ensureInit().then((()=>this._getHandshake(e).then((o=>this._processInvite(o).then((n=>(i=n.PreKeyId,c.default.serviceSendE2eeAccept(o.InviteId,[n],y.default.getDeviceId()).then(r.noop,(i=>s||!this._shouldRefreshProperties(i)?d.Rejected(i):this._refreshInviteIdIfNeeded(o.InviteId,e,f.E2eeAction.Accept).then((()=>this.sendAccept(e,t,!0)))))))))).done((()=>{this._addLocalPrivateConversations(e,!0),C.track(new f.E2eeAccept(t))})).fail((e=>{C.track(new f.E2eeAccept(t,!0,M.default.errorAsString(e))),this._storage.removePreKey(i)}))))}sendConfirm(e,t=!1,s=!1){return this._ensureInit().then((()=>this._getHandshake(e).then((i=>this._processAccept(i).then((()=>c.default.serviceSendE2eeConfirm(i.InviteId).then(r.noop,(o=>s||!this._shouldRefreshProperties(o)?d.Rejected(o):this._refreshInviteIdIfNeeded(i.InviteId,e,f.E2eeAction.Confirm).then((()=>this.sendConfirm(e,t,!0))))))))).done((()=>{this._addLocalPrivateConversations(e,!0),C.track(new f.E2eeConfirm(t))})).fail((e=>{C.track(new f.E2eeConfirm(t,!0,M.default.errorAsString(e)))}))))}sendReject(e,t,s=!1){return this._ensureInit().then((()=>this._getHandshake(e).then((i=>c.default.serviceSendE2eeReject(i.InviteId).then(r.noop,(o=>s||!this._shouldRefreshProperties(o)?d.Rejected(o):this._refreshInviteIdIfNeeded(i.InviteId,e,f.E2eeAction.Reject).then((()=>this.sendReject(e,t,!0))))))).done((()=>{C.track(new f.E2eeReject(t))})).fail((e=>{C.track(new f.E2eeReject(t,!0,M.default.errorAsString(e)))})).then(r.noop)))}getFingerprint(e){return this._getHandshake(e).then((e=>{const t=y.default.getBuddyBundle(e),s=y.default.getBuddyAddress(e);if(s.mri&&s.devId){if(t){const e=this._toSignalPrekeyBundle(t);return this._getFingerprintFor(s.mri,e.identityKey)}const e=new n.SignalProtocolAddress(s.mri,s.devId);return d.fromThenable(this._storage.loadIdentity(e.toString())).then((e=>e?this._getFingerprintFor(s.mri,e):d.fromThenable(this._storage.loadIdentity(s.mri)).then((e=>e?this._getFingerprintFor(s.mri,e):d.Rejected("No identity available")))))}return d.Rejected("No fingerprint available")}))}isPrivateConvStoredLocally(e){if(this._loadingPrivateConvs[e])return this._loadingPrivateConvs[e];const t=d.fromThenable(this._storage.loadLocalPrivateConversations(e));return this._loadingPrivateConvs[e]=t,t.always((()=>delete this._loadingPrivateConvs[e])),t}forgetPrivateConversation(e){return this._addLocalPrivateConversations(e,!1)}terminateSession(e){return this._cleanupSession(e)}resetIdentity(){return _.default.setUserPreferencesLocal({e2eeV1Initialised:!1}),this._initEncryptionState().then((()=>{this.identityUpdated.fire()}))}_addLocalPrivateConversations(e,t){return d.fromThenable(this._storage.addLocalPrivateConversations(e,t)).then((()=>this.conversationStored.fire(e,t)))}_refreshInviteIdIfNeeded(e,t,s){return this._getHandshake(t).then((i=>{e===i.InviteId?(C.log(v.LogTraceArea.E2EEncryption,"_refreshInviteIdIfNeeded: Refreshing thread properties"),C.track(new f.E2eeRetry(s,f.E2eeRetryType.ForceInviteIdRefresh)),u.default.forceThreadDetailsFetchIfNeeded(t)):(C.log(v.LogTraceArea.E2EEncryption,"_refreshInviteIdIfNeeded: New handshake received in meantime - retry"),C.track(new f.E2eeRetry(s,f.E2eeRetryType.NewInviteIdSynced)))}))}_shouldRefreshProperties(e){return e&&410===e.statusCode&&667===e.errorCode}_getFingerprintFor(e,t){const s=new n.FingerprintGenerator(3);return this._ensureInit().then((()=>d.fromThenable(s.createFor(b.default.getSkypeMri(),this._pubIdentityKey.buffer,e,t))))}_processInvite(e){const t=y.default.getBestBundleMatch(e.APartyPreKeyBundle);return t?this._processInviteBundle(e.AParty,e.APartyDeviceId,e.BParty,t):d.Rejected(`No matching key bundle from AParty, was looking for algo ${y.PREFERRED_HANDSHAKE_ALGO}`)}_processInviteBundle(e,t,s,i){const o=new n.SignalProtocolAddress(e,t),r=new n.SessionBuilder(this._storage,o),a=this._toSignalPrekeyBundle(i);return d.fromThenable(r.processPreKey(a)).then((()=>this._getInviteKeyBundle(e)))}test_processInviteBundle(e,t,s,i){return this._ensureInit().then((()=>this._processInviteBundle(e,t,s,i)))}_processAccept(e){const t=y.default.getBestBundleMatch(e.BPartyPreKeyBundle);return e.BPartyDeviceId&&t?this._processAcceptBundle(e.BParty,e.BPartyDeviceId,e.AParty,t):d.Rejected(`No matching key bundle from BParty, was looking for algo ${y.PREFERRED_HANDSHAKE_ALGO}`)}_processAcceptBundle(e,t,s,i){const o=new n.SignalProtocolAddress(e,t),r=new n.SessionBuilder(this._storage,o),a=this._toSignalPrekeyBundle(i);return d.fromThenable(r.processPreKey(a))}test_processAcceptBundle(e,t,s,i){return this._ensureInit().then((()=>this._processAcceptBundle(e,t,s,i)))}_initEncryptionState(){return(_.default.getUserPreferencesLocal().e2eeV1Initialised?this._loadEncryptionState():this._generateAndStoreRegId().then((()=>this._generateAndStoreIdentityKey())).then((e=>this._generateAndStoreSignedPreKey(e))).then((()=>{_.default.setUserPreferencesLocal({e2eeV1Initialised:!0}),C.log(v.LogTraceArea.E2EEncryption,"Initialized e2e encryption state")}))).then((()=>{I.default.setTimeout((()=>this._checkSignedPreKeyRenewal(this._signedPreKeyExpiration)),432e5)}))}_generateAndStoreRegId(){return C.log(v.LogTraceArea.E2EEncryption,"Registration id generated"),d.fromThenable(this._storage.setLocalRegistrationId(n.KeyHelper.generateRegistrationId()))}_generateAndStoreIdentityKey(){return d.fromThenable(n.KeyHelper.generateIdentityKeyPair().then((e=>(C.log(v.LogTraceArea.E2EEncryption,"Indentity keypair generated"),this._pubIdentityKey=new Uint8Array(e.pubKey),this._storage.storeIdentityKeyPair(e).then((()=>e))))))}_generateAndStoreSignedPreKey(e){return d.fromThenable(n.KeyHelper.generateSignedPreKey(e,S.NOP_KEY_ID).then((e=>(C.log(v.LogTraceArea.E2EEncryption,"SignedPreKey keypair generated"),this._pubSignedPreKey=new Uint8Array(e.keyPair.pubKey),this._signedPreKeySignature=new Uint8Array(e.signature),this._signedPreKeyExpiration=m.default.add(Date.now(),0,14),this._storage.storeSignedPreKey(S.NOP_KEY_ID,e.keyPair).then((()=>this._storage.storeSignedPreKeySignature(S.NOP_KEY_ID,e.signature))).then((()=>this._storage.storeSignedPreKeyExpiration(S.NOP_KEY_ID,this._signedPreKeyExpiration)))))))}_loadEncryptionState(){return d.all([d.fromThenable(this._storage.getIdentityKeyPair()),d.fromThenable(this._storage.loadSignedPreKey(S.NOP_KEY_ID)),d.fromThenable(this._storage.loadSignedPreKeySignature(S.NOP_KEY_ID)),d.fromThenable(this._storage.loadSignedPreKeyExpiration(S.NOP_KEY_ID))]).then((([e,t,s,i])=>(e&&(this._pubIdentityKey=new Uint8Array(e.pubKey)),t&&(this._pubSignedPreKey=new Uint8Array(t.pubKey)),s&&(this._signedPreKeySignature=new Uint8Array(s)),i&&(this._signedPreKeyExpiration=i),this._pubIdentityKey&&this._pubSignedPreKey&&this._signedPreKeySignature&&this._signedPreKeyExpiration?(C.log(v.LogTraceArea.E2EEncryption,"Loaded e2e encryption state"),this._checkSignedPreKeyRenewal(this._signedPreKeyExpiration)):(C.error(v.LogTraceArea.E2EEncryption,"Failed to load encryption state, reinitializing"),this.resetIdentity()))))}_checkSignedPreKeyRenewal(e){return Date.now()>e?(C.log(v.LogTraceArea.E2EEncryption,"Renewing signed pre key"),d.fromThenable(this._storage.getIdentityKeyPair()).then((e=>e?this._generateAndStoreSignedPreKey(e):d.Rejected("Could not load identity key")))):d.Resolved()}test_forceSignedPreKeyRenewal(){return this._checkSignedPreKeyRenewal(0)}_getHandshake(e){const t=(0,p.default)().getConversation(e);if(!t)return d.Rejected(`No conv ${e} found`);const s=t.getEncryptionHandshake();return s?d.Resolved(s):d.Rejected(`No handshake in conv ${e}`)}_getInviteKeyBundle(e){const t=g.getRandomInt32();return d.fromThenable(n.KeyHelper.generatePreKey(t).then((e=>this._storage.storePreKey(t,e.keyPair).then((()=>this._getPreKeyBundle(t,e.keyPair.pubKey))))))}test_getInviteKeyBundle(e){return this._ensureInit().then((()=>this._getInviteKeyBundle(e)))}_ensureInit(){return this._lazyInitTask||(this._lazyInitTask=this._initEncryptionState()),this._lazyInitTask}test_init(){return this._lazyInitTask=void 0,this._ensureInit()}_getPreKeyBundle(e,t){const s=i.duration(this._signedPreKeyExpiration).subtract(Date.now(),"ms");return{IdentityKeyBase64:this._toBase64(this._pubIdentityKey),SignedPreKeyBase64:this._toBase64(this._pubSignedPreKey),PreKeySignatureBase64:this._toBase64(this._signedPreKeySignature),PreKeyBase64:this._toBase64(new Uint8Array(t)),ValidityPeriod:s.toISOString(),AlgorithmId:y.CURVE25519_ALGO_ID,SignedPreKeyId:S.NOP_KEY_ID,PreKeyId:e}}_toSignalPrekeyBundle(e){return{registrationId:S.NOP_KEY_ID,identityKey:this._fromBase64(e.IdentityKeyBase64),signedPreKey:{keyId:e.SignedPreKeyId,publicKey:this._fromBase64(e.SignedPreKeyBase64),signature:this._fromBase64(e.PreKeySignatureBase64)},preKey:{keyId:e.PreKeyId,publicKey:this._fromBase64(e.PreKeyBase64)}}}_cleanupSession(e){const t=y.default.getBuddyAddress(e);if(t.devId){const e=new n.SignalProtocolAddress(t.mri,t.devId);return d.all([d.fromThenable(this._storage.saveIdentity(e.getName(),void 0)),d.fromThenable(this._storage.saveIdentity(e.toString(),void 0)),d.fromThenable(this._storage.storeSession(e.toString(),void 0))]).then(r.noop)}return d.Resolved()}_toBase64(e){return g.Uint8ArrayToBase64String(e)}_fromBase64(e){return g.base64StringToUint8Array(e).buffer}}t.Test_E2eeSessionService=w;const P=new w;t.default=new class{constructor(){this.identityUpdated=P.identityUpdated,this.conversationStored=P.conversationStored}sendInvite(e,t){return this._ensureServiceStarted().then((()=>P.sendInvite(e,t)))}sendAccept(e,t){return this._ensureServiceStarted().then((()=>P.sendAccept(e,t)))}sendConfirm(e,t=!1){return this._ensureServiceStarted().then((()=>P.sendConfirm(e,t)))}sendReject(e,t){return this._ensureServiceStarted().then((()=>P.sendReject(e,t)))}getFingerprint(e){return this._ensureServiceStarted().then((()=>P.getFingerprint(e)))}terminateSession(e){return this._ensureServiceStarted().then((()=>P.terminateSession(e)))}resetIdentity(){return this._ensureServiceStarted().then((()=>P.resetIdentity()))}isPrivateConvStoredLocally(e){return this._ensureServiceStarted().then((()=>P.isPrivateConvStoredLocally(e)))}forgetPrivateConversation(e){return this._ensureServiceStarted().then((()=>P.forgetPrivateConversation(e)))}_ensureServiceStarted(){return T.EnsureStarted(P)}}},657916:(e,t,s)=>{var i=s(348764).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.E2eeSessionStorage=t.NOP_KEY_ID=void 0;const o=s(496486),n=s(548400),r=s(397691),a=(s(889391),s(562141)),l=s(440276),d=s(746096),c=s(436237),h=s(998754),u=s(914976),p=s(404057),g=s(640363),m="Skype",S={IdentityKeyPair:m+"IdentityKeyPair",LocalRegistrationId:m+"LocalRegistrationId",Identity:m+"Identity",PreKey:m+"PreKey",Session:m+"Session",SessionBase64:m+"B64Session",SignedPreKey:m+"SignedPreKey",SignedPreKeySignature:m+"SignedPreKeySignature",SignedPreKeyExpiration:m+"SignedPreKeyExpiration",Fingerprints:m+"Fingerprints",DeviceId:m+"SecureDeviceId",LocalPrivateConversations:m+"LocalPrivateConversations"};t.NOP_KEY_ID=42;const f={},y="Unsupported storage type!";class v{static getStorage(e){return f[e]||(f[e]=new v(e)),f[e]}constructor(e){this._storageKey=e,this._data={},this._testUseInsecureStorage=!0,this.Direction={SENDING:1,RECEIVING:2}}storeIdentityKeyPair(e){return this._storeKeyPair(S.IdentityKeyPair,e)}loadIdentity(e){return this._loadString(S.Identity+e).then((e=>e?l.base64StringToUint8Array(e).buffer:void 0))}storeSignedPreKeySignature(e,t){const s=l.Uint8ArrayToBase64String(new Uint8Array(t));return this._storeString(S.SignedPreKeySignature+e,s)}loadSignedPreKeySignature(e){return this._loadString(S.SignedPreKeySignature+e).then((e=>e?l.base64StringToUint8Array(e).buffer:void 0))}setLocalRegistrationId(e){return this._storeString(S.LocalRegistrationId,e.toString())}storeDeviceId(e){return this._storeString(S.DeviceId,e)}loadDeviceId(){return this._loadString(S.DeviceId)}storePreKey(e,t){return this._storeKeyPair(S.PreKey+e,t)}storeSignedPreKey(e,t){return this._storeKeyPair(S.SignedPreKey+e,t)}storeSignedPreKeyExpiration(e,t){return this._storeString(S.SignedPreKeyExpiration+e,t.toString())}loadSignedPreKeyExpiration(e){return this._loadString(S.SignedPreKeyExpiration+e).then((e=>e?parseInt(e,10):void 0))}storeFingerprints(e,t){return this._storeString(S.Fingerprints+e,JSON.stringify(t))}loadFingerprints(e){return this._loadString(S.Fingerprints+e).then((e=>p.default.parseJsonErrorToUndefined(e)))}addLocalPrivateConversations(e,t){return this._storeString(S.LocalPrivateConversations+e,t.toString())}loadLocalPrivateConversations(e){return this._loadString(S.LocalPrivateConversations+e).then((e=>!!e&&"true"===e))}getIdentityKeyPair(){return this._loadKeyPair(S.IdentityKeyPair)}getLocalRegistrationId(){return this._loadString(S.LocalRegistrationId).then((e=>e?parseInt(e,10):void 0))}isTrustedIdentity(e,t){return new Promise(((e,t)=>{e(!0)}))}saveIdentity(e,t){const s=t?"string"==typeof t?l.byteArrayToBase64String(l.binaryStringToBytes(t)):l.Uint8ArrayToBase64String(new Uint8Array(t)):void 0;return this._storeString(S.Identity+e,s)}loadPreKey(e){return this._loadKeyPair(S.PreKey+e)}removePreKey(e){return this._removeEntry(S.PreKey+e)}loadSignedPreKey(e){return this._loadKeyPair(S.SignedPreKey+e)}loadSession(e){return g.default.isElectronLinux()?this._loadString(S.SessionBase64+e).then((t=>t?Promise.resolve(l.atobUtf8(t)):this._loadString(S.Session+e))):this._loadString(S.Session+e)}storeSession(e,t){if(g.default.isElectronLinux()){const s=[];return s.push(this._storeString(S.SessionBase64+e,t?l.btoaUtf8(t):void 0)),void 0===t&&s.push(this._storeString(S.Session+e,t)),Promise.all(s).then((e=>o.first(e)))}return this._storeString(S.Session+e,t)}_removeEntry(e){if(this._shouldUseInsecureStorage()){const t=o.cloneDeep(this._data);return delete t[e],this._data=t,this._toThenable(h.default.putData(a.InternalKeys.EndToEndEncryptionData,t))}return g.default.isElectronWindows()?this._toThenable(this._removeEntryWindowsHelper(e)):Promise.reject(y)}_storeKeyPair(e,t){const s={pubKey:l.Uint8ArrayToBase64String(new Uint8Array(t.pubKey)),privKey:l.Uint8ArrayToBase64String(new Uint8Array(t.privKey))},i=JSON.stringify(s);return this._storeString(e,i)}_loadKeyPair(e){return this._loadString(e).then((e=>{if(e){const t=p.default.parseJsonWithDefault(e,void 0);if(t)return Promise.resolve({pubKey:l.base64StringToUint8Array(t.pubKey).buffer,privKey:l.base64StringToUint8Array(t.privKey).buffer})}return Promise.resolve(void 0)}))}_storeString(e,t){if(!t)return this._removeEntry(e);if(c.log(d.LogTraceArea.E2EEncryption,`Storing credentials, service:${u.mriOrId(e)} data length:${t.length}`),this._shouldUseInsecureStorage()){const s=o.cloneDeep(this._data);return s[e]=t,this._data=s,this._toThenable(h.default.putData(a.InternalKeys.EndToEndEncryptionData,s))}return g.default.isElectronWindows()?this._toThenable(this._storeStringWindowsHelper(e,t)):Promise.reject(y)}_loadString(e){let t;return this._shouldUseInsecureStorage()?(o.isEmpty(this._data)&&(this._data=h.default.getData(a.InternalKeys.EndToEndEncryptionData)||{}),t=Promise.resolve(this._data[e])):t=g.default.isElectronWindows()?this._toThenable(this._loadStringWindowsHelper(e)):Promise.reject(y),t.catch((e=>{}))}_storeStringWindowsHelper(e,t){const s=2560;if(i.from(t).length<=s)return r.all([n.default.setPassword(e,this._storageKey,t),this._deleteSegments(e,0)]).then(o.noop);const a=[];let l;for(let e=0;e<t.length;e+=l){l=o.floor(1280);let n=t.substring(e,e+l);i.from(n).length>s&&(l=o.floor(s/3),n=t.substring(e,e+l)),a.push(n)}c.log(d.LogTraceArea.E2EEncryption,`Splitting credentials into ${a.length} segments, service:${u.mriOrId(e)}`);const h=o.map(a,((t,s)=>n.default.setPassword(this._createWindowsServiceKey(e,s),this._storageKey,t)));return h.push(n.default.deletePassword(e,this._storageKey).then(o.noop)),h.push(this._deleteSegments(e,a.length)),r.all(h).then(o.noop)}_removeEntryWindowsHelper(e){return r.all([n.default.deletePassword(e,this._storageKey),this._deleteSegments(e,0)]).then(o.noop)}_loadStringWindowsHelper(e){return n.default.getPassword(e,this._storageKey).catch((()=>{const t=(s,i)=>n.default.getPassword(this._createWindowsServiceKey(e,s),this._storageKey).then((e=>t(++s,i=i?i+e:e))).catch((()=>({loadedSegments:s,data:i})));return t(0,void 0).then((t=>(void 0!==t.data&&c.log(d.LogTraceArea.E2EEncryption,`Loaded credentials from ${t.loadedSegments} segments, service:${u.mriOrId(e)}`),t.data)))}))}_createWindowsServiceKey(e,t){return e+"_"+t}_deleteSegments(e,t){const s=t=>n.default.deletePassword(this._createWindowsServiceKey(e,t),this._storageKey).then((e=>e?s(++t):r.Resolved(t)));return s(t).then((s=>{c.log(d.LogTraceArea.E2EEncryption,`Deleted credentials in ${s-t} segments, service:${u.mriOrId(e)}`)}))}test_resetStorage(e=!0){h.default.putData(a.InternalKeys.EndToEndEncryptionData,void 0),this._data={},this._testUseInsecureStorage=e}_toThenable(e){return new Promise(((t,s)=>e.then(t,s)))}_shouldUseInsecureStorage(){return!0}}t.E2eeSessionStorage=v},125793:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PREFERRED_HANDSHAKE_ALGO=t.CURVE25519_ALGO_ID=t.SecureHandshakeState=void 0;const i=s(496486),o=s(397691),n=s(351077),r=s(671830),a=s(562141),l=s(998754),d=s(18078),c=s(422538),h=s(853374);var u;!function(e){e[e.None=1]="None",e[e.OtherEndpointInUse=2]="OtherEndpointInUse",e[e.SentInvite=3]="SentInvite",e[e.GotInvite=4]="GotInvite",e[e.SentAccept=5]="SentAccept",e[e.GotAccept=6]="GotAccept",e[e.SentSwitch=7]="SentSwitch",e[e.GotSwitch=8]="GotSwitch",e[e.Completed=9]="Completed"}(u=t.SecureHandshakeState||(t.SecureHandshakeState={})),t.CURVE25519_ALGO_ID=2,t.PREFERRED_HANDSHAKE_ALGO=t.CURVE25519_ALGO_ID;const p=[t.PREFERRED_HANDSHAKE_ALGO],g=[n.MessageTypes.EncryptedText,n.MessageTypes.EncryptedMedia,n.MessageTypes.EncryptedCall],m=g.concat([n.MessageTypes.HandshakeInvite,n.MessageTypes.HandshakeAccept,n.MessageTypes.HandshakeComplete,n.MessageTypes.HandshakeReject,n.MessageTypes.Typing,n.MessageTypes.ClearTyping]);t.default=new class{constructor(){c.RegisterStartupable(this,"E2eeUtils",[l.default])}startup(){return o.Resolved()}getDeviceId(){if(this._cachedDeviceId)return this._cachedDeviceId;if(this._cachedDeviceId=l.default.getData(a.InternalKeys.SecureDeviceId),!this._cachedDeviceId){const e=l.default.getData(a.InternalKeys.DeviceId);e&&h.default.isFormattedGuid(e)?this._cachedDeviceId=e:this._cachedDeviceId=h.default.newGuid(),l.default.putData(a.InternalKeys.SecureDeviceId,this._cachedDeviceId)}return this._cachedDeviceId}shouldIgnoreMessage(e){if(!i.includes(m,e.messagetype))return!0;if(!i.includes(g,e.messagetype))return!1;const t=e.encryptedkey;if(!t)return!0;const s=r.getCreatorMriForMessageFromLink(e.from),o=d.default.isMyMri(s),n=o&&e.fromdeviceid!==this.getDeviceId(),a=!o&&!t[this.getDeviceId()];return n||a}isMyDeviceId(e){return!e||e===this.getDeviceId()}isInitiatedByMe(e){return d.default.isMyMri(e.AParty)}getBuddyAddress(e){return this.isInitiatedByMe(e)?{mri:e.BParty,devId:e.BPartyDeviceId}:{mri:e.AParty,devId:e.APartyDeviceId}}getBuddyBundle(e){return this.isInitiatedByMe(e)?this.getBestBundleMatch(e.BPartyPreKeyBundle):this.getBestBundleMatch(e.APartyPreKeyBundle)}getBestBundleMatch(e){const s=i.find(e,(e=>e.AlgorithmId===t.PREFERRED_HANDSHAKE_ALGO));return s||i.find(e,(e=>e.AlgorithmId in p))}getDetailedHandshakeState(e){const t=e.getEncryptionHandshake();if(!t)return u.None;const s=this.isInitiatedByMe(t),i=s?this.isMyDeviceId(t.APartyDeviceId):this.isMyDeviceId(t.BPartyDeviceId),o=e.isSwitchingSecureDevice();switch(t.HandshakeState){case"None":return u.None;case"Invited":case"Accepted":return i?"Invited"===t.HandshakeState?o?s?u.SentSwitch:u.GotSwitch:s?u.SentInvite:u.GotInvite:s?u.GotAccept:u.SentAccept:u.OtherEndpointInUse;case"Completed":return i?u.Completed:u.OtherEndpointInUse}}isAccepted(e){return"Accepted"===e.HandshakeState}isFatalDecryptionError(e){return!(e&&e.name&&"MessageCounterError"===e.name)}}},299927:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(683025),n=s(397691),r=s(65782),a=s(260021),l=s(746096),d=s(172685),c=s(436237),h=s(671830),u=s(874243),p=s(914976),g=s(76812),m=s(422538),S=s(404057),f=s(183757),y=(s(889391),"ExtensionTelemetryService");t.default=new class{constructor(){this._extensionTelemetryServiceScheduleInterval=void 0,m.RegisterStartupable(this,y)}startup(){return n.Resolved()}_setUpExtensionTelemetryServiceServiceInterval(){void 0!==this._extensionTelemetryServiceScheduleInterval&&d.default.setRefreshOptions(y,{interval:this._extensionTelemetryServiceScheduleInterval,taskTypeFlags:d.TaskTypeFlags.UsesNetworking,callback:()=>(this._postShareExtensionTelemetryData(),this._postNotificationExtensionTelemetryData(),this._postSiriExtensionTelemetryData(),this._postCalendarExtensionTelemetryData(),n.Resolved())})}_postShareExtensionTelemetryData(){o.default.getShareExtensionTelemetryData().then((e=>{if(c.log(l.LogTraceArea.ShareToSkype,"Processing share extension telemetry data: "+e.length),e.length){const t=this._reportSharedTelemetryEvents(e);t&&c.error(l.LogTraceArea.ShareToSkype,"Failed to report "+t+" events")}}),(e=>{c.error(l.LogTraceArea.ShareToSkype,"Failed to get telemetry data from share extension: "+S.default.errorAsString(e))}))}_postNotificationExtensionTelemetryData(){o.default.getNotificationExtensionTelemetryData().then((e=>{if(c.log(l.LogTraceArea.Notifications,"Processing notification extension telemetry data: "+e.length),e.length){const t=this._reportNotificationTelemetryEvents(e);t&&c.error(l.LogTraceArea.Notifications,"Failed to report "+t+" events")}}),(e=>{c.error(l.LogTraceArea.Notifications,"Failed to get telemetry data from notification extension: "+S.default.errorAsString(e))}))}_postSiriExtensionTelemetryData(){o.default.getSiriExtensionTelemetryData().then((e=>{if(c.log(l.LogTraceArea.NativeCodeTelemetry,"Processing siri extension telemetry data: "+e.length),e.length){const t=this._reportSiriTelemetryEvents(e);t&&c.error(l.LogTraceArea.NativeCodeTelemetry,"Failed to report "+t+" events")}}),(e=>{c.error(l.LogTraceArea.NativeCodeTelemetry,"Failed to get telemetry data from siri extension: "+S.default.errorAsString(e))}))}_postCalendarExtensionTelemetryData(){o.default.getCalendarExtensionTelemetryData().then((e=>{if(c.log(l.LogTraceArea.NativeCodeTelemetry,`Processing calendar extension telemetry data: ${e.length}`),e.length){const t=this._reportCalendarTelemetryEvents(e);t&&c.error(l.LogTraceArea.NativeCodeTelemetry,`Failed to report ${t} events`)}}),(e=>{c.error(l.LogTraceArea.NativeCodeTelemetry,"Failed to get telemetry data from calendar extension: "+S.default.errorAsString(e))}))}isSupportedTelemetryEventTypes(e){return"ShareToSkypeEventActions.completed"===e||"ShareToSkypeEventActions.opened"===e||"ShareToSkypeEventActions.posted"===e||"ShareToSkypeEventActions.failed"===e}isSiriSupportedTelemetryEventTypes(e){return"SiriCallSearch"===e||"SiriCallStart"===e}isCalendarSupportedTelemetryEventTypes(e){return"CalendarEventShown"===e||"CalendarEventSelected"===e}isSupportedEventType(e){return"text"===e||"media"===e}isSupportedDataType(e){return"image"===e||("video"===e||"file"===e)}getShareEventFromData(e,t){if(!this.isSupportedEventType(t))return null;const s=[];i.each(e,(e=>{if(!this.isSupportedDataType(e))return void c.error(l.LogTraceArea.ShareToSkype,"Share Extension - Incorrect DataType "+e);const t={uri:"",name:"",width:0,height:0,size:0,type:e,thumbnailUri:"",thumbnailWidth:0,thumbnailHeight:0,thumbnailSize:0};s.push(t)}));return{type:t,data:s.length?s:void 0}}_getSharedTelemetryEventFromData(e){const t=S.default.parseJsonErrorable(e);return i.isError(t)?(c.error(l.LogTraceArea.ShareToSkype,"Share Extension - Failed to parse telemetryData "+p.dev_unknownOmit(e)),null):t}_getNotificationTelemetryEventFromData(e){const t=S.default.parseJsonErrorable(e);if(!i.isError(t))return t;c.error(l.LogTraceArea.Notifications,"Notification Extension - Failed to parse telemetryData "+p.dev_unknownOmit(e))}_getSiriTelemetryEventFromData(e){const t=S.default.parseJsonErrorable(e);if(!i.isError(t))return t;c.error(l.LogTraceArea.Notifications,"Siri Extension - Failed to parse telemetryData "+p.dev_unknownOmit(e))}_getCalendarTelemetryEventFromData(e){const t=S.default.parseJsonErrorable(e);if(!i.isError(t))return t;c.error(l.LogTraceArea.Notifications,"Calendar Extension - Failed to parse telemetryData "+p.dev_unknownOmit(e))}test_getTelemetryEventFromData(e){return this._getSharedTelemetryEventFromData(e)}test_reportSharedTelemetryEvents(e){return this._reportSharedTelemetryEvents(e)}test_reportNotificationTelemetryEvents(e){return this._reportNotificationTelemetryEvents(e)}_reportSharedTelemetryEvents(e){const t=this._getSharedTelemetryEventFromData(e);if(!t)return 1;c.log(l.LogTraceArea.ShareToSkype,(t.events,t.events.length));return i.sumBy(t.events,(e=>{if(!e)return c.error(l.LogTraceArea.ShareToSkype,"Share Extension - telemetryEvent.events contains undefined events"),1;if(!e.shareToSkypeEvent)return c.error(l.LogTraceArea.ShareToSkype,"Share Extension - telemetryEventItem.shareToSkypeEvent is undefined"),1;const t=e.shareToSkypeEvent.event;if(!this.isSupportedEventType(t.type))return c.error(l.LogTraceArea.ShareToSkype,"Share Extension - Incorrect EventType "+e.shareToSkypeEvent.event.type),1;const s=this.getShareEventFromData(t.data,t.type);if(!s)return 1;const i=e.eventType;if(!this.isSupportedTelemetryEventTypes(i))return c.error(l.LogTraceArea.ShareToSkype,"Share Extension - Incorrect Telemetry Event Type "+i),1;if(c.log(l.LogTraceArea.ShareToSkype,"Reporting Share Extension Telemetry for "+i),"ShareToSkypeEventActions.opened"===i){const t=e.shareToSkypeEvent.isSharedToContact;this._reportSharedTelemetryEventOpened(s,t)}else if("ShareToSkypeEventActions.completed"===i||"ShareToSkypeEventActions.failed"===i){const t=e.shareToSkypeEvent.conversationsCount,i=e.shareToSkypeEvent.messageAdded,o=e.shareToSkypeEvent.errorCode,n=e.shareToSkypeEvent.isSharedToContact;this._reportSharedTelemetryEventCompleted(s,t,i,n,o)}else if("ShareToSkypeEventActions.posted"===i){const t=e.shareToSkypeEvent.conversationsCount,i=e.shareToSkypeEvent.messageAdded,o=e.shareToSkypeEvent.errorCode,n=e.shareToSkypeEvent.isSharedToContact;this._reportSharedTelemetryEventPosted(s,t,i,n,o)}return 0}))}_reportNotificationTelemetryEvents(e){const t=this._getNotificationTelemetryEventFromData(e);if(!t)return 1;c.log(l.LogTraceArea.Notifications,(t.events,t.events.length));return i.sumBy(t.events,(e=>{if(!e)return c.error(l.LogTraceArea.Notifications,"Notification Extension - telemetryEvent.events contains undefined events"),1;const t=e.eventType;if("push_notification"!==t)return c.error(l.LogTraceArea.Notifications,"Notification Extension - Incorrect Telemetry Event Type "+t),1;const s=this._getMessageCorrelationId(e);return c.log(l.LogTraceArea.Notifications,"Notification Extension Telemetry for "+t),this._reportNotificationEvent(e,s),0}))}_getMessageCorrelationId(e){if(!e.from||0===e.from.length)return"";const t=h.getCreatorMriForMessageFromLink(e.from);return a.getCorrelationIdFromMessageParts(t,e.conversationId,e.clientMessageId)}_reportSiriTelemetryEvents(e){const t=this._getSiriTelemetryEventFromData(e);if(!t)return 1;c.log(l.LogTraceArea.NativeCodeTelemetry,(t.events,t.events.length));return i.sumBy(t.events,(e=>{if(!e)return c.error(l.LogTraceArea.NativeCodeTelemetry,"Siri Extension - telemetryEvent.events contains undefined events"),1;const t=e.eventType;return this.isSiriSupportedTelemetryEventTypes(t)?(c.log(l.LogTraceArea.NativeCodeTelemetry,"Siri Extension Telemetry for "+t),this._reportSiriTelemetryEvent(t),0):(c.error(l.LogTraceArea.NativeCodeTelemetry,"Siri Extension - Incorrect Telemetry Event Type "+t),1)}))}_reportCalendarTelemetryEvents(e){const t=this._getCalendarTelemetryEventFromData(e);if(!t)return 1;c.log(l.LogTraceArea.NativeCodeTelemetry,(t.events,t.events.length));return i.sumBy(t.events,(e=>{if(!e)return c.error(l.LogTraceArea.NativeCodeTelemetry,"Calendar Extension - telemetryEvent.events contains undefined events"),1;const t=e.eventType;return this.isCalendarSupportedTelemetryEventTypes(t)?(c.log(l.LogTraceArea.NativeCodeTelemetry,"Calendar Extension Telemetry for "+t),this._reportCalendarTelemetryEvent(t),0):(c.error(l.LogTraceArea.NativeCodeTelemetry,"Calendar Extension - Incorrect Telemetry Event Type "+t),1)}))}_reportCalendarTelemetryEvent(e){c.track(new r.default(e))}_reportSiriTelemetryEvent(e){c.track(new f.default({action:e}))}_reportSharedTelemetryEventOpened(e,t){c.track(new g.default({action:g.ShareToSkypeEventActions.opened,isSharedToContact:t,event:e}))}_reportSharedTelemetryEventCompleted(e,t,s,i,o){c.track(new g.default({action:g.ShareToSkypeEventActions.completed,event:e,conversationsCount:t,messageAdded:s,isSharedToContact:i,errorCode:o}))}_reportSharedTelemetryEventPosted(e,t,s,i,o){c.track(new g.default({action:g.ShareToSkypeEventActions.posted,event:e,conversationsCount:t,messageAdded:s,isSharedToContact:i,errorCode:o}))}_reportNotificationEvent(e,t){c.track(new u.default({eventType:e.eventType,eventCode:e.eventCode,conversationId:e.conversationId,messageId:e.messageId,clientMessageId:e.clientMessageId,isMyMessage:e.isMyMessage,result:e.result,messageCorrelationId:t,correlationVector:e.cv}))}}},482666:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(746096),r=s(436237),a=s(526424),l=s(422538),d=s(869021),c=s(404057),h=10*Math.pow(1024,2);t.default=new class{constructor(){l.RegisterStartupable(this,"GifProviderService")}startup(){return o.Resolved()}searchGifs(e,t,s){const i=o.Defer();return d.default.searchGifs(e,t,s).then((e=>(i.resolve(void 0),this._handleApiResults(e)))).catch((e=>(i.reject(void 0),r.error(n.LogTraceArea.GifProviderService,`There was an error when reaching out to Gif provider - Error: ${c.default.asString(e)}`),a.EmptyGifResult)))}getTrendingGifs(e){const t=o.Defer();return d.default.getTrendingGifs(e).then((e=>(t.resolve(void 0),this._handleApiResults(e)))).catch((e=>(t.reject(void 0),r.error(n.LogTraceArea.GifProviderService,`There was an error when reaching out to Gif provider - Error: ${c.default.errorAsString(e)}`),a.EmptyGifResult)))}_handleApiResults(e){const t="tinygif";return{gifItems:i.map(e.results,(e=>({id:`_${e.id}`,title:e.h1_title||e.title,hostUrl:e.itemurl,full:{url:e.media[0].gif.size>=h?e.media[0].tinygif.url:e.media[0].gif.url,width:e.media[0].gif.dims[0]||0,height:e.media[0].gif.dims[1]||0,stillUrl:e.media[0][t].preview,frames:0},small:{url:e.media[0][t].url,width:e.media[0][t].dims[0]||0,height:e.media[0][t].dims[1]||0}}))),nextOffset:Number(e.next)}}}},584876:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HintsProvider=void 0;const i=s(788952);class o{getDefaultMessageHintObject(){return{hintWasShownTimes:0,wasFeatureUsedByUser:!1}}updateAllUserHintsDataWithDefaultValuesIfNeeded(e){const t=Object.assign({},e);return t[i.MessageHintsTypes.DoubleTapMessageToLike]||(t[i.MessageHintsTypes.DoubleTapMessageToLike]=this.getDefaultMessageHintObject()),t[i.MessageHintsTypes.TapOnReactionToReactTheSame]||(t[i.MessageHintsTypes.TapOnReactionToReactTheSame]=this.getDefaultMessageHintObject()),t[i.MessageHintsTypes.HighlightToBingSearch]||(t[i.MessageHintsTypes.HighlightToBingSearch]=this.getDefaultMessageHintObject()),t}getUserHintsDataWithDefaultValues(){return{[i.MessageHintsTypes.DoubleTapMessageToLike]:this.getDefaultMessageHintObject(),[i.MessageHintsTypes.TapOnReactionToReactTheSame]:this.getDefaultMessageHintObject(),[i.MessageHintsTypes.HighlightToBingSearch]:this.getDefaultMessageHintObject()}}}t.HintsProvider=o,t.default=new o},54799:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImageCookieSetterService=void 0;const i=s(496486),o=s(662783),n=s(397691),r=s(889391),a=s(257113),l=s(436237),d=s(998754),c=s(932226),h=(s(981956),s(422538)),u=s(912770),p=s(994214),g=s(626712);t.ImageCookieSetterService=class{constructor(e,t,s,i,n){this._serviceName=e,this._dbKey=t,this._logArea=s,this._cookieUrl=i,this._cookieName=n,this._exponentialTime=new o.ExponentialTime(1e3,3e5),this._checkCookieBasis=()=>{if(!p.default.hasUsableSkypeToken())return void this._invalidateCookieIfSkypeTokenExpired();const e=p.default.getSkypeToken();if(e&&(!this._lastSkypeTokenSet||e.rawToken!==this._lastSkypeTokenSet.rawToken))if(l.log(this._logArea,"SkypeToken updated - requesting new cookies"),this._setAuthCookieSleepPromise){const e=this._setAuthCookieSleepPromise;this._setAuthCookieSleepPromise=void 0,e.cancel()}else this._setAuthCookie()},h.RegisterStartupable(this,this._serviceName,[d.default,c.default,p.default])}startup(){d.default.getData(this._dbKey);return l.log(this._logArea,"Startup: Reset Cookie"),this.setCookieFlag(!1),p.default.subscribe(this._checkCookieBasis,p.TriggerKeys.SkypeTokenKey),c.default.subscribe(this._checkCookieBasis),this._checkCookieBasis(),n.Resolved()}_setAuthCookie(){return this._setAuthCookiePendingPromise||(this._setAuthCookiePendingPromise=this._setAuthCookieInternal().finally((()=>{this._setAuthCookiePendingPromise=void 0}))),this._setAuthCookiePendingPromise}_setAuthCookieInternal(){const e=p.default.getSkypeToken();return e?this.sendAuthCookieRequest(e).then((()=>{if(!a.default.getCookieSupported()||!this._cookieUrl||!this._cookieName)return;const t=g.default.getDomainName(this._cookieUrl);return a.default.checkCookieValue(t,this._cookieName,e.rawToken)}),(e=>(this._invalidateCookieIfSkypeTokenExpired(),l.error(this._logArea,"Cookie update request failed. Response code: "+e.statusCode),n.Rejected(e)))).then((()=>{this._exponentialTime.reset(),this._saveSkypeTokenWhenCookieSet(e)})).catch((e=>{const t=this._exponentialTime.getTimeAndCalculateNext();return this._setAuthCookieSleepPromise=u.default.sleep(t),this._setAuthCookieSleepPromise.always((()=>(this._setAuthCookieSleepPromise=void 0,p.default.hasUsableSkypeToken()?this._setAuthCookieInternal():(this._invalidateCookieIfSkypeTokenExpired(),n.Rejected(e)))))})):n.Rejected("Missing Token")}_invalidateCookieIfSkypeTokenExpired(){this._lastSkypeTokenSet&&!this._lastSkypeTokenSet.isTokenExpired()||(l.log(this._logArea,"SkypeToken is expired - cookies are not valid"),this.setCookieFlag(!1))}_saveSkypeTokenWhenCookieSet(e){const t=!e.isTokenExpired();l.log(this._logArea,"New cookies set. isTokenValid="+t),this.setCookieFlag(t),this._lastSkypeTokenSet=e,d.default.putData(this._dbKey,{rawToken:e.rawToken,expiration:e.expiration})}setAuthCookieDebounced(){return r.default.getAsyncMediaFeatures().ams_cookie_refresh_request_enabled?(l.log(this._logArea,"Set AuthCookie Debounced. Already have SyncTask=",!!this._setAuthCookieDebouncedPromise),this._setAuthCookieDebouncedPromise||(this._setAuthCookieDebouncedPromise=p.default.performWhenValidSkypeTokenArrives().then((()=>(l.log(this._logArea,"Valid Skype Token arrived. Setting auth cookie."),this._setAuthCookie().catch(i.noop)))),this._setAuthCookieDebouncedPromise.always((()=>{u.default.setTimeout((()=>{l.log(this._logArea,"Set AuthCookie Debounced. Setting SyncTask to undefined"),this._setAuthCookieDebouncedPromise=void 0}),r.default.getAsyncMediaFeatures().ams_cookie_setter_debounce_wait)}))),this._setAuthCookieDebouncedPromise):n.Rejected()}}},849956:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(516778),n=s(397691),r=s(889391),a=s(476621),l=s(351077),d=s(671830),c=s(898278),h=s(429791),u=s(539549),p=s(816402),g=s(986374),m=s(952262),S=s(82433),f=s(746096),y=s(733754),v=s(232638),C=s(18078),_=s(330124),b=s(827357),T=s(477275),M=s(279829),I=s(677914),w=s(71987),P=s(886045),k=s(422538),A=s(912770);t.default=new class{constructor(){k.RegisterStartupable(this,"IncomingMessageAnnouncementService",[a.default,m.default,b.default,u.default])}startup(){const e={},t={};return a.default.messagesProcessedWithBundleInfo.subscribe((s=>{if(P.default.shouldAnnounceForAccessibility()){const n=b.default.getActiveConversationId(c.MainRootViewId)||b.default.getActiveCallConversationId();i.each(s,(s=>{const i=s.message.cuid;if(i){if(this._shouldAnnounceMessage(s,n))if(s.message.isMutated()&&!this._isCurrentUserMessageReactionUpdate(s)||s.message.isDeletedMessage()){if(s.message.isDeletedMessage()&&!t[i]){const e=this.getAnnouncementText(s,!0);e&&(t[i]=A.default.setTimeout((()=>{delete t[i]}),1e4),o.Accessibility.announceForAccessibility(e))}}else{const t=this.getAnnouncementText(s);t&&!e[i]&&(e[i]=A.default.setTimeout((()=>{delete e[i]}),1e4),o.Accessibility.announceForAccessibility(t,!1,i))}s.message.isDeletedMessage()&&o.Accessibility.removeAnnouncementClass(i)}}))}})),n.Resolved()}getAnnouncementText(e,t){const s=e.message,o=(0,u.default)().getConversation(s.conversationId),n=o&&o.isThread()||!1,r=d.isEncryptedThread(s.conversationId);let a="";if(!r&&!t){const e=g.decode(s);a=h.toAccessibilityLabel(e,{message:s,includeSenderInformationInAccessibilityLabel:!1,includeReactionInformationInAccessibilityLabel:!1,includeMediaAlbumItemCountInAccessibilityLabel:!1})}let c="";C.default.isMyMri(s.creator)||(c=m.default.getDisplayName(s.creator)||"");const f={senderName:c,messageContent:a,timestamp:p.default.getDisplayTimeString(s.createdTime)};if(r){if(i.startsWith(s.content,"<handshakeinvite>"))return;return y.getString("AccessibilityLabel.NewPrivateMessage",f)}if(l.isScheduledCallType(s.messagetype))return this._getScheduledCallUpdateAnnouncement(s);if(i.isEmpty(e.reactionUpdates.added)){if(i.isEmpty(e.reactionUpdates.removed))return n?(f.threadName=m.default.getDisplayName(s.conversationId)||"",t?y.getString("AccessibilityLabel.RemovedMessageThreadAnnouncement",f):y.getString("AccessibilityLabel.NewThreadMessage",f)):t?y.getString("AccessibilityLabel.RemovedMessageConversationAnnouncement",f):y.getString("AccessibilityLabel.NewConversationMessage",f);{const t=i.last(e.reactionUpdates.removed);if(!t)return;f.senderName=m.default.getDisplayName(t.mri)||"";const s=S.default.getEmoticonByShortcutNoSubscription(t.key);return f.reaction=s&&s.description||t.key,y.getString("AccessibilityLabel.RemovedReactionToMessage",f)}}{const t=i.last(e.reactionUpdates.added);if(!t)return;f.senderName=m.default.getDisplayName(t.mri)||"";const s=S.default.getEmoticonByShortcutNoSubscription(t.key);return f.reaction=s&&s.description||t.key,y.getString("AccessibilityLabel.NewReactionToMessage",f)}}_isCurrentUserMessageReactionUpdate(e){const t=C.default.isMyMri(e.message.creator);return r.default.getS4LMessagingFeaturesNoSubscription().enableReactionAnnouncements&&t&&(!i.isEmpty(e.reactionUpdates.added)||!i.isEmpty(e.reactionUpdates.removed))}_isReactionUpdate(e){return!i.isEmpty(e.reactionUpdates.added)||!i.isEmpty(e.reactionUpdates.removed)}_isComingFromLongPollOrTrouter(e){return i.some(e.details,(e=>e.origin===f.MessageOrigin.LongPoll||e.origin===f.MessageOrigin.Trouter))}_shouldAnnounceMessage(e,t){const s=this._isComingFromLongPollOrTrouter(e),o=!i.isUndefined(t)&&t===e.message.conversationId,n=this._isComingFromEngagementSystem(e),r=this._isComingFromHiddenBot(e);if(!s||e.message.isDeletedMessage()&&!o||n||r)return!1;const a=(0,u.default)().getConversation(e.message.conversationId);if(a&&l.shouldServerMessageBeFilteredOut(e.message,a))return!1;const d=C.default.isMyMri(e.message.creator),c=this._isCurrentUserMessageReactionUpdate(e),h=v.areNotificationsEnabled(),p=a&&a.isMuted(),g=this._isReactionUpdate(e);return!e.message.isAlbumItem()&&(o?!d||c:_.default.isUsingStackNavigationContext()?!d&&h&&!p&&!g:!d&&!p&&!g)}_isComingFromEngagementSystem(e){const t=r.default.getEngagementFeatures().engagementSenderIdentity;return!!i.some(t,(t=>t===e.message.creator))}_isComingFromHiddenBot(e){const t=r.default.getS4LCaapFeatures().botIdsToHide;return!!i.some(t,(t=>t===e.message.creator))}_getScheduledCallUpdateAnnouncement(e){const t=T.default.extractScheduledCallFromMessage(e);if(!t)return;const s=I.default.getScheduledCallById(t.id),o=I.default.getScheduledCallUpdatesDeltas(e.creator,s,t);if(i.isEmpty(o.invitations)){if(o.wasCanceled){const s=m.default.getDisplayName(e.creator)||"";return y.getString("Notifications.ScheduledCallDeletedBody",{displayName:s,subject:w.default.getScheduledCallSubject(t.subject)})}}else{let e="";if(i.forOwn(o.invitations,((s,i)=>{const o=m.default.getDisplayName(i)||"";e+=(s.invitationStatus===M.ScheduledCallInvitationStatus.Accepted?y.getString("Notifications.ScheduledCallAcceptedBody",{displayName:o,subject:w.default.getScheduledCallSubject(t.subject)}):y.getString("Notifications.ScheduledCallDeclinedBody",{displayName:o,subject:w.default.getScheduledCallSubject(t.subject)}))+" "})),e)return e}}}},209815:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalMessageNotificationsService=void 0;const i=s(496486),o=s(583367),n=s(823113),r=s(269521),a=(s(31615),s(397691)),l=(s(516778),s(889391)),d=s(63413),c=s(481169),h=s(476621),u=s(351077),p=s(671830),g=s(562141),m=s(898278),S=(s(400984),s(887399)),f=s(475760),y=s(82927),v=s(331751),C=s(924339),_=s(899686),b=(s(986374),s(952262)),T=s(676679),M=s(427447),I=s(310167),w=s(82433),P=s(746096),k=s(805581),A=s(436237),x=s(998754),R=s(733754),O=(s(312762),s(232638)),L=s(314572),F=s(326385),B=s(178735),D=s(46929),E=s(18078),V=s(217093),N=s(330124),U=s(827357),j=s(597223),H=s(888553),z=s(213847),W=s(333326),G=s(709582),K=s(29130),q=s(914976),Q=s(33714),X=s(477275),$=s(279829),J=s(677914),Y=s(71987),Z=s(262232),ee=s(422538),te=s(404057),se=s(640363),ie=s(198762),oe=s(628069),ne=s(172758),re=s(853374),ae=s(47447),le=(s(671830),s(571046));class de{constructor(){this._recentlyNotifiedKeys=[],ee.RegisterStartupable(this,"LocalMessageNotificationsService",[G.default,B.default])}startup(){return a.Resolved()}_getAppLaunchedNotificationType(e){const t=u.getMessageTypeGroup(e);if(e.isCurrentUserQuoted())return P.NotificationTypeAppLaunched.Quote;if(e.isCurrentUserMentioned())return P.NotificationTypeAppLaunched.Mention;switch(t){case u.MessageTypeGroups.MediaAlbum:return P.NotificationTypeAppLaunched.MediaAlbum;case u.MessageTypeGroups.Picture:return P.NotificationTypeAppLaunched.Photo;case u.MessageTypeGroups.Video:return P.NotificationTypeAppLaunched.Video;case u.MessageTypeGroups.UriFile:return P.NotificationTypeAppLaunched.File;case u.MessageTypeGroups.Moji:return P.NotificationTypeAppLaunched.Moji;case u.MessageTypeGroups.Sticker:return P.NotificationTypeAppLaunched.Sticker;case u.MessageTypeGroups.ScheduledCallInvite:return P.NotificationTypeAppLaunched.ScheduledCallInvite;case u.MessageTypeGroups.Location:return P.NotificationTypeAppLaunched.Location;case u.MessageTypeGroups.Text:return z.isLastMessageUpdateReaction(e)?P.NotificationTypeAppLaunched.Reaction:P.NotificationTypeAppLaunched.Text;default:return}}_shouldProcessReactionNotification(e){return z.isLastMessageUpdateReaction(e)?ee.EnsureStarted(D.default).then((()=>D.default.getReactionNotificationsEnabled())):a.Resolved(!1)}_tryProcessingScheduledCallNotification(e){return u.isScheduledCallType(e.messagetype)?ee.EnsureStarted(J.default).then((()=>J.default.processScheduledCallMessage(e))):a.Resolved(void 0)}processMessageInfoForNotifications(e){const t=e.message;return i.some(e.details,(e=>e.origin===P.MessageOrigin.ChatSync||e.origin===P.MessageOrigin.LocalChange))||(0,oe.isForceUpdateEnabled)()?a.Resolved(P.MessageProcessResult.CameFromSyncOrLocal):a.all([this._shouldProcessReactionNotification(t),this._tryProcessingScheduledCallNotification(t)]).then((([s,i])=>{const o=!(!i||!i.hasUpdates);if(E.default.isMyMri(t.creator)&&!s&&!o&&!(0,le.isMagicBotOneOnOneMessage)(t))return a.Resolved(P.MessageProcessResult.MyMessage);if((0,le.isMagicBotOneOnOneControlMessage)(t))return a.Resolved(P.MessageProcessResult.BingControl);if(t.isDeletedMessage())return G.default.cancelNotificationById(t.conversationId+t.createdTime),a.Resolved(P.MessageProcessResult.DeletedMessage);if(t.isHiddenTranslationSettingsMessage())return a.Resolved(P.MessageProcessResult.TranslationSettingsSuppressed);if(l.default.getS4LCMCFeatures().enableMessageTranslation&&k.default.isConversationTranslated(t.conversationId)&&u.isWrittenTextMessageType(t.messagetype)&&!s)return a.Resolved(P.MessageProcessResult.OriginalForTranslatedConversationSuppressed);if(t.isEdited()&&!s&&!o)return a.Resolved(P.MessageProcessResult.EditedMessage);if(t.messagetype===u.MessageTypes.PopCard||t.messagetype===u.MessageTypes.Notice)return a.Resolved(P.MessageProcessResult.EngagementNotificationSuppressed);if(t.isMutated()&&!s&&!o)return a.Resolved(P.MessageProcessResult.MutatedMessage);if(u.isCallMessageType(t)||u.isCallInfoMessageType(t))return a.Resolved(P.MessageProcessResult.CallMessage);const n=u.isAddMemberMessageType(t.messagetype);if(u.isThreadActivityType(t.messagetype)&&!n&&!t.isE2eeHandshakeTypeAllowedForNotification())return A.log(P.LogTraceArea.Notifications,"Suppress all thread activity messages except e2e actions"),a.Resolved(P.MessageProcessResult.ThreadActivitySuppressed);if(n){const e=L.getMessageInitiator(t);if(!L.isAddCurrentUserThreadActivity(t)||C.getConversationAlwaysHiddenStatus(t.conversationId).hidden||!l.default.getS4LMessagingFeatures().enableAddedToConversationNotification||e&&E.default.isMyMri(e))return A.log(P.LogTraceArea.Notifications,"Suppress add member to thread activity"),a.Resolved(P.MessageProcessResult.ThreadActivitySuppressed)}if(t.hasAlbumId()){if(!t.isAlbum()&&!s)return a.Resolved(P.MessageProcessResult.Filtered)}const r=O.getReasonForNotificationsDisabled(!0);return void 0!==r?a.Resolved(r):a.all([h.default.getConversationMetaAsync(t.conversationId),M.isDisabledChatNotification(),ee.EnsureStartedExclusive([_.default,d.default,x.default])]).then((s=>{const o=s[0];return s[1]?a.Resolved(P.MessageProcessResult.DoNotDisturbEnabled):p.isUserMri(t.conversationId)&&S.isConversationObjectBlocked(o.conv)?a.Resolved(P.MessageProcessResult.FromBlockedUser):(A.log(P.LogTraceArea.Notifications,"Processed message info, deciding if we need to show a new notification"),O.getNotificationAction(e.isOtherEndpointActive,o.conv,t).then((e=>e.action!==j.MessageNotificationAction.InterruptUser&&e.action!==j.MessageNotificationAction.InformUserExternal?a.Resolved(P.MessageProcessResult.Filtered):(A.log(P.LogTraceArea.Notifications,"Preparing to present local message notification"),this._presentMessageNotification(t,o,e,i)))))}))}))}_presentMessageNotification(e,t,s,n){const r=B.default.getUserPreferencesLocal();let d=!1;const c=_.default.isCurrentUserActive();let h;if(ee.HasStarted(U.default)&&(h=U.default.getActiveConversationId(m.MainRootViewId)),c){if(h!==e.conversationId){const t=v.default.getAllSiblingConversations(e.conversationId);if(l.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations&&i.some(t,(e=>e.id===h)))return a.Resolved(P.MessageProcessResult.SiblingConversationInTabActive)}if(!(h?h!==e.conversationId:this._shouldAllowChatNotificationsWhenNotInConversation()))return a.Resolved(P.MessageProcessResult.IsForegroundedInConversation);ae.UICapabilities.inAppBrowserNotificationsSupported()&&K.default.isTinyScreenSizeNoSubscription(m.MainRootViewId)||(d=!0)}else if(d=!0,!r.enableScheduledCallNotifications&&s.notificationType===j.MessageNotificationType.ScheduledCall)return a.Resolved(P.MessageProcessResult.ScheduleCallNotificationsDisabled);if(!n||!n.hasUpdates){let t=e.cuid;if(s.notificationType===j.MessageNotificationType.Reaction&&(t+=e.getLastReactionTimeExcludingCurrentUser()),i.includes(this._recentlyNotifiedKeys,t))return a.Resolved(P.MessageProcessResult.RecentlyNotified);this._recentlyNotifiedKeys.push(t),this._recentlyNotifiedKeys.length>50&&this._recentlyNotifiedKeys.splice(0,this._recentlyNotifiedKeys.length-50)}if(d)return A.log(P.LogTraceArea.Notifications,"Presenting system notification"),this._showSystemLocalNotificationForMessage(e,t,s,n);{if(!r.enableInAppScheduledCallNotifications&&s.notificationType===j.MessageNotificationType.ScheduledCall)return a.Resolved(P.MessageProcessResult.InAppScheduleCallNotificationsDisabled);if(!r.enableInAppNotifications)return a.Resolved(P.MessageProcessResult.InAppNotificationsDisabled);const t=re.default.newCauseId();A.log(P.LogTraceArea.Notifications,"Presenting in-app notification causeId: "+t),s.notificationType===j.MessageNotificationType.ScheduledCall?n&&this._showScheduledCallToast(e,n.updatesDelta):ie.default.scheduleSkypeMessage(e);const i=new F.MessagingToastShowEvent(e,s.notificationType,s.action,!1,!1,void 0);return A.track(i),r.enableNotificationSounds&&o.default.getRingerMode().then((e=>{e!==o.DeviceRingerMode.Silent&&e!==o.DeviceRingerMode.Vibrate&&Z.default.SkypeInAppNotification.playOnce(t)})),a.Resolved(P.MessageProcessResult.NotifiedInApp)}}_shouldAllowChatNotificationsWhenNotInConversation(){if(ee.HasStarted(U.default)){if(N.default.isUsingStackNavigationContext())return ie.default.showMessageForScreenReaders();return U.default.getCompositeMainStageNavViewMode()===V.MainStageNavViewMode.WelcomeScreen}return!0}_showSystemLocalNotificationForMessage(e,t,s,o){if(I.default.isMandatoryUpdate())return a.Resolved(P.MessageProcessResult.MandatoryElectronUpdate);if(s.notificationType===j.MessageNotificationType.AddToConversation)return this._populateSystemLocalNotification(e.creator,e,t,void 0,s,void 0);if(s.notificationType===j.MessageNotificationType.Reaction){const i=O.getLastReactionUserMri(e);return i?b.default.getDisplayableProfilePotentiallyBeforeStartupAsync(i).then((i=>this._populateSystemLocalNotification(e.creator,e,t,i,s,void 0))):(A.warn(P.LogTraceArea.Notifications,"Could not find last notification user even though this is reaction notification."),a.Resolved(P.MessageProcessResult.LastReactionUserNotFound))}if(s.notificationType===j.MessageNotificationType.ScheduledCall){if(!o)return a.Resolved(P.MessageProcessResult.ScheduledCallInvitationUnknown);const n=Y.default.getScheduledCallSubject(o.scheduledCall.subject);if(o.updatesDelta.invitations&&!i.isEmpty(o.updatesDelta.invitations)){const i=this._getUserInvitationInfo(o.updatesDelta.invitations);if(!i)return a.Resolved(P.MessageProcessResult.ScheduledCallInvitationUnknown);const r=t.conv.isOneOnOne()&&t.conv.getOtherPartyMri()||e.creator;return b.default.getDisplayableProfilePotentiallyBeforeStartupAsync(r).then((r=>this._populateSystemLocalNotification(e.creator,e,t,r,s,{userMri:i.initiator,subject:n,invitationStatus:i.invitationStatus,scheduledCallId:o.scheduledCall.id,datetimeMs:o.scheduledCall.datetimeMs,hasNewResponses:!0})))}return b.default.getDisplayableProfilePotentiallyBeforeStartupAsync(e.creator).then((i=>{const r={userMri:e.creator,subject:n,wasCanceled:o.updatesDelta.wasCanceled,scheduledCallId:o.scheduledCall.id,hasUpdates:o.hasUpdates,datetimeMs:o.scheduledCall.datetimeMs};return this._populateSystemLocalNotification(e.creator,e,t,i,s,r)}))}{const i=ee.HasStarted(ne.default)?ne.default.getConversationOwner(e.creator):e.creator;return b.default.getDisplayableProfilePotentiallyBeforeStartupAsync(i).then((o=>this._populateSystemLocalNotification(i,e,t,o,s)))}}_getUserInvitationInfo(e){let t;const s=i.keys(e),o=i.first(s);if(e[o]&&(t=e[o].invitationStatus),!i.isUndefined(t)&&t!==$.ScheduledCallInvitationStatus.Unknown)return{initiator:o,invitationStatus:t}}_showScheduledCallToast(e,t){let s,o;if(t)if(i.isUndefined(t.invitations)||i.isEmpty(t.invitations)){if(!t.hasSubjectOrDateTimeChanged&&!t.wasCanceled)return;s=e.creator,o=t.wasCanceled?Q.ScheduleCallAlertTypes.Canceled:Q.ScheduleCallAlertTypes.Edited}else{const e=this._getUserInvitationInfo(t.invitations);if(!e)return;s=e.initiator,o=e.invitationStatus===$.ScheduledCallInvitationStatus.Accepted?Q.ScheduleCallAlertTypes.InvitationAccepted:Q.ScheduleCallAlertTypes.InvitationDeclined}else s=e.creator,o=Q.ScheduleCallAlertTypes.Received;const n=X.default.extractScheduledCallFromMessage(e);n&&ie.default.scheduleMessageForScheduledCall(e,o,s,n.subject)}_populateSystemLocalNotification(e,t,s,i,o,l){return ee.EnsureStarted([H.default,w.default]).then((()=>{const d=H.default.getShowNotificationPermissionStatus();if(d===n.PermissionStatus.Denied||d===n.PermissionStatus.Unavailable)return a.Resolved(P.MessageProcessResult.SystemMessagePermissionsDenied);const c=new y.default(t.conversationId,s.conv),h=t.push_getSenderDisplayName(),u=i&&i.getDisplayName(h),g=i&&i.getShortName(),m=p.unescapeTextWithoutXml(t.push_getThreadTopic()),S=c.getDisplayName(m),v=z.getNotificationIcon(i,c),C={conversationId:t.conversationId,messageTimestamp:t.createdTime,senderId:e,eventType:this._getAppLaunchedNotificationType(t),scheduledCallId:l?l.scheduledCallId:void 0,consumptionHorizon:t.getConsumptionHorizonString()};return T.getCompactNotificationDisplayInfoPotentiallyBeforeStartupAsync(t,s.conv,o.notificationType,u,g,S,l).then((s=>{let i;i=t.isE2eeHandshakeTypeAllowedForNotification()?W.LocalNotificationIds.E2EE_CATEGORY_IDENTIFIER:o.notificationType===j.MessageNotificationType.ScheduledCall?l&&l.hasNewResponses?W.LocalNotificationIds.SCHEDULED_CALL_INVITE_RESPONSE:l&&l.hasUpdates?W.LocalNotificationIds.SCHEDULED_CALL_INVITE_EDIT:W.LocalNotificationIds.SCHEDULED_CALL_INVITE:W.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER;const c=B.default.getUserPreferencesLocal(),h=o.action===j.MessageNotificationAction.InterruptUser&&c.enablePushNotificationSounds,p=f.default.getActiveRecentsConversationCount(),g={conversationId:t.conversationId,messageTimestamp:O.getLatestMessageTimestamp(t),messageCreatorName:u,timestamp:Date.now(),category:i,message:s.body,title:s.title,serviceSpecificData:C,id:t.conversationId+t.createdTime,icon:v,priority:r.NotificationPriority.Max,silent:!h,senderId:e,applicationIconBadgeNumber:p};h&&(g.sound=se.default.getSoundPath("Skype_Notification.m4a"));const m=[];let S;return W.printNotificationTrace(g,"default"),m.push(G.default.saveLocalNotification(g,!0)),m.push(r.LocalNotifications.show(g)),o.snoozeUntil&&(A.log(P.LogTraceArea.Notifications,"Suppressing notifications for "+q.mriOrId(t.conversationId)+" until "+o.snoozeUntil),G.default.snoozeConversation(t.conversationId,{createdAt:O.getLatestMessageTimestamp(t),until:o.snoozeUntil})),a.all(m).then((()=>{const e=new F.MessagingToastShowEvent(t,o.notificationType,o.action,!0,false,S);return A.track(e),d===n.PermissionStatus.Granted?P.MessageProcessResult.NotifiedSystemMessage:P.MessageProcessResult.SystemMessagePermissionsUnknown})).catch((e=>(A.warn(P.LogTraceArea.Notifications,"Local notification failure: "+te.default.errorAsString(e)),P.MessageProcessResult.SystemMessageFailure)))}))}))}_createAndroidNotification(e,t,s,o,n){if(!l.default.getS4LMessagingFeaturesNoSubscription().enableAndroidMessagingStyleNotifications||p.isEncryptedThread(e.conv.id)||n===j.MessageNotificationType.Reaction||u.isScheduledCallType(t.messagetype))return a.Resolved(s);const r=e.counts&&e.counts.unreadCount||1,d=re.default.clampValue(r,1,5);return g.default.getMessagesForConversationBeforeTime(e.conv.id,Number.MAX_VALUE,d,!1).then((n=>(n=i.filter(n,(e=>!e.hasAlbumId()||t.isAlbum())))?this._getFormattedMessages(e.conv,n).then((t=>{const i=R.getString("Notifications.MultiMessageTitleSingleConversation",{title:o,count:r});return Object.assign(Object.assign({messages:t,title:i,conversationName:o,conversationTitle:i},s),{isOneOnOne:e.conv.isOneOnOne(),id:e.conv.id})})):a.Resolved(s)))}_getFormattedMessages(e,t){t=i.orderBy(t,(e=>e.createdTime));const s=(0,c.chain)(t,(0,c.map)((e=>e.creator)),(0,c.uniq)()),o=i.map(s,(e=>b.default.getDisplayableProfilePotentiallyBeforeStartupAsync(e).then((t=>({creator:e,userDisplayable:t})))));return a.all(o).then((s=>i.map(t,(t=>{const o=i.find(s,(e=>e.creator===t.creator));return T.formatPreviousMessagePotentiallyBeforeStartup(e,t,null==o?void 0:o.userDisplayable,null==o?void 0:o.creator)}))))}}t.LocalMessageNotificationsService=de,t.default=new de},892350:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(562141),n=s(469382),r=s(626712),a=s(853374);t.default=new class{storeSavedMedia(e,t){const s=this._convertMediaPreviewInfoToDbSkypeMediaDrafts(e,t);return o.default.putMediaDrafts(s)}deleteSavedMedia(e){return o.default.deleteMediaDraft(e)}loadSavedMedia(){return o.default.getAllMediaDrafts().then((e=>e.map(this._convertDbSkypeMediaDraftsToMediaPreviewInfo)))}_convertMediaPreviewInfoToDbSkypeMediaDrafts(e,t){const s=i.filter(t.previews,(e=>this._isSerializableFile(e.data.file)&&(!e.data.thumbnail||this._isSerializableFile(e.data.thumbnail.file))));return{conversationId:e,albumId:t.albumId,previews:s,deletedPreviewsCount:t.deletedPreviewsCount+(t.previews.length-s.length),galleryOpenCount:t.galleryOpenCount,lastAddTimestamp:t.lastAddTimestamp}}_convertDbSkypeMediaDraftsToMediaPreviewInfo(e){const t=i.compact(i.map(e.previews,(e=>{if(n.fileExists({fileUri:r.default.getFileUrl(e.data)})&&(!e.data.thumbnail||n.fileExists({fileUri:r.default.getFileUrl(e.data.thumbnail)})))return e})));return{conversationId:e.conversationId,albumId:e.albumId?e.albumId:a.default.newGuid(),previews:t,deletedPreviewsCount:e.deletedPreviewsCount+(e.previews.length-t.length),galleryOpenCount:e.galleryOpenCount,wasSavedAsDraft:!0,wasRecoveredFromDb:!0,lastAddTimestamp:e.lastAddTimestamp}}_isSerializableFile(e){const t=e;return i.isString(t.uri)}}},714597:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Tests_MediaPrefetchService=t.QueueItem=void 0;const i=s(174958),o=s(496486),n=s(397691),r=s(562141),a=s(606452),l=s(746096),d=s(907234),c=s(436237),h=s(998754),u=s(916724),p=s(914976),g=s(422538),m=s(404057),S=s(782176),f=s(626712),y=s(853374);class v{constructor(){this._pendingItems=[],this._downloadingItems=[],this._callbacks={},g.RegisterStartupable(this,"MediaPrefetchService",[a.default,d.default,h.default])}startup(){a.default.downloadUpdated.subscribe((e=>{if(e.isFinished){const t=y.default.newCauseId();c.log(l.LogTraceArea.MediaPrefetchService,"downloadUpdated, causeId: "+t);const s=o.find(this._downloadingItems,(t=>t.key===e.key));if(s){const i=o.filter(this._downloadingItems,(e=>e.key!==s.key));this._updateDownloadingItem(i);const n=d.default.getLocalUri(s.key);if(n)c.log(l.LogTraceArea.MediaPrefetchService,"Finished "+p.dev_unknownOmit(e.key)+" in "+(Date.now()-s.createdTime)+" causeId: "+t),this._sendTelemetryEvent(s,!0,l.MessagingFailureReason.None,e);else{e.isCached?c.error(l.LogTraceArea.MediaPrefetchService,"Download completed. Local uri missing "+p.dev_unknownOmit(s.key)):c.error(l.LogTraceArea.MediaPrefetchService,"Download failed. "+p.dev_unknownOmit(s.key));const t=e.amsGetStatusTransfer&&e.amsGetStatusTransfer.success,i=e.downloadTransfer&&e.downloadTransfer.success,o=t||i?l.MessagingFailureReason.CacheFailure:l.MessagingFailureReason.AMSFailure;this._sendTelemetryEvent(s,!1,o,e)}o.isEmpty(i)&&this._takeNext(t),n?this._resolve(s.key,{url:n}):this._reject(s.key,"Download failed. Local file missing",!!e.permanentFailureTransferType)}}}));const e=y.default.newCauseId();c.log(l.LogTraceArea.MediaPrefetchService,"startup, causeId: "+e);const t=h.default.getData(r.InternalKeys.PendingMediaPrefetchV1);o.isUndefined(t)||(a.default.cancelDownloadForKey(t,e),h.default.putData(r.InternalKeys.PendingMediaPrefetchV1,void 0));const s=h.default.getData(r.InternalKeys.PendingMediaPrefetch);return o.isEmpty(s)||(o.each(s,(t=>a.default.cancelDownloadForKey(t,e))),h.default.putData(r.InternalKeys.PendingMediaPrefetch,void 0)),n.Resolved()}add(e,t,s=!1){return o.first(this.addAll([e],t,s))}addAll(e,t,s=!1){let i;if(o.some(e,(e=>!e.key))&&(i="MediaPrefetchService empty key"),o.some(e,(e=>!e.url))&&(i="MediaPrefetchService empty url"),o.some(e,(e=>e.expiration<=Date.now()))&&(i="MediaPrefetchService expiration time in the past"),o.some(e,(e=>!f.default.isUrlValid(e.url)))&&(i="MediaPrefetchService invalid url"),i)return c.error(l.LogTraceArea.MediaPrefetchService,m.default.errorAsString(i)),o.map(e,(e=>n.Rejected(i)));const r=o.map(e,(e=>{const t=n.Defer();return this._callbacks[e.key]||(this._callbacks[e.key]=[]),this._callbacks[e.key].push({tag:e.tag,defer:t}),t.promise()}));return s?(this._pauseCurrentDownloadIfExists(t),this._pendingItems.unshift(o.clone(e))):this._pendingItems.push(o.clone(e)),this._takeNext(t),r}remove(e,t){if(!e)return void c.error(l.LogTraceArea.MediaPrefetchService,"Remove empty key");let s=!1;o.each(this._pendingItems,(t=>{const i=o.remove(t,(t=>t.key===e));o.isEmpty(i)&&(s=!0)}));const i=o.filter(this._downloadingItems,(t=>t.key===e));o.isEmpty(i)||(a.default.cancelDownloadForKey(e,t),this._updateDownloadingItem(o.filter(this._downloadingItems,(t=>t.key!==e))),s=!0),s&&(this._resolve(e,{cancelled:!0}),s=!0),d.default.isKnown(e)&&!a.default.isDownloading(e)&&(d.default.remove(e),s=!0),s&&(c.log(l.LogTraceArea.MediaPrefetchService,"Removed item: "+p.dev_unknownOmit(e)+", causeId: "+t),this._takeNext(t))}isQueued(e,t){return!!o.find(o.flatten(this._pendingItems),(s=>(!t||t===s.tag)&&s.key===e))||!!o.some(this._downloadingItems,(t=>t.key===e))&&(!t||o.some(this._downloadingItems,(e=>e.tag===t)))}reset(e){c.log(l.LogTraceArea.MediaPrefetchService,"Resetting, causeId: "+e),this._pendingItems=[];const t=this._callbacks;this._callbacks={},o.each(t,(e=>{o.each(e,(e=>{e.defer.resolve({cancelled:!0})}))})),this._callbacks={},o.isEmpty(this._downloadingItems)||this._cancelDownload(void 0,!1,e)}resetTag(e,t,s){let i=!1;c.log(l.LogTraceArea.MediaPrefetchService,"resetTag("+p.dev_unknownOmit(e)+") causeId: "+s),o.each(this._pendingItems,(s=>{o.remove(s,(s=>s.tag===e&&((!t||s.key===t)&&(this._resolve(s.key,{cancelled:!0},e),i=!0,!0))))})),o.some(this._downloadingItems,(t=>t.tag===e))&&(o.isUndefined(t)||o.some(this._downloadingItems,(e=>e.key===t)))&&(this._cancelDownload(t,!1,s),i=!0),i&&c.log(l.LogTraceArea.MediaPrefetchService,"did reset tag "+p.dev_unknownOmit(e)+", causeId: "+s),this._takeNext(s)}pause(e){c.log(l.LogTraceArea.MediaPrefetchService,"Pause, causeId: "+e),this._paused=!0,this._pauseCurrentDownloadIfExists(e)}resume(e){c.log(l.LogTraceArea.MediaPrefetchService,"Resume, causeId: "+e),this._paused=!1,this._takeNext(e)}isPaused(){return this._paused}_takeNext(e){if(c.log(l.LogTraceArea.MediaPrefetchService,"MediaPrefetchService._takeNext, causeId: "+e),this.isPaused())return void c.log(l.LogTraceArea.MediaPrefetchService,"TakeNext called while service is paused, causeId: "+e);if(!o.isEmpty(this._downloadingItems))return void o.each(this._downloadingItems,(t=>{if(!this._isDownloading(t.key)){const s="MediaPrefetchService has item set as downloading, but DownloadService is not tracking it";c.error(l.LogTraceArea.MediaPrefetchService,s),this._download([t],e)}}));let t;do{t=this._pendingItems.shift()}while(t&&o.isEmpty(t));t&&!o.isEmpty(t)&&this._download(t,e)}_download(e,t){const s=[];o.each(e,(e=>{const i=d.default.getLocalUri(e.key);i?(c.log(l.LogTraceArea.MediaPrefetchService,"Returning cached file for "+p.dev_unknownOmit(e.key)+" causeId: "+t),this._resolve(e.key,{url:i})):(this._isDownloading(e.key)?c.log(l.LogTraceArea.MediaPrefetchService,"Waiting on existing download "+p.dev_unknownOmit(e.key)+" causeId: "+t):(c.log(l.LogTraceArea.MediaPrefetchService,"Starting "+p.dev_unknownOmit(e.key)+" url: "+p.dev_unknownOmit(e.url)+" causeId: "+t),a.default.downloadAmsContentToCache(e.key,e.filename,e.expiration,e.evictionKind,e.evictionRank,e.url,t,3)),s.push(e))})),o.isEmpty(s)&&this._takeNext(t),this._updateDownloadingItem(s)}_updateDownloadingItem(e){const t=o.xorBy(e,this._downloadingItems,(e=>e.key));if(this._downloadingItems=e,!o.isEmpty(t)){const t=o.map(e,(e=>e.key));h.default.putData(r.InternalKeys.PendingMediaPrefetch,o.isEmpty(t)?void 0:t)}}_isDownloading(e){return a.default.isDownloading(e)||d.default.isKnown(e)}_resolve(e,t,s){const i=this._callbacks[e];delete this._callbacks[e],o.each(i,(e=>{(o.isUndefined(s)||e.tag===s)&&e.defer.resolve(t)}))}_reject(e,t,s,i){const n=this._callbacks[e];delete this._callbacks[e],o.each(n,(n=>{(o.isUndefined(i)||n.tag===i)&&n.defer.reject({key:e,message:t,isPermanent:s})}))}_cancelDownload(e,t,s){if(!o.isEmpty(this._downloadingItems)){let i=[],n=this._downloadingItems;o.isUndefined(e)||(i=o.filter(this._downloadingItems,(t=>t.key!==e)),n=o.filter(this._downloadingItems,(t=>t.key===e))),this._updateDownloadingItem(i),o.each(n,(e=>{d.default.isKnown(e.key)||a.default.cancelDownloadForKey(e.key,s),t||this._resolve(e.key,{cancelled:!0})}))}}_pauseCurrentDownloadIfExists(e){c.log(l.LogTraceArea.MediaPrefetchService,"MediaPrefetchService._pauseCurrentDownloadIfExists, causeId: "+e),o.isEmpty(this._downloadingItems)||(this._pendingItems.unshift(o.clone(this._downloadingItems)),this._cancelDownload(void 0,!0,e))}_sendTelemetryEvent(e,t,s,o){const n=new u.FileReceived(i.pii.Omit(e.url),void 0,S.default.extractExtensionForTelemetry(o.filename));n.setDownloadDuration(Date.now()-e.createdTime),n.setSuccess(t,s,o.finishedAttemptsSoFar,o.responseStatusCode),c.track(n)}}t.Tests_MediaPrefetchService=v;t.QueueItem=class{constructor(e,t,s,i,o,n,r){this.key=e,this.url=t,this.filename=s,this.tag=i,this.expiration=o,this.evictionKind=n,this.evictionRank=r,this.createdTime=Date.now()}},t.default=new v},206286:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(671830),r=s(882261),a=s(166923),l=s(746096),d=s(753559),c=s(436237),h=s(381157),u=s(603088),p=s(785207),g=s(415963),m=s(478262),S=s(626712),f=s(853374);t.default=new class{constructor(){this._getPostRequestByUploadType=(e,t,s)=>{const i=s?{albumId:s}:void 0;if(void 0!==t.mediaSelection)return h.default.postMediaSelections(t.mediaSelection,e,l.PostSource.MediaPreview,{scenarioInfo:t.scenario,properties:i},t.captureSessionTelemetry,t.causeId);const o=a.default.determineUploadFileType(t,n.isEncryptedThread(e));if(o===m.UploadFileType.Video){const s={name:g.ScenarioName.SendVideo};return p.default.postVideoWithThumbnail([e],t,l.PostSource.MediaPreview,!1,s,void 0,void 0,i)}if(o===m.UploadFileType.Picture){const s={name:g.ScenarioName.SendPicture};return p.default.postUpload([e],t,l.PostSource.MediaPreview,!1,{scenarioInfo:s,properties:i})}{const s={name:g.ScenarioName.SendFile};return p.default.postUpload([e],t,l.PostSource.MediaPreview,!1,{scenarioInfo:s,toastMessageToShowOnFailure:"CapturePanel.MediaPostedFailed"})}}}sendPreviews(e,t){c.log(l.LogTraceArea.GenericUnsafe,"service sendPreviews causeId: "+t);const s=u.default.getPreviews(e);return s.length?this.sendPreviewsWithData(e,s.map((e=>e.data)),u.default.getAlbumId(e)).then((()=>{c.log(l.LogTraceArea.GenericUnsafe,"media sent causeId: "+t),u.default.markPreviewsSent(e,t)})):o.Resolved()}sendPreviewsWithData(e,t,s){if(!t.length)return o.Resolved();let a,c=0,h=-1;if(!n.isAgent(e)){i.sumBy(t,(e=>this._isMediaFile(e.extension)?1:0))>1&&(a=s||f.default.newGuid(),c=i.reduce(t,((e,t)=>{var s,o,n;if(!t)return e;let r=e;if(this._isMediaFile(t.extension)){const e=t.file;r+=null!==(s=null==e?void 0:e.size)&&void 0!==s?s:0}if(d.default.isVideoExtension(t.extension)){const e=null===(o=t.thumbnail)||void 0===o?void 0:o.file;r+=null!==(n=null==e?void 0:e.size)&&void 0!==n?n:0}return i.isNumber(r)?r:e}),0),t=t.map((e=>Object.assign(Object.assign({},e),{albumTotalSize:c,isAlbumItem:!0}))),h=i.findIndex(t,(e=>this._isMediaFile(e.extension))))}const u=t.map((t=>()=>this._getPostRequestByUploadType(e,t,a)));if(h>=0){const t=h+1;u.splice(t,0,(()=>o.Resolved().then((()=>{if(void 0!==a){const t=r.createMediaAlbumMessage(e,l.PostSource.MediaPreview,a);p.default.postMessage(t)}}))))}return i.reduce(u,((e,t)=>e.then(t)),o.Resolved())}addPreviews(e,t,s){if(i.isEmpty(e)&&!this.isMediaPreviewEnabled(t))return;const o=e.map((e=>Object.assign({data:e,uid:f.default.newGuid(),originator:s},this._getThumbnailForPreview(e))));u.default.addPreviews(o,t)}isMediaPreviewEnabled(e){return e&&!n.isEncryptedThread(e)}_isMediaFile(e){return d.default.isImageExtension(e)||d.default.isVideoExtension(e)}_getThumbnailForPreview(e){return d.default.isVideoExtension(e.extension)&&e.thumbnail?{thumbnailUrl:S.default.getFileUrl(e.thumbnail),videoThumbnailUrl:S.default.getFileUrl(e)}:{thumbnailUrl:S.default.getFileUrl(e)}}}},795133:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(889391),o=s(157924),n=s(154411);t.default=new class{hintShownAndUsed(){this._hintShownAndUsed=!0}getHint(e,t){if(t&&(this._hintType=void 0,this._hintShownAndUsed=!1,this._isOneToOne=e.isOneOnOne(),this._messageHintsPriorityList=i.default.getS4LMessagingFeatures().messageHintsPriority),this._hintShownAndUsed)return;const s=this._getPriorityHintType(this._hintType?this._messageHintsPriorityList.indexOf(this._hintType):void 0);if(s){this._hintType=s;const e=this._getHintType(this._hintType);return e&&!e.wasFeatureUsedByUser?e:this.getNextPriorityHint()}}_getHintType(e){switch(e){case"Reactions":return n.default.getHint(this._isOneToOne);case"BingSearch":return o.default.getHint();default:return}}getNextPriorityHint(){if(this._hintShownAndUsed)return;if(void 0!==this._hintType&&this._messageHintsPriorityList.indexOf(this._hintType)===this._messageHintsPriorityList.length-1)return;const e=this._getPriorityHintType(void 0!==this._hintType?this._messageHintsPriorityList.indexOf(this._hintType)+1:void 0);if(e){this._hintType=e;return this._getHintType(this._hintType)}}_getPriorityHintType(e){return(e?this._messageHintsPriorityList.slice(e,this._messageHintsPriorityList.length):this._messageHintsPriorityList).find((e=>this._isHintTypeEnabled(e)))}_isHintTypeEnabled(e){const t=i.default.getS4LMessagingFeatures();let s=!1;switch(e){case"Reactions":s=!0;break;case"BingSearch":s=t.bingSearchMessageHint.enabled}return s}getMessageToShowHint(e,t){let s;switch(this._hintType){case"Reactions":s=n.default.getMessageToShowHint(this._isOneToOne,e);break;case"BingSearch":s=o.default.getMessageToShowHint(e,t)}return s}updateHintData(e,t,s){let i;switch(this._hintType){case"Reactions":i=n.default.updateHint(e,t,s,this._isOneToOne);break;case"BingSearch":i=o.default.updateHint(e,t,s)}return i}getMessageHintDataToDisplay(){let e;switch(this._hintType){case"Reactions":const t=n.default.getHintObjectType(this._isOneToOne);e=n.default.getMessageHintDataToDisplay(t);break;case"BingSearch":e=o.default.getMessageHintDataToDisplay()}return e}}},51470:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSendPerfRecordStore=void 0;const i=s(496486),o=s(889391),n=s(746096),r=s(436237),a=s(269399);function l(e,t){return t?t-e:-1}class d extends a.PerfEventBase{constructor(e,t,s){super(e,s),this._details=t}getScenarioName(){return"MessageSendToMessageLieRender"}getAttributes(){const e=super.getAttributes(),t=this._details.submittedToPostingServiceTime;return e.SubmittedToPostingServiceDelay=l(t,this._details.submittedToPostingServiceTime),e.ReachedPostingTransferServiceDelay=l(t,this._details.reachedPostingTransferServiceTime),e.LieReachedChatServiceDataServiceDelay=l(t,this._details.lieReachedChatServiceDataServiceTime),e.MessagPickedFromViewStoreIntoViewDelay=l(t,this._details.messagPickedFromViewStoreIntoViewTime),e.MessageLieRenderedDelay=l(t,this._details.messageLieRenderedTime),e}}class c{constructor(){this._perfRecords={}}notifyMessageSubmittedToPostingService(e){o.default.getS4LMessagingFeatures().enableMessageSendE2EPerfTracking&&(this._perfRecords[e]&&r.error(n.LogTraceArea.MessageComposer,"MessageSendPerfRecordStore: Msg for this clientMessageId already notified!"),this._perfRecords[e]={submittedToPostingServiceTime:Date.now()})}notifyMessageReachedPostingTransferService(e){const t=this._perfRecords[e];t&&!t.reachedPostingTransferServiceTime&&(t.reachedPostingTransferServiceTime=Date.now())}notifyMessageLieReachedChatServiceDataService(e){const t=this._perfRecords[e];t&&!t.lieReachedChatServiceDataServiceTime&&(t.lieReachedChatServiceDataServiceTime=Date.now())}notifyMessagePickedFromMessageViewStoreIntoView(e){const t=this._perfRecords[e];t&&!t.messagPickedFromViewStoreIntoViewTime&&(t.messagPickedFromViewStoreIntoViewTime=Date.now())}notifyMessageRendered(e,t){const s=this._perfRecords[e];s&&(s.messageLieRenderedTime=Date.now(),this._finalize(s,e,t))}_finalize(e,t,s){const i=e.submittedToPostingServiceTime;r.track(new d(e.messageLieRenderedTime?e.messageLieRenderedTime-i:void 0,e,s)),delete this._perfRecords[t],this._cleanupStaleRecords()}_cleanupStaleRecords(){const e=Date.now();this._perfRecords=i.omitBy(this._perfRecords,(t=>t.submittedToPostingServiceTime+6e4<e))}}t.MessageSendPerfRecordStore=c,t.default=new c},850513:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(174958),o=s(496486),n=s(889391),r=s(351077),a=s(351077),l=s(539549),d=s(986374),c=s(746096),h=s(805581),u=s(436237),p=s(312762),g=s(152305),m=s(18078),S=s(994214),f="Skype",y="translate";t.default=new class{constructor(){this._endpointUrlOverride=void 0}setEndpointUrlOverride(e){o.isEmpty(e)||(this._endpointUrlOverride=e,u.log(c.LogTraceArea.MessageStream,"MessageTranslatorService.setEndpointUrlOverride: "+i.pii.Omit(e)))}getEndpointUrl(){return this._endpointUrlOverride&&!o.isEmpty(this._endpointUrlOverride)?this._endpointUrlOverride:n.default.getS4LCMCFeatures().messageTranslatorEndpointUrl}clearEndpointUrlOverride(){this._endpointUrlOverride=void 0,u.log(c.LogTraceArea.MessageStream,"MessageTranslatorService.clearEndpointUrlOverride")}maybeRequestTranslation(e,t,s,i){if(!n.default.getS4LCMCFeatures().enableMessageTranslation)return;if(!s&&!i)return;if(s){if(o.isEmpty(s.content))return;if(s.contenttype!==r.ContentTypes.Text)return;if(s.messagetype!==a.MessageTypes.RichText)return}const p=(0,l.default)().getConversation(e);if(!p||!h.default.isConversationTranslated(e))return;const v=p.getMessageTranslationLocale();if(!v||o.isEmpty(v))return void u.log(c.LogTraceArea.MessageStream,"MessageTranslatorService.maybeRequestTranslation: translation locale is undefined");const C=this.getEndpointUrl();if(o.isEmpty(C))return void u.log(c.LogTraceArea.MessageStream,"MessageTranslatorService.maybeRequestTranslation: translator endpoint is undefined");const _=m.default.getSkypeMri();let b=i;s&&(b=d.decode(s,_,e).children);const T=this._getRawText(b);if(!T)return void u.log(c.LogTraceArea.MessageStream,"MessageTranslatorService.maybeRequestTranslation: unable to extract raw text from message");const M={text:T,loc:v,chatThreadId:e,oid:t},I={provider:f,parameters:{token:S.default.getRawSkypeToken(),identity:m.default.getSkypeId()}},w={type:y,auth:I,request:M};g.default.requestTranslation(C,w)}_canTranslateOne(e){return e&&!o.isEmpty(e.content)&&e.messagetype===a.MessageTypes.RichText}requestTranslation(e,t,s){if(!n.default.getS4LCMCFeaturesNoSubscription().enableOneMessageTranslation)return;if(!this._canTranslateOne(s))return;const i=h.default.getLocalCallTranslatorBotSubtitleLanguageLocale();if(!i||o.isEmpty(i))return void u.log(c.LogTraceArea.MessageStream,"MessageTranslatorService.maybeRequestTranslation: translation locale is undefined");const r=this.getEndpointUrl();if(o.isEmpty(r))return void u.log(c.LogTraceArea.MessageStream,"MessageTranslatorService.maybeRequestTranslation: translator endpoint is undefined");const a=m.default.getSkypeMri(),l=d.decode(s,a,e).children,p=this._getRawText(l);if(!p)return void u.log(c.LogTraceArea.MessageStream,"MessageTranslatorService.requestTranslation: unable to extract raw text from message");const v={type:y,auth:{provider:f,parameters:{token:S.default.getRawSkypeToken(),identity:m.default.getSkypeId()}},request:{text:p,loc:i,chatThreadId:e,oid:t}};g.default.requestTranslation(r,v)}_getRawText(e){const t=o.compact(o.map(e,(e=>{const t=e;if(t&&e instanceof p.PlainTextNode)return t.getRawText?t.getRawText():this._getRawText(t.children)})));return o.isEmpty(t)?void 0:t.join(" ")}}},186494:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(889391),r=s(598925),a=s(422801),l=s(476621),d=s(351077),c=s(539549),h=s(882261),u=s(746096),p=s(805581),g=s(436237),m=s(46929),S=s(18078),f=s(785207),y=s(422538);t.default=new class{constructor(){this._onAppConfigChange=()=>{const{enableMessageTranslation:e}=n.default.getS4LCMCFeatures();e&&!this._messagesProcessedToken?this._messagesProcessedToken=l.default.messagesProcessedWithBundleInfo.subscribe(this._messagesProcessed):!e&&this._messagesProcessedToken&&(this._messagesProcessedToken.unsubscribe(),this._messagesProcessedToken=void 0)},this._messagesProcessed=e=>o.all(i.map(i.filter(e,(e=>e.message.isTranslationSettings())),(e=>{if(e.messageAlreadySeen||i.includes(e.details.map((e=>e.origin)),u.MessageOrigin.LocalChange))return o.Resolved();const t=(0,c.default)().getConversation(e.message.conversationId);if(!t)return o.Resolved();const s=t.getConsumptionHorizonTimestamp();if(e.message.createdTime<=s)return o.Resolved();const n=d.getTranslationSettingsMetadata(e.message.content),l=p.default.getConversationTranslationState(e.message.conversationId)||r.TranslationState.Disabled;if(!n)return g.warn(u.LogTraceArea.ChatServiceSubscriptions,"MessageTranslatorSettingsService: translationSettings could not be parsed"),o.Resolved();const h=this._getNextTranslationState(n),f=h!==l,y=e.message.conversationId,v=S.default.isMyMri(e.message.creator);return this._isSettingsMessageValid(n,y,v)?a.default.setMessageTranslationLocale(y,n.messageTranslationLocale).then((()=>(h===r.TranslationState.Disabled&&m.default.deleteTranslationBannerDismissStates(y),f?a.default.setTranslationState(y,h):o.Resolved()))):o.Resolved()}))),this._getNextTranslationState=e=>{const{newTranslationState:t}=e,s=parseInt(r.TranslationState[t],10);return s===r.TranslationState.Cancelled||s===r.TranslationState.Declined?r.TranslationState.Disabled:s||r.TranslationState.Disabled},this._isSettingsMessageValid=(e,t,s)=>{const i=p.default.getConversationTranslationState(t)||r.TranslationState.Disabled,o=this._getNextTranslationState(e),n=o!==i;return g.log(u.LogTraceArea.ChatServiceSubscriptions,"MessageTranslatorSettingsService: currentState - "+i+", nextState - "+o+", ownMessage - "+s),!s&&(!(o===r.TranslationState.Enabled&&!e.messageTranslationLocale||!n&&i===r.TranslationState.Disabled)||(g.warn(u.LogTraceArea.ChatServiceSubscriptions,"MessageTranslatorSettingsService: failed to be Enabled - no messageTranslationLocale"),!1))},this._updateTranslationSettings=()=>{const e=p.default.getLocalCallTranslatorBotSpokenLanguageLocale();return o.all(i.map((0,c.default)().getTranslatedConversations(),(t=>{const s=p.default.getConversationTranslationState(t.id)||r.TranslationState.Disabled;if(s===r.TranslationState.Disabled)return o.Resolved();const i=h.createTranslationSettingsMessage(t.id,u.PostSource.MessagePanel,e||"",s,!0);return i?f.default.postMessage(i):g.log(u.LogTraceArea.ChatServiceSubscriptions,"_updateTranslationSettings failed to update setting for %s",t.id),o.Resolved()})))},y.RegisterStartupable(this,"MessageTranslatorSettingsService",[a.default,m.default])}startup(){return n.default.subscribe(this._onAppConfigChange),this._onAppConfigChange(),this._myUserPreferencesStoreSubscription&&m.default.unsubscribe(this._myUserPreferencesStoreSubscription),this._myUserPreferencesStoreSubscription=m.default.subscribe(this._updateTranslationSettings,m.TriggerKeys.CallTranslatorBotSpokenLanguageLocale),o.Resolved()}test_reset(){this._messagesProcessedToken&&this._messagesProcessedToken.unsubscribe(),this._myUserPreferencesStoreSubscription=void 0,this._messagesProcessedToken=void 0}}},822245:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(269521),o=s(397691),n=s(889391),r=s(898278),a=s(746096),l=s(436237),d=s(18078),c=s(827357),h=s(914976),u=s(666765),p=s(422538),g=s(912770);t.default=new class{constructor(){this._multiTabNotificationsEnabled=!1,p.RegisterStartupable(this,"MultiTabNotificationService",[c.default,u.default])}startup(){return c.default.subscribe((()=>this._refreshActiveConversation("NavigationStateStore"))),n.default.subscribe((()=>{const e=n.default.getS4LMessagingFeatures().browserMultiTabNotifications.enabled;e!==this._multiTabNotificationsEnabled&&(this._multiTabNotificationsEnabled=e,this._refreshActiveConversation("AppConfigStore"))})),this._multiTabNotificationsEnabled=n.default.getS4LMessagingFeatures().browserMultiTabNotifications.enabled,this._refreshActiveConversation("startup"),o.Resolved()}_refreshActiveConversation(e){if(this._activeConversationRefreshTimer&&(g.default.clearTimeout(this._activeConversationRefreshTimer),this._activeConversationRefreshTimer=void 0),this._multiTabNotificationsEnabled){const t=c.default.getActiveConversationId(r.MainRootViewId),s=n.default.getS4LMessagingFeatures().browserMultiTabNotifications;l.log(a.LogTraceArea.Notifications,"Refreshing active conversation to "+h.mriOrId(t)+", reason: "+e),i.LocalNotifications.setActiveConversation(d.default.getSkypeMri(),t,s.activeTabExpirationInterval),this._activeConversationRefreshTimer=g.default.setTimeout((()=>{this._refreshActiveConversation("Timer"),this._activeConversationRefreshTimer=void 0}),s.activeTabRefreshInterval)}}}},960621:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GifPreviewService=t.MojiPreviewService=void 0;const i=s(974634),o=s(70665);class n{constructor(){this._openPesPreviewEvent=new i.default,this._closePesPreviewEvent=new i.default,this._sendPesEvent=new i.default,this.openPesPreview=e=>{this._openedPesPreview&&this.closePesPreview(),this._navDismissalRegistrationHandle=o.register({dismiss:this.closePesPreview}),this._openPesPreviewEvent.fire(e),this._openedPesPreview=e},this.closePesPreview=()=>{this._openedPesPreview&&(this._navDismissalRegistrationHandle&&(o.unregister(this._navDismissalRegistrationHandle),this._navDismissalRegistrationHandle=void 0),this._closePesPreviewEvent.fire(this._openedPesPreview),this._openedPesPreview=void 0)},this.sendPes=e=>{this._sendPesEvent.fire(e)},this.onPesPreviewOpened=e=>this._openPesPreviewEvent.subscribe(e),this.onPesPreviewClosed=e=>this._closePesPreviewEvent.subscribe(e),this.onSend=e=>this._sendPesEvent.subscribe(e)}}t.MojiPreviewService=new n,t.GifPreviewService=new n},617707:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(889391),r=s(481169),a=s(562141),l=s(82433),d=s(732183),c=s(746096),h=s(482666),u=s(443106),p=s(657347),g=s(172685),m=s(436237),S=s(998754),f=s(733754),y=s(572666),v=s(666501),C=s(526424),_=s(696168),b=s(758962),T=s(90025),M=s(422538),I=s(713130),w=s(404057),P=s(853374);var k;!function(e){e[e.MojiEmoticon=0]="MojiEmoticon",e[e.CaptureSticker=1]="CaptureSticker",e[e.ChatSticker=2]="ChatSticker",e[e.Gif=3]="Gif"}(k||(k={}));t.default=new class{constructor(){this._cachedPesConfigs={},this._numberOfFetchesInProgress={[k.MojiEmoticon]:0,[k.CaptureSticker]:0,[k.ChatSticker]:0,[k.Gif]:0},this._inProgressEmoticonInfoFetches={},this._trendingGifGenerationCount=0,this._searchGifGenerationCount=0,this._updateConfig=(e,t,s,n)=>{m.log(c.LogTraceArea.PesService,`_updateConfig: ${k[t]} pesConfigUrl ${e} causeId:${s}`),this._updateFromLocalDB(t,s);const r=this._cachedPesConfigs[t],l=f.getLocale();let d=!(r&&r.url===e&&3===r.configVersion&&l===r.locale);if(t!==k.MojiEmoticon||d||(d=!(r&&r.emoticonsRoot),d&&m.log(c.LogTraceArea.PesService,`_updateConfig: updating pes config for emoticons due to bad emoticons root, configType ${k[t]} pesConfigUrl ${e} causeId:${s}`)),!d&&!n)return m.log(c.LogTraceArea.PesService,`_updateConfig: no need to refetch configType ${k[t]} pesConfigUrl ${e} causeId:${s}`),o.Resolved();if(""===e)return m.warn(c.LogTraceArea.PesService,`_updateConfig: isFetchNeeded: ${d}, forceFetch: ${n}, configType ${k[t]} but pesConfigUrl is empty! causeId:${s}`),o.Resolved();const h=++this._numberOfFetchesInProgress[t],u=Date.now();return this._fetchConfig(e,s).then((n=>{if(m.log(c.LogTraceArea.PesService,`_updateConfig: _fetchConfig ${k[t]} finished, fetchTime: ${Date.now()-u}[ms], causeId:${s}`),h===this._numberOfFetchesInProgress[t]){if(n.response){m.log(c.LogTraceArea.PesService,`_updateConfig: ${k[t]} pesConfigUrl ${e} fetching everything causeId:${s}`);const r=Date.now(),l=this._processConfig(n.response,t);m.log(c.LogTraceArea.PesService,`_updateConfig: _processConfig ${k[t]} finished, processingTime: ${Date.now()-r}[ms], causeId:${s}`);const d={url:e,eTag:n.eTag,configVersion:3,emoticonsRoot:n.response.emoticonsRoot,locale:f.getLocale()};if(t===k.MojiEmoticon){const t=i.filter(l.tabs,(e=>e.tabType===b.TabType.Emoticon)).length,o=i.filter(l.tabs,(e=>e.tabType===b.TabType.Moji)).length;if(0===t||0===o||0===l.emoticons.length||0===l.mojis.length){const i=b.cultureInfo.getPesLocale(f.getLocale());return m.track(new T.EmptyPesConfigurationReceived(i,e,t,o,l.emoticons.length,l.mojis.length)),void m.warn(c.LogTraceArea.PesService,"_updateConfig Received empty mojiEmoticon PES configuration. Using older version from DB. causeId:"+s)}}else if(t===k.CaptureSticker){if(0===i.filter(l.tabs,(e=>e.tabType===b.TabType.CaptureSticker)).length||0===l.stickers.length)return void m.warn(c.LogTraceArea.PesService,"_updateConfig Received empty sticker PES configuration. Using older version from DB. causeId:"+s)}else if(t===k.ChatSticker){if(0===i.filter(l.tabs,(e=>e.tabType===b.TabType.ChatSticker)).length||0===l.chatStickers.length)return void m.warn(c.LogTraceArea.PesService,"_updateConfig Received empty chat sticker PES configuration. Using older version from DB. causeId:"+s)}else if(t===k.Gif){if(0===i.filter(l.tabs,(e=>e.tabType===b.TabType.Gif)).length)return void m.warn(c.LogTraceArea.PesService,"_updateConfig Received empty chat gif PES configuration. Using older version from DB. causeId:"+s)}a.default.openTransaction([a.Stores.InternalData],!0).then((e=>t===k.MojiEmoticon?o.all([S.default.putData(a.InternalKeys.PesTabs,l.tabs,e),S.default.putData(a.InternalKeys.Emoticons,l.emoticons,e),S.default.putData(a.InternalKeys.Mojis,l.mojis,e),S.default.putData(a.InternalKeys.PesConfigInfo,d,e)]).then(i.noop):t===k.CaptureSticker?o.all([S.default.putData(a.InternalKeys.PesStickerInCaptureTabs,l.tabs,e),S.default.putData(a.InternalKeys.StickersInCapture,l.stickers,e),S.default.putData(a.InternalKeys.PesStickerInCaptureConfigInfo,d,e)]).then(i.noop):t===k.ChatSticker?o.all([S.default.putData(a.InternalKeys.PesStickerInChatTabs,l.tabs,e),S.default.putData(a.InternalKeys.StickersInChat,l.chatStickers,e),S.default.putData(a.InternalKeys.PesStickerInChatConfigInfo,d,e)]).then(i.noop):t===k.Gif?o.all([S.default.putData(a.InternalKeys.PesGifTabs,l.tabs,e),S.default.putData(a.InternalKeys.PesGifConfigInfo,d,e)]).then(i.noop):(P.default.switchStatementExhaustiveChecking(t),o.Rejected()))).then(i.noop,(e=>{m.error(c.LogTraceArea.PesService,"Unable to store updated config info: "+w.default.errorAsString(e)+" causeId:"+s)})),this._setConfig(d,t),t===k.MojiEmoticon?(_.default.setEmoticonMojiTabs(l.tabs),this._setEmoticons(l.emoticons),y.default.setMojis(l.mojis)):t===k.CaptureSticker?(_.default.setCaptureStickerTabs(l.tabs),I.default.setCaptureStickers(l.stickers)):t===k.ChatSticker?(_.default.setChatStickerTabs(l.tabs),I.default.setChatStickers(l.chatStickers)):t===k.Gif&&_.default.setGifTabs(l.tabs)}else m.error(c.LogTraceArea.PesService,"_updateConfig returned null configuration causeId:"+s);this._numberOfFetchesInProgress[t]=0}else m.log(c.LogTraceArea.PesService,"_updateConfig Newer update has been scheduled, returning! "+k[t]+" causeId:"+s)})).fail((e=>{m.error(c.LogTraceArea.PesService,"Fetch PES configuration data failed with: "+w.default.errorAsString(e))}))},this._itemTypes={EMOTICON:"emoticon",MOJI:"flik",STICKER:"sticker",TAB:"tab",GIF:"gif"},M.RegisterStartupable(this,"PesService",[g.default,S.default])}startup(){return m.log(c.LogTraceArea.PesService,"Startup"),_.default.setLoadingStatus(_.PesConfigLoadingStatus.Loading),this._queueRefreshConfigFromLocalDB("Startup"),this._queueRefreshConfig("Startup"),n.default.subscribe((()=>{this._queueRefreshConfig("AppConfigUpdate")})),g.default.setRefreshOptions("PesService",{interval:216e5,taskTypeFlags:p.TaskTypeFlags.CpuIntensive|p.TaskTypeFlags.UsesNetworking,callback:()=>(this._queueRefreshConfig("InfoRefresh"),o.Resolved())}),o.Resolved()}refreshConfig(e,t){m.log(c.LogTraceArea.PesService,"refreshConfig causeId:"+e+", forceFetch:"+t),this._refreshConfig(e,t)}_refreshConfigFromLocalDB(e){m.log(c.LogTraceArea.PesService,"_refreshConfigLocalOnly causeId:"+e),this._updateFromLocalDB(k.MojiEmoticon,e),this._updateFromLocalDB(k.CaptureSticker,e),this._updateFromLocalDB(k.ChatSticker,e),n.default.getS4LMessagingFeatures().enablePesGifs&&this._updateFromLocalDB(k.Gif,e)}_refreshConfig(e,t){m.log(c.LogTraceArea.PesService,"_refreshConfig causeId:"+e+", forceFetch:"+t),this._updateConfig(n.default.getPesConfig().pes_config,k.MojiEmoticon,e,t),this._updateConfig(n.default.getPesConfig().sticker_config,k.CaptureSticker,e,t),this._updateConfig(n.default.getPesConfig().sticker_chat_config,k.ChatSticker,e,t),n.default.getS4LMessagingFeatures().enablePesGifs&&this._updateConfig(n.default.getPesConfig().gif_config,k.Gif,e,t)}_queueRefreshConfigFromLocalDB(e){m.log(c.LogTraceArea.PesService,"_queueRefreshConfigFromLocalDB (localDB) causeId:"+e),p.default.queueIdleTask("PesService UpdateConfig (localDB)",p.TaskTypeFlags.CpuIntensive,(()=>this._refreshConfigFromLocalDB(e)))}_queueRefreshConfig(e){m.log(c.LogTraceArea.PesService,"_queueRefreshConfig (network) causeId:"+e),p.default.queueIdleTask("PesService UpdateConfig (network)",p.TaskTypeFlags.CpuIntensive|p.TaskTypeFlags.UsesNetworking,(()=>this._refreshConfig(e)))}_updateFromLocalDB(e,t){if(e in this._cachedPesConfigs)return;m.log(c.LogTraceArea.PesService,`_updateFromLocalDB: ${k[e]} not cached, causeId:${t}`);const s=Date.now(),i=f.getLocale();if(e===k.MojiEmoticon){const e=S.default.getDataExclusive(a.InternalKeys.PesConfigInfo);this._setConfig(e,k.MojiEmoticon);const t=S.default.getDataExclusive(a.InternalKeys.Emoticons),s=S.default.getDataExclusive(a.InternalKeys.PesTabs),o=S.default.getDataExclusive(a.InternalKeys.Mojis);this._setEmoticons(t),_.default.setEmoticonMojiTabs(s),y.default.setMojis(o),e&&s&&t&&o&&e.locale===i||this._setConfig(void 0,k.MojiEmoticon)}if(e===k.CaptureSticker){const e=S.default.getData(a.InternalKeys.PesStickerInCaptureConfigInfo);this._setConfig(e,k.CaptureSticker);const t=S.default.getData(a.InternalKeys.PesStickerInCaptureTabs),s=S.default.getData(a.InternalKeys.StickersInCapture);_.default.setCaptureStickerTabs(t),I.default.setCaptureStickers(s),e&&t&&s||this._setConfig(void 0,k.CaptureSticker)}if(e===k.ChatSticker){const e=S.default.getData(a.InternalKeys.PesStickerInChatConfigInfo);this._setConfig(e,k.ChatSticker);const t=S.default.getData(a.InternalKeys.PesStickerInChatTabs),s=S.default.getData(a.InternalKeys.StickersInChat);_.default.setChatStickerTabs(t),I.default.setChatStickers(s),e&&t&&s&&e.locale===i||this._setConfig(void 0,k.ChatSticker)}if(e===k.Gif){const e=S.default.getData(a.InternalKeys.PesGifConfigInfo);this._setConfig(e,k.Gif);const t=S.default.getData(a.InternalKeys.PesGifTabs);_.default.setGifTabs(t),e&&t&&e.locale===i||this._setConfig(void 0,k.Gif)}m.log(c.LogTraceArea.PesService,`_updateFromLocalDB: ${k[e]}, wasLoadedAndSet: ${e in this._cachedPesConfigs}, fetchTime: ${Date.now()-s}[ms], causeId:${t}`)}_setConfig(e,t){this._cachedPesConfigs[t]=e}_setEmoticons(e){this._cachedPesConfigs[k.MojiEmoticon]&&e&&e.length>0&&(d.setBaseUrl(this._cachedPesConfigs[k.MojiEmoticon].emoticonsRoot),l.default.setEmoticons(e))}_fetchConfig(e,t){m.log(c.LogTraceArea.Pes,"_fetchConfig causeId:"+t);const s=o.Defer(),i=b.cultureInfo.getPesLocale(f.getLocale()),n=e.replace("/default","/"+i),r=i=>{v.default.getPesConfig(i).then((e=>{s.resolve(e)}),(o=>{i===e?s.reject(new Error("No PES configuration service endpoint: "+o)):(m.log(c.LogTraceArea.Pes,"PesService fetch Falling back to language-neutral PES configuration causeId:"+t),r(e))}))};return r(n),s.promise()}_processConfig(e,t){let s=[];const o=[],r=[],a=[],l=[],d=[],h={},u=[];if(e)if(e.items){const p=n.default.getHeaders().CountryCode;if(p||m.error(c.LogTraceArea.PesService,"ECS Config is missing country header!"),i.each(e.items,(e=>{p&&(e.excludedCountries&&i.includes(e.excludedCountries,p)||!i.isEmpty(e.includedCountries)&&!i.includes(e.includedCountries,p))?d.push(e.id):(h[e.id]=e,e.group&&u.push(e))})),!i.isEmpty(d)){i.each(u,(e=>{const t=i.difference(e.group,d);0!==t.length?(t.unshift(e.id),e.group=t):delete e.group}));const t=i.remove(e.packs,(e=>(i.remove(e.items,(e=>i.includes(d,e))),i.isEmpty(e.items)))).map((e=>e.id));e.tabs&&i.remove(e.tabs,(e=>(i.remove(e.sections,(e=>i.includes(t,e.pack))),i.isEmpty(e.sections))))}i.each(h,(s=>{if(s.type===this._itemTypes.EMOTICON){const e=this._emoticonFromMetadata(s);e&&o.push(e)}else if(s.type===this._itemTypes.MOJI){const t=this._mojiFromMetadata(s,e);t&&r.push(t)}else if(s.type===this._itemTypes.STICKER&&t===k.ChatSticker){const t=this._stickerFromMetadata(s,e);t&&l.push(t)}else if(s.type===this._itemTypes.STICKER){const t=this._stickerFromMetadata(s,e);t&&a.push(t)}}));const g=i.keyBy(e.packs,(e=>e.id));s=i.map(e.tabs,(s=>this._tabFromMetadata(s,t,g,h,e)))}else m.error(c.LogTraceArea.PesService,"PES Config missing items property!"),_.default.setLoadingStatus(_.PesConfigLoadingStatus.Error);else m.error(c.LogTraceArea.PesService,"Null configuration passed to _processConfig!"),_.default.setLoadingStatus(_.PesConfigLoadingStatus.Error);return{tabs:s,emoticons:o,mojis:r,stickers:a,chatStickers:l,gifs:[]}}triggerEmoticonInfoFetch(e){if(this._inProgressEmoticonInfoFetches[e]||l.default.getEmoticonByNameNoSubscription(e))return;this._inProgressEmoticonInfoFetches[e]=!0,m.log(c.LogTraceArea.Pes,"Trigger Emoticon metadata fetch Name: "+e);const t=t=>{if(t){const s=this._emoticonFromMetadata(t);s?l.default.setEmoticon(s):m.warn(c.LogTraceArea.Pes,"Emoticon not found in metadata. Name: "+e)}else m.warn(c.LogTraceArea.Pes,"Emoticon metadata not found. Looking for Name: "+e)};return o.Resolved().thenAsync((()=>{v.default.getEmoticonMetadata(this._uriFromEmoticonId(e,f.getLocale())).then(t).catch((s=>404===s.statusCode?(m.warn(c.LogTraceArea.Pes,"Emoticon metadata falling back to default. Name: "+e),v.default.getEmoticonMetadata(this._uriFromEmoticonId(e,"default")).then(t).fail((t=>{m.warn(c.LogTraceArea.Pes,"Emoticon metadata fallback fetch failed. Name: "+e+", status: "+t.statusCode)}))):void m.warn(c.LogTraceArea.Pes,"Emoticon metadata fetch failed. Name: "+e+", status: "+s.statusCode))).always((()=>{delete this._inProgressEmoticonInfoFetches[e]}))}))}getCurrentCachedPesLocal(){return this._cachedPesConfigs[k.MojiEmoticon]?this._cachedPesConfigs[k.MojiEmoticon]&&this._cachedPesConfigs[k.MojiEmoticon].locale:void 0}getGifsForCategory(e,t,s){_.default.setGifItems([],e,!0);return(s?this._searchGifs(s,t):this._getTrendingGifs(t)).then(((t=C.EmptyGifResult)=>{const s=this._getGifIds(t.gifItems);return _.default.setGifItems(s,e,!1),u.default.setCategoryGifs(t),t})).fail((()=>{_.default.setGifItems([],e,!1),u.default.setCategoryGifs(C.EmptyGifResult)}))}getGifsForSearchTerm(e,t,s){return this._searchGifs(e,t,s).then(((t=C.EmptyGifResult)=>(u.default.setSearchGifs(t,e),t))).fail((()=>{u.default.setSearchGifs(C.EmptyGifResult,e)}))}_getTrendingGifs(e){this._trendingGifGenerationCount++;const t=this._trendingGifGenerationCount;return this._cancelRequestInProgress(),this._gifPromise=h.default.getTrendingGifs(e).then((e=>t===this._trendingGifGenerationCount&&e?e:C.EmptyGifResult)).finally((()=>{this._gifPromise=void 0})),this._gifPromise}_searchGifs(e,t,s){this._searchGifGenerationCount++;const i=this._searchGifGenerationCount,n=u.default.getSearchParams();return e===n.searchQuery&&t===n.limitCount&&s===n.offset?this._gifPromise||o.Resolved():(this._cancelRequestInProgress(),u.default.setSearchParams(e,t,s),u.default.setSearchingFlag(!0),this._gifPromise=h.default.searchGifs(e,t,s).then((e=>(u.default.setSearchingFlag(!1),i===this._searchGifGenerationCount&&e?e:C.EmptyGifResult))).finally((()=>{u.default.setSearchingFlag(!1),this._gifPromise=void 0})),this._gifPromise)}_getGifIds(e){return i.map(e,(e=>e.id))}_cancelRequestInProgress(){this._gifPromise&&(this._gifPromise.cancel(),this._gifPromise=void 0)}_stickerFromMetadata(e,t){if(e.type===b.mediaTypes.sticker)return{id:e.id,etag:e.etag,baseUrl:t.itemsRoot+"/"+e.id,auxiliaryUrl:e.auxiliaryUrl,auxiliaryText:e.auxiliaryText,description:e.description,copyright:e.copyright,title:e.title,name:e.name};m.log(c.LogTraceArea.PesService,"Unexpected sticker type")}_emoticonFromMetadata(e){if(!e)return;if(e.type!==b.mediaTypes.emoticon)return void m.warn(c.LogTraceArea.PesService,"Unexpected emoticon type: "+e.type);const t=e.media.default;return{id:e.id,etag:e.etag,visible:e.visible,firstFrame:t.firstFrame||0,frameCount:t.framesCount,description:e.description,diverse:e.diverse,utf:e.utf,group:e.group,shortcuts:i.uniq(i.map(e.shortcuts,(e=>e.length>=2&&"("===e[0]&&")"===e[e.length-1]?e.toLowerCase():e))),keywords:i.compact(e.keywords).map((e=>e.toLowerCase()))}}_uriFromEmoticonId(e,t){return(this._cachedPesConfigs[k.MojiEmoticon]?this._cachedPesConfigs[k.MojiEmoticon].emoticonsRoot:n.default.getConfigSettingsNoSubscription().pes.emoticonBaseUrl)+"/"+encodeURIComponent(e)+"/views/meta."+t}_mojiFromMetadata(e,t){if(e.type===b.mediaTypes.moji)return{id:e.id,etag:e.etag,baseUrl:t.itemsRoot+"/"+e.id,auxiliaryUrl:e.auxiliaryUrl,auxiliaryText:e.auxiliaryText,description:e.description,copyright:e.copyright,pickerTitle:e.pickerTitle,keywords:i.compact(e.keywords).map((e=>e.toLowerCase()))};m.warn(c.LogTraceArea.PesService,"Unexpected moji type: "+e.type)}_packFromMetadata(e){if(e&&e.title)return{id:e.id,title:e.title,description:e.description,copyright:e.copyright,items:e.items}}_tabFromMetadata(e,t,s,o,n){let a=(0,r.chain)(e.sections,(0,r.map)((e=>this._packFromMetadata(s[e.pack]))),(0,r.compact)()),l=b.TabType.Emoticon;const d=i.head(a);let c;if(d){const e=i.head(d.items);e&&o[e]&&(o[e].type===b.mediaTypes.sticker&&t===k.ChatSticker?l=b.TabType.ChatSticker:t===k.Gif?(l=b.TabType.Gif,c=o[e].searchTerm,a=this._clearItemsFromPacks(a)):l=b.mediaTypesToTabType[o[e].type])}return{id:e.id,tabType:l,iconUrlOrAssetID:n.tabsRoot+"/"+e.id+"/views/thumbnail",packs:a,title:e.title,description:e.description,copyright:e.copyright,glyphBgColor:e.glyphBgColor,searchTerm:c}}_clearItemsFromPacks(e){return i.map(e,(e=>Object.assign(Object.assign({},e),{items:[]})))}}},863986:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_PicturePrefetchService=void 0;const i=s(174958),o=s(496486),n=s(398861),r=s(397691),a=s(889391),l=s(251577),d=s(476621),c=s(746096),h=s(907234),u=s(657347),p=s(436237),g=s(916724),m=s(714597),S=s(945983),f=s(764387),y=s(178735),v=s(126584),C=s(882167),_=s(17791),b=s(422538),T=s(404057),M=s(782176),I=s(626712),w=s(853374);class P{constructor(){this._entries=[],this._processingScheduled=!1,b.RegisterStartupable(this,"PicturePrefetchService",[m.default,C.default,d.default,_.default])}startup(){return this._startupTime=Date.now(),d.default.messagesProcessed.subscribe((e=>{this._processMessages(e)})),_.default.subscribe((()=>{this._processNextEntry()})),r.Resolved()}_processMessages(e){this._isPrefetchEnabled()&&(p.log(c.LogTraceArea.PicturePrefetchService,"Process messages"),o.each(e,(e=>{this._processMessage(e)})),this._processNextEntry())}_processMessage(e){if((this._startupTime-e.createdTime)/1e3>a.default.getS4LCMCFeatures().picturePrefetch.maxTimeIntervalPriorToStartupSec)return;const t=f.default.getMediaDescriptorForItem(e);if(t&&t.mediaType===S.MediaViewerTypes.Picture){const s=t;if(s.downloadFileName&&s.displayResolutionUrl&&s.thumbnailUrl&&I.default.isUrlValid(s.displayResolutionUrl)){const t={createdTime:e.createdTime,cacheId:(0,l.getCacheKeyFullResOrDisplayable)(e),descriptor:s};this._shouldAddEntry(t)&&this._addEntry(t)}}}_shouldAddEntry(e){if(o.some(this._entries,{cacheId:e.cacheId}))return!1;if(h.default.isLocalCacheSupported()){if(m.default.isQueued(e.cacheId))return!1}else{const t=e.descriptor.displayResolutionUrl;if(t&&C.default.isImagePrefetched(t,!1,!1))return!1}return!0}_addEntry(e){p.log(c.LogTraceArea.PicturePrefetchService,"Add entry to prefetch queue: "+i.pii.Omit(e.descriptor.downloadFileName||"")),this._entries.splice(o.sortedIndexBy(this._entries,e,"createdTime"),0,e);const t=a.default.getS4LCMCFeatures().picturePrefetch.maxQueuedEntriesCount;this._entries.length>t&&(p.log(c.LogTraceArea.PicturePrefetchService,"Trimming prefetch queue to "+t+" entries"),this._entries.splice(0,this._entries.length-t),p.track(new v.PicturePrefetchEvent(v.PicturePrefetchAction.PrefetchQueueTrimmed)))}_processNextEntry(){!this._processingScheduled&&this._canPrefetchNow()&&0!==this._entries.length&&(this._processingScheduled=!0,u.default.queueIdleTask("PicturePrefetchService",u.TaskTypeFlags.UsesNetworking,(()=>{if(this._entries.length>0&&this._canPrefetchNow()){const e=this._entries.pop();if(e&&e.descriptor.displayResolutionUrl&&e.descriptor.downloadFileName){const t=new g.FileReceived(i.pii.Omit(e.descriptor.displayResolutionUrl),e.descriptor.originalSizeInBytes,M.default.extractExtensionForTelemetry(e.descriptor.downloadFileName));let s;if(t.setMediaProfile(M.default.currentMediaProfile()),t.setIntent(c.MediaDownloadIntent.Prefetch),t.startDownload(),e.descriptor.thumbnailUrl&&C.default.prefetch(e.descriptor.thumbnailUrl),h.default.isLocalCacheSupported()){const t=1e3*a.default.getS4LCMCFeatures().picturePrefetchCacheExpiryTimeSec,i=Date.now()+t,o=new m.QueueItem(e.cacheId,e.descriptor.displayResolutionUrl,e.descriptor.downloadFileName,"PicturePrefetch",i,h.CacheEvictionKind.Preview,Date.now()),n=w.default.newCauseId();p.log(c.LogTraceArea.PicturePrefetchService,"Process next entry, causeId: "+n),s=m.default.add(o,n)}else s=C.default.prefetch(e.descriptor.displayResolutionUrl);s.then((()=>{p.log(c.LogTraceArea.PicturePrefetchService,"Image prefetch completed: "+i.pii.Omit(e.descriptor.downloadFileName||"")),t.endDownload(),t.setSuccess(!0,c.MessagingFailureReason.None),p.track(t)})).catch((e=>{p.warn(c.LogTraceArea.PicturePrefetchService,"Image prefetch failed: "+T.default.errorAsString(e)),t.endDownload(),t.setSuccess(!1,c.MessagingFailureReason.AMSFailure),p.track(t)})).finally((()=>{this._processingScheduled=!1,this._processNextEntry()}))}else this._processingScheduled=!1,this._processNextEntry()}else this._processingScheduled=!1}),u.Priority.Low))}_canPrefetchNow(){const e=this._picturePrefetchStatus(),t=_.default.getNetworkType()===n.DeviceNetworkType.Wifi;return"On"===e||"Wifi"===e&&t||"Off"!==e}_isPrefetchEnabled(){return"Off"!==this._picturePrefetchStatus()}_picturePrefetchStatus(){return y.default.getUserPreferencesLocal().picturePrefetchMode||a.default.getS4LCMCFeatures().picturePrefetch.status}test_processMessage(e){this._processMessage(e)}test_processMessages(e){this._processMessages(e)}test_entries(){return this._entries}test_setStartupTime(e){this._startupTime=e}}t.Test_PicturePrefetchService=P,t.default=new P},785207:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PostMessageScenarioStep=void 0;const i=s(496486),o=s(421832),n=s(978536),r=s(267728),a=s(397691),l=s(889391),d=s(476621),c=s(351077),h=s(671830),u=s(882261),p=s(166923),g=s(746096),m=s(84457),S=s(753559),f=s(653700),y=s(497174),v=s(436237),C=s(733754),_=s(624606);Object.defineProperty(t,"PostMessageScenarioStep",{enumerable:!0,get:function(){return _.PostMessageScenarioStep}});const b=s(680457),T=s(862817),M=s(843898),I=s(415963),w=s(422538),P=s(640363),k=s(478262),A=g.LogTraceArea.PostingService;t.default=new class{constructor(){this.postCreated=M.default.postCreated,this.postUpdated=M.default.postUpdated,this.transferFinished=M.default.transferFinished,this.allPostsFinished=M.default.allPostsFinished,this.foregroundUploadProgress=_.foregroundUploadProgress,this.serverTranscodingProgress=_.serverTranscodingProgress,w.RegisterStartupable(this,"PostingService",[p.default,f.default,M.default])}startup(){return a.Resolved()}setDiagnosticCallInfoCallbacks(e){this._diagnosticCallInfo=e}setDiagnosticDevicesInfoCallbacks(e){this._diagnosticDevicesInfo=e}postFeedbackStringThenAttachments(e,t,s,n,a,d,c){const S=r.default.requestMaxTime("posting:feedback"),f=w.EnsureStarted(this);m.default.startNewSession(),v.track(new T.FeedbackInititated),this._getLogCount(t,s).then((r=>{const S=h.sanitizeMri(l.default.getConfigSettingsNoSubscription().feedbackBot.id,h.Namespaces.Bot),v=P.default.getIOSModel()===g.IOSModel.iPad?"iPad":P.default.getPlatformTypeName(),_=P.default.getSkypePlatformId().toString(),b=P.default.getAppShellTypeName(),T=P.default.getAppVersion(),w=[];w.push(new y.UnhandledEntity("Sending feedback details..."));let k={};k={Platform:v+" - "+b,PlatformID:_,AppVersion:T,Attachments:r,OS:P.default.getOSVersion(),Device:P.default.getSystemModel(),ClientLanguage:C.getLocale(),BrbEnabled:l.default.getDebugabilitySquad().brb_enabled},a&&(k.Tags=a.toString());const A=o.default.getVersion();if(k.CallingVersion=A.build,k.OvbRevision=A.ovb,this._diagnosticCallInfo){const e=this._diagnosticCallInfo.getOngoingCallId();e&&(k.OngoingCallID=e);const t=this._diagnosticCallInfo.getLastCallId();t&&(k.LastCallID=t);const s=this._diagnosticCallInfo.getParticipantId(e||t);s&&(k.ParticipantId=s)}if(this._diagnosticDevicesInfo){const e=[{name:"Speakers",selectedDeviceId:e=>e.speaker,callback:e=>e.getSpeakers()},{name:"Microphones",selectedDeviceId:e=>e.microphone,callback:e=>e.getMicrophones()},{name:"Cameras",selectedDeviceId:e=>e.camera,callback:e=>e.getCameras()}],t=this._diagnosticDevicesInfo,s=this._diagnosticDevicesInfo.getSelectedDevices();i.each(e,(e=>{const o=e.callback(t),n=e.selectedDeviceId(s);k[e.name]=i.isEmpty(o)?"None":i.map(o,(e=>`${e.label}${e.id===n?" (selected)":""}`)).join(", ")}))}const x=m.default.getCurrentSessionId();x&&(k.feedbackId=x);const R=P.default.getSystemManufacturer();R&&(k.Manufacturer=R),d&&(k.Title=l.default.getConfigSettings().brb.extendReportTitle,k.ReportId=d),n&&(k.Title=(k.Title||"")+n.replace(/\n/g," ").replace(/"/g,"“")),c&&(k.ReportCategory=c),w.push(new y.ContextEntity(k));const O=u.createMessageInfo(S,g.PostSource.FeedbackString,w);return f.then((()=>p.default.createMessageInfo(O,{shouldSendLogs:t,shouldSendScreenshot:s,screenshotUri:e}).then((e=>{M.default.startPost(e,{name:I.ScenarioName.SendTextMessage})}))))})).finally((()=>{S.then((e=>r.default.release(e,"posting:feedback")))}))}_getLogCount(e,t){return(e||t)&&n.default.supportsLogs()?n.default.allRecentLogFileUris(l.default.getDebugabilitySquad().brb_logs_history_secs).then((e=>e&&e.length?1:0)):a.Resolved(0)}postMessageFromInput(e,t,s,i=c.MessageTypes.RichText,o,n,r){const a=u.createMessageInfo(e,t,s,i,n);this.postMessage(a,void 0,o,r)}postMessage(e,t,s,i,o){const n=r.default.requestMaxTime("posting:message");w.EnsureStarted(this).then((()=>p.default.createMessageInfo(e,{showLocalNotificationOnFailure:t}).then((e=>{M.default.startPost(e,s,i,o)})))).finally((()=>{n.then((e=>r.default.release(e,"posting:message")))}))}editMessageFromInput(e,t,s){this.postMessage(u.createEditMessageInfo(e,t,s))}deleteMessage(e,t){this.postMessage(u.createDeleteMessageInfo(e,t))}postVideoWithThumbnail(e,t,s,i,o,n,a,l,d){const c=r.default.requestMaxTime("posting:video+thumb"),h=w.EnsureStarted(this),u={isRecorded:i,copyThumbnail:!0,copyUploadMedia:n,shouldTrackUpload:!0,overlayUrl:a,properties:l};return h.then((()=>p.default.createUploadInfo(e,t,s,u).then((e=>(M.default.startPost(e,o,d),this._correlationMessageInfo(e))),(()=>[])))).finally((()=>{c.then((e=>r.default.release(e,"posting:video+thumb")))}))}postUploadAndShowFeedbackToast(e,t,s,o=!1,n,a="CapturePanel.MediaPostedFailed",l,d){const c=r.default.requestMaxTime("posting:upload+toast"),h=w.EnsureStarted(this),u=t.extension.length?t.extension:i.last(t.file.name.split(".")),g={isRecorded:o,callId:n,toastMessageToShowOnFailure:a,properties:d,shouldTrackUpload:!i.isUndefined(u)&&S.default.isImageExtension(u)};return h.then((()=>p.default.createUploadInfo(e,t,s,g).then((e=>(M.default.startPost(e,l),this._correlationMessageInfo(e))),(()=>[])))).finally((()=>{c.then((e=>r.default.release(e,"posting:upload+toast")))}))}postUpload(e,t,s,o=!1,n={},a,l){const d=r.default.requestMaxTime("posting:upload"),c=w.EnsureStarted(this),h=t.extension.length?t.extension:i.last(t.file.name.split(".")),u={isRecorded:o,callId:n.callId,properties:n.properties,shouldTrackUpload:!i.isUndefined(h)&&S.default.isImageExtension(h),durationMs:i.isNil(l)?void 0:l.messageDurationMs,toastMessageToShowOnFailure:n.toastMessageToShowOnFailure};return c.then((()=>p.default.createUploadInfo(e,t,s,u).then((e=>(M.default.startPost(e,n.scenarioInfo,a,l),this._correlationMessageInfo(e))),(()=>[])))).finally((()=>{d.then((e=>r.default.release(e,"posting:upload")))}))}_correlationMessageInfo(e){return i.map(e.conversationIds,(t=>({clientMessageId:e.messagesForPosting[t].clientmessageid,conversationId:t})))}canRetry(e){return!!e&&(e.kind!==b.PostUploadInfoKind||(!w.HasStarted(f.default)||i.every([e.amsFullDataCacheInfo,e.amsThumbnailCacheInfo],(e=>!e||f.default.isKnown(e.name)))))}retry(e,t){let s;if(v.log(A,"Retry "+e.kind),e.kind===b.PostUploadInfoKind){s={name:I.ScenarioName.SendFile,failedAmsDocumentId:t};const o=i.first(e.amsUploads);o&&(o.amsUploadFileType===k.UploadFileType.Video||o.amsUploadFileType===k.UploadFileType.VideoMessage?s.name=I.ScenarioName.SendVideo:o.amsUploadFileType===k.UploadFileType.Picture&&(s.name=I.ScenarioName.SendPicture))}w.EnsureStarted(this).then((()=>M.default.startPost(e,s)))}cancelFailedPost(e){const t=e.getSendRetryInfo();if(t&&t.kind===b.PostUploadInfoKind&&w.EnsureStarted(f.default).then((()=>{t.amsFullDataCacheInfo&&f.default.abandon(t.amsFullDataCacheInfo.name),t.amsThumbnailCacheInfo&&f.default.abandon(t.amsThumbnailCacheInfo.name)})),e.isEdited()){const t=e.getSendRejectedCMID();t?d.default.revertMessageLie(e.conversationId,e.cuid,t):v.warn(g.LogTraceArea.PostingService,"Tried to revert a failed message that did not fail?",e.cuid)}else{const t=u.createDeleteMessageInfo(e,g.PostSource.CancelFailedPost),s=Object.assign(Object.assign({},t.messageForPosting),{version:e.getLatestServerMessageVersion()});d.default.applyMessageLie(e.conversationId,s)}}getPostByLocalUrl(e){return M.default.getPostByLocalUrl(e)}getLocalUrlsForPost(e){return M.default.getLocalUrlsForPost(e)}debug_allPosts(){return M.default.debug_allPosts()}debug_allPostsCleaningUp(){return M.default.debug_allPostsCleaningUp()}debug_allPostsFailedRetryInfo(){return M.default.debug_allPostsFailedRetryInfo()}test_resetBackoff(){M.default.test_resetBackoff()}test_cancelPost(e){return M.default.test_cancelPost(e)}cancelPostMessage(e,t){return M.default.cancelPostMessage(e,t)}}},239188:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(266737),r=s(717135),a=s(422801),l=s(671830),d=s(166923),c=s(746096),h=s(436237),u=s(785207),p=s(862817),g=s(422538);t.default=new class{constructor(){this._failedTransfers={},g.RegisterStartupable(this,"PostingTelemetryService",[u.default])}startup(){return u.default.transferFinished.subscribe(((e,t,s,o,r,a,d)=>{const u=this._getTransferId(e,t,a),g=this._getErrorMetadata(t,o,r),m=e.instrumentation_postSource,S=e.instrumentation_conversationOrigin,f=a?l.getMriTypeForTelemetry(a):void 0,y=this._getIsConversationAcceptedMetadata(t,e,a);if(y&&i.extend(g,y),s.success){const i=this._failedTransfers[u];if(i){const o=new p.PostingRecovered(t,e.conversationIds,m,S,e.postTime,s.finishedAttemptsSoFarCount,i.response.statusCode,i.response.statusText,d,g,e.originalUploadFileType,n.default.getPostingTrigger());h.track(o),delete this._failedTransfers[u]}}else{h.warn(c.LogTraceArea.PostingService,"Posting failure: "+e.id+", permanent: "+s.permanentFailure+" source: "+c.PostingTransferSource[t]+", status code: "+o.statusCode+", metadata: "+JSON.stringify(g));const i=new p.PostingFailure(s.permanentFailure,t,e.conversationIds,m,S,e.postTime,s.finishedAttemptsSoFarCount,o.statusCode,o.statusText,d,g,e.originalUploadFileType,n.default.getPostingTrigger(),f);h.track(i),s.permanentFailure||(this._failedTransfers[u]={transferInfo:s,response:o})}})),o.Resolved()}_getErrorMetadata(e,t,s){switch(e){case c.PostingTransferSource.ChatService:const e=a.default.getChatServiceErrorResponseMetadata(t);return{error_code:e.errorCode,error_message:e.errorMessage,context_id:e.contextId,date:e.date};case c.PostingTransferSource.AMSCreate:case c.PostingTransferSource.AMSForward:case c.PostingTransferSource.AMSGetStatus:case c.PostingTransferSource.AMSUploadContent:case c.PostingTransferSource.AMSUploadThumbnail:case c.PostingTransferSource.URLPreview:if(!s)return;const i=r.ASMClient.getTracingHeaders(s);return{requestId:i.requestId,correlationId:i.correlationId,transactionId:i.transactionId};default:return}}_getIsConversationAcceptedMetadata(e,t,s){if(e===c.PostingTransferSource.ChatService){const e=t.conversationAcceptedInfos&&t.conversationAcceptedInfos[s],i=d.default.getConversationAcceptedInfo(s);return{conv_accepted_before:""+(e&&(e.hasConvInMemory?e.isAccepted:void 0)),conv_accepted_now:""+(i.hasConvInMemory?i.isAccepted:void 0),conv_syncing_before:""+(e&&e.isSyncingConv),conv_syncing_now:""+i.isSyncingConv,has_all_messages_before:""+(e&&e.hasAllMessages),has_all_messages_now:""+i.hasAllMessages}}}_getTransferId(e,t,s){let i=e.id+"_"+c.PostingTransferSource[t];return s&&(i+="_"+s),i}}},154411:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(584876),n=s(733754),r=s(788952),a=s(46929),l=s(18078),d=s(711828),c=s(889391);class h extends o.HintsProvider{constructor(){super(...arguments),this._getMessageStringToLocalize=e=>e===r.MessageHintsTypes.TapOnReactionToReactTheSame?"MessageStream.ClickToReactTheSame":e===r.MessageHintsTypes.DoubleTapMessageToLike?"MessageStream.DoubleTapMessageToLike":void 0,this._getMessageHintIcon=e=>e===r.MessageHintsTypes.TapOnReactionToReactTheSame?d.SkypeIcon.Click:e===r.MessageHintsTypes.DoubleTapMessageToLike?"yes":void 0}getHint(e){const t=this.getHintObjectType(e);if(t!==r.MessageHintsTypes.DoubleTapMessageToLike)return a.default.getMessageHintsUserData(t)}getMessageToShowHint(e,t){if(this.getHintObjectType(e)===r.MessageHintsTypes.DoubleTapMessageToLike)return;const s=this._getMessageToShowHint(e,t);return s||void 0}_getMessageToShowHint(e,t){const s=this.getHintObjectType(e),o=l.default.getSkypeMri(),n=t.getItemList().filter((e=>e instanceof r.MessageViewItemInfo&&!l.default.isMyMri(e.skypeMessage.creator)&&"Event/Call"!==e.skypeMessage.messagetype&&!e.skypeMessage.hasUserReactedOnMessage(o)));return s===r.MessageHintsTypes.DoubleTapMessageToLike?i.last(n):i.findLast(n,(e=>e.skypeMessage.hasReactions()))}updateHint(e,t,s,i){const o=c.default.getS4LMessagingFeatures().messageReactionsHintsMaxShownTimes,n=this.getHintObjectType(i),r=this._updateHintDataForMessage(e,null==s?void 0:s.skypeMessage.cuid,t,o);return t.hintMessageId!==r.hintMessageId&&a.default.setMessagesHintData(n,r),r}_updateHintDataForMessage(e,t,s,i){if(s.wasFeatureUsedByUser)return s;const o=Date.now(),n=Object.assign({},s);void 0!==n.hintMessageId&&void 0!==n.hintConversationId||(n.hintMessageId=t,n.hintConversationId=e,n.hintLastShownTime=o);const r=o-(void 0!==n.hintLastShownTime?n.hintLastShownTime:o)>864e5;return n.hintWasShownTimes>=i?(n.wasFeatureUsedByUser=!0,n):(r&&(n.hintMessageId=t,n.hintConversationId=e,n.hintLastShownTime=o,n.hintWasShownTimes++),n)}getMessageHintDataToDisplay(e){if(e===r.MessageHintsTypes.DoubleTapMessageToLike)return;const t=e&&this._getMessageStringToLocalize(e);if(e&&t){return{icon:this._getMessageHintIcon(e),hintMessage:n.getString(t)}}}getHintObjectType(e){return e?r.MessageHintsTypes.DoubleTapMessageToLike:r.MessageHintsTypes.TapOnReactionToReactTheSame}}t.default=new h},451481:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(397691),o=s(889391),n=s(890239),r=s(562141),a=s(898278),l=s(746096),d=s(436237),c=s(998754),h=s(901246),u=s(46929),p=s(388273),g=s(104735),m=s(827357),S=s(422538);t.default=new class{constructor(){this._isOptingIn=!1,this._appConfigChanged=()=>{const e=o.default.getS4LMessagingFeatures().enableReadReceipts;this._readReceiptsPreviouslyEnabled!==e&&(this._readReceiptsPreviouslyEnabled=e,this._shouldOptInForReadReceipts()?(d.log(l.LogTraceArea.ReadReceipts,"[AppConfigChanged]We should opt in based on local data. Refresh user props and check again"),this._isOptingIn=!0,u.default.fetchAndUpdateProperties(!0).always((()=>{const e=this._shouldOptInForReadReceipts();if(d.log(l.LogTraceArea.ReadReceipts,"[AppConfigChanged]User props refreshed, shouldOptIn="+e),e){const e=p.default.getStatus()!==n.UserStatus.Hidden;u.default.setReadReceiptsEnabled(e,h.ReadReceiptsSettingOrigin.OptIn)}this._isOptingIn=!1}))):this._shouldOptOutFromReadReceipts()?(d.log(l.LogTraceArea.ReadReceipts,"[AppConfigChanged]We should opt out based on local data. Refresh user props and check again"),u.default.fetchAndUpdateProperties(!0).always((()=>{const e=this._shouldOptOutFromReadReceipts();d.log(l.LogTraceArea.ReadReceipts,"[AppConfigChanged]User props refreshed, shouldOptOut="+e),e&&(u.default.setReadReceiptsEnabled(!1,h.ReadReceiptsSettingOrigin.OptOut),this._fetchMemberConsumptionHorizon())}))):d.log(l.LogTraceArea.ReadReceipts,"[AppConfigChanged]No opt in or opt out needed"))},this._userPresenceChanged=()=>{if(this._isOptingIn||!o.default.getS4LMessagingFeatures().enableReadReceipts||!u.default.getUserPreferenceForReadReceipts())return void d.log(l.LogTraceArea.ReadReceipts,"[UserPresenceChanged]Bailing out, isOptingIn="+this._isOptingIn+";ecsEnableReadReceipts"+o.default.getS4LMessagingFeatures().enableReadReceipts+";userPreferenceForReadReceipts="+u.default.getUserPreferenceForReadReceipts());const e=p.default.getStatus()===n.UserStatus.Hidden,t=u.default.getReadReceiptsEnabled();e&&t?(u.default.setReadReceiptsEnabled(!1,h.ReadReceiptsSettingOrigin.UserStatusUpdate),this._fetchMemberConsumptionHorizon()):e||t||u.default.setReadReceiptsEnabled(!0,h.ReadReceiptsSettingOrigin.UserStatusUpdate)},S.RegisterStartupable(this,"ReadReceiptsStateService",[c.default,u.default,p.default,m.default])}startup(){const e=c.default.getData(r.InternalKeys.EcsConfig);return e&&e.config&&e.config.S4L_Messaging&&(this._readReceiptsPreviouslyEnabled=e.config.S4L_Messaging.enableReadReceipts),o.default.subscribe(this._appConfigChanged),p.default.subscribe(this._userPresenceChanged),this._appConfigChanged(),this._userPresenceChanged(),i.Resolved()}_fetchMemberConsumptionHorizon(){const e=m.default.getActiveConversationId(a.MainRootViewId);e&&g.default.fetchMemberConsumptionHorizon(e)}_shouldOptInForReadReceipts(){const e=u.default.getReadReceiptsEnabled(),t=u.default.getUserPreferenceForReadReceipts();return o.default.getS4LMessagingFeatures().enableReadReceipts&&!e&&t}_shouldOptOutFromReadReceipts(){const e=u.default.getReadReceiptsEnabled();return!o.default.getS4LMessagingFeatures().enableReadReceipts&&e}}},244521:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(841269),n=(s(516778),s(397691)),r=(s(300060),s(889391),s(671830)),a=s(23293),l=s(82927),d=s(166923),c=s(788660),h=s(952262),u=s(746096),p=s(552115),g=s(753559),m=s(436237),S=s(733754),f=s(704329),y=(s(18078),s(104735)),v=s(532514),C=s(76812),_=s(994165),b=s(316392),T=s(422538),M=s(853374),I="file://";t.default=new class{constructor(){this._processShareEvent=e=>{const t=M.default.newCauseId();m.log(u.LogTraceArea.ShareToSkype,"Processing event with type: "+e.type+" causeId:"+t),m.track(new C.default({action:C.ShareToSkypeEventActions.opened,event:e}));const s=_.default.processShareEvent(e,I);s&&this._navigateToSharePanel(((s,i)=>{_.default.postSharedMessage(e,s,t)}),s,((t,s)=>{this._onShareCompleteReportTelemetryAndNavigateIfNeeded(e,t,s)}))},this._onShareCompleteReportTelemetryAndNavigateIfNeeded=(e,t,s)=>{if(this._reportSharedTelemetryEvent(e,t,s),1===t.length){const e=t[0];if(!r.isHighlightsThread(e)){const t=M.default.newCauseId();m.log(u.LogTraceArea.Navigation,"ShareToSkypeService._reportTelemetryAndNavigateIfNeeded, causeId: "+t),y.default.navigateToConversation({convId:e,origin:u.NavigationConversationOrigin.ShareToSkype,causeId:t})}}},T.RegisterStartupable(this,"ShareToSkypeService",[a.default,h.default]),f.default.registerForLogout(this,"ShareToSkypeService")}startup(){return o.default.setListener(this._processShareEvent,this._fileSizeLimit),n.Resolved()}setMaximumFileSizeLimitInBytes(e){this._fileSizeLimit=e}_exposeDirectShareShortcuts(){void 0===this._searchStore&&(this._searchStore=new v.default,this._searchStore.updateConfig({rawQuery:"",trimmedNormalizedQuery:"",excludeBots:!0,excludePstn:!0,onlyGroupCapable:!1,onlyCallCapable:!1,excludeShortCircuitMatches:!0},[u.SearchResultsListGroup.SuggestedRecentConversationsWithEstablishedPrivateConversations]));const e=this._searchStore.getSuggestedContactsAndConversationsResults(u.SearchResultsListGroup.SuggestedRecentConversationsWithEstablishedPrivateConversations);if(e){const t=e.map((e=>{const t=h.default.getDisplayableProfile(e);return t&&t.getDisplayName()?{mri:e,displayName:t.getDisplayName(),isGroup:t instanceof l.default,avatarUrl:t.getAvatarUrl(),initials:t.getInitials(),color:a.default.getPrimaryColor(e)}:void 0})).filter((e=>e));o.default.exposeDirectShareShortcuts(t)}}_processDirectShareEvent(e,t){c.default.performShareNavigationAction(e,I,t)}_navigateToSharePanel(e,t,s){const i=M.default.newCauseId();m.log(u.LogTraceArea.Navigation,"ShareToSkypeService._navigateToSharePanel, causeId: "+i),t.multipleMessagesParameters||(t.multipleMessagesParameters=[]),t.multipleMessagesParameters.length||t.multipleMessagesParameters.push({}),t.multipleMessagesParameters[0].onShareCompleteForMessage=e,y.default.navigateToSelectConversationsForSharingOrScheduleNavigationOnLaunch({isExternalShare:!0,navigationDirection:b.StackNavigationDirection.Present,onShareComplete:s,shareMessageTitle:S.getString("ShareWithPanel.ShareToSkypeHeader"),accessibilityLabelTitle:S.getString("ShareWithPanel.ShareToSkypeAccessibilityHeader"),multipleMessagesParameters:t.multipleMessagesParameters,sharePreviewType:t.sharePreviewType,enableMediaPreview:!0,causeId:i,entryPoint:u.SharePanelEntryOrigin.External,directShareMri:t.directShareMri})}_reportSharedTelemetryEvent(e,t,s){m.track(new C.default({action:C.ShareToSkypeEventActions.completed,event:e,conversationsCount:t.length,messageAdded:s}))}logout(e,t,s){return o.default.removeListener(),n.Resolved()}_shareElectronFile(e){const t=M.default.newCauseId();m.error(u.LogTraceArea.Navigation,"ShareToSkypeService._onShareFile, eventId: "+t);const s=i.first(e.data);if(s){const t=g.default.extractFileNameWithExtension(s.name),i=g.default.extractFileExtension(t),n=d.default.determineUploadFileType({extension:i,file:{uri:s.uri,size:s.size,name:s.name,type:""}},!1),r=p.default.getMaximumFileSizeForType(n);if(s.size>r){const e=S.getString("Global.FileTooBigContent",{maxSizeFormatted:p.default.formatFileSize(r,0).formattedString});window.electronApi.ipcProvider.dialog.showMessageBox.send({title:S.getString("ShareWithPanel.ShareWithHeader"),content:e,type:"warning"})}else o.default.open(e,S.getString("ShareWithPanel.ShareWithHeader"))}}}},113510:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(889391),r=s(746096),a=s(436237),l=s(18078),d=s(722543);d.default.setThrottled((()=>n.default.getS4LFeatures().scheduler.enableSmsPriceThrottling));t.default=class{static getSmsPrice(e){const t=l.default.getSkypeId();return t?d.default.getPrice(e,t).then((t=>{const s=this._handleAPIReturn(t,e);return a.log(r.LogTraceArea.SMSClient,"Successfully got price for SMS. Returning: "+JSON.stringify(s)),s})).catch((e=>(a.log(r.LogTraceArea.SMSClient,"Getting price for SMS failed. Returning: "+JSON.stringify(e)),{rate:void 0,currency:void 0,failureReason:d.FailureReason.Other}))):o.Rejected("Unable to get User ID")}static _handleAPIReturn(e,t){return a.log(r.LogTraceArea.SMSClient,"Handled SMS Rate from new API"),{rate:i.isEmpty(e)?void 0:e[0].price,currency:i.isEmpty(e)?void 0:e[0].currency,failureReason:i.isEmpty(e)?d.FailureReason.Other:this._mapFailureReasons(e[0].status)}}static _mapFailureReasons(e){switch(e){case 200:return;case 407:case 405:return d.FailureReason.InsufficientFunds;default:return d.FailureReason.Other}}}},615301:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SmsFlowId=void 0;const i=s(746096),o=s(436237),n=s(914976);var r;!function(e){e.Default="skype.S4L.client.sms.1way",e.Contacts="skype.S4L.client.sms.1way.contacts",e.CallList="skype.S4L.client.sms.1way.callList",e.UserProfile="skype.S4L.client.sms.1way.userProfile",e.Dialer="skype.S4L.client.sms.1way.pstnDialer",e.QuickCallPanelCallingOptions="skype.S4L.client.sms.1way.quickCallPanelCallingOptions",e.NewSms="skype.S4L.client.sms.1way.newSms"}(r=t.SmsFlowId||(t.SmsFlowId={}));t.default=new class{constructor(){this.setDefault()}setNextFlowId(e){this._nextFlowId=e,o.log(i.LogTraceArea.SkypeSmsFlowIdStore,"Setting NEXT Flow ID to "+e)}commitNextFlowId(){o.log(i.LogTraceArea.SkypeSmsFlowIdStore,"Committing flow id "+n.dev_unknownOmit(this._nextFlowId)),this._nextFlowId&&(this.setFlowId(this._nextFlowId),this.clearNextFlowId())}clearNextFlowId(){o.log(i.LogTraceArea.SkypeSmsFlowIdStore,"Clearing next flow id"),this._nextFlowId=void 0}setFlowId(e){o.log(i.LogTraceArea.SkypeSmsFlowIdStore,"Setting flow ID to "+e),this._currentFlowId=e}getFlowId(){return o.log(i.LogTraceArea.SkypeSmsFlowIdStore,"RETURNING FLOW ID "+this._currentFlowId),this._currentFlowId}setDefault(){this.setFlowId(r.Default)}test_dontCallThis_getNextFlowId(){return this._nextFlowId}}},960634:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.videoManipulationProgressChangedEvent=void 0;const i=s(496486),o=s(41217),n=s(974634),r=s(397691),a=s(746096),l=s(436237);t.videoManipulationProgressChangedEvent=new n.default;t.default=new class{constructor(){this._sessionCounter=0,this._queue=[],o.reencodeProgressChangedEvent.subscribe((e=>{this._sessionIdInProgress?t.videoManipulationProgressChangedEvent.fire(this._sessionIdInProgress,e):l.warn(a.LogTraceArea.Capture,"reencodeProgressChangedEvent fired but no manipulations in progress")}))}saveVideoWithoutView(e,t,s,i,n){return this._createNewSession((()=>o.default.reencodeVideo(e,t,s,i)),n)}saveVideoWithView(e,t,s,i,o){return this._createNewSession((()=>e.captureWithOverlay(t,s,i)),o)}cancelSession(e){if(this._sessionIdInProgress===e)o.default.cancelReencode();else{const t=i.remove(this._queue,(t=>t.sessionId===e));if(t.length>0){t[0].deferred.reject({code:o.ReencodeErrorType.Cancelled,message:"Cancelled before reencoding had begun"})}}}_createNewSession(e,t){const s={sessionId:"session"+this._sessionCounter++,deferred:r.Defer(),manipulation:e,telemetrySession:t};return this._queue.push(s),this._maybeStartManipulation(),{sessionId:s.sessionId,manipulationPromise:s.deferred.promise()}}_maybeStartManipulation(){if(!this._sessionIdInProgress){const e=this._queue.shift();if(!e)return;this._sessionIdInProgress=e.sessionId,e.telemetrySession&&e.telemetrySession.startReencode(),e.manipulation().then((t=>{e.telemetrySession&&t.fileSize!==t.sourceFileSize&&this._logSuccessTelemetry(e.telemetrySession,t);const s=t;e.telemetrySession&&(s.scenarioAttributes=e.telemetrySession.getScenarioAttributes()),e.deferred.resolve(s)})).catch((t=>{e.telemetrySession&&(e.telemetrySession.setErrorType(t.code),t.code===o.ReencodeErrorType.Cancelled?this._logCancelledTelemetry(e.telemetrySession):this._logFailureTelemetry(e.telemetrySession,t.message)),e.deferred.reject(t)})).always((()=>{this._sessionIdInProgress=void 0,this._maybeStartManipulation()}))}}_logSuccessTelemetry(e,t){e.endReencode(),e.setState(a.ReencodeState.Success),e.setOutputFileSize(t.fileSize?t.fileSize:0),e.setOriginalAssetFetchDuration(t.fetchDuration),t.width&&t.height&&e.setOutputDimensions({width:t.width,height:t.height}),t.sourceFileSize&&e.setSourceFileSize(t.sourceFileSize),t.estimatedFileSize&&e.setEstimatedFileSize(t.estimatedFileSize),l.track(e)}_logFailureTelemetry(e,t){e.endReencode(),e.setState(a.ReencodeState.Fail),e.setErrorInfo(t),l.track(e)}_logCancelledTelemetry(e){e.endReencode(),e.setState(a.ReencodeState.Cancel),l.track(e)}test_reset(){this._sessionCounter=0,this._sessionIdInProgress=void 0,i.each(this._queue,(e=>{e.deferred.reject("Cleaning out from test_reset()")})),this._queue=[]}test_getInProgressErrorString(){return"LensVideoView had another session in progress"}}},46375:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});s(570655).__exportStar(s(310066),t)},166923:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(174958),o=s(496486),n=s(397691),r=s(219784),a=s(889391),l=s(265976),d=s(351077),c=s(581697),h=s(671830),u=s(562141),p=s(898278),g=s(400984),m=s(539549),S=s(882261),f=s(770891),y=s(746096),v=s(552115),C=s(753559),_=s(653700),b=s(970004),T=s(497174),M=s(923944),I=s(436237),w=s(733754),P=s(971349),k=s(10909),A=s(827357),x=s(680457),R=s(431234),O=s(649130),L=s(422538),F=s(404057),B=s(478262),D=s(361694),E=s(626712),V=s(853374),N=s(735370),U=s(53332),j=y.LogTraceArea.PostingService;t.default=new class{constructor(){L.RegisterStartupable(this,"CreatePostInfoUtils",[_.default,R.default])}startup(){return n.Resolved()}createMessageInfo(e,t={}){let s;e.inputEntities&&R.default.registerEntities(e.inputEntities);const r={},l={};let c=0;const p=d.getMessageTypeGroup(e.messageForPosting),g=e.conversationId;if(p===d.MessageTypeGroups.Text&&e.inputEntities&&!h.isEncryptedThread(g)){const t=M.handleLinks(e.inputEntities);if(t&&t.length>0){const i=e.previousMessageBeingEditedProperties?e.previousMessageBeingEditedProperties:void 0;s=d.getJsonFromMessageProperty(i,d.MessageProperties.UrlPreviews),o.each(t,(e=>{if(e instanceof T.LinkEntity){const t=e.computeType();if(o.isNumber(t)&&t===D.UrlType.Web){const t=e.href;l[t]=!0,s&&o.some(s,(e=>e.key===t))||(r[t]=t)}}}))}c=M.getRawText(e.inputEntities).length}let m=o.values(r);const S=a.default.getConfigSettingsNoSubscription().urlPreview.maxPreviewsPerMessage;if(!o.isUndefined(S)){const e=S-(s?s.length:0);m.length>e&&(I.log(j,"Limiting URL previews to fetch to "+e),m=o.take(m,e))}m.length&&I.log(j,"Adding urls to the queue of URL previews: "+i.pii.Omit(m.join(", "))),p===d.MessageTypeGroups.SMS&&e.inputEntities&&(c=M.getRawText(e.inputEntities).length);return(e.editedMessageCuid?u.default.getMessageByCuid(g,e.editedMessageCuid):n.Resolved(void 0)).then((n=>{const r=!!s;let a;if(n&&s){const e=o.remove(s,(e=>!(e.key in l)));a=s.length?JSON.stringify(s):void 0,e.length>0&&I.log(j,"Message edit: removing unecessary urlpreviews: "+i.pii.Omit(a||""))}let u,p=e.messageForPosting;if(o.isEmpty(e.forwardMediaInfos))if(n)(m.length||a||r)&&(u={messageId:n.getServerIdForPropertyChanges(),urlPreviewJson:a});else if(a||e.isForward){const t=o.cloneDeep(p);if(t.properties=t.properties||{},a&&(t.properties[d.MessageProperties.UrlPreviews]=a),e.isForward){const e={isForwarded:!0};t.properties[d.MessageProperties.ForwardMetadata]=JSON.stringify(e)}p=t}const S=o.find(e.inputEntities,(e=>e instanceof T.QuoteEntity)),f=S&&S.quoteNode&&S.quoteNode.author&&h.skypeIdToMri(S.quoteNode.author),y=S&&S.quotesTriggerType,v=S&&S.quotedMessage?N.getMessageTypeName(S.quotedMessage):void 0,C=!!e.isForward;return{kind:x.PostMessageInfoKind,editedMessageCuid:e.editedMessageCuid,conversationId:g,postSource:e.postSource,conversationOrigin:e.conversationOrigin,messageForPosting:p,urlPreviewPropSet:u,forwardMediaInfos:e.forwardMediaInfos,swiftMessageDecoded:e.swiftMessageDecoded,urlPreviewEndpoints:m,rawContentLength:c,quoteAuthor:f,quotesTriggerType:y,quotesMessageType:v,isForward:C,showLocalNotificationOnFailure:t.showLocalNotificationOnFailure,shouldSendLogs:t.shouldSendLogs,shouldSendScreenshot:t.shouldSendScreenshot,screenshotUri:t.screenshotUri,conversationAcceptedInfo:this.getConversationAcceptedInfo(g),isDelete:!!e.isDelete,editedMessageServerId:e.editedMessageServerId,editedMessageVersion:e.editedMessageVersion}}))}createUploadInfo(e,t,s,i={}){return this.createUploadAndTextInfo(e,[{data:t,overlayUrl:i.overlayUrl}],s,i)}createUploadAndTextInfo(e,t,s,r={}){o.defaults(r,{copyUploadMedia:!0,copyThumbnail:!0});let l=!1;if(e.length&&o.some(e,(e=>h.isEncryptedThread(e)))){if(1!==e.length){const e="Encrypted files can be sent only to one thread at a time";return I.warn(j,e),this.alertOneThreadOnly(),n.Rejected(e)}l=!0}const d=[];let c=[];const u=[];return o.reduce(t,((e,t)=>e.then((()=>{if(o.isString(t))return c.push(t),void u.push(new T.UnhandledEntity(t));const{data:e,overlayUrl:h}=t;let p=this.determineUploadFileType(e,l,r),g=e.thumbnail;if(C.default.isThumbnailSupportedFileType(p)||(g=void 0),!this.canUploadFile(e.file.size)){const t="Ignoring upload of empty file: "+i.pii.Omit(e.file.name);return I.warn(j,t),n.Rejected(t)}const m=U.default.shouldReencodeUpload(p,r.overlayUrl),S=m&&a.default.getS4LCMCFeaturesNoSubscription().disableCopyingOriginalVideoToCache;if(o.isNumber(e.file.size)&&!m){const t=v.default.getMaximumFileSizeForType(p);if(e.file.size>t){this.alertSizeTooBig(t,e.file.size,s,p);const i=`File is too large to upload: ${p} ${e.file.size} bytes`;return n.Rejected(i)}}const f=r.filename||e.file.name;let y,M,w,P;if(!S&&_.default.isLocalCacheSupported()){const t=this.generateLocalCacheName(e,p,f);y={name:t,asCopy:r.copyUploadMedia},M=b.FileUploadCacheUtils.getLocalCacheUri(t)}else M=E.default.getFileUrl(e);if(g)if(_.default.isLocalCacheSupported()){const e=this.generateLocalCacheName(g,B.UploadFileType.Thumbnail);w={name:e,asCopy:r.copyThumbnail},P=b.FileUploadCacheUtils.getLocalCacheUri(e)}else P=E.default.getFileUrl(g);return(S?n.Resolved():_.default.saveFileIfSupported(e,y)).then((()=>{let t=e.file.size;if(!o.isNumber(t)&&y){const i=_.default.getSize(y.name);if(o.isNumber(i)){t=i,p=this.determineUploadFileType(e,l,r,i);const o=v.default.getMaximumFileSizeForType(p);if(i>o&&!U.default.shouldReencodeUpload(p,r.overlayUrl)){this.alertSizeTooBig(o,t,s,p);const e=`File is too large to upload: ${p} ${o} bytes`;return n.Rejected(e)}}}C.default.isThumbnailSupportedFileType(p)||(g=void 0);const i=P||M,a=this.getMediaEntity(M,i,i,void 0,p,r.title,f,t,e.dimensions,void 0,r.durationMs);return u.push(a),c.push(d.length),d.push({amsUploadFullData:e,amsFullDataCacheInfo:y,amsFullDataLocalUrl:M,amsUploadFilename:f,amsUploadThumbnailData:g,amsThumbnailCacheInfo:w,amsThumbnailLocalUrl:P,amsUploadFileType:p,videoOverlayUrl:h,audioDurationMs:r.durationMs}),_.default.saveFileIfSupported(g,w)}))}))),n.Resolved()).then((()=>{o.some(c,o.isString)||(c=void 0);const i=d[0]?d[0].amsUploadFileType:void 0,n=this.determineChatMessageType(t,r,i);r.callId&&u.push(new T.CallReactionMetadataEntity(r.callId));const a={};o.each(e,(e=>{const t=S.createMessageInfo(e,s,u,n,r.properties,!!c);a[e]=t.messageForPosting}));return{kind:x.PostUploadInfoKind,conversationIds:e,amsUploads:d,textWithUploadIndexes:c,messagesForPosting:a,callId:r.callId,title:r.title,uploadSource:s,conversationOrigin:A.default.dangerouslyGetActiveConversationContextOrigin(p.MainRootViewId),toastMessageToShowOnSuccess:r.toastMessageToShowOnSuccess,toastMessageToShowOnFailure:r.toastMessageToShowOnFailure,shouldTrackUpload:r.shouldTrackUpload,conversationAcceptedInfos:o.mapValues(a,((e,t)=>this.getConversationAcceptedInfo(t)))}})).catch((t=>{if(I.warn(j,'Failed to start upload: ConvIds: "'+o.map(e,(e=>i.pii.Mri(e))).join(", ")+'", error: '+F.default.errorAsString(t)),o.each(d,(e=>{const{amsFullDataCacheInfo:t,amsThumbnailCacheInfo:s}=e;t&&_.default.abandon(t.name),s&&_.default.abandon(s.name)})),r.toastMessageToShowOnFailure){const e=w.getString(r.toastMessageToShowOnFailure);k.default.scheduleTextMessage(e,void 0,p.MainRootViewId)}return n.Rejected()}))}canUploadFile(e){return void 0===e||e>0}determineChatMessageType(e,t,s){if(e.length>1)return d.MessageTypes.RichText;if(t.title&&s===B.UploadFileType.Picture)return d.MessageTypes.Media_Card;if(!s)return d.MessageTypes.Text;switch(s){case B.UploadFileType.Picture:return d.MessageTypes.UriObject;case B.UploadFileType.Video:return d.MessageTypes.Media_Video;case B.UploadFileType.VideoMessage:return d.MessageTypes.VideoMessage;case B.UploadFileType.Audio:case B.UploadFileType.AudioMessage:return d.MessageTypes.AudioMessage;case B.UploadFileType.Thumbnail:case B.UploadFileType.GroupAvatar:case B.UploadFileType.Excel:case B.UploadFileType.OneNote:case B.UploadFileType.Powerpoint:case B.UploadFileType.Word:case B.UploadFileType.PDF:case B.UploadFileType.File:case B.UploadFileType.AVI:case B.UploadFileType.Zip:return d.MessageTypes.Media_GenericFile;default:return V.default.switchStatementExhaustiveChecking(s)}}determineUploadFileType(e,t,s={},i){if(t)return B.UploadFileType.File;let n=B.UploadFileType.File;if(C.default.isImageExtension(e.extension)){if(e.dimensions){n=B.UploadFileType.Picture;const t=v.default.getMaximumLimitsForType(n);t&&t.width&&t.height&&(e.dimensions.width>t.width||e.dimensions.height>t.height)&&(n=B.UploadFileType.File)}}else C.default.isVideoExtension(e.extension)?(this.isAmsVideoMessageExtension(e.extension)&&s.isRecorded?n=B.UploadFileType.VideoMessage:this.isAmsVideoExtension(e.extension)&&(n=B.UploadFileType.Video),e.thumbnail||(n=B.UploadFileType.File)):C.default.isAudioExtension(e.extension)&&(s.isRecorded?n=B.UploadFileType.AudioMessage:this.isAmsAudioExtension(e.extension)&&(n=B.UploadFileType.Audio));const{enableMediaFileRedesign:r}=a.default.getS4LMessagingFeaturesNoSubscription();r&&(C.default.isPDFExtension(e.extension)?n=B.UploadFileType.PDF:C.default.isWordExtension(e.extension)?n=B.UploadFileType.Word:C.default.isExcelExtension(e.extension)?n=B.UploadFileType.Excel:C.default.isPowerPointExtension(e.extension)?n=B.UploadFileType.Powerpoint:C.default.isAVIExtension(e.extension)&&(n=B.UploadFileType.AVI));const l=o.isNumber(e.file.size)?e.file.size:i;if(o.isNumber(l)&&n!==B.UploadFileType.File){if(a.default.getAsyncMediaFeatures().fallback_to_file){l>v.default.getMaximumFileSizeForType(n)&&(n=B.UploadFileType.File)}}return n}isAmsVideoExtension(e){const t=a.default.getAsyncMediaFeatures().storage_limits.video.format;return o.includes(t,e.toLowerCase())}isAmsVideoMessageExtension(e){return o.includes(["mp4","webm"],e.toLowerCase())}isAmsAudioExtension(e){const t=a.default.getAsyncMediaFeatures().storage_limits,s=t.audio?t.audio.format:[];return o.includes(s,e.toLowerCase())}alertSizeTooBig(e,t,s,i,n=!1){const a=[{text:w.getString("Global.OkLabel"),isCancel:!0,onPress:o.noop}],l=w.getString("Global.FileTooBigContent",{maxSizeFormatted:v.default.formatFileSize(e,0).formattedString});r.default.showWithOptions({title:w.getString("Global.FileTooBig"),dialogAccessibilityTitle:l,message:l,buttons:a,rootViewId:p.MainRootViewId,useFocussedWindowFallback:!0});const d=new P.FileRejectedByClient(i,s,P.FileRejectedReason.FileSize);d.setFileSizeDetails(e,t),d.setIsRejectedFromPost(n),I.track(d)}alertOneThreadOnly(){const e=[{text:w.getString("Global.OkLabel"),isCancel:!0,onPress:o.noop}],t=w.getString("Global.OneThreadATimeContent");r.default.showWithOptions({title:w.getString("Global.OneThreadATime"),dialogAccessibilityTitle:t,message:t,buttons:e,rootViewId:p.MainRootViewId,useFocussedWindowFallback:!0})}getMediaEntity(e,t,s,i,o,n,r,a,l,d,c){let h;if(n){const t=this._getSwiftPictureMessage(e,n,d);h=new T.SwiftUriObjectEntity(t,void 0,!0,n)}else h=new T.MediaEntity(e,t,s,i,o,r,a,l,d,c);return h}_getSwiftPictureMessage(e,t,s){s||(s=l.getDocumentId(e));const i={images:[{url:s?l.getDisplayUrl(s,B.UploadFileType.Picture,B.MediaViewSize.MobilePreview):"",tap:{type:f.SwiftActionTypes.showImage}}],title:t},o={contentType:f.SwiftContentTypes.hero,content:i};return{type:f.SwiftMessageTypes.card,attachments:[o]}}generateLocalCacheName(e,t,s){let i=s?C.default.extractFileExtension(s):e.extension||C.default.extractFileExtension(e.file.name);if(!i)switch(t){case B.UploadFileType.File:case B.UploadFileType.Excel:case B.UploadFileType.OneNote:case B.UploadFileType.Powerpoint:case B.UploadFileType.Word:case B.UploadFileType.PDF:i="";break;case B.UploadFileType.Picture:case B.UploadFileType.Thumbnail:case B.UploadFileType.GroupAvatar:i="jpeg";break;case B.UploadFileType.Video:i="mp4";break;case B.UploadFileType.VideoMessage:i="webm";break;case B.UploadFileType.AVI:i="avi";break;case B.UploadFileType.Audio:case B.UploadFileType.AudioMessage:i="mp3"}const o=V.default.newGuid()+(i?"."+i:"");return O.lossyForUserFile(o)}getConversationAcceptedInfo(e){return{hasConvInMemory:!!(0,m.default)().getConversation(e),isAccepted:g.default.isConversationAccepted(e),isSyncingConv:c.default.isSyncingMessagesForConversation(e),hasAllMessages:c.default.haveAllMessagesForConversation(e)}}}},624606:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.test_setForegroundPostEnabled=t.Test_CheckForUpdate=t.CheckForNeededWorkResult=t.postIdFromContext=t.PostMessageScenarioStep=t.TransferTypeToPostingTransferSource=t.ChatPostActionNames=t.AllForegroundTransferTypes=t.AllBackgroundTransferTypes=t.feedbackGathered=t.pokePost=t.serverTranscodingProgress=t.foregroundUploadProgress=t.foregroundResponse=t.Post=t.TranscodingState=t.EncryptionState=void 0;const i=s(174958),o=s(496486),n=s(41217),r=s(978536),a=s(269521),l=s(775463),d=s(516778),c=s(168409),h=s(662783),u=s(974634),p=s(397691),g=s(266737),m=s(889391),S=s(717135),f=s(720603),y=s(265976),v=s(734581),C=s(544135),_=s(422801),b=s(260021),T=s(476621),M=s(351077),I=s(765369),w=s(61375),P=s(671830),k=s(562141),A=s(898278),x=s(357569),R=s(166923),O=s(440276),L=s(362843),F=s(667121),B=s(36763),D=s(125793),E=s(298249),V=s(746096),N=s(84457),U=s(552115),j=s(753559),H=(s(653700),s(970004)),z=s(497174),W=s(923944),G=s(436237),K=s(916724),q=s(733754),Q=s(971349),X=s(812056),$=s(850513),J=s(326385),Y=s(10909),Z=s(18078),ee=s(415963),te=s(583181),se=s(666765),ie=s(216568),oe=s(404057),ne=s(640363),re=s(478262),ae=s(735370),le=s(794050),de=s(782176),ce=s(409426),he=s(865322),ue=s(626712),pe=s(853374),ge=s(960634),me=s(53332),Se=s(17791),fe=s(312762),ye=(s(907234),s(189469)),ve=(s(816402),V.LogTraceArea.PostingService),Ce={priority:h.WebRequestPriority.High,timeout:6e4},_e={priority:h.WebRequestPriority.High,progressTimeout:6e4,timeout:0};var be,Te,Me,Ie,we,Pe,ke,Ae,xe,Re,Oe,Le,Fe,Be,De,Ee,Ve,Ne,Ue,je,He,ze,We;!function(e){e[e.NotStarted=1]="NotStarted",e[e.InProgress=2]="InProgress",e[e.Success=3]="Success",e[e.Failure=4]="Failure"}(be=t.EncryptionState||(t.EncryptionState={})),function(e){e[e.NotStarted=1]="NotStarted",e[e.InProgress=2]="InProgress",e[e.Success=3]="Success",e[e.Failure=4]="Failure"}(Te=t.TranscodingState||(t.TranscodingState={}));class Ge{constructor(e,t,s){if(this.findAnythingBlockingPost=s,this.persisted=e,this.persisted.scenarioInfo&&o.size(e.amsUploads)<=1){const s=e.amsUploads&&e.amsUploads[0];this.telemetryScenarios=o.mapValues(this.persisted.messagesForPosting,((i,n)=>{const r=P.getCuidForMessage(i),a=b.getCorrelationIdFromMessageParts(Z.default.getSkypeMri(),n,i.clientmessageid),l={};l.message_cuid=r,l.message_correlationId=a,l.message_type=ae.getMessageTypeName(i,Z.default.getSkypeMri(),n),l.message_rawtype=ae.getMessageRawTypeName(i,Z.default.getSkypeMri(),n),l.transaction_id=e.transactionId||"",s&&(s.amsUploadFullData.file&&(l.size=U.default.getAmsUploadFileSize(s)||0),s.amsUploadFullData.dimensions&&(l.width=s.amsUploadFullData.dimensions.width,l.height=s.amsUploadFullData.dimensions.height),l.extension=de.default.changeExtensionForTelemetry(s.amsUploadFullData.extension)),this.persisted.scenarioInfo&&this.persisted.scenarioInfo.failedAmsDocumentId&&(l.failed_docId=this.persisted.scenarioInfo.failedAmsDocumentId);const d=this.persisted.scenarioInfo.name,c=d===ee.ScenarioName.SendPicture||d===ee.ScenarioName.SendVideo||d===ee.ScenarioName.SendFile,h=new le.default(d,a,l,void 0,c);return h.setDuplicateStepMarkingEnabled(),h.setScenarioTimeout((()=>(G.track(new X.MessageSendTimeout(i,n)),!1)),Ge._getInstrumentationTimeout(i)),t?(h.start(),o.each(this.persisted.scenarioInfo.secondaryScenariosToSpawnAtCreation,(e=>{const t=h.spawnSecondaryScenario(e.name,e.timeout),s={confirmedGoodConnection:Se.default.isNetworkingAvailableNoSubscription()};t.start(s)}))):(h.resume(this.persisted.scenarioInfo.startTime),h.markStepCompleted("msg_restored",void 0,void 0,!0)),h}))}this._postSubSteps=Ie.PostSubSteps.forPost(this,e),o.isUndefined(this.persisted.nonBlocking)&&(this.persisted.nonBlocking=!Ge._shouldBlock(e)),this._postSubSteps.redoLostTransfers()}markTelemetryStepCompleted(e,t,s,i=void 0){o.each(this.telemetryScenarios,((n,r)=>{if((!t||o.includes(t,r))&&o.size(this.persisted.amsUploads)<=1){const t=Ue[e],o={},r=this._postSubSteps.amsManyData&&this._postSubSteps.amsManyData.amsSingleDatas[0];r&&(o.amsDocumentId=r.amsCreate.persisted.amsDocumentIds&&r.amsCreate.persisted.amsDocumentIds[0]),i&&(o[t+"_finished_attempts"]=i),n.extendProperties(o),n.markStepCompleted(t,s,void 0,!0)}}))}static _shouldBlock(e){const t=m.default.getS4LMessagingFeaturesNoSubscription().nonBlockingUploadsFromSize;if(o.isNumber(t)&&o.size(e.amsUploads)){let s=0;o.each(e.amsUploads,(e=>{var t;e&&((null===(t=e.amsUploadFullData)||void 0===t?void 0:t.isAlbumItem)?s=e.amsUploadFullData.albumTotalSize||0:(o.isNumber(e.amsUploadFullData.file.size)&&(s+=e.amsUploadFullData.file.size),e.amsUploadThumbnailData&&o.isNumber(e.amsUploadThumbnailData.file.size)&&(s+=e.amsUploadThumbnailData.file.size)))}));const i=o.some(e.messagesForPosting,((e,t)=>P.isAgent(t)));return!M.shouldMediaBeSentAsync(s,t,Se.default.isNetworkingAvailable(),i)}return!0}static _getInstrumentationTimeout(e){const t=M.getMessageTypeGroup(e);let s=0;const i=m.default.getS4LMessagingFeatures();switch(t){case M.MessageTypeGroups.Location:s=i.locationSendTimeout;break;case M.MessageTypeGroups.Moji:s=i.mojiSendTimeout;break;case M.MessageTypeGroups.ScheduledCallInvite:s=m.default.getS4LCMCFeatures().scheduledCallInviteSendTimeout;break;case M.MessageTypeGroups.Poll:s=i.pollCardSendTimeout;break;case M.MessageTypeGroups.Sticker:s=i.stickerSendTimeout;break;case M.MessageTypeGroups.SwiftCard:s=i.swiftCardSendTimeout;break;case M.MessageTypeGroups.Text:case M.MessageTypeGroups.SMS:case M.MessageTypeGroups.CallerID:case M.MessageTypeGroups.MediaAlbum:case M.MessageTypeGroups.Translation:s=i.textSendTimeout;break;case M.MessageTypeGroups.UriFile:s=i.uriFileSendTimeout;break;case M.MessageTypeGroups.Audio:s=i.audioSendTimeout;break;case M.MessageTypeGroups.Picture:s=i.pictureSendTimeout;break;case M.MessageTypeGroups.Video:s=i.videoSendTimeout;break;case M.MessageTypeGroups.Calling:s=i.callingSendTimeout;break;case M.MessageTypeGroups.System:s=i.systemSendTimeout;break;case M.MessageTypeGroups.Contact:s=i.contactSendTimeout;break;case M.MessageTypeGroups.None:case M.MessageTypeGroups.Engagement:s=i.noneGroupSendCallback;break;default:pe.default.switchStatementExhaustiveChecking(t)}return s}getPersistedActionData(){return this.persisted}isUploadNeeded(){return!o.isEmpty(this.persisted.amsUploads)}doWorkIfNeeded(){const e=this._postSubSteps.checkForUpdate();let t;switch(e.kind){case je.Finished:case je.GiveUp:case je.Blocked:t=!1;break;case je.InProgress:case je.Update:const{backgroundWakeLockWhilePostWaitingForTransfer:s}=m.default.getConfigSettingsNoSubscription().chat,i=e=>s?!o.isEmpty(e):!o.every(e,(e=>e instanceof Ke));t=i(e.inProgress)||i(e.start);break;default:return pe.default.switchStatementExhaustiveChecking(e.kind)}switch(e.kind){case je.Finished:this._finished();break;case je.Blocked:case je.InProgress:break;case je.Update:o.each(e.start,(e=>{e.start()}));break;case je.GiveUp:const t=o.first(e.failure).stepType,s=He.getFailureReason(e);this._removeWithoutSuccess(t,s);break;default:return pe.default.switchStatementExhaustiveChecking(e.kind)}return{updateKind:e.kind,isActivelyWorking:t}}_finished(){if(this.persisted.shouldTrackUpload&&o.size(this.persisted.amsUploads)<=1){const e=this.persisted.amsUploads&&this.persisted.amsUploads[0];if(e){const t=Q.MediaUploadBase.mediaActionForFileType(e.amsUploadFileType);if(t){const s=this._postSubSteps.amsManyData,i=s&&s.amsSingleDatas[0],o=this.persisted.conversationIds&&this.persisted.conversationIds[0],n=o?P.isGroupConversation(o):void 0;G.track(new Q.MediaUploadBase(t,!0,V.MessagingFailureReason.None,Date.now()-this.persisted.postTime,e.amsUploadFileType,e.amsUploadFullData.dimensions,i?i.amsCreate.persisted.transactionId:void 0,i&&i.amsCreate.persisted.amsDocumentIds?i.amsCreate.persisted.amsDocumentIds[0]:void 0,n))}}}if(this.persisted.toastMessageToShowOnSuccess){const e=q.getString(this.persisted.toastMessageToShowOnSuccess);Y.default.scheduleTextMessage(e,void 0,A.MainRootViewId)}}_removeWithoutSuccess(e,t){switch(t){case x.FailureReason.Permanent:this.persisted.permanentFailureTransferType=e;break;case x.FailureReason.MaxElapsedTimeExceeded:this.persisted.maxElapsedTimeExceededTransferType=e;break;case x.FailureReason.MaxRetriesExceeded:this.persisted.maxRetriesExceededTransferType=e;break;case x.FailureReason.None:break;default:pe.default.switchStatementExhaustiveChecking(t)}if(G.log(ve,"Giving up: "+this.persisted.id+", transferType: "+e+", failureReason: "+x.FailureReason[t]),this.persisted.showLocalNotificationOnFailure){if(a.LocalNotifications.show(this.persisted.showLocalNotificationOnFailure),!o.isEmpty(this.persisted.conversationIds)){const e=new J.MessagingToastAlertEvent(J.MessagingToastAlertType.ReplyNotSent,this.persisted.conversationIds[0]);G.track(e)}this.persisted.showLocalNotificationOnFailure=void 0}}handleResponse(e,t,s,i,n,r){if(r===Ne.UrlPreviewsType&&o.isString(t)&&this._postSubSteps.urlPreview){const s=o.find(this._postSubSteps.urlPreview.steps,(t=>{const s=t,i=s.persisted&&s.persisted.urlPreviewBackgroundTransfer&&s.persisted.urlPreviewBackgroundTransfer[s.endpoint];return!!i&&i.id===e}));t={postId:t,endpoint:s&&s.endpoint}}const a=function(e,t){const s=e;switch(s){case Ne.AmsCreateType:case Ne.AmsThumbnailType:case Ne.AmsFullDataType:case Ne.AzureDataType:return o.isString(t)?{postId:t,stepSelector:0}:t;case Ne.AmsGetStatusForwardType:return xe.parseBackgroundContextForForward(t);case Ne.AmsGetStatusForwardUploadType:return xe.parseBackgroundContextForUpload(t);case Ne.AmsForwardContentType:return Re.parseBackgroundContextForForward(t);case Ne.AmsForwardContentUploadType:return Re.parseBackgroundContextForUpload(t);case Ne.UrlPreviewsType:return Oe.parseBackgroundContext(t);case Ne.ChatPostType:return De.parseBackgroundContext(t);case Ne.MessagePropSetType:return Ee.parseBackgroundContext(t);case Ne.AmsCreateForegroundType:case Ne.AmsThumbnailForegroundType:case Ne.AmsFullDataForegroundType:case Ne.ChatPostForegroundType:return t;default:return void pe.default.switchStatementExhaustiveChecking(s)}}(r,t);if(a)return this._postSubSteps.handleResponse(e,t,s,i,n,r,a.stepSelector)}resetBackoffs(){this._postSubSteps.resetBackoffs()}cleanup(){this._postSubSteps.cleanup()}updateTotalElapsedTime(e,t){const s=e?Date.now()-e:0;this.persisted.totalElapsedTime?this.persisted.totalElapsedTime+=s:this.persisted.totalElapsedTime=s,G.log(ve,`Post ${this.persisted.id} ${t} elapsedTime to handleResponse: ${s} total post elapsedTime: ${this.persisted.totalElapsedTime}`)}isMyLocalUrl(e){return o.includes(this.getMyLocalUrls(),e)}getMyLocalUrls(){const e=[];return o.each(this.persisted.amsUploads,(t=>{e.push(t.amsThumbnailLocalUrl,this._getCurrentFileUri(t.amsThumbnailCacheInfo)),e.push(t.amsFullDataLocalUrl,t.originalFullDataLocalUrl,this._getCurrentFileUri(t.amsFullDataCacheInfo))})),o.compact(e)}getMyLocalCacheNames(){const e=[];return o.each(this.persisted.amsUploads,(t=>{t.amsThumbnailCacheInfo&&e.push(t.amsThumbnailCacheInfo.name),t.amsFullDataCacheInfo&&e.push(t.amsFullDataCacheInfo.name)})),o.compact(e)}_getCurrentFileUri(e){return e?H.FileUploadCacheUtils.getAbsoluteUriForName(e.name):void 0}isPostedToChat(e){return this._postSubSteps.chatPosts.isPostedToChat(e)}debug_allPostsFailedRetryInfo(){return this._postSubSteps.debug_retryInfo()}}t.Post=Ge;class Ke extends x.default{constructor(e,t,s,i){super([s],ve),this.post=e,this.persisted=t,this.stepType=s,this.stepSelector=i}checkForUpdate(){const e=this.transfer(),{needValidSkypeToken:t}=this._config();if(this._isTransferCompletedSuccessfully(e))return He.Finished;if(this._isTransferCompletedWithoutSuccess(this.post.persisted.id,e,this.stepType)){const t=(null==e?void 0:e.failureReason)?e.failureReason:x.FailureReason.None;return He.NeedTo.giveUpBecauseStep(this,t)}return this._isTransferReadyToStart(this.post.persisted.id,e,this.stepType,t)?He.NeedTo.startSteps(this):e&&e.finished?He.NeedTo.waitBecauseBlocked(this):He.NeedTo.waitForProgress(this)}start(){this._startTime=Date.now(),this._start()}handleResponse(e,t,s,i){this.post.updateTotalElapsedTime(this._startTime,this.stepType);const n=this.transfer();if(!n||n.id!==i)return void G.warn(ve,"Got "+this.stepType+(this.stepSelector?" ("+this.stepSelector+")":"")+" for known post: "+this.post.persisted.id+", but transfer id mismatch, expected: "+i+", current: "+(n&&n.id));const{emptyResponse:r,shimChatServiceResponse:a,canBlockOthersInConv:l,convId:d,fileSize:c}=this._config();e&&!r&&o.isEmpty(t.body)&&(G.log(ve,this.stepType+" missing body, success = false: "+this.post.persisted.id),e=!1),e=this._overrideSuccess(e,t),a&&_.default.errorHandler.augmentErrorResponse(t,e);const h=this._isPermanentFailure(e,t),u=this.post.persisted.totalElapsedTime||0,p=this._handleTransferFinished(this.post.persisted.id,n,this.stepType,e,h,u,t);e=!!p.transfer.success;const g=this._telemetryInfo(e),m={success:e,permanentFailure:x.default.isTransferPermanentFailure(p.transfer),finishedAttemptsSoFarCount:p.transfer.finishedAttemptsSoFarCount,retryInfo:p.retryInfo,canRetry:p.canRetry,mightUnblockOthersInConv:l&&(e||!p.canRetry),telemetryInfo:g,convId:d,fileSize:c};return m.mightUnblockOthersInConv&&!d&&(m.mightUnblockOthersInConv=void 0),this._handleResponse(e,t,s),m}_overrideSuccess(e,t){return e}_getMaxRetries(e,t){const s=m.default.getS4LCMCFeatures().retryPolicy;return o.isNumber(s.maxRetries[t])?s.maxRetries[t]:s.maxRetriesDefault}_getMaxTransferTime(e,t){const s=m.default.getS4LCMCFeatures().retryPolicy;return o.isNumber(s.maxTransferTime[t])?s.maxTransferTime[t]:s.maxPostElapsedTime}_isPermanentFailure(e,t){const{fileSize:s,uploadFileType:i}=this._config();return Ze(e,t,s,i)}resetBackoffs(){this._resetBackoffs()}stop(e){const t=pe.default.newCauseId();G.log(ve,"stop, causeId: "+t);const s=this.transfer();s&&s.id&&(!s.finished&&C.default.transferIsTracked(s.id)&&C.default.cancelTransfer(s.id,t),e&&x.default.redoTransfer(s))}cleanup(){this.stop(!1),this._cleanupRetryInfo(this.post.persisted.id)}debug_retryInfo(){return this._getRetryInfo(this.post.persisted.id,this.stepType)}}class qe{constructor(e,t,s,i){this.post=e,this.persisted=t,this.stepType=s,this.stepSelector=i}checkForUpdate(){const e=this._status();return e&&e.permanentFailure?He.NeedTo.giveUpBecauseStep(this,x.FailureReason.Permanent):e&&e.finished?He.Finished:this._foregroundRequest?He.NeedTo.waitForProgress(this):He.NeedTo.startSteps(this)}start(){this._startTime=Date.now();this._status();const e=this._startForegroundRequestOrFinish();if(!e)return void this._immediatelyFail();this._foregroundRequest=e,this._releasingWakeLockSubscription||(this._releasingWakeLockSubscription=_.default.releasingWakelock.subscribe((()=>{this._status(!0).finished||this._immediatelyFail()})));let s=!1;this._foregroundRequest.done((e=>{s=!0})).always((i=>{if(this._foregroundRequest!==e)return;this._foregroundRequest=void 0,this._releasingWakeLockSubscription&&(this._releasingWakeLockSubscription.unsubscribe(),this._releasingWakeLockSubscription=void 0);const o={postId:this.post.persisted.id,stepSelector:this.stepSelector},n=i.requestHeaders;t.foregroundResponse.fire(void 0,o,s,i,n,this.stepType)}))}_immediatelyFail(){this.stop(!1);const e=this._status(!0);e.finished=!0,e.finishedSuccess=!1;const{canBlockOthersInConv:s,convId:i}=this._config();t.pokePost.fire(this.post.persisted.id,s?i:void 0)}handleResponse(e,t,s,i){this.post.updateTotalElapsedTime(this._startTime,this.stepType);const o=this._status(!0);o.finished=!0,o.finishedSuccess=e,o.permanentFailure=this._isPermanentFailure(e,t),this._handleResponse(e,t,s);const{canBlockOthersInConv:n,convId:r,fileSize:a}=this._config(),l={success:e,permanentFailure:o.permanentFailure,finishedAttemptsSoFarCount:1,canRetry:!1,mightUnblockOthersInConv:n&&e,telemetryInfo:this._telemetryInfo(e),convId:r,fileSize:a};return l.mightUnblockOthersInConv&&!r&&(l.mightUnblockOthersInConv=void 0),l}_overrideSuccess(e,t){return e}_isPermanentFailure(e,t){const{fileSize:s,uploadFileType:i}=this._config();return Ze(e,t,s,i)}stop(e){if(this._foregroundRequest){const e=this._foregroundRequest;this._foregroundRequest=void 0,e.cancel()}if(e){const e=this._status(!0);e.finished=!0,e.finishedSuccess=!1}this._releasingWakeLockSubscription&&(this._releasingWakeLockSubscription.unsubscribe(),this._releasingWakeLockSubscription=void 0)}cleanup(){this.stop(!1)}}function Qe(e,t){return!P.isEncryptedThread(e)&&(P.isThread(e)?m.default.getConfigSettings().chat.serverSideEdits:!M.isEventCallEndedMessageType(t)&&m.default.getConfigSettings().chat.serverSideEdits1to1)}function Xe(e){const t=m.default.getConfigSettingsNoSubscription().chat;return!e||t.backgroundWaitForAmsUpload}function $e(){if(ot&&d.App.getActivationState()===d.Types.AppActivationState.Active){const e=m.default.getConfigSettingsNoSubscription().chat.enableForegroundMessagePostWithREST;if(e["*"]||e[ne.default.getOSVersion()])return!0}return!1}function Je(e){const[t,...s]=e;return{uploadConvIds:[t],forwardConvIds:s}}function Ye(e){return e instanceof Ke?"background transfer":e instanceof qe?"foreground request":"other kind of Step"}function Ze(e,t,s,i){return x.default.isPermanentFailure(t)}function et(e){if(e.body&&e.body.errorCode)return e.body.errorCode}function tt(e,t){const s=H.FileUploadCacheUtils.getAbsoluteFromLocalCacheUri(t),i=e.file.uri;if(!i||i===s)return e;const n=o.cloneDeep(e);return n.file.uri=s,n}function st(e,t,s,i,o,n,r){return Object.assign(Object.assign({},e),{originalFileName:e.amsUploadFilename,originalFullDataLocalUrl:e.amsFullDataLocalUrl,originalUploadFileType:e.amsUploadFileType,amsFullDataLocalUrl:t,amsUploadFilename:i||e.amsUploadFilename,amsUploadFullData:s,amsUploadFileType:o||e.amsUploadFileType,amsThumbnailLocalUrl:n,amsUploadThumbnailData:r})}function it(e,s,i,o,n,r){const a=i?o?1:0:r&&r.total?r.loaded/r.total:0;t.foregroundUploadProgress.fire(e,s,n,{finished:i,success:o,progress:a})}t.foregroundResponse=new u.default,t.foregroundUploadProgress=new u.default,t.serverTranscodingProgress=new u.default,function(e){const t="_CONTAINER_";class s{constructor(e,s){this.post=e,this.stepType=t,this.steps=o.compact(s)}redoLostTransfers(){o.each(this.steps,(e=>{if(e.stepType===t)e.redoLostTransfers();else{const t=e;if(t&&o.isFunction(t.transfer)){const e=t.transfer();e&&x.default.isTransferLost(e)&&x.default.redoTransfer(e)}}}))}handleResponse(e,s,i,o,n,r,a){const l=this._findSubStep(r,a);if(l){if(l.stepType===t)return l.handleResponse(e,s,i,o,n,r,a);{const t=l;if(t.handleResponse)return t.handleResponse(i,o,n,e)}}}_findSubStep(e,s){let i;return o.each(this.steps,(o=>(o.stepType===t?o._findSubStep(e,s)&&(i=o):o.stepType===e&&o.stepSelector===s&&(i=o),!i&&void 0))),i}resetBackoffs(){o.each(this.steps,(e=>{if(e.stepType===t)e.resetBackoffs();else{const t=e;t&&t.resetBackoffs&&t.resetBackoffs()}}))}debug_retryInfo(){const e=o.map(this.steps,(e=>{if(e.stepType===t)return e.debug_retryInfo();{const t=e;if(t.debug_retryInfo)return t.debug_retryInfo()}}));return o.merge({},...e)}stop(e){o.each(this.steps,(t=>{t.stop(e)}))}cleanup(){o.each(this.steps,(e=>{e.cleanup()}))}}e.InSequence=class extends s{checkForUpdate(){return He.findWorkWithLowPriorityFinished(this.steps)}};e.InParallel=class extends s{checkForUpdate(){const e=o.map(this.steps,(e=>e.checkForUpdate()));return this._giveUpUpdateHasLowPriority?He.reduceWithLowPriorityGiveUp(e):He.reduceWithHighPriorityGiveUp(e)}}}(Me||(Me={})),function(e){class t extends Me.InSequence{static forPost(e,i){const o=s.forPost(e,i),n=r.forPost(e,i),a=c.forPost(e,i),l=u.forPost(e,i),d=p.forPost(e,i),h=Ve.FeedbackStep.forPost(e,i);return new t(e,o,n,a,l,d,h)}constructor(e,t,s,i,o,n,r){super(e,[t,s,i,o,n,r]),this.amsManyData=t,this.amsForward=s,this.urlPreview=i,this.chatPosts=o,this.propSets=n,this.feedback=r}}e.PostSubSteps=t;class s extends Me.InSequence{static forPost(e,t){if(t.amsUploads&&t.amsUploads.length){const i=o.map(t.amsUploads,((s,i)=>n.forPost(e,t,i))),r=Be.TranscodeVideoStep.forPost(e,t),a=Fe.EncryptFileStep.forPost(e,t),d=l.forPost(e,t);return new s(e,r,a,i,d)}}constructor(e,t,s,i,o){super(e,[t,s,...i,o]),this.post=e,this.transcodeVideo=t,this.encryptFile=s,this.amsSingleDatas=i,this.amsForwardUpload=o}}class n extends Me.InSequence{static forPost(e,t,s){if(t.amsUploads&&t.amsUploads[s]){const i=we.AmsCreateForegroundStep.forPost(e,t,s),o=we.AmsCreateStep.forPost(e,t,s),r=Pe.AmsThumbnailForegroundStep.forPost(e,t,s),a=Pe.AmsThumbnailStep.forPost(e,t,s),l=ke.AmsFullDataForegroundStep.forPost(e,t,s),d=ke.AmsFullDataStep.forPost(e,t,s);if(o&&(a||r||d||l))return new n(e,i,o,r,a,l,d,void 0)}}constructor(e,t,s,i,o,n,r,a){super(e,[t,s,i,o,n,r,a]),this.amsCreateForeground=t,this.amsCreate=s,this.amsThumbnailForeground=i,this.amsThumbnail=o,this.amsFullDataForeground=n,this.amsFullData=r,this.azureData=a}handleResponse(e,t,s,i,o,n,r){const a=super.handleResponse(e,t,s,i,o,n,r),l=o&&f.default.checkAuthFailure(i.statusCode,o,!1);return(307===i.statusCode||l)&&(G.log(ve,"Will redo Upload: "+this.post.persisted.id+", "+(l?"auth failure (possible redirect)":"redirect")),this.stop(!0)),a}}class r extends Me.InParallel{static forPost(e,t){if(t.forwardMediaInfos&&t.forwardMediaInfos.length>0){const s=o.map(e.persisted.forwardMediaInfos,(s=>a.forPost(e,t,s)));return new r(e,s)}}constructor(e,t){super(e,t),this.post=e,this._giveUpUpdateHasLowPriority=!1}}class a extends Me.InSequence{static forPost(e,t,s){if(t.forwardMediaInfos&&t.forwardMediaInfos.length>0){const i=xe.AmsGetStatusForwardStep.forPost(e,t,s),o=Re.AmsForwardContentStep.forPost(e,t,s);if(i&&o)return new a(e,s,i,o)}}constructor(e,t,s,i){super(e,[s,i]),this.post=e,this.info=t,this.amsGetStatusForward=s,this.amsForwardContent=i}handleResponse(e,t,s,i,o,n,r){const a=super.handleResponse(e,t,s,i,o,n,r),l=o&&f.default.checkAuthFailure(i.statusCode,o,!1);return(307===i.statusCode||l)&&(G.log(ve,"Will redo Forward: "+this.post.persisted.id+", objectId: "+this.info.objectId+", "+(l?"auth failure (possible redirect)":"redirect")),this.stop(!0)),a}}class l extends Me.InParallel{static forPost(e,t){const{forwardConvIds:s}=Je(t.conversationIds);if(e.isUploadNeeded()&&s.length){const i=o.map(s,(s=>d.forPost(e,t,s)));return new l(e,i)}}constructor(e,t){super(e,t),this.post=e,this._giveUpUpdateHasLowPriority=!1}}class d extends Me.InSequence{static forPost(e,t,s){if(e.isUploadNeeded()){const i=xe.AmsGetStatusForUploadStep.forPost(e,t,s),o=Re.AmsForwardContentForUploadStep.forPost(e,t,s);if(i&&o)return new d(e,s,i,o)}}constructor(e,t,s,i){super(e,[s,i]),this.post=e,this.convId=t,this.amsGetStatusForward=s,this.amsForwardContent=i}handleResponse(e,t,s,o,n,r,a){const l=super.handleResponse(e,t,s,o,n,r,a),d=n&&f.default.checkAuthFailure(o.statusCode,n,!1);return(307===o.statusCode||d)&&(G.log(ve,"Will redo Forward: "+this.post.persisted.id+", convId: "+i.pii.Mri(this.convId)+", "+(d?"auth failure (possible redirect)":"redirect")),this.stop(!0)),l}}class c extends Me.InParallel{static forPost(e,t){if(t.urlPreviewEndpoints&&t.urlPreviewEndpoints.length>0){const s=o.uniq(t.urlPreviewEndpoints),i=o.map(s,(s=>Oe.UrlPreviewsStep.forPost(e,t,s)));return new c(e,i)}}constructor(e,t){super(e,t),this._giveUpUpdateHasLowPriority=!1}checkForUpdate(){const e=super.checkForUpdate();return e.kind===je.GiveUp&&this.stop(!1),He.dontGiveUp(e)}}class h extends Me.InSequence{static forPost(e,t,s){return new h(e,s,Le.EncryptMessageStep.forPost(e,t,s),De.ChatPostForegroundStep.forPost(e,t,s),De.ChatPostTransferStep.forPost(e,t,s))}constructor(e,t,s,i,o){super(e,[s,i,o]),this.convId=t,this.encryptMessage=s,this.chatPostForegroundStep=i,this.chatPostTransferStep=o}}class u extends Me.InParallel{static forPost(e,t){const s=o.map(e.persisted.conversationIds,(s=>h.forPost(e,t,s)));return new u(e,s)}constructor(e,t){super(e,t),this._giveUpUpdateHasLowPriority=!0,this.chatPostInConv={},this.chatPostInConv=o.keyBy(t,(e=>e?e.convId:"undefined"))}isPostedToChat(e){const t=this.chatPostInConv[e];return!!t&&t.checkForUpdate().kind===je.Finished}handleResponse(e,t,s,i,n,r,a){const l=super.handleResponse(e,t,s,i,n,r,a);return o.every(this.chatPostInConv,(e=>{if(e){const t=e.checkForUpdate();switch(t.kind){case je.Finished:case je.GiveUp:return!0;case je.InProgress:case je.Blocked:case je.Update:return!1;default:pe.default.switchStatementExhaustiveChecking(t.kind)}}return!0}))&&G.log(ve,"Finished posting to Chat Service: "+this.post.persisted.id),l}}class p extends Me.InParallel{static forPost(e,t){if(t.urlPreviewPropSet){const s=o.map(e.persisted.conversationIds,(s=>Ee.MessagePropSetStep.forPost(e,t,s)));return new p(e,s)}}constructor(e,t){super(e,t),this._giveUpUpdateHasLowPriority=!0}checkForUpdate(){const e=super.checkForUpdate();return He.dontGiveUp(e)}}}(Ie||(Ie={})),t.pokePost=new u.default,function(e){function t(e,t){return!(!e.amsUploads||!e.amsUploads[t])}function s(e){return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1,fileSize:U.default.getAmsUploadFileSize(e),uploadFileType:e.amsUploadFileType}}function i(e){return e.body&&e.body.id}function o(e,t,s,o){const n=o&&S.ASMClient.getTracingHeaders(o);if(G.log(ve,"AmsCreateDocument completed: "+e.post.persisted.id+", for: "+e.stepSelector+", success: "+t+", Document ID: "+i(s)+", from "+Ye(e)+", tracing:"+JSON.stringify(n)),t){e.persisted.amsDocumentIds||(e.persisted.amsDocumentIds=[]);const t=i(s);e.persisted.amsDocumentIds[e.amsUploadIndex]=t,t?ze.updateAmsCreateReferences(e.post):G.warn(ve,"was not given amsDocumentId for successfully created document")}else f.default.checkAuthFailure(s.statusCode,o)}function n(e,t){e&&t.persisted.amsDocumentIds&&(t.persisted.amsDocumentIds[t.amsUploadIndex]=void 0)}function r(e){return{step:Ue.AmsDocumentCreated}}e.AmsCreateForegroundStepType="postingService_amsCreateForeground",e.AmsCreateTransferType="postingService_amsCreate";class a extends qe{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o)&&Xe(!0))return new a(s,i,e.AmsCreateForegroundStepType,o)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return s(this.getAmsUpload())}_status(e){return e&&(this.persisted.amsCreateDocumentForegroundRequests||(this.persisted.amsCreateDocumentForegroundRequests={}),this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex]||(this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex]={finished:!1,finishedSuccess:!1})),this.persisted.amsCreateDocumentForegroundRequests&&this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex]}_startForegroundRequestOrFinish(){if(!$e())return;this.persisted.amsCreateDocumentBackgroundIds||(this.persisted.amsCreateDocumentBackgroundIds={}),this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]||(this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]=pe.default.newGuid());const e=this.getAmsUpload(),{uploadConvIds:t}=Je(this.post.persisted.conversationIds);return f.default.createDocumentAsync(t,e.amsUploadFilename,e.amsUploadFileType,void 0,this.persisted.transactionId,this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex],Ce.timeout)}_overrideSuccess(e,t){return e&&!!i(t)}_handleResponse(e,t,s){o(this,e,t,s)}stop(e){super.stop(e),n(e,this)}_telemetryInfo(e){return r()}}e.AmsCreateForegroundStep=a;class l extends Ke{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o))return new l(s,i,e.AmsCreateTransferType,o)}getAmsUpload(){return this.persisted.amsUploads[this.stepSelector]}_config(){return s(this.getAmsUpload())}transfer(){return this.persisted.amsCreateDocumentBackgroundTransfers&&this.persisted.amsCreateDocumentBackgroundTransfers[this.amsUploadIndex]}checkForUpdate(){return this.persisted.amsCreateDocumentForegroundRequests&&this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex]&&this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex].finishedSuccess?He.Finished:super.checkForUpdate()}_start(){this.persisted.amsCreateDocumentBackgroundIds||(this.persisted.amsCreateDocumentBackgroundIds={}),this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]||(this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]=pe.default.newGuid()),this.persisted.amsCreateDocumentBackgroundTransfers||(this.persisted.amsCreateDocumentBackgroundTransfers={});const e=Object.assign(Object.assign({},Ce),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]}),t=this.getAmsUpload(),{uploadConvIds:s}=Je(this.post.persisted.conversationIds),i=this.transfer(),o=f.default.createDocumentBackground(this.stepType,{postId:this.post.persisted.id,stepSelector:this.stepSelector},s,t.amsUploadFilename,t.amsUploadFileType,void 0,e);this.persisted.amsCreateDocumentBackgroundTransfers[this.amsUploadIndex]=this._createTrackedBackgroundTransfer(o,i)}_overrideSuccess(e,t){return e&&!!i(t)}_handleResponse(e,t,s){o(this,e,t,s)}stop(e){super.stop(e),n(e,this)}_telemetryInfo(e){return r()}}e.AmsCreateStep=l}(we||(we={})),function(e){function t(e,t){return!(!e.amsUploads||!e.amsUploads[t])&&!!e.amsUploads[t].amsUploadThumbnailData}function s(e){return{needValidSkypeToken:!0,emptyResponse:!0,shimChatServiceResponse:!1,canBlockOthersInConv:!1,fileSize:e.amsUploadThumbnailData.file.size,uploadFileType:re.UploadFileType.Thumbnail}}function i(e,t,s,i){const o=i&&S.ASMClient.getTracingHeaders(i);G.log(ve,"AmsUploadThumbContent completed: "+e.post.persisted.id+", for: "+e.stepSelector+", success: "+t+", from "+Ye(e)+", tracing:"+JSON.stringify(o)),t||f.default.checkAuthFailure(s.statusCode,i),it(e.post.persisted.id,e.amsUploadIndex,!0,t,!1)}function o(e){return{step:Ue.AmsThumbContentUploaded,attributes:{success:e}}}e.AmsThumbnailTransferType="postingService_amsUpThumbContent",e.AmsThumbnailForegroundStepType="postingService_amsUpThumbContentForeground";class n extends qe{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o)&&Xe(!0))return new n(s,i,e.AmsThumbnailForegroundStepType,o)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return s(this.getAmsUpload())}_status(e){return e&&(this.persisted.amsThumbnailDocumentForegroundRequests||(this.persisted.amsThumbnailDocumentForegroundRequests={}),this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex]||(this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex]={finished:!1,finishedSuccess:!1})),this.persisted.amsThumbnailDocumentForegroundRequests&&this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex]}_startForegroundRequestOrFinish(){if(!$e())return;this.persisted.amsThumbnailBackgroundIds||(this.persisted.amsThumbnailBackgroundIds={}),this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]||(this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]=pe.default.newGuid());const e=this.persisted.amsDocumentIds[this.amsUploadIndex],t=this.getAmsUpload();return it(this.post.persisted.id,this.amsUploadIndex,!1,!1,!1),f.default.uploadDocumentAsync(e,re.UploadFileType.Thumbnail,tt(t.amsUploadThumbnailData,t.amsThumbnailLocalUrl).file,(e=>it(this.post.persisted.id,this.amsUploadIndex,!1,!1,!1,e)),this.persisted.transactionId,this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex])}_handleResponse(e,t,s){i(this,e,t,s)}stop(e){super.stop(e)}_telemetryInfo(e){return o(e)}}e.AmsThumbnailForegroundStep=n;class r extends Ke{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o))return new r(s,i,e.AmsThumbnailTransferType,o)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return s(this.getAmsUpload())}transfer(){return this.persisted.amsThumbnailBackgroundTransfers&&this.persisted.amsThumbnailBackgroundTransfers[this.amsUploadIndex]}checkForUpdate(){return this.persisted.amsThumbnailDocumentForegroundRequests&&this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex]&&this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex].finishedSuccess?He.Finished:super.checkForUpdate()}_start(){this.persisted.amsThumbnailBackgroundIds||(this.persisted.amsThumbnailBackgroundIds={}),this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]||(this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]=pe.default.newGuid()),this.persisted.amsThumbnailBackgroundTransfers||(this.persisted.amsThumbnailBackgroundTransfers={});const e=Object.assign(Object.assign({},_e),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]}),t=this.persisted.amsDocumentIds[this.amsUploadIndex],s=this.getAmsUpload(),i=this.transfer(),o=f.default.uploadDocumentBackground(this.stepType,{postId:this.post.persisted.id,stepSelector:this.stepSelector},t,re.UploadFileType.Thumbnail,tt(s.amsUploadThumbnailData,s.amsThumbnailLocalUrl).file,e);this.persisted.amsThumbnailBackgroundTransfers[this.amsUploadIndex]=this._createTrackedBackgroundTransfer(o,i)}_handleResponse(e,t,s){i(this,e,t,s)}stop(e){super.stop(e)}_telemetryInfo(e){return o(e)}}e.AmsThumbnailStep=r}(Pe||(Pe={})),function(e){function t(e,t){return!!(e.amsUploads&&e.amsUploads[t]&&e.amsUploads[t].amsUploadFullData)}function s(e,t){const s=e&&e[t],i=m.default.getS4LCMCFeatures();return!!(s&&s.amsUploadFileType&&i.resumableUploads.enabled)&&o.some(i.resumableUploads.types,(e=>s.amsUploadFileType===re.UploadFileType[e]))}function i(e){return{needValidSkypeToken:!0,emptyResponse:!0,shimChatServiceResponse:!1,canBlockOthersInConv:!1,fileSize:U.default.getAmsUploadFileSize(e),uploadFileType:e.amsUploadFileType}}function n(e,t,s,i,n){const r=i&&S.ASMClient.getTracingHeaders(i);G.log(ve,"AmsUploadFullContent completed: "+e.post.persisted.id+", for: "+e.stepSelector+", success: "+t+", from "+Ye(e)+", tracing:"+JSON.stringify(r));const a=e.persisted.amsDocumentIds[e.amsUploadIndex],l=e.getAmsUpload(),d=e.persisted.instrumentation_uploadStartTimes[e.amsUploadIndex],c=Date.now()-d,h=j.default.extractFileExtension(l.amsUploadFilename,!0),u=y.getDownloadViewId(l.amsUploadFileType,re.MediaViewSize.Full),p=t?V.MessagingFailureReason.None:V.MessagingFailureReason.AMSFailure,g=U.default.getAmsUploadFileSize(l),m=new K.FileSent(e.post.persisted.conversationIds,e.persisted.instrumentation_postSource,de.default.changeExtensionForTelemetry(h),g,u,a,e.post.persisted.messagesForPosting);m.setSuccess(t,p,n,s.statusCode,d,c),G.track(m),t?(We.updateMessageUrls(e.post,a,void 0),o.each(e.post.persisted.messagesForPosting,((e,t)=>{T.default.applyMessageLie(t,e)}))):f.default.checkAuthFailure(s.statusCode,i),it(e.post.persisted.id,e.amsUploadIndex,!0,t,!0)}function r(e){return{step:Ue.AmsFullContentUploaded,attributes:{success:e}}}e.AmsFullDataTransferType="postingService_amsUpFullContent",e.AmsFullDataForegroundStepType="postingService_amsUpFullContentForeground";class a extends qe{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(i,o,n){if(t(o,n)&&Xe(!0)&&!s(o.amsUploads,n))return new a(i,o,e.AmsFullDataForegroundStepType,n)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return i(this.getAmsUpload())}_status(e){return e&&(this.persisted.amsFullDataDocumentForegroundRequests||(this.persisted.amsFullDataDocumentForegroundRequests={}),this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex]||(this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex]={finished:!1,finishedSuccess:!1})),this.persisted.amsFullDataDocumentForegroundRequests&&this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex]}_startForegroundRequestOrFinish(){if(!$e())return;this.persisted.instrumentation_uploadStartTimes||(this.persisted.instrumentation_uploadStartTimes={}),this.persisted.instrumentation_uploadStartTimes[this.amsUploadIndex]=Date.now(),this.persisted.amsFullDataBackgroundIds||(this.persisted.amsFullDataBackgroundIds={}),this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex]||(this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex]=pe.default.newGuid());const e=this.persisted.amsDocumentIds[this.amsUploadIndex],t=this.getAmsUpload();return it(this.post.persisted.id,this.amsUploadIndex,!1,!1,!0),f.default.uploadDocumentAsync(e,t.amsUploadFileType,tt(t.amsUploadFullData,t.amsFullDataLocalUrl).file,(e=>it(this.post.persisted.id,this.amsUploadIndex,!1,!1,!0,e)),this.persisted.transactionId,this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex])}_handleResponse(e,t,s){n(this,e,t,s,1)}stop(e){super.stop(e)}_telemetryInfo(e){return r(e)}}e.AmsFullDataForegroundStep=a;class l extends Ke{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o))return new l(s,i,e.AmsFullDataTransferType,o)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return i(this.getAmsUpload())}transfer(){return this.persisted.amsFullDataBackgroundTransfers&&this.persisted.amsFullDataBackgroundTransfers[this.amsUploadIndex]}checkForUpdate(){return this.persisted.amsFullDataDocumentForegroundRequests&&this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex]&&this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex].finishedSuccess?He.Finished:super.checkForUpdate()}_start(){this.persisted.instrumentation_uploadStartTimes||(this.persisted.instrumentation_uploadStartTimes={}),this.persisted.instrumentation_uploadStartTimes[this.amsUploadIndex]=Date.now(),this.persisted.amsFullDataBackgroundIds||(this.persisted.amsFullDataBackgroundIds={}),this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex]||(this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex]=pe.default.newGuid()),this.persisted.amsFullDataBackgroundTransfers||(this.persisted.amsFullDataBackgroundTransfers={});const e=this.getAmsUpload(),t=this.persisted.amsDocumentIds[this.amsUploadIndex],i=s(this.persisted.amsUploads,this.amsUploadIndex),o=y.getUploadStatusUrl(t,e.amsUploadFileType),n=this.persisted.amsFullDataBackgroundTransfers&&this.persisted.amsFullDataBackgroundTransfers[this.amsUploadIndex],r=n?n.finishedAttemptsSoFarCount:0,a=Object.assign(Object.assign({},_e),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex],resumable:i,resumableUploadStatusUrl:o,resumableAttemptsSoFar:r}),l=this.transfer(),d=f.default.uploadDocumentBackground(this.stepType,{postId:this.post.persisted.id,stepSelector:this.stepSelector},t,e.amsUploadFileType,tt(e.amsUploadFullData,e.amsFullDataLocalUrl).file,a);this.persisted.amsFullDataBackgroundTransfers[this.amsUploadIndex]=this._createTrackedBackgroundTransfer(d,l)}_handleResponse(e,t,s){n(this,e,t,s,this.transfer().finishedAttemptsSoFarCount)}stop(e){super.stop(e)}_telemetryInfo(e){return r(e)}}e.AmsFullDataStep=l}(ke||(ke={})),function(e){e.AzureDataTransferType="postingService_azureUp";e.AzureDataStep=class extends Ke{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){const e=this.getAmsUpload();return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1,fileSize:U.default.getAmsUploadFileSize(e),uploadFileType:e.amsUploadFileType}}transfer(){return this.persisted.azureBackgroundTransfers&&this.persisted.azureBackgroundTransfers[this.amsUploadIndex]}_start(){this.persisted.azureBackgroundTransfers||(this.persisted.azureBackgroundTransfers={});const e=this.getAmsUpload(),t=this.transfer(),s=v.default.uploadDocumentBackground(this.stepType,{postId:this.post.persisted.id,stepSelector:this.stepSelector},tt(e.amsUploadFullData,e.amsFullDataLocalUrl).file,_e);this.persisted.azureBackgroundTransfers[this.amsUploadIndex]=this._createTrackedBackgroundTransfer(s,t)}_handleResponse(e,t,s){if(G.log(ve,"AzureUpload completed: "+this.post.persisted.id+", for: "+this.stepSelector+", success: "+e+", videoId: "+(e&&t.body?t.body.id:void 0)),e){this.persisted.azureMSUrls||(this.persisted.azureMSUrls={});const e=t.body;this.persisted.azureMSUrls[this.amsUploadIndex]=v.default.getVideoUrl(e.id);const s=this.persisted.amsDocumentIds[this.amsUploadIndex];We.updateMessageUrls(this.post,s,this.persisted.azureMSUrls[this.amsUploadIndex]),o.each(this.post.persisted.messagesForPosting,((e,t)=>{T.default.applyMessageLie(t,e)}))}else f.default.checkAuthFailure(t.statusCode,s)}stop(e){super.stop(e),this.persisted.azureMSUrls&&(this.persisted.azureMSUrls[this.amsUploadIndex]=void 0)}_telemetryInfo(e){return{step:Ue.AzureUploadCompleted,attributes:{success:e}}}}}(Ae||(Ae={})),function(e){e.AmsGetStatusForwardTransferType="postingService_getStatusForward",e.AmsGetStatusForwardUploadTransferType="postingService_getStatusForwardUpload",e.parseBackgroundContextForForward=function(e){if(e.postId&&e.objectId)return{postId:e.postId,stepSelector:e.objectId}},e.parseBackgroundContextForUpload=function(e){if(e.postId&&e.convId)return{postId:e.postId,stepSelector:e.convId}},e.parseBackgroundContextForServerTranscoding=function(e){if(e.postId&&e.objectId)return{postId:e.postId,stepSelector:"0"}};class t extends Ke{_config(){return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1}}transfer(){return this.persisted.amsGetStatusBackgroundTransfers||(this.persisted.amsGetStatusBackgroundTransfers={}),this.persisted.amsGetStatusBackgroundTransfers[this.stepSelector]}_start(){const e=this.objectId();this.persisted.amsGetStatusBackgroundIds||(this.persisted.amsGetStatusBackgroundIds={}),this.persisted.amsGetStatusBackgroundIds[this.stepSelector]||(this.persisted.amsGetStatusBackgroundIds[this.stepSelector]=pe.default.newGuid()),this.persisted.amsGetStatusBackgroundTransfers||(this.persisted.amsGetStatusBackgroundTransfers={});const t=this.context(),s=this.getDownloadViewId(),i=Object.assign(Object.assign({},Ce),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsGetStatusBackgroundIds[this.stepSelector]}),o=this.transfer(),n=f.default.getStatusBackground(this.stepType,t,e,s,i);this.persisted.amsGetStatusBackgroundTransfers[this.stepSelector]=this._createTrackedBackgroundTransfer(n,o)}_handleResponse(e,t,s){const i=s&&S.ASMClient.getTracingHeaders(s);G.log(ve,"AmsGetStatus completed: "+this.post.persisted.id+", for: "+this.stepSelector+", objectId: "+this.objectId()+", success: "+e+", amsStatusLocation: "+(e&&t.body?t.body.status_location:void 0)+", tracing:"+JSON.stringify(i)),e?(this.persisted.amsStatusLocations||(this.persisted.amsStatusLocations={}),this.persisted.amsStatusLocations[this.stepSelector]=t.body.status_location):f.default.checkAuthFailure(t.statusCode,s)}_makeExponentialTime(e,t){const s=m.default.getS4LCMCFeatures().retryPolicy.constantPollTime[t];return o.isNumber(s)?new h.ExponentialTime(s,this._getMaxTransferTime(e,t),0):super._makeExponentialTime(e,t)}stop(e){super.stop(e),this.persisted.amsStatusLocations&&delete this.persisted.amsStatusLocations[this.stepSelector]}}class s extends t{constructor(){super(...arguments),this.forwardMediaInfo=We.getForwardMessageMediaInfo(this.post.persisted.forwardMediaInfos,this.objectId())}static forPost(t,i,o){if(i.forwardMediaInfos&&i.forwardMediaInfos.length>0)return new s(t,i,e.AmsGetStatusForwardTransferType,o.objectId)}objectId(){return this.stepSelector}getDownloadViewId(){return this.forwardMediaInfo.viewId||y.getDownloadViewId(this.forwardMediaInfo.fileType)}context(){return{postId:this.post.persisted.id,objectId:this.objectId()}}_telemetryInfo(e){return{step:Ue.AmsGotStatusForward,attributes:{success:e}}}}e.AmsGetStatusForwardStep=s;class i extends t{constructor(){super(...arguments),this.convId=this.stepSelector}static forPost(t,s,n){const{forwardConvIds:r}=Je(s.conversationIds);if(t.isUploadNeeded()&&o.includes(r,n))return new i(t,s,e.AmsGetStatusForwardUploadTransferType,n)}objectId(){return this.persisted.amsDocumentIds[0]}getDownloadViewId(){return y.getDownloadViewId(this.persisted.amsUploads[0].amsUploadFileType)}context(){return{postId:this.post.persisted.id,convId:this.convId}}_telemetryInfo(e){return{step:Ue.AmsGotStatusForwardUpload,attributes:{success:e}}}}e.AmsGetStatusForUploadStep=i}(xe||(xe={})),function(e){e.AmsForwardContentTransferType="postingService_amsForward",e.AmsForwardContentUploadTransferType="postingService_amsForwardUpload",e.parseBackgroundContextForForward=function(e){if(e.postId&&e.objectId)return{postId:e.postId,stepSelector:e.objectId}},e.parseBackgroundContextForUpload=function(e){if(e.postId&&e.convId)return{postId:e.postId,stepSelector:e.convId}};class t extends Ke{_config(){return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1}}transfer(){return this.persisted.amsForwardBackgroundTransfers||(this.persisted.amsForwardBackgroundTransfers={}),this.persisted.amsForwardBackgroundTransfers[this.stepSelector]}_start(){const e=this.objectId();this.persisted.amsForwardBackgroundIds||(this.persisted.amsForwardBackgroundIds={}),this.persisted.amsForwardBackgroundIds[this.stepSelector]||(this.persisted.amsForwardBackgroundIds[this.stepSelector]=pe.default.newGuid()),this.persisted.amsForwardBackgroundTransfers||(this.persisted.amsForwardBackgroundTransfers={});const t=this.context(),s=Object.assign(Object.assign({},Ce),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsForwardBackgroundIds[this.stepSelector]}),i=this.persisted.amsStatusLocations[this.stepSelector],o=this.transfer(),n=f.default.forwardMediaBackground(this.stepType,t,i,[this.convId],e,s);this.persisted.amsForwardBackgroundTransfers[this.stepSelector]=this._createTrackedBackgroundTransfer(n,o)}_handleResponse(e,t,s){const i=s&&S.ASMClient.getTracingHeaders(s);if(G.log(ve,"AmsForwardDocument completed: "+this.post.persisted.id+", for: "+this.stepSelector+", objectId: "+this.objectId()+", success: "+e+", Document ID: "+(e&&t.body?t.body.id:void 0)+", tracing:"+JSON.stringify(i)),e){this.persisted.amsForwardDocumentIds||(this.persisted.amsForwardDocumentIds={});const e=t.body.id;this.persisted.amsForwardDocumentIds[this.stepSelector]=e,We.updateMessageUrls(this.post,this.persisted.amsForwardDocumentIds[this.stepSelector],void 0,this.objectId(),this.convId)}else f.default.checkAuthFailure(t.statusCode,s)}stop(e){super.stop(e),this.persisted.amsForwardDocumentIds&&delete this.persisted.amsForwardDocumentIds[this.stepSelector]}}class s extends t{constructor(){super(...arguments),this.convId=this.post.persisted.conversationIds[0]}static forPost(t,i,o){if(i.forwardMediaInfos&&i.forwardMediaInfos.length>0)return new s(t,i,e.AmsForwardContentTransferType,o.objectId)}objectId(){return this.stepSelector}context(){return{postId:this.post.persisted.id,objectId:this.objectId()}}_handleResponse(e,t,s){super._handleResponse(e,t,s),e&&(ze.updateAmsForwardObjectsReferences(this.post),o.each(this.post.persisted.messagesForPosting,((e,t)=>{T.default.applyMessageLie(t,e)})))}_telemetryInfo(e){return{step:Ue.Forwarded,attributes:{success:e}}}}e.AmsForwardContentStep=s;class i extends t{constructor(){super(...arguments),this.convId=this.stepSelector}static forPost(t,s,n){const{forwardConvIds:r}=Je(s.conversationIds);if(t.isUploadNeeded()&&o.includes(r,n))return new i(t,s,e.AmsForwardContentUploadTransferType,n)}objectId(){return this.persisted.amsDocumentIds[0]}context(){return{postId:this.post.persisted.id,convId:this.convId}}_handleResponse(e,t,s){super._handleResponse(e,t,s),e&&(ze.updateAmsForwardUploadReferences(this.post,this.convId),T.default.applyMessageLie(this.convId,this.post.persisted.messagesForPosting[this.convId]))}_telemetryInfo(e){return{step:Ue.ForwardedUpload,attributes:{success:e}}}}e.AmsForwardContentForUploadStep=i}(Re||(Re={})),function(e){e.UrlPreviewsTransferType="postingService_urlPreviewFetching",e.parseBackgroundContext=function(e){if(e.postId&&e.endpoint)return{postId:e.postId,stepSelector:e.endpoint}};class t extends Ke{constructor(){super(...arguments),this.endpoint=this.stepSelector}static forPost(s,i,o){if(i.urlPreviewEndpoints&&i.urlPreviewEndpoints.length>0)return new t(s,i,e.UrlPreviewsTransferType,o)}_config(){return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1}}transfer(){return this.persisted.urlPreviewBackgroundTransfer||(this.persisted.urlPreviewBackgroundTransfer={}),this.persisted.urlPreviewBackgroundTransfer[this.endpoint]}_start(){this.persisted.urlPreviewBackgroundId||(this.persisted.urlPreviewBackgroundId={}),this.persisted.urlPreviewBackgroundId[this.endpoint]||(this.persisted.urlPreviewBackgroundId[this.endpoint]=pe.default.newGuid()),this.persisted.urlPreviewBackgroundTransfer||(this.persisted.urlPreviewBackgroundTransfer={}),o.each(this.post.telemetryScenarios,(e=>{const t="UrlPreviewFetchingStarted";e.isStepMarked(t)||e.markStepCompleted(t)}));const e=Object.assign(Object.assign({},Ce),{timeout:void 0,transactionId:this.persisted.transactionId,correlationId:this.persisted.urlPreviewBackgroundId[this.endpoint]}),t={postId:this.post.persisted.id,endpoint:this.endpoint};this._requestStartTimes||(this._requestStartTimes={});const s=this.transfer(),i=Date.now(),n=ce.default.getUrlInfoBackground(this.stepType,t,this.endpoint,e);this._requestStartTimes[n]=i,this.persisted.urlPreviewBackgroundTransfer[this.endpoint]=this._createTrackedBackgroundTransfer(n,s)}_handleResponse(e,t,s){const n=s&&S.ASMClient.getTracingHeaders(s);G.log(ve,"UrlPreviewFetching completed: "+this.post.persisted.id+", endpoint: "+i.pii.Omit(this.endpoint)+", success: "+e+", url:"+(e&&t.body?i.pii.Omit(t.body.url):void 0)+", tracing:"+JSON.stringify(n));const r=this.transfer(),a=r.finishedAttemptsSoFarCount;e?o.each(this.post.persisted.messagesForPosting,((e,s)=>{this._updateMessagePropertiesWithUrlPreviewMetadata(s,e,{key:t.body.url,value:t.body});const i=this.post.telemetryScenarios&&this.post.telemetryScenarios[s];let o;this._requestStartTimes&&void 0!==r.id&&(o=Date.now()-this._requestStartTimes[r.id]);const n=new he.UrlPreviewReceived(t.url,t.body,a-1,o);G.track(n);const l="UrlPreviewFetchingFinished";i&&!i.isStepMarked(l)&&i.markStepCompleted(l)})):this._getRetryInfo(this.post.persisted.id,this.stepType)&&o.each(this.post.persisted.messagesForPosting,((e,s)=>{const i=t.errorInfo||"Unknown",o=new he.UrlPreviewFailed(t.url,a,i);G.track(o)}))}_updateMessagePropertiesWithUrlPreviewMetadata(e,t,s){const n=this.post.persisted.urlPreviewPropSet,r=o.cloneDeep(t);r.properties||(r.properties={});const a=M.MessageProperties.UrlPreviews,l=n?{[a]:n.urlPreviewJson}:r.properties;let d=M.getJsonFromMessageProperty(l,a);s&&(d?d.push(s):d=[s]);const c=JSON.stringify(d);if(G.log(ve,"Updating message properties with URLP metadata: "+this.post.persisted.id+(s&&s.value?", Initializing with:"+i.pii.Omit(JSON.stringify(s.value)):", Initializing with no data")),n){n.urlPreviewJson=c;const s=P.getCuidForMessage(t);T.default.setMessagePropertyLie(e,s,a,c)}else{r.properties[M.MessageProperties.UrlPreviews]=c;const t=r;this.post.persisted.messagesForPosting[e]=t,T.default.applyMessageLie(e,t)}}stop(e){super.stop(e)}_telemetryInfo(e){}}e.UrlPreviewsStep=t}(Oe||(Oe={})),function(e){e.EncryptionStepType="postingService_encryptPost";class s{static forPost(e,t,i){return P.isEncryptedThread(i)?new s(e,t,i):void 0}constructor(t,s,i){this.post=t,this.persisted=s,this.convId=i,this.stepType=e.EncryptionStepType,this.stepSelector=this.convId}checkForUpdate(){this.persisted.encryptionStatus||(this.persisted.encryptionStatus={}),this.persisted.encryptionStatus[this.convId]||(this.persisted.encryptionStatus[this.convId]=be.NotStarted);const e=this.persisted.encryptionStatus[this.convId];switch(e){case be.Success:return He.Finished;case be.NotStarted:return He.NeedTo.startSteps(this);case be.InProgress:return He.NeedTo.waitForProgress(this);case be.Failure:return He.NeedTo.giveUpBecauseStep(this,x.FailureReason.Permanent);default:return pe.default.switchStatementExhaustiveChecking(e)}}start(){this.persisted.encryptionStatus||(this.persisted.encryptionStatus={}),this.persisted.encryptionStatus[this.convId]||(this.persisted.encryptionStatus[this.convId]=be.NotStarted);const e=this.convId;this.persisted.encryptionStatus[this.convId]=be.InProgress,this._encryptPromise=T.default.getConversationMetaAsync(e).then((t=>{if(!t)return p.Rejected();const s=this.post.persisted.messagesForPosting[e];if(!s)return p.Rejected(`Can't find message for posting in conversation ${e}`);const i=this._mapToEncryptedType(s.messagetype);let o;if(i===M.MessageTypes.EncryptedMedia){const t=this.persisted.amsUploadEncryptionKey64,i=this.persisted.amsUploadEncryptionIV64,n=this.persisted.amsUploadEncryptionAuthKey64,r=this.persisted.amsUploadEncryptionHMAC64,a=this.persisted.amsUploadEncryptionHash64;if(!(t&&i&&n&&r&&a))return p.Rejected("Missing key material for encrypted media");const l={originalContent:s.content,fileKey64:t,fileIv64:i,fileAuthKey64:n,fileHMAC64:r,fileHash64:a};o=JSON.stringify(l),this._updateMessageWithFileKeys(e,this.post.persisted.messagesForPosting[e],{fileKey64:t,fileIv64:i,fileAuthKey64:n,fileHMAC64:r,fileHash64:a})}else o=s.content;return L.default.encryptMessageForConv(t.conv,o).then((t=>{const o=Object.assign(Object.assign({},s),{content:t.ciphertext,messagetype:i,fromdeviceid:D.default.getDeviceId(),encryptedkey:t.keys});this.post.persisted.messagesForPosting[e]=o,this.persisted.encryptionStatus[this.convId]=be.Success}))})).catch((t=>{const s=oe.default.errorAsString(t);this.persisted.encryptionStatus[this.convId]=be.Failure,G.error(ve,`Failed to encrypt post ${this.post.persisted.id} for conversation ${i.pii.Mri(e)}`,s),G.track(new B.E2eeEncryptionFailure(s)),F.default.sendReject(e,V.E2EERejectionReason.EncryptionFailed)})).finally((()=>{t.pokePost.fire(this.post.persisted.id)}))}stop(e){this._encryptPromise&&(this._encryptPromise.cancel(),this._encryptPromise=void 0),e&&this.persisted.encryptionStatus&&(this.persisted.encryptionStatus[this.convId]=be.NotStarted)}cleanup(){this.stop(!1)}_updateMessageWithFileKeys(e,t,s){const i=P.getCuidForMessage(t);T.default.setFileEncryptionKeys(e,i,s)}_mapToEncryptedType(e){switch(e){case M.MessageTypes.Media_GenericFile:case M.MessageTypes.UriObject:return M.MessageTypes.EncryptedMedia;case M.MessageTypes.Call:return M.MessageTypes.EncryptedCall;default:return M.MessageTypes.EncryptedText}}}e.EncryptMessageStep=s}(Le||(Le={})),function(e){e.FileEncryptionStepType="postingService_encryptFile";class s{static forPost(e,t){return P.isEncryptedThread(t.conversationIds[0])&&t.amsUploads&&t.amsUploads[0]?new s(e,t):void 0}constructor(t,s){this.post=t,this.persisted=s,this.stepType=e.FileEncryptionStepType,this.persisted.fileEncryptionStatus=be.NotStarted}getAmsUpload(){return this.persisted.amsUploads[0]}checkForUpdate(){const e=this.persisted.fileEncryptionStatus;switch(e){case be.Success:return He.Finished;case be.NotStarted:return He.NeedTo.startSteps(this);case be.InProgress:return He.NeedTo.waitForProgress(this);case be.Failure:return He.NeedTo.giveUpBecauseStep(this,x.FailureReason.Permanent);default:return pe.default.switchStatementExhaustiveChecking(e)}}start(){this.persisted.fileEncryptionStatus=be.InProgress;const e=this.getAmsUpload(),s=tt(e.amsUploadFullData,e.amsFullDataLocalUrl).file,i=void 0===s.uri,n=i?s.path:s.uri,r=pe.default.newGuid()+".bin";this._encryptPromise=c.FileEncryption.getTempLocation(r).then((t=>{const a=new Uint8Array(l.getRandomValues(new Array(16))),d=new Uint8Array(l.getRandomValues(new Array(32))),h=new Uint8Array(l.getRandomValues(new Array(32))),u=o.toArray(d),p=o.toArray(a),g=o.toArray(h);let m;const S=Date.now();return(i?E.encryptFileInMemory(s,"aes-cbc",a,d,h).then((e=>(m=e.validation,new File([e.blob],r)))):c.FileEncryption.encryptFile(n,t,c.FileEncryption.getDefaultAlgo(),p,u,g).then((s=>(m=s,Object.assign(Object.assign({},e.amsUploadFullData.file),{name:r,type:"blob",uri:t}))))).then((e=>{G.log(ve,`File encryption took ${Date.now()-S}ms`),this.persisted.amsUploads=o.map(this.persisted.amsUploads,((s,i)=>0===i?st(s,t,{file:e,extension:"bin"},r,re.UploadFileType.File):s)),this.persisted.amsUploadEncryptionKey64=O.byteArrayToBase64String(u),this.persisted.amsUploadEncryptionIV64=O.byteArrayToBase64String(p),this.persisted.amsUploadEncryptionAuthKey64=O.byteArrayToBase64String(g),this.persisted.amsUploadEncryptionHMAC64=O.byteArrayToBase64String(m.hmac),this.persisted.amsUploadEncryptionHash64=O.byteArrayToBase64String(m.hash),this.persisted.fileEncryptionStatus=be.Success}))})).catch((e=>{const t=oe.default.errorAsString(e);this.persisted.fileEncryptionStatus=be.Failure,G.error(ve,`Failed to encrypt file for post ${this.post.persisted.id}`,t),G.track(new B.E2eeEncryptionFailure(t))})).finally((()=>{t.pokePost.fire(this.post.persisted.id)}))}stop(e){this._encryptPromise&&(this._encryptPromise.cancel(),this._encryptPromise=void 0),e&&(this.persisted.fileEncryptionStatus=be.NotStarted)}cleanup(){this.stop(!1)}}e.EncryptFileStep=s}(Fe||(Fe={})),function(e){e.VideoTranscodingStepType="postingService_transcodeVideo";class s{static forPost(e,t){const i=t.amsUploads&&t.amsUploads[0];return i&&me.default.shouldReencodeUpload(i.amsUploadFileType,i.videoOverlayUrl)?new s(e,t):void 0}constructor(t,s){this.post=t,this.persisted=s,this.stepType=e.VideoTranscodingStepType,this._onReencodingProgressUpdate=(e,t)=>{this.persisted.transcodingSessionId===e&&(this.persisted.estimatedVideoUploadSize=t.estimatedSize,t.type===n.ReencodeProgressType.Fetch&&t.progress>0&&t.progress<1&&(this.persisted.wasFetchedFromiCloud=!0))},this.persisted.transcodingStatus&&this.persisted.transcodingStatus===Te.Success||(this.persisted.transcodingStatus=Te.NotStarted)}getAmsUpload(){return this.persisted.amsUploads[0]}setAmsUpload(e){this.persisted.amsUploads[0]=e}checkForUpdate(){const e=this.persisted.transcodingStatus;switch(e){case void 0:case Te.Success:return He.Finished;case Te.NotStarted:return He.NeedTo.startSteps(this);case Te.InProgress:return He.NeedTo.waitForProgress(this);case Te.Failure:return He.NeedTo.giveUpBecauseStep(this,x.FailureReason.Permanent);default:return pe.default.switchStatementExhaustiveChecking(e)}}start(){const e=pe.default.newCauseId();G.log(ve,"TranscodeVideoStep.start causeId:",e),this.persisted.transcodingStatus=Te.InProgress;const s=this.getAmsUpload();if(me.default.shouldReencodeUpload(s.amsUploadFileType,s.videoOverlayUrl)){this._reencodeProgressSubscription=ge.videoManipulationProgressChangedEvent.subscribe(this._onReencodingProgressUpdate);const i=new Q.ReencodeSession;i.setTransactionID(this.persisted.transactionId),i.setVideoDuration(this.persisted.videoDuration||0),s.amsUploadFullData.dimensions&&i.setSourceDimensions(s.amsUploadFullData.dimensions),i.setSourceFileSize(s.amsUploadFullData.file.size||0),i.setHasOverlay(!!s.videoOverlayUrl);const r=tt(s.amsUploadFullData,s.amsFullDataLocalUrl).file,a=void 0===r.uri?r.path:r.uri,l=s.videoOverlayUrl||a,d=me.default.reencodeOptions(),c=ge.default.saveVideoWithoutView(a,l,d,e,i);this.persisted.transcodingSessionId=c.sessionId,c.manipulationPromise.then((t=>{t.sourceFileSize!==t.fileSize?(G.log(ve,`TranscodeVideoStep.start reencodeVideo success causeId: ${e}`),o.each(this.post.telemetryScenarios,(e=>{t.scenarioAttributes&&e.extendProperties(t.scenarioAttributes)}))):G.log(ve,"TranscodeVideoStep.start encoding looked like a noop");const i=Object.assign(Object.assign({},s.amsUploadFullData),{file:Object.assign(Object.assign({},s.amsUploadFullData.file),{uri:t.uri,size:t.fileSize}),dimensions:t.width&&t.height?{width:t.width,height:t.height}:void 0}),n=t.thumbnailUri?{file:{uri:t.thumbnailUri,name:j.default.extractFileName(s.amsUploadFilename)+"-thumbnail.jpg",size:void 0,type:"image/jpg"},extension:"jpg",dimensions:t.width&&t.height?{width:t.width,height:t.height}:void 0}:void 0;this.setAmsUpload(st(s,t.uri,i,void 0,void 0,t.thumbnailUri,n)),this.persisted.transcodingStatus=Te.Success})).catch((t=>(G.warn(ve,oe.default.errorAsString(t)),G.log(ve,`TranscodeVideoStep.start error causeId: ${e}`),t&&t.code===n.ReencodeErrorType.TooLargeFile&&!o.isUndefined(d.maxFileSize)?(R.default.alertSizeTooBig(d.maxFileSize,s.amsUploadFullData.file.size||0,this.persisted.instrumentation_postSource,s.amsUploadFileType,!0),this.persisted.transcodingStatus=Te.Failure,p.Resolved()):this._handleSkippedOrFailedTranscoding(s)))).finally((()=>{this._reencodeProgressSubscription&&this._reencodeProgressSubscription.unsubscribe(),G.log(ve,"TranscodeVideoStep success ",this.post.persisted.id),t.pokePost.fire(this.post.persisted.id)}))}else G.log(ve,"TranscodeVideoStep.start skipped reencoding"),this._handleSkippedOrFailedTranscoding(s).finally((()=>{t.pokePost.fire(this.post.persisted.id)}));t.pokePost.fire(this.post.persisted.id)}stop(e){this.persisted.transcodingStatus===Te.InProgress&&this.persisted.transcodingSessionId&&ge.default.cancelSession(this.persisted.transcodingSessionId),this._reencodeProgressSubscription&&this._reencodeProgressSubscription.unsubscribe(),e&&(this.persisted.transcodingStatus=Te.NotStarted)}cleanup(){this.stop(!1)}_handleSkippedOrFailedTranscoding(e){const t=U.default.getMaximumFileSizeForType(e.amsUploadFileType);return e.amsUploadFullData.file.size&&e.amsUploadFullData.file.size>t?(R.default.alertSizeTooBig(t,e.amsUploadFullData.file.size,this.persisted.instrumentation_postSource,e.amsUploadFileType,!0),G.warn(ve,"TranscodeVideoStep failing post because the file exceeds max size"),this.persisted.transcodingStatus=Te.Failure,p.Resolved()):(this.persisted.transcodingStatus=Te.Success,p.Resolved())}}e.TranscodeVideoStep=s}(Be||(Be={})),function(e){function t(e){return{needValidSkypeToken:!0,emptyResponse:!0,shimChatServiceResponse:!0,canBlockOthersInConv:!0,convId:e}}function s(e,t,s){return He.stepsToStartMightBeBlocked(t,(t=>{const o=t;if(o.stepType!==e.stepType)return!1;const r=o.post.findAnythingBlockingPost(o.post,o.convId);if(r){const t=function(e,t,s,o){const n=o.persisted.messagesForPosting[t]&&o.persisted.messagesForPosting[t].clientmessageid;return"Waiting to "+e+": "+s.persisted.id+", ConvId: "+i.pii.Mri(t)+", CMID: "+s.persisted.messagesForPosting[t].clientmessageid+", postTime: "+s.persisted.postTime+", blocked because post: "+o.persisted.id+", for CMID: "+n}(s,e.convId,e.post,r);G.log(ve,t)}const a=n(o.persisted,e.convId);if(r)void 0===a.lastBlockedStartTime&&(a.lastBlockedStartTime=Date.now());else if(void 0!==a.lastBlockedStartTime){const e=Date.now()-a.lastBlockedStartTime;a.totalBlockedTime=(a.totalBlockedTime||0)+e,a.lastBlockedStartTime=void 0}return!!r}))}function n(e,t){return e.messageSendingInfos||(e.messageSendingInfos={}),e.messageSendingInfos[t]||(e.messageSendingInfos[t]={}),e.messageSendingInfos[t]}function r(e){if(e.headers.location)return o.last(e.headers.location.split("/"))}function a(e,t,s,n,r,a,l,d){if(G.log(ve,t+" completed: "+e.post.persisted.id+", ConvId: "+i.pii.Mri(e.convId)+", success: "+a+", statustext: "+l.statusText+", from "+Ye(e)),a){const{contextId:t,date:i}=P.getTcidDataFromServerMessageResponse(l);!function(e,t,s,i,n,r,a,l,d){const c=e.persisted.messagesForPosting[s],h=P.getCuidForMessage(c),u=Date.now();p.all([k.default.getMessageByCuid(s,h),T.default.getConversationMetaAsync(s)]).then((([p,S])=>{if(n){if(T.default.confirmMessageSend(c,s,h,n,c.clientmessageid,r),!t.isForward&&!c.skypeeditedid&&m.default.getConfigSettingsNoSubscription().chat.forceChSetOnSend){const e=P.getCHIDForMessage(c),t=P.getConsumptionHorizonForMessageAndCHID(n,e);_.default.setConsumptionHorizon(s,t,!1)}if(!t.isForward&&!t.isDelete){const e=P.getCuidForMessage(c);$.default.maybeRequestTranslation(s,e,c)}}else G.warn(ve,"Was not given server ID for successfully posted message");const f=S?S.conv.getMemberCount():1;if(p&&p.isDeletedMessage())G.track(new X.MessageActionTelemetry(s,c,p.createdTime,X.MessageActionOrigin.PostingService,X.MessageActionType.Delete));else if(p&&p.isEdited())G.track(new X.MessageActionTelemetry(s,c,p.createdTime,X.MessageActionOrigin.PostingService,X.MessageActionType.Edit));else{let o=t.transmitStartTime,r=0,h=V.ChatServiceConnectionType.Unknown;t.messageSendingInfos&&t.messageSendingInfos[s]&&(o=t.messageSendingInfos[s].transmitStartTime,r=t.messageSendingInfos[s].totalBlockedTime||0,h=t.messageSendingInfos[s].connectionType||P.getConnectionTypeFromUrl(d));const p=e.persisted.postTime,m=o?o-p:0,S=o?u-o:u-p,y=i-1,v=se.default.getEndpointInfo();G.track(new K.KpiMessageSent(s,c,f,m,r,S,y,t.rawContentLength,ie.default.EdfRegistrationId.get(),v,a,l,n,te.default.isInCall(),g.default.getBackgroundTime(p,u),g.default.hasAppStart(p,u),h,g.default.getPostingTrigger()))}p&&t.quoteAuthor&&!o.isUndefined(t.quotesTriggerType)&&G.track(new X.QuotesEventTelemetry(s,p,p.createdTime,X.MessageActionOrigin.PostingService,X.MessageActionType.Quote,t.quotesTriggerType,t.quotesMessageType))}))}(e.post,e.persisted,e.convId,s,n,r,t,i,l.url)}}function l(e){const t=function(e){if(404===e.statusCode&&e.headers&&e.headers.location)return!1;if(403===e.statusCode){const t=e.statusText||e.headers.statustext,s=t&&t.toLowerCase();if(!s||-1===s.indexOf("registration"))return!0}else if(et(e)===P.ChatServiceErrors.UserInAnotherCloud)return!1;return}(e);if(void 0!==t)return t;const s=et(e);return s===P.ChatServiceErrors.AccessDenied||s===P.ChatServiceErrors.InitiatorNotPartOfThread||s===P.ChatServiceErrors.ThreadNotFound||(404!==e.statusCode||s!==P.ChatServiceErrors.EndpointMissing)&&void 0}function d(e,t){return{step:Ue.MessagePosted,conversationIds:[t],attributes:{success:e}}}e.ChatPostTransferType="postingService_postChatMessage",e.ChatPostForegroundStepType="postingService_postChatMessageForeground",e.ActionNames={post:"PostChatMessage",edit:"EditChatMessage",delete:"DeleteChatMessage"},e.parseBackgroundContext=function(e){if(e.postId&&e.convId)return{postId:e.postId,stepSelector:e.convId}};class c extends qe{constructor(){super(...arguments),this.convId=this.stepSelector,this.mightUnblockOthersInConv=this.convId}static forPost(t,s,i){if(Xe(!1)){if(Qe(i,s.messagesForPosting[i])){if(s.isDelete)return new f(t,s,e.ChatPostForegroundStepType,i);if(s.editedMessageServerId)return new S(t,s,e.ChatPostForegroundStepType,i)}return new u(t,s,e.ChatPostForegroundStepType,i)}}checkForUpdate(){return s(this,super.checkForUpdate(),this._actionName)}_config(){return t(this.convId)}_status(e){return e&&(this.persisted.messageForegroundRequests||(this.persisted.messageForegroundRequests={}),this.persisted.messageForegroundRequests[this.convId]||(this.persisted.messageForegroundRequests[this.convId]={finished:!1,finishedSuccess:!1})),this.persisted.messageForegroundRequests&&this.persisted.messageForegroundRequests[this.convId]}_startForegroundRequestOrFinish(){if(!$e())return;G.log(ve,this._actionName+": "+this.post.persisted.id+", ConvId: "+i.pii.Mri(this.convId)+", CMID: "+this.post.persisted.messagesForPosting[this.convId].clientmessageid+", in foreground");const e=this._createChatServiceReq(),t=n(this.persisted,this.convId);return t.scenario=e.scenario,t.transmitStartTime=Date.now(),_.default.performPostingServiceMessageRequest(e,w.PostMessageToConversationSource.MessagePost)}_handleResponse(e,t,s){if(e){n(this.persisted,this.convId).connectionType=P.getConnectionTypeFromUrl(t.url)}a(this,this._actionName,1,e?this._getMessageServerId(t):void 0,e?this._getMessageServerVersion(t):void 0,e,t)}_telemetryInfo(e){return d(e,this.convId)}_isPermanentFailure(e,t){const s=l(t);return void 0!==s?s:super._isPermanentFailure(e,t)}stop(e){super.stop(e)}}e.ChatPostForegroundStep=c;class u extends c{constructor(){super(...arguments),this._actionName=e.ActionNames.post}_createChatServiceReq(){const e=this.post.persisted.messagesForPosting[this.convId];return I.postMessageToConversation(this.convId,e)}_getMessageServerId(e){return r(e)}_getMessageServerVersion(e){return this._getMessageServerId(e)}}e.ChatPostCreateForegroundStep=u;class S extends c{constructor(){super(...arguments),this._actionName=e.ActionNames.edit}_createChatServiceReq(){const e=this.post.persisted.messagesForPosting[this.convId];return I.editMessage(this.convId,this.persisted.editedMessageServerId,e.messagetype,e.content)}_getMessageServerId(e){return this.persisted.editedMessageServerId}_getMessageServerVersion(e){return e.body?e.body.edittime:void 0}}e.ChatEditForegroundStep=S;class f extends c{constructor(){super(...arguments),this._actionName=e.ActionNames.delete}_createChatServiceReq(){return I.deleteMessage(this.convId,this.persisted.editedMessageServerId)}_getMessageServerId(e){return this.persisted.editedMessageServerId}_getMessageServerVersion(e){return e.body?e.body.deletetime:void 0}}e.ChatDeleteForegroundStep=f;class y extends Ke{constructor(){super(...arguments),this.convId=this.stepSelector}static forPost(t,s,i){if(Qe(i,s.messagesForPosting[i])){if(s.isDelete)return new b(t,s,e.ChatPostTransferType,i);if(s.editedMessageServerId)return new C(t,s,e.ChatPostTransferType,i)}return new v(t,s,e.ChatPostTransferType,i)}_config(){return t(this.convId)}transfer(){return this.persisted.messageBackgroundTransfers||(this.persisted.messageBackgroundTransfers={}),this.persisted.messageBackgroundTransfers[this.convId]}checkForUpdate(){if(this.persisted.messageForegroundRequests&&this.persisted.messageForegroundRequests[this.convId]&&this.persisted.messageForegroundRequests[this.convId].finishedSuccess)return He.Finished;return s(this,super.checkForUpdate(),this._actionName)}_start(){this.persisted.messageBackgroundTransfers||(this.persisted.messageBackgroundTransfers={});const e=this.post.persisted.messagesForPosting[this.convId];G.log(ve,"Posting Message: "+this.post.persisted.id+", ConvId: "+i.pii.Mri(this.convId)+", CMID: "+this.post.persisted.messagesForPosting[this.convId].clientmessageid+", in background");const t=this.transfer(),s=this._createChatServiceReq(e),o=n(this.persisted,this.convId);o.scenario=s.scenario,o.transmitStartTime=Date.now();const r=m.default.getS4LMessagingFeaturesNoSubscription(),a={priority:r.textSendWithCriticalPriority?h.WebRequestPriority.Critical:h.WebRequestPriority.High,timeout:r.reduceMessagePostTimeout?3e4:6e4},l=_.default.performRequestBackground(this.stepType,{postId:this.post.persisted.id,convId:this.convId},s,a);this.persisted.messageBackgroundTransfers[this.convId]=this._createTrackedBackgroundTransfer(l,t)}_handleResponse(e,t,s){const i=this.transfer().finishedAttemptsSoFarCount,o=e?this._getMessageServerId(t):void 0,n=e?this._getMessageServerVersion(t):void 0;if(a(this,this._actionName,i,o,n,e,t),!e){const e=this.persisted.messageSendingInfos&&this.persisted.messageSendingInfos[this.convId]&&this.persisted.messageSendingInfos[this.convId].scenario||"postMessageToConversation",i={source:w.PostMessageToConversationSource[w.PostMessageToConversationSource.MessagePost]},o=P.getConnectionTypeFromUrl(t.url),n=s&&_.default.errorHandler.getRegistrationTokenFromHeaders(s),r=s&&_.default.errorHandler.getSkypetokenFromHeaders(s);_.default.errorHandler.handleChatServiceFailure("PostingServicePostMessage",t,r,n,void 0,{scenario:e,telemetryAttributes:i},o)}}stop(e){super.stop(e)}_isPermanentFailure(e,t){const s=l(t);return void 0!==s?s:super._isPermanentFailure(e,t)}_telemetryInfo(e){return d(e,this.convId)}}e.ChatPostTransferStep=y;class v extends y{constructor(){super(...arguments),this._actionName=e.ActionNames.post}_createChatServiceReq(e){return I.postMessageToConversation(this.convId,e)}_getMessageServerId(e){return r(e)}_getMessageServerVersion(e){return this._getMessageServerId(e)}}e.ChatPostCreateTransferStep=v;class C extends y{constructor(){super(...arguments),this._actionName=e.ActionNames.edit}_createChatServiceReq(e){return I.editMessage(this.convId,this.persisted.editedMessageServerId,e.messagetype,e.content)}_getMessageServerId(e){return this.persisted.editedMessageServerId}_getMessageServerVersion(e){return e.body?e.body.edittime:void 0}}e.ChatEditTransferStep=C;class b extends y{constructor(){super(...arguments),this._actionName=e.ActionNames.delete}_createChatServiceReq(e){return I.deleteMessage(this.convId,this.persisted.editedMessageServerId)}_getMessageServerId(e){return this.persisted.editedMessageServerId}_getMessageServerVersion(e){return e.body?e.body.deletetime:void 0}}e.ChatDeleteTransferStep=b}(De||(De={})),function(e){e.MessagePropSetTransferType="postingService_updateChatMessageProperties",e.parseBackgroundContext=function(e){if(e.postId&&e.convId)return{postId:e.postId,stepSelector:e.convId}};class t extends Ke{constructor(){super(...arguments),this.convId=this.stepSelector}static forPost(s,i,o){if(i.urlPreviewPropSet)return new t(s,i,e.MessagePropSetTransferType,o)}_config(){return{needValidSkypeToken:!0,emptyResponse:!0,shimChatServiceResponse:!0,canBlockOthersInConv:!1,convId:this.convId}}transfer(){return this.persisted.urlPreviewPropSetTransfers||(this.persisted.urlPreviewPropSetTransfers={}),this.persisted.urlPreviewPropSetTransfers[this.convId]}_start(){this.persisted.urlPreviewPropSetTransfers||(this.persisted.urlPreviewPropSetTransfers={});const e=this.post.persisted.urlPreviewPropSet,t=this.transfer(),s=_.default.serviceSetMessagePropertyBackground(this.stepType,{postId:this.post.persisted.id,convId:this.convId},this.convId,e.messageId,M.MessageProperties.UrlPreviews,e.urlPreviewJson,!e.urlPreviewJson,Ce);this.persisted.urlPreviewPropSetTransfers[this.convId]=this._createTrackedBackgroundTransfer(s,t)}_handleResponse(e,t,s){if(G.log(ve,"UpdateChatMessageProperties completed: "+this.post.persisted.id+", ConvId: "+i.pii.Mri(this.convId)+", success: "+e+", statustext: "+t.statusText),!e){const e=P.getConnectionTypeFromUrl(t.url),i=s&&_.default.errorHandler.getRegistrationTokenFromHeaders(s),o=s&&_.default.errorHandler.getSkypetokenFromHeaders(s);_.default.errorHandler.handleChatServiceFailure("PostingServiceMessagePropSet",t,o,i,void 0,{scenario:"setMessageProperty"},e)}}stop(e){super.stop(e)}_telemetryInfo(e){}}e.MessagePropSetStep=t}(Ee||(Ee={})),function(e){e.feedbackGathered=new u.default,e.FeedbackStepType="postingService_feedbackGatherLogs";class t{static forPost(e,s){if(s.feedbackSendLogs||s.feedbackSendScreenshot)return new t(e,s)}constructor(t,s){this.post=t,this.persisted=s,this.stepType=e.FeedbackStepType,this.persisted.isCollectingFeedbackFiles=!1}checkForUpdate(){return this.persisted.feedbackUploadMetadata?He.Finished:this.persisted.isCollectingFeedbackFiles?He.NeedTo.waitForProgress(this):He.NeedTo.startSteps(this)}start(){this.persisted.isCollectingFeedbackFiles=!0;const e=[];let t;if(G.log(ve,"FeedbackHelper: attaching logs and/or screenshot"),r.default.supportsLogs()){const s=this._getScreenshotPathFromUri(this.persisted.feedbackScreenshotUri);t=r.default.zippedLogFileBundle(m.default.getDebugabilitySquad().brb_logs_history_secs,this.persisted.feedbackSendLogs,this.persisted.feedbackSendScreenshot,s).then((t=>{if(!t)return e;const s={file:t,extension:"blog"};return e.push({fileData:s,uploadSource:V.PostSource.Logs}),G.log(ve,"FeedbackHelper: Added Uri logs"),e}))}else t=p.Resolved([]);this._collectingFeedbackPromise=t,t.thenAsync((e=>{this._collectingFeedbackPromise===t&&this._handleResponse(e)}))}_getScreenshotPathFromUri(e){const t=ue.default.getURIComponents(e);return e&&t&&t.pathname?"/"+t.pathname.slice(0,-1):e}_handleResponse(t){this.persisted.feedbackUploadMetadata=t;const s=[];o.each(t,(e=>{if(e.fileData){const t=N.default.encodeSessionContextInFilename(e.fileData.file.name,this.persisted.feedbackSessionId,e.fileData.extension);s.push(R.default.createUploadInfo(this.post.persisted.conversationIds,e.fileData,e.uploadSource,{filename:t}))}else G.error(ve,"Incorrect fileMetadata object")})),e.feedbackGathered.fire(this.post.persisted.id,s)}stop(e){this.persisted.isCollectingFeedbackFiles=!1,this._collectingFeedbackPromise&&(this._collectingFeedbackPromise.cancel(),this._collectingFeedbackPromise=void 0)}cleanup(){this.stop(!1)}}e.FeedbackStep=t}(Ve||(Ve={})),t.feedbackGathered=Ve.feedbackGathered,function(e){e.AmsCreateType=we.AmsCreateTransferType,e.AmsCreateForegroundType=we.AmsCreateForegroundStepType,e.AmsThumbnailType=Pe.AmsThumbnailTransferType,e.AmsThumbnailForegroundType=Pe.AmsThumbnailForegroundStepType,e.AmsFullDataType=ke.AmsFullDataTransferType,e.AmsFullDataForegroundType=ke.AmsFullDataForegroundStepType,e.AzureDataType=Ae.AzureDataTransferType,e.AmsGetStatusForwardType=xe.AmsGetStatusForwardTransferType,e.AmsGetStatusForwardUploadType=xe.AmsGetStatusForwardUploadTransferType,e.AmsForwardContentType=Re.AmsForwardContentTransferType,e.AmsForwardContentUploadType=Re.AmsForwardContentUploadTransferType,e.UrlPreviewsType=Oe.UrlPreviewsTransferType,e.EncryptMessageType=Le.EncryptionStepType,e.FileEncryptionStepType=Fe.FileEncryptionStepType,e.VideoTranscodingStepType=Be.VideoTranscodingStepType,e.ChatPostType=De.ChatPostTransferType,e.ChatPostForegroundType=De.ChatPostForegroundStepType,e.MessagePropSetType=Ee.MessagePropSetTransferType,e.FeedbackType=Ve.FeedbackStepType}(Ne||(Ne={})),t.AllBackgroundTransferTypes=[Ne.AmsCreateType,Ne.AmsThumbnailType,Ne.AmsFullDataType,Ne.AzureDataType,Ne.AmsGetStatusForwardType,Ne.AmsGetStatusForwardUploadType,Ne.AmsForwardContentType,Ne.AmsForwardContentUploadType,Ne.UrlPreviewsType,Ne.ChatPostType,Ne.MessagePropSetType],t.AllForegroundTransferTypes=[Ne.AmsCreateForegroundType,Ne.AmsThumbnailForegroundType,Ne.AmsFullDataForegroundType,Ne.ChatPostForegroundType],t.ChatPostActionNames=De.ActionNames,t.TransferTypeToPostingTransferSource={[Ne.AmsCreateType]:V.PostingTransferSource.AMSCreate,[Ne.AmsCreateForegroundType]:V.PostingTransferSource.AMSCreate,[Ne.AmsThumbnailType]:V.PostingTransferSource.AMSUploadThumbnail,[Ne.AmsThumbnailForegroundType]:V.PostingTransferSource.AMSUploadThumbnail,[Ne.AmsFullDataType]:V.PostingTransferSource.AMSUploadContent,[Ne.AmsFullDataForegroundType]:V.PostingTransferSource.AMSUploadContent,[Ne.AzureDataType]:V.PostingTransferSource.Azure,[Ne.AmsGetStatusForwardType]:V.PostingTransferSource.AMSGetStatus,[Ne.AmsGetStatusForwardUploadType]:V.PostingTransferSource.AMSGetStatus,[Ne.AmsForwardContentType]:V.PostingTransferSource.AMSForward,[Ne.AmsForwardContentUploadType]:V.PostingTransferSource.AMSForward,[Ne.UrlPreviewsType]:V.PostingTransferSource.URLPreview,[Ne.ChatPostType]:V.PostingTransferSource.ChatService,[Ne.ChatPostForegroundType]:V.PostingTransferSource.ChatService,[Ne.MessagePropSetType]:V.PostingTransferSource.ChatServiceUpdateProperties},function(e){e[e.GotPostFromPersistentStore=0]="GotPostFromPersistentStore",e[e.AmsDocumentCreated=1]="AmsDocumentCreated",e[e.AmsFullContentUploaded=2]="AmsFullContentUploaded",e[e.AmsThumbContentUploaded=3]="AmsThumbContentUploaded",e[e.AzureUploadCompleted=4]="AzureUploadCompleted",e[e.Forwarded=5]="Forwarded",e[e.ForwardedUpload=6]="ForwardedUpload",e[e.AmsGotStatusForward=7]="AmsGotStatusForward",e[e.AmsGotStatusForwardUpload=8]="AmsGotStatusForwardUpload",e[e.AmsGotStatusServerTranscoding=9]="AmsGotStatusServerTranscoding",e[e.MessagePosted=10]="MessagePosted",e[e.MessagePostingFailed=11]="MessagePostingFailed"}(Ue=t.PostMessageScenarioStep||(t.PostMessageScenarioStep={})),t.postIdFromContext=function(e){return o.isString(e)?e:e.postId},function(e){e[e.Finished=0]="Finished",e[e.InProgress=1]="InProgress",e[e.Blocked=2]="Blocked",e[e.Update=3]="Update",e[e.GiveUp=4]="GiveUp"}(je=t.CheckForNeededWorkResult||(t.CheckForNeededWorkResult={})),function(e){const t={kind:je.Finished};function s(...e){return{kind:je.Blocked,blocked:e}}function i(t,s){if(0===t.length)return e.Finished;return t.reduce(((e,t)=>{let i;e.kind===je.Finished?i=!0:t.kind===je.Finished?i=!1:e.kind===je.GiveUp?i=s:t.kind===je.GiveUp?i=!s:e.kind===je.InProgress?i=!0:t.kind===je.InProgress?i=!1:e.kind===je.Blocked?i=!0:t.kind===je.Blocked?i=!1:e.kind!==je.Update?(pe.default.switchStatementExhaustiveChecking(e.kind),i=!0):t.kind!==je.Update?(pe.default.switchStatementExhaustiveChecking(t.kind),i=!1):i=!1;return n(i?t:e,i?e:t)}))}function n(e,t){return Object.assign(Object.assign({},e),{inProgress:o.union(e.inProgress,t.inProgress),blocked:o.union(e.blocked,t.blocked),start:o.union(e.start,t.start),failure:o.union(e.failure,t.failure)})}e.Finished=t,e.NeedTo={waitForProgress:function(...e){return{kind:je.InProgress,inProgress:e}},waitBecauseBlocked:s,startSteps:function(...e){return{kind:je.Update,start:e}},giveUpBecauseStep:function(e,t){return{kind:je.GiveUp,failure:[{stepType:e.stepType,failureReason:t}]}}},e.stepsToStartMightBeBlocked=function(e,t){if(!e.start)return e;const[r,a]=o.partition(e.start,(e=>t(e)));if(0===r.length)return e;const l=Object.assign(Object.assign({},e),{start:a});return e.kind===je.Update&&0===a.length?n(s(...r),l):i([l,s(...r)],!1)},e.dontGiveUp=function(t){return t.kind===je.GiveUp?n(e.Finished,t):t},e.findWorkWithLowPriorityFinished=function(t){let s;return o.each(t,(e=>(s=e.checkForUpdate(),s.kind===je.Finished&&void 0))),s||e.Finished},e.reduceWithLowPriorityGiveUp=function(e){return i(e,!0)},e.reduceWithHighPriorityGiveUp=function(e){return i(e,!1)},e.getFailureReason=function(e){const t=o.maxBy(e.failure,(e=>e.failureReason));return t?t.failureReason:x.FailureReason.None}}(He||(He={})),t.Test_CheckForUpdate=He,function(e){function t(e,t,s){const i=e.persisted.messagesForPosting[t],o=Object.assign(Object.assign({},i),{amsreferences:s});e.persisted.messagesForPosting[t]=o}e.updateAmsCreateReferences=function(e){const s=e.getPersistedActionData(),i=s.amsDocumentIds&&o.compact(o.values(s.amsDocumentIds));o.each(e.persisted.conversationIds,(s=>{t(e,s,i)}))},e.updateAmsForwardUploadReferences=function(e,s){const i=e.getPersistedActionData(),o=i.amsForwardDocumentIds&&i.amsForwardDocumentIds[s];t(e,s,o?[o]:void 0)},e.updateAmsForwardObjectsReferences=function(e){const s=e.getPersistedActionData(),i=o.compact(o.values(s.amsForwardDocumentIds));o.each(e.persisted.conversationIds,(s=>{t(e,s,i)}))}}(ze||(ze={})),function(e){function t(e,t){return o.find(e,(e=>e.objectId===t))}e.updateMessageUrls=function(e,s,i,n,r){const a=e.getPersistedActionData();let l;const d=e.isUploadNeeded();if(d||!a.swiftMessageDecoded&&!o.isEmpty(a.forwardMediaInfos)){let r,c=!1;if(d){if(o.size(o.compact(o.values(a.amsDocumentIds)))!==o.size(a.amsUploads))return;const{enableMediaFileRedesign:t}=m.default.getS4LMessagingFeaturesNoSubscription(),s=o.map(a.amsUploads,((s,o)=>{const n=a.amsDocumentIds[o],r=y.getDocumentUrls(n,s.amsUploadFileType),l=s.originalFileName||s.amsUploadFilename,d=s.originalUploadFileType||s.amsUploadFileType,c=U.default.getAmsUploadFileSize(s);let h,u=fe.UriObjectNode.sanitizeUrl(s.originalFullDataLocalUrl||s.amsFullDataLocalUrl,!0);return t&&u&&ye.default.addFileInformationForTracking(n,u,l),s.amsUploadFileType===re.UploadFileType.AudioMessage&&(h=s.audioDurationMs),R.default.getMediaEntity(r.original,r.preview,r.fallback,i,d,e.persisted.title,l,c,s.amsUploadFullData.dimensions,n,h)}));a.textWithUploadIndexes?(r=o.map(a.textWithUploadIndexes,(e=>o.isString(e)?new z.UnhandledEntity(e):o.isNumber(e)?s[e]:pe.default.switchStatementExhaustiveChecking(e))),c=!0):r=s}else{const o=t(a.forwardMediaInfos,n),l=y.getDocumentUrls(s,o.fileType);r=[R.default.getMediaEntity(l.original,l.preview,l.fallback,i,o.fileType,e.persisted.title,o.filename,o.fileSize,o.dimensions,s,o.durationMs)]}const h=e.persisted.callId?[new z.CallReactionMetadataEntity(e.persisted.callId)]:[],u=r.concat(h),p=W.encode(u,c);l={},o.each(e.persisted.messagesForPosting,((e,t)=>{l[t]=p}))}else l=a.swiftMessageDecoded?function(e,t,s,i){o.each(s.attachments,(e=>{!function(e,t,s){o.each(e.content.images,(e=>{e.url&&(e.url=e.url.replace(t,s))})),e.content.image&&e.content.image.url&&(e.content.image.url=e.content.image.url.replace(t,s));o.each(e.content.items,(e=>{e.image&&e.image.url&&(e.image.url=e.image.url.replace(t,s))})),o.each(e.content.media,(e=>{e.url&&(e.url=e.url.replace(t,s))}))}(e,t.objectId,i)}));const n={};return o.each(e.persisted.messagesForPosting,((e,t)=>{n[t]=W.encode([new z.SwiftUriObjectEntity(s,t,!0,s.summary)],!1)})),n}(e,t(a.forwardMediaInfos,n),a.swiftMessageDecoded,s):{};r&&(l={[r]:l[r]}),o.each(l,((t,s)=>{const i=o.cloneDeep(e.persisted.messagesForPosting[s]);i.content=l[s],e.persisted.messagesForPosting[s]=i}))},e.getForwardMessageMediaInfo=t}(We||(We={}));let ot=!0;t.test_setForegroundPostEnabled=function(e){ot=e}},843898:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.test_migrateAmsUploadIfNeeded=void 0;const i=s(174958),o=s(496486),n=s(267728),r=(s(269521),s(392649)),a=(s(516778),s(974634)),l=s(397691),d=s(266737),c=s(889391),h=s(544135),u=s(422801),p=s(260021),g=s(476621),m=s(351077),S=s(671830),f=s(898278),y=s(357569),v=s(539549),C=s(166923),_=s(952262),b=s(579041),T=s(746096),M=s(84457),I=s(753559),w=s(653700),P=s(436237),k=s(519089),A=s(624606),x=s(51470),R=s(812056),O=s(18078),L=s(192210),F=s(368645),B=s(680457),D=s(17791),E=s(29130),V=s(666765),N=s(216568),U=s(422538),j=s(478262),H=s(735370),z=s(912770),W=s(994214),G=s(842987),K=s(172758),q=s(853374),Q=s(906262),X=s(846116),$=T.LogTraceArea.PostingService;function J(e){if(e.amsUploadFileType&&!e.amsUploads){e.amsUploads=[{originalUploadFileType:e.originalUploadFileType,originalFileName:e.originalFileName,amsUploadFileType:e.amsUploadFileType,amsUploadFilename:e.amsUploadFilename,amsUploadFullData:e.amsUploadFullData,amsFullDataLocalUrl:e.amsFullDataLocalUrl,amsFullDataCacheInfo:e.amsFullDataCacheInfo,amsUploadThumbnailData:e.amsUploadThumbnailData,amsThumbnailLocalUrl:e.amsThumbnailLocalUrl,amsThumbnailCacheInfo:e.amsThumbnailCacheInfo}];const t=e;delete t.amsUploadFileType,delete t.originalFileName,delete t.originalUploadFileType,delete t.amsUploadFilename,delete t.amsUploadFullData,delete t.amsFullDataLocalUrl,delete t.amsFullDataCacheInfo,delete t.amsUploadThumbnailData,delete t.amsThumbnailLocalUrl,delete t.amsThumbnailCacheInfo;const s=[["amsCreateDocumentBackgroundId","amsCreateDocumentBackgroundIds"],["amsCreateDocumentForegroundRequest","amsCreateDocumentForegroundRequests"],["amsCreateDocumentBackgroundTransfer","amsCreateDocumentBackgroundTransfers"],["amsDocumentId","amsDocumentIds"],["amsThumbnailBackgroundId","amsThumbnailBackgroundIds"],["amsThumbnailDocumentForegroundRequest","amsThumbnailDocumentForegroundRequests"],["amsThumbnailBackgroundTransfer","amsThumbnailBackgroundTransfers"],["amsFullDataBackgroundId","amsFullDataBackgroundIds"],["amsFullDataDocumentForegroundRequest","amsFullDataDocumentForegroundRequests"],["amsFullDataBackgroundTransfer","amsFullDataBackgroundTransfers"],["instrumentation_uploadStartTime","instrumentation_uploadStartTimes"],["azureBackgroundTransfer","azureBackgroundTransfers"],["azureMSUrl","azureMSUrls"]];o.each(s,(t=>{const[s,i]=t;s in e&&(e[i]||(e[i]={}),e[i][0]=e[s],delete e[s])}))}return e}t.default=new class{constructor(){this._lastPostTime=0,this._posts={},this._postsActivelyWorking={},this._postsCleaningUp={},this._postStartTimeThisRun={},this._scenarioCache={},this._checkForNeededWorkQueue={},this.postCreated=new a.default,this.postUpdated=new a.default,this.transferFinished=new a.default,this.allPostsFinished=new a.default,this.getPostByLocalUrl=e=>{const t=o.find(this._posts,(t=>t.isMyLocalUrl(e)));return t&&t.getPersistedActionData()},this.getLocalUrlsForPost=e=>{const t=this._posts[e];return t&&t.getMyLocalUrls()},this.debug_allPosts=()=>this._posts,this.debug_allPostsCleaningUp=()=>o.mapValues(this._postsCleaningUp,(e=>e.post)),this.debug_allPostsFailedRetryInfo=()=>{const e={};return o.each(this._posts,(t=>{const s=t.debug_allPostsFailedRetryInfo();s&&(e[t.persisted.id]=s)})),e},this.test_resetBackoff=()=>{this._resetBackoffs("Tests"),this._seeIfAnythingNeedsDoing()},this.cancelPostMessage=(e,t)=>{const s=o.find(this._posts,(s=>o.some(s.persisted.messagesForPosting,((s,i)=>i===e&&s.clientmessageid===t))));return s?(P.log($,"Canceling CMID: "+t+", ConvId: "+i.pii.Mri(e)+", found post: "+s.persisted.id),this._cancel(s),!0):(P.warn($,"Attempted to cancel CMID "+t+" but no pending message post found!"),!1)},this.test_cancelPost=e=>{const t=this._posts[e]||this._postsCleaningUp[e]&&this._postsCleaningUp[e].post;return P.log($,"Test canceling post: "+e+", found: "+!!t+", during cleanup: "+!(!t||!t.persisted.isCleaningUp)),t&&this._cancel(t)},U.RegisterStartupable(this,"PostingTransferService",[h.default,u.default,g.default,C.default,b.default,w.default,F.default,D.default,W.default])}startup(){d.default.init(this.postCreated,this.postUpdated,this.allPostsFinished,(()=>!o.isEmpty(this._posts))),D.default.subscribe((()=>{D.default.isNetworkingAvailable()&&(this._resetBackoffs("ReportedConnectivityStore"),this._seeIfAnythingNeedsDoing())})),u.default.reconnected.subscribe((()=>{this._resetBackoffs("ChatService.reconnected"),this._seeIfAnythingNeedsDoing()})),W.default.subscribe((()=>{W.default.hasUsableSkypeToken()&&this._seeIfAnythingNeedsDoing()}),W.TriggerKeys.SkypeTokenKey);const e=(e,t)=>o.find(this._posts,(s=>s!==e&&(!(s.persisted.postTime>e.persisted.postTime)&&!(!o.some(s.persisted.conversationIds,(e=>e===t&&!s.isPostedToChat(t)))||s.persisted.nonBlocking))));F.default.subscribe(G.PostingActionType,((t,s)=>{const n=o.sortBy(t,(e=>e.postTime));if(o.each(n,(t=>{P.log($,"Tracking Post: "+t.id+(s?", "+this._logStringForMessagePost(t,s):"")),t.postTime||(t.postTime=this._getNextPostTime()),t.forwardMediaInfo&&!t.forwardMediaInfos&&(t.forwardMediaInfos=[t.forwardMediaInfo]),t.instrumentation_uploadSource&&(t.instrumentation_postSource=t.instrumentation_uploadSource,t.instrumentation_uploadSource=void 0),function(e){!e.feedbackSendLogsAndScreenshot||e.feedbackSendLogs||e.feedbackSendScreenshot||(e.feedbackSendLogs=e.feedbackSendLogsAndScreenshot,e.feedbackSendScreenshot=e.feedbackSendLogsAndScreenshot)}(t),J(t),function(e){const t=[e.amsCreateDocumentBackgroundTransfers,e.amsForwardBackgroundTransfers,e.amsFullDataBackgroundTransfers,e.amsGetStatusBackgroundTransfers,e.amsThumbnailBackgroundTransfers,e.azureBackgroundTransfers,e.messageBackgroundTransfers,e.urlPreviewBackgroundTransfer];o.each(t,(e=>{o.each(e,(e=>{y.default.migrateTransfer(e)}))}))}(t);const i=new A.Post(t,!s,e);if(this._postStartTimeThisRun[i.persisted.id]=Date.now(),i.persisted.isCleaningUp)return i.persisted.isCleaningUp=!1,void this._removeAndCheckForNeededCleanup(i);this._pruneScenarioCache(),o.each(i.telemetryScenarios,((e,t)=>{const s=i.persisted.messagesForPosting[t],o=S.getCuidForMessage(s);this._scenarioCache[t]?this._scenarioCache[t][o]=e:this._scenarioCache[t]={[o]:e}})),this._posts[i.persisted.id]=i,this._checkForNeededWork(i.persisted.id),i.markTelemetryStepCompleted(A.PostMessageScenarioStep.GotPostFromPersistentStore),this.postUpdated.fire(i.getPersistedActionData())})),s&&t.length){const t=o.mapValues(this._posts,(t=>o.filter(t.persisted.conversationIds,(s=>!e(t,s))))),s=o.pickBy(t,(e=>e.length));P.log($,"Earliest post to convs: "+o.map(s,((e,t)=>t+": ["+o.map(e,(e=>i.pii.Mri(e)))+"]")).join(", "))}}));const t=(e,t,o,n,r,a)=>{const l=(0,A.postIdFromContext)(t);if(!l)return void(this._postsCleaningUp[t]||P.warn($,"Failed to parse context for "+a+" (probably old -> ignoring): "+i.pii.Omit(JSON.stringify(t))));const d=this._posts[l];if(!d)return void(this._postsCleaningUp[l]||P.warn($,"Got "+a+" for missing Post: "+l+", context: "+i.pii.Omit(JSON.stringify(t))));const c=d.handleResponse(e,t,o,n,r,a);if(!c)return void(this._postsCleaningUp[l]||P.warn($,"Got "+a+" for known post but failed to update: "+l+", context: "+i.pii.Omit(JSON.stringify(t))));if(!(o=c.success)&&c.canRetry&&c.retryInfo&&z.default.setExpiration((()=>{this._posts[d.persisted.id]&&this._checkForNeededWork(d.persisted.id)}),c.retryInfo.nextAttempt),c.permanentFailure){if(c.convId){const e=u.default.getChatServiceErrorResponseMetadata(n),t=c.convId&&d.persisted.messagesForPosting[c.convId],s={message_type:t&&H.getMessageTypeName(t,O.default.getSkypeMri(),c.convId),error_code:e.errorCode,status_code:n.statusCode};d.markTelemetryStepCompleted(A.PostMessageScenarioStep.MessagePostingFailed,[c.convId],s,c.finishedAttemptsSoFarCount)}this.postUpdated.fire(d.getPersistedActionData())}const h=A.TransferTypeToPostingTransferSource[a];this.transferFinished.fire(d.getPersistedActionData(),h,c,n,r,c.convId,c.fileSize),c.telemetryInfo&&d.markTelemetryStepCompleted(c.telemetryInfo.step,c.telemetryInfo.conversationIds,c.telemetryInfo.attributes,c.finishedAttemptsSoFarCount),s(d,c.mightUnblockOthersInConv?c.convId:void 0)},s=(e,t)=>{this._postUpdated(e),this._checkForNeededWork(e.persisted.id),t&&this._seeIfAnythingElseInConvNeedsDoing(e,t)};return o.each(A.AllBackgroundTransferTypes,(e=>{h.default.subscribe(e,t)})),A.foregroundResponse.subscribe(t),A.pokePost.subscribe(((e,t)=>{const i=this._posts[e];i&&s(i,t)})),A.feedbackGathered.subscribe(((e,t)=>{const s=this._posts[e];if(s){const e=o.map(t,(e=>e.then((e=>e),(()=>{}))));l.all(e).then((e=>{o.each(e,(e=>{e&&this.startPost(e,{name:L.ScenarioName.SendMessage})}))})),this._postUpdated(s),this._checkForNeededWork(s.persisted.id)}})),l.Resolved()}_pruneScenarioCache(){o.each(this._scenarioCache,((e,t)=>{o.each(e,((t,s)=>{t.isResolved()&&!t.hasUnresolvedSecondaryScenarios()&&delete e[s]})),o.isEmpty(e)&&delete this._scenarioCache[t]}))}getTelemetryScenarioForMessage(e,t){this._pruneScenarioCache();const s=this._scenarioCache[e];return s&&s[t]}startPost(e,t,s,n){let r;if(e.kind===B.PostMessageInfoKind)x.default.notifyMessageReachedPostingTransferService(e.messageForPosting.clientmessageid),r=this._postMessageFromInfo(e);else{if(e.kind!==B.PostUploadInfoKind)return P.error($,"Unknown retry info",i.pii.Omit(e)),q.default.switchStatementExhaustiveChecking(e);t&&e.amsUploads&&e.amsUploads.length>0&&e.amsUploads[0].amsUploadFileType===j.UploadFileType.File&&(t.name=L.ScenarioName.SendFile),r=this._postUploadFromInfo(e,t&&t.transactionId)}t&&(r.scenarioInfo=Object.assign(Object.assign({},t),{startTime:Date.now()})),this.postCreated.fire(r);F.default.persistAndStartAction(G.PostingActionType,r);let a;e.kind===B.PostMessageInfoKind?a=e.postSource:e.kind===B.PostUploadInfoKind&&(a=e.uploadSource),o.each(r.conversationIds,(e=>{this._donateConversationForShareSuggestions(e),this._trackMessageSent(e,r.messagesForPosting[e],r,a,s,n)}))}_donateConversationForShareSuggestions(e){const t=_.default.getDisplayableProfile(e);if(t){const s=t.getDisplayName(),i=t.getAvatarUrl(),o=S.isEncryptedThread(e),n=S.isConversationWithPhoneNumber(e),a=S.isAgent(e);!s||o||n||a||r.default.donateConversationForShareSuggestion(e,s,i)}}_trackMessageSent(e,t,s,i,o,n){if(t.skypeeditedid)return;const r=(0,v.default)().getConversation(e),a=(0,X.isMagicBotContainingConversation)(r),l=this._getMessageReceiverMri(r),d=!!l&&this._isReceiverShortCircuitContact(l);let c;l&&(c=S.splitMri(l).id),P.track(new R.MessageSent(e,t,d,s.rawContentLength||0,i,N.default.EdfRegistrationId.get(),V.default.getEndpointId(),l,c,s.nonBlocking,o,E.default.getDeviceOrientation(f.MainRootViewId),k.default.isPiPEnabled()?!!k.default.getContentProps():void 0,n&&n.messageComposerAction,n&&n.contentType,n&&n.messageDurationMs,a)),m.isMessageSms(t.messagetype)&&Q.default.trackCallerIdOnSMSSent()}_postMessageFromInfo(e){const{conversationId:t,messageForPosting:s}=e,i={postTime:this._getNextPostTime(),editedMessageCuid:e.editedMessageCuid,conversationIds:[t],conversationAcceptedInfos:{[t]:e.conversationAcceptedInfo},instrumentation_postSource:e.postSource,instrumentation_conversationOrigin:e.conversationOrigin,messagesForPosting:{[t]:s},urlPreviewPropSet:e.urlPreviewPropSet,transactionId:q.default.newGuid(),forwardMediaInfo:e.forwardMediaInfo,forwardMediaInfos:e.forwardMediaInfos,swiftMessageDecoded:e.swiftMessageDecoded,urlPreviewEndpoints:e.urlPreviewEndpoints,rawContentLength:e.rawContentLength,quoteAuthor:e.quoteAuthor,quotesTriggerType:e.quotesTriggerType,quotesMessageType:e.quotesMessageType,isForward:e.isForward,showLocalNotificationOnFailure:e.showLocalNotificationOnFailure,editedMessageServerId:e.editedMessageServerId,editedMessageVersion:e.editedMessageVersion,isDelete:e.isDelete},n=e.shouldSendLogsAndScreenshot||e.shouldSendLogs,r=e.shouldSendLogsAndScreenshot||e.shouldSendScreenshot;let a;if((n||r)&&(i.feedbackSessionId=M.default.getCurrentSessionId(),i.feedbackScreenshotUri=e.screenshotUri,i.feedbackSendLogs=n,i.feedbackSendScreenshot=r),P.log($,this._logStringForMessagePost(i,!1)),a=m.isEventCallEndedMessageType(s)?Object.assign(Object.assign({},s),{skypeeditedid:void 0,version:i.editedMessageVersion}):Object.assign(Object.assign({},s),{version:i.editedMessageVersion}),e.editedMessageCuid&&e.urlPreviewPropSet)g.default.applyMessageLieWithPropertyLie(t,a,m.MessageProperties.UrlPreviews,e.urlPreviewPropSet.urlPreviewJson);else if(o.isUndefined(e.editedMessageCuid)&&o.isUndefined(e.editedMessageServerId)&&o.isUndefined(e.editedMessageVersion)){const e=(0,v.default)().getConversation(t),s=Math.max(Date.now(),e?e.getTimestamp()+1:0);g.default.applyMessageLieAndNotifyPrematurely(t,s,a)}else g.default.applyMessageLie(t,a);return i}_postUploadFromInfo(e,t){const s=e.amsUploads?[...e.amsUploads]:[{amsUploadFileType:e.amsUploadFileType,amsUploadFilename:e.amsUploadFilename,amsUploadFullData:e.amsUploadFullData,amsFullDataLocalUrl:e.amsFullDataLocalUrl,amsFullDataCacheInfo:e.amsFullDataCacheInfo,amsUploadThumbnailData:e.amsUploadThumbnailData,amsThumbnailLocalUrl:e.amsThumbnailLocalUrl,amsThumbnailCacheInfo:e.amsThumbnailCacheInfo}],i={postTime:this._getNextPostTime(),conversationIds:e.conversationIds,conversationAcceptedInfos:e.conversationAcceptedInfos,amsUploads:s,textWithUploadIndexes:e.textWithUploadIndexes,transactionId:t||q.default.newGuid(),messagesForPosting:e.messagesForPosting,rawContentLength:0,callId:e.callId,title:e.title,instrumentation_postSource:e.uploadSource,instrumentation_conversationOrigin:e.conversationOrigin};return e.toastMessageToShowOnSuccess&&(i.toastMessageToShowOnSuccess=e.toastMessageToShowOnSuccess),e.toastMessageToShowOnFailure&&(i.toastMessageToShowOnFailure=e.toastMessageToShowOnFailure),e.shouldTrackUpload&&(i.shouldTrackUpload=e.shouldTrackUpload),P.log($,this._logStringForMessagePost(i,!1)),o.each(e.conversationIds,(e=>{g.default.applyMessageLie(e,i.messagesForPosting[e])})),i}_logStringForMessagePost(e,t){const s=o.find(e.messagesForPosting),n=s&&s.skypeeditedid,r=e.isDelete,a=r||!(!e.editedMessageServerId&&!n),l=o.map(e.amsUploads,(e=>{let t="";const s=e.amsUploadFullData;if(s){t+=", amsUploadFileSize: "+s.file.size+", ams upload ext: "+(s.extension||I.default.extractFileExtension(e.amsUploadFilename))}let i="";const o=e.amsUploadThumbnailData;if(o){i+=", amsThumbnailFileSize: "+o.file.size+", ams thumbnail ext: "+(o.extension||I.default.extractFileExtension(o.file.name))}return"(amsUploadFileType: "+e.amsUploadFileType+t+i+")"}));return(t?"Restored ":"New ")+(l.length?"upload":"message")+": ConvId/CMID: ["+o.map(e.messagesForPosting,((e,t)=>i.pii.Mri(t)+"/"+e.clientmessageid)).join(", ")+"], message action: "+(a?r?A.ChatPostActionNames.delete:A.ChatPostActionNames.edit:A.ChatPostActionNames.post)+(a?", previous message ids: "+n+"|"+e.editedMessageServerId:"")+(l.length?", uploads: ["+l.join(", ")+"]":"")}_isReceiverShortCircuitContact(e){const t=K.default.getFullUserProfileByMri(e);return!!t&&!!t.isSuggested}_getMessageReceiverMri(e){if(e&&e.isOneOnOne())return e.getOtherPartyMri()}_getPostInfo(e){if(e.persisted.permanentFailureTransferType)return;const t=e.getPersistedActionData();if(e.isUploadNeeded()){const e=t.amsUploads;return{kind:"postUpload",conversationIds:t.conversationIds,amsUploads:e,textWithUploadIndexes:t.textWithUploadIndexes,messagesForPosting:t.messagesForPosting,callId:t.callId,title:t.title,uploadSource:t.instrumentation_postSource,conversationOrigin:t.instrumentation_conversationOrigin,toastMessageToShowOnSuccess:t.toastMessageToShowOnSuccess,toastMessageToShowOnFailure:t.toastMessageToShowOnFailure,shouldTrackUpload:t.shouldTrackUpload,conversationAcceptedInfos:t.conversationAcceptedInfos}}return{kind:"postMessage",conversationId:t.conversationIds[0],postSource:t.instrumentation_postSource,conversationOrigin:t.instrumentation_conversationOrigin,messageForPosting:o.find(t.messagesForPosting),editedMessageCuid:t.editedMessageCuid,forwardMediaInfo:t.forwardMediaInfo,forwardMediaInfos:t.forwardMediaInfos,swiftMessageDecoded:t.swiftMessageDecoded,shouldSendLogs:t.feedbackSendLogs,shouldSendScreenshot:t.feedbackSendScreenshot,screenshotUri:t.feedbackScreenshotUri,showLocalNotificationOnFailure:t.showLocalNotificationOnFailure,urlPreviewPropSet:t.urlPreviewPropSet,urlPreviewEndpoints:t.urlPreviewEndpoints,rawContentLength:t.rawContentLength,quoteAuthor:t.quoteAuthor,quotesTriggerType:t.quotesTriggerType,quotesMessageType:t.quotesMessageType,isForward:t.isForward,editedMessageServerId:t.editedMessageServerId,editedMessageVersion:t.editedMessageVersion,isDelete:t.isDelete,conversationAcceptedInfo:t.conversationAcceptedInfos&&t.conversationAcceptedInfos[t.conversationIds[0]]}}_cancel(e){return e.persisted.isCanceled=!0,this._removeAndCheckForNeededCleanup(e)}_postUpdated(e,t=!1){const s=e.getPersistedActionData(),i=F.default.updateAction(s);return t||this.postUpdated.fire(s),i}_getNextPostTime(){let e=Date.now();return o.each(this._posts,(t=>{t.persisted.postTime>=e&&(e=t.persisted.postTime+1)})),e<=this._lastPostTime&&(e=this._lastPostTime+1),this._lastPostTime=e,e}_resetBackoffs(e){P.log($,"Resetting backoffs due to: "+e),o.each(this._posts,(e=>{e.resetBackoffs()}))}_seeIfAnythingNeedsDoing(){const e=o.keys(this._posts);o.each(e,(e=>{this._posts[e]&&this._checkForNeededWork(e)}))}_seeIfAnythingElseInConvNeedsDoing(e,...t){const s=o.keys(this._posts);o.each(s,(s=>{const i=this._posts[s];i&&o.intersection(i.persisted.conversationIds,t).length&&(!e||i!==e&&i.persisted.postTime>e.persisted.postTime)&&this._checkForNeededWork(s)}))}_checkForNeededWork(e){if(this._checkForNeededWorkQueue[e])return void this._checkForNeededWorkQueue[e]++;this._checkForNeededWorkQueue[e]=1;const t=this._posts[e];this._doWorkIfNeeded(t);const s=this._posts[e]&&this._checkForNeededWorkQueue[e]>1;delete this._checkForNeededWorkQueue[e],s&&this._checkForNeededWork(e)}_doWorkIfNeeded(e){if(o.some(e.persisted.conversationIds,(e=>!e)))return P.error($,"Null conversationId in postingService. Cleaning up PostId: "+e.persisted.id),void this._removeAndCheckForNeededCleanup(e);const{updateKind:t,isActivelyWorking:s}=e.doWorkIfNeeded();switch(this._updateIsActivelyWorking(e,s),t){case A.CheckForNeededWorkResult.Finished:case A.CheckForNeededWorkResult.GiveUp:return void this._removeAndCheckForNeededCleanup(e);case A.CheckForNeededWorkResult.InProgress:case A.CheckForNeededWorkResult.Blocked:return;case A.CheckForNeededWorkResult.Update:return void this._postUpdated(e);default:return q.default.switchStatementExhaustiveChecking(t)}}_updateIsActivelyWorking(e,t){t?(this._postsActivelyWorking[e.persisted.id]=!0,!this._wakeLockPromise&&c.default.getConfigSettingsNoSubscription().chat.backgroundPostingHoldOwnWakeLockEnabled&&(this._wakeLockPromise=n.default.requestMaxTime("posting:active")),u.default.pokeLongRunningRequest(e.persisted.id)):(delete this._postsActivelyWorking[e.persisted.id],this._wakeLockPromise&&o.isEmpty(this._postsActivelyWorking)&&(this._wakeLockPromise.then((e=>{n.default.release(e,"posting:active")})),this._wakeLockPromise=void 0),u.default.removeLongRunningRequest(e.persisted.id))}_removeAndCheckForNeededCleanup(e){e.persisted.isFinished=!0;const t=!!this._posts[e.persisted.id];if(e.persisted.isCleaningUp)return this._postsCleaningUp[e.persisted.id]&&this._postsCleaningUp[e.persisted.id].defer.promise();e.persisted.isCleaningUp=!0;{const s=Date.now()-e.persisted.postTime,i=Date.now()-this._postStartTimeThisRun[e.persisted.id];P.log($,"Cleaning up:",e.persisted.id,"reportedPostTimeTotalMs",s,"actualPostTimeThisRunMs",i,"isCanceled",!!e.persisted.isCanceled,"justFinished",t,"permanentFailureTransferType",e.persisted.permanentFailureTransferType||"none","maxRetriesExceededTransferType",e.persisted.maxRetriesExceededTransferType||"none","maxElapsedTimeExceededTransferType",e.persisted.maxElapsedTimeExceededTransferType||"none")}this._updateIsActivelyWorking(e,!1),delete this._posts[e.persisted.id],delete this._postStartTimeThisRun[e.persisted.id],this._postsCleaningUp[e.persisted.id]={post:e,defer:l.Defer()};const s=this._postUpdated(e,!0).always((()=>{let s;return e.cleanup(),t&&(o.each(e.telemetryScenarios,((t,s)=>{const i={conversations_count:e.persisted.conversationIds.length,correlationId:p.getCorrelationIdFromMessageParts(O.default.getSkypeMri(),s,e.persisted.messagesForPosting[s].clientmessageid)};e.persisted.isCanceled?t.fail("user_cancelled",i):e.persisted.permanentFailureTransferType?(i.transfer_type=e.persisted.permanentFailureTransferType,t.fail("permanent_failure",i)):e.persisted.maxElapsedTimeExceededTransferType?(i.transfer_type=e.persisted.maxElapsedTimeExceededTransferType,t.fail("max_transfer_time_exceeded",i)):e.persisted.maxRetriesExceededTransferType?(i.transfer_type=e.persisted.maxRetriesExceededTransferType,t.fail("max_retries_exceeded",i)):t.finish(i)})),this.postUpdated.fire(e.getPersistedActionData())),e.persisted.isCanceled&&(s=o.map(e.persisted.messagesForPosting,((e,t)=>{const s=S.getCuidForMessage(e);return g.default.revertMessageLie(t,s,e.clientmessageid)}))),l.all(s||[]).then((()=>{let s,n,r=!1;if(e.persisted.permanentFailureTransferType||e.persisted.maxRetriesExceededTransferType||e.persisted.maxElapsedTimeExceededTransferType){const t=Date.now();n=o.map(e.persisted.messagesForPosting,((i,o)=>{if(!e.isPostedToChat(o))return s=s||this._getPostInfo(e),r=r||!(e.persisted.permanentFailureTransferType||!s),g.default.rejectMessageSend(o,i,t,s)}))}return l.all(n||[]).then((()=>{const s=e.getMyLocalCacheNames();if(0===s.length)return;let n;return P.log($,"Keeping in cache for a while: "+e.persisted.id+", names: "+i.pii.Omit(s.join(", "))),n=r?o.map(s,(e=>w.default.finishedButKeepForRetry(e))):t?o.map(s,(e=>w.default.finished(e))):o.map(s,(e=>w.default.abandon(e))),l.all(n).then(o.noop)})).always((()=>{F.default.removeAction(e.persisted.id);const t=this._postsCleaningUp[e.persisted.id];delete this._postsCleaningUp[e.persisted.id],t.defer.resolve(void 0)}))}))}));this._seeIfAnythingElseInConvNeedsDoing(e,...e.persisted.conversationIds);{const t=o.filter(e.persisted.conversationIds,(e=>!o.some(this._posts,(t=>o.includes(t.persisted.conversationIds,e)))));o.isEmpty(t)||P.log($,"Cleaning up convs: ["+o.map(t,(e=>i.pii.Mri(e))).join(", ")+"]"),o.isEmpty(this._posts)&&P.log($,"Cleaning up everything!")}return s.finally((()=>{o.isEmpty(this._posts)&&o.isEmpty(this._postsCleaningUp)&&this.allPostsFinished.fire()})),s}},t.test_migrateAmsUploadIfNeeded=J},72374:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041),r=s(129510);let a;a=100;let l=class extends n.StoreBase{constructor(){super(200),this._animatedEmoticons=new r.LinkedHashMap,this._staticEmoticons=new r.LinkedHashMap}register(e){if(!this._animatedEmoticons.has(e)&&!this._staticEmoticons.has(e)){if(this._animatedEmoticons.length()===a){const e=this._animatedEmoticons.removeFirst();this._staticEmoticons.addLast(e,e),o.defer((()=>{this.trigger(e)}))}this._animatedEmoticons.addLast(e,e)}}unregister(e){if(o.isUndefined(this._staticEmoticons.remove(e))&&!o.isUndefined(this._animatedEmoticons.remove(e))&&this._staticEmoticons.length()>0){const e=this._staticEmoticons.removeLast();this._animatedEmoticons.addFirst(e,e),o.defer((()=>{this.trigger(e)}))}}canAnimate(e){return this._animatedEmoticons.has(e)}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],l.prototype,"canAnimate",null),l=i.__decorate([n.AutoSubscribeStore],l),t.default=new l},465915:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041),n=s(397691),r=s(348733),a=s(422538),l=s(720603),d=s(265976);let c=class extends o.StoreBase{constructor(){super(),this._transcriptVTTMap=new Map,this._progressInSeconds=0,this._currentTranscriptionUrl="",a.RegisterStartupable(this,"AudioTranscriptionStore")}startup(){return n.Resolved()}getTranscriptVTTMap(){return this._transcriptVTTMap}getCurrentTranscriptionUrl(){return this._currentTranscriptionUrl}getProgressInSeconds(){return this._progressInSeconds}setCurrentTranscriptionUrl(e){this._currentTranscriptionUrl=e,this.trigger()}setAudioTranscription(e){const t=(0,d.extractAmsDocumentIdFromUrl)(e);if(!this._transcriptVTTMap.has(t)&&""===this._currentTranscriptionUrl&&e){const t={isTranscribing:!0,cues:[],isValid:!1,progressInSeconds:-1};this._transcriptVTTMap.set((0,d.extractAmsDocumentIdFromUrl)(e),t),this.setCurrentTranscriptionUrl(e),l.default.getAudioTranscriptionAsync(e).then((s=>{try{const e=(0,r.parseSync)(s);t.cues=e,t.isValid=(null==e?void 0:e.length)>0,t.isTranscribing=!1}catch(e){return}finally{this._transcriptVTTMap.set((0,d.extractAmsDocumentIdFromUrl)(e),t),this.setCurrentTranscriptionUrl("")}}))}}setProgressInSeconds(e,t){const s=(0,d.extractAmsDocumentIdFromUrl)(e);if(!this._transcriptVTTMap.has(s))return;const i=this._transcriptVTTMap.get(s);this._transcriptVTTMap.set(s,Object.assign(Object.assign({},i),{progressInSeconds:t})),this._progressInSeconds=t,this.trigger()}deleteTranscriptVTT(e){const t=(0,d.extractAmsDocumentIdFromUrl)(e);this._transcriptVTTMap.has(t)&&this._transcriptVTTMap.delete(t)}clearTranscriptVTT(){this._transcriptVTTMap.clear(),this._currentTranscriptionUrl=""}test_clearTranscriptVTTMap(){this._transcriptVTTMap.clear(),this._currentTranscriptionUrl=""}};i.__decorate([o.autoSubscribe],c.prototype,"getTranscriptVTTMap",null),i.__decorate([o.autoSubscribe],c.prototype,"getCurrentTranscriptionUrl",null),i.__decorate([o.autoSubscribe],c.prototype,"getProgressInSeconds",null),c=i.__decorate([o.AutoSubscribeStore],c),t.default=new c},63413:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(174958),n=s(496486),r=s(217041),a=s(397691),l=s(671830),d=s(562141),c=s(436237),h=s(998754),u=s(422538),p=s(327795);let g=class extends r.StoreBase{constructor(){super(),this._contactsBlockStatus={},this._conversationBlockStatus={},this._contactsBlockStatusOriginal={},this._conversationBlockStatusOriginal={},u.RegisterStartupable(this,"BlockedMriStore",[h.default])}startup(){const e=h.default.getDataExclusive(d.InternalKeys.BlockedMriStoreCache);return this._contactsBlockStatus=e?e.contactsBlockStatus:{},this._conversationBlockStatus=e?e.conversationBlockStatus:{},this._contactsBlockStatusOriginal={},this._conversationBlockStatusOriginal={},a.Resolved()}isMriBlocked(e){if(l.isOneToOneThread(e)){const t="BlockedMriStore:isMriBlocked doesn't support oneOnOneThreads: "+o.pii.Mri(e);return c.error(void 0,t),c.track(new p.DevDebug("IsMriBlockedOneOnOneThreads",t)),!1}let t=!1;return!(e in this._contactsBlockStatus&&(t=!0,!this._contactsBlockStatus[e]))&&(!(e in this._conversationBlockStatus&&(t=!0,!this._conversationBlockStatus[e]))&&!!t)}isContactBlocked(e){return!!this._contactsBlockStatus[e]}getBlockedMris(){const e=n.mergeWith(this._conversationBlockStatus,this._contactsBlockStatus,((e,t)=>!(!1===e||!1===t))),t=n.pickBy(e,(e=>e));return Object.keys(t)}internal_updateContactsBlockStatus(e,t,s){return this._updateSet(e,this._contactsBlockStatusOriginal,this._contactsBlockStatus,t,s)}internal_updateConversationBlockStatus(e,t){return this._updateSet(e,this._conversationBlockStatusOriginal,this._conversationBlockStatus,!0,t)}test_reset_store(){h.default.deleteKeys([d.InternalKeys.BlockedMriStoreCache]).then((()=>{const e=h.default.getDataExclusive(d.InternalKeys.BlockedMriStoreCache);this._contactsBlockStatus=e?e.contactsBlockStatus:{},this._conversationBlockStatus=e?e.conversationBlockStatus:{},this._contactsBlockStatusOriginal={},this._conversationBlockStatusOriginal={}}))}_updateSet(e,t,s,i,o){const r=[];let l=!1;if(n.each(e,((e,o)=>{if(e!==s[o]){const n=this.isMriBlocked(o);i||o in t||(o in s?t[o]=s[o]:e&&(t[o]=!1)),s[o]=e,l=!0,this.isMriBlocked(o)!==n&&r.push(o)}})),i&&n.each(e,((e,s)=>{s in t&&delete t[s]})),l||i){const e={contactsBlockStatus:n.assign({},this._contactsBlockStatus,this._contactsBlockStatusOriginal),conversationBlockStatus:n.assign({},this._conversationBlockStatus,this._conversationBlockStatusOriginal)};return(i?h.default.putData(d.InternalKeys.BlockedMriStoreCache,e,o):a.Resolved()).then((()=>{r.length>0&&this.trigger(r)}))}return a.Resolved()}};i.__decorate([r.autoSubscribe,i.__param(0,r.key)],g.prototype,"isMriBlocked",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],g.prototype,"isContactBlocked",null),i.__decorate([r.autoSubscribe],g.prototype,"getBlockedMris",null),g=i.__decorate([r.AutoSubscribeStore],g),t.default=new g},282773:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(570655),o=s(496486),n=s(217041),r=s(397691),a=s(476621),l=s(562141),d=s(496418),c=s(746096),h=s(436237),u=s(178735),p=s(422538);var g;!function(e){e[e.BookmarkAddedKey=0]="BookmarkAddedKey"}(g=t.TriggerKeys||(t.TriggerKeys={}));let m=class extends n.StoreBase{constructor(){super(),this._bookmarkAdded=!1,this._updatedBookmarks={},this._chatServiceDataServiceMessagesProcessed=e=>r.all(o.map(e,(e=>{if(e.isBookmarkSourceForCurrentUser()){const t=e.getBookmarkSourceMetadataForCurrentUser();if(!t||!t.cuid)return;this._maybeStoreUpdatedBookmarkTrigger(t.cuid,e)}}))),p.RegisterStartupable(this,"BookmarksStore",[u.default,a.default])}startup(){return a.default.messagesProcessed.subscribe(this._chatServiceDataServiceMessagesProcessed),r.Resolved()}isBookmarkAdded(){return this._bookmarkAdded}setBookmarkAdded(){this._bookmarkAdded=!0,this.trigger(g.BookmarkAddedKey)}bookmarkTooltipDisplayed(){this._bookmarkAdded=!1,this.trigger(g.BookmarkAddedKey)}shouldDisplayTooltipOnMobile(e){return!(u.default.getUserPreferencesLocal().notifiedAboutBookmarks||!this._bookmarkAdded||!e||d.default.isCoachMarkBeingShown())&&(u.default.setUserPreferencesLocal({notifiedAboutBookmarks:!0}),!0)}getBookmarkEditedMessage(e,t){if(o.has(this._updatedBookmarks,e))return this._updatedBookmarks[e];this._checkIfBookmarkContentUpdated(t)}_checkIfBookmarkContentUpdated(e){if(!e.isBookmark())return r.Resolved();const t=e.getBookmarkMetadata();return t?l.default.getMessageByCuid(t.bookmarkSourceConversationId,t.bookmarkSourceClientMessageId).then((t=>{t?e.content!==t.content&&(h.log(c.LogTraceArea.Bookmarks,"Newer bookmark source message found in local DB."),this._maybeStoreUpdatedBookmarkTrigger(e.cuid,t)):this._updatedBookmarks[e.cuid]=void 0})):r.Resolved()}_maybeStoreUpdatedBookmarkTrigger(e,t){const s=this._updatedBookmarks[e];if(!s)return h.log(c.LogTraceArea.Bookmarks,"Caching newer version bookmark source message."),this._updatedBookmarks[e]=t,void this.trigger(e);const i=s.getLatestServerMessageVersion(),o=t.getLatestServerMessageVersion();if(i&&o)return o>i&&s.content!==t.content?(h.log(c.LogTraceArea.Bookmarks,"Received new version of bookmark with new content."),this._updatedBookmarks[e]=t,void this.trigger(e)):void 0;h.log(c.LogTraceArea.Bookmarks,`Unable to compare versions of updated bookmarks. Local version:${i} Incoming update:${o}`)}test_reset(){this._bookmarkAdded=!1,this._updatedBookmarks={}}test_getUpdatedBookmarks(){return this._updatedBookmarks}};i.__decorate([(0,n.autoSubscribeWithKey)(g.BookmarkAddedKey)],m.prototype,"isBookmarkAdded",null),i.__decorate([(0,n.autoSubscribeWithKey)(g.BookmarkAddedKey)],m.prototype,"shouldDisplayTooltipOnMobile",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],m.prototype,"getBookmarkEditedMessage",null),m=i.__decorate([n.AutoSubscribeStore],m),t.default=new m},610666:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(827028),o=[{overlayType:i.OverlayType.None,order:0}],n=[...o,...[{filterName:"Type9",accessibilityLabelTextPath:"CameraEffects.ColorFilterAccessibilityLabel"},{filterName:"Type4",accessibilityLabelTextPath:"CameraEffects.ColorFilterAccessibilityLabel"},{filterName:"Type6",accessibilityLabelTextPath:"CameraEffects.ColorFilterBWAccessibilityLabel"}].map((e=>({overlayType:i.OverlayType.Filter,parameters:e,order:1})))];class r{static getOverlays(e){return r.hasOverlays(e)?n:o}static hasOverlays(e){return!1}}t.default=r},700842:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041),r=s(397691),a=s(422801),l=s(476621),d=s(351077),c=s(671830),h=s(539549),u=s(422538),p=s(912770),g=s(571046),m=s(846116);let S=class extends n.StoreBase{constructor(){super(),this._conversationMap={},u.RegisterStartupable(this,"ComposingStore",[a.default,l.default,h.default])}startup(){return a.default.controlMessagesReceived.subscribe((e=>{o.each(e,(e=>{const t=c.getParsedConversationId(e),s=this._getCreatorMri(e);t&&(this._shouldAddComposingUserData(e)?this.addComposingUserData(t,s):this._shouldClearComposingUserData(e)&&this.clearComposingUserData(t,s))}))})),l.default.messagesProcessed.subscribe((e=>{o.each(e,(e=>{(0,g.isMagicBotOneOnOneControlMessage)(e)||this.clearComposingUserData(e.conversationId,(0,g.isMagicBotOneOnOneMessage)(e)?(0,m.getMagicBotId)():e.creator)}))})),(0,h.default)().subscribe((e=>{o.each(e,(e=>{if(this._conversationMap[e]){(0,h.default)().getConversation(e).isCurrentUserMember()||(delete this._conversationMap[e],this.trigger(e))}}))})),r.Resolved()}addComposingUserData(e,t){this._conversationMap[e]||(this._conversationMap[e]=[]),this._conversationMap[e]=o.filter(this._conversationMap[e],(e=>e.mri!==t));const s=Date.now();this._conversationMap[e].push({mri:t,startTypingTime:s}),p.default.setTimeout((()=>{this.clearComposingUserData(e,t,s)}),2e4),this.trigger(e)}clearComposingUserData(e,t,s=0){if(this._conversationMap[e]){let i=!1;this._conversationMap[e]=o.filter(this._conversationMap[e],(e=>e.mri!==t||0!==s&&e.startTypingTime!==s||(i=!0,!1))),i&&this.trigger(e)}}getComposingUsers(e){return this._conversationMap[e]?o.map(this._conversationMap[e],(e=>e.mri)):[]}_getCreatorMri(e){return(0,g.isMagicBotOneOnOneMessage)(e)?(0,m.getMagicBotId)():c.getCreatorMriForMessageFromLink(e.from)}_shouldAddComposingUserData(e){return e.messagetype===d.MessageTypes.Typing||e.messagetype===d.MessageTypes.MagicBotEvent&&(0,g.isMagicBotOneOnOneTypingIndicator)(e)}_shouldClearComposingUserData(e){return e.messagetype===d.MessageTypes.ClearTyping||e.messagetype===d.MessageTypes.MagicBotEvent&&(0,g.isMagicBotOneOnOneClearTypingIndicator)(e)}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],S.prototype,"getComposingUsers",null),S=i.__decorate([n.AutoSubscribeStore],S),t.default=new S},475760:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationCalculationStore=void 0;const i=s(570655),o=s(496486),n=s(267728),r=s(873713),a=s(516778),l=s(217041),d=s(397691),c=s(300060),h=s(889391),u=s(994224),p=s(476621),g=s(671830),m=s(562141),S=s(465848),f=s(331751),y=s(746096),v=s(436237),C=s(914976),_=s(583181),b=s(422538);var T;!function(e){e[e.ActiveConversationCount=0]="ActiveConversationCount",e[e.ZeroCountChanged=1]="ZeroCountChanged"}(T||(T={}));let M=class extends l.StoreBase{constructor(){super(200),this._notificationPromises=[],this._messageCounts={},this._activeConversationCount=0,this._onAppStateChange=e=>{e===a.Types.AppActivationState.Active&&this._recomputeActiveConversationCounts()},b.RegisterStartupable(this,"ConversationCalculationStore",[p.default])}setupPreStartupSubscriptions(){this._csdsToken&&this._csdsToken.unsubscribe(),this._csdsToken=p.default.conversationsUpdated.subscribe((e=>{const t=[];let s=!1;if(o.each(e,(e=>{const i=e.counts;if(i&&this._messageCounts[e.conv.id]!==i){const o=this._messageCounts[e.conv.id]||S.BlankCounts;this._messageCounts[e.conv.id]=i;let n=!1;0===o.unreadCount!=(0===i.unreadCount)&&(s=!0),o.unreadCount===i.unreadCount&&o.unreadCountOverflowed===i.unreadCountOverflowed&&o.highPriorityUnreadCount===i.highPriorityUnreadCount&&o.hasUnread===i.hasUnread&&o.numMessagesSentByUser===i.numMessagesSentByUser&&o.consumptionHorizonTimestamp===i.consumptionHorizonTimestamp||(t.push(e.conv.id),n=!0),(o.unreadCount!==i.unreadCount||i.unreadCount>0)&&v.log(y.LogTraceArea.ConversationCalculations,"Conversation count - changed: "+n+" value: "+i.unreadCount+" for "+C.mriOrId(e.conv.id))}})),t.length>0){b.HasStarted(this)&&this.trigger(t);const e=this._recomputeActiveConversationCounts();this._notificationPromises.push(e),e.always((()=>{o.pull(this._notificationPromises,e)})),v.log(y.LogTraceArea.ConversationCalculations,"Unread conversation count: "+o.filter(this._messageCounts,(e=>e.unreadCount>0)).length)}s&&this.trigger(T.ZeroCountChanged)}))}startup(){return o.each(p.default.getRawConversationMetaMemoryCache(),(e=>{e&&e.counts&&(this._messageCounts[e.conv.id]=e.counts)})),_.default.performAfterUIStarted((()=>{o.defer((()=>{this._recomputeActiveConversationCounts()}))})),c.default.subscribeForChanges("ConversationCalculationStore",(e=>this._onAppStateChange(e))),d.Resolved()}test_reset(){this._messageCounts={},this._activeConversationCount=0}flushNotificationProcessingPromises(){const e=this._notificationPromises;return this._notificationPromises=[],d.all(e).then(o.noop)}getMessageCountsForConversation(e,t){if(t&&h.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations){const t=f.default.getAllSiblingConversations(e);if(t.length>1){let s=0,i=0;return o.each(t,(e=>{if(u.default.ActiveCallUIHelper.hasActiveCall(e.id))return;const t=this._messageCounts[e.id];t&&(s+=t.unreadCount,i+=t.highPriorityUnreadCount)})),o.assign({},this._messageCounts[e],{hasUnread:s>0?1:0,unreadCount:s,highPriorityUnreadCount:i,unreadCountOverflowed:s>S.MaxUnreadMessageCount})}}return this._messageCounts[e]||S.BlankCounts}getConversationsWithUnreadCounts(){const e={};return o.each(this._messageCounts,((t,s)=>{t.unreadCount&&(e[s]=t)})),e}getSortedFrequentConversationMris(){const e=[];return o.each(this._messageCounts,((t,s)=>{t.numMessagesSentByUser>0&&(g.isUserMri(s)||g.isThread(s)||g.isAgent(s))&&e.push(s)})),o.sortBy(e,(e=>-this._messageCounts[e].numMessagesSentByUser))}getActiveRecentsConversationCount(){return this._activeConversationCount}_recomputeActiveConversationCounts(){const e=n.default.requestMaxTime("ConvCounts"),t=[];let s;const i=h.default.getConfigSettingsNoSubscription().cortana.mri;if(b.HasStarted(this)){let e=0;o.each(this._messageCounts,((t,s)=>{s!==i&&t.hasUnread&&(g.isHighlightsThread(s)||e++)})),s=d.Resolved(e)}else s=m.default.getCountOfUnreadConversations(!1);return s.then((e=>(this._activeConversationCount!==e&&(this._activeConversationCount=e,t.push("activeConversationCount updated to "+e),this.trigger(T.ActiveConversationCount)),r.default.getCount().then((e=>{const s=this._activeConversationCount;e!==s&&(t.push("Home screen badge count: "+e+" => "+s),r.default.setCount(s)),t.length>0&&v.log(y.LogTraceArea.ConversationCalculations,"_recomputeActiveConversationCounts: "+t.join(", "))}))))).always((()=>{e.then((e=>n.default.release(e,"ConvCounts"))).catch(o.noop)}))}};i.__decorate([l.autoSubscribe,i.__param(0,l.key)],M.prototype,"getMessageCountsForConversation",null),i.__decorate([(0,l.autoSubscribeWithKey)(T.ZeroCountChanged)],M.prototype,"getConversationsWithUnreadCounts",null),i.__decorate([l.autoSubscribe],M.prototype,"getSortedFrequentConversationMris",null),i.__decorate([(0,l.autoSubscribeWithKey)(T.ActiveConversationCount)],M.prototype,"getActiveRecentsConversationCount",null),M=i.__decorate([l.AutoSubscribeStore],M),t.ConversationCalculationStore=M,t.default=new M},23293:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041),r=s(397691),a=s(123606),l=s(10102),d=s(952262),c=s(746096),h=s(436237),u=s(89808),p=s(18078),g=s(422538),m=s(418037);let S=class extends n.StoreBase{constructor(){super(),this._colorInfoByMri={},g.RegisterStartupable(this,"ConversationColorStore",[d.default,m.default])}startup(){return this._overrideColorInfo=m.default.shouldOverrideColors(),d.default.subscribe((e=>{this._handleDisplayInfoStoreUpdates(e)})),u.default.subscribe((()=>{this._overrideColorInfo&&(h.log(c.LogTraceArea.ConversationColorStore,"Triggering color update for my user color change"),this.trigger())})),m.default.subscribe((()=>{const e=m.default.shouldOverrideColors();e!==this._overrideColorInfo&&(h.log(c.LogTraceArea.ConversationColorStore,"Triggering color update for theme change"),this._overrideColorInfo=e,this.trigger())})),r.Resolved()}getColorInfo(e,t=!1){return this.getColorInfoNoSubscription(e,t)}getColorInfoNoSubscription(e,t=!1){if(this._overrideColorInfo&&!t)return u.default.getColorInfoNoSubscription();if(!e)return l.getDefaultUnknownColorInfo();let s=this._colorInfoByMri[e];return s||(s=this._getColorInfoWithDefault(e)),s||l.getDefaultUnknownColorInfo()}getPrimaryColor(e,t=!1){return this.getPrimaryColorNoSubscription(e,t)}getPrimaryColorNoSubscription(e,t=!1){if(this._overrideColorInfo&&!t)return u.default.getPrimaryColorNoSubscription();const s=this.getColorInfoNoSubscription(e,t);return a.accentColor(s)}getGradientColors(e,t=!1){if(this._overrideColorInfo&&!t)return u.default.getGradientColors();const s=this.getColorInfo(e,t);return l.gradientColorsForColorInfo(s)}getSubtleGradientColors(e,t=!1){if(this._overrideColorInfo&&!t)return u.default.getSubtleGradientColors();const s=this.getColorInfo(e,t);return l.subtleGradientColorsForColorInfo(s)}_getColorInfoWithDefault(e){const t=d.default.getDisplayableProfile(e);let s=t?t.getColor():void 0;return l.isMatchingColorInfo(s,l.SerializedColorByNumber.Rainbow)&&(s=void 0),s||(s=l.getDefaultColorInfo(e)),this._colorInfoByMri[e]&&this._colorInfoByMri[e]===s||(this._colorInfoByMri[e]=s),s}_handleDisplayInfoStoreUpdates(e){const t=o.filter(e,(e=>{if(p.default.isMyMri(e))return!1;const t=this._colorInfoByMri[e],s=this._getColorInfoWithDefault(e);return!t||t!==s}));t.length>0&&this.trigger(t)}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],S.prototype,"getColorInfo",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],S.prototype,"getPrimaryColor",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],S.prototype,"getGradientColors",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],S.prototype,"getSubtleGradientColors",null),S=i.__decorate([n.AutoSubscribeStore],S),t.default=new S},331751:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041),r=s(397691),a=s(889391),l=s(871908),d=s(671830),c=s(539549),h=s(924339),u=s(341706),p=s(746096),g=s(62781),m=s(436237),S=s(914976),f=s(422538),y=s(172758);let v=class extends n.StoreBase{constructor(){super(),this._conversations={},this._updateConversations=e=>{const t=[];o.each(e,(e=>{const s=(0,c.default)().getConversation(e);if(s){const e=this._checkAndAddConversationMri(s);e&&t.push(e)}})),t.length&&this.trigger(t)},this._updateUsers=e=>{const t=[];o.each(e,(e=>{const s=y.default.getFullUserProfileByMri(e);s&&o.each(s.phones,(e=>{const s=d.sanitizeMri(e.number,d.Namespaces.PSTN),i=(0,c.default)().getConversation(s);if(i){const e=this._checkAndAddConversationMri(i);e&&t.push(e)}}))})),t.length&&this.trigger(t)},f.RegisterStartupable(this,"ConversationGroupingStore",[c.default,y.default])}_getPairedUserMri(e){const t=e.getOtherPartyMri();if(t)return y.default.getConversationOwner(t);m.log(p.LogTraceArea.ConversationGroupingStore,"_getPairedUserMri: getOtherPartyMri returned undefined")}_checkAndAddConversationMri(e){if(e.isOneOnOne()){const t=this._getPairedUserMri(e);if(t){this._conversations[t]||(this._conversations[t]=[]);const s=-1!==this._conversations[t].indexOf(e.id);if(s&&h.isConversationDisplayable(e))return t;if(!s)return this._conversations[t].push(e.id),t}}}startup(){const e=(0,c.default)();return o.each(e.getAllConversationsInMemory(),(e=>{e&&this._checkAndAddConversationMri(e)})),e.subscribe(this._updateConversations),y.default.subscribe(this._updateUsers),r.Resolved()}test_resetConversations(){this._conversations={}}getConversationsForUser(e,t=!0){if(this._conversations&&this._conversations[e]&&this._conversations[e].length)return o.compact(o.map(this._conversations[e],(e=>{const s=(0,c.default)().getConversation(e);if(!(t&&s&&s.isEncryptedThread())||u.default.shouldShowPrivateConv(e))return s})))}getDisplayableConversationsForUser(e){return o.filter(this.getAllSiblingConversations(e),(e=>h.isConversationDisplayable(e)))}getAllSiblingConversations(e){const t=(0,c.default)().getConversation(e);if(t||m.log(p.LogTraceArea.ConversationGroupingStore,"original conversation for "+S.mriOrId(e)+" does not exist"),!t&&d.isPhoneMri(e)){const t=this.getConversationsForUser(y.default.getConversationOwner(e));return this._maybeLogConversationsForUser(t,!0),t||[]}if(!t||t&&!t.isOneOnOne())return[];const s=this.getConversationsForUser(this._getPairedUserMri(t));return this._maybeLogConversationsForUser(s,!1),s||[]}_maybeLogConversationsForUser(e,t){if(o.isUndefined(e)||0===e.length){const s=o.isUndefined(e)?"undefined":"zero length",i=t?"PSTN case, ":"";m.log(p.LogTraceArea.ConversationGroupingStore,"getAllSiblingConversations: "+i+"conversationsForUser is "+s)}}isGroupMarkedAsFavorite(e){return o.some(this.getAllSiblingConversations(e),(e=>e.isFavorite()))}filterGrouped1on1s(e){return e&&a.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations?o.uniqBy(e,(e=>{if(!e.isOneOnOne())return e.id;let t=e.getOtherPartyMri();return t&&(t=y.default.getConversationOwner(t)),t})):e}markGroupAsRead(e){o.each(this.getAllSiblingConversations(e),(e=>{l.markConversationRead(e.id)}))}removeFromFavorites(e){o.each(this.getAllSiblingConversations(e),(e=>{e.isFavorite()&&g.default.removeConversation(e.id)}))}addToFavorites(e){const t=(0,c.default)().getConversation(e);if(t){const e=this._getPairedUserMri(t);e&&g.default.addConversation(e)}}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],v.prototype,"getConversationsForUser",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],v.prototype,"getDisplayableConversationsForUser",null),i.__decorate([n.autoSubscribe],v.prototype,"getAllSiblingConversations",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],v.prototype,"isGroupMarkedAsFavorite",null),i.__decorate([n.autoSubscribe],v.prototype,"filterGrouped1on1s",null),v=i.__decorate([n.AutoSubscribeStore],v),t.default=new v},982453:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=(s(516778),s(217041)),n=s(397691),r=(s(300060),s(899686)),a=(s(217093),s(827357)),l=s(422538);let d=class extends o.StoreBase{constructor(){super(100),this._appActive=!1,this._isVisible=!1,this._isUserActive=!1,this._shouldAnimate=!1,l.RegisterStartupable(this,"ConversationListAnimationStore",[a.default,r.default])}startup(){return this._appActive=!0,this._activitySubToken=r.default.subscribe((()=>{const e=r.default.isCurrentUserActive();e!==this._isUserActive&&(this._isUserActive=e,this._recalc())})),this._isUserActive=r.default.isCurrentUserActive(),this._isVisible=!0,this._recalc(),n.Resolved()}destroy(){this._activationSubToken&&(this._activationSubToken.unsubscribe(),this._activationSubToken=void 0),this._navigationSubToken&&(a.default.unsubscribe(this._navigationSubToken),this._navigationSubToken=void 0),this._activitySubToken&&(r.default.unsubscribe(this._activitySubToken),this._activitySubToken=void 0)}_recalc(){const e=this._isVisible&&this._appActive&&this._isUserActive;e!==this._shouldAnimate&&(this._shouldAnimate=e,this.trigger())}shouldAnimate(){return this._shouldAnimate}};i.__decorate([o.autoSubscribe],d.prototype,"shouldAnimate",null),d=i.__decorate([o.AutoSubscribeStore],d),t.default=new d},182146:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RetrievalMask=t.RetrievalState=void 0;const i=s(570655),o=s(496486),n=s(217041),r=s(397691),a=s(889391),l=s(481169),d=s(476621),c=s(351077),h=s(581697),u=s(562141),p=s(218083),g=s(746096),m=s(436237),S=s(861253),f=s(764387),y=s(914976),v=s(9212),C=s(853374);var _,b;!function(e){e[e.None=0]="None",e[e.Retrieving=1]="Retrieving",e[e.Failed=2]="Failed",e[e.Retrieved=3]="Retrieved"}(_=t.RetrievalState||(t.RetrievalState={})),function(e){e[e.Files=1]="Files",e[e.Media=2]="Media",e[e.Links=4]="Links",e[e.All=7]="All"}(b=t.RetrievalMask||(t.RetrievalMask={}));const T=e=>e||[];let M=class extends n.StoreBase{constructor(){super(...arguments),this._conversations={},this._populateSurroundMediaInProgress={},this._fetchFilesLinksMediaForConversation=(e,t)=>{this._needsMoreFileMessages(e)&&this._getFilesForConversation(e,t),this._needsMoreLinksMessages(e)&&this._getLinksForConversation(e,t),this._needsMoreMediaMessages(e)&&this._getMediaForConversation(e,t)},this._processNextConversationMessagesFromDb=(e,t)=>{if(!e||!e.length)return m.log(g.LogTraceArea.ConversationMediaStore,"_processNextConversationMessages() No more messages proccessed. causeId:"+t),r.Resolved();const s=o.filter(e,(e=>this._isSupportedMessage(e))),i=s.length,n=o.last(e).conversationId;return m.log(g.LogTraceArea.ConversationMediaStore,"_processNextConversationMessages() conversationId: "+y.mriOrId(n)+" numMediaMessages: "+i+", causeId: "+t),this._conversations[n]&&i?this._putMessages(n,s,!1,t):r.Resolved()},this._processPreviousConversationMessagesFromDb=(e,t,s)=>{if(!this._conversations[t])return r.Resolved();let i=r.Resolved();if(e.length){const n=o.filter(e,(e=>this._isSupportedMessage(e))),r=o.last(e).createdTime;m.log(g.LogTraceArea.ConversationMediaStore,"_processPreviousConversationMessages() conversationId: "+y.mriOrId(t)+" supportedMessages: "+n.length+" causeId: "+s),this._conversations[t].lastPreviousItemTime&&r<this._conversations[t].lastPreviousItemTime&&e.length&&(this._conversations[t].lastPreviousItemTime=r),i=this._putMessages(t,n,!1,s)}return!this._needsMoreMessages(t,!1)||this._conversations[t].retrievedFromService||this._retrievalFromServiceFailedInTheLastMinute(t)||(m.log(g.LogTraceArea.ConversationMediaStore,"_processPreviousConversationMessages() Fetching items"),this._fetchFilesLinksMediaForConversation(t,s)),i},this._processSuccessfulSearchResults=(e,t,s)=>{const i=[],n=(0,l.chain)(e,(0,l.map)((e=>p.default.simulateFullMessage(e,c.MessageTypes.UriObject,t))),(0,l.compact)(),(0,l.filter)((e=>!(!e.cuid||!this._isSupportedMessage(e))&&(i.push(e.cuid),!0))));m.log(g.LogTraceArea.ConversationMediaStore,"_processSuccessfulSearchResults() Processing "+n.length+" results conversationId: "+y.mriOrId(t)+", causeId: "+s),u.default.openTransaction([u.Stores.Messages,u.Stores.Conversations],!0).then((e=>{m.log(g.LogTraceArea.ConversationMediaStore,"_processSuccessfulSearchResults() Getting local messages conversationId: "+y.mriOrId(t));const a=d.default.getConversationMetaAsync(t,e),l=e.getMessagesByCuid(t,i);return r.all([a,l]).then((([i,r])=>{const a=o.map(r,(e=>e.cuid)),l=i?i.conv.getDeletedTimestamp():0,d=o.filter(n,(e=>e.createdTime>l));this._putMessages(t,d,!0,s),m.log(g.LogTraceArea.ConversationMediaStore,"_processSuccessfulSearchResults() Found "+a.length+" messages stored locally for  conversationId: "+y.mriOrId(t));let c=d;a&&a.length&&(c=o.filter(d,(e=>-1===o.indexOf(a,e.cuid)))),c.length&&(m.log(g.LogTraceArea.ConversationMediaStore,"_processSuccessfulSearchResults() Putting "+c.length+" messages locally for  conversationId: "+y.mriOrId(t)),e.putMessages(c))}))}))}}_startedTrackingKey(e){this._conversations[e]||(m.log(g.LogTraceArea.ConversationMediaStore,"_startedTrackingKey() New conversationId: "+y.mriOrId(e)),0===o.size(this._conversations)&&(this._messagesProcessedSubscriptionToken=d.default.messagesProcessed.subscribe((e=>{const t=C.default.newCauseId();m.log(g.LogTraceArea.ConversationMediaStore,"messagesProcessed: causeId: "+t),(0,l.chain)(e,(0,l.filter)((e=>e.conversationId in this._conversations&&this._isSupportedMessage(e)&&!e.isMessageLie())),(0,l.groupBy)((e=>e.conversationId)),(0,l.eachWithKey)(((e,s)=>{this._putMessages(s,e,!1,t)})))})),this._conversationsUpdatedSubscriptionToken=d.default.conversationsUpdated.subscribe((e=>{const t=C.default.newCauseId();m.log(g.LogTraceArea.ConversationMediaStore,"conversationsUpdated: causeId: "+t),o.each(e,(e=>{e.conv.isDeleted()&&this._conversations[e.conv.id]&&(this._conversations[e.conv.id].media.messages=[],this._conversations[e.conv.id].files.messages=[],this._conversations[e.conv.id].links.messages=[],this._conversations[e.conv.id].retrievedFromService=!0,this._conversations[e.conv.id].lastNextItemTime=void 0,this._conversations[e.conv.id].lastPreviousItemTime=void 0,m.log(g.LogTraceArea.ConversationMediaStore,"conversationsUpdated: triggering: "+y.mriOrId(e.conv.id)+" causeId: "+t),this.trigger(e.conv.id))}))}))),this._conversations[e]={media:{messages:[],minResults:5,searchBase:0},files:{messages:[],minResults:5,searchBase:0},links:{messages:[],minResults:5,searchBase:0},isReverse:!1,lastNextItemTime:void 0,lastPreviousItemTime:void 0,retrievedFromService:!1,mediaRetrievalState:_.None,filesRetrievalState:_.None,linksRetrievalState:_.None})}_stoppedTrackingKey(e){m.log(g.LogTraceArea.ConversationMediaStore,"_stoppedTrackingKey() Stop tracking conversationId: "+y.mriOrId(e)),delete this._conversations[e],0===o.size(this._conversations)&&(this._messagesProcessedSubscriptionToken.unsubscribe(),this._messagesProcessedSubscriptionToken=void 0,this._conversationsUpdatedSubscriptionToken.unsubscribe(),this._conversationsUpdatedSubscriptionToken=void 0)}_isSupportedMessage(e){return f.default.isMediaItem(e)||f.default.isFile(e)||f.default.isLink(e)||f.default.isSwiftCardWithLink(e)||e.isDeletedMessage()}_putMessages(e,t,s,i){if(!this._conversations[e])return r.Resolved();let n=[];const a=[],d=[],c=[];let h=[];[h,n]=o.partition(t,(e=>e.isDeletedMessage())),o.each(n,(e=>{f.default.isFile(e)?a.push(e):f.default.isMediaItem(e)?c.push(e):d.push(e)})),m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() conversationId: "+y.mriOrId(e)+" filesToAdd: "+a.length+" linksToAdd: "+d.length+" mediaToAdd: "+c.length+" messagesToDelete: "+h.length+" causeId: "+i);let u=!1;h.length&&o.each(h,(t=>{let s,i;switch(o.each([this._conversations[e].files.messages,this._conversations[e].links.messages,this._conversations[e].media.messages],((e,n)=>(s=o.find(e,(e=>e.cuid===t.cuid)),!s||(i=n,u=!0,!1)))),i){case 0:this._conversations[e].files.messages=o.without(this._conversations[e].files.messages,s);break;case 1:this._conversations[e].links.messages=o.without(this._conversations[e].links.messages,s);break;case 2:this._conversations[e].media.messages=o.without(this._conversations[e].media.messages,s)}}));const p=this._conversations[e].isReverse,v=[a,d,c];return o.each(v,((t,i)=>{let n=[];0===i?(n=this._conversations[e].files.messages,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() FILES existingItems: "+n.length)):1===i?(n=this._conversations[e].links.messages,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() LINKS existingItems: "+n.length)):2===i&&(n=this._conversations[e].media.messages,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() mediaToAdd existingItems: "+n.length)),t=o.filter(t,(e=>!o.some(n,(t=>t.cuid===e.cuid&&(s||(0,S.default)(t,e)))))),u=u||t.length>0;const r=(0,l.chain)(n,(0,l.concat)(t),(0,l.uniqBy)((e=>e.cuid)),(0,l.sortBy)((e=>(p?-1:1)*e.createdTime)),(0,l.filter)((e=>!e.isDeletedMessage())));0===i?(this._conversations[e].files.messages=r,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() FILES mergedUniqueSortedItems: "+r.length)):1===i?(this._conversations[e].links.messages=r,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() LINKS mergedUniqueSortedItems: "+r.length)):2===i&&(this._conversations[e].media.messages=r,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() MEDIA mergedUniqueSortedItems: "+r.length))})),u&&(m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() triggering "+y.mriOrId(e)+" causeId: "+i),this.trigger(e)),r.Resolved()}_needsMoreMessages(e,t){return this._needsMoreFileMessages(e)||this._needsMoreLinksMessages(e)||this._needsMoreMediaMessages(e,t)}_needsMoreFileMessages(e){return this._conversations[e].files.messages.length<this._conversations[e].files.minResults}_needsMoreLinksMessages(e){return this._conversations[e].links.messages.length<this._conversations[e].links.minResults}_needsMoreMediaMessages(e,t=!1){const s=this._conversations[e].media.messages.length;return!t&&s<this._conversations[e].media.minResults||t&&s===this._conversations[e].media.minResults}_getFilesForConversation(e,t){if(this._conversations[e].filesRetrievalState===_.Retrieving)return void m.log(g.LogTraceArea.ConversationMediaStore,"ignoring _getFilesForConversation - retrieval in progress. causeId: "+t);this._conversations[e].filesRetrievalState=_.Retrieving;const s=this._conversations[e].files.searchBase;m.log(g.LogTraceArea.ConversationMediaStore,"_getFilesForConversation Fetching FILES conversationId: "+y.mriOrId(e)+" searchOffset: "+s+", causeId: "+t),v.default.getFilesForConversation(e,s).then(T).then((s=>{this._conversations[e]&&(this._conversations[e].retrievedFromService=!0,this._conversations[e].filesRetrievalState=_.Retrieved,this.trigger(e),m.log(g.LogTraceArea.ConversationMediaStore,"_getFilesForConversation retrieved FILES conversationId: "+y.mriOrId(e)+" results: "+s.length+" causeId: "+t),this._processSuccessfulSearchResults(s,e,t))})).catch((t=>{this._conversations[e]&&(this._conversations[e].filesRetrievalState=_.Failed,this._conversations[e].retrievalFailedTimestamp=Date.now(),this.trigger(e),m.warn(g.LogTraceArea.ConversationMediaStore,"_getFilesForConversation failed to retrieve FILES conversationId: "+y.mriOrId(e)+" error: "+t.statusCode+" - "+t.statusText))}))}_getLinksForConversation(e,t){if(this._conversations[e].linksRetrievalState===_.Retrieving)return void m.log(g.LogTraceArea.ConversationMediaStore,"ignoring _getLinksForConversation - retrieval in progress. causeId: "+t);this._conversations[e].linksRetrievalState=_.Retrieving;const s=this._conversations[e].links.searchBase;m.log(g.LogTraceArea.ConversationMediaStore,"_getLinksForConversation Fetching LINKS conversationId: "+y.mriOrId(e)+" searchOffset: "+s+", causeId: "+t),v.default.getLinksAndCardsForConversation(e,s).then(T).then((s=>{this._conversations[e]&&(this._conversations[e].retrievedFromService=!0,this._conversations[e].linksRetrievalState=_.Retrieved,this.trigger(e),m.log(g.LogTraceArea.ConversationMediaStore,"_getLinksForConversation retrieved LINKS conversationId: "+y.mriOrId(e)+" results: "+s.length+" causeId: "+t),this._processSuccessfulSearchResults(s,e,t))})).catch((s=>{this._conversations[e]&&(this._conversations[e].linksRetrievalState=_.Failed,this._conversations[e].retrievalFailedTimestamp=Date.now(),this.trigger(e),m.warn(g.LogTraceArea.ConversationMediaStore,"_getLinksForConversation failed to retrieve LINKS conversationId: "+y.mriOrId(e)+" error: "+s.statusCode+" - "+s.statusText+" causeId: "+t))}))}_getMediaForConversation(e,t){if(this._conversations[e].mediaRetrievalState===_.Retrieving)return void m.log(g.LogTraceArea.ConversationMediaStore,"ignoring _getMediaForConversation - retrieval in progress. causeId: "+t);this._conversations[e].mediaRetrievalState=_.Retrieving;const s=this._conversations[e].media.searchBase;m.log(g.LogTraceArea.ConversationMediaStore,"_getMediaForConversation Fetching MEDIA conversationId: "+y.mriOrId(e)+" searchOffset: "+s+", causeId: "+t),v.default.getMediaForConversation(e,s).then(T).then((s=>{this._conversations[e]&&(this._conversations[e].retrievedFromService=!0,this._conversations[e].mediaRetrievalState=_.Retrieved,this.trigger(e),m.log(g.LogTraceArea.ConversationMediaStore,"_getMediaForConversation retrieved MEDIA conversationId: "+y.mriOrId(e)+" results: "+s.length+" causeId: "+t),this._processSuccessfulSearchResults(s,e,t))})).catch((s=>{this._conversations[e]&&(this._conversations[e].mediaRetrievalState=_.Failed,this._conversations[e].retrievalFailedTimestamp=Date.now(),this.trigger(e),m.warn(g.LogTraceArea.ConversationMediaStore,"_getMediaForConversation failed to retrieve MEDIA conversationId: "+y.mriOrId(e)+" error: "+s.statusCode+" - "+s.statusText+" causeId: "+t))}))}_retrievalFromServiceFailedInTheLastMinute(e){const t=this._conversations[e],s=Date.now()-6e4;return!!t.retrievalFailedTimestamp&&t.retrievalFailedTimestamp>s}_initMinResults(e,t,s,i){this._conversations[e].files.minResults=t,this._conversations[e].links.minResults=s,this._conversations[e].media.minResults=i}_initConversation(e,t,s,i,o,n){m.log(g.LogTraceArea.ConversationMediaStore,"_initConversation conversationId: "+y.mriOrId(e)+", causeId: "+n);const r=this._conversations[e];r.isReverse=i,r.lastNextItemTime||r.lastPreviousItemTime?s&&(r.retrievedFromService=!1,m.log(g.LogTraceArea.ConversationMediaStore,"_initConv: getting more (3) causeId: "+n),this.populateSurroundMediaForConversation(e,!0,n)):(this._conversations[e].lastNextItemTime=t,this._conversations[e].lastPreviousItemTime=t,o?o.then((()=>{m.log(g.LogTraceArea.ConversationMediaStore,"_initConv: getting more (1) causeId: "+n),this.populateSurroundMediaForConversation(e,!1,n)})):(m.log(g.LogTraceArea.ConversationMediaStore,"_initConv: getting more (2) causeId: "+n),this.populateSurroundMediaForConversation(e,!1,n)))}getCombinedRetrievalState(e){let t=_.None;const s=this._conversations[e].mediaRetrievalState,i=this._conversations[e].filesRetrievalState,o=this._conversations[e].linksRetrievalState;return s===i&&i===o?t=s:s===_.Failed||i===_.Failed||o===_.Failed?t=_.Failed:s===_.Retrieving||i===_.Retrieving||o===_.Retrieving?t=_.Retrieving:s!==_.Retrieved&&i!==_.Retrieved&&o!==_.Retrieved||(t=_.Retrieved),m.log(g.LogTraceArea.ConversationMediaStore,"getCombinedRetrievalState() combinedRetrievalState: "+t),t}getMediaRetrievalState(e){const t=this._conversations[e].mediaRetrievalState;return m.log(g.LogTraceArea.ConversationMediaStore,"getMediaRetrievalState() mediaRetrievalState: "+t),t}getFilesRetrievalState(e){const t=this._conversations[e].filesRetrievalState;return m.log(g.LogTraceArea.ConversationMediaStore,"getFilesRetrievalState() filesRetrievalState: "+t),t}getLinksRetrievalState(e){const t=this._conversations[e].linksRetrievalState;return m.log(g.LogTraceArea.ConversationMediaStore,"getLinksRetrievalState() linksRetrievalState: "+t),t}getMediaForConversation(e,t,s=5,i=!1,n,r){const a=C.default.newCauseId(),l=this._conversations[e].media.messages;return m.log(g.LogTraceArea.ConversationMediaStore,"getMediaForConversation() MEDIA mediaMessages: "+l.length+", causeId: "+a),this._initMinResults(e,0,0,s),this._initConversation(e,t,i,!!n,r,a),o.sortBy(l,(e=>(n?-1:1)*e.createdTime))}getFilesForConversation(e,t,s=5,i=!1,n){const r=C.default.newCauseId(),a=this._conversations[e].files.messages;return m.log(g.LogTraceArea.ConversationMediaStore,"getFilesForConversation() FILES fileMessages: "+a.length+", causeId: "+r),this._initMinResults(e,s,0,0),this._initConversation(e,t,i,!!n,void 0,r),o.sortBy(a,(e=>(n?-1:1)*e.createdTime))}getLinksForConversation(e,t,s=5,i=!1,n){const r=C.default.newCauseId(),a=this._conversations[e].links.messages;return m.log(g.LogTraceArea.ConversationMediaStore,"getLinksForConversation() LINKS linkMessages: "+a.length+", causeId: "+r),this._initMinResults(e,0,s,0),this._initConversation(e,t,i,!!n,void 0,r),o.sortBy(a,(e=>(n?-1:1)*e.createdTime))}getCombinedItemsForConversation(e,t,s=5,i=!1,n){const r=C.default.newCauseId(),a=this._conversations[e].files.messages,l=this._conversations[e].links.messages,d=this._conversations[e].media.messages,c=this._conversations[e].isReverse;return m.log(g.LogTraceArea.ConversationMediaStore,"getCombinedItemsForConversation(): "+y.mriOrId(e)+" causeId: "+r),this._initMinResults(e,s,s,s),this._initConversation(e,t,i,!!n,void 0,r),o.sortBy(a.concat(l,d),(e=>(c?-1:1)*e.createdTime))}fetchMoreMessages(e,t){if(!this._conversations[e])return;const s=C.default.newCauseId();if(m.log(g.LogTraceArea.ConversationMediaStore,"fetchMoreMessages("+t+"): conversationId: "+y.mriOrId(e)+" causeId: "+s),t&b.Media){const t=this._conversations[e].media.messages.length;t>0&&t-1>this._conversations[e].media.searchBase?(this._conversations[e].media.searchBase=t-1,this._getMediaForConversation(e,s)):m.log(g.LogTraceArea.ConversationMediaStore,"no more media to get. causeId: "+s)}if(t&b.Links){const t=this._conversations[e].links.messages.length;t>0&&t-1>this._conversations[e].links.searchBase?(this._conversations[e].links.searchBase=t-1,this._getLinksForConversation(e,s)):m.log(g.LogTraceArea.ConversationMediaStore,"no more links to get. causeId: "+s)}if(t&b.Files){const t=this._conversations[e].files.messages.length;t>0&&t-1>this._conversations[e].files.searchBase?(this._conversations[e].files.searchBase=t-1,this._getFilesForConversation(e,s)):m.log(g.LogTraceArea.ConversationMediaStore,"no more files to get. causeId: "+s)}}isPopulatingOfSurroundMediaInProgressForConversation(e){return this._populateSurroundMediaInProgress[e]}populateSurroundMediaForConversation(e,t,s){return s=s+":"+C.default.newCauseId(),m.log(g.LogTraceArea.ConversationMediaStore,"populateSurroundMediaForConversation() conversationId: "+y.mriOrId(e)+" causeId: "+s),this._populateSurroundMediaInProgress[e]&&!t?r.Resolved():(this._populateSurroundMediaInProgress[e]=!0,r.all([this.populateNextMediaForConversation(e,s),this.populatePreviousMediaForConversation(e,s)]).then((()=>{this._populateSurroundMediaInProgress[e]=!1,this.trigger(e)})))}populateNextMediaForConversation(e,t){return t=t+":"+C.default.newCauseId(),m.log(g.LogTraceArea.ConversationMediaStore,"populateNextMediaForConversation() conversationId: "+y.mriOrId(e)+" causeId: "+t),this._conversations[e]?(m.log(g.LogTraceArea.ConversationMediaStore,"populateNextMediaForConversation() lastNextItemTime: "+new Date(this._conversations[e].lastNextItemTime).toString()+", causeId: "+t),u.default.getMessagesForConversationAfterTime(e,this._conversations[e].lastNextItemTime,this._getMaxMessagesToLoad(),!1).then((e=>this._processNextConversationMessagesFromDb(e,t)))):r.Resolved()}populatePreviousMediaForConversation(e,t){if(t=t+":"+C.default.newCauseId(),m.log(g.LogTraceArea.ConversationMediaStore,"populatePreviousMediaForConversation() conversationId: "+y.mriOrId(e)+", causeId: "+t),this._conversations[e]){const s=this._conversations[e].lastPreviousItemTime;m.log(g.LogTraceArea.ConversationMediaStore,"populatePreviousMediaForConversation() lastPreviousItemTime: "+new Date(s).toString()+", causeId: "+t);const i=h.default.getEarliestKnownMessageTime(e);return i===Number.MAX_VALUE||s<i?u.default.getMessagesForConversationBeforeTime(e,s,25,!1).then((s=>this._processPreviousConversationMessagesFromDb(s,e,t))):u.default.getMessagesForConversationAndTimeRange(e,i,s,!0,this._getMaxMessagesToLoad()).then((s=>this._processPreviousConversationMessagesFromDb(s,e,t)))}return r.Resolved()}_getMaxMessagesToLoad(){return a.default.getS4LMessagingFeatures().maxMessagesToLoadFromDBForMediaSearch||25}test_setIsPopulatingOfSurroundMediaInProgressForConversation(e,t){this._populateSurroundMediaInProgress[e]=t}};i.__decorate([n.disableWarnings],M.prototype,"_startedTrackingKey",null),i.__decorate([n.disableWarnings],M.prototype,"_stoppedTrackingKey",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],M.prototype,"getCombinedRetrievalState",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],M.prototype,"getMediaRetrievalState",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],M.prototype,"getFilesRetrievalState",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],M.prototype,"getLinksRetrievalState",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],M.prototype,"getMediaForConversation",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],M.prototype,"getFilesForConversation",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],M.prototype,"getLinksForConversation",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],M.prototype,"getCombinedItemsForConversation",null),i.__decorate([n.autoSubscribe],M.prototype,"fetchMoreMessages",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],M.prototype,"isPopulatingOfSurroundMediaInProgressForConversation",null),M=i.__decorate([n.AutoSubscribeStore],M),t.default=new M},329241:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_FOUND=void 0;const i=s(570655),o=s(496486),n=s(217041),r=s(397691),a=s(889391),l=s(671830),d=s(539549),c=s(816402),h=s(746096),u=s(436237),p=s(861253),g=s(635762),m=s(9212),S=s(853374),f=s(110996),y=s(269399);var v;t.NOT_FOUND=-1,function(e){e[e.SearchVisibility=0]="SearchVisibility",e[e.Timestamp=1]="Timestamp",e[e.Loading=2]="Loading",e[e.FocusedMessageIndex=3]="FocusedMessageIndex",e[e.Results=4]="Results",e[e.Query=5]="Query",e[e.Highlight=6]="Highlight"}(v||(v={}));const C={query:"",messageId:void 0};let _=class extends n.StoreBase{constructor(){super(...arguments),this._results=[],this._focusedMessageIndex=t.NOT_FOUND,this._isLoading=!1,this._resultMessageIds=[]}getSearchQuery(){return this._searchConversationQuery}findQuery(e,t,s){if(this._querySessionId=s,(0,p.default)(this._searchConversationQuery,e))return r.Resolved(this._results.length);if(this._searchConversationQuery=e,this._conversationId=t,0!==o.trim(e.query).length){this._isLoading=!0;const e=this._search(this._searchConversationQuery,t);return this.trigger([v.Query,v.Loading]),e}return this._clearData(),r.Resolved(0)}resetSearch(){this._searchConversationQuery=C,u.log(h.LogTraceArea.MessageSearch,"Reset search"),this._clearData()}cancelSearch(){this._searchConversationQuery=void 0,this._conversationId=void 0,u.log(h.LogTraceArea.MessageSearch,"Cancel search"),this._clearData()}getResults(){return this._results}isLoadingResults(){return this._isLoading}isMessageInConvSearchResults(e){return o.includes(this._resultMessageIds,e)}setTimestamp(e,t,s,i){e&&(o.isUndefined(this._conversationId)||(0,f.markMessageSearchScenarioResultMessageTimestamp)(this._querySessionId,e,this._conversationId),this._scrollRequest=e?{id:s||S.default.newGuid(),messageTimestamp:e,zeroTermSearch:!!i,cuid:t}:void 0,u.log(h.LogTraceArea.MessageSearch,`Search for message with timestamp: ${e}, cuid: ${t}`),this.trigger(v.Timestamp))}getTimestamp(){return this._scrollRequest}focusMessage(e){if(this._resultMessageIds){const t=this._resultMessageIds.indexOf(e);t>=0&&(this._focusedMessageIndex=t,this.trigger(v.FocusedMessageIndex))}}focusPreviousMessage(){this._focusedMessageIndex<this._results.length-1&&(this._focusedMessageIndex++,u.log(h.LogTraceArea.MessageSearch,"Navigating to previous result. Current message index: "+this._focusedMessageIndex),u.track(new g.NavigatedToPrevResult),(0,f.invalidateSearchScenario)(y.ScenarioSearchTypes.MessageInConversation,this._querySessionId),this.trigger(v.FocusedMessageIndex))}focusNextMessage(){this._focusedMessageIndex>0&&(this._focusedMessageIndex--,u.log(h.LogTraceArea.MessageSearch,"Navigating to next result. Current message index: "+this._focusedMessageIndex),u.track(new g.NavigatedToNextResult),(0,f.invalidateSearchScenario)(y.ScenarioSearchTypes.MessageInConversation,this._querySessionId),this.trigger(v.FocusedMessageIndex))}isFocusingNextDisabled(){return 0===this._focusedMessageIndex||0===this._results.length}isFocusingPreviousDisabled(){return 0===this._results.length||this._focusedMessageIndex+1===this._results.length}getFocusedMessageIndex(){return this._focusedMessageIndex}isMessageFocused(e){if(this._focusedMessageIndex!==t.NOT_FOUND){const t=this._results[this._focusedMessageIndex];return!!t&&t.MessageId===e}return!1}_search(e,t){return m.default.getSearchResults({query:e.query,limit:a.default.getS4LMessagingFeaturesNoSubscription().inConversationMessageSearch.initialPageSize,conversationId:t}).then((s=>{if(!this._searchConversationQuery||this._searchConversationQuery.query!==e.query||t!==this._conversationId)return r.Rejected();let i=s;const n=(0,d.default)().getConversation(t);if(n){const e=n.getConversationProperty(l.ConversationProps.DeleteTimestamp);e&&(i=o.filter(s,(t=>this._isResultDisplayable(t,e))))}return this._updateResults(i,e),this._results.length}))}_updateResults(e,s){if(e.length>0&&s.messageId){const t=o.findIndex(e,(e=>e.MessageId===s.messageId));this._focusedMessageIndex=t,u.log(h.LogTraceArea.MessageSearch,"Updating current message index: "+this._focusedMessageIndex)}else this._focusedMessageIndex=e.length?0:t.NOT_FOUND;this._results=e,this._isLoading=!1,this._resultMessageIds=e.map((e=>e.MessageId)),u.log(h.LogTraceArea.MessageSearch,"Updating search results. Count: "+this._results.length+". Current message index: "+this._focusedMessageIndex),this.trigger([v.Results,v.FocusedMessageIndex,v.Loading])}_isResultDisplayable(e,t){return c.default.getUnixMillisecondsTimestamp(e.CreationDate)>t}_clearData(){this._focusedMessageIndex=t.NOT_FOUND,this._results=[],this._resultMessageIds=[],this._isLoading=!1,this._scrollRequest=void 0,this.trigger([v.FocusedMessageIndex,v.Results,v.Loading,v.Query,v.Timestamp])}};i.__decorate([(0,n.autoSubscribeWithKey)(v.Query)],_.prototype,"getSearchQuery",null),i.__decorate([n.disableWarnings],_.prototype,"findQuery",null),i.__decorate([(0,n.autoSubscribeWithKey)(v.Results)],_.prototype,"getResults",null),i.__decorate([(0,n.autoSubscribeWithKey)(v.Loading)],_.prototype,"isLoadingResults",null),i.__decorate([(0,n.autoSubscribeWithKey)(v.Results)],_.prototype,"isMessageInConvSearchResults",null),i.__decorate([(0,n.autoSubscribeWithKey)(v.Timestamp)],_.prototype,"getTimestamp",null),i.__decorate([n.disableWarnings],_.prototype,"focusMessage",null),i.__decorate([(0,n.autoSubscribeWithKey)([v.FocusedMessageIndex,v.Results])],_.prototype,"isFocusingNextDisabled",null),i.__decorate([(0,n.autoSubscribeWithKey)([v.FocusedMessageIndex,v.Results])],_.prototype,"isFocusingPreviousDisabled",null),i.__decorate([(0,n.autoSubscribeWithKey)(v.FocusedMessageIndex)],_.prototype,"getFocusedMessageIndex",null),i.__decorate([(0,n.autoSubscribeWithKey)([v.FocusedMessageIndex,v.Results])],_.prototype,"isMessageFocused",null),_=i.__decorate([n.AutoSubscribeStore],_),t.default=_},946992:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041);let r=class extends n.StoreBase{constructor(){super(...arguments),this._selectedConversations=[]}getSelectedConversations(){return this._selectedConversations}addConversation(e){this._selectedConversations=this._selectedConversations.concat(e),this.trigger()}removeConversation(e){this._selectedConversations=o.without(this._selectedConversations,e),this.trigger()}};i.__decorate([n.autoSubscribe],r.prototype,"getSelectedConversations",null),r=i.__decorate([n.AutoSubscribeStore],r),t.default=r},185641:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041),n=s(861253);let r=class extends o.StoreBase{constructor(){super(...arguments),this._spacerWidths={left:0,right:0}}storeSpacerWidths(e){(0,n.default)(this._spacerWidths,e)||(this._spacerWidths=e,this.trigger())}getSpacerWidths(){return this._spacerWidths}setRightPositionForJumpToBottomButton(e){this._jumpToBottomRightPosition!==e&&(this._jumpToBottomRightPosition=e,this.trigger())}getRightPositionForJumpToBottomButton(){return this._jumpToBottomRightPosition}};i.__decorate([o.autoSubscribe],r.prototype,"getSpacerWidths",null),i.__decorate([o.autoSubscribe],r.prototype,"getRightPositionForJumpToBottomButton",null),r=i.__decorate([o.AutoSubscribeStore],r),t.default=new r},820770:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(54569),r=s(217041),a=s(974634),l=s(397691),d=s(889391),c=s(539549),h=s(928802),u=s(292069),p=s(366355),g=s(657347),m=s(497174),S=s(923944),f=s(436237),y=s(861253),v=s(914976),C=s(857946),_=s(422538);let b=class extends r.StoreBase{constructor(){super(),this.onInputEntitiesUpdatedEvent=new a.default,this._conversations={},this._conversationsBuffer={},this.saveMessageInput=(e,t)=>{if(!this._conversations[e]||!(0,y.default)(this._conversations[e].messages,t.messages)||this._conversations[e].type!==t.type){const s=o.join(o.map(t.messages,(e=>e.cuid)));f.log(p.LogTraceArea.ConversationsDraftStore,`saveMessageInput for conversation: ${v.mriOrId(e)}, messageType: ${C.SavedMessageType[t.type]}`+(o.isEmpty(s)?"":`, message ids: ${s}`)+`, currently stored: ${this.getConversationsNumber()}`)}this._conversationsBuffer[e]=Object.assign({},t)},this.clearMessageInput=e=>{this.getSavedMessageInput(e)&&(f.log(p.LogTraceArea.ConversationsDraftStore,`clearMessageInput for conversation: ${v.mriOrId(e)}, still stored: ${Object.keys(this._conversations).length}`),d.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&h.default.deleteSavedMessage(e).catch(o.noop)),delete this._conversations[e],delete this._conversationsBuffer[e],this.trigger(e)},this.storeSavedMessage=e=>{const t=this._conversations[e];return t?h.default.storeSavedMessage(e,t):l.Resolved()},this._setSavedMessageInputs=e=>{f.log(p.LogTraceArea.ConversationsDraftStore,`onLoadSavedMessageInputs for conversationsloaded: ${e.length}`),e.forEach((e=>{const t=e&&e.conversationId?e.conversationId:void 0;t&&(this._conversations[t]=e)})),this._cleanupBlankEntries()},this._updateInputEntities=e=>{const t=e.forCustomContext,s=this._conversationsBuffer[t]||this._conversations[t];if(s)s.inputEntitiesDataVersion<=e.newContent.downStreamDataVersion&&(this._conversationsBuffer[t]=Object.assign(Object.assign({},s),{inputEntities:S.applyEditableContentToInputEntities(e.newContent,s.inputEntities),pastedTextType:e.newContent.pastedTextType}),f.log(p.LogTraceArea.ConversationsDraftStore,`_updateInputEntities for conversation:${v.mriOrId(t)}, updated entry count: ${this._conversationsBuffer[t].inputEntities.length}`));else{const s=S.applyEditableContentToInputEntities(e.newContent,[]);f.log(p.LogTraceArea.ConversationsDraftStore,`_updateInputEntities for conversation: ${v.mriOrId(t)}, created entry count: ${s.length}`),o.size(s)>0&&(this._conversationsBuffer[t]={inputEntities:s,inputEntitiesDataVersion:e.newContent.downStreamDataVersion,messages:void 0,type:C.SavedMessageType.None,timestamp:Date.now(),pastedTextType:e.newContent.pastedTextType},f.track(new u.DraftMessageCreated))}},this._cleanupBlankEntries=()=>{const e=[];o.each(this._conversations,((t,s)=>{0!==t.inputEntities.length&&!this._isOnlySpaces(t.inputEntities)||!o.isEmpty(t.messages)&&!o.includes([C.SavedMessageType.None,C.SavedMessageType.Edited],t.type)||(e.push(s),delete this._conversations[s],d.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&h.default.deleteSavedMessage(s).catch(o.noop))})),e.length>0&&(f.log(p.LogTraceArea.ConversationsDraftStore,`_cleanupBlankEntries deleted ${e.length} entries, still stored: ${o.size(this._conversations)}`),this.trigger(e))},_.RegisterStartupable(this,"ConversationsDraftStore")}startup(){return n.dataUpdateReceivedEvent.subscribe((e=>{this._updateInputEntities(e)})),d.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&g.default.queueIdleTask("ConversationsDraftStore",g.TaskTypeFlags.CpuIntensive,(()=>{h.default.loadSavedMessageInputs().then(this._setSavedMessageInputs)}),g.Priority.High),l.Resolved()}getSavedMessageInput(e){return this._conversations[e]}getDraftTimestampForConversation(e){const t=this.getSavedMessageInput(e);return t&&t.timestamp?t.timestamp:void 0}getConversationsWithDraft(){const e=[];return o.each(this._conversations,((t,s)=>{const i=(0,c.default)().getConversation(s);i&&e.push(i)})),e}getConversationsNumber(){return o.size(this._conversations)}updateInputEntitiesFromContent(e,t){return this._updateInputEntities({forCustomContext:e,newContent:t}),this}test_reset(){this._conversations={}}commit(e){return this._conversationsBuffer[e]&&(this._conversations[e]=Object.assign(Object.assign({},this._conversationsBuffer[e]),{timestamp:Date.now()}),delete this._conversationsBuffer[e],this.trigger(e),this.onInputEntitiesUpdatedEvent.fire(e)),this._cleanupBlankEntries(),this}_isOnlySpaces(e){return 1===e.length&&e[0]instanceof m.UnhandledEntity&&0===e[0].text().trim().length}};i.__decorate([r.autoSubscribe,i.__param(0,r.key)],b.prototype,"getSavedMessageInput",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],b.prototype,"getDraftTimestampForConversation",null),i.__decorate([r.autoSubscribe],b.prototype,"getConversationsWithDraft",null),b=i.__decorate([r.AutoSubscribeStore],b),t.default=new b},192758:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041),r=s(889391),a=s(671830),l=s(820770),d=s(539549),c=s(341706),h=s(603088),u=s(582916);var p;!function(e){e[e.LastVisited=0]="LastVisited",e[e.ListMode=1]="ListMode",e[e.ConversationsLoading=2]="ConversationsLoading",e[e.ConversationsLoaded=3]="ConversationsLoaded"}(p||(p={}));let g=class extends n.StoreBase{constructor(){super(...arguments),this._listMode=u.ConversationsListMode.AllConversations,this._conversationsAreLoading=!1}getFilterMode(){return"all"}setFilterMode(e){}setConversationsListMode(e){e!==this._listMode&&(this._listMode=e,this.trigger(p.ListMode))}getConversationsListMode(){return this._listMode}_setConversationsLoadingStatus(e){this._conversationsAreLoading!==e&&(this._conversationsAreLoading=e,this.trigger(p.ConversationsLoading))}areConversationsLoading(){return this._conversationsAreLoading}loadMoreConversations(e){o.isUndefined(e)&&(e=r.default.getS4LMessagingFeaturesNoSubscription().recentConversationsIncrementor);const t=(0,d.default)();t.canPossiblyShowMoreRecentConversations()?(this._setConversationsLoadingStatus(!0),t.increaseLimitOfRecentJoinedConversationsSorted(e).then((e=>{e?this.trigger(p.ConversationsLoaded):this._setConversationsLoadingStatus(!1)}))):this._setConversationsLoadingStatus(!1)}getShownConversations(){let e=(0,d.default)().getDisplayableRecentConversationsSortedLimited();const t=r.default.getS4LMessagingFeatures();let s=l.default.getConversationsWithDraft(),i=t.enableMediaPreviewDrafts?h.default.getConversationsWithMediaDraft():[];return s=s.filter((e=>e.isCurrentUserMember()&&(!e.isDeleted()||e.getDeletedTimestamp()<(l.default.getDraftTimestampForConversation(e.id)||0)))),i=s.filter((e=>e.isCurrentUserMember()&&(!e.isDeleted()||e.getDeletedTimestamp()<(h.default.getDraftPreviewTimestamp(e.id)||0)))),e=o.unionBy(e,s,i,(e=>e.id)),o.compact(o.filter(e,(e=>(!e.isEncryptedThread()||c.default.shouldShowPrivateConv(e.id))&&!e.isArchived())))}setLastVisitedConversationId(e){this._lastVisitedConversationId===e||a.isBookmarkConversation(e)||(this._lastVisitedConversationId=e,this.trigger(p.LastVisited))}getLastVisitedConversationId(){return this._lastVisitedConversationId}test_reset_store(){this._listMode=u.ConversationsListMode.AllConversations,this._conversationsAreLoading=!1,this._lastVisitedConversationId=void 0}};i.__decorate([n.autoSubscribe],g.prototype,"getFilterMode",null),i.__decorate([(0,n.autoSubscribeWithKey)(p.ListMode)],g.prototype,"getConversationsListMode",null),i.__decorate([(0,n.autoSubscribeWithKey)(p.ConversationsLoading)],g.prototype,"areConversationsLoading",null),i.__decorate([(0,n.autoSubscribeWithKey)(p.ConversationsLoaded)],g.prototype,"getShownConversations",null),i.__decorate([(0,n.autoSubscribeWithKey)(p.LastVisited)],g.prototype,"getLastVisitedConversationId",null),g=i.__decorate([n.AutoSubscribeStore],g),t.default=new g},843969:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationsListWithFiltersStore=void 0;const i=s(570655),o=s(496486),n=s(217041),r=s(436303),a=s(889391),l=s(820770),d=s(539549),c=s(341706),h=s(436237),u=s(853374),p="ConversationsListWithFiltersStore";var g;!function(e){e[e.ConversationsLoading=0]="ConversationsLoading",e[e.ConversationsLoaded=1]="ConversationsLoaded"}(g||(g={}));let m=class extends n.StoreBase{constructor(){super(),this._filterMode="all",this._createSortedLists=e=>{const[t,s]=(0,o.partition)(e,r.isContentChannel);return{channels:t,chats:s}},this._numberOfConversationsToShow=a.default.getS4LMessagingFeatures().maxRecentConversationsToShow,this._sortedListsByFilter=this._createSortedLists((0,d.default)().getDisplayableRecentConversationsSortedAll()),(0,d.default)().subscribe((e=>{const t=u.default.newCauseId();(0,h.debug)((()=>[`${p} For keys:`,null==e?void 0:e.join(";"),t])),this._sortedListsByFilter=this._createSortedLists((0,d.default)().getDisplayableRecentConversationsSortedAll()),(0,h.debug)((()=>[`${p} Recalculated: `,this._sortedListsByFilter,t])),this.trigger(g.ConversationsLoaded)}))}areConversationsLoading(){return this._isLoading}getShownConversations(){const e=this._getConversations(),t="channels"===this._filterMode?[]:l.default.getConversationsWithDraft().filter((e=>e.isCurrentUserMember()&&(!e.isDeleted()||e.getDeletedTimestamp()<(l.default.getDraftTimestampForConversation(e.id)||0))));return(0,o.unionBy)(e,t,(e=>e.id)).filter((e=>(!e.isEncryptedThread()||c.default.shouldShowPrivateConv(e.id))&&!e.isArchived()))}getFilterMode(){return this._filterMode}setFilterMode(e){this._filterMode=e,this.trigger()}loadMoreConversations(e){void 0===e&&(e=a.default.getS4LMessagingFeaturesNoSubscription().recentConversationsIncrementor);("all"===this._filterMode?(0,d.default)().canPossiblyShowMoreRecentConversations():this._canShowMoreFilteredConversations(this._filterMode))?(this._setConversationsLoadingStatus(!0),this._increaseNumberOfConversationsToShow(e)):this._setConversationsLoadingStatus(!1)}_increaseNumberOfConversationsToShow(e){"all"===this._filterMode?(0,d.default)().increaseLimitOfRecentJoinedConversationsSorted(e).then((e=>{e?this.trigger(g.ConversationsLoaded):this._setConversationsLoadingStatus(!1)})):(this._numberOfConversationsToShow+=e,this.trigger(g.ConversationsLoaded))}_canShowMoreFilteredConversations(e){return this._numberOfConversationsToShow<this._sortedListsByFilter[e].length}_getConversations(){return"all"===this._filterMode?(0,d.default)().getDisplayableRecentConversationsSortedLimited():this._sortedListsByFilter[this._filterMode].slice(0,this._numberOfConversationsToShow)}_setConversationsLoadingStatus(e){this._isLoading!==e&&(this._isLoading=e,this.trigger(g.ConversationsLoading))}};i.__decorate([(0,n.autoSubscribeWithKey)(g.ConversationsLoading)],m.prototype,"areConversationsLoading",null),i.__decorate([(0,n.autoSubscribeWithKey)(g.ConversationsLoaded)],m.prototype,"getShownConversations",null),i.__decorate([n.autoSubscribe],m.prototype,"getFilterMode",null),m=i.__decorate([n.AutoSubscribeStore],m),t.ConversationsListWithFiltersStore=m},539549:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(570655),o=s(496486),n=s(31615),r=s(217041),a=s(397691),l=s(889391),d=s(63413),c=s(476621),h=s(924339),u=s(746096),p=s(436237),g=s(178735),m=s(18078),S=s(914976),f=s(496856),y=s(33384),v=s(422538),C=s(327795),_=s(793003),b=s(503644),T=s(741660),M=!0,I=_.RecentsSortBy.Time;t.TriggerKeys={AllConversations:"all",RecentDisplayed:"recentDisplayed",RecentDisplayedLimited:"recentDisplayedLimited"};let w,P=class extends r.StoreBase{constructor(){super(300),this._allConversations={},this._allOneToOneThreadIdsByUserMri={},this._allUserMriByOneOnOneThreadIds={},this._mriThreadMapping=new b.MriThreadMapping,this._fakedTimestamps={},this._fakedLastMessages={},this._showFavorites=M,this._recentsSortedBy=I,this._sortedRecentConversations=new y.default((e=>e.id),(e=>this.recentConversationsSortRank(e))),this.recentConversationsSortRank=e=>{let t=-this._getConvTimestamp(e);if(this._showFavorites&&e.isFavorite()&&(t-=f.MagicFavoritesPinnedNumber),this._recentsSortedBy===_.RecentsSortBy.Unread){const s=c.default.getConversationMetaFromMemoryCache(e.id);s&&s.counts&&1===s.counts.hasUnread&&(t-=f.MagicUnreadPinnedNumber)}return t},v.RegisterStartupable(this,"ConversationsStore",[d.default,c.default,g.default])}_getConvTimestamp(e){return this._fakedTimestamps[e.id]||e.getTimestamp()}resortRecentConversations(){const{recentsShowCategories:e,recentsSortedBy:s}=g.default.getUserPreferencesLocal();this._showFavorites=null!=e?e:M,this._recentsSortedBy=null!=s?s:I,p.log(u.LogTraceArea.ConversationStore,"_getSortedRecentsConversations called ShowFavorites:"+this._showFavorites),this._sortedRecentConversations.sort(this.recentConversationsSortRank),this.trigger([t.TriggerKeys.RecentDisplayed,t.TriggerKeys.RecentDisplayedLimited])}startup(){this._maxRecentConversationsToShow=l.default.getS4LMessagingFeatures().maxRecentConversationsToShow;const{recentsShowCategories:e,recentsSortedBy:t}=g.default.getUserPreferencesLocal();return this._showFavorites=null!=e?e:M,this._recentsSortedBy=null!=t?t:I,this._conversationsUpdatedSubscription=c.default.conversationsUpdated.subscribe((e=>{const t=o.uniq(o.flatten(o.map(e,(e=>this._updateConversation(e.conv)))));t.length>0&&this.trigger(t)})),this._blockedMriStoreSubscription=d.default.subscribe((e=>{let t=[];o.each(e,(e=>{const s=this.getConversation(e);if(s&&(t=this._updateConversation(s,!1)),s&&this._allOneToOneThreadIdsByUserMri[e]){const s=this._allOneToOneThreadIdsByUserMri[e],i=this.getConversation(s);i&&t.push(...this._updateConversation(i,!1))}})),t=o.uniq(t),t.length>0&&this.trigger(t)})),c.default.loadAndCacheAllNonHighlightsConversations()}test_reset_store(){this._allConversations={},this._allOneToOneThreadIdsByUserMri={},this._allUserMriByOneOnOneThreadIds={},this._fakedTimestamps={},this._fakedLastMessages={},this._maxRecentConversationsToShow=0,this._showFavorites=M,this._recentsSortedBy=I,this._sortedRecentConversations=new y.default((e=>e.id),this.recentConversationsSortRank),this._conversationsUpdatedSubscription&&(this._conversationsUpdatedSubscription.unsubscribe(),this._conversationsUpdatedSubscription=void 0),this._blockedMriStoreSubscription&&(d.default.unsubscribe(this._blockedMriStoreSubscription),this._blockedMriStoreSubscription=void 0)}_updateConversation(e,s=!0){const i=[];if(!e)return i;if(m.default.isMyMri(e.id))return p.log(u.LogTraceArea.ConversationStore,"Ignoring conversation with self: "+S.mriOrId(e.id)),i;const n=this._allConversations[e.id]===e;if(s&&n)return i;this._allConversations[e.id]=e,i.push(t.TriggerKeys.AllConversations);if(!this._getConvTimestamp(e)&&!e.isDeleted())return i;if(e.isOneToOneUserConvWithThreadIdSupport()){const t=e.getOneOnOneThreadId();t&&(this._allOneToOneThreadIdsByUserMri[e.id]=t,this._allUserMriByOneOnOneThreadIds[t]=e.id)}else if(e.isOneToOneThread()&&o.isUndefined(this._allUserMriByOneOnOneThreadIds[e.id])){const t=e.getOtherPartyMriForOneToOneThread();t?(this._allOneToOneThreadIdsByUserMri[t]=e.id,this._allUserMriByOneOnOneThreadIds[e.id]=t):(p.log(u.LogTraceArea.ConversationStore,"Can not tell other party from 1:1 thread "+e.id),p.track(new C.DevDebug("ConversationsStore","Can not tell other party from 1:1 thread")))}else if(e.isV2OneToOneThread()&&!this._mriThreadMapping.hasThreadId(e.id)){const t=e.getOtherPartyMriForOneToOneThread();t?this._mriThreadMapping.add(t,e.id):(p.warn(u.LogTraceArea.ConversationStore,`Failed to get counter-party mri for v2 1:1 thread: ${e.id}`),p.track(new C.DevDebug("ConversationsStore","Failed to get counter-party mri for v2 1:1 thread")))}const r=e.getTimestamp();this._fakedTimestamps[e.id]&&r>this._fakedTimestamps[e.id]&&delete this._fakedTimestamps[e.id],this._fakedLastMessages[e.id]&&e.lastMessage&&(this._fakedLastMessages[e.id].isLastChangeScheduledCallMetadata()&&this._fakedLastMessages[e.id].createdTime>e.lastMessage.createdTime||delete this._fakedLastMessages[e.id]);const a=this._updateDisplayableList(e);return i.push(...a.triggerKeys),s&&n&&!a.displayabilityChanged||i.push(e.id),i}_updateDisplayableList(e){if(!e)return{displayabilityChanged:!1,triggerKeys:[]};let s,i;const r=[],a=this._sortedRecentConversations.contains(e.id),l=h.getConversationDisplayableStatus(e);a&&!l.isDisplayable&&n.default.closeSplitView(e.id),a&&(s=l.isDisplayable?this._sortedRecentConversations.getIndex(e.id):this._sortedRecentConversations.remove(e.id)),l.isDisplayable&&(this._sortedRecentConversations.put(e),i=this._sortedRecentConversations.getIndex(e.id)),(void 0!==i&&i!==s&&i<this._maxRecentConversationsToShow||void 0!==s&&s<this._maxRecentConversationsToShow&&!l.isDisplayable)&&r.push(t.TriggerKeys.RecentDisplayedLimited),a!==l.isDisplayable&&r.push(t.TriggerKeys.RecentDisplayed);const d=c.default.getConversationMetaFromMemoryCache(e.id),g=d&&d.counts&&1===d.counts.hasUnread;return p.log(u.LogTraceArea.ConversationStore,`_updateDisplayableList for ${S.mriOrId(e.id)}, isFavorite:${e.isFavorite()}, hasUnread:${g}, timeStamp:${this._getConvTimestamp(e)}, wasDisplayed:${a}${s?" at position "+s:""}, isDisplayable:${l.isDisplayable}${i?" at position "+i:""}`+(o.isEmpty(l.debugReason)?"":", reason: "+l.debugReason)+`, maxRecentsShown: ${this._maxRecentConversationsToShow} from total ${this._sortedRecentConversations.getLength()}`+` displayable conversations. TriggerKeys ${o.join(r,",")}`),{displayabilityChanged:a!==l.isDisplayable,triggerKeys:r}}fakeConversationTime(e,t){this._fakedTimestamps[e]=t;const s=this.getConversation(e),i=[e];s&&i.push(...this._updateConversation(s,!1)),this.trigger(o.uniq(i))}fakeLastMessage(e,t){this._fakedLastMessages[e]=t,this.trigger(e)}getConversationPotentiallyBeforeStartupAsync(e){const t=this._allConversations[e];return t?a.Resolved(t):c.default.getConversationMetaAsync(e).then((e=>{if(e)return this.trigger(this._updateConversation(e.conv)),e.conv}))}getConversationNoSubscription(e){const t=this._allConversations[e];if(!t){const t=c.default.getConversationMetaFromMemoryCache(e);return null==t?void 0:t.conv}return t}getConversation(e){const t=this._allConversations[e];if(!t){const t=c.default.getConversationMetaFromMemoryCache(e);if(t)return this.trigger(this._updateConversation(t.conv)),t.conv;c.default.ensureConversationLoaded(e)}return t}isConversationKnown(e){return!!this._allConversations[e]}isClearApplicableAndKeepInRecents(e){const t=this._allConversations[e];return!!t&&(t.isThread()&&!t.isOneOnOne())}ableToViewConversation(e){const t=this._allConversations[e];return t?p.log(u.LogTraceArea.ConversationStore,"ableToViewConversation: "+S.mriOrId(e)+"isCurrentUserMember: ",t.isCurrentUserMember()," is Blocked: ",this.isConversationBlocked(t)):p.log(u.LogTraceArea.ConversationStore,"conversation not found in this._allConversations"),t&&t.isCurrentUserMember()&&!this.isConversationBlocked(t)}getAllConversationsInMemory(){return this._allConversations}getFakeTimestamp(e){return this._fakedTimestamps[e]}getFakeLastMessageFallback(e){return this._fakedLastMessages[e]}hasJoinedConversationsWithCall(){return!!o.find(this._allConversations,(e=>e.isCurrentUserMember()&&!!e.lastCallTime))}getMostRecentJoinedConversationId(e){const t=this.getDisplayableRecentConversationsSortedAll(),s=e?o.find(t,(t=>t.id!==e)):o.head(t);return s?s.id:void 0}isConversationBlocked(e){return!!e&&d.default.isMriBlocked(e.getOtherPartyMriOrConvId())}getSortedArchivedConversations(){return o.sortBy(this.getArchivedConversations(),(e=>-this._getConvTimestamp(e)))}getArchivedConversations(){return o.filter(this._allConversations,(e=>e.isArchived()&&h.isConversationDisplayable(e)))}getArchivedChats(){return this.getSortedArchivedConversations().filter((e=>!(0,T.isContentChannel)(e)&&!(0,T.isTodayBot)(e.id)))}getArchivedChannels(){return this.getSortedArchivedConversations().filter((e=>(0,T.isContentChannel)(e)||(0,T.isTodayBot)(e.id)))}getDisplayableRecentConversationsSortedAll(){return this._sortedRecentConversations.getSortedArray()}getDisplayableRecentConversationsSortedLimited(){return this._sortedRecentConversations.getSortedArray().slice(0,this._maxRecentConversationsToShow)}canPossiblyShowMoreRecentConversations(){return this._maxRecentConversationsToShow<this._sortedRecentConversations.getLength()}increaseLimitOfRecentJoinedConversationsSorted(e){return this.canPossiblyShowMoreRecentConversations()?(p.log(u.LogTraceArea.ConversationStore,"Expanding displayable recent list limit, increase from "+this._maxRecentConversationsToShow+" by increment "+e),this._maxRecentConversationsToShow+=e,this.trigger(t.TriggerKeys.RecentDisplayedLimited),a.Resolved(!0)):a.Resolved(!1)}getTranslatedConversations(){return o.filter(this._allConversations,(e=>!e.isTranslationDisabled()))}getOtherPartyMriFromOneToOneThreadId(e){const t=this._allUserMriByOneOnOneThreadIds[e];return o.isUndefined(t)&&p.warn(u.LogTraceArea.ConversationStore,"Could not find otherPartyMri for OneOnOneThreadId"),t}getV2ThreadMapping(){return this._mriThreadMapping}};i.__decorate([r.disableWarnings],P.prototype,"getConversationNoSubscription",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],P.prototype,"getConversation",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],P.prototype,"isConversationKnown",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],P.prototype,"isClearApplicableAndKeepInRecents",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],P.prototype,"ableToViewConversation",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],P.prototype,"getAllConversationsInMemory",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],P.prototype,"getFakeTimestamp",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],P.prototype,"getFakeLastMessageFallback",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],P.prototype,"hasJoinedConversationsWithCall",null),i.__decorate([r.autoSubscribe],P.prototype,"getMostRecentJoinedConversationId",null),i.__decorate([r.autoSubscribe],P.prototype,"isConversationBlocked",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],P.prototype,"getSortedArchivedConversations",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],P.prototype,"getArchivedConversations",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],P.prototype,"getArchivedChats",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],P.prototype,"getArchivedChannels",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.RecentDisplayed)],P.prototype,"getDisplayableRecentConversationsSortedAll",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.RecentDisplayedLimited)],P.prototype,"getDisplayableRecentConversationsSortedLimited",null),i.__decorate([(0,r.autoSubscribeWithKey)([t.TriggerKeys.RecentDisplayed])],P.prototype,"canPossiblyShowMoreRecentConversations",null),P=i.__decorate([r.AutoSubscribeStore],P),t.default=function(){return w||(w=new P)}},685329:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomCallReactionsStore=void 0;const i=s(570655),o=s(496486),n=s(217041),r=s(397691),a=s(889391),l=s(601446),d=s(733754),c=s(46929),h=s(422538);let u,p=class extends l.CustomReactionsStoreBase{constructor(){super(),h.RegisterStartupable(this,"CustomCallReactionsStore",[c.default])}startup(){var e;super.startup();const t=null===(e=a.default.getS4LCMCFeatures())||void 0===e?void 0:e.customCallReactions;return this._enabled=null==t?void 0:t.enabled,this._maxReactionsNumber=null==t?void 0:t.maxNumberOfCustomReactions,this._initialTabId=null==t?void 0:t.initialTabId,a.default.subscribe((()=>{const{enabled:e,maxNumberOfCustomReactions:t,initialTabId:s}=a.default.getS4LCMCFeatures().customCallReactions;let i=!1;this._enabled!==e&&(this._enabled=e,i=!0),this._maxReactionsNumber!==t&&(this._maxReactionsNumber=t,i=!0),this._initialTabId=s,i&&this.trigger()})),r.Resolved()}getDefaultReactions(){var e;return o.assign([],null===(e=a.default.getS4LCMCFeatures())||void 0===e?void 0:e.customCallReactions.defaultPack)}getSavedReactions(){return c.default.getCustomCallReactions()||[]}saveCurrentReactions(){c.default.setCustomCallReactions(this._localReactions),super.saveCurrentReactions()}getInitialTabId(){return this._initialTabId}isFeatureEnabled(){return this._enabled}getMaxReactionsCount(){return this._maxReactionsNumber}getModalTitle(){return d.getString("ReactionsPanel.CustomCallReactionsTitle")}};p=i.__decorate([n.AutoSubscribeStore],p),t.CustomCallReactionsStore=p,t.default=function(){return u||(u=new p)}},601446:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomReactionsStoreBase=t.TriggerKeys=void 0;const i=s(570655),o=s(496486),n=s(516778),r=s(217041),a=s(397691),l=s(733754);var d;!function(e){e[e.CurrentReactions=0]="CurrentReactions",e[e.SavedReactions=1]="SavedReactions"}(d=t.TriggerKeys||(t.TriggerKeys={}));let c=class extends r.StoreBase{startup(){return a.Resolved()}getCurrentReactions(){return this._loadCurrentReactionsPack()}getCustomReactions(){return this._getSavedOrDefaultReactions()}addReactions(e){const t=this._loadCurrentReactionsPack();this._localReactions&&this._localReactions.length<this.getMaxReactionsCount()&&(this._setLocalReactions(o.uniq([...e,...t])),this._getScreenReaderAnnouncement(e,"ReactionsPanel.AddedCustomReactios"),this.trigger(d.CurrentReactions))}removeReactions(e){const t=this._loadCurrentReactionsPack();this._setLocalReactions(t.filter((t=>!o.includes(e,t)))),this._getScreenReaderAnnouncement(e,"ReactionsPanel.RemovedCustomReactios"),this.trigger(d.CurrentReactions)}removeReactionsAt(e){const t=this._loadCurrentReactionsPack();this._setLocalReactions(t.filter(((t,s)=>!o.includes(e,s)))),this.trigger(d.CurrentReactions)}resetUnsavedReactions(){this._localReactions=void 0,this.trigger(d.CurrentReactions)}isCustomReaction(e){return!o.includes(this.getDefaultReactions(),e)}isLocalReaction(e){return o.includes(this._localReactions,e)}getLocalReactionsCount(){var e;return null===(e=this._localReactions)||void 0===e?void 0:e.length}getCustomReactionsCount(){return this.getMaxReactionsCount()}getCustomReactionsModalTitle(){return this.getModalTitle()}hasBeenCustomized(){return this.isFeatureEnabled()&&0!==this.getSavedReactions().length}saveCurrentReactions(){this._localReactions&&0===this._localReactions.length&&(this._localReactions=void 0),this.trigger(d.SavedReactions)}_loadCurrentReactionsPack(){return this._localReactions||(this._localReactions=this._getSavedOrDefaultReactions()),this._localReactions}_getScreenReaderAnnouncement(e,t){n.Accessibility.announceForAccessibility(l.getString(t,{name:e.join(", ")}))}_setLocalReactions(e){this._localReactions=e}_getSavedOrDefaultReactions(){const e=this.getSavedReactions();return this.isFeatureEnabled()&&0!==e.length?e:this.getDefaultReactions()||[]}};i.__decorate([(0,r.autoSubscribeWithKey)(d.CurrentReactions)],c.prototype,"getCurrentReactions",null),i.__decorate([(0,r.autoSubscribeWithKey)(d.SavedReactions)],c.prototype,"getCustomReactions",null),i.__decorate([r.autoSubscribe],c.prototype,"getCustomReactionsCount",null),i.__decorate([(0,r.autoSubscribeWithKey)(d.SavedReactions)],c.prototype,"hasBeenCustomized",null),c=i.__decorate([r.AutoSubscribeStore],c),t.CustomReactionsStoreBase=c},884817:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(570655),o=s(850066),n=s(217041),r=s(148540),a=s(397691),l=s(994224),d=s(384876),c=s(746096),h=s(436237),u=s(422538),p=s(404057);var g;!function(e){e[e.Device=0]="Device",e[e.DesktopVIMDeviceStatus=1]="DesktopVIMDeviceStatus"}(g=t.TriggerKeys||(t.TriggerKeys={}));let m=class extends n.StoreBase{constructor(){super(),this._desktopVIMDeviceUpdated=(e,t,s)=>{this._fireDesktopVIMDeviceUpdate(),this._onSelectedDeviceChanged(e,t,s)},this._onSelectedDeviceChanged=(e,t,s)=>{h.log(c.LogTraceArea.Calling,"DesktopCaptureSettingsStore._onSelectedDeviceChanged causeId: "+s+"; userAction: "+t+"; devices: "+JSON.stringify(e));const i=e.filter((e=>e.kind===r.DeviceType.Microphone));i.length>0&&d.default.CallManagerHelper.selectedMicDidChange(i[0].id,t,s)},this._isAVDeviceReady=!1,u.RegisterStartupable(this,"DesktopCaptureSettingsStore",[])}startup(){return l.default.DeviceStore.selectedDevicesChangedEvent().subscribe(this._desktopVIMDeviceUpdated),this._fireDesktopVIMDeviceUpdate(),a.Resolved()}destroy(){l.default.DeviceStore.selectedDevicesChangedEvent().unsubscribe(this._desktopVIMDeviceUpdated)}isAVDeviceReady(){return this._isAVDeviceReady&&l.default.DeviceStore.hasCameras()&&!l.default.CallingStore.hasConnectedCalls()}getSelectedCameraID(){return o.default.mapLabelToDeviceId("videoinput",l.default.DeviceStore.getCurrentDevicesLabel().camera)}getSelectedMicID(){return o.default.mapLabelToDeviceId("audioinput",l.default.DeviceStore.getCurrentDevicesLabel().microphone)}_fireDesktopVIMDeviceUpdate(){o.default.isAVRecordingSupported().then((e=>{this._isAVDeviceReady=e,h.log(c.LogTraceArea.Capture,"_desktopVIMDeviceUpdated, current Desktop VIM support is  "+e)})).catch((e=>{this._isAVDeviceReady=!1,h.error(c.LogTraceArea.Capture,"_desktopVIMDeviceUpdated Error when enumerateDevice as "+p.default.errorAsString(e))})).always((()=>{this.trigger(g.DesktopVIMDeviceStatus)}))}test_resetFields(){this._isAVDeviceReady=!1}};i.__decorate([(0,n.autoSubscribeWithKey)(g.DesktopVIMDeviceStatus)],m.prototype,"isAVDeviceReady",null),i.__decorate([(0,n.autoSubscribeWithKey)(g.Device)],m.prototype,"getSelectedCameraID",null),i.__decorate([(0,n.autoSubscribeWithKey)(g.Device)],m.prototype,"getSelectedMicID",null),m=i.__decorate([n.AutoSubscribeStore],m),t.default=new m},843368:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041),n=s(898278),r=s(783294);let a=class extends o.StoreBase{constructor(){super(...arguments),this._shouldShow={[n.MainRootViewId]:!1},this._selectedTabType=r.defaultTabType}shouldShow(e){return!!this._shouldShow[e]}open(e){this._shouldShow[e]=!0,this.trigger()}close(e){this._shouldShow[e]=!1,this._selectedTabType=r.defaultTabType,this._searchQuery=void 0,this.trigger()}openInSearchMode(e,t,s){this._shouldShow[s]=!0,this._selectedTabType=e,this._searchQuery=t,this.trigger()}getPickerSearchProps(){return{selectedTabType:this._selectedTabType,searchQuery:this._searchQuery}}};i.__decorate([o.autoSubscribe],a.prototype,"shouldShow",null),i.__decorate([o.autoSubscribe],a.prototype,"getPickerSearchProps",null),a=i.__decorate([o.AutoSubscribeStore],a),t.default=new a},341706:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041),r=s(397691),a=s(889391),l=s(476621),d=s(581697),c=s(539549),h=s(667121),u=s(125793),p=s(746096),g=s(436237),m=s(861253),S=s(18078),f=s(575057),y=s(914976),v=s(422538),C=s(404057),_=[u.SecureHandshakeState.None,u.SecureHandshakeState.OtherEndpointInUse];let b=class extends n.StoreBase{constructor(){super(),this._handshakeStates={},this._localPrivateConvs={},this._updateLocalPrivateConvs=(e,t)=>{this._localPrivateConvs[e]=t},this._conversationUpdated=e=>{o.each(e,(e=>{if(e.conv.isEncryptedThread()){this._updatePrivateConvStoredLocaly(e.conv.id);const t=e.conv.getEncryptionHandshake();this._processHandshakeForConv(e.conv)&&u.default.isAccepted(t)&&u.default.isInitiatedByMe(t)&&o.defer((()=>{h.default.sendConfirm(e.conv.id,!0).catch((e=>{g.warn(p.LogTraceArea.E2EEncryption,"Auto accept failed with error: ",C.default.errorAsString(e))}))}))}}))},this._rejectActiveConversations=()=>{const e=f.default.getAllPrivateConversationMris(),t=o.filter(e,(e=>!o.includes(_,this.getHandshakeState(e)))),s=o.map(t,(e=>h.default.sendReject(e,p.E2EERejectionReason.IdentityLost).catch(o.noop)));return r.all(s)},v.RegisterStartupable(this,"E2eeHandshakeStore",[l.default,c.default,u.default])}startup(){return l.default.conversationsUpdated.subscribe(this._conversationUpdated),h.default.identityUpdated.subscribe(this._rejectActiveConversations),h.default.conversationStored.subscribe(this._updateLocalPrivateConvs),r.Resolved()}getHandshakeState(e){let t=this._handshakeStates[e];if(!t){const s=(0,c.default)().getConversation(e);s?(this._processHandshakeForConv(s),t=this._handshakeStates[e]):l.default.getConversationMetaAsync(e).then((e=>{e&&this._processHandshakeForConv(e.conv)}))}return t||u.SecureHandshakeState.None}shouldShowPrivateConv(e){if(!a.default.getS4LMessagingFeatures().hidePrivateConversationsOnOtherEndpoints)return!0;return this.getHandshakeState(e)!==u.SecureHandshakeState.OtherEndpointInUse||this._getLocalPrivateConv(e)}_getLocalPrivateConv(e){let t=this._localPrivateConvs[e];return o.isUndefined(t)&&(this._updatePrivateConvStoredLocaly(e),t=this._localPrivateConvs[e]),t||!1}test_resetSubscriptions(){l.default.conversationsUpdated.unsubscribe(this._conversationUpdated),h.default.identityUpdated.unsubscribe(this._rejectActiveConversations)}_updatePrivateConvStoredLocaly(e){h.default.isPrivateConvStoredLocally(e).then((t=>this._localPrivateConvs[e]=t))}_processHandshakeForConv(e){const t=e.getEncryptionHandshake(),s=e.id;if(!t)return g.warn(p.LogTraceArea.E2EEncryption,`Secure thread ${y.mriOrId(s)} with no handshake info`),d.default.forceThreadDetailsFetchIfNeeded(s),!1;if(!S.default.isMyMri(t.AParty)&&!S.default.isMyMri(t.BParty))return g.warn(p.LogTraceArea.E2EEncryption,"Got unrelated handshake"),d.default.forceThreadDetailsFetchIfNeeded(s),!1;const i=this._handshakeStates[s],o=u.default.getDetailedHandshakeState(e);return!(0,m.default)(i,o)&&(this._handshakeStates[s]=o,g.log(p.LogTraceArea.E2EEncryption,`Handshake for ${y.mriOrId(s)} changed state - ${u.SecureHandshakeState[o]}`),this.trigger(s),o===u.SecureHandshakeState.None&&h.default.terminateSession(t),!0)}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],b.prototype,"getHandshakeState",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],b.prototype,"shouldShowPrivateConv",null),b=i.__decorate([n.AutoSubscribeStore],b),t.default=new b},82433:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmoticonIconType=void 0;const i=s(570655),o=s(496486),n=s(217041),r=s(397691),a=s(481169),l=s(562141),d=s(681959),c=s(905450),h=s(212229),u=s(732183),p=s(998754),g=s(422538),m=s(177878),S="a-zA-Z_0-9():";var f;!function(e){e[e.Small=0]="Small",e[e.Large=1]="Large",e[e.ExtraLarge=2]="ExtraLarge",e[e.ExtraExtraLarge=3]="ExtraExtraLarge"}(t.EmoticonIconType||(t.EmoticonIconType={})),function(e){e[e.ToneChanged=0]="ToneChanged",e[e.GroupItemChanged=1]="GroupItemChanged"}(f||(f={}));let y=class extends n.StoreBase{constructor(){super(),this._map={},this._firstLettersMap={},this._validCharactersPattern="(?:["+S+"])",this._reverseMap={},this._reverseFirstLetterMap={},this._countryCodes={},this._lastUsedToneMap={},this._lastUsedEmoticonGroupItemMap={},this._groupedEmoticons=[],this.setLastUsedTone=(e,t)=>{this._lastUsedToneMap[e]!==t&&(t&&1!==t?this._lastUsedToneMap=Object.assign(Object.assign({},this._lastUsedToneMap),{[e]:t}):delete this._lastUsedToneMap[e],p.default.putData(l.InternalKeys.LastlyUsedEmoticonTones,this._lastUsedToneMap),this.trigger(f.ToneChanged))},this.setLastUsedEmoticonGroupItem=(e,t)=>{this._lastUsedEmoticonGroupItemMap[e]!==t&&(t&&t!==e?this._lastUsedEmoticonGroupItemMap=Object.assign(Object.assign({},this._lastUsedEmoticonGroupItemMap),{[e]:t}):delete this._lastUsedEmoticonGroupItemMap[e],p.default.putData(l.InternalKeys.LastlyUsedEmoticonGroupItem,this._lastUsedEmoticonGroupItemMap),this.trigger(f.GroupItemChanged))},g.RegisterStartupable(this,"EmoticonStore",[p.default])}startup(){this._lastUsedToneMap=p.default.getDataExclusive(l.InternalKeys.LastlyUsedEmoticonTones)||{},this._lastUsedEmoticonGroupItemMap=p.default.getDataExclusive(l.InternalKeys.LastlyUsedEmoticonGroupItem)||{};const e=c.getDefaultMap();return this._setMap(e),this.setEmoticons((0,o.values)(e),!1),this._countryCodes=(0,o.invert)(h.getCountryCodes()),r.Resolved()}setEmoticons(e,t=!0){const s={};(0,o.each)(e,(e=>{(0,o.each)(e.shortcuts,(t=>{s[t]=e}))})),this._groupedEmoticons=(0,o.uniq)((0,o.compact)((0,o.flatMap)(e,(e=>e.group?e.group.slice():[])))),this._setMap(s),t&&this.trigger()}getEmoticons(){return this.getEmoticonsNoSubscription()}getEmoticonsNoSubscription(){return this._map}getEmoticonsByName(){return(0,o.mapValues)(this._reverseMap,(e=>this._map[e]))}getEmoticonByShortcut(e){return this.getEmoticonByShortcutNoSubscription(e)}getEmoticonByShortcutNoSubscription(e){const t=this._normalizeEmoticonName(e);return this._map[t]}_getEmoticonByName(e){const t=this._reverseMap[e];if(t)return this._map[t]}getEmoticonByName(e){return this._getEmoticonByName(e)}getEmoticonByNameNoSubscription(e){return this._getEmoticonByName(e)}getEmoticonUrlFromName(e,t,s,i,o){const n=s||u.getDefaultEmoticonSize(t);return u.getEmoticonUrl(e,n,!0,i,o)}getEmoticonFirstLetterMap(){return this._firstLettersMap}getValidEmoticonCharactersPattern(){return this._validCharactersPattern}_normalizeEmoticonName(e){if(!e)return"";if(e.length>2&&e.startsWith("(")&&e.endsWith(")")){const t=u.getSanitizedEmoticonName(e).toLowerCase(),s=this._map[t];return s&&s.diverse?t:e.toLowerCase()}return e}isEmoticon(e){const t=this._normalizeEmoticonName(e);return!!this._firstLettersMap[t[0]]&&!!this._map[t]}isEmoticonType(e){return!!this._reverseFirstLetterMap[e[0]]&&!!this._reverseMap[e]}hasCountry(e){return e in this._countryCodes}setEmoticon(e){const t=(0,o.keyBy)(e.shortcuts),s=(0,o.mapValues)(t,(()=>e));(0,o.each)(this._map,((e,t)=>{s[t]=e})),this._setMap(s),this.trigger(e.id)}getLastUsedTones(){return this._lastUsedToneMap}getEmoticonTone(e){return this._lastUsedToneMap[e]}getEmoticonUtfFallback(e){var t;return null===(t=this._getEmoticonByName(e))||void 0===t?void 0:t.utf}getLastUsedEmoticonGroupItems(){return this._lastUsedEmoticonGroupItemMap}getGroupedEmoticons(){return this._groupedEmoticons}_setMap(e){this._map=e,this._firstLettersMap=this._findFirstLetters(this._map),this._validCharactersPattern=this._validCharacters(this._map);const t={};(0,o.each)(this._map,((e,s)=>{t[e.id]=s,void 0!==e.utf&&null!==e.utf&&(d.ContentToTextTransformer.addUtfFallback(e.id,e.utf),m.UnicodeEmojiTransformer.addUtfLookup(e.utf,e.id))})),this._reverseMap=t,this._reverseFirstLetterMap=this._findFirstLetters(this._reverseMap)}_findFirstLetters(e){const t=(0,o.map)(e,((e,t)=>t[0]));return(0,o.keyBy)(t)}_validCharacters(e){const t=new RegExp("[^"+S+"]","gi"),s=(0,o.keys)(e),i=(0,a.chain)(s,(0,a.map)((e=>(0,o.flatten)(e.match(t)))),(0,a.flatten)(),(0,a.uniq)(),(0,a.map)(o.escapeRegExp),(0,a.join)("|"));return"(?:["+S+"]|"+i+")"}};i.__decorate([n.autoSubscribe],y.prototype,"getEmoticons",null),i.__decorate([n.autoSubscribe],y.prototype,"getEmoticonsByName",null),i.__decorate([n.autoSubscribe],y.prototype,"getEmoticonByShortcut",null),i.__decorate([n.autoSubscribe],y.prototype,"getEmoticonByName",null),i.__decorate([n.disableWarnings],y.prototype,"getEmoticonByNameNoSubscription",null),i.__decorate([n.autoSubscribe],y.prototype,"getEmoticonUrlFromName",null),i.__decorate([n.autoSubscribe],y.prototype,"getEmoticonFirstLetterMap",null),i.__decorate([n.autoSubscribe],y.prototype,"getValidEmoticonCharactersPattern",null),i.__decorate([n.autoSubscribe],y.prototype,"isEmoticon",null),i.__decorate([n.autoSubscribe],y.prototype,"isEmoticonType",null),i.__decorate([n.autoSubscribe],y.prototype,"hasCountry",null),i.__decorate([(0,n.autoSubscribeWithKey)(f.ToneChanged)],y.prototype,"getLastUsedTones",null),i.__decorate([(0,n.autoSubscribeWithKey)(f.GroupItemChanged)],y.prototype,"getLastUsedEmoticonGroupItems",null),i.__decorate([n.autoSubscribe],y.prototype,"getGroupedEmoticons",null),y=i.__decorate([n.AutoSubscribeStore],y);const v=new y;t.default=v},474728:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041);let n=class extends o.StoreBase{constructor(){super(...arguments),this._limitOfListItemsToDisplayEmptyState=2,this._limitOfNotificationListItemsToDisplayEmptyState=0,this._recentsEmpty=!1,this._callsEmpty=!0,this._phoneCallsEmpty=!0,this._contactsEmpty=!0,this._notificationsEmpty=!0,this._callsEmptyOnDemand=!1,this._contactsEmptyOnDemand=!1,this._notificationsEmptyOnDemand=!1}getRecentsEmpty(){return this._recentsEmpty}getCallsEmpty(e=!1){return e?this._callsEmptyOnDemand:this._callsEmpty}getPhoneCallsEmpty(){return this._phoneCallsEmpty}getContactsEmpty(e=!1){return e?this._contactsEmptyOnDemand:this._contactsEmpty}getNotificationsEmpty(e=!1){return e?this._notificationsEmptyOnDemand:this._notificationsEmpty}setRecentsEmpty(){this._recentsEmpty=!0,this.trigger()}setCallsEmpty(e,t=!1){this._callsEmptyOnDemand=t,this._callsEmpty=this._shouldShowEmptyStateIllustrationScreen(e),this.trigger()}setPhoneCallsEmpty(e){this._phoneCallsEmpty=this._shouldShowEmptyStateIllustrationScreen(e),this.trigger()}setContactsEmpty(e,t=!1){this._contactsEmptyOnDemand=t,this._contactsEmpty=this._shouldShowEmptyStateIllustrationScreen(e),this.trigger()}setNotificationsEmpty(e,t=!1){this._notificationsEmptyOnDemand=t,this._notificationsEmpty=this._shouldShowEmptyStateIllustrationScreen(e,!0),this.trigger()}_shouldShowEmptyStateIllustrationScreen(e,t){return e<=(t?this._limitOfNotificationListItemsToDisplayEmptyState:this._limitOfListItemsToDisplayEmptyState)}};i.__decorate([o.autoSubscribe],n.prototype,"getRecentsEmpty",null),i.__decorate([o.autoSubscribe],n.prototype,"getCallsEmpty",null),i.__decorate([o.autoSubscribe],n.prototype,"getPhoneCallsEmpty",null),i.__decorate([o.autoSubscribe],n.prototype,"getContactsEmpty",null),i.__decorate([o.autoSubscribe],n.prototype,"getNotificationsEmpty",null),n=i.__decorate([o.AutoSubscribeStore],n),t.default=new n},839821:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041),n=s(397691),r=s(606452),a=s(907234),l=s(422538);let d=class extends o.StoreBase{constructor(){super(),l.RegisterStartupable(this,"FileDownloadStore",[r.default,a.default])}startup(){return r.default.downloadUpdated.subscribe((e=>{e.isCached&&this.trigger(e.key)})),a.default.cacheUpdated.subscribe((e=>{this.trigger(e)})),n.Resolved()}getLocalUri(e){return a.default.getLocalUri(e)}};i.__decorate([o.autoSubscribe,i.__param(0,o.key)],d.prototype,"getLocalUri",null),d=i.__decorate([o.AutoSubscribeStore],d),t.default=new d},409628:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ForwardMessageState=void 0;const i=s(570655),o=s(217041),n=s(733754);var r;!function(e){e[e.NotSent=0]="NotSent",e[e.Sending=1]="Sending",e[e.Sent=2]="Sent"}(r=t.ForwardMessageState||(t.ForwardMessageState={}));let a=class extends o.StoreBase{getStateForMri(e){return this._forwardMessageState[e]?this._forwardMessageState[e]:r.NotSent}updateSendingStatus(e,t){this._forwardMessageState[e]=t,this.trigger(e)}reset(){this._forwardMessageState={}}getAccessibilityLabelForMRI(e,t){const s=this._forwardMessageState[e];let i="ShareWithPanel.SendToAccessibilityLabel";return s&&s===r.Sent&&(i="ShareWithPanel.SentToAccessibilityLabel"),n.getString(i,{displayName:t})}};i.__decorate([o.autoSubscribe,i.__param(0,o.key)],a.prototype,"getStateForMri",null),i.__decorate([o.autoSubscribe,i.__param(0,o.key)],a.prototype,"getAccessibilityLabelForMRI",null),a=i.__decorate([o.AutoSubscribeStore],a),t.default=new a},443106:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(570655),o=s(496486),n=s(217041),r=s(889391),a=s(626712),l={gifItems:[],nextOffset:0,searchQuery:""};var d;!function(e){e[e.Searching=0]="Searching",e[e.CategoryResults=1]="CategoryResults",e[e.SearchResults=2]="SearchResults"}(d=t.TriggerKeys||(t.TriggerKeys={}));let c=class extends n.StoreBase{constructor(){super(...arguments),this._categoriesMap={},this._searchMap={},this._isSearching=!1,this._lastGifSearchParams={searchQuery:"",limitCount:void 0,offset:void 0}}getGifsForSearch(){return this._gifSearchResults?this._gifSearchResults:l}getGifsIdsFromSearch(){return o.map(this._searchMap,(e=>e.id))}getCategoryGif(e){return this._categoriesMap[e]}getSearchGif(e){return this._searchMap[e]}isSearching(){return this._isSearching}setCategoryGifs(e){this._setCategoryMap(e),this.trigger(d.CategoryResults)}setSearchGifs(e,t){const s=o.map(e.gifItems,((t,s)=>Object.assign(Object.assign({},t),{itemIndex:s,packItemsCount:e.gifItems.length,asmImageProxy:this._getImageProxyUrl(t.full.url),asmImageProxySmall:this._getImageProxyUrl(t.small.url)}))),i=this._gifSearchResults&&t===this._gifSearchResults.searchQuery?o.unionBy(this._gifSearchResults.gifItems,s,"id"):s;this._gifSearchResults={gifItems:i,nextOffset:e.nextOffset,searchQuery:t},this._setSearchMap(),this.trigger(d.SearchResults)}resetSearchGifs(){this._gifSearchResults=void 0,this._setSearchMap()}setSearchingFlag(e){this._isSearching=e,this.trigger(d.Searching)}setSearchParams(e,t,s){this._lastGifSearchParams.searchQuery=e,this._lastGifSearchParams.limitCount=t,this._lastGifSearchParams.offset=s}getSearchParams(){return this._lastGifSearchParams}_getImageProxyUrl(e){return a.default.addUrlParameter(r.default.getS4LMessagingFeatures().asmImageProxy,"url",encodeURIComponent(e))}_setCategoryMap(e){const t={};o.each(e.gifItems,((s,i)=>{t[s.id]=Object.assign(Object.assign({},s),{itemIndex:i,packItemsCount:e.gifItems.length,asmImageProxy:this._getImageProxyUrl(s.full.url),asmImageProxySmall:this._getImageProxyUrl(s.small.url)})})),this._categoriesMap=Object.assign(Object.assign({},this._categoriesMap),t)}_setSearchMap(){const e={};this._gifSearchResults&&o.each(this._gifSearchResults.gifItems,((t,s)=>{e[t.id]=Object.assign(Object.assign({},t),{itemIndex:s,packItemsCount:this._gifSearchResults?this._gifSearchResults.gifItems.length:0,asmImageProxy:this._getImageProxyUrl(t.full.url),asmImageProxySmall:this._getImageProxyUrl(t.small.url)})})),this._searchMap=e}};i.__decorate([(0,n.autoSubscribeWithKey)(d.SearchResults)],c.prototype,"getGifsForSearch",null),i.__decorate([(0,n.autoSubscribeWithKey)(d.SearchResults)],c.prototype,"getGifsIdsFromSearch",null),i.__decorate([n.autoSubscribe],c.prototype,"getCategoryGif",null),i.__decorate([n.autoSubscribe],c.prototype,"getSearchGif",null),i.__decorate([(0,n.autoSubscribeWithKey)(d.Searching)],c.prototype,"isSearching",null),i.__decorate([n.disableWarnings],c.prototype,"getSearchParams",null),c=i.__decorate([n.AutoSubscribeStore],c);const h=new c;t.default=h},353026:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041),n=s(861253);var r;!function(e){e[e.Query=0]="Query"}(r||(r={}));let a=class extends o.StoreBase{resetSearchQuery(){this._searchConversationQuery=void 0}getSearchQuery(){return this._searchConversationQuery}setSearchQuery(e){(0,n.default)(this._searchConversationQuery,e)||(this._searchConversationQuery=e,this.trigger(r.Query))}};i.__decorate([o.disableWarnings],a.prototype,"resetSearchQuery",null),i.__decorate([(0,o.autoSubscribeWithKey)(r.Query)],a.prototype,"getSearchQuery",null),a=i.__decorate([o.AutoSubscribeStore],a),t.default=new a},46634:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(174958),n=s(496486),r=s(353448),a=s(823113),l=s(217041),d=s(397691),c=s(889391),h=s(898278),u=s(816402),p=s(746096),g=s(436237),m=s(546705),S=s(57175),f=s(178735),y=s(581736),v=s(364956),C=s(422538),_=s(478262),b={enableHighAccuracy:!0,maximumAge:6e5},T={enableHighAccuracy:!1,timeout:5e3,maximumAge:6e5};let M=class extends l.StoreBase{constructor(){super(),this._locationPermissionStatus={},this._bingLocationConsentGranted=!1,C.RegisterStartupable(this,"LocationStore",[f.default,y.default])}startup(){return this._bingLocationConsentGranted=!!f.default.getUserPreferencesLocal().bingLocationConsentGranted,this._highAccuracyTimeout=c.default.getS4LCaapFeatures().highAccuracyLocationTimeout,this._updateLocationPermission(_.PermissionType.Location),this._updateLocationPermission(_.PermissionType.LocationAlways),y.default.subscribe((()=>{this._updateLocationPermission(_.PermissionType.Location)&&this.updateLocation(p.LocationUpdateReason.PermissionUpdate,!0)}),_.PermissionType.Location),y.default.subscribe((()=>{this._updateLocationPermission(_.PermissionType.LocationAlways)&&this.updateLocation(p.LocationUpdateReason.PermissionUpdate,!0)}),_.PermissionType.LocationAlways),f.default.subscribe((()=>{const e=!!f.default.getUserPreferencesLocal().bingLocationConsentGranted;this._bingLocationConsentGranted!==e&&(this._bingLocationConsentGranted=e,this._bingLocationConsentGranted&&this.updateLocation(p.LocationUpdateReason.BingConsentUpdate,!0))})),d.Resolved()}getLocation(){return this._lastPosition&&this._lastPosition.coords?this._lastPosition:void 0}getLocationNoSubscription(){return this._lastPosition&&this._lastPosition.coords?this._lastPosition:void 0}getLocationForBing(){return!this._isChild()&&this._bingLocationConsentGranted?this.getLocation():void 0}needBingLocationConsentPrompt(){return!this._isChild()&&!this._bingLocationConsentGranted&&this.canPromptLocationAgain(_.PermissionType.Location)}bingLocationConsentAndPermissionGranted(){return!this._isChild()&&this._bingLocationConsentGranted&&this.locationPermissionGranted()}locationPermissionGranted(){return this._locationPermissionStatus[_.PermissionType.Location]===a.PermissionStatus.Granted||this._locationPermissionStatus[_.PermissionType.LocationAlways]===a.PermissionStatus.Granted}canPromptLocationAgain(e){if(e===_.PermissionType.Location){const e=f.default.getUserPreferencesLocal().locationStoreLastPromptTime;return!e||u.default.add(e,void 0,3)<Date.now()}{const e=n.max([f.default.getUserPreferencesLocal().locationStoreLastPromptTime,f.default.getUserPreferencesLocal().locationStoreLastPromptTimeAlways]);return!e||u.default.add(e,void 0,3)<Date.now()}}updateLocation(e,t=!1){var s;if(g.log(p.LogTraceArea.GenericUnsafe,"LocationStore.updateLocation requested, reason: "+p.LocationUpdateReason[e]),!this._canUpdateLocationForReason(e))return g.log(p.LogTraceArea.GenericUnsafe,"LocationStore.updateLocation not allowed"),Promise.resolve(void 0);if(this._locationPermissionStatus[_.PermissionType.Location]!==a.PermissionStatus.Granted)return g.log(p.LogTraceArea.GenericUnsafe,`LocationStore.updateLocation locationPermissionStatus: ${this._locationPermissionStatus[_.PermissionType.Location]}, bingLocationConsentGranted: ${this._bingLocationConsentGranted}`),this._lastPosition=void 0,this._isLastPositionHighAccuracy=!1,Promise.resolve(void 0);const i=this._isLastPositionHighAccuracy?b.maximumAge:T.maximumAge;if((null===(s=this._lastPosition)||void 0===s?void 0:s.coords)&&Date.now()<this._lastPosition.timestamp+i&&(!t||this._isLastPositionHighAccuracy))return Promise.resolve(this._lastPosition);if(this._updatingLocation)return Promise.resolve(this._lastPosition);this._updatingLocation=!0;const n=Date.now();return r.default.getCurrentPosition(T).then((e=>(g.log(p.LogTraceArea.GenericUnsafe,"LocationStore: Low accuracy location retrieved: "+o.pii.Omit(JSON.stringify(e))),this._lastPosition=e,this._isLastPositionHighAccuracy=!1,g.track(new m.LocationStoreGeolocationFetched(!1,Date.now()-n)),this.trigger(),t?this._updateHighAccuracyLocation():(this._updatingLocation=!1,e)))).catch((e=>(e.code===e.PERMISSION_DENIED&&(this._lastPosition=void 0,this._isLastPositionHighAccuracy=!1),g.track(new m.LocationStoreGeolocationFetchedFailed(!1,Date.now()-n,e.code===e.TIMEOUT,e.code===e.PERMISSION_DENIED,e.code===e.POSITION_UNAVAILABLE)),e.code===e.PERMISSION_DENIED?(g.warn(p.LogTraceArea.GenericUnsafe,`LocationStore: Permission to retrieve low accuracy location denied: ${e.code} - ${e.message}`),this._updatingLocation=!1,this._locationPermissionStatus[_.PermissionType.Location]=a.PermissionStatus.Denied,void this.trigger()):t?this._updateHighAccuracyLocation():(g.warn(p.LogTraceArea.GenericUnsafe,`LocationStore: Unable to retrieve low accuracy location: ${e.code} - ${e.message}`),this._updatingLocation=!1,void this.trigger()))))}_updateHighAccuracyLocation(){const e=Date.now();return r.default.getCurrentPosition(Object.assign(Object.assign({},b),{timeout:this._highAccuracyTimeout})).then((t=>(this._lastPosition=t,this._isLastPositionHighAccuracy=!0,this._updatingLocation=!1,g.log(p.LogTraceArea.GenericUnsafe,"LocationStore: High accuracy location retrieved: "+o.pii.Omit(JSON.stringify(t))),g.track(new m.LocationStoreGeolocationFetched(!0,Date.now()-e)),this.trigger(),t)),(t=>(this._updatingLocation=!1,g.track(new m.LocationStoreGeolocationFetchedFailed(!0,Date.now()-e,t.code===t.TIMEOUT,t.code===t.PERMISSION_DENIED,t.code===t.POSITION_UNAVAILABLE)),g.warn(p.LogTraceArea.GenericUnsafe,`LocationStore: Unable to retrieve high accuracy location: ${t.code} - ${t.message}`),this.trigger(),this._lastPosition)))}updateLocationWithPermission(e,t=!1,s=!0,i=_.PermissionType.Location){return this.getLocationPermission(s,i).then((()=>this.updateLocation(e,t)))}getLocationPermission(e,t){if(this._locationPermissionStatus[_.PermissionType.LocationAlways]===a.PermissionStatus.Granted)return Promise.resolve();if(t===_.PermissionType.Location&&this._locationPermissionStatus[_.PermissionType.Location]===a.PermissionStatus.Granted)return Promise.resolve();let s=e?_.PermissionPromptOptions.SkipPrePrompt:void 0;this.canPromptLocationAgain(t)&&(s=s?s|_.PermissionPromptOptions.PromptAgainIfDenied:_.PermissionPromptOptions.PromptAgainIfDenied);const i=y.default.permissionStatus(t);return y.default.requestPermission(t,s).then((e=>e===a.PermissionStatus.Granted?d.Resolved():(t===_.PermissionType.Location&&(this._lastPosition=void 0,this._isLastPositionHighAccuracy=!1),this.canPromptLocationAgain(t)&&(t===_.PermissionType.Location?f.default.setUserPreferencesLocal({locationStoreLastPromptTime:Date.now()}):f.default.setUserPreferencesLocal({locationStoreLastPromptTimeAlways:Date.now()}),i===e&&v.default.showDeniedPromptWithSettingsOption(t,h.MainRootViewId)),d.Rejected()))).catch((e=>(g.log(p.LogTraceArea.GenericUnsafe,"LocationStore.getLocationPermission: error, permissionStatus = "+e),this._lastPosition=void 0,this._isLastPositionHighAccuracy=!1,d.Rejected()))).toEs6Promise()}_updateLocationPermission(e){let t=!1;const s=y.default.permissionStatus(e);return s===a.PermissionStatus.Granted&&this._locationPermissionStatus[e]!==a.PermissionStatus.Granted&&(f.default.setUserPreferencesLocal({locationStoreLastPromptTime:0,locationStoreLastPromptTimeAlways:0}),t=!0),this._locationPermissionStatus[e]=s,t}_isChild(){var e;const t=null===(e=f.default.getUserPreferencesLocal().msaProfileKey)||void 0===e?void 0:e.ageGroup;return S.MsaProfileHelper.isChild(t)}_canUpdateLocationForReason(e){switch(e){case p.LocationUpdateReason.PermissionUpdate:case p.LocationUpdateReason.SlashCommand:case p.LocationUpdateReason.E911Startup:case p.LocationUpdateReason.E911NetworkChange:case p.LocationUpdateReason.E911ConsentUpdate:return!0;default:return!this._isChild()}}};i.__decorate([l.autoSubscribe],M.prototype,"getLocation",null),i.__decorate([l.disableWarnings],M.prototype,"getLocationNoSubscription",null),i.__decorate([l.autoSubscribe],M.prototype,"getLocationForBing",null),i.__decorate([l.autoSubscribe],M.prototype,"needBingLocationConsentPrompt",null),i.__decorate([l.autoSubscribe],M.prototype,"bingLocationConsentAndPermissionGranted",null),i.__decorate([l.autoSubscribe],M.prototype,"locationPermissionGranted",null),M=i.__decorate([l.AutoSubscribeStore],M),t.default=new M},518606:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041),r=s(671830),a=s(746096),l=s(436237);let d=class extends n.StoreBase{constructor(){super(...arguments),this._albums={},this._albumMessages={},this._selectedMessageForAlbum={},this._albumMessagesDownloadInProgress={}}getAllMediaMessagesForAlbum(e){const t=o.some(this._albumMessages[e],(e=>e.isUnsent()));return o.sortBy(this._albumMessages[e],(e=>t?e.composeTime:e.createdTime))}getNotFailedMediaMessagesForAlbum(e){return this.getNotFailedMediaMessagesNoSubscription(e)}getAlbumMessage(e){return this._albums[e]}albumContainsMessage(e,t){return this._albumContainsMessage(e,t)}isDownloadingAlbum(e){return!!e&&this._albumMessagesDownloadInProgress[e]&&0!==this._albumMessagesDownloadInProgress[e].length}startAlbumDownload(e){this._albumMessagesDownloadInProgress[e]=o.map(this._albumMessages[e],(e=>e.cuid)),l.log(a.LogTraceArea.DownloadService,"MediaAlbum - starting download for album:"+e)}markAlbumMessageDownloadCompleted(e,t){this._albumMessagesDownloadInProgress[e]&&(o.remove(this._albumMessagesDownloadInProgress[e],(e=>e===t)),l.log(a.LogTraceArea.DownloadService,"MediaAlbum item downloading finished albumId:"+e+" cuid:"+t),0===this._albumMessagesDownloadInProgress[e].length&&(delete this._albumMessagesDownloadInProgress[e],l.log(a.LogTraceArea.DownloadService,"MediaAlbum downloading finished albumId:"+e)))}updateMessages(e){const t=[];o.each(e,(e=>{const s=e.conversationId===r.BookmarksThreadId&&e.isDeletedMessage()?e.getAlbumIdFromPreviousMessage():e.getAlbumId();if(s)if(e.isAlbum())e.isDeletedMessage()?delete this._albums[s]:this._albums[s]=e;else if(this._albumMessages[s]){const i=this._albumMessages[s][e.cuid];i&&e.isDeletedMessage()?(delete this._albumMessages[s][e.cuid],t.push(s)):e.isDeletedMessage()||i&&(!i.isUnsent()||e.isUnsent())||(this._albumMessages[s][e.cuid]=e,t.push(s))}else e.isDeletedMessage()||(this._albumMessages[s]={},this._albumMessages[s][e.cuid]=e,t.push(s))})),o.isEmpty(t)||this.trigger(o.uniq(t))}cleanupConversation(e){const t=o.sortBy(o.filter(this._albums,(t=>t.conversationId===e)),(e=>e.createdTime));t.pop(),o.each(t,(e=>{const t=e.getAlbumId();delete this._albums[t],delete this._albumMessages[t],delete this._selectedMessageForAlbum[t]})),o.isEmpty(t)||this.trigger(o.map(t,(e=>e.getAlbumId())))}getAlbumMessageByConversation(e,t){const s=o.map(o.filter(this._albums,(t=>t.conversationId===e)),(e=>e.getAlbumId()));let i;return o.each(s,(e=>(i=o.find(this._albumMessages[e],(e=>e.cuid===t)),!i))),i}setSelectedMediaForAlbum(e){const t=e.getAlbumId();this._selectedMessageForAlbum[t]=e}getSelectedMediaForAlbum(e){return this._selectedMessageForAlbum[e]}removeSelectedMediaForAlbum(e){this._selectedMessageForAlbum[e]&&delete this._selectedMessageForAlbum[e]}getNotFailedMediaMessagesNoSubscription(e){const t=o.filter(this._albumMessages[e],(e=>!e.isSendRejected())),s=o.some(t,(e=>e.isUnsent()));return o.sortBy(t,(e=>s?e.composeTime:e.createdTime))}test_reset_store(){this._albums={},this._albumMessages={},this._selectedMessageForAlbum={}}_albumContainsMessage(e,t){return 1===o.filter(this.getNotFailedMediaMessagesNoSubscription(e),(e=>e.cuid===t)).length}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],d.prototype,"getAllMediaMessagesForAlbum",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],d.prototype,"getNotFailedMediaMessagesForAlbum",null),i.__decorate([n.disableWarnings],d.prototype,"albumContainsMessage",null),i.__decorate([n.autoSubscribe],d.prototype,"cleanupConversation",null),d=i.__decorate([n.AutoSubscribeStore],d),t.default=new d},265822:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041);let n=class extends o.StoreBase{constructor(){super(...arguments),this._playerNextToken=1,this._activePlayerToken=-1}getActivePlayerToken(){return this._activePlayerToken}registerAsPlayer(){return++this._playerNextToken}setAsActive(e){this._activePlayerToken=e,this.trigger()}stopActivePlayer(){this._activePlayerToken=-1,this.trigger()}};i.__decorate([o.autoSubscribe],n.prototype,"getActivePlayerToken",null),n=i.__decorate([o.AutoSubscribeStore],n),t.default=new n},603088:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041),r=s(974634),a=s(397691),l=s(889391),d=s(539549),c=s(746096),h=(s(657347),s(436237)),u=s(733754),p=s(892350),g=s(526594),m=(s(914976),s(886045)),S=s(422538),f=s(404057),y=s(853374);let v=class extends n.StoreBase{constructor(){super(),this.previewLimitExceeded=new r.default,this._previewInfos={},S.RegisterStartupable(this,"MediaPreviewStore")}startup(){return a.Resolved()}getPreviews(e){const t=this._previewInfos[e];return t&&t.previews||[]}getDraftPreviews(e){const t=this._previewInfos[e];return t&&t.wasSavedAsDraft&&t.previews||[]}getDraftPreviewTimestamp(e){const t=this._previewInfos[e];return t&&t.wasSavedAsDraft&&!o.isEmpty(t.previews)?t.lastAddTimestamp:void 0}getConversationsWithMediaDraft(){const e=o.map(this._previewInfos,((e,t)=>{if(e.wasSavedAsDraft&&!o.isEmpty(e.previews)){const e=(0,d.default)().getConversation(t);if(e)return e}}));return o.compact(e)}addPreviews(e,t){const s=this._getOrCreatePreviewInfo(t),i=o.filter(e,(e=>void 0===o.find(s.previews,(t=>e.data.file.name===t.data.file.name&&e.data.file.size===t.data.file.size&&e.data.file.type===t.data.file.type))));if(!o.isEmpty(i)){const e=l.default.getS4LMessagingFeaturesNoSubscription().limitForFilePicker;if(s.previews.length+i.length>e)return void this.previewLimitExceeded.fire();s.previews=s.previews.concat(i),s.lastAddTimestamp=Date.now(),this.trigger(t),this._saveMediaPreviewsToDb(t)}}removePreview(e,t){if(!t)return;const s=this._getOrCreatePreviewInfo(e),i=o.find(s.previews,(e=>e.uid===t));i&&(s.previews=s.previews.filter((e=>e.uid!==t)),s.deletedPreviewsCount++,s.wasSavedAsDraft&&o.isEmpty(s.previews)&&(h.track(new g.MediaPreviewDraftDeletedEvent(this._getTelemetryProps(e))),s.wasSavedAsDraft=!1),m.default.maybeAnnounceForAccessibility(u.getString("MediaPreview.RemoveItem",{fileName:i.data.file.name})),this.trigger(e),this._saveMediaPreviewsToDb(e))}getAlbumId(e){const t=this._previewInfos[e];return t&&t.albumId}increaseOpenGalleryCount(e){this._getOrCreatePreviewInfo(e).galleryOpenCount++,this._saveMediaPreviewsToDb(e)}markSavedAsDraft(e){const t=this._previewInfos[e];return!t||o.isEmpty(t.previews)||t.wasSavedAsDraft?a.Resolved():(t.wasSavedAsDraft=!0,h.track(new g.MediaPreviewDraftCreatedEvent(this._getTelemetryProps(e))),this.trigger(e),this._saveMediaPreviewsToDb(e))}destroy(e,t=!1){t&&this._storeHasChanged(e)&&h.track(new g.MediaPreviewDraftDeletedEvent(this._getTelemetryProps(e))),this._resetStore(e)}markPreviewsSent(e,t){h.log(c.LogTraceArea.GenericUnsafe,"sendPreviews causeId: "+t),h.track(new g.MediaPreviewSentEvent(this._getTelemetryProps(e))),m.default.maybeAnnounceForAccessibility(u.getString("MessageComposer.FileSentLabel")),this._resetStore(e)}_getOrCreatePreviewInfo(e){let t=this._previewInfos[e];return t||(t={conversationId:e,previews:[],albumId:y.default.newGuid(),deletedPreviewsCount:0,galleryOpenCount:0,wasSavedAsDraft:!1,wasRecoveredFromDb:!1,lastAddTimestamp:void 0},this._previewInfos[e]=t),t}_storeHasChanged(e){const t=this._previewInfos[e];return t&&(!o.isEmpty(t.previews)||0!==t.deletedPreviewsCount)}_resetStore(e){const t=this._previewInfos[e];t&&(t.previews=[],this._saveMediaPreviewsToDb(e),delete this._previewInfos[e],this.trigger(e))}_getTelemetryProps(e){const t=this._getOrCreatePreviewInfo(e);return{previews:t.previews,deletedPreviewsCount:t.deletedPreviewsCount,galleryOpenCount:t.galleryOpenCount,wasSavedAsDraft:t.wasSavedAsDraft,wasRecoveredFromDb:t.wasRecoveredFromDb,lastAddTimestamp:t.lastAddTimestamp}}_loadAllMediaPreviewsFromDb(){return p.default.loadSavedMedia().then((e=>{h.log(c.LogTraceArea.GenericUnsafe,"Persisted media previews loaded for "+e.length+" conversations"),o.each(e,(e=>{const t=e.conversationId;this._previewInfos[t]||(this._previewInfos[t]=e)}))})).catch((e=>{h.warn(c.LogTraceArea.GenericUnsafe,"Error loading persisted media previews: "+f.default.errorAsString(e))}))}_saveMediaPreviewsToDb(e){return a.Resolved()}test_getDeletedPreviewsCount(e){return this._getOrCreatePreviewInfo(e).deletedPreviewsCount}test_getGalleryOpenCount(e){return this._getOrCreatePreviewInfo(e).galleryOpenCount}test_getWasSavedAsDraft(e){return this._getOrCreatePreviewInfo(e).wasSavedAsDraft}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],v.prototype,"getPreviews",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],v.prototype,"getDraftPreviews",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],v.prototype,"getDraftPreviewTimestamp",null),i.__decorate([n.autoSubscribe],v.prototype,"getConversationsWithMediaDraft",null),v=i.__decorate([n.AutoSubscribeStore],v),t.default=new v},519089:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessagePanelPiPContentStore=void 0;const i=s(570655),o=s(217041),n=s(889391),r=s(861253),a=s(886045),l=s(360305);let d=class extends o.StoreBase{getContentProps(){return this._pipViewContentProps}isPiPEnabled(){return n.default.getS4LMessagingFeaturesNoSubscription().openYouTubeLinksInPip&&!l.default.isTablet()&&!a.default.isMobileScreenReaderEnabled()}setContentProps(e){(0,r.default)(this._pipViewContentProps,e)||(this._pipViewContentProps=e,this.trigger())}};i.__decorate([o.autoSubscribe],d.prototype,"getContentProps",null),d=i.__decorate([o.AutoSubscribeStore],d),t.MessagePanelPiPContentStore=d,t.default=new d},422929:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(882261),n=s(746096),r=s(574163),a=s(404057),l=s(640363),d="skype/messages";t.default=new class{constructor(){this._selection=[],this._plainSelection=""}add(e,t,s,i){i?(this._newCopyChainStarted(i)&&this._cleanStore(),this._storeToStore(e,t,s),this._storeToClipboard(i)):this._storeToStore(e,t,s)}get(e){if(e){const t=this._getFromClipboard(e);return i.isEmpty(t)?this._getFromStore():t}return this._getFromStore()}hasContent(e){if(e.clipboardData){const t=e.clipboardData.getData("text/plain")||"";return(e.clipboardData.getData(d)||"").length>0&&t.length>0&&this._plainSelection===t}return!1}_newCopyChainStarted(e){return e.clipboardData&&!i.includes(e.clipboardData.types,d)}_getFromStore(){return this._selection}_cleanStore(){this._selection=[],this._plainSelection=""}_storeToStore(e,t,s){this._selection=i.sortBy([...this._selection,t],(e=>e.createdTime)),this._plainSelection=this._mapToPlainText(s)}_getFromClipboard(e){return e.clipboardData?this._mapToSelectionMeta(e.clipboardData.getData(d)):[]}_storeToClipboard(e){e.clipboardData&&(e.clipboardData.setData("text/plain",this._plainSelection),e.clipboardData.setData(d,this._mapToClipboardData(this._selection)))}_mapToClipboardData(e){return JSON.stringify(e.map((e=>(0,r.toClipboardObject)(e))))}_mapToSelectionMeta(e){return a.default.parseJsonWithDefault(e,[]).map((e=>{const t=o.createMessageInfoFromEscapedText(e.conversationId,n.PostSource.Clipboard,e.content).messageForPosting;return e.content=t.content,(0,r.fromClipboardObject)(e)}))}_mapToPlainText(e){return l.default.getPlatformType()===n.PlatformType.Windows?e.replace(/\r\n?|\n/g,"\r\n"):e}}},481884:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageStreamStore=void 0;const i=s(496486),o=s(217041),n=s(397691),r=s(889391),a=s(587430),l=s(422801),d=s(476621),c=s(351077),h=s(581697),u=s(671830),p=s(562141),g=s(400984),m=s(539549),S=s(746096),f=s(436237),y=s(9785),v=s(518606),C=s(812056),_=s(475043),b=s(18078),T=s(914976),M=s(677914),I=s(112692),w=s(404057),P=s(478262),k=s(110996),A=s(269399),x=Number.MAX_VALUE;var R;!function(e){e[e.None=0]="None",e[e.Database=1]="Database",e[e.ChatService=2]="ChatService",e[e.WaitForSync=3]="WaitForSync",e[e.WaitForInit=4]="WaitForInit"}(R||(R={}));class O{constructor(e,t,s){this.messages={},this.messagesOutOfSyncWindow={},this.isEarliestTimeTheTopOfSyncWindow=!1,this.cannotSyncButNotAtBeginning=!1,this.isOutsideSyncWindow=!1,this.persistedMessagesFromQueries={},this.isLoadingEarlier=R.None,this.isLoadingLater=R.None,this.fetchedMessages=0,this.syncedBackwards=!1,this.conversationId=e,this.earliestMessageTime=t,this.latestMessageTime=s}_updateWindow(e,t=!1){let s=!1;const o=this.earliestMessageTime,n=this.latestMessageTime;if(!t){if(2!==this.earliestMessageTime){const t=i.map(e,(e=>{const t=e.getLatestServerMessageVersion();return t&&+t||e.createdTime})),o=i.min(t);o<this.earliestMessageTime&&(this.earliestMessageTime=Math.max(o,2),s=!0)}if(this.latestMessageTime!==x){const t=i.maxBy(e,(e=>e.createdTime)).createdTime;t>this.latestMessageTime&&(this.latestMessageTime=t>P.NumberShim.MAX_SAFE_INTEGER?x:t,s=!0)}}return{windowChanged:s,oldEarliestMessageTime:o,oldLatestMessageTime:n}}updateWindowAndMessages(e,t,s){if(0===e.length)return{windowChanged:!1,messagesChanged:!1};const{windowChanged:i,oldEarliestMessageTime:o,oldLatestMessageTime:n}=this._updateWindow(e,t),{messagesChanged:r,visibleMessages:a,visibleMessagesInWindow:l,otherMessages:d}=this._updateMessageCache(e);if(e.length){let e="["+s+"] Message cache update:";if(r||!i){const t=a.length-l.length;e+=" "+l.length+" applied, "+t+" dropped, "+d.length+" other. "}if(i){e+=" "+this._getTraceWindowUpdateString(o,n)}D(this.conversationId,e)}return{windowChanged:i,messagesChanged:r}}updateWindowFromEmptyEarlierDBQuery(e){return e<this.earliestMessageTime&&(this.earliestMessageTime=Math.max(e,2),!0)}updateWindowToBeginningOfTime(){if(2===this.earliestMessageTime)return!1;const e=this.earliestMessageTime;return this.earliestMessageTime=2,D(this.conversationId,this._getTraceWindowUpdateString(e,this.latestMessageTime)),!0}updateWindowToEndOfTime(){if(this.latestMessageTime===x)return!1;const e=this.latestMessageTime;return this.latestMessageTime=x,D(this.conversationId,this._getTraceWindowUpdateString(this.earliestMessageTime,e)),!0}updateWindowHandleHistoryDisclosed(){if(!this.isEarliestTimeTheTopOfSyncWindow){const e=this.earliestMessageTime,t=i.values(this.messages);return t.length>0&&(this.earliestMessageTime=i.minBy(t,(e=>e.createdTime)).createdTime),e!==this.earliestMessageTime}const e=this.earliestMessageTime,t=h.default.getEarliestKnownMessageTime(this.conversationId);return this.earliestMessageTime=Math.max(t,e),e!==this.earliestMessageTime}_getTraceTimeString(e){return 2===e?"Beginning":e===x?"End":e.toString()}_getTraceWindowUpdateString(e,t){return"Window updated from ["+this._getTraceTimeString(e)+", "+this._getTraceTimeString(t)+"] to ["+this._getTraceTimeString(this.earliestMessageTime)+", "+this._getTraceTimeString(this.latestMessageTime)+"]"}_updateMessageCache(e){let t=!1;const s=e,[o,n]=i.partition(s,(e=>e.isShownInStream())),[r,a]=i.partition(o,(e=>this.isTimeInWindow(e.createdTime)||this.latestMessageTime===x&&e.isMessageLie()));if(a.length&&i.extend(this.messagesOutOfSyncWindow,i.keyBy(a,(e=>e.cuid))),r.length){this.sortedMessages=void 0;const e=i.keyBy(r,(e=>e.cuid));i.extend(this.messages,e),t=!0}return i.each(n,(e=>{this.isTimeInWindow(e.createdTime)&&(e.isDeletedMessage()||e.isCanceledScheduledCall())&&this.messages[e.cuid]&&(delete this.messages[e.cuid],this.sortedMessages=void 0,t=!0)})),v.default.updateMessages(e),_.default.updateMessages(e),{messagesChanged:t,visibleMessages:o,visibleMessagesInWindow:r,otherMessages:n}}setAsNoLongerOutsideSyncWindow(){this.isOutsideSyncWindow=!1,this.localSyncState=void 0,D(this.conversationId,"No longer outside Sync window")}isTimeInWindow(e){return e>=this.earliestMessageTime&&e<=this.latestMessageTime}getLatestKnownMessage(){return i.last(this.sortedMessages)||i.maxBy(i.toArray(this.messages),(e=>e.createdTime))}checkForOutSideSyncWindowMessages(){i.each(this.messagesOutOfSyncWindow,(e=>{this.isTimeInWindow(e.createdTime)&&(this.messages[e.cuid]=this.messagesOutOfSyncWindow[e.cuid],delete this.messagesOutOfSyncWindow[e.cuid],this.sortedMessages=void 0)}))}}const L=55;class F extends o.StoreBase{constructor(e,t){super(0,!0),this._targetMessageTimestamp=t,this._isInitialized=!1,this._isInitialMessagesLoaded=!1,this._isRealConversationKnown=!1,this._syncCompleteCallback=()=>{if(this._conversationInfo){if(this._conversationInfo.isOutsideSyncWindow){h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId)<=this._conversationInfo.earliestMessageTime&&this._conversationInfo.setAsNoLongerOutsideSyncWindow()}if(this._waitForSyncCompleteDeferred){const e=this._waitForSyncCompleteDeferred;this._waitForSyncCompleteDeferred=void 0,e.resolve(void 0)}}else V(this._debug_convId,"Store was destroyed but got a callback for sync completed")},this._conversationUpdatedCallback=e=>{if(!this._isInitialized)return;if(!this._conversationInfo)return void V(this._debug_convId,"Store was destroyed but got a callback for conv updated");const t=i.find(e,(e=>e.conv.id===this._conversationInfo.conversationId));if(t){const e=this._conversationInfo.isHistoryDisclosed;this._conversationInfo.isHistoryDisclosed=t.conv.isHistoryDisclosed(),!e&&this._conversationInfo.isHistoryDisclosed&&(D(this._debug_convId,"History disclosed"),this._conversationInfo.updateWindowHandleHistoryDisclosed()&&(this._conversationInfo.checkForOutSideSyncWindowMessages(),this.fetchEarlierMessages()))}if(!this._conversationInfo.isOutsideSyncWindow){const e=h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId),t=this._conversationInfo.getLatestKnownMessage();t&&t.createdTime<e&&(D(this._debug_convId,"Invalidating store for future caching because it has a possible gap."),this._probablyShouldNotCache=!0)}},this._messagesUpdatedCallback=(e,t)=>{if(!this._conversationInfo)return void V(this._debug_convId,"Store was destroyed but got a callback for new messages");if(!this._isInitialized)return;const s=i.map(i.filter(e,(e=>e.conversationId===this._conversationInfo.conversationId))),{windowChanged:o,messagesChanged:n}=this._conversationInfo.updateWindowAndMessages(s,!0,"messagesUpdated");this._conversationInfo.checkForOutSideSyncWindowMessages(),(o||n)&&(t?this.trigger(["messageSentSuccessNotification",t]):this.trigger())},this._updateContactInviteMessages=()=>{if(!this._conversationInfo)return void V(this._debug_convId,"Store was destroyed but got a callback for contact invite messages");const e=g.default.getInviteMessagesForConversation(this._conversationInfo.conversationId),t=i.filter(e,(e=>!i.some(this._conversationInfo.messages,(t=>t.createdTime===e.createdTime))));if(t.length>0){const{windowChanged:e,messagesChanged:s}=this._conversationInfo.updateWindowAndMessages(t,!1,"updateContactInvites");this._conversationInfo.checkForOutSideSyncWindowMessages(),(e||s)&&this.trigger()}},this._updateScheduledCallMessages=()=>{if(!this._conversationInfo)return void V(this._debug_convId,"Store was destroyed but got a callback for scheduled call messages");const e=M.default.getSystemMessagesForConversation(this._conversationInfo.conversationId);if(e.length>0){const{windowChanged:t,messagesChanged:s}=this._conversationInfo.updateWindowAndMessages(e,!1,"updateScheduledCalls");this._conversationInfo.checkForOutSideSyncWindowMessages(),(t||s)&&this.trigger()}},this._wrapWithTriggerLogic=e=>{if(!this._conversationInfo)return;const t=this.isLoadingItems(),s=this.isEarliestMessageTheBeginning(),i=this.isLatestMessageTheEnd(),o=e(),n=this.isLoadingItems(),r=this.isEarliestMessageTheBeginning(),a=this.isLatestMessageTheEnd();t===n&&s===r&&i===a||this.trigger();let l=!0;o.then((()=>{l||this._conversationInfo&&(n===this.isLoadingItems()&&r===this.isEarliestMessageTheBeginning()&&a===this.isLatestMessageTheEnd()||this.trigger())})),l=!1},this._debug_convId=e;const s=t||x;let o=Math.max(s,2);o>P.NumberShim.MAX_SAFE_INTEGER&&(o=x),this._conversationInfo=new O(e,o,o);const n=h.default.getEarliestKnownMessageTime(e);D(this._debug_convId,'Initializing at "'+o+'"'+(o<n?' (earlier than Sync at "'+n+'")':"")),this._messagesUpdatedSubscriptionToken=d.default.messagesProcessed.subscribe(this._messagesUpdatedCallback),this._conversationsUpdatedSubscriptionToken=d.default.conversationsUpdated.subscribe(this._conversationUpdatedCallback),this._syncCompleteSubscriptionToken=h.default.syncComplete.subscribe(this._syncCompleteCallback),this._initialize()}subscribe(e,t){const s=super.subscribe(e,t),i=this._waitForSubscribersDeferred;return i&&(this._waitForSubscribersDeferred=void 0,i.resolve(void 0)),s}_initialize(){this._conversationInfo&&this._wrapWithTriggerLogic((()=>this._conversationInfo?(this._conversationInfo.isLoadingEarlier=R.WaitForInit,this._conversationInfo.isLoadingLater=R.WaitForInit,n.Resolved().thenAsync((()=>this._initializeAfterWaitingForRealConversation())).then((()=>{if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");this._conversationInfo.isLoadingEarlier=R.None,this._conversationInfo.isLoadingLater=R.None;const e=d.default.getConversationMetaFromMemoryCache(this._conversationInfo.conversationId);return e&&(this._conversationInfo.isHistoryDisclosed=e.conv.isHistoryDisclosed()),this._isInitialized=!0,this._fetchInitialMessages()})).then((()=>this._conversationInfo?!this._conversationInfo.isOutsideSyncWindow&&this._isRealConversationKnown||!i.isEmpty(this._conversationInfo.messages)||this._conversationInfo.earliestMessageTime!==this._conversationInfo.latestMessageTime?void 0:(this._reinitializeAtEndOfTime(),this._fetchInitialMessages()):n.Rejected("Store was destroyed: nothing to do."))).then((()=>{if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");this._updateContactInviteMessages(),this._contactsStoreSubscriptionToken=g.default.subscribe(this._updateContactInviteMessages),this._updateScheduledCallMessages(),this._scheduledCallsStoreSubscriptionToken=M.default.subscribe(this._updateScheduledCallMessages)})).catch((e=>{this._conversationInfo&&V(this._debug_convId,"Unhandled error while store is alive: "+w.default.errorAsString(e))}))):n.Rejected("Store was destroyed: nothing to do.")))}_initializeAfterWaitingForRealConversation(){if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");const e=this._conversationInfo.conversationId;return d.default.waitForJoinedKnowledgeOfConversation(e).then((t=>{if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");if(!t.isFake)return this._isRealConversationKnown=!0,void D(this._debug_convId,"Conversation is known from the get-go");D(this._debug_convId,"Unknown conversation: waiting to hear about it or Sync finishing");const s=d.default.waitForJoinedKnowledgeOfRealConversation(e);let i;return h.default.isCurrentlySyncing()?(this._waitForSyncCompleteDeferred=n.Defer(),i=this._waitForSyncCompleteDeferred.promise()):i=n.Resolved(),n.race([s,i]).then((()=>{if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");const t=(0,m.default)().getConversation(e);if(t&&!t.isFake)return this._isRealConversationKnown=!0,void D(this._debug_convId,"Conversation became known while waiting: normal init");this._reinitializeAtEndOfTime(),s.then((()=>{this._conversationInfo&&(this._isRealConversationKnown=!0,D(this._debug_convId,"Conversation became known: attempting to fix our window"),this._conversationInfo.isEarliestTimeTheTopOfSyncWindow=!1,this._conversationInfo.earliestMessageTime=x,this.fetchEarlierMessages())}))}))}))}_reinitializeAtEndOfTime(){D(this._debug_convId,"Could not initialize: jumping to EndOfTime."+(this._isRealConversationKnown?"":" (Conversation is unknown.)")),this._conversationInfo&&(this._conversationInfo.isOutsideSyncWindow=!1,this._conversationInfo.isEarliestTimeTheTopOfSyncWindow=!1,this._conversationInfo.earliestMessageTime=x,this._conversationInfo.latestMessageTime=x)}isLoadingItems(){return this._conversationInfo?this._conversationInfo.isLoadingEarlier!==R.None||this._conversationInfo.isLoadingLater!==R.None:(V(this._debug_convId,"Store is already destroyed"),!1)}isLoadingItemsFromNetwork(){return this._conversationInfo?this._conversationInfo.isLoadingEarlier===R.ChatService||this._conversationInfo.isLoadingEarlier===R.WaitForSync||this._conversationInfo.isLoadingLater===R.ChatService||this._conversationInfo.isLoadingLater===R.WaitForSync:(V(this._debug_convId,"Store is already destroyed"),!1)}isInitialMessagesLoaded(){return this._conversationInfo?this._isInitialMessagesLoaded:(V(this._debug_convId,"Store is already destroyed"),!0)}cannotGetEarlierMessages(){return this._conversationInfo?this._conversationInfo.cannotSyncButNotAtBeginning:(V(this._debug_convId,"Store is already destroyed"),!0)}isEarliestMessageTheBeginning(){return this._conversationInfo?2===this._conversationInfo.earliestMessageTime:(V(this._debug_convId,"Store is already destroyed"),!0)}isLatestMessageTheEnd(){return this._conversationInfo?this._conversationInfo.latestMessageTime===x:(V(this._debug_convId,"Store is already destroyed"),!0)}getMessages(){var e;if(!this._conversationInfo)return V(this._debug_convId,"Store is already destroyed"),[];if(!this._conversationInfo.sortedMessages){let e;if(u.isBookmarkConversation(this._conversationInfo.conversationId))e=i.sortBy(this._conversationInfo.messages,(e=>a.getSourceMessageDate(e.properties)));else if(r.default.getS4LMessagingFeatures().enableKeepUnsentMessagesAtEndOfStream){const[t,s]=i.partition(this._conversationInfo.messages,(e=>e.isUnsent()&&!e.isSendRejected()&&!e.isEdited()&&(c.isEncryptedMessageType(e.messagetype)||c.isRichTextMessageType(e.messagetype)||c.isWrittenTextMessageType(e.messagetype)))),o=i.sortBy(s,(e=>e.createdTime)),n=i.sortBy(t,(e=>e.composeTime));e=o.concat(n)}else e=i.sortBy(this._conversationInfo.messages,(e=>e.createdTime));this._conversationInfo.sortedMessages=e}return(0,m.default)().isClearApplicableAndKeepInRecents(this._conversationInfo.conversationId)&&(null===(e=(0,m.default)().getConversation(this._conversationInfo.conversationId))||void 0===e?void 0:e.isDeleted())&&(this._conversationInfo.sortedMessages=[],this._conversationInfo.messages={}),this._conversationInfo.sortedMessages}getConversationId(){if(this._conversationInfo)return this._conversationInfo.conversationId;V(this._debug_convId,"Store is already destroyed")}getTargetMessageTimestamp(){if(this._conversationInfo)return this._targetMessageTimestamp;V(this._debug_convId,"Store is already destroyed")}probablyShouldNotCache(){return this._probablyShouldNotCache}fetchEarlierMessages(){this._wrapWithTriggerLogic((()=>this._fetchEarlierMessagesIfNeeded(L,!0)))}fetchLaterMessages(){this._wrapWithTriggerLogic((()=>this._fetchLaterMessagesIfNeeded(L,!0)))}feedEphemeralMessage(e){if(!this._conversationInfo)return;const t=this._conversationInfo.getLatestKnownMessage(),s=Math.max(t&&t.createdTime||0,Date.now())+1,i=I.default.fromFirstLie(e.messageForPosting,e.conversationId,b.default.getSkypeMri(),s,!0);this._messagesUpdatedCallback([i])}destroy(){this._syncCompleteSubscriptionToken&&this._syncCompleteSubscriptionToken.unsubscribe(),this._messagesUpdatedSubscriptionToken&&this._messagesUpdatedSubscriptionToken.unsubscribe(),this._conversationsUpdatedSubscriptionToken&&this._conversationsUpdatedSubscriptionToken.unsubscribe(),this._contactsStoreSubscriptionToken&&g.default.unsubscribe(this._contactsStoreSubscriptionToken),this._scheduledCallsStoreSubscriptionToken&&M.default.unsubscribe(this._scheduledCallsStoreSubscriptionToken);const e=this.getConversationId();e&&v.default.cleanupConversation(e),this._conversationInfo=void 0;const t=this._waitForSubscribersDeferred;t&&(this._waitForSubscribersDeferred=void 0,t.resolve(void 0))}isDestroyed(){return!this._conversationInfo}_fetchInitialMessages(){if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");const e=this._conversationInfo.conversationId;this._conversationInfo.isOutsideSyncWindow=this._isRealConversationKnown&&this._conversationInfo.latestMessageTime<h.default.getEarliestKnownMessageTime(e);const t=this._conversationInfo.isOutsideSyncWindow?h.default.waitForMessageSyncToFinish(this._conversationInfo.conversationId).catch(i.noop):n.Resolved();return this._conversationInfo.isLoadingEarlier=R.WaitForSync,this._conversationInfo.isLoadingLater=R.WaitForSync,t.then((()=>{if(!this._conversationInfo)return;this._conversationInfo.isLoadingEarlier=R.None,this._conversationInfo.isLoadingLater=R.None,this._conversationInfo.isOutsideSyncWindow=this._isRealConversationKnown&&this._conversationInfo.latestMessageTime<h.default.getEarliestKnownMessageTime(e),D(this._debug_convId,"Fetching initial messages");const t=Date.now(),s=this._fetchEarlierMessagesIfNeeded(Math.floor(27.5),!1),i=this._fetchLaterMessagesIfNeeded(Math.ceil(27.5),!1);return n.all([s,i]).then((()=>{this._isInitialMessagesLoaded=!0,this._conversationInfo&&(this._conversationInfo.fetchedMessages||this._conversationInfo.syncedBackwards)&&f.track(new C.MessagesFetched(e,this._conversationInfo.fetchedMessages,this._conversationInfo.syncedBackwards,Date.now()-t)),this.isDestroyed()||this.trigger()}))}))}_fetchEarlierMessagesIfNeeded(e,t){return this._conversationInfo?this._fetchEarlierMessagesIfNeededInternal(e,t,this._conversationInfo.earliestMessageTime):n.Rejected("Store was destroyed: nothing to do.")}_fetchEarlierMessagesIfNeededInternal(e,t,s){if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");const o=this._conversationInfo.conversationId;if(this._conversationInfo.isLoadingEarlier||2===this._conversationInfo.earliestMessageTime||this._conversationInfo.cannotSyncButNotAtBeginning||!this._isInitialized)return E(this._debug_convId,"_fetchEarlierMessages no need"),n.Resolved();if(this._conversationInfo.isOutsideSyncWindow){const n=this._conversationInfo.earliestMessageTime;return E(this._debug_convId,"_fetchEarlierMessages request more messages from ChatService, Max messages: "+e+", Earlier than: "+n+", SyncState: "+u.encodeSyncStateForLog(this._conversationInfo.localSyncState)),this._conversationInfo.isLoadingEarlier=R.ChatService,i.isUndefined(this._targetMessageTimestamp)||(0,k.markMessageSearchAdditionalMessageLoading)(o,this._targetMessageTimestamp,A.AdditionalLoading.ChatService),l.default.serviceGetConversationMessagesEarlierThanTime(o,2,this._conversationInfo.localSyncState,e,n).then((i=>{if(this._conversationInfo)return this._handleChatServiceResponse(i).then((o=>{if(this._conversationInfo){this._conversationInfo.isLoadingEarlier=R.None;const{windowChanged:n,messagesChanged:r}=this._conversationInfo.updateWindowAndMessages(o,!1,"fetchEarlierCS");if(this._conversationInfo.checkForOutSideSyncWindowMessages(),i.messages.length<e)this._conversationInfo.updateWindowToBeginningOfTime(),this._conversationInfo.checkForOutSideSyncWindowMessages();else if(n&&!r)return E(this._debug_convId,"_fetchEarlierMessages no visible messages within the updated window: try again"),this._fetchEarlierMessagesIfNeededInternal(e,t,s)}}))}),(e=>{this._conversationInfo&&(this._conversationInfo.isLoadingEarlier=R.None),V(this._debug_convId,'Failed to load earlier messages from the Chat Service (end time "'+n+'")',w.default.errorAsString(e))}))}if(this._conversationInfo.isEarliestTimeTheTopOfSyncWindow){E(this._debug_convId,"_fetchEarlierMessages use Sync to fetch");const n=i.clone(this._conversationInfo.messages),r=i.clone(this._conversationInfo.messagesOutOfSyncWindow),a=this._conversationInfo.earliestMessageTime;let l=!1;return this._conversationInfo.isLoadingEarlier=R.WaitForSync,this._syncBackwardsAndWait(o).then((()=>{if(this._conversationInfo){const t=h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId);return E(this._debug_convId,"_fetchEarlierMessages fetching from db between "+t+" and "+s+", max messages: "+e),this._getMessagesInRange(o,t,s,e).then((e=>{if(this._conversationInfo){const s=this._conversationInfo.updateWindowAndMessages(e,!1,"fetchEarlierSyncThenDB");l=s.messagesChanged,0===e.length&&this._conversationInfo.updateWindowFromEmptyEarlierDBQuery(t),this._conversationInfo.checkForOutSideSyncWindowMessages()}}))}})).then((()=>{if(this._conversationInfo){this._conversationInfo.isLoadingEarlier=R.None;const i=d.default.getConversationMetaFromMemoryCache(o);if(i)if(i.conv.isBricked)E(this._debug_convId,"_fetchEarlierMessages conversation bricked"),this._conversationInfo.cannotSyncButNotAtBeginning=!0;else{h.default.haveAllMessagesForConversation(o)&&(E(this._debug_convId,"_fetchEarlierMessages sync has everything"),this._conversationInfo.isEarliestTimeTheTopOfSyncWindow=!1);const i=!this._haveMessagesChanged(n,this._conversationInfo.messages);if(E(this._debug_convId,"_fetchEarlierMessages finished sync"+(i?" without changes - refetching":" and got message updates")),i){const i=this._haveMessagesChanged(r,this._conversationInfo.messagesOutOfSyncWindow);this._conversationInfo.earliestMessageTime!==a||!this._conversationInfo.isEarliestTimeTheTopOfSyncWindow||i||l?this._fetchEarlierMessagesIfNeededInternal(e,t,s):E(this._debug_convId,"_fetchEarlierMessages sync gave us nothing")}}else E(this._debug_convId,"_fetchEarlierMessages conversation not known")}}))}{const n=h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId);return E(this._debug_convId,"_fetchEarlierMessages Fetch from the DB between "+n+" and "+s+", max messages: "+e),this._conversationInfo.isLoadingEarlier=R.Database,i.isUndefined(this._targetMessageTimestamp)||(0,k.markMessageSearchAdditionalMessageLoading)(o,this._targetMessageTimestamp,A.AdditionalLoading.IndexedDB),this._getMessagesInRange(o,n,s,e).then((i=>{if(this._conversationInfo){this._conversationInfo.isLoadingEarlier=R.None;const{windowChanged:n,messagesChanged:r}=this._conversationInfo.updateWindowAndMessages(i,!1,"fetchEarlierDB");if(i.length<e){if(!this._isRealConversationKnown)return void this._conversationInfo.updateWindowToBeginningOfTime();h.default.haveAllMessagesForConversation(o)?(this._conversationInfo.updateWindowToBeginningOfTime(),this._conversationInfo.checkForOutSideSyncWindowMessages()):this._conversationInfo.isEarliestTimeTheTopOfSyncWindow=!0}const a=n||2===s;if(0===i.length||a&&!r&&e<550)return i.length===e&&(e+=Math.floor(27.5)),E(this._debug_convId,"_fetchEarlierMessages no visible messages within the updated window: try again, new maxMessages: "+e),this._fetchEarlierMessagesIfNeededInternal(e,t,s)}}))}}_haveMessagesChanged(e,t){return!(0,y.default)(e,t,((e,t,s)=>s?e===t:void 0))}_fetchLaterMessagesIfNeeded(e,t){if(!this._conversationInfo)return n.Rejected("Store was destroyed: nothing to do.");const s=this._conversationInfo.conversationId;if(this._conversationInfo.isLoadingLater||this._conversationInfo.latestMessageTime===x||!this._isInitialized)return E(this._debug_convId,"_fetchLaterMessages no need"),n.Resolved();if(this._conversationInfo.isOutsideSyncWindow){const o=this._conversationInfo.latestMessageTime,n=h.default.getEarliestKnownMessageTime(s);return E(this._debug_convId,"_fetchLaterMessages request more messages from ChatService, Max messages: "+e+", Start time: "+o+", Later than: "+n+", SyncState: "+u.encodeSyncStateForLog(this._conversationInfo.localSyncState)),this._conversationInfo.isLoadingLater=R.ChatService,i.isUndefined(this._targetMessageTimestamp)||(0,k.markMessageSearchAdditionalMessageLoading)(s,this._targetMessageTimestamp,A.AdditionalLoading.ChatService),l.default.serviceGetConversationMessagesLaterThanTime(s,o,n,this._conversationInfo.localSyncState,e,!1).then((s=>{if(this._conversationInfo)return this._handleChatServiceResponse(s,e).then((i=>{if(this._conversationInfo){this._conversationInfo.isLoadingLater=R.None;const{windowChanged:o,messagesChanged:n}=this._conversationInfo.updateWindowAndMessages(i,!1,"fetchLaterCS");if(this._conversationInfo.checkForOutSideSyncWindowMessages(),s.messages.length,0===i.length||o&&!n)return E(this._debug_convId,"_fetchLaterMessages mo visible messages within the updated window: try again"),this._fetchLaterMessagesIfNeeded(e,t)}}))}),(e=>{this._conversationInfo&&(this._conversationInfo.isLoadingLater=R.None),V(this._debug_convId,'Failed to load later messages from the Chat Service (start time "'+o+'")',w.default.errorAsString(e))}))}return E(this._debug_convId,"_fetchLaterMessages Fetch from the DB after "+this._conversationInfo.latestMessageTime),this._conversationInfo.isLoadingLater=R.Database,i.isUndefined(this._targetMessageTimestamp)||(0,k.markMessageSearchAdditionalMessageLoading)(s,this._targetMessageTimestamp,A.AdditionalLoading.IndexedDB),p.default.getMessagesForConversationAfterTime(s,this._conversationInfo.latestMessageTime,e,t).then((s=>{if(this._conversationInfo){this._conversationInfo.isLoadingLater=R.None;const{windowChanged:i,messagesChanged:o}=this._conversationInfo.updateWindowAndMessages(s,!1,"fetchLaterDB");if(this._conversationInfo.checkForOutSideSyncWindowMessages(),s.length<e)this._conversationInfo.updateWindowToEndOfTime(),this._conversationInfo.checkForOutSideSyncWindowMessages();else if(i&&!o)return E(this._debug_convId,"_fetchLaterMessages no visible messages within the updated window: try again"),this._fetchLaterMessagesIfNeeded(e,t)}}))}_getMessagesInRange(e,t,s,i){return t>s?n.Resolved([]):p.default.getMessagesForConversationAndTimeRange(e,t,s,!0,i)}_handleChatServiceResponse(e,t=0){if(!this._conversationInfo)return n.Resolved([]);if(this._conversationInfo.fetchedMessages+=e.messages.length,this._conversationInfo.isOutsideSyncWindow){let s=!1;if(e.messages.length<t)s=!0;else if(e.messages.length){s=Number(i.maxBy(e.messages,(e=>e.id)).id)>=h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId)}s?this._conversationInfo.setAsNoLongerOutsideSyncWindow():this._conversationInfo.localSyncState=u.decodeSyncState(e._metadata.syncState)}let s;const o=this._conversationInfo.conversationId;if(u.isEncryptedThread(o)){const t=i.map(e.messages,(e=>({message:e,origin:S.MessageOrigin.ChatSync,isOtherEndpointActive:!1,messageStoreUsed:!1})));s=d.default.queueMessagesForConversationAndWait(o,t).then((()=>p.default.openTransaction([p.Stores.Messages],!1).then((t=>{const s=i.map(e.messages,(e=>u.getCuidForMessage(e))),n=t.getMessagesByCuid(o,s);return t.markCompleted(),n}))))}else{const t=i.compact(i.map(e.messages,(e=>{const t=u.getCuidForMessage(e);return this._conversationInfo.persistedMessagesFromQueries[t]?this._conversationInfo.persistedMessagesFromQueries[t].applyServerMessage(e):I.default.fromFirstServerMessage(e)})));i.extend(this._conversationInfo.persistedMessagesFromQueries,i.keyBy(t,(e=>e.cuid))),s=n.Resolved(t)}return s}_syncBackwardsAndWait(e){return h.default.syncBackwards(e).then((t=>{if(this._conversationInfo){const s=t?h.default.waitForMessageSyncToFinish(this._conversationInfo.conversationId):n.Resolved();return!this._conversationInfo.syncedBackwards&&t&&(this._conversationInfo.syncedBackwards=!0),s.then(i.noop,(t=>{if(!this._conversationInfo)return;let s;return 0===this._getSubscriptionKeys().length?(D(this._debug_convId,"Failed to wait for message sync to finish, postponing retries due to no subscribers"),this._waitForSubscribersDeferred||(this._waitForSubscribersDeferred=n.Defer()),s=this._waitForSubscribersDeferred.promise()):s=n.Resolved(),s.thenAsync((()=>{if(this._conversationInfo)return D(this._debug_convId,"Failed to wait for message sync to finish, retrying"),this._syncBackwardsAndWait(e)}))}))}}))}}function B(e){return'For conv "'+T.mriOrId(e)+'"'}function D(e,...t){f.log(S.LogTraceArea.MessageStreamStore,B(e),...t)}function E(e,...t){f.log(S.LogTraceArea.MessageStreamStoreDebug,B(e),...t)}function V(e,...t){f.error(S.LogTraceArea.MessageStreamStore,B(e),...t)}t.MessageStreamStore=F},475043:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041),r=s(889391),a=s(351077),l=s(850513),d=s(18078),c=s(539549);let h=class extends n.StoreBase{constructor(){super(...arguments),this._translatedMessages={},this._hiddenTranslations={}}getTranslatedMessage(e,t){return this._translatedMessages[e]&&this._translatedMessages[e][t]}hasTranslatedMessage(e,t){return!(!this._translatedMessages[e]||!this._translatedMessages[e][t])}updateMessages(e){if(!r.default.getS4LCMCFeatures().enableMessageTranslation)return;const t=[];o.each(e,(e=>{const s=e.conversationId,i=(0,c.default)().getConversation(s),o=null==i?void 0:i.isTranslated();if((d.default.isMyMri(e.creator)||o)&&s&&(0,a.isTranslationMessageType)(e.messagetype)){const i=(0,a.getMessageTranslationMetadata)(e.content);e.isDeletedMessage()||!i?delete this._translatedMessages[s]:(this._translatedMessages[s]||(this._translatedMessages[s]={}),(!this._translatedMessages[s][i.oid]||e.createdTime>this._translatedMessages[s][i.oid].createdTime)&&(this._translatedMessages[s][i.oid]=e,t.push(s)))}else this._requestNewTranslationWhenEdited(e,s)&&l.default.requestTranslation(s,e.cuid,e)})),o.isEmpty(t)||this.trigger(o.uniq(t))}_requestNewTranslationWhenEdited(e,t){var s;return t&&!(0,a.isTranslationMessageType)(e.messagetype)&&!o.isEmpty(e.content)&&!!(null===(s=this._translatedMessages[t])||void 0===s?void 0:s[e.cuid])&&Number(e.getLatestServerMessageVersion()||0)>Number(this._translatedMessages[t][e.cuid].getLatestServerMessageVersion()||0)}hasHiddenTranslation(e,t){var s,i;return!(null===(s=this._translatedMessages[e])||void 0===s?void 0:s[t])||!!(null===(i=this._hiddenTranslations[e])||void 0===i?void 0:i[t])}setHidden(e,t,s=!0){var i,o;(null===(i=this._translatedMessages[e])||void 0===i?void 0:i[t])&&(!s&&(null===(o=this._hiddenTranslations[e])||void 0===o?void 0:o[t])?(delete this._hiddenTranslations[e][t],this.trigger(e)):s&&(this._hiddenTranslations[e]||(this._hiddenTranslations[e]={}),this._hiddenTranslations[e][t]||(this._hiddenTranslations[e][t]=!0,this.trigger(e))))}test_reset(){this._translatedMessages={},this._hiddenTranslations={}}test_getUpdatedTranslationMessages(){return this._translatedMessages}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],h.prototype,"getTranslatedMessage",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],h.prototype,"hasTranslatedMessage",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],h.prototype,"hasHiddenTranslation",null),h=i.__decorate([n.AutoSubscribeStore],h),t.default=new h},540897:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSupportedTabType=t.MobileExpressionPickerStore=void 0;const i=s(570655),o=s(583367),n=s(217041),r=s(397691),a=s(898278),l=s(783294),d=s(758962),c=s(29130),h=s(422538),u=s(360305);let p=class extends n.StoreBase{constructor(){super(),this._activeTabType=l.defaultTabType,this._isInlineSearchActive=!1,this._isPickerActive=!1,h.RegisterStartupable(this,"MobileExpressionPickerStore",[c.default])}startup(){return c.default.subscribe((()=>{c.default.getDeviceOrientation(a.MainRootViewId)!==o.DeviceOrientation.Landscape||u.default.isTabletUI()||this._activeTabType===d.TabType.Gif||this.deactivateInlineSearch()}),c.TriggerKeys.Orientation),r.Resolved(void 0)}tryActivateInlineSearch(e,t){return!(c.default.getDeviceOrientation(a.MainRootViewId)===o.DeviceOrientation.Landscape&&!u.default.isTabletUI()&&e!==d.TabType.Gif)&&(this._isInlineSearchActive&&this._activeTabType===e||(this._isInlineSearchActive=!0,this._isPickerActive=!1,this._activeTabType=e,this._initialSearch=t,this.trigger()),!0)}deactivateInlineSearch(){this._isInlineSearchActive&&(this._isInlineSearchActive=!1,this._activeTabType=l.defaultTabType,this._initialSearch=void 0,this.trigger())}setInlineSearchType(e){this._activeTabType!==e&&(this._activeTabType=e,this.trigger())}activatePicker(e){this._isPickerActive&&this._activeTabType===e||(this._isPickerActive=!0,this._isInlineSearchActive=!1,this._activeTabType=e,this.trigger())}deactivatePicker(){this._isPickerActive&&(this._isPickerActive=!1,this._activeTabType=l.defaultTabType,this.trigger())}isPickerActive(){return this._isPickerActive}isInlineSearchActive(){return this._isInlineSearchActive}getActiveTabType(){return this._activeTabType}getInitialSearch(){return this._initialSearch}};i.__decorate([n.autoSubscribe],p.prototype,"isPickerActive",null),i.__decorate([n.autoSubscribe],p.prototype,"isInlineSearchActive",null),i.__decorate([n.autoSubscribe],p.prototype,"getActiveTabType",null),i.__decorate([n.autoSubscribe],p.prototype,"getInitialSearch",null),p=i.__decorate([n.AutoSubscribeStore],p),t.MobileExpressionPickerStore=p,t.isSupportedTabType=function(e){return e===d.TabType.ChatSticker||e===d.TabType.Moji||e===d.TabType.Emoticon||e===d.TabType.Gif},t.default=new p},520849:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041),n=s(572666),r=s(666501),a=s(626712);let l=class extends o.StoreBase{constructor(){super(...arguments),this._map={},this._mojiToFetch={}}getMetadataForMoji(e,t,s){if(this._map[e])return this._map[e];if(void 0!==t){const e=n.default.getMoji(t);if(e)return e}if(s){const e=n.default.getMojiByUrl(s);if(e)return e}this._mojiToFetch[e]||(this._mojiToFetch[e]=!0,r.default.getMojiMetadata(e).then((t=>{const s={auxiliaryUrl:t.auxiliaryUrl?a.default.sanitizeUrl(t.auxiliaryUrl):"",auxiliaryText:t.auxiliaryText||t.auxiliaryUrl,description:t.description||"",copyright:t.copyright||"",pickerTitle:t.pickerTitle||""};this._map[e]=s,this.trigger(e)}),(()=>{})).always((()=>{delete this._mojiToFetch[e]})))}};i.__decorate([o.autoSubscribe,i.__param(0,o.key)],l.prototype,"getMetadataForMoji",null),l=i.__decorate([o.AutoSubscribeStore],l),t.default=new l},572666:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041),r=s(626712);let a=class extends n.StoreBase{constructor(){super(...arguments),this._map={}}getMojis(){return this._map}getMoji(e){return this._map[e]}getMojiByUrl(e){const t=r.default.getURIComponents(e);if(!t)return;const s=t.pathname,i=s?s.split("/"):void 0,o=i&&i.length>=4?i[3]:void 0;return o?this._map[o]:void 0}setMojis(e){this._map=o.keyBy(e,(e=>e.id)),o.defer((()=>{this.trigger()}))}};i.__decorate([n.autoSubscribe],a.prototype,"getMojis",null),i.__decorate([n.autoSubscribe],a.prototype,"getMoji",null),a=i.__decorate([n.AutoSubscribeStore],a),t.default=new a},512952:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(570655),o=s(217041);var n;!function(e){e[e.ShowMybotFloatToolTip=0]="ShowMybotFloatToolTip",e[e.MyBotItemReady=1]="MyBotItemReady",e[e.MyBotToolTipOffset=2]="MyBotToolTipOffset",e[e.MyBotItemIndexChanged=3]="MyBotItemIndexChanged"}(n=t.TriggerKeys||(t.TriggerKeys={}));let r=class extends o.StoreBase{constructor(){super(...arguments),this._showMybotFloatToolTip=!1,this._myBotItemReady=!1,this._myBotToolTipOffset=0,this._myBotIndex=0}isMyBotItemReady(){return this._myBotItemReady}shouldShowMyBotFloatToolTip(){return this._showMybotFloatToolTip}getToolTipOffset(){return this._myBotToolTipOffset}getMyBotItemIndex(){return this._myBotIndex}setShowMyBotFloatToolTip(e){this._showMybotFloatToolTip=e,this.trigger(n.ShowMybotFloatToolTip)}setMyBotItemReady(){this._myBotItemReady=!0,this.trigger(n.MyBotItemReady)}setToolTipOffset(e){this._myBotToolTipOffset=e,this.trigger(n.MyBotToolTipOffset)}setMyBotItemIndex(e){this._myBotIndex!==e&&(this._myBotIndex=e,this.trigger(n.MyBotItemIndexChanged))}};i.__decorate([(0,o.autoSubscribeWithKey)(n.MyBotItemReady)],r.prototype,"isMyBotItemReady",null),i.__decorate([(0,o.autoSubscribeWithKey)(n.ShowMybotFloatToolTip)],r.prototype,"shouldShowMyBotFloatToolTip",null),i.__decorate([(0,o.autoSubscribeWithKey)(n.MyBotToolTipOffset)],r.prototype,"getToolTipOffset",null),i.__decorate([(0,o.autoSubscribeWithKey)(n.MyBotItemIndexChanged)],r.prototype,"getMyBotItemIndex",null),r=i.__decorate([o.AutoSubscribeStore],r),t.default=new r},696168:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PesConfigLoadingStatus=void 0;const i=s(570655),o=s(496486),n=s(217041),r=s(758962);var a,l;!function(e){e[e.LoadingStatus=0]="LoadingStatus",e[e.FetchingItems=1]="FetchingItems",e[e.Emoticons=2]="Emoticons",e[e.Mojis=3]="Mojis",e[e.ChatStickers=4]="ChatStickers",e[e.CaptureStickers=5]="CaptureStickers",e[e.Gifs=6]="Gifs",e[e.Effects=7]="Effects"}(a||(a={})),function(e){e[e.NotStarted=1]="NotStarted",e[e.Loading=2]="Loading",e[e.Error=3]="Error",e[e.Completed=4]="Completed"}(l=t.PesConfigLoadingStatus||(t.PesConfigLoadingStatus={}));let d=class extends n.StoreBase{constructor(){super(...arguments),this._loadingStatus=l.NotStarted}getEmoticonTabs(){return o.values(this._emoticonTabs)}getMojiTabs(){return o.values(this._mojiTabs)}getChatStickerTabs(){return o.values(this._chatStickerTabs)}getCaptureStickerTabs(){return o.values(this._captureStickerTabs)}getGifTabs(){return o.values(this._gifTabs)}getLoadingStatus(){return this._loadingStatus}setEmoticonMojiTabs(e){this._emoticonTabs=this._getNewMapForTabs(o.filter(e,(e=>e.tabType===r.TabType.Emoticon))),this._mojiTabs=this._getNewMapForTabs(o.filter(e,(e=>e.tabType===r.TabType.Moji))),this._mergeTabs();const t=[a.Emoticons,a.Mojis];this._loadingStatus!==l.Completed&&(this._loadingStatus=l.Completed,t.push(a.LoadingStatus)),o.defer((()=>{this.trigger(t)}))}setCaptureStickerTabs(e){this._captureStickerTabs=this._getNewMapForTabs(e,!1),this._mergeTabs();const t=[a.CaptureStickers];this._loadingStatus!==l.Completed&&(this._loadingStatus=l.Completed,t.push(a.LoadingStatus)),o.defer((()=>{this.trigger(t)}))}setChatStickerTabs(e){this._chatStickerTabs=this._getNewMapForTabs(e),this._mergeTabs();const t=[a.ChatStickers];this._loadingStatus!==l.Completed&&(this._loadingStatus=l.Completed,t.push(a.LoadingStatus)),o.defer((()=>{this.trigger(t)}))}setGifTabs(e){this._gifTabs=this._getNewMapForTabs(e),this._mergeTabs();const t=[a.Gifs];this._loadingStatus!==l.Completed&&(this._loadingStatus=l.Completed,t.push(a.LoadingStatus)),o.defer((()=>{this.trigger(t)}))}setGifItems(e,t,s){if(!this._gifTabs||!this._gifTabs[t])return;const i=Object.assign(Object.assign({},this._gifTabs[t].packs[0]),{items:e}),n=Object.assign(Object.assign({},this._gifTabs[t]),{packs:[i],isFetchingItems:s});this._gifTabs=Object.assign(Object.assign({},this._gifTabs),{[t]:n}),o.defer((()=>{this.trigger([a.Gifs])}))}setLoadingStatus(e){e!==this._loadingStatus&&(this._loadingStatus=e,this.trigger(a.LoadingStatus))}getTabIconsUrl(){return o.map(this._mergedTabs,((e,t)=>e.iconUrlOrAssetID))}_mergeTabs(){const e={};o.each(this._emoticonTabs,((t,s)=>{e[s]=t})),o.each(this._mojiTabs,((t,s)=>{e[s]=t})),o.each(this._captureStickerTabs,((t,s)=>{e[s]=t})),o.each(this._chatStickerTabs,((t,s)=>{e[s]=t})),o.each(this._gifTabs,((t,s)=>{e[s]=t})),this._mergedTabs=e}_getNewMapForTabs(e,t=!0){const s={};return o.each(e,(e=>{if(t&&o.isEmpty(e.packs))return;const i=e;void 0===i.iconUrlOrAssetID&&void 0!==i.iconUrl&&(e=Object.assign(Object.assign({},e),{iconUrlOrAssetID:i.iconUrl})),s[e.id]=e})),s}};i.__decorate([(0,n.autoSubscribeWithKey)(a.Emoticons)],d.prototype,"getEmoticonTabs",null),i.__decorate([(0,n.autoSubscribeWithKey)(a.Mojis)],d.prototype,"getMojiTabs",null),i.__decorate([(0,n.autoSubscribeWithKey)(a.ChatStickers)],d.prototype,"getChatStickerTabs",null),i.__decorate([(0,n.autoSubscribeWithKey)(a.CaptureStickers)],d.prototype,"getCaptureStickerTabs",null),i.__decorate([(0,n.autoSubscribeWithKey)(a.Gifs)],d.prototype,"getGifTabs",null),i.__decorate([(0,n.autoSubscribeWithKey)(a.LoadingStatus)],d.prototype,"getLoadingStatus",null),d=i.__decorate([n.AutoSubscribeStore],d),t.default=new d},575057:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041),r=s(397691),a=s(476621),l=s(671830),d=s(562141),c=s(125793),h=s(746096),u=s(436237),p=s(998754),g=s(914976),m=s(422538);let S=class extends n.StoreBase{constructor(){super(),this._privateConversations={},this._conversationsUpdated=e=>{o.each(e,(e=>{const t=e.conv.isEncryptedThread()?e.conv.getEncryptionHandshake():void 0;if(t){const s=c.default.getBuddyAddress(t).mri;this._savePrivateConversationMri(s,l.asSkypeThreadId(e.conv.id))}}))},m.RegisterStartupable(this,"PrivateConversationsStore",[a.default,p.default])}startup(){return this._privateConversations=p.default.getDataExclusive(d.InternalKeys.PrivateConversations)||{},a.default.conversationsUpdated.subscribe(this._conversationsUpdated),r.Resolved()}getPrivateConversationMriForContactMri(e){return this._privateConversations[e]}getAllPrivateConversationMris(){return o.values(this._privateConversations)}_savePrivateConversationMri(e,t){this._privateConversations[e]||(this._privateConversations[e]=t,p.default.putData(d.InternalKeys.PrivateConversations,this._privateConversations),u.log(h.LogTraceArea.PrivateConversationsStore,"Saving private conversation mri "+g.mriOrId(t)+" with contact mri "+g.mriOrId(e)),this.trigger(e))}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],S.prototype,"getPrivateConversationMriForContactMri",null),i.__decorate([n.autoSubscribe],S.prototype,"getAllPrivateConversationMris",null),S=i.__decorate([n.AutoSubscribeStore],S),t.default=new S},317219:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsStore=void 0;const i=s(570655),o=s(496486),n=s(217041),r=s(397691),a=s(889391),l=s(481169),d=s(601446),c=s(733754),h=s(46929),u=s(422538);let p,g=class extends d.CustomReactionsStoreBase{constructor(){super(),u.RegisterStartupable(this,"ReactionsStore",[h.default])}startup(){super.startup();const e=a.default.getS4LMessagingFeatures();return this._maxReactionsNumber=e.maxNumberOfCustomReactions,this._initialTabId=e.customReactionsInitialTabId,a.default.subscribe((()=>{const{customReactionsInitialTabId:e}=a.default.getS4LMessagingFeatures();this._initialTabId=e})),r.Resolved()}getDefaultReactions(){return(0,l.chain)(o.assign({},a.default.getS4LMessagingFeatures().reactionPacks),(0,l.map)(o.toArray),o.flatten)}getSavedReactions(){return h.default.getReactions()||[]}saveCurrentReactions(){h.default.setReactions(this._localReactions),super.saveCurrentReactions()}getInitialTabId(){return this._initialTabId}isFeatureEnabled(){return!0}getMaxReactionsCount(){return this._maxReactionsNumber}getModalTitle(){return c.getString("ReactionsPanel.Title")}};g=i.__decorate([n.AutoSubscribeStore],g),t.ReactionsStore=g,t.default=function(){return p||(p=new g)}},588378:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_RecentAssetStore=t.TriggerKeys=void 0;const i=s(570655),o=s(930640),n=s(823113),r=s(516778),a=s(217041),l=s(397691),d=s(300060),c=s(746096),h=s(436237),u=s(581736),p=s(914976),g=s(422538),m=s(478262),S=s(818882);var f;!function(e){e[e.RecentAssetThumbnail=0]="RecentAssetThumbnail",e[e.RecentAssetTimestamp=1]="RecentAssetTimestamp",e[e.HasFreshRecentAsset=2]="HasFreshRecentAsset"}(f=t.TriggerKeys||(t.TriggerKeys={}));let y=class extends a.StoreBase{getRecentAssetThumbnail(){return this._recentAssetThumbnail}getRecentAssetTimestamp(){return this._recentAssetTimestamp}hasRecentAsset(){return this._hasFreshRecentAsset}constructor(){super(),this._gettingRecentAssetThumbnail=!1,g.RegisterStartupable(this,"RecentAssetStore",[u.default])}startup(){return o.default.setRecentAssetThumbnailChangedEventEnabled(!0),o.default.recentAssetThumbnailChangedEvent.subscribe((e=>{h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore recentAssetThumbnailChangedEvent"),this._updateRecentAssetProps(e)})),d.default.subscribeForChanges("RecentAssetStore",(e=>{e===r.Types.AppActivationState.Active&&(h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore AppActivationState become active"),this._getRecentAssetThumbnail())})),u.default.subscribe((()=>{h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore permission for camera roll changed"),this._getRecentAssetThumbnail()}),m.PermissionType.CameraRoll),S.LocalStorage.getItem(S.StorageKeys.RecentAssetTimestampKeyId).then((e=>{h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore watched asset timestamp from local storage:"+e),this._storedRecentAssetTimestamp=e?Number(e):void 0,this._getRecentAssetThumbnail()})),l.Resolved()}_startedTrackingKey(e){g.EnsureStarted(this)}markAsWatched(){h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore markAsWatched"),this._recentAssetTimestamp&&S.LocalStorage.setItem(S.StorageKeys.RecentAssetTimestampKeyId,String(this._recentAssetTimestamp)).then((()=>{this._storedRecentAssetTimestamp=this._recentAssetTimestamp,this._updateHasFreshRecentAsset()}))}forceRecentAssetCheck(){h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore forceRecentAssetCheck"),this._getRecentAssetThumbnail()}test_setRecentAssetTimestamp(e){this._recentAssetTimestamp=e}_getRecentAssetThumbnail(){h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore _getRecentAssetThumbnail"),this._gettingRecentAssetThumbnail||u.default.permissionStatus(m.PermissionType.CameraRoll)!==n.PermissionStatus.Granted||(this._gettingRecentAssetThumbnail=!0,o.default.getRecentAssetThumbnail().then((e=>{this._updateRecentAssetProps(e)})).finally((()=>{this._gettingRecentAssetThumbnail=!1})))}_updateRecentAssetProps(e){e.thumbnail===this._recentAssetThumbnail&&e.timestamp===this._recentAssetTimestamp||(h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore update recent asset data thumbnail("+p.dev_unknownOmit(e.thumbnail)+"), timestamp("+e.timestamp+")"),this._recentAssetThumbnail=e.thumbnail,this._recentAssetTimestamp=e.timestamp,this.trigger([f.RecentAssetThumbnail,f.RecentAssetTimestamp]),this._updateHasFreshRecentAsset())}_updateHasFreshRecentAsset(){const e=this._recentAssetTimestamp||0,t=this._storedRecentAssetTimestamp||0,s=Date.now()/1e3-604800,i=e>t,o=e>s,n=i&&o;h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore hasFreshRecentAsset check: recentTimestamp("+e+") storedTimestamp("+t+") minAllowedTimestamp("+s+") hasNewAsset("+i+") newAssetIsNotVeryOld("+o+") hasFreshAsset("+n+")"),this._hasFreshRecentAsset!==n&&(h.log(c.LogTraceArea.MediaPrefetchService,"RecentAssetStore triggers HasFreshRecentAsset change"),this._hasFreshRecentAsset=n,this.trigger(f.HasFreshRecentAsset))}};i.__decorate([(0,a.autoSubscribeWithKey)(f.RecentAssetThumbnail)],y.prototype,"getRecentAssetThumbnail",null),i.__decorate([(0,a.autoSubscribeWithKey)(f.RecentAssetTimestamp)],y.prototype,"getRecentAssetTimestamp",null),i.__decorate([(0,a.autoSubscribeWithKey)(f.HasFreshRecentAsset)],y.prototype,"hasRecentAsset",null),y=i.__decorate([a.AutoSubscribeStore],y),t.Test_RecentAssetStore=y,t.default=new y},431234:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(570655),o=s(496486),n=s(217041),r=s(244770),a=s(397691),l=s(562141),d=s(746096),c=s(497174),h=s(436237),u=s(998754),p=s(733754),g=s(758962),m=s(422538);var S;!function(e){e[e.emoticons=0]="emoticons",e[e.mojis=1]="mojis",e[e.stickersInChat=2]="stickersInChat",e[e.stickersInCapture=3]="stickersInCapture"}(S=t.TriggerKeys||(t.TriggerKeys={}));let f=class extends n.StoreBase{constructor(){super(),this.recentTabId="recent",m.RegisterStartupable(this,"PesPacksStore",[u.default])}startup(){return this._emoticons=u.default.getDataExclusive(l.InternalKeys.RecentlyUsedEmoticons),this._mojis=u.default.getDataExclusive(l.InternalKeys.RecentlyUsedMojis),this._stickersInChat=u.default.getDataExclusive(l.InternalKeys.RecentlyUsedStickersInChat),this._stickersInCapture=u.default.getDataExclusive(l.InternalKeys.RecentlyUsedStickersInCapture),a.Resolved()}getRecentEmoticonTabInfo(e){const t=[],s=this._filterRecentlyUsed(this._emoticons,e);return s&&s.length&&t.push({id:this.recentTabId,items:s,title:p.getString("PesPicker.RecentEmoticonPackTitle")}),{id:this.recentTabId,title:p.getString("PesPicker.RecentEmoticonTabTitle"),tabType:g.TabType.Emoticon,iconUrlOrAssetID:r.Collection.TAB_MRU,packs:t}}getRecentMojiTabInfo(){const e=[];return this._mojis&&this._mojis.length&&e.push({id:this.recentTabId,items:this._mojis,title:p.getString("PesPicker.RecentMojiPackTitle")}),{id:this.recentTabId,title:p.getString("PesPicker.RecentMojiTabTitle"),tabType:g.TabType.Moji,iconUrlOrAssetID:r.Collection.TAB_MRU,packs:e}}getRecentStickerInChatTabInfo(){const e=[];return this._stickersInChat&&this._stickersInChat.length&&e.push({id:this.recentTabId,items:this._stickersInChat,title:p.getString("PesPicker.RecentStickerPackTitle")}),{id:this.recentTabId,title:p.getString("PesPicker.RecentStickerTabTitle"),tabType:g.TabType.ChatSticker,iconUrlOrAssetID:r.Collection.TAB_MRU,packs:e}}getRecentStickerInCaptureTabInfo(){const e=[],t=p.getString("PesPicker.RecentCaptureStickerPackTitle");return this._stickersInCapture&&this._stickersInCapture.length&&e.push({id:this.recentTabId,items:this._stickersInCapture,title:t}),{id:this.recentTabId,title:t,tabType:g.TabType.CaptureSticker,iconUrlOrAssetID:r.Collection.TAB_MRU_DARKTHEME,packs:e}}registerEntities(e){const t=[],s=[],i=[];o.each(e,(e=>{e instanceof c.EmoticonEntity?t.push(e):e instanceof c.MojiEntity?s.push(e):e instanceof c.StickerEntity&&i.push(e)}));const n=[];t.length>0&&(h.log(d.LogTraceArea.GenericUnsafe,"Registering emoticons in MRU:",o.map(t,(e=>e.emoticonName))),this._emoticons=o.reduce(t,((e,t)=>this._insertItem(e,t.emoticonName)),this._emoticons),n.push(S.emoticons)),s.length>0&&(h.log(d.LogTraceArea.GenericUnsafe,"Registering mojis in MRU:",o.map(s,(e=>e.id))),this._mojis=o.reduce(s,((e,t)=>this._insertItem(e,t.id)),this._mojis),n.push(S.mojis)),i.length>0&&(h.log(d.LogTraceArea.GenericUnsafe,"Registering stickers in MRU:",o.map(i,(e=>e.id))),this._stickersInChat=o.reduce(i,((e,t)=>this._insertItem(e,t.id)),this._stickersInChat),n.push(S.stickersInChat)),n.length>0&&(this.trigger(n),this._storeRecentlyUsedPes())}registerStickersInCapture(e){const t=[];e.length>0&&(h.log(d.LogTraceArea.GenericUnsafe,"Registering capture stickers in MRU:",e),this._stickersInCapture=o.reduce(e,((e,t)=>this._insertItem(e,t)),this._stickersInCapture),t.push(S.stickersInCapture)),t.length>0&&(this.trigger(t),this._storeRecentlyUsedPes())}clearHistory(){this._emoticons=[],this._mojis=[],this._stickersInChat=[],this._stickersInCapture=[],this._storeRecentlyUsedPes(),this.trigger([S.emoticons,S.mojis,S.stickersInChat,S.stickersInCapture])}_filterRecentlyUsed(e,t){return o.isEmpty(t)||o.isEmpty(e)?e:o.filter(e,(e=>!o.includes(t,e)))}_storeRecentlyUsedPes(){l.default.openTransaction([l.Stores.InternalData],!0).then((e=>{a.all([u.default.putData(l.InternalKeys.RecentlyUsedEmoticons,this._emoticons,e),u.default.putData(l.InternalKeys.RecentlyUsedMojis,this._mojis,e),u.default.putData(l.InternalKeys.RecentlyUsedStickersInChat,this._stickersInChat,e),u.default.putData(l.InternalKeys.RecentlyUsedStickersInCapture,this._stickersInCapture,e)]).finally((()=>{e.markCompleted()}))}))}_insertItem(e,t){if(!e||0===e.length)return[t];const s=o.filter(e,(e=>e!==t));return s.unshift(t),s.splice(24),s}};i.__decorate([(0,n.autoSubscribeWithKey)(S.emoticons)],f.prototype,"getRecentEmoticonTabInfo",null),i.__decorate([(0,n.autoSubscribeWithKey)(S.mojis)],f.prototype,"getRecentMojiTabInfo",null),i.__decorate([(0,n.autoSubscribeWithKey)(S.stickersInChat)],f.prototype,"getRecentStickerInChatTabInfo",null),i.__decorate([(0,n.autoSubscribeWithKey)(S.stickersInCapture)],f.prototype,"getRecentStickerInCaptureTabInfo",null),f=i.__decorate([n.AutoSubscribeStore],f);const y=new f;t.default=y},781571:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041),n=s(397691),r=s(422538),a={isOpen:!1,popupPosition:{bottom:0,height:0,left:0,right:0,top:0,width:0}};var l;!function(e){e.ShowRichtextEditor="ShowRichtextEditor",e.PopupPositionUpdated="PopupPositionUpdated"}(l||(l={}));let d=class extends o.StoreBase{constructor(){super(),this._richTextEditorInfo=new Map,this._getRichTextEditorConfig=e=>this._richTextEditorInfo.get(e)||a,this._setRichTextEditorConfig=(e,t)=>{this._richTextEditorInfo.set(e,Object.assign(Object.assign({},this._richTextEditorInfo.get(e)||a),t))},r.RegisterStartupable(this,"RichtextEditorStore")}startup(){return n.Resolved()}setVisibility(e,t){t!==this._getRichTextEditorConfig(e).isOpen&&(this._setRichTextEditorConfig(e,{isOpen:t}),this.trigger((0,o.formCompoundKey)(e,l.ShowRichtextEditor)))}clear(e){this._richTextEditorInfo.delete(e),this.trigger((0,o.formCompoundKey)(e,l.ShowRichtextEditor))}panelOpened(e){return this._getRichTextEditorConfig(e).isOpen}};i.__decorate([(0,o.autoSubscribeWithKey)(l.ShowRichtextEditor),i.__param(0,o.key)],d.prototype,"panelOpened",null),d=i.__decorate([o.AutoSubscribeStore],d),t.default=new d},427428:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041),r=s(861253);let a=class extends n.StoreBase{constructor(){super(...arguments),this._allMris=[],this._selectedMris=[]}isMriSelected(e){return o.includes(this._selectedMris,e)}getSelectedMris(){return this._selectedMris}toggleMriSelection(e){o.includes(this._selectedMris,e)?this._removeMri(e):this._addMri(e),this.trigger([e])}createMriSelectionRange(e){const t=o.last(this._selectedMris);if(!t)return this._addMri(e),void this.trigger(e);const s=this._allMris.indexOf(e),i=this._allMris.indexOf(t),n=s>i?this._allMris.slice(i,s+1):this._allMris.slice(s,i+1);this._selectedMris=o.merge(this._selectedMris,n),this.trigger(this._selectedMris)}resetSelectedMris(){const e=[...this._selectedMris];this._selectedMris=[],this.trigger(e)}setAllMris(e){(0,r.default)(e,this._allMris)||(this._allMris=[...e])}_addMri(e){this._selectedMris=[...this._selectedMris,e]}_removeMri(e){this._selectedMris.splice(this._selectedMris.indexOf(e),1)}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],a.prototype,"isMriSelected",null),a=i.__decorate([n.AutoSubscribeStore],a),t.default=new a},144487:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(570655),o=s(496486),n=s(217041),r=s(898278);!function(e){e[e.SpacerWidthUpdates=0]="SpacerWidthUpdates"}(t.TriggerKeys||(t.TriggerKeys={}));let a=class extends n.StoreBase{constructor(){super(...arguments),this._selectedMessages=[],this._isSelectMessagesModeActive=!1,this._selectedMessagesScope=r.MainRootViewId}deactivateSelectMessagesMode(){this._isSelectMessagesModeActive&&(this._isSelectMessagesModeActive=!1,this._selectedMessages=[],this._selectedMessagesScope=r.MainRootViewId,this.trigger())}activateSelectMessagesMode(e){const t=e!==this._selectedMessagesScope;this._isSelectMessagesModeActive&&!t||(this._isSelectMessagesModeActive=!0,this._selectedMessagesScope=e,t&&(this._selectedMessages=[]),this.trigger())}addOrUpdateSelectedMessage(e){this._selectedMessages=o.filter(this._selectedMessages,(t=>!(t.message.cuid===e.message.cuid&&t.urlPreviewId===e.urlPreviewId))),this._selectedMessages=o.sortBy(this._selectedMessages.concat(e),(e=>e.message.createdTime)),this.trigger()}removeSelectedMessage(e){this._selectedMessages=o.filter(this._selectedMessages,(t=>!(t.message.cuid===e.message.cuid&&t.urlPreviewId===e.urlPreviewId))),this.trigger()}isMessageSelected(e){return o.some(this._selectedMessages,(t=>t.message.cuid===e))}isSelectMessagesModeActive(e){return this._isSelectMessagesModeActive&&this._selectedMessagesScope===e}getSelectedMessages(){return this._selectedMessages}};i.__decorate([n.autoSubscribe],a.prototype,"isSelectMessagesModeActive",null),i.__decorate([n.autoSubscribe],a.prototype,"getSelectedMessages",null),a=i.__decorate([n.AutoSubscribeStore],a),t.default=new a},666765:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(174958),o=s(496486),n=s(974634),r=s(397691),a=s(889391),l=s(890239),d=s(671830),c=s(746096),h=s(897811),u=s(172685),p=s(436237),g=s(861253),m=s(954416),S=s(216568),f=s(422538),y=s(640363),v=s(994214),C=s(626712),_="SessionInfoStore";t.default=new class{constructor(){this._sessionInfo={id:void 0,exists:!1,featureFlags:void 0,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,restEndpointUrl:void 0,ecsEtag:void 0,registrationToken:void 0},this.endpointInfoChanged=new n.default,this.restEndpointUrlChanged=new n.default,this._loggingOut=!1,this._appConfigStoreChanged=()=>{const{chatServiceHostRefreshEnabled:e,chatServiceHostRefreshInterval:t}=a.default.getConfigSettings().chat;e&&!this._chatServiceHostRefreshEnabled?t>0&&t!==this._chatServiceHostRefreshInterval?(this._chatServiceHostRefreshInterval=t,p.log(c.LogTraceArea.ChatService,`SessionInfoStore chatServiceHostRefreshInterval set to ${this._chatServiceHostRefreshInterval} s`),u.default.setRefreshOptions(_,{interval:a.default.getConfigSettings().chat.chatServiceHostRefreshInterval,taskTypeFlags:u.TaskTypeFlags.UsesNetworking,callback:()=>(p.log(c.LogTraceArea.ChatService,"SessionInfoStore restEndpointUrlChanged fire."),this.restEndpointUrlChanged.fire(),r.Resolved())})):this.restEndpointUrlChanged.fire():!e&&this._chatServiceHostRefreshEnabled&&u.default.setRefreshOptions(_,{interval:0,taskTypeFlags:u.TaskTypeFlags.UsesNetworking,callback:()=>{}})},f.RegisterStartupable(this,"SessionInfoStore",[S.default])}calcChatV1EndpointUrl(){switch(a.default.getS4LFeatures().chatFeatures.recommendedRing){case l.UserRing.DailyDF:case l.UserRing.MasterDF:return a.default.getConfigSettingsNoSubscription().chat.dogfoodHost;default:return a.default.getConfigSettingsNoSubscription().chat.productionHost}}startup(){if(!a.default.getConfigSettings().chat.dontPersistSessionInfoOnWeb){const e=o.cloneDeep(S.default.ChatServiceSessionInfo.get());e&&(this._sessionInfo=e,y.default.setChatEndpointId(d.formatEndpointIdRemoveBrackets(this._sessionInfo.id)))}return p.log(c.LogTraceArea.ChatService,"Startup: Stored Endpoint Info: "+d.encodeEndpointInfoForLog(this._sessionInfo)),a.default.subscribe(this._appConfigStoreChanged),this._appConfigStoreChanged(),r.Resolved(void 0)}setRestEndpointUrl(e){this._sessionInfo.restEndpointUrl!==e&&C.default.isUrlValid(e)&&(this._sessionInfo=Object.assign(Object.assign({},this._sessionInfo),{restEndpointUrl:e}),this._persistSessionInfo())}setRegistrationToken(e){if(this._sessionInfo.registrationToken===e)return;const t=d.getExpiresFromRegToken(e),s=v.default.getSkypeToken();p.log(c.LogTraceArea.ChatServiceTransport,"Registration token updated to "+(e?"using new":"undefined")+", Expires: "+(t?new Date(1e3*t):"undefined")+", EndpointId: "+d.getEndpointIdFromRegToken(e)+", SkypeToken valid: "+(s&&!s.isTokenExpired())+", SkypeToken expiration: "+(s?new Date(s.expiration):"undefined")),this._sessionInfo=Object.assign(Object.assign({},this._sessionInfo),{registrationToken:e}),this._persistSessionInfo()}markRegistrationTokenExpired(e){this._sessionInfo.registrationToken&&this._sessionInfo.registrationToken!==e?p.log(c.LogTraceArea.ChatServiceTransport,"RegistrationToken reported invalid, but it doesn't match our stored one -- ignoring!"):this.setRegistrationToken(void 0)}setPushSubscriptionInfo(e,t,s){!e||this._sessionInfo.exists&&d.areEndpointIdsEqual(this._sessionInfo.id,e.endpointId)?(e?p.log(c.LogTraceArea.ChatService,"Push Subscription Updated: "+e.endpointId+"/"+e.subscriptionId+", Params: "+i.pii.Omit(JSON.stringify(e.params))):p.log(c.LogTraceArea.ChatService,"Push Subscription Cleared"),this.updateEndpointInfo({pushSubscriptionId:e?e.subscriptionId:void 0,pushSubscriptionParams:e?e.params:void 0,reason:t,tcid:s})):p.log(c.LogTraceArea.ChatService,"pushSubscriptionUpdated called with stale endpointId")}markEndpointMissing(e,t){d.areEndpointIdsEqual(this._sessionInfo.id,e)?(p.log(c.LogTraceArea.ChatService,"Endpoint "+e+" reported missing"),this.updateEndpointInfo({exists:!1,featureFlags:void 0,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,reason:"Endpoint missing",tcid:t})):p.log(c.LogTraceArea.ChatService,"endpointMissing called with stale endpointId")}updateEndpointInfo(e){if(this._loggingOut)return;const t=o.assign({},this._sessionInfo,e);if((0,g.default)(this._sessionInfo,t))return;this._sessionInfo.exists&&!this._sessionInfo.id&&p.track(new h.FundamentalsDebugEvent("EndpointIdEmpty",e.reason)),this._sessionInfo.id&&this._sessionInfo.pushSubscriptionId&&!t.pushSubscriptionId&&p.track(new h.MissingPushSubscription(t.id||"None",this._sessionInfo.id,this._sessionInfo.pushSubscriptionId,m.default.getRegistrationId(),e.reason,e.tcid)),p.log(c.LogTraceArea.ChatService,"UpdateEndpointInfo: "+d.encodeEndpointInfoForLog(t));const s=this._sessionInfo;this._sessionInfo=t,this._persistSessionInfo(),this.endpointInfoChanged.fire(t,s)}getEndpointInfo(){return this._sessionInfo}getEndpointId(){return this._sessionInfo.exists?this._sessionInfo.id:void 0}endpointExists(){return this._sessionInfo.exists}presenceDocPublished(){return!!this.getEndpointInfo().presenceDocPublished}getRestEndpointUrl(){return this._sessionInfo.restEndpointUrl}getRegistrationToken(){return this._sessionInfo.registrationToken}logout(e){return this._loggingOut=!0,y.default.setChatEndpointId(void 0),S.default.deleteIds({chatServiceSessionInfo:!0})}_persistSessionInfo(){this._loggingOut||(y.default.setChatEndpointId(d.formatEndpointIdRemoveBrackets(this._sessionInfo.id)),a.default.getConfigSettings().chat.dontPersistSessionInfoOnWeb||S.default.setChatServiceSessionInfo(this._sessionInfo))}test_reset(){this._sessionInfo={id:void 0,exists:!1,featureFlags:void 0,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,restEndpointUrl:void 0,ecsEtag:void 0,registrationToken:void 0}}}},906262:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041),n=s(739119),r=s(904604),a=s(16625),l=s(969417),d=s(889391),c=s(436237);let h=class extends o.StoreBase{constructor(){super(),r.default.subscribe((()=>this.trigger()))}isPaidUser(){const e=r.default.getCreditEntitlement();return n.hasUsableCredit(e)||r.default.userHasSubscriptions()}trackCallerIdOnSMSSent(){d.default.getS4LEntitlementFeaturesNoSubscription().SCE.UserServices.Client.Features.CallerIdTelemetryOnSMSSent&&a.default.maybeRefreshCallerIdData().finally((()=>{var e;c.track(new l.SmsSent(null===(e=a.default.getCallerIdPrimaryNumber())||void 0===e?void 0:e.type))}))}};i.__decorate([o.autoSubscribe],h.prototype,"isPaidUser",null),h=i.__decorate([o.AutoSubscribeStore],h),t.default=new h},774342:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041),n=s(113510);let r=class extends o.StoreBase{constructor(){super(...arguments),this._phoneNumberRates={},this._lookups={}}_startedTrackingKey(e){this._lookups[e]||(this._lookups[e]=n.default.getSmsPrice(e).finally((()=>{delete this._lookups[e]})).then((t=>{t&&(this._phoneNumberRates[e]=t,this.trigger(e))})))}_stoppedTrackingKey(e){const t=this._lookups[e];t&&(delete this._lookups[e],t.cancel()),delete this._phoneNumberRates[e]}getSmsRateByPhoneNumber(e){return this._phoneNumberRates[e]}};i.__decorate([o.disableWarnings],r.prototype,"_startedTrackingKey",null),i.__decorate([o.disableWarnings],r.prototype,"_stoppedTrackingKey",null),i.__decorate([o.autoSubscribe,i.__param(0,o.key)],r.prototype,"getSmsRateByPhoneNumber",null),r=i.__decorate([o.AutoSubscribeStore],r),t.default=new r},24139:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041),n=s(666501),r=s(713130),a=s(626712);let l=class extends o.StoreBase{constructor(){super(...arguments),this._map={},this._stickerToFetch={}}getMetadataForSticker(e,t){if(this._map[e])return this._map[e];if(t){const e=r.default.getSticker(t);if(e)return e}this._stickerToFetch[e]||(this._stickerToFetch[e]=!0,n.default.getStickerMetadata(e).then((t=>{const s={auxiliaryUrl:t.auxiliaryUrl&&a.default.sanitizeUrl(t.auxiliaryUrl)||"",auxiliaryText:t.auxiliaryText||t.auxiliaryUrl,description:t.description||"",copyright:t.copyright||"",title:t.title||""};this._map[e]=s,this.trigger(e)}),(()=>{})).always((()=>{delete this._stickerToFetch[e]})))}};i.__decorate([o.autoSubscribe,i.__param(0,o.key)],l.prototype,"getMetadataForSticker",null),l=i.__decorate([o.AutoSubscribeStore],l),t.default=new l},713130:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(217041),r=s(135455);let a=class extends n.StoreBase{constructor(){super(...arguments),this._mergedStickerMap={},this._captureStickerMap={},this._chatStickerMap={}}getSticker(e){return this._mergedStickerMap[e]}setCaptureStickers(e){this._captureStickerMap=o.keyBy(e,(e=>e.id)),this._mergeStickers(),this.trigger()}setChatStickers(e){this._chatStickerMap=o.keyBy(e,(e=>e.id)),this._mergeStickers(),this.trigger()}getStickerUrls(){return o.map(this._mergedStickerMap,((e,t)=>{const s=r.getDefaultEmoticonSize();return r.getStickerUrl(e.baseUrl,s,!1,!0,e.etag)}))}_mergeStickers(){this._mergedStickerMap={},o.each(this._captureStickerMap,((e,t)=>{this._mergedStickerMap[t]=this._captureStickerMap[t]})),o.each(this._chatStickerMap,((e,t)=>{this._mergedStickerMap[t]=this._chatStickerMap[t]}))}};i.__decorate([n.autoSubscribe],a.prototype,"getSticker",null),a=i.__decorate([n.AutoSubscribeStore],a),t.default=new a},626612:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(496486),n=s(41217),r=s(217041),a=s(397691),l=s(544135),d=s(606452),c=s(552115),h=s(861253),u=s(624606),p=s(785207),g=s(422538),m=s(626712),S=s(960634);var f;!function(e){e[e.Queued=1]="Queued",e[e.FetchingFromiCloud=2]="FetchingFromiCloud",e[e.Transcoding=3]="Transcoding",e[e.Uploading=4]="Uploading",e[e.Completed=5]="Completed",e[e.Failed=6]="Failed"}(f||(f={}));const y=.33;let v=class extends r.StoreBase{constructor(){super(),this._postIdToPostInfo={},this._fileDownloadKeyToDownloadInfo={},this._uploadTransactionIdToMessagePostBuilder={},this._transferIdToProgress={},this._urlsWithoutProgress=[],this._reencodingSessionIdToPostId={},this._foregroundPostInfo={postIdToThumbnailProgress:{},postIdToFullDataProgress:{}},this._postIdToServerTranscodingProgress={},this._reportedProgress=(e,t)=>{this._transferIdToProgress[e]=t;const s=o.find(this._postIdToPostInfo,(t=>o.some(t.uploads,(t=>e===t.dataTransferId||e===t.thumbnailTransferId)))),i=s?s.localUrls:[],n=o.find(this._fileDownloadKeyToDownloadInfo,(t=>e===t.downloadTransferId)),r=n?n.urls:[];this.trigger(o.flatten([i,r]))},g.RegisterStartupable(this,"TransferProgressStore",[l.default,d.default,p.default])}startup(){return d.default.downloadUpdated.subscribe((e=>{const{id:t,key:s,downloadTransfer:i}=e;let n=this._fileDownloadKeyToDownloadInfo[s];if(!n){const e=o.findIndex(this._urlsWithoutProgress,(e=>{const s=d.default.getFileDownloadByUrl(e);return!!s&&s.id===t}));if(-1===e)return;n={key:s,urls:this._urlsWithoutProgress.splice(e,1)}}const r=this._updateTransferTracking(i,n.downloadTransferId);this._fileDownloadKeyToDownloadInfo[s]={key:s,urls:n.urls,downloadTransferId:r},this.trigger(n.urls)})),p.default.postCreated.subscribe((e=>{e.amsUploads&&e.amsUploads.length>0&&e.transactionId&&(this._uploadTransactionIdToMessagePostBuilder[e.transactionId]||(this._uploadTransactionIdToMessagePostBuilder[e.transactionId]=e))})),p.default.postUpdated.subscribe((e=>{const t=e.amsUploads&&e.amsUploads.length>0;if(!this._postIdToPostInfo[e.id]&&e.transactionId&&this._uploadTransactionIdToMessagePostBuilder[e.transactionId]&&t){const t=o.map(e.amsUploads,(e=>e.amsFullDataLocalUrl));this._postIdToPostInfo[e.id]=this._updateUploadInfo(e,t,void 0),delete this._uploadTransactionIdToMessagePostBuilder[e.transactionId]}t&&e.transcodingSessionId&&(e.transcodingStatus===u.TranscodingState.InProgress?this._reencodingSessionIdToPostId[e.transcodingSessionId]=e.id:delete this._reencodingSessionIdToPostId[e.transcodingSessionId]);let s=this._postIdToPostInfo[e.id];if(!s){const t=o.findIndex(this._urlsWithoutProgress,(t=>{const s=p.default.getPostByLocalUrl(t);return!!s&&s.id===e.id}));if(-1===t)return;const i=this._urlsWithoutProgress.splice(t,1);s={id:e.id,localUrls:i}}this._postIdToPostInfo[e.id]=this._updateUploadInfo(e,s.localUrls,s.uploads),this.trigger(s.localUrls)})),p.default.foregroundUploadProgress.subscribe(((e,t,s,i)=>{const o=this._postIdToPostInfo[e];if(!o)return;let n=!1;s?(this._foregroundPostInfo.postIdToFullDataProgress[e]||(this._foregroundPostInfo.postIdToFullDataProgress[e]={}),(0,h.default)(this._foregroundPostInfo.postIdToFullDataProgress[e][t],i)||(this._foregroundPostInfo.postIdToFullDataProgress[e][t]=i,n=!0)):(this._foregroundPostInfo.postIdToThumbnailProgress[e]||(this._foregroundPostInfo.postIdToThumbnailProgress[e]={}),(0,h.default)(this._foregroundPostInfo.postIdToThumbnailProgress[e][t],i)||(this._foregroundPostInfo.postIdToThumbnailProgress[e][t]=i,n=!0)),n&&this.trigger(o.localUrls)})),p.default.serverTranscodingProgress.subscribe(((e,t,s)=>{const i=this._postIdToPostInfo[e];if(!i)return;let o=this._postIdToServerTranscodingProgress[e];o||(o=this._postIdToServerTranscodingProgress[e]={}),(0,h.default)(o[t],s)||(o[t]=s,this.trigger(i.localUrls))})),S.videoManipulationProgressChangedEvent.subscribe(((e,t)=>{const s=this._reencodingSessionIdToPostId[e],i=s&&this._postIdToPostInfo[s];i&&(i.lastReencodingUpdate=t,this.trigger(i.localUrls))})),a.Resolved()}_startedTrackingKey(e){if(m.default.isFileOrBlob(e)){const t=p.default.getPostByLocalUrl(e);t?this._postIdToPostInfo[t.id]?this._postIdToPostInfo[t.id].localUrls.push(e):this._postIdToPostInfo[t.id]=this._updateUploadInfo(t,[e],void 0):this._urlsWithoutProgress.push(e)}else if(m.default.isUrlValid(e)){const t=d.default.getFileDownloadByUrl(e);return void(t?this._fileDownloadKeyToDownloadInfo[t.key]?this._fileDownloadKeyToDownloadInfo[t.key].urls.push(e):this._fileDownloadKeyToDownloadInfo[t.key]={key:t.key,urls:[e],downloadTransferId:this._updateTransferTracking(t.downloadTransfer,void 0)}:this._urlsWithoutProgress.push(e))}}_stoppedTrackingKey(e){if(o.remove(this._urlsWithoutProgress,e),m.default.isFileOrBlob(e)){const t=p.default.getPostByLocalUrl(e),s=t&&this._postIdToPostInfo[t.id];t&&s&&(o.pull(s.localUrls,e),s.localUrls.length||(delete this._postIdToPostInfo[t.id],o.each(s.uploads,(e=>{this._updateTransferTracking(void 0,e.dataTransferId),this._updateTransferTracking(void 0,e.thumbnailTransferId)})),delete this._foregroundPostInfo.postIdToFullDataProgress[t.id],delete this._foregroundPostInfo.postIdToThumbnailProgress[t.id]))}else if(m.default.isUrlValid(e)){const t=d.default.getFileDownloadByUrl(e),s=t&&this._fileDownloadKeyToDownloadInfo[t.key];s&&(o.pull(s.urls,e),s.urls.length||(delete this._fileDownloadKeyToDownloadInfo[t.key],this._updateTransferTracking(void 0,s.downloadTransferId)))}}_updateUploadInfo(e,t,s){const i=o.map(e.amsUploads,((t,i)=>{let o,n,r,a;if(t.amsUploadFullData){const r=s&&s[i]&&s[i].dataTransferId;o=this._updateTransferTracking(e.amsFullDataBackgroundTransfers&&e.amsFullDataBackgroundTransfers[i],r),n=t.amsUploadFullData,o&&this._foregroundPostInfo.postIdToFullDataProgress[e.id]&&delete this._foregroundPostInfo.postIdToFullDataProgress[e.id][i]}if(t.amsUploadThumbnailData){const o=s&&s[i]&&s[i].thumbnailTransferId;r=this._updateTransferTracking(e.amsThumbnailBackgroundTransfers&&e.amsThumbnailBackgroundTransfers[i],o),a=t.amsUploadThumbnailData,r&&this._foregroundPostInfo.postIdToThumbnailProgress[e.id]&&delete this._foregroundPostInfo.postIdToThumbnailProgress[e.id][i]}return{dataTransferId:o,fullData:n,thumbnailTransferId:r,thumbnailData:a}}));return{id:e.id,localUrls:t,uploads:i}}_updateTransferTracking(e,t){const s=e?e.id:void 0;if(t!==s&&(t&&(delete this._transferIdToProgress[t],l.default.unsubscribeFromProgress(t,this._reportedProgress)),s)){const e=l.default.getProgress(s);e&&(this._transferIdToProgress[s]=e),l.default.subscribeToProgress(s,this._reportedProgress)}return s}_getVideoProgressForUrl(e,t){e.transcodingSessionId&&(this._reencodingSessionIdToPostId[e.transcodingSessionId]=e.id);let s=f.Queued,i=0;if(e.transcodingStatus===u.TranscodingState.InProgress){const e=t&&t.lastReencodingUpdate;e?(s=e.type===n.ReencodeProgressType.Fetch?f.FetchingFromiCloud:f.Transcoding,i=e.progress):s=f.Queued}else if(e.transcodingStatus===u.TranscodingState.Success){const o=t&&this._getUploadProgressForUrl(e,t);o?o.finished&&o.success?(s=f.Completed,i=1):o.finished?s=f.Failed:(s=f.Uploading,i=o.progress):(s=f.Transcoding,i=1)}let o=0;if(s!==f.Failed&&s!==f.Queued){let t=0,n=0;switch(s){case f.FetchingFromiCloud:n=y,t=0;break;case f.Transcoding:e.wasFetchedFromiCloud?(t=y,n=.33):(t=0,n=.5);break;case f.Uploading:default:e.wasFetchedFromiCloud?(t=.66,n=.34):(t=.5,n=.5)}o=t+n*i}return{finished:s===f.Completed||s===f.Failed,success:s===f.Completed,progress:o,totalSize:e.estimatedVideoUploadSize}}_getUploadProgressForUrl(e,t){let s=0,i=0,n=!0,r=!0;const a=(e,t,o)=>{const a=t?this._transferIdToProgress[t]:o,l=e||0;i+=l,a?(s+=a.finished?l:(a.progress||0)*l,n=n&&a.finished,r=r&&a.success):(n=!1,r=!1)};return o.each(e.amsUploads,((s,i)=>{const o=t.uploads&&t.uploads[i];s.amsUploadFullData&&a(c.default.getAmsUploadFileSize(s),o&&o.dataTransferId,this._foregroundPostInfo.postIdToFullDataProgress[e.id]&&this._foregroundPostInfo.postIdToFullDataProgress[e.id][i]),s.amsUploadThumbnailData&&a(s.amsUploadThumbnailData.file.size,o&&o.thumbnailTransferId,this._foregroundPostInfo.postIdToThumbnailProgress[e.id]&&this._foregroundPostInfo.postIdToThumbnailProgress[e.id][i])})),{progress:i>0?s/i:0,finished:n,success:r}}getTransferProgressForUrl(e){const t=p.default.getPostByLocalUrl(e),s=t&&this._postIdToPostInfo[t.id];if(t&&t.transcodingStatus)return this._getVideoProgressForUrl(t,s);if(!t||!s){const t=d.default.getFileDownloadByUrl(e),s=t&&this._fileDownloadKeyToDownloadInfo[t.key];return s&&s.downloadTransferId?this._transferIdToProgress[s.downloadTransferId]:void 0}return this._getUploadProgressForUrl(t,s)}test_startTrackingKey(e){this._startedTrackingKey(e)}test_reset(){this._postIdToPostInfo={},this._fileDownloadKeyToDownloadInfo={},this._transferIdToProgress={},this._foregroundPostInfo={postIdToFullDataProgress:{},postIdToThumbnailProgress:{}},this._urlsWithoutProgress=[],this._reencodingSessionIdToPostId={}}};i.__decorate([r.disableWarnings],v.prototype,"_startedTrackingKey",null),i.__decorate([r.disableWarnings],v.prototype,"_stoppedTrackingKey",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],v.prototype,"getTransferProgressForUrl",null),v=i.__decorate([r.AutoSubscribeStore],v),t.default=new v},675865:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655),o=s(217041),n=s(397691),r=s(472918),a=s(889391),l=s(265976),d=s(422538),c=s(994214);let h=class extends o.StoreBase{constructor(){super(),this._hasCdnToken=!1,this._hasCdnTokenCookie=!1,this._hasAmsCookie=!1,d.RegisterStartupable(this,"UrlAuthStore",[r.default,c.default])}startup(){return c.default.subscribe((()=>{const e=this._hasCdnToken,t=this._hasCdnTokenCookie;this._hasCdnToken=!!c.default.getCdnToken(),this._hasCdnTokenCookie=c.default.usingCdnCookie();let s=!1;e!==this._hasCdnToken&&(s=!0),t!==this._hasCdnTokenCookie&&(s=!0),s&&this.trigger()}),c.TriggerKeys.CdnTokenKey),c.default.subscribe((()=>{const e=this._hasAmsCookie;this._hasAmsCookie=c.default.getAmsCookieSet(),e!==this._hasAmsCookie&&this.trigger()}),c.TriggerKeys.AmsTokenKey),this._hasCdnToken=!!c.default.getCdnToken(),this._hasCdnTokenCookie=c.default.usingCdnCookie(),this._hasAmsCookie=c.default.getAmsCookieSet(),n.Resolved()}getAuthenticatedUrl(e){if(e)return l.isAsyncMediaUrl(e)?this._hasAmsCookie?e:void 0:this._isStaticAmsUrl(e)?this._hasCdnTokenCookie?e:this._hasCdnToken?e+"?"+c.default.getCdnToken():void 0:e}_isStaticAmsUrl(e){return 0===e.indexOf(a.default.getConfigSettingsNoSubscription().pes.skypeServiceHost)}};i.__decorate([o.autoSubscribe],h.prototype,"getAuthenticatedUrl",null),h=i.__decorate([o.AutoSubscribeStore],h),t.default=new h},273096:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserComposingStateStore=void 0;const i=s(871908);class o{constructor(){this._composingStates={}}isUserComposing(){return Object.keys(this._composingStates).length>0}setComposingState(e,t){if(e)this._composingStates[t]=!0;else{if(!this._composingStates[t])return;delete this._composingStates[t]}i.setUserComposingStateIfSupported(e,t)}test_reset(){this._composingStates={}}}t.UserComposingStateStore=o,t.default=new o},124615:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationsListWithFiltersStore=void 0;var i=s(843969);Object.defineProperty(t,"ConversationsListWithFiltersStore",{enumerable:!0,get:function(){return i.ConversationsListWithFiltersStore}})},827028:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OverlayType=t.QRCodeScanState=void 0,function(e){e[e.Disallowed=1]="Disallowed",e[e.Dismissed=2]="Dismissed",e[e.Opened=3]="Opened"}(t.QRCodeScanState||(t.QRCodeScanState={})),function(e){e[e.None=1]="None",e[e.Filter=2]="Filter"}(t.OverlayType||(t.OverlayType={}))},231147:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationType=void 0,function(e){e[e.OneOnOneSkype=0]="OneOnOneSkype",e[e.Encrypted=1]="Encrypted",e[e.PSTN=2]="PSTN",e[e.Group=3]="Group",e[e.Bot=4]="Bot",e[e.Other=5]="Other",e[e.NewsChannel=6]="NewsChannel",e[e.NewsBot=7]="NewsBot"}(t.ConversationType||(t.ConversationType={}))},423353:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationUIType=void 0,function(e){e[e.OneOnOneSkype=0]="OneOnOneSkype",e[e.Private=1]="Private",e[e.Phone=2]="Phone",e[e.Group=3]="Group",e[e.Other=4]="Other"}(t.ConversationUIType||(t.ConversationUIType={}))},884912:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomReactionsType=void 0,function(e){e[e.Message=0]="Message",e[e.Call=1]="Call"}(t.CustomReactionsType||(t.CustomReactionsType={}))},905450:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultMap=void 0,t.getDefaultMap=function(){return{"(smile)":{id:"smile",frameCount:53,firstFrame:22,utf:"🙂",shortcuts:[":)",":-)",":=)","(smile)"]},"(sad)":{id:"sad",frameCount:63,firstFrame:17,utf:"🙁",shortcuts:[":(",":-(",":=(","(sad)",":<",":-<"]},"(laugh)":{id:"laugh",frameCount:77,firstFrame:19,utf:"😀",shortcuts:[":D",":-D",":=D",":d",":-d",":=d","(laugh)",":>",":->","(lol)"]},"(cool)":{id:"cool",frameCount:38,firstFrame:20,utf:"😎",shortcuts:["(cool)","8-)","8=)","B-)","B=)"]},"(surprised)":{id:"surprised",frameCount:68,firstFrame:17,utf:"😲",shortcuts:[":O",":-O",":=O",":o",":-o",":=o","(surprised)"]},"(sarcastic)":{id:"sarcastic",frameCount:84,firstFrame:53,shortcuts:["(sarcastic)","(sarcasm)","(slowclap)"]},"(cwl)":{id:"cwl",frameCount:61,firstFrame:12,utf:"😂",shortcuts:["(cwl)","(cryingwithlaughter)"]},"(wink)":{id:"wink",frameCount:36,firstFrame:16,utf:"😉",shortcuts:[";)",";-)",";=)","(wink)"]},"(cry)":{id:"cry",frameCount:50,firstFrame:38,utf:"😢",shortcuts:[";(",";-(",";=(","(cry)",':"(']},"(sweat)":{id:"sweat",frameCount:69,firstFrame:11,utf:"😓",shortcuts:["(:|","(sweat)"]},"(speechless)":{id:"speechless",frameCount:67,firstFrame:10,utf:"😐",shortcuts:[":|",":-|",":=|","(speechless)"]},"(kiss)":{id:"kiss",frameCount:50,firstFrame:1,utf:"😗",shortcuts:["(kiss)",":*",":-*",":=*","(xo)"]},"(tongueout)":{id:"tongueout",frameCount:71,firstFrame:12,utf:"😋",shortcuts:[":p",":-p",":=p",":P",":-P",":=P","(tongueout)"]},"(blush)":{id:"blush",frameCount:69,firstFrame:11,utf:"😊",shortcuts:[":$",":-$",":=$",":'>","(blush)"]},"(wonder)":{id:"wonder",frameCount:70,firstFrame:16,utf:"🤨",shortcuts:[":^)","(wonder)"]},"(sleepy)":{id:"sleepy",frameCount:72,firstFrame:1,utf:"😪",shortcuts:["|-)","I-)","I=)","(snooze)","(sleepy)"]},"(dull)":{id:"dull",frameCount:77,firstFrame:16,utf:"🙄",shortcuts:["|-(","|(","|=(","(dull)"]},"(inlove)":{id:"inlove",frameCount:63,firstFrame:1,utf:"🥰",shortcuts:["(inlove)","(love)",":]",":-]"]},"(eg)":{id:"eg",frameCount:78,firstFrame:8,shortcuts:["]:)",">:)","]:)",">:)","(evilgrin)","(evil)","(grin)","(eg)"]},"(yawn)":{id:"yawn",frameCount:74,firstFrame:27,shortcuts:["(yawn)"]},"(puke)":{id:"puke",frameCount:79,firstFrame:27,utf:"🤮",shortcuts:["(puke)",":&",":-&",":=&","+o("]},"(doh)":{id:"doh",frameCount:60,firstFrame:29,shortcuts:["(doh)"]},"(angry)":{id:"angry",frameCount:114,firstFrame:1,utf:"😠",shortcuts:["(angry)",":@",":-@",":=@","x(","x-(","X(","X-(","x=(","X=(",";@",";-@"]},"(wasntme)":{id:"wasntme",frameCount:76,firstFrame:18,utf:"🙄",shortcuts:["(wasntme)","(wm)"]},"(party)":{id:"party",frameCount:71,firstFrame:14,utf:"🥳",shortcuts:["(party)","<O)","<o)","<:o)"]},"(worry)":{id:"worry",frameCount:56,firstFrame:1,utf:"😧",shortcuts:["(worry)",":S",":s",":-s",":-S",":=s",":=S","(worried)"]},"(mmm)":{id:"mmm",frameCount:93,firstFrame:25,utf:"😋",shortcuts:["(mm)","(mmm)","(mmmm)"]},"(nerdy)":{id:"nerdy",frameCount:48,firstFrame:1,utf:"🤓",shortcuts:["(nerd)","8-|","B-|","8|","B|","8=|","B=|","(nerdy)"]},"(lipssealed)":{id:"lipssealed",frameCount:50,firstFrame:1,utf:"🤫",shortcuts:[":x",":-x",":X",":-X",":#",":-#",":=x",":=X",":=#","(lipssealed)"]},"(devil)":{id:"devil",frameCount:67,firstFrame:1,utf:"😈",shortcuts:["(devil)"]},"(angel)":{id:"angel",frameCount:84,firstFrame:37,utf:"😇",shortcuts:["(angel)"]},"(envy)":{id:"envy",frameCount:68,firstFrame:18,shortcuts:["(envy)","(v)"]},"(makeup)":{id:"makeup",frameCount:108,firstFrame:72,shortcuts:["(makeup)","(kate)"]},"(cash)":{id:"cash",frameCount:27,firstFrame:11,utf:"💲",shortcuts:["(cash)","($)"]},"(think)":{id:"think",frameCount:59,firstFrame:1,utf:"🤔",shortcuts:["(think)",":-?",":?",":=?","*-)"]},"(rofl)":{id:"rofl",frameCount:81,firstFrame:18,utf:"🤣",shortcuts:["(rofl)","(rotfl)"]},"(happy)":{id:"happy",frameCount:70,firstFrame:5,shortcuts:["(happy)"]},"(smirk)":{id:"smirk",frameCount:54,firstFrame:1,utf:"😏",shortcuts:["(smirk)"]},"(nod)":{id:"nod",frameCount:51,firstFrame:11,shortcuts:["(nod)"]},"(shake)":{id:"shake",frameCount:51,firstFrame:11,shortcuts:["(shake)"]},"(waiting)":{id:"waiting",frameCount:51,firstFrame:1,shortcuts:["(waiting)","(forever)","(impatience)"]},"(emo)":{id:"emo",frameCount:54,firstFrame:1,shortcuts:["(emo)"]},"(fingerscrossed)":{id:"fingerscrossed",frameCount:64,firstFrame:1,utf:"🤞",shortcuts:["(yn)","(fingers)","(fingerscrossed)","(crossedfingers)"]},"(hi)":{id:"hi",frameCount:57,firstFrame:1,utf:"👋",shortcuts:["(wave)","(hi)","(bye)"]},"(facepalm)":{id:"facepalm",frameCount:77,firstFrame:1,utf:"🤦",shortcuts:["(facepalm)","(fail)"]},"(wait)":{id:"wait",frameCount:45,firstFrame:16,shortcuts:["(wait)"]},"(giggle)":{id:"giggle",frameCount:45,firstFrame:1,utf:"🤭",shortcuts:["(chuckle)","(giggle)"]},"(clap)":{id:"clap",frameCount:40,firstFrame:1,utf:"👏",shortcuts:["(clap)"]},"(whew)":{id:"whew",frameCount:51,firstFrame:6,shortcuts:["(whew)","(phew)"]},"(highfive)":{id:"highfive",frameCount:38,firstFrame:9,utf:"✋",shortcuts:["(highfive)","(hifive)","(h5)"]},"(tmi)":{id:"tmi",frameCount:56,firstFrame:10,shortcuts:["(tmi)"]},"(call)":{id:"call",frameCount:46,firstFrame:1,shortcuts:["(call)","(t)"]},"(headbang)":{id:"headbang",frameCount:71,firstFrame:16,shortcuts:["(headbang)","(banghead)"]},"(idea)":{id:"idea",frameCount:119,firstFrame:1,shortcuts:["(idea)",":i",":I","*-:)"]},"(lalala)":{id:"lalala",frameCount:20,firstFrame:6,shortcuts:["(lalala)","(lalalala)","(lala)","(notlistening)"]},"(punch)":{id:"punch",frameCount:44,firstFrame:9,shortcuts:["(punch)","*|","*-|"]},"(rock)":{id:"rock",frameCount:12,firstFrame:1,utf:"🤘",shortcuts:["(rock)"]},"(swear)":{id:"swear",frameCount:77,firstFrame:6,utf:"😬",shortcuts:["(swear)"]},"(talk)":{id:"talk",frameCount:47,firstFrame:4,shortcuts:["(talk)"]},"(talktothehand)":{id:"talktothehand",frameCount:62,firstFrame:1,shortcuts:["(talktothehand)"]},"(bandit)":{id:"bandit",frameCount:102,firstFrame:4,shortcuts:["(bandit)"]},"(heart)":{id:"heart",frameCount:16,firstFrame:1,utf:"❤️",shortcuts:["(heart)","<3"]},"(brokenheart)":{id:"brokenheart",frameCount:105,firstFrame:50,utf:"💔",shortcuts:["(brokenheart)"]},"(yes)":{id:"yes",frameCount:40,firstFrame:1,utf:"👍",shortcuts:["(y)","(yes)"]},"(no)":{id:"no",frameCount:55,firstFrame:1,utf:"👎",shortcuts:["(n)","(no)"]},"(handshake)":{id:"handshake",frameCount:62,firstFrame:13,utf:"🤝",shortcuts:["(handshake)"]},"(ok)":{id:"ok",frameCount:72,firstFrame:1,utf:"👌",shortcuts:["(ok)","(okay)"]},"(muscle)":{id:"muscle",frameCount:59,firstFrame:1,utf:"💪",shortcuts:["(flex)","(muscle)"]},"(bow)":{id:"bow",frameCount:60,firstFrame:30,utf:"🙇",shortcuts:["(bow)"]},"(dance)":{id:"dance",frameCount:206,firstFrame:1,utf:"🕺",shortcuts:["\\o/","\\:D/","\\:d/","(dance)"]},"(bartlett)":{id:"bertlett",frameCount:80,firstFrame:2,utf:"⛹",shortcuts:["(bartlett)","(football)","(soccer)","(so)"]},"(bike)":{id:"bike",frameCount:12,firstFrame:1,utf:"🚴",shortcuts:["(bike)","(bicycle)","(sander)"]},"(ninja)":{id:"ninja",frameCount:122,firstFrame:19,shortcuts:["(ninja)","(j)"]},"(cat)":{id:"cat",frameCount:120,firstFrame:1,utf:"🐈",shortcuts:["(cat)","(@)","(meow)","(kitty)"]},"(dog)":{id:"dog",frameCount:54,firstFrame:1,utf:"🐕",shortcuts:["(dog)",":o3","(&)"]},"(hug)":{id:"hug",frameCount:76,firstFrame:10,utf:"🤗",shortcuts:["(hug)","(bear)"]},"(heidy)":{id:"heidy",frameCount:75,firstFrame:24,utf:"🐿",shortcuts:["(heidy)","(squirrel)"]},"(flower)":{id:"flower",frameCount:83,firstFrame:1,utf:"🌼",shortcuts:["(flower)"]},"(sun)":{id:"sun",frameCount:26,firstFrame:7,utf:"☀",shortcuts:["(sun)"]},"(rain)":{id:"rain",frameCount:30,firstFrame:3,utf:"🌧",shortcuts:["(rain)","(london)","(st)"]},"(star)":{id:"star",frameCount:64,firstFrame:1,utf:"⭐",shortcuts:["(star)","(*)"]},"(tumbleweed)":{id:"tumbleweed",frameCount:32,firstFrame:7,shortcuts:["(tumbleweed)"]},"(pizza)":{id:"pizza",frameCount:91,firstFrame:15,utf:"🍕",shortcuts:["(pi)","(pizza)"]},"(cake)":{id:"cake",frameCount:99,firstFrame:1,utf:"🎂",shortcuts:["(cake)"]},"(coffee)":{id:"coffee",frameCount:28,firstFrame:1,utf:"☕",shortcuts:["(coffee)"]},"(beer)":{id:"beer",frameCount:76,firstFrame:1,utf:"🍺",shortcuts:["(beer)","(bricklayers)"]},"(drink)":{id:"drink",frameCount:63,firstFrame:1,utf:"🍸",shortcuts:["(drink)"]},"(wfh)":{id:"wfh",frameCount:79,firstFrame:1,shortcuts:["(wfh)","(@h)"]},"(phone)":{id:"phone",frameCount:89,firstFrame:1,utf:"📱",shortcuts:["(mp)","(ph)","(phone)"]},"(mail)":{id:"mail",frameCount:54,firstFrame:1,utf:"✉",shortcuts:["(mail)"]},"(movie)":{id:"movie",frameCount:55,firstFrame:1,utf:"🎬",shortcuts:["(film)","(movie)"]},"(music)":{id:"music",frameCount:55,firstFrame:32,utf:"🎵",shortcuts:["(music)"]},"(time)":{id:"time",frameCount:60,firstFrame:18,utf:"🕰️",shortcuts:["(time)","(clock)"]},"(hearteyes)":{id:"hearteyes",frameCount:97,firstFrame:1,utf:"😍",shortcuts:["(hearteyes)"]},"(stareyes)":{id:"stareyes",frameCount:97,firstFrame:1,utf:"🤩",shortcuts:["(stareyes)"]},"(xd)":{id:"xd",frameCount:25,firstFrame:1,utf:"😊",shortcuts:["(xd)"]},"(unamused)":{id:"unamused",frameCount:188,firstFrame:1,utf:"😒",shortcuts:["(unamused)"]},"(pensive)":{id:"pensive",frameCount:130,firstFrame:1,utf:"😔",shortcuts:["(pensive)"]},"(weary)":{id:"weary",frameCount:83,firstFrame:1,utf:"😩",shortcuts:["(weary)"]},"(hysterical)":{id:"hysterical",frameCount:18,firstFrame:1,utf:"🤪",shortcuts:["(hysterical)"]},"(flushed)":{id:"flushed",frameCount:90,firstFrame:1,utf:"😳",shortcuts:["(flushed)"]},"(sweatgrinning)":{id:"sweatgrinning",frameCount:43,firstFrame:1,utf:"😅",shortcuts:["(sweatgrinning)"]},"(disappointed)":{id:"disappointed",frameCount:124,firstFrame:1,utf:"😞",shortcuts:["(disappointed)"]},"(loudlycrying)":{id:"loudlycrying",frameCount:71,firstFrame:1,utf:"😭",shortcuts:["(loudlycrying)"]},"(shivering)":{id:"shivering",frameCount:190,firstFrame:68,utf:"🥶",shortcuts:["(shivering)","(cold)","(freezing)"]},"(expressionless)":{id:"expressionless",frameCount:105,firstFrame:1,utf:"😑",shortcuts:["(expressionless)"]},"(relieved)":{id:"relieved",frameCount:82,firstFrame:1,utf:"😌",shortcuts:["(relieved)"]},"(confused)":{id:"confused",frameCount:60,firstFrame:1,utf:"😕",shortcuts:["(confused)",":-/",":-\\",":/",":\\"]},"(veryconfused)":{id:"veryconfused",frameCount:79,firstFrame:1,utf:"😖",shortcuts:["(veryconfused)"]},"(headphones)":{id:"headphones",frameCount:84,firstFrame:1,utf:"🎧",shortcuts:["(headphones)"]},"(selfie)":{id:"selfie",frameCount:61,firstFrame:1,utf:"🤳",shortcuts:["(selfie)"]},"(shock)":{id:"shock",frameCount:95,firstFrame:41,utf:"😱",shortcuts:["(shock)"]},"(ill)":{id:"ill",frameCount:110,firstFrame:1,utf:"🤒",shortcuts:["(ill)"]},"(tired)":{id:"tired",frameCount:148,firstFrame:1,utf:"😫",shortcuts:["(tired)"]},"(movember)":{id:"movember",frameCount:110,firstFrame:1,utf:"🧐",shortcuts:["(movember)","(mo)","(november)","(moustache)","(mustache)","(bowman)",":{"]},"(ghost)":{id:"ghost",frameCount:78,firstFrame:1,utf:"👻",shortcuts:["(ghost)"]},"(skull)":{id:"skull",frameCount:99,firstFrame:1,utf:"💀",shortcuts:["(skull)"]},"(pumpkin)":{id:"pumpkin",frameCount:56,firstFrame:1,utf:"🎃",shortcuts:["(pumpkin)","(halloween)"]},"(smoke)":{id:"smoke",frameCount:65,firstFrame:1,utf:"🚬",shortcuts:["(smoking)","(smoke)","(ci)"]},"(finger)":{id:"finger",frameCount:72,firstFrame:18,utf:"🖕",shortcuts:["(finger)"]},"(fistbump)":{id:"fistbump",frameCount:62,firstFrame:1,utf:"✊",shortcuts:["(fistbump)","=ƎE=","p#d"]},"(handsinair)":{id:"handsinair",frameCount:63,firstFrame:1,utf:"🙌",shortcuts:["(celebrate)","(celebration)","(handsinair)","(hia)"]},"(hearthands)":{id:"hearthands",frameCount:67,firstFrame:1,utf:"🤟",shortcuts:["(hearthands)"]},"(victory)":{id:"victory",frameCount:73,firstFrame:1,utf:"✌",shortcuts:["(victory)"]},"(praying)":{id:"praying",frameCount:90,firstFrame:1,utf:"🙏",shortcuts:["(pray)","(praying)","_/\\_","(namaste)"]},"(vulcansalute)":{id:"vulcansalute",frameCount:106,firstFrame:1,utf:"🖖",shortcuts:["(vulcansalute)"]},"(glassceiling)":{id:"glassceiling",frameCount:92,firstFrame:1,utf:"🤷‍♂️",shortcuts:["(glassceiling)"]},"(dropthemic)":{id:"dropthemic",frameCount:68,firstFrame:1,utf:"🤱",shortcuts:["(dropthemic)"]},"(womanshrug)":{id:"womanshrug",frameCount:108,firstFrame:1,utf:"🤷‍♀️",shortcuts:["(womanshrug)","(wshrug)","(fshrug)"]},"(cupcake)":{id:"cupcake",frameCount:100,firstFrame:1,utf:"🧁",shortcuts:["(cupcake)"]},"(lips)":{id:"lips",frameCount:89,firstFrame:36,utf:"💋",shortcuts:["(lips)"]},"(penguin)":{id:"penguin",frameCount:64,firstFrame:1,utf:"🐧",shortcuts:["(penguin)","(dancingpenguin)","(penguindance)","(linux)"]},"(monkey)":{id:"monkey",frameCount:50,firstFrame:12,utf:"🐒",shortcuts:["(monkey)","(ape)",":(|)"]},"(koala)":{id:"koala",frameCount:111,firstFrame:1,utf:"🐨",shortcuts:["(koala)"]},"(panda)":{id:"panda",frameCount:169,firstFrame:1,utf:"🐼",shortcuts:["(panda)"]},"(octopus)":{id:"octopus",frameCount:105,firstFrame:1,utf:"🐙",shortcuts:["(octopus)"]},"(whale)":{id:"whale",frameCount:101,firstFrame:1,utf:"🐋",shortcuts:["(whale)"]},"(dolphin)":{id:"dolphin",frameCount:65,firstFrame:1,utf:"🐬",shortcuts:["(dolphin)"]},"(fish)":{id:"fish",frameCount:60,firstFrame:1,utf:"🐟",shortcuts:["(fish)"]},"(bee)":{id:"bee",frameCount:32,firstFrame:1,utf:"🐝",shortcuts:["(bee)"]},"(unicornhead)":{id:"unicornhead",frameCount:87,firstFrame:1,utf:"🦄",shortcuts:["(unicornhead)"]},"(tortoise)":{id:"tortoise",frameCount:195,firstFrame:1,utf:"🐢",shortcuts:["(tortoise)"]},"(elephant)":{id:"elephant",frameCount:88,firstFrame:1,utf:"🐘",shortcuts:["(elephant)"]},"(spider)":{id:"spider",frameCount:125,firstFrame:1,utf:"🕷",shortcuts:["(spider)"]},"(snake)":{id:"snake",frameCount:75,firstFrame:1,utf:"🐍",shortcuts:["(snake)"]},"(bunnyhug)":{id:"bunnyhug",frameCount:76,firstFrame:1,utf:"🐰",shortcuts:["(bunnyhug)"]},"(foxhug)":{id:"foxhug",frameCount:95,firstFrame:1,utf:"🦊",shortcuts:["(foxhug)"]},"(pig)":{id:"pig",frameCount:64,firstFrame:1,utf:"🐖",shortcuts:["(pig)"]},"(polarbear)":{id:"polarbear",frameCount:120,firstFrame:1,utf:"🐻",shortcuts:["(polarbear)","(polarbearhug)"]},"(movinghome)":{id:"movinghome",frameCount:26,firstFrame:1,utf:"🦀",shortcuts:["(movinghome)"]},"(cricket)":{id:"cricket",frameCount:189,firstFrame:1,utf:"🦗",shortcuts:["(cricket)"]},"(snail)":{id:"snail",frameCount:74,firstFrame:1,utf:"🐌",shortcuts:["(snail)","(sn)"]},"(lamb)":{id:"lamb",frameCount:58,firstFrame:1,utf:"🐑",shortcuts:["(lamb)"]},"(hedgehog)":{id:"hedgehog",frameCount:50,firstFrame:1,utf:"🦔",shortcuts:["(hedgehog)"]},"(bunny)":{id:"bunny",frameCount:110,firstFrame:1,utf:"🐇",shortcuts:["(bunny)","(lovebunny)","(rabbit)"]},"(yotfr)":{id:"yotfr",frameCount:72,firstFrame:1,utf:"🐔",shortcuts:["(yotfr)"]},"(fire)":{id:"fire",frameCount:10,firstFrame:1,utf:"🔥",shortcuts:["(fire)"]},"(rainbow)":{id:"rainbow",frameCount:20,firstFrame:1,utf:"🌈",shortcuts:["(rainbow)"]},"(avocadolove)":{id:"avocadolove",frameCount:129,firstFrame:1,utf:"🥑",shortcuts:["(avocadolove)"]},"(redwine)":{id:"redwine",frameCount:1,firstFrame:1,utf:"🍷",shortcuts:["(redwine)"]},"(champagne)":{id:"champagne",frameCount:62,firstFrame:1,utf:"🍾",shortcuts:["(champagne)","(sparkling)"]},"(cheers)":{id:"cheers",frameCount:68,firstFrame:1,utf:"🥂",shortcuts:["(cheers)"]},"(chai)":{id:"chai",frameCount:130,firstFrame:1,utf:"🍵",shortcuts:["(chai)","(tea)"]},"(apple)":{id:"apple",frameCount:1,firstFrame:1,utf:"🍎",shortcuts:["(apple)"]},"(orange)":{id:"orange",frameCount:1,firstFrame:1,utf:"🍊",shortcuts:["(orange)"]},"(lemon)":{id:"lemon",frameCount:1,firstFrame:1,utf:"🍋",shortcuts:["(lemon)"]},"(banana)":{id:"banana",frameCount:1,firstFrame:1,utf:"🍌",shortcuts:["(banana)"]},"(watermelon)":{id:"watermelon",frameCount:1,firstFrame:1,utf:"🍉",shortcuts:["(watermelon)"]},"(grapes)":{id:"grapes",frameCount:1,firstFrame:1,utf:"🍇",shortcuts:["(grapes)"]},"(strawberry)":{id:"strawberry",frameCount:1,firstFrame:1,utf:"🍓",shortcuts:["(strawberry)"]},"(cherries)":{id:"cherries",frameCount:1,firstFrame:1,utf:"🍒",shortcuts:["(cherries)"]},"(peach)":{id:"peach",frameCount:1,firstFrame:1,utf:"🍑",shortcuts:["(peach)"]},"(pineapple)":{id:"pineapple",frameCount:1,firstFrame:1,utf:"🍍",shortcuts:["(pineapple)"]},"(aubergine)":{id:"aubergine",frameCount:1,firstFrame:1,utf:"🍆",shortcuts:["(aubergine)","(eggplant)"]},"(cheese)":{id:"cheese",frameCount:71,firstFrame:1,utf:"🧀",shortcuts:["(cheese)","(stink)"]},"(chickenleg)":{id:"chickenleg",frameCount:1,firstFrame:1,utf:"🍗",shortcuts:["(chickenleg)"]},"(burger)":{id:"burger",frameCount:1,firstFrame:1,utf:"🍔",shortcuts:["(burger)"]},"(fries)":{id:"fries",frameCount:1,firstFrame:1,utf:"🍟",shortcuts:["(fries)"]},"(noodles)":{id:"noodles",frameCount:1,firstFrame:1,utf:"🍜",shortcuts:["(noodles)"]},"(icecream)":{id:"icecream",frameCount:1,firstFrame:1,utf:"🍦",shortcuts:["(icecream)"]},"(cakeslice)":{id:"cakeslice",frameCount:1,firstFrame:1,utf:"🍰",shortcuts:["(cakeslice)"]},"(cookies)":{id:"cookies",frameCount:1,firstFrame:1,utf:"🍪",shortcuts:["(cookies)"]},"(pie)":{id:"pie",frameCount:70,firstFrame:1,utf:"🥧",shortcuts:["(pie)"]},"(laddu)":{id:"laddu",frameCount:70,firstFrame:1,utf:"🍬",shortcuts:["(laddu)"]},"(tandoorichicken)":{id:"tandoorichicken",frameCount:42,firstFrame:10,utf:"🍢",shortcuts:["(tandoori)","(tandoorichicken)"]},"(turkey)":{id:"turkey",frameCount:50,firstFrame:1,utf:"🦃",shortcuts:["(turkey)","(turkeydance)","(thanksgiving)"]},"(car)":{id:"car",frameCount:12,firstFrame:1,utf:"🚗",shortcuts:["(car)","(au)"]},"(truck)":{id:"truck",frameCount:12,firstFrame:1,utf:"🚚",shortcuts:["(truck)"]},"(ambulance)":{id:"ambulance",frameCount:12,firstFrame:1,utf:"🚑",shortcuts:["(ambulance)"]},"(policecar)":{id:"policecar",frameCount:12,firstFrame:1,utf:"🚓",shortcuts:["(policecar)"]},"(taxi)":{id:"taxi",frameCount:12,firstFrame:1,utf:"🚕",shortcuts:["(taxi)"]},"(scooter)":{id:"scooter",frameCount:60,firstFrame:1,utf:"🛵",shortcuts:["(scooter)"]},"(pushbike)":{id:"pushbike",frameCount:80,firstFrame:1,utf:"🛴",shortcuts:["(pushbike)"]},"(plane)":{id:"plane",frameCount:80,firstFrame:1,utf:"✈",shortcuts:["(plane)","(ap)","(airplane)","(aeroplane)","(aircraft)","(jet)"]},"(launch)":{id:"launch",frameCount:110,firstFrame:1,utf:"🚀",shortcuts:["(launch)","(rocket)","(shuttle)"]},"(desert)":{id:"desert",frameCount:1,firstFrame:1,utf:"🌵",shortcuts:["(desert)"]},"(parislove)":{id:"parislove",frameCount:59,firstFrame:1,utf:"🗼",shortcuts:["(parislove)"]},"(statueofliberty)":{id:"statueofliberty",frameCount:1,firstFrame:1,utf:"🗽",shortcuts:["(statueofliberty)"]},"(house)":{id:"house",frameCount:1,firstFrame:1,utf:"🏠",shortcuts:["(house)","(home)"]},"(gift)":{id:"gift",frameCount:13,firstFrame:12,utf:"🎁",shortcuts:["(gift)"]},"(trophy)":{id:"trophy",frameCount:65,firstFrame:1,utf:"🏆",shortcuts:["(trophy)"]},"(goldmedal)":{id:"goldmedal",frameCount:66,firstFrame:1,utf:"🥇",shortcuts:["(goldmedal)"]},"(silvermedal)":{id:"silvermedal",frameCount:66,firstFrame:1,utf:"🥈",shortcuts:["(silvermedal)"]},"(bronzemedal)":{id:"bronzemedal",frameCount:66,firstFrame:1,utf:"🥉",shortcuts:["(bronzemedal)"]},"(bell)":{id:"bell",frameCount:46,firstFrame:1,utf:"🔔",shortcuts:["(bell)","(ghanta)"]},"(key)":{id:"key",frameCount:66,firstFrame:1,utf:"🔑",shortcuts:["(key)","(success)"]},"(tubelight)":{id:"tubelight",frameCount:70,firstFrame:1,utf:"💡",shortcuts:["(tubelight)"]},"(americanfootball)":{id:"americanfootball",frameCount:1,firstFrame:1,utf:"🏈",shortcuts:["(americanfootball)"]},"(fallingleaf)":{id:"fallingleaf",frameCount:1,firstFrame:1,utf:"🍂",shortcuts:["(fallingleaf)"]},"(sunflower)":{id:"sunflower",frameCount:1,firstFrame:1,utf:"🌻",shortcuts:["(sunflower)"]},"(cherryblossom)":{id:"cherryblossom",frameCount:1,firstFrame:1,utf:"🌸",shortcuts:["(cherryblossom)"]},"(tulip)":{id:"tulip",frameCount:1,firstFrame:1,utf:"🌷",shortcuts:["(tulip)"]},"(rose)":{id:"rose",frameCount:1,firstFrame:1,utf:"🌹",shortcuts:["(rose)"]},"(wiltedflower)":{id:"wiltedflower",frameCount:85,firstFrame:1,utf:"🥀",shortcuts:["(wiltedflower)","(w)"]},"(loveletter)":{id:"loveletter",frameCount:59,firstFrame:1,utf:"💌",shortcuts:["(loveletter)"]},"(bomb)":{id:"bomb",frameCount:172,firstFrame:1,utf:"💣",shortcuts:["(bomb)","(explosion)","(explode)","@="]},"(sparkler)":{id:"sparkler",frameCount:36,firstFrame:1,utf:"🎇",shortcuts:["(sparkler)"]},"(fireworks)":{id:"fireworks",frameCount:84,firstFrame:18,utf:"🎆",shortcuts:["(fireworks)"]}}}},212229:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCountryCodes=void 0,t.getCountryCodes=function(){return["eu","uk","af","ax","al","dz","as","ad","ao","ai","aq","ag","ar","am","aw","au","at","az","bs","bh","bd","bb","by","be","bz","bj","bm","bt","bo","ba","bw","bv","br","io","bn","bg","bf","bi","kh","cm","ca","cv","ky","cf","td","cl","cn","cx","cc","co","km","cg","cd","ck","cr","ci","hr","cu","cy","cz","dk","dj","dm","do","ec","eg","sv","gq","er","ee","et","fk","fo","fj","fi","fr","gf","pf","tf","ga","gm","ge","de","gh","gi","gr","gl","gd","gp","gu","gt","gg","gn","gw","gy","ht","hm","va","hn","hk","hu","is","in","id","ir","iq","ie","im","il","it","jm","jp","je","jo","kz","ke","ki","kp","kr","kw","kg","la","lv","lb","ls","lr","ly","li","lt","lu","mo","mk","mg","mw","my","mv","ml","mt","mh","mq","mr","mu","yt","mx","fm","md","mc","mn","me","ms","ma","mz","mm","na","nr","np","nl","an","nc","nz","ni","ne","ng","nu","nf","mp","no","om","pk","pw","ps","pa","pg","py","pe","ph","pn","pl","pt","pr","qa","re","ro","ru","rw","bl","sh","kn","lc","mf","pm","vc","ws","sm","st","sa","sn","rs","sc","sl","sg","sk","si","sb","so","za","gs","es","lk","sd","sr","sj","sz","se","ch","sy","tw","tj","tz","th","tl","tg","tk","to","tt","tn","tr","tm","tc","tv","ug","ua","ae","gb","us","um","uy","uz","vu","ve","vn","vg","vi","wf","ye","zm","zw"]}},281020:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ShareContactOrigin=void 0,function(e){e[e.MessageComposer=0]="MessageComposer",e[e.DragAndDrop=1]="DragAndDrop",e[e.Deeplink=2]="Deeplink"}(t.ShareContactOrigin||(t.ShareContactOrigin={}))},238915:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MediaBarItemOrigin=void 0,function(e){e[e.MessageOverflow=0]="MessageOverflow",e[e.MessageComposer=1]="MessageComposer",e[e.MeetNowInput=2]="MeetNowInput"}(t.MediaBarItemOrigin||(t.MediaBarItemOrigin={}))},609748:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OverflowMenuDefaultOrder=t.MediaBarDefaultOrder=t.PersonalizationPickerCategoryDefaultOrder=t.PesPickerCategoryDefaultOrder=t.MediaBarItemKeys=void 0,t.MediaBarItemKeys={Emoticon:"emoticon",Richtext:"richtext",Moji:"moji",MediaPicker:"media",FilePicker:"file",Location:"location",Contact:"contact",Camera:"camera",ComposerCamera:"composercamera",Bing:"bing",MagicBotToolbox:"magicbottoolbox",Sms:"sms",People:"people",VideoMessage:"video",Sticker:"sticker",Gif:"gif",ScheduleCall:"schedulecall",Poll:"poll",Audio:"audio",MeetNowIconPicker:"meetnowicon",ImagePicker:"imagepicker",SendCredit:"sendcredit",SkypeClipsRecord:"skypeclipsrecord"},t.PesPickerCategoryDefaultOrder=[t.MediaBarItemKeys.Emoticon,t.MediaBarItemKeys.Gif,t.MediaBarItemKeys.Sticker],t.PersonalizationPickerCategoryDefaultOrder=[t.MediaBarItemKeys.Emoticon,t.MediaBarItemKeys.MeetNowIconPicker,t.MediaBarItemKeys.ImagePicker],t.MediaBarDefaultOrder=[t.MediaBarItemKeys.FilePicker,t.MediaBarItemKeys.VideoMessage,t.MediaBarItemKeys.SkypeClipsRecord,t.MediaBarItemKeys.Audio,t.MediaBarItemKeys.Location,t.MediaBarItemKeys.Contact,t.MediaBarItemKeys.Bing,t.MediaBarItemKeys.ScheduleCall,t.MediaBarItemKeys.Gif,t.MediaBarItemKeys.Poll,t.MediaBarItemKeys.Sms,t.MediaBarItemKeys.Emoticon,t.MediaBarItemKeys.Moji,t.MediaBarItemKeys.Sticker,t.MediaBarItemKeys.MediaPicker,t.MediaBarItemKeys.SendCredit,t.MediaBarItemKeys.MagicBotToolbox],t.OverflowMenuDefaultOrder=[t.MediaBarItemKeys.MediaPicker,t.MediaBarItemKeys.Camera,t.MediaBarItemKeys.FilePicker,t.MediaBarItemKeys.Contact,t.MediaBarItemKeys.Bing,t.MediaBarItemKeys.Location,t.MediaBarItemKeys.Sms,t.MediaBarItemKeys.ScheduleCall,t.MediaBarItemKeys.Poll,t.MediaBarItemKeys.SendCredit]},945983:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DismissAnimationType=t.AnimateOverlayState=t.CacheMode=t.MediaViewerTypes=void 0,function(e){e.Picture="Picture",e.Video="Video",e.Audio="Audio",e.Swift="Swift",e.NoHighlights="NoHighlights",e.CallGalleryEmpty="CallGalleryEmpty",e.LoadingHighlights="LoadingHighlights"}(t.MediaViewerTypes||(t.MediaViewerTypes={})),function(e){e[e.FileCacheWithPrefetching=0]="FileCacheWithPrefetching",e[e.FileCacheWithNetFallback=1]="FileCacheWithNetFallback",e[e.Disabled=2]="Disabled"}(t.CacheMode||(t.CacheMode={})),function(e){e[e.None=0]="None",e[e.ShowOverlay=1]="ShowOverlay",e[e.HideOverlay=2]="HideOverlay"}(t.AnimateOverlayState||(t.AnimateOverlayState={})),function(e){e[e.Default=0]="Default",e[e.Vertical=1]="Vertical",e[e.Horizontal=2]="Horizontal"}(t.DismissAnimationType||(t.DismissAnimationType={}))},90284:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OverflowItemSizeInList=t.OverflowItemSizeInGridOrCarousel=void 0,t.OverflowItemSizeInGridOrCarousel=60,t.OverflowItemSizeInList=40},563032:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UrlPreviewRenderInformation=t.MessageRenderSendingStatus=void 0,function(e){e[e.None=0]="None",e[e.Sending=1]="Sending",e[e.NoNetwork=2]="NoNetwork",e[e.Failed=3]="Failed"}(t.MessageRenderSendingStatus||(t.MessageRenderSendingStatus={}));t.UrlPreviewRenderInformation=class{}},106658:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageStreamFontSize=t.newsDigestArticleContentLeftMargin=t.swiftCardHorizontalMargin=t.newsDigestArticleImageSize=t.newsChannelMediaCardMaxWidth=t.streamItemOptionsMenuWidthInDesktopSubview=t.streamItemOptionsMenuWidth=t.streamItemOptionsMenuHeight=t.messageTextLineHeight=t.messageStreamMaxContentWidth=t.messageStreamOverflowWidth=t.messageBorderRadius=t.maxStreamContentWidth=t.headerTextHeight=t.addInsButtonWidth=t.adaptiveCardMessageFixedWidth=void 0,t.adaptiveCardMessageFixedWidth=240,t.addInsButtonWidth=44,t.headerTextHeight=18,t.maxStreamContentWidth=960,t.messageBorderRadius=10,t.messageStreamOverflowWidth=50,t.messageStreamMaxContentWidth=t.maxStreamContentWidth+2*t.messageStreamOverflowWidth,t.messageTextLineHeight=22,t.streamItemOptionsMenuHeight=30,t.streamItemOptionsMenuWidth=50,t.streamItemOptionsMenuWidthInDesktopSubview=32,t.newsChannelMediaCardMaxWidth=500,t.newsDigestArticleImageSize=46,t.swiftCardHorizontalMargin=9,t.newsDigestArticleContentLeftMargin=12,function(e){e[e.Smaller=1]="Smaller",e[e.Small=2]="Small",e[e.Normal=3]="Normal",e[e.Large=4]="Large",e[e.Larger=5]="Larger"}(t.MessageStreamFontSize||(t.MessageStreamFontSize={}))},665047:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DataMessageContentType=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.TranslationSettings=1]="TranslationSettings",e[e.TwinCamSync=2]="TwinCamSync"}(t.DataMessageContentType||(t.DataMessageContentType={}))},795691:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModalNavigatorPrefix=t.SplitViewDefaultWindowDimensions=t.NavigationSettingsItem=t.NavigationSettingsOrigin=t.ContactsPanelV2=t.WizardSteps=t.SharePreviewType=t.CompositeNavigationType=t.TriggerKeys=void 0,function(e){e[e.NavigationAndTabs=1]="NavigationAndTabs",e[e.HubTab=2]="HubTab",e[e.RejoinCallOperation=3]="RejoinCallOperation",e[e.ModalNavigation=4]="ModalNavigation",e[e.DesktopSidebar=5]="DesktopSidebar",e[e.ReactNavigation=6]="ReactNavigation"}(t.TriggerKeys||(t.TriggerKeys={})),function(e){e[e.Default=0]="Default",e[e.MainContent=1]="MainContent",e[e.LeftSidebar=2]="LeftSidebar",e[e.RightSidebar=3]="RightSidebar",e[e.Modal=4]="Modal"}(t.CompositeNavigationType||(t.CompositeNavigationType={})),function(e){e[e.Photo=0]="Photo",e[e.Video=1]="Video",e[e.MixedVideoAndPhoto=2]="MixedVideoAndPhoto",e[e.Text=3]="Text",e[e.File=4]="File",e[e.MultipleMessages=5]="MultipleMessages",e[e.SwiftCards=6]="SwiftCards",e[e.Location=7]="Location",e[e.Audio=8]="Audio",e[e.AudioMessage=9]="AudioMessage",e[e.Contact=10]="Contact"}(t.SharePreviewType||(t.SharePreviewType={})),function(e){e[e.setConvInfo=0]="setConvInfo",e[e.setConvParticipants=1]="setConvParticipants"}(t.WizardSteps||(t.WizardSteps={})),function(e){e[e.Skype=0]="Skype",e[e.All=1]="All"}(t.ContactsPanelV2||(t.ContactsPanelV2={})),function(e){e[e.ApplicationMenu=0]="ApplicationMenu",e[e.ApplicationSettings=1]="ApplicationSettings",e[e.DesktopOverflowMenu=2]="DesktopOverflowMenu",e[e.HelpAndFeedbackMenu=3]="HelpAndFeedbackMenu",e[e.MySettingsPanel=4]="MySettingsPanel",e[e.NotificationsPanel=5]="NotificationsPanel",e[e.LandingScreen=6]="LandingScreen",e[e.KeyboardShortcut=7]="KeyboardShortcut",e[e.WebFooter=8]="WebFooter"}(t.NavigationSettingsOrigin||(t.NavigationSettingsOrigin={})),function(e){e[e.BrowseKnownIssues=0]="BrowseKnownIssues",e[e.GetHelp=1]="GetHelp",e[e.GoToSupport=2]="GoToSupport",e[e.HelpAndFeedback=3]="HelpAndFeedback",e[e.RateUs=4]="RateUs",e[e.ReportAProblem=5]="ReportAProblem",e[e.SendFeedback=6]="SendFeedback",e[e.SkypeStatus=7]="SkypeStatus",e[e.UserVoice=8]="UserVoice",e[e.CheckAccount=9]="CheckAccount",e[e.AccountReadMore=10]="AccountReadMore"}(t.NavigationSettingsItem||(t.NavigationSettingsItem={})),t.SplitViewDefaultWindowDimensions={width:460,height:600,x:void 0,y:void 0},t.ModalNavigatorPrefix="modal_"},597223:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationPeriodsCommands=t.MessageNotificationActionResult=t.MessageNotificationType=t.MessageNotificationNotifyReason=t.MessageNotificationAction=void 0,function(e){e[e.InterruptUser=0]="InterruptUser",e[e.InformUserExternal=1]="InformUserExternal",e[e.Ignore=2]="Ignore"}(t.MessageNotificationAction||(t.MessageNotificationAction={})),function(e){e[e.NotifySilent=0]="NotifySilent",e[e.AlwaysRing=1]="AlwaysRing",e[e.PreviousMessageIsOld=2]="PreviousMessageIsOld",e[e.ScheduledCall=3]="ScheduledCall"}(t.MessageNotificationNotifyReason||(t.MessageNotificationNotifyReason={})),function(e){e[e.Quote=0]="Quote",e[e.Mention=1]="Mention",e[e.RegularMessage=2]="RegularMessage",e[e.SystemAlert=3]="SystemAlert",e[e.Reaction=4]="Reaction",e[e.AddToConversation=5]="AddToConversation",e[e.ScheduledCall=6]="ScheduledCall"}(t.MessageNotificationType||(t.MessageNotificationType={}));t.MessageNotificationActionResult=class{},function(e){e.oneHourPeriod="oneHour",e.eightHoursPeriod="eightHours",e.oneDayPeriod="oneDay",e.oneWeekPeriod="oneWeek",e.indefinitelyPeriod="indefinitely"}(t.NotificationPeriodsCommands||(t.NotificationPeriodsCommands={}))},169156:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmailMissedRemindersOptionValue=t.OptionServiceOptions=t.ProfileInformedUserOptionName=t.AvatarPolicyOptionName=t.SkypeGraphSearchPolicy=t.OptionsServiceAvatarPolicyValueType=t.CallingOptionValues=t.VoicemailOptionName=t.CallForwardingOptionName=t.UiColorOptionName=void 0,t.UiColorOptionName="ui.color",t.CallForwardingOptionName="calling.call-forwarding",t.VoicemailOptionName="calling.voice-mail",t.CallingOptionValues={Disabled:"disable",Enabled:"enabled"},function(e){e.BUDDIES_OR_AUTHORIZED_CAN_SEE="BUDDIES_OR_AUTHORIZED_CAN_SEE",e.OBSOLETE_BUDDIES_CAN_SEE="BUDDIES_OR_AUTHORIZED_CAN_SEE",e.EVERYONE_CAN_SEE="EVERYONE_CAN_SEE"}(t.OptionsServiceAvatarPolicyValueType||(t.OptionsServiceAvatarPolicyValueType={})),function(e){e.SEARCHABLE="SEARCHABLE",e.NOT_SEARCHABLE="NOT_SEARCHABLE",e.NOT_SEARCHABLE_RECOMMENDABLE="NOT_SEARCHABLE_RECOMMENDABLE",e.SEARCHABLE_NOT_RECOMMENDABLE="SEARCHABLE_NOT_RECOMMENDABLE",e.NOT_SEARCHABLE_NOT_RECOMMENDABLE="NOT_SEARCHABLE_NOT_RECOMMENDABLE"}(t.SkypeGraphSearchPolicy||(t.SkypeGraphSearchPolicy={})),t.AvatarPolicyOptionName="profile.show-avatar-policy",t.ProfileInformedUserOptionName="profile.informed-user",function(e){e.EmailMissedCallReminders="reminders.missed-call.email",e.EmailMissedMessageReminders="reminders.missed-message.email"}(t.OptionServiceOptions||(t.OptionServiceOptions={})),function(e){e.Enabled="ENABLED",e.Disabled="DISABLED"}(t.EmailMissedRemindersOptionValue||(t.EmailMissedRemindersOptionValue={}))},526424:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmptyGifResult=t.DefaultDiverseTone=t.DiverseToneSeparator=t.DiverseToneSuffixes=t.ResultIconType=t.EmoticonType=t.EmoticonSize=t.PesCategoryButtonSpacer=t.GifPickerLayoutBreakpoint=t.GifDefaultCategory=t.GifSearchMaxResultsCount=t.GifSearchDebounceMs=t.GifMinSearchChars=t.PesCarouselGifSizeLandscape=t.PesCarouselGifSizePortrait=t.PesCarouselGifHorizontalMarginWidth=t.PesPickerDesktopWidth=t.MojiPreviewMetadataHeight=t.PesCategorySwitcherHeight=t.GifInlineSearchTotalHeight=t.MojiInlineSearchTotalHeight=void 0,t.MojiInlineSearchTotalHeight=135,t.GifInlineSearchTotalHeight=165,t.PesCategorySwitcherHeight=34,t.MojiPreviewMetadataHeight=54,t.PesPickerDesktopWidth=290,t.PesCarouselGifHorizontalMarginWidth=5,t.PesCarouselGifSizePortrait=100,t.PesCarouselGifSizeLandscape=50,t.GifMinSearchChars=2,t.GifSearchDebounceMs=300,t.GifSearchMaxResultsCount=100,t.GifDefaultCategory="Trending",t.GifPickerLayoutBreakpoint=700,t.PesCategoryButtonSpacer=1,function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large",e[e.ExtraLarge=3]="ExtraLarge",e[e.ExtraExtraLarge=4]="ExtraExtraLarge",e[e.ExtraSmall=5]="ExtraSmall"}(t.EmoticonSize||(t.EmoticonSize={})),function(e){e[e.Animated=0]="Animated",e[e.Static=1]="Static"}(t.EmoticonType||(t.EmoticonType={})),function(e){e[e.Final=0]="Final",e[e.Intermediate=1]="Intermediate"}(t.ResultIconType||(t.ResultIconType={})),t.DiverseToneSuffixes=[1,2,3,4,5,6],t.DiverseToneSeparator=":",t.DefaultDiverseTone=1,t.EmptyGifResult={gifItems:[],nextOffset:0}},680457:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PostingTrigger=t.PostUploadInfoKind=t.PostMessageInfoKind=void 0,t.PostMessageInfoKind="postMessage",t.PostUploadInfoKind="postUpload",function(e){e[e.None=1]="None",e[e.BackgroundTask=2]="BackgroundTask",e[e.Push=3]="Push"}(t.PostingTrigger||(t.PostingTrigger={}))},343108:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PrefetchMode=void 0,function(e){e.On="On",e.Off="Off",e.Wifi="Wifi"}(t.PrefetchMode||(t.PrefetchMode={}))},850488:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FormatterTypes=void 0,function(e){e.Italic="_",e.Bold="*",e.StrikeThrough="~",e.Code="```",e.Link="</>"}(t.FormatterTypes||(t.FormatterTypes={}))},19524:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SkypeSmsErrorCategory=t.SkypeSmsDeliveryStatus=void 0,function(e){e[e.Success=6]="Success"}(t.SkypeSmsDeliveryStatus||(t.SkypeSmsDeliveryStatus={})),function(e){e[e.NoError=0]="NoError",e[e.NumberBlocked=104]="NumberBlocked"}(t.SkypeSmsErrorCategory||(t.SkypeSmsErrorCategory={}))},600750:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommandTypes=void 0,function(e){e[e.SearchSelection=0]="SearchSelection",e[e.EditScheduledCall=1]="EditScheduledCall",e[e.Edit=2]="Edit",e[e.Copy=3]="Copy",e[e.CopyImage=4]="CopyImage",e[e.CopyLink=5]="CopyLink",e[e.CopyLocation=6]="CopyLocation",e[e.Quote=7]="Quote",e[e.QuoteSelection=8]="QuoteSelection",e[e.QuoteFromSwipe=9]="QuoteFromSwipe",e[e.Announce=10]="Announce",e[e.RemoveAnnouncement=11]="RemoveAnnouncement",e[e.SaveMedia=12]="SaveMedia",e[e.SaveAsFile=13]="SaveAsFile",e[e.SaveAsMedia=14]="SaveAsMedia",e[e.OpenFileLocation=15]="OpenFileLocation",e[e.OpenMediaLocation=16]="OpenMediaLocation",e[e.Forward=17]="Forward",e[e.Translate=18]="Translate",e[e.TranslateOne=19]="TranslateOne",e[e.Bookmark=20]="Bookmark",e[e.AddReaction=21]="AddReaction",e[e.ViewInChat=22]="ViewInChat",e[e.SelectMessages=23]="SelectMessages",e[e.MarkReadToHere=24]="MarkReadToHere",e[e.CancelSend=25]="CancelSend",e[e.CancelEdit=26]="CancelEdit",e[e.CancelFailedSend=27]="CancelFailedSend",e[e.RetryFailedSend=28]="RetryFailedSend",e[e.ViewLink=29]="ViewLink",e[e.Remove=30]="Remove",e[e.Report=31]="Report",e[e.CancelScheduledCall=32]="CancelScheduledCall",e[e.ShowReported=33]="ShowReported",e[e.CancelPoll=34]="CancelPoll",e[e.DebugDumpMessage=35]="DebugDumpMessage",e[e.DebugDumpMessagePretty=36]="DebugDumpMessagePretty"}(t.CommandTypes||(t.CommandTypes={}))},902040:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValidPresenceResourceRegExp=t.ValidSkypeIdRegExp=t.ValidMriRegExp=void 0,t.ValidMriRegExp=/^[0-9][0-9]?:[^<>\*\{\}&'\"\/\\?^`|~\s]+$/,t.ValidSkypeIdRegExp=/^[^<>\*\{\}&'\"\/\\?^`|~\s]+$/,t.ValidPresenceResourceRegExp=/^[a-zA-Z0-9_\-\.\+:,@=;]+$/},890239:(e,t)=>{var s,i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultConversationType=t.UserRingChangedManually=t.UserRing=t.PnhResourcesToTrack=t.PrimaryResourcesToTrack=t.MessagesStaleReason=t.BotPresence=t.UserAvailability=t.UserStatus=t.ThreadMemberRoles=t.EmptyReactionsUpdate=t.LongPollResult=t.SubscriptionState=void 0,function(e){e[e.Creating=0]="Creating",e[e.CreatedActive=1]="CreatedActive",e[e.CreatedLongPollTrouble=2]="CreatedLongPollTrouble",e[e.Deleting=3]="Deleting",e[e.None=4]="None"}(t.SubscriptionState||(t.SubscriptionState={})),function(e){e[e.Success=0]="Success",e[e.FailureErrorCode=1]="FailureErrorCode",e[e.FailureExternal=2]="FailureExternal"}(t.LongPollResult||(t.LongPollResult={})),t.EmptyReactionsUpdate={added:[],removed:[]},t.ThreadMemberRoles={Admin:"Admin",User:"User"},function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online",e[e.Busy=2]="Busy",e[e.Away=3]="Away",e[e.Idle=4]="Idle",e[e.OnThePhone=5]="OnThePhone",e[e.OutToLunch=6]="OutToLunch",e[e.BeRightBack=7]="BeRightBack",e[e.Hidden=8]="Hidden",e[e.Unknown=9]="Unknown"}(s=t.UserStatus||(t.UserStatus={})),function(e){e[e.Online=0]="Online",e[e.Offline=1]="Offline"}(i=t.UserAvailability||(t.UserAvailability={})),t.BotPresence={availability:i.Online,status:s.Online,mobile:!1,capabilities:["Seamless"],lastUpdated:1},function(e){e[e.NeedSync=0]="NeedSync",e[e.HistoryDisclosedChanged=1]="HistoryDisclosedChanged",e[e.ReceivedUnreconciledEdit=2]="ReceivedUnreconciledEdit",e[e.ConversationPossiblyUnread=3]="ConversationPossiblyUnread"}(t.MessagesStaleReason||(t.MessagesStaleReason={})),t.PrimaryResourcesToTrack=["/v1/users/ME/conversations/ALL/properties","/v1/users/ME/conversations/ALL/messages","/v1/threads/ALL"],t.PnhResourcesToTrack=["/v1/users/ME/conversations/ALL/messages","/v1/users/ME/conversations/ALL/properties?view=consumptionHorizon"],function(e){e[e.PROD=0]="PROD",e[e.DailyDF=1]="DailyDF",e[e.MasterDF=2]="MasterDF"}(t.UserRing||(t.UserRing={})),t.UserRingChangedManually="true2",function(e){e[e.None=0]="None",e[e.Passport=1]="Passport",e[e.Lync=2]="Lync",e[e.Skype=4]="Skype",e[e.Room=8]="Room",e[e.Thread=16]="Thread",e[e.ShortCircuit=32]="ShortCircuit",e[e.PSTN=64]="PSTN",e[e.Facebook=128]="Facebook",e[e.GTalk=256]="GTalk",e[e.Flxt=512]="Flxt",e[e.SmsMms=1024]="SmsMms",e[e.Agent=2048]="Agent",e[e.NotificationStream=4096]="NotificationStream",e[e.Cast=8192]="Cast",e[e.InviteFree=16384]="InviteFree",e[e.Highlights=32768]="Highlights",e[e.ModernBots=131072]="ModernBots",e[e.OneToOneThreads=262144]="OneToOneThreads",e[e.SecureThreads=524288]="SecureThreads",e[e.PhoneThreads=1048576]="PhoneThreads",e[e.Default=1023]="Default",e[e.All=2047]="All"}(o||(o={})),t.DefaultConversationType=o.All},61375:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvokeAgentSource=t.AddNewContactSource=t.BlockConversationSource=t.DeleteConversationSource=t.RemoveMemberFromThreadSource=t.AddMemberToThreadSource=t.CreateThreadSource=t.PostMessageToConversationSource=void 0,function(e){e[e.UserComposingState=0]="UserComposingState",e[e.MessagePost=1]="MessagePost"}(t.PostMessageToConversationSource||(t.PostMessageToConversationSource={})),function(e){e[e.CreateNewConversation=0]="CreateNewConversation",e[e.EscalateOneOnOneToGroupCall=1]="EscalateOneOnOneToGroupCall",e[e.ReactionThread=2]="ReactionThread",e[e.StartNewGroupCall=3]="StartNewGroupCall",e[e.CreateAadConversation=4]="CreateAadConversation",e[e.CreateP2PChat=5]="CreateP2PChat"}(t.CreateThreadSource||(t.CreateThreadSource={})),function(e){e[e.AddUserToGroupCall=0]="AddUserToGroupCall",e[e.AddUserToGroupCallDragAndDrop=1]="AddUserToGroupCallDragAndDrop",e[e.InviteUsersWorkflowStore=2]="InviteUsersWorkflowStore",e[e.JoiningConversation=3]="JoiningConversation",e[e.SetRoleCommand=4]="SetRoleCommand",e[e.SwiftCard=5]="SwiftCard",e[e.BotAutoAdd=6]="BotAutoAdd"}(t.AddMemberToThreadSource||(t.AddMemberToThreadSource={})),function(e){e[e.ConversationListItem=0]="ConversationListItem",e[e.GroupChatSettings=1]="GroupChatSettings",e[e.GroupProfile=2]="GroupProfile",e[e.KickCommand=3]="KickCommand",e[e.LeaveCommand=4]="LeaveCommand",e[e.SkypeUserListItem=5]="SkypeUserListItem",e[e.LobbyButton=6]="LobbyButton"}(t.RemoveMemberFromThreadSource||(t.RemoveMemberFromThreadSource={})),function(e){e[e.BotChatSettingsPanel=0]="BotChatSettingsPanel",e[e.ConversationListItem=1]="ConversationListItem",e[e.UserChatSettingsPanel=2]="UserChatSettingsPanel",e[e.TabSwitcher=3]="TabSwitcher",e[e.CellularRelayAgent=4]="CellularRelayAgent"}(t.DeleteConversationSource||(t.DeleteConversationSource={})),function(e){e[e.BotChatSettingsPanel=0]="BotChatSettingsPanel",e[e.ConversationListItem=1]="ConversationListItem",e[e.BlockedUsersListPanel=2]="BlockedUsersListPanel"}(t.BlockConversationSource||(t.BlockConversationSource={})),function(e){e[e.AcceptContactInvite=0]="AcceptContactInvite",e[e.AddContact=1]="AddContact"}(t.AddNewContactSource||(t.AddNewContactSource={})),function(e){e[e.SwiftQuickReply=0]="SwiftQuickReply",e[e.PermanentMenuRequest=1]="PermanentMenuRequest"}(t.InvokeAgentSource||(t.InvokeAgentSource={}))},328575:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceType=t.Activity=t.Availability=void 0,function(e){e[e.PresenceUnknown=0]="PresenceUnknown",e[e.Available=1]="Available",e[e.AvailableIdle=2]="AvailableIdle",e[e.Busy=3]="Busy",e[e.BusyIdle=4]="BusyIdle",e[e.DoNotDisturb=5]="DoNotDisturb",e[e.BeRightBack=6]="BeRightBack",e[e.Away=7]="Away",e[e.Offline=8]="Offline"}(t.Availability||(t.Availability={})),function(e){e[e.PresenceUnknown=0]="PresenceUnknown",e[e.InAConferenceCall=1]="InAConferenceCall",e[e.InACall=2]="InACall",e[e.Presenting=3]="Presenting",e[e.OffWork=4]="OffWork",e[e.InAMeeting=5]="InAMeeting",e[e.OutOfOffice=6]="OutOfOffice",e[e.Available=7]="Available",e[e.Inactive=8]="Inactive",e[e.Busy=9]="Busy",e[e.DoNotDisturb=10]="DoNotDisturb",e[e.BeRightBack=11]="BeRightBack",e[e.Away=12]="Away",e[e.Offline=13]="Offline",e[e.UrgentInterruptionsOnly=14]="UrgentInterruptionsOnly"}(t.Activity||(t.Activity={})),function(e){e[e.Desktop=0]="Desktop",e[e.Web=1]="Web",e[e.Mobile=2]="Mobile"}(t.DeviceType||(t.DeviceType={})),function(e){e[e.OK=2e4]="OK",e[e.Pending=20200]="Pending",e[e.Forbidden=40300]="Forbidden",e[e.NotFound=40400]="NotFound",e[e.UserNotFound=40401]="UserNotFound",e[e.NoData=40402]="NoData",e[e.Failed=5e4]="Failed",e[e.RegionFailed=50001]="RegionFailed",e[e.NotImplemented=50100]="NotImplemented"}(s||(s={}))},331024:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},634539:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationListItemNames=t.ConversationsListMode=void 0,function(e){e[e.AllConversations=0]="AllConversations",e[e.ArchivedConversations=1]="ArchivedConversations"}(t.ConversationsListMode||(t.ConversationsListMode={})),t.ConversationListItemNames={searchBar:"clp_searchBar",header:"clp_header_",oneOnOneConv:"clp_1:1",groupChat:"clp_groupChat",topSpacer:"clp_topSpacer",itemSpacer:"clp_itemSpacer",bottomSpacer:"clp_bottomSpacer",notificationsPrompt:"clp_notificationsPrompt",emptyState:"clp_emptyState",finishSetupPrompt:"clp_finishSetupPrompt",nativeAd:"clp_nativeAd",loadingIndicator:"clp_loadingIndicator",engagementBanner:"clp_engagementBanner",conversationsListBanner:"clp_conversationsListBanner",divider:"clp_divider_"}},179662:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contextTagName=void 0,t.contextTagName="context"},770891:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.PipContentType=t.SwiftMediaProfiles=t.SwiftAspectRatios=t.SwiftSuggestionProviders=t.SwiftSuggestionTypes=t.SwiftInvokeActionIntents=t.SwiftActionTypes=t.SwiftContentTypes=t.SwiftMessageTypes=t.multiTargetsTagName=t.targetTagName=t.rootTagName=t.MessageRenderOrigin=t.MojiMetadataAlign=t.MojiSize=t.ProcessingDefaults=t.MediaProvider=t.MessageAccessibilityType=t.ProcessingLevel=void 0,function(e){e[e.None=0]="None",e[e.Full=1]="Full",e[e.Stripped=2]="Stripped"}(s=t.ProcessingLevel||(t.ProcessingLevel={})),function(e){e[e.Text=0]="Text",e[e.Media=1]="Media",e[e.Url=2]="Url",e[e.Call=3]="Call"}(t.MessageAccessibilityType||(t.MessageAccessibilityType={})),t.MediaProvider={AMS:"AMS",AzureMS:"AzureMS",FileCache:"FileCache",Preview:"Preview",Capture:"Capture",Moji:"Moji"},t.ProcessingDefaults={All:{emoticons:s.Full,quotes:s.Full,wikiMarkup:s.Full,links:s.Full,atMentions:s.Full},Stripped:{emoticons:s.Stripped,quotes:s.Stripped,wikiMarkup:s.Stripped,links:s.Stripped,atMentions:s.Stripped},Preview:{emoticons:s.Full,quotes:s.None,wikiMarkup:s.Stripped,links:s.Stripped,atMentions:s.Stripped}},function(e){e[e.Small=0]="Small",e[e.MediumSmall=1]="MediumSmall",e[e.Medium=2]="Medium",e[e.Large=3]="Large",e[e.ExtraLarge=4]="ExtraLarge"}(t.MojiSize||(t.MojiSize={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Bottom=2]="Bottom"}(t.MojiMetadataAlign||(t.MojiMetadataAlign={})),function(e){e[e.ChatCanvas=0]="ChatCanvas",e[e.StackGalleryCanvas=1]="StackGalleryCanvas",e[e.CompositeGalleryCanvas=2]="CompositeGalleryCanvas",e[e.CallCanvas=3]="CallCanvas",e[e.ForwardCanvas=4]="ForwardCanvas",e[e.MessageComposerCanvas=5]="MessageComposerCanvas"}(t.MessageRenderOrigin||(t.MessageRenderOrigin={})),t.rootTagName="_root",t.targetTagName="target",t.multiTargetsTagName="targets",t.SwiftMessageTypes={card:"message/card",carousel:"message/card.carousel",signin:"message/card.signin",receipt:"message/card.receipt"},t.SwiftContentTypes={hero:"application/vnd.microsoft.card.hero",flex:"application/vnd.microsoft.card.flex",thumbnail:"application/vnd.microsoft.card.thumbnail",animation:"application/vnd.microsoft.card.animation",audio:"application/vnd.microsoft.card.audio",video:"application/vnd.microsoft.card.video",signin:"application/vnd.microsoft.card.signin",receipt:"application/vnd.microsoft.card.receipt",unsupported:"application/vnd.microsoft.card.unsupported"},t.SwiftActionTypes={openUrl:"openUrl",imBack:"imBack",call:"call",signin:"signin",showImage:"showImage",showVideo:"showVideo",learnMore:"learnMore",invoke:"invoke",openView:"openView",reportAProblem:"reportAProblem",playGif:"playGif"},t.SwiftInvokeActionIntents={luSuggestionDisplay:"lu_suggestion_display",cardsDisplay:"card_display",reminderStartFlow:"reminder_start_flow",reminderSet:"reminder_set",startOptIn:"start_opt_in",calendarSchedule:"calendar_schedule_reply",calendarAvailability:"calendar_availability_reply",instrumentation:"instrumentation"},t.SwiftSuggestionTypes={Default:"Default",Static:"Static"},t.SwiftSuggestionProviders={Dorado:"dorado",Skype:"skype"},t.SwiftAspectRatios={landscape:"16:9",portrait:"9:16",square:"1:1"},t.SwiftMediaProfiles={animation:"animation",audio:"audio",sd:"sd",hd:"hd",video:"video"},function(e){e[e.Youtube=0]="Youtube"}(t.PipContentType||(t.PipContentType={}))},582916:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(570655);i.__exportStar(s(634539),t),i.__exportStar(s(331024),t)},488110:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(996074),r=s(256886),a=s(190631),l=s(915877),d=s(733754),c=s(528805),h=s(192758),u=s(539549),p=s(104735),g=s(582916),m=(0,l.lazyProperties)({panel:()=>o.Styles.createViewStyle({alignSelf:"stretch",flex:1})});class S extends n.BaseNavigationView{constructor(){super(...arguments),this._onCloseButtonPressed=e=>{e.stopPropagation(),this._close()}}_buildState(){return{archivedConversationsCount:(0,u.default)().getSortedArchivedConversations().length}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.archivedConversationsCount<1&&this._close()}_close(){this._isPresentedInTabletLeftNav()?h.default.setConversationsListMode(g.ConversationsListMode.AllConversations):p.default.navigateToRecentsTab()}render(){const e={closeButtonType:this._isPresentedInTabletLeftNav()?a.CloseButtonType.Back:a.CloseButtonType.Close,onPress:this._onCloseButtonPressed},t=this.props.navigation?void 0:(0,i.jsx)(a.SimplePanelHeader,{panelName:d.getString("ArchivedConversationsPanel.Title"),leftButton:e});return(0,i.jsxs)(o.View,Object.assign({style:[m.panel,this._getContext().themeStyles.primaryBackgroundColorStyle]},{children:[t,(0,i.jsx)(c.default,{topInset:r.COLLAPSIBLE_HEADER_SEARCH_MAX_HEIGHT,useMobileView:!0,hideSearchBar:!0,isScrollToTopTarget:!0,viewType:g.ConversationsListMode.ArchivedConversations})]}))}}t.default=S},192076:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(996074),o=s(65159);t.default=(0,i.forNavigation)(o.default)},887962:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(996074),o=s(723303);t.default=(0,i.forNavigation)(o.default)},534635:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(996074),n=s(469198);t.default=(0,o.forNavigation)((e=>{const{height:t,width:s}=e;return(0,i.jsx)(n.default,Object.assign({},e,{mediaHeight:t,mediaWidth:s}))}))},134037:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(996074),o=s(656397);t.default=(0,i.forNavigation)(o.default)},760180:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(583367),r=s(516778),a=s(219784),l=s(889391),d=s(67930),c=s(481169),h=s(671830),u=s(780128),p=s(803056),g=s(898278),m=s(539549),S=s(952262),f=s(746096),y=s(790070),v=s(436237),C=s(772707),_=s(146240),b=s(915877),T=s(565752),M=s(733754),I=s(18078),w=s(104735),P=s(330124),k=s(795691),A=s(948199),x=s(509341),R=s(628433),O=s(29130),L=s(451070),F=s(681115),B=s(536150),D=s(704101),E=s(170919),V=s(210541),N=s(532514),U=s(938931),j=s(724067),H=s(190631),z=s(906262),W=s(316392),G=s(680837),K=s(172758),q=s(853374),Q=s(191066),X=s(897634),$=s(115340),J=s(109106),Y=(0,b.lazyProperties)({panel:()=>r.Styles.createViewStyle({position:"absolute",left:0,top:0,right:0,bottom:0,alignSelf:"stretch"}),contentContainerInner:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",flexDirection:"column"}),participantsInputFrame:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",justifyContent:"center",flexDirection:"row"}),participantsInputContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",flexDirection:"column"}),suggestionsContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",flexDirection:"row",justifyContent:"center"}),headerShadow:()=>r.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,height:1}),searchBoxContainerCompositeNav:()=>r.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch",justifyContent:"center",flexDirection:"row",height:E.SearchInputHeight.default,paddingLeft:15,paddingVertical:10,flex:1})});class Z extends d.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._isScrolledToTop=!0,this._shadowOpacityValue=new r.Animated.Value(0),this._shadowOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._shadowOpacityValue}),this._resetTransitionTransformValue=new r.Animated.Value(0),this._resetTransitionOpacityValue=new r.Animated.Value(1),this._resetSearchTransitionStyle=r.Styles.createAnimatedViewStyle({opacity:this._resetTransitionOpacityValue,transform:[{translateY:this._resetTransitionTransformValue}]}),this._onInputChanged=e=>{this.isComponentMounted()&&this.setState({inputText:e})},this._goBack=e=>{var t;v.log(f.LogTraceArea.Navigation,"SetConversationParticipantsPanel._goBack, causeId: "+e);const s=this._getInvitedUserMris();return null===(t=this.props.route.params.navigator.context.newGroupTelemetryScenario)||void 0===t||t.setParticipantCount(s.length),this.props.route.params.navigator.extendContext({invitedUsersMris:s}),this.props.route.params.navigator.goBack(),!0},this._onShareLinkToggleChange=e=>{this.setState({shareLink:e})},this._onInviteSuggestionsListRef=e=>{this._inviteSuggestionsListRef=e||void 0},this._onProfileSelectionInputRef=e=>{this._profileSelectionInputRef=e||void 0},this._renderSuperComposerHeader=(e,t)=>{const s=e?F.default.horizontalPaddingStyle(e):void 0;let o=(0,i.jsx)(D.default,{buttonOnly:!0,horizontalButtonPadding:0,placeholderText:this.state.isUsingStackNavigationContext?M.getString("SearchInputControl.PlaceHolderTextShort"):M.getString("ConversationsListPanel.SearchPeopleGroupsMessagesButtonTitle"),accessibilityLabel:this.state.isMobileScreenReaderEnabled?M.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,useIOSStyles:!this.state.isUsingStackNavigationContext&&this.state.useIOSSearchStyles,secondaryBackground:!0,safeAreaPaddingStyle:s,showSearchIcon:this._getContext().isPresentedInGenericDesktopModal,onPress:this._handleSuperComposerSearchButtonClick},"search");if(this._getContext().isPresentedInDesktopSubview){const{searchBoxColorStyle:e}=X.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);o=(0,i.jsx)(r.View,Object.assign({style:[Y.searchBoxContainerCompositeNav,e]},{children:o}))}if(e&&t){const t=r.Styles.createViewStyle({marginLeft:-1*e.left,marginRight:-1*e.right},!1);o=(0,i.jsx)(r.View,Object.assign({style:t},{children:o}))}const n=r.Styles.createViewStyle({height:x.default.calculateHeight(this._newChatMenuCommands.length)},!1);return(0,i.jsxs)(r.View,Object.assign({style:[G.default.overflowVisible]},{children:[o,(0,i.jsx)(r.View,Object.assign({style:n},{children:(0,i.jsx)(x.default,{commands:this._newChatMenuCommands})}))]}))},this._handleSuperComposerSearchButtonClick=()=>{const e=q.default.newCauseId();v.log(f.LogTraceArea.Navigation,"SetConversationParticipantsPanel._handleSuperComposerSearchButtonClick, causeId: "+e),v.track(new J.PressAction(J.PressScenario.SearchNavigation,f.SearchPanelInitiator.SuperComposer)),this._getContext().isPresentedInDesktopSubview?w.default.navigateToSearchInModal({searchOrigin:f.SearchPanelInitiator.SuperComposer,modalTitle:this._getHeaderText(this.state)},e,this._getContext()):w.default.navigateToSearch({searchOrigin:f.SearchPanelInitiator.SuperComposer},e)},this._onContentWrapperRef=e=>{this._wrappedContentTransitionView=e||void 0},this._getHeader=()=>(0,i.jsx)(H.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:this._getHeaderLeftButton(),hideBottomBorder:!0,delayHeaderFocus:!1}),this._getHeaderRightButton=()=>{if(!this.props.route.params.navigator.context.creating1on1Conversation){return{text:(0,o.last)(this.props.route.params.navigator.context.wizardSteps)===k.WizardSteps.setConvParticipants?M.getString("SetConversationParticipantsPanel.DoneButtonLabel"):M.getString("Global.NextButtonTitle"),disabled:this.props.route.params.navigator.context.convId&&this.state.numberOfInvitees<1,onPress:this._handleNextButtonClick}}},this._onScroll=(e,t)=>{const s=e<=0;this._isScrolledToTop!==s&&(this._shadowOpacityValue.setValue(s?0:1),this._isScrolledToTop=s)},this._onProfileRemoved=()=>{this._inviteSuggestionsListRef?this._inviteSuggestionsListRef.focusFirst():this._profileSelectionInputRef&&this._profileSelectionInputRef.requestFocus()},this._handleBackButtonClick=()=>{const e=q.default.newCauseId();v.log(f.LogTraceArea.Navigation,"SetConversationParticipantsPanel._handleBackButtonClick,  causeId: "+e),this._goBack(e)},this._handleNextButtonClick=()=>{if(!this.state.navButtonsDisabled)if(this.state.panelSearchType===f.SearchResultsListOrigin.NewCellularSmsConversation)this._getInvitedUsersPhoneNumbersAsMris().then((e=>{this._completeNextButtonClick(e)}));else{const e=this._getInvitedUserMris();this._completeNextButtonClick(e)}},this._headerHeight=()=>(this.state.deviceOrientation!==n.DeviceOrientation.Landscape?this.state.isSmallDevice?H.HeaderHeightSmall:H.HeaderHeight:this.state.isSmallDevice?H.HeaderHeightLandscapeSmall:H.HeaderHeightLandscape)+this.state.statusBarPadding}_buildState(e,t){var s;const i=e.route.params.navigator.context.convId&&(0,m.default)().getConversation(e.route.params.navigator.context.convId),o=P.default.isUsingStackNavigationContext(),n=this._getPanelSearchType(e.route.params.navigator.context),r=this._getRootViewId(),a={statusBarPadding:this._getContext().isPresentedInDesktopSubview?0:L.default.statusBarPadding(),deviceOrientation:O.default.getDeviceOrientation(r),isSmallDevice:O.default.isSmallDevice(r),contentSizeMultiplier:Math.min(O.default.getContentSizeMultiplier(),g.MaxContentSizeMultiplier),excludeGroups:!0,excludeEncrypted:n===f.SearchResultsListOrigin.NewPrivateChat||n===f.SearchResultsListOrigin.NewCellularSmsConversation,excludeS4B:n===f.SearchResultsListOrigin.NewGroup||n===f.SearchResultsListOrigin.AddingParticipantsToGroup||n===f.SearchResultsListOrigin.NewPrivateChat,useIOSSearchStyles:!this._getContext().isPresentedInDesktopSubview&&u.default.shouldUseIOSSearchStyles(),panelSearchType:n,isUsingStackNavigationContext:o,isModeratedThread:!!i&&i.isModerated(),isMobileScreenReaderEnabled:B.default.isMobileScreenReaderEnabled(),enableNewConversationCreation:l.default.getS4LMessagingFeatures().enableNewConversationCreation};return t&&(this._inviteFlowController=new _.default,a.showLoadingMessage=!1,a.inputText="",a.shareLink=!1,this._searchController=new N.default,null===(s=e.route.params.navigator.context.newGroupTelemetryScenario)||void 0===s||s.setVisitedParticipantPicker(),this._newChatMenuCommands=[y.HubCommands.NewMeetNowCommand,y.HubCommands.AddConversationGroupCommand,y.HubCommands.NewGroupCallCommand,...e.route.params.navigator.context.showModeratedGroupOption?[y.HubCommands.AddConversationModeratedGroupCommand]:[],y.HubCommands.AddConversationPrivateCommand,...z.default.isPaidUser()?[y.HubCommands.NewCellularSmsConversationCommand]:[],...l.default.getS4LCaapFeatures().botDiscoveryEnabled?[y.HubCommands.AddBotCommand]:[]]),a.invitingState=this._inviteFlowController.getState(),a.numberOfInvitees=this._inviteFlowController.getSelectedProfiles().length,a}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._headerConfig={getHeader:this._getHeader,getHeaderHeight:this._headerHeight},this.props.route.params.isSuperComposer&&(this._transitionSubscriptionToken=A.default.transitionInfoEvent().subscribe((e=>{if(A.default.isSearchTransition()&&e.toRoute&&e.fromRoute&&e.progress){const t=e.toRoute.type===A.RouteType.Search?e.fromRoute.index:e.toRoute.index;void 0!==t?this._setAnimatedValues(e.progress,t):this._clearAnimatedValues()}else this._clearAnimatedValues()})))}componentWillUnmount(){var e,t;super.componentWillUnmount(),null===(e=this._searchController)||void 0===e||e.destroy(),null===(t=this._transitionSubscriptionToken)||void 0===t||t.unsubscribe()}componentDidMount(){var e;super.componentDidMount(),null===(e=this.props.route.params.navigator.context.invitedUsersMris)||void 0===e||e.forEach((e=>{const t=S.default.getDisplayableProfile(e);t&&this._inviteFlowController.addProfile(t)}))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),[_.InvitingUsersState.FinishedSuccess,_.InvitingUsersState.FinishedFail].indexOf(this.state.invitingState)>=0&&(this.props.route.params.navigator.goNext(),this.state.invitingState===_.InvitingUsersState.FinishedFail&&a.default.showErrorAlert(M.getString("InviteUsersWorkflowStore.CannotAddUser"),g.MainRootViewId)),this._inviteFlowController.getSelectedProfiles().length>0&&this.props.route.params.navigator&&this.props.route.params.navigator.context.creating1on1Conversation&&this._handleNextButtonClick()}render(){const{primaryBackgroundColorStyle:e}=X.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),t=[Y.panel,e];let s;if(this.state.showLoadingMessage){const e=this.props.route.params.navigator.context.convId?M.getString("SetConversationParticipantsPanel.AddingContactsToConversation"):M.getString("SetConversationParticipantsPanel.CreatingNewConversation");s=(0,i.jsx)(T.default,{message:e})}else s=this._getContentForSelectingPeople();return(0,i.jsx)(p.default,Object.assign({goBack:this._goBack},{children:(0,i.jsx)(Q.default,Object.assign({ref:this._onContentWrapperRef,style:t},{children:(0,i.jsx)($.KeyboardAvoidingView,{children:s})}))}))}_getPanelSearchType(e){return l.default.getS4LMessagingFeatures().enableNewConversationCreation&&e.navigationOrigin===f.NavigationConversationOrigin.Recents?f.SearchResultsListOrigin.NewChat:e.useSuperComposerFor1on1Conversation&&e.navigationOrigin===f.NavigationConversationOrigin.SuperComposer?f.SearchResultsListOrigin.SuperComposer:e.createCellularSmsConversation?f.SearchResultsListOrigin.NewCellularSmsConversation:e.creating1on1Conversation?e.navigationOrigin===f.NavigationConversationOrigin.NewPrivateChat?f.SearchResultsListOrigin.NewPrivateChat:f.SearchResultsListOrigin.NewChat:e.peopleType===V.PeopleType.Bots?f.SearchResultsListOrigin.FindBots:e.convId||e.navigationOrigin!==f.NavigationConversationOrigin.NewGroup&&e.navigationOrigin!==f.NavigationConversationOrigin.UserProfileNewGroupWithUser&&e.navigationOrigin!==f.NavigationConversationOrigin.KeyboardShortcutNewGroupWithUser?f.SearchResultsListOrigin.AddingParticipantsToGroup:f.SearchResultsListOrigin.NewGroup}_componentId(){return"SetConversationParticipantsPanel"}_getContentForSelectingPeople(){this._getContext().isPresentedInDesktopSubview;const e=(0,i.jsx)(C.default,{ref:this._onInviteSuggestionsListRef,conversationId:this.props.route.params.navigator.context.convId,inviteFlowController:this._inviteFlowController,searchController:this._searchController,peopleType:this.props.route.params.navigator.context.peopleType,filterPeopleType:this.props.route.params.navigator.context.filterPeopleType,excludeGroups:this.state.excludeGroups,excludeEncrypted:this.state.excludeEncrypted,excludeS4B:this.state.excludeS4B,isSingleContactSelect:!!this.props.route.params.navigator.context.isSingleContactSelect,navigationOrigin:this.props.route.params.navigator.context.navigationOrigin,parentPanelOrigin:this.state.panelSearchType,headerViewConfig:this._optionalSuperComposerHeaderConfig(),inputText:this.state.inputText,suppressPseudoFocus:!0,onScroll:this.props.route.params.isSuperComposer?this._onScroll:void 0}),t=[Y.contentContainerInner],s=[Y.suggestionsContainer],o=[Y.participantsInputContainer],n=this.props.route.params.isSuperComposer?void 0:(0,i.jsx)(R.default,{ref:this._onProfileSelectionInputRef,selectorController:this._inviteFlowController,searchController:this._searchController,headerConfig:this._headerConfig,allowSubmitWithNoProfile:!0,peopleType:this.props.route.params.navigator.context.peopleType,autoFocusOnInput:!r.UserInterface.isNavigatingWithKeyboard(),autoFocusWhenActive:!0,useCollapsableHeader:!1,inputText:this.state.inputText,onInputChanged:this._onInputChanged,onCancel:this._handleBackButtonClick,onProfileRemoved:this._onProfileRemoved},"peopleInput"),a=this.props.route.params.navigator.context.navigationOrigin===f.NavigationConversationOrigin.Recents&&this.state.enableNewConversationCreation?(0,i.jsx)(U.default,{shareLink:this.state.shareLink,onChange:this._onShareLinkToggleChange}):void 0,l=this.props.route.params.isSuperComposer?this._getHeader():void 0,d=this._getFooter(),{headerShadowColorStyle:c}=X.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),h=l?(0,i.jsx)(r.Animated.View,{style:[Y.headerShadow,c,this._shadowOpacityStyle]}):void 0;return(0,i.jsx)(r.View,Object.assign({style:G.default.flexOne},{children:(0,i.jsx)(r.View,Object.assign({style:t},{children:(0,i.jsx)(r.View,Object.assign({style:Y.participantsInputFrame},{children:(0,i.jsxs)(r.View,Object.assign({style:o},{children:[n,l,(0,i.jsxs)(r.View,Object.assign({style:s},{children:[e,h]})),a,d]}))}))}))}))}_optionalSuperComposerHeaderConfig(){if(this.props.route.params.isSuperComposer)return{renderItem:this._renderSuperComposerHeader,isNavigable:!0,isHoverable:!1,height:x.default.calculateHeight(this._newChatMenuCommands.length)}}_getHeaderText(e){let t="";switch(e.panelSearchType){case f.SearchResultsListOrigin.NewChat:case f.SearchResultsListOrigin.SuperComposer:t=M.getString("SetConversationParticipantsPanel.NewChatTitle");break;case f.SearchResultsListOrigin.NewPrivateChat:t=M.getString("SetConversationParticipantsPanel.NewPrivateChatTitle");break;case f.SearchResultsListOrigin.FindBots:t=M.getString("SetConversationParticipantsPanel.FindBotTitle");break;case f.SearchResultsListOrigin.NewGroup:t=M.getString("SetConversationParticipantsPanel.CreateNewGroupTitle");break;case f.SearchResultsListOrigin.AddingParticipantsToGroup:t=M.getString("SetConversationParticipantsPanel.AddPeopleTitle");break;case f.SearchResultsListOrigin.NewCellularSmsConversation:t=M.getString("SetConversationParticipantsPanel.CreateNewCellularSmsConversation");break;default:q.default.switchStatementExhaustiveChecking(e.panelSearchType)}return t}_getFooter(){const e=this._getHeaderRightButton();if(e)return(0,i.jsx)(j.default,{button:e})}_getHeaderLeftButton(){var e;const t=(null===(e=this.props.route.params.navigator.context.wizardSteps)||void 0===e?void 0:e[0])===k.WizardSteps.setConvParticipants;let s=H.CloseButtonType.Back;return(this.props.route.params.navigationDirection===W.StackNavigationDirection.Present||this.props.route.params.navigator.context.creating1on1Conversation||!this.state.isUsingStackNavigationContext&&t)&&(s=H.CloseButtonType.Close),{closeButtonType:s,onPress:this._handleBackButtonClick}}_getInvitedUserMris(){const e=this._inviteFlowController.getSelectedProfiles(),t=(0,c.chain)(e,(0,c.map)((e=>e.getMri())),(0,c.filter)((e=>!!e&&!I.default.isMyMri(e))));return(0,o.compact)(t)}_getInvitedUsersPhoneNumbersAsMris(){const e=this._inviteFlowController.getSelectedProfiles(),t=[],s=[];return e.forEach((e=>{const i=e.getMri();i&&(h.isPhoneMri(i)||h.getMriNamespace(i)===h.Namespaces.OneToOneTextMessage?t.push(i):s.push(i))})),K.default.getFullUserProfileByMrisAsync(s).then((e=>(e.forEach((e=>{if(e&&e.phones&&e.phones.length>0){const s=h.idAndNamespaceToMri(e.phones[0].number.toString(),h.Namespaces.PSTN);t.push(s)}})),t)))}_completeNextButtonClick(e){var t,s,i;if(null===(t=this.props.route.params.navigator.context.newGroupTelemetryScenario)||void 0===t||t.setParticipantCount(e.length),null===(i=(s=this.props.route.params.navigator.context).onParticipantsAdded)||void 0===i||i.call(s,e.length),this.state.panelSearchType===f.SearchResultsListOrigin.NewCellularSmsConversation&&0===e.length)return;this.props.route.params.navigator.extendContext({invitedUsersMris:e});(0,o.last)(this.props.route.params.navigator.context.wizardSteps)===k.WizardSteps.setConvParticipants&&this.setState({showLoadingMessage:!0,navButtonsDisabled:!0}),this.props.route.params.navigator.context.convId?this._inviteFlowController.sendConversationInvitation(this.props.route.params.navigator.context.convId,!this.state.isModeratedThread||!!this.props.route.params.navigator.context.addAsAdmininModeratedGroup):(this.props.route.params.navigator.context.shareLink=this.state.shareLink,this.props.route.params.navigator.goNext())}_setAnimatedValues(e,t){if(this._wrappedContentTransitionView){const s=r.Styles.createAnimatedViewStyle({opacity:e.interpolate({inputRange:[t-1,t,t+.5,t+1],outputRange:[1,1,0,0]}),transform:[{translateY:e.interpolate({inputRange:[t-1,t,t+1],outputRange:[0,0,-100]})}]});this._wrappedContentTransitionView.setAnimatedStyle(s)}}_clearAnimatedValues(){this._wrappedContentTransitionView&&this._wrappedContentTransitionView.setAnimatedStyle(this._resetSearchTransitionStyle)}}t.default=Z},286766:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(496486),r=s(244387),a=s(4736),l=s(75672),d=s(67930),c=s(226651),h=s(10102),u=s(803056),p=s(898278),g=s(185455),m=s(437490),S=s(746096),f=s(436237),y=s(710400),v=s(547126),C=s(915877),_=s(565752),b=s(733754),T=s(89808),M=s(330124),I=s(795691),w=s(616819),P=s(29130),k=s(451070),A=s(681115),x=s(886045),R=s(190631),O=s(316392),L=s(581760),F=s(311010),B=s(711828),D=s(734528),E=s(853374),V=s(897634),N=s(115340),U=(0,C.lazyProperties)({panel:()=>o.Styles.createViewStyle({position:"absolute",left:0,top:0,right:0,bottom:0,alignSelf:"stretch"}),panelContent:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",justifyContent:"center",flexDirection:"row"}),contentContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center"}),avatarPicker:()=>o.Styles.createButtonStyle({marginTop:20,alignSelf:"center"}),conversationNameInputContainer:()=>o.Styles.createViewStyle({backgroundColor:L.Color.transparent,borderBottomWidth:1,alignSelf:"stretch",borderStyle:"solid",marginHorizontal:40,marginTop:20}),conversationNameInputIOS:()=>o.Styles.createTextInputStyle({height:72}),conversationNameInput:()=>o.Styles.createTextInputStyle({alignSelf:"stretch",paddingVertical:16,backgroundColor:L.Color.transparent,textAlign:"center"}),nextButton:()=>o.Styles.createViewStyle({position:"absolute",bottom:10,right:10}),hiddenHeader:()=>o.Styles.createViewStyle({opacity:0})});class j extends d.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._goBack=e=>(f.log(S.LogTraceArea.Navigation,"SetConversationInfoPanel._goBack, causeId: "+e),this.props.route.params.navigator.goBack(),!0),this._onConversationNameActiveStateChange=e=>{e&&(0,n.delay)((()=>{var e;return null===(e=this._textInput)||void 0===e?void 0:e.requestFocus()}),300)},this._onAvatarSelected=(e,t)=>{var s;this._conversationImage=e,this._conversationImageUrl=t,null===(s=this.props.route.params.navigator.context.newGroupTelemetryScenario)||void 0===s||s.setAvatarSelection(!!e)},this._onAvatarRemoved=()=>{var e;this._conversationImage=void 0,null===(e=this.props.route.params.navigator.context.newGroupTelemetryScenario)||void 0===e||e.setAvatarSelection(!1)},this._onBackButtonClick=e=>{e.stopPropagation();const t=E.default.newCauseId();f.log(S.LogTraceArea.Navigation,"SetConversationInfoPanel._onBackButtonClick, causeId: "+t),this._goBack(t)},this._onConversationNameChanged=e=>{this.isComponentMounted()&&this.setState({conversationName:e})},this._onNextButtonClick=e=>{e.stopPropagation(),this._handleNext()},this._onKeyPress=e=>{e.keyCode!==v.default.ENTER&&e.keyCode!==v.default.RETURN||(e.stopPropagation(),this._handleNext())},this._onBeforeOpeningCameraOrPicker=()=>{m.dismissAll()},this._onTextInputRef=e=>{this._textInput=e||void 0}}static getHeaderText(e){return e?b.getString("Hub.NewModeratedGroupChatShortLabel"):b.getString("SetConversationInfoPanel.Title")}_buildState(e,t){var s;const i=this._getRootViewId(),o={isUsingStackNavigationContext:M.default.isUsingStackNavigationContext(),safeAreaHorizontalInsets:k.default.horizontalInsets(p.HorizontalInsetDefault),safeAreaBottomInset:k.default.bottomSafeAreaInset(),bigAvatarHelper:new c.default(i),isSmallDevice:P.default.isSmallDevice(i)};return t&&(o.conversationColor=T.default.getColorInfo(),o.conversationName=e.route.params.navigator.context.convName||"",this._conversationImage=e.route.params.navigator.context.convAvatar,this._conversationImageUrl=e.route.params.navigator.context.convAvatarUrl,o.showLoadingPanel=!1,null===(s=e.route.params.navigator.context.newGroupTelemetryScenario)||void 0===s||s.setVisitedSetConvInfoPanel()),o}render(){let e;if(this.state.showLoadingPanel){const t=this.props.route.params.navigator.context.convId?b.getString("SetConversationParticipantsPanel.AddingContactsToConversation"):b.getString("SetConversationParticipantsPanel.CreatingNewConversation");e=(0,i.jsx)(_.default,{message:t})}else e=this._getContent();const{primaryBackgroundColorStyle:t}=V.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return(0,i.jsx)(u.default,Object.assign({goBack:this._goBack},{children:(0,i.jsxs)(N.KeyboardAvoidingView,Object.assign({style:[U.panel,t]},{children:[this._getHeader(this.state.showLoadingPanel),e]}))}))}_componentId(){return"SetConversationInfoPanel"}_getHeader(e){return(0,i.jsx)(R.SimplePanelHeader,{style:e?U.hiddenHeader:void 0,blockPointerEvents:e,panelName:this._getHeaderText(this.state),leftButton:this._getHeaderLeftButton(),hideBottomBorder:!0})}_getHeaderText(e){return j.getHeaderText(this.props.route.params.navigator.context.navigationOrigin===S.NavigationConversationOrigin.NewModeratedGroup)}_getHeaderLeftButton(){var e;const t=(null===(e=this.props.route.params.navigator.context.wizardSteps)||void 0===e?void 0:e[0])===I.WizardSteps.setConvInfo&&this.props.route.params.navigationDirection!==O.StackNavigationDirection.Push&&(!this._getContext().isPresentedInDesktopSubview||this.props.route.params.isAloneInNavStack);return{closeButtonType:t?R.CloseButtonType.Close:R.CloseButtonType.Back,title:t?b.getString("Global.CloseButtonTitle"):b.getString("Global.BackButtonTitle"),onPress:this._onBackButtonClick}}_getContent(){const{dividerBorderColorStyle:e}=V.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),{secondaryTextColor:t}=V.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),s=V.currentTheme(this._getContext(),this.props.route.params.colorThemeOverride),n=[F.default.messagingHeaderFontStyle(!1,this.state.isSmallDevice,s),U.conversationNameInput],d=[U.conversationNameInputContainer,e],c=h.gradientColorsForColorInfo(this.state.conversationColor);let u;const p=[U.nextButton];A.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets)&&(u=A.default.horizontalPaddingStyle(this.state.safeAreaHorizontalInsets),d.push(u),p.push(o.Styles.createViewStyle({right:this.state.safeAreaHorizontalInsets.right},!1))),this.state.safeAreaBottomInset&&p.push(o.Styles.createViewStyle({bottom:this.state.safeAreaBottomInset},!1));const m=(0,i.jsx)(l.default,{style:[U.avatarPicker],onAvatarSelected:this._onAvatarSelected,onAvatarRemoved:this._onAvatarRemoved,iconSize:B.IconSize.size120,accessibilityLabel:b.getString("SetConversationInfoPanel.SelectGroupAvatarAccessibilityLabel"),onBeforeExecuteMenuCommand:this._onBeforeOpeningCameraOrPicker,initialAvatar:this._conversationImageUrl,showAltViewAsMediaIcon:!0,origin:S.AvatarPickerOrigin.ConversationInfoPanel}),f=B.IconSize.size120,y=b.getString("SetConversationInfoPanel.GroupConversationNameAccessibilityLabel",{conversationName:this.state.conversationName});return(0,i.jsxs)(o.View,Object.assign({style:U.panelContent},{children:[(0,i.jsxs)(o.View,Object.assign({style:U.contentContainer},{children:[(0,i.jsx)(w.default,Object.assign({backgroundHeight:f,gradientColors:c,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets},{children:this.state.bigAvatarHelper.maybeWrapAvatar(m)})),(0,i.jsx)(o.View,Object.assign({style:d},{children:(0,i.jsx)(r.default,{ref:this._onTextInputRef,autoFocusable:!0,style:n,placeholder:b.getString("SetConversationInfoPanel.ConversationNamePlaceHolder"),placeholderTextColor:t,onChangeText:this._onConversationNameChanged,onKeyPress:this._onKeyPress,value:this.state.conversationName,autoFocus:!x.default.isMobileScreenReaderEnabled(),accessibilityLabel:y,returnKeyType:"done",maxLength:g.MaximumGroupConversationNameLength,clearButtonMode:"never",blurOnSubmit:!0,onActiveStateChange:this._onConversationNameActiveStateChange})}))]})),(0,i.jsx)(a.default,{style:p,icon:D.forwardIcon(),title:b.getString("Global.NextButtonTitle"),disabled:!this._canGoNext(),onPress:this._onNextButtonClick,userColor:this.state.conversationColor})]}))}_handleNext(){var e;if(!this._canGoNext())return;y.default.immediatelyResetUpdateInfo(),null===(e=this._textInput)||void 0===e||e.blur();const t=E.default.escapeXml(this.state.conversationName);this.props.route.params.navigator.extendContext({convAvatar:this._conversationImage,convAvatarUrl:this._conversationImageUrl,convColor:this.state.conversationColor,convName:t}),this.props.route.params.navigator.goNext();(0,n.last)(this.props.route.params.navigator.context.wizardSteps)===I.WizardSteps.setConvInfo&&this.setState({showLoadingPanel:!0})}_canGoNext(){const{conversationName:e}=this.state;return!!e&&!/^\s*$/.test(e)}}t.default=j},358454:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(516778),n=s(67930),r=s(224112),a=s(746096),l=s(436237),d=s(861253),c=s(915877),h=s(733754),u=s(382677),p=s(346200),g=s(724067),m=s(33004),S=s(190631),f=s(853374),y=s(680837),v=(0,c.lazyProperties)({panel:()=>o.Styles.createViewStyle({alignSelf:"stretch"})});class C extends n.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._shouldDisableDone=e=>this._reactionsListChanged(e),this._updateTelemetryData=({toggledEmoticonCount:e,searchInitiatedCount:t})=>{this._searchTelemetryData={toggledEmoticonCount:e,searchInitiatedCount:t}},this._onDonePress=()=>{const e=this._getAddedReactions();l.track(new p.CustomReactionsManipulationTelemetry(p.CustomReactionsManipulationAction.ReactionsSavedOnDoneButton,{numberOfReactions:this.state.selectedReactions.length,numberOfAddedReactions:this.state.selectedReactions.length-this._initialSelectedReactions.length,customReactionsType:this.props.route.params.origin,numberOfAnimatedReactions:m.default.superAnimationReactionsNumber(e),searchData:this._searchTelemetryData})),this._reactionsStore.saveCurrentReactions(),this._closeCustomReactionPanel()},this._onClosePressed=()=>{l.track(new p.CustomReactionsManipulationTelemetry(p.CustomReactionsManipulationAction.ReactionsNotSavedOnCloseButton,{numberOfReactions:this.state.selectedReactions.length,numberOfNotSavedReactions:this.state.selectedReactions.length-this._initialSelectedReactions.length,customReactionsType:this.props.route.params.origin,searchData:this._searchTelemetryData})),this._reactionsStore.resetUnsavedReactions(),this._closeCustomReactionPanel()},this._closeCustomReactionPanel=()=>{const e=f.default.newCauseId();l.log(a.LogTraceArea.Navigation,"SimplePanelHeader.onPress, causeId: "+e),super._goBack(e)}}_buildState(e,t){this._reactionsStore=this._getReactionsStore(e.route.params.origin);const s=this._reactionsStore.getCurrentReactions();return t&&(this._initialSelectedReactions=s),{selectedReactions:s,isPackChanged:!t&&this._shouldDisableDone(s)}}_getReactionsStore(e){return u.getCustomReactionsStore(e)}render(){return(0,i.jsxs)(o.View,Object.assign({style:[y.default.flexOne,v.panel,this._getContext().themeStyles.primaryBackgroundColorStyle]},{children:[(0,i.jsx)(S.SimplePanelHeader,{panelName:this._getHeaderText(),leftButton:{closeButtonType:S.CloseButtonType.Close,onPress:this._onClosePressed}}),(0,i.jsx)(r.default,{origin:this.props.route.params.origin,updateTelemetryData:this._updateTelemetryData}),(0,i.jsx)(g.default,{button:this._getHeaderDoneButton()})]}))}_reactionsListChanged(e){return!!e.length&&!(0,d.default)(e,this._initialSelectedReactions)}_getHeaderDoneButton(){return{text:h.getString("Global.DoneButtonTitle"),accessibilityLabel:h.getString("Global.DoneButtonTitle"),disabled:!this.state.isPackChanged,onPress:this._onDonePress}}_getAddedReactions(){return this.state.selectedReactions.filter((e=>-1===this._initialSelectedReactions.indexOf(e)))}_getHeaderText(){return this._reactionsStore.getCustomReactionsModalTitle()}}t.default=C},767337:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(703577),n=s(516778),r=s(900515),a=s(996074),l=s(190631),d=s(915877),c=s(746096),h=s(812056),u=s(671830),p=s(436237),g=s(733754),m=s(734528),S=s(753559),f=s(5899),y=s(293194),v=s(680837),C=s(853374),_="Share",b="Forward",T=(0,d.lazyProperties)({stretch:()=>n.Styles.combine(n.Styles.createViewStyle({alignSelf:"stretch"}),v.default.flexOne)});class M extends a.BaseNavigationView{constructor(){super(...arguments),this._onRightButtonRef=e=>{this._rightButton=e||void 0},this._onSharePress=e=>{if(u.isEncryptedThread(this.props.route.params.message.conversationId))return void this._showShareMenu();const t={anchor:()=>this._rightButton,buttons:[{text:g.getString("Global.ForwardButton"),command:b},{text:g.getString("Global.ShareButton"),command:_}]};y.default.showWithActionMenuConfig({options:t,callback:this._handleShareCommands,maintainAnchor:!0,rootViewId:this._getRootViewId(),invokingEvent:e})},this._handleShareCommands=e=>{switch(e){case b:f.default.forwardDocument(this.props.route.params.message,h.MessageActionOrigin.DocumentViewer,this._getContext());break;case _:this._showShareMenu();case y.SXActionMenuCancel:}},this._showShareMenu=()=>{const e={url:this.props.route.params.fileUri};r.default.show(e,this._onShareError,this._onShareCallback)},this._onShareError=e=>{this._trackShare(e)},this._onShareCallback=()=>{this._trackShare()},this._onBackPress=()=>{const e=C.default.newCauseId();p.log(c.LogTraceArea.Navigation,"DocumentViewer._onBackPress,  causeId: "+e),this._goBack(e)}}render(){const e=(0,i.jsx)(n.View,Object.assign({style:v.default.flexOne},{children:(0,i.jsx)(o.default,{url:this.props.route.params.fileUri,style:T.stretch})}));return(0,i.jsxs)(n.View,Object.assign({style:T.stretch},{children:[this._getHeader(),e]}))}_getHeader(){const e={closeButtonType:l.CloseButtonType.Close,title:g.getString("Global.CloseButtonTitle"),onPress:this._onBackPress},t={icon:m.shareIcon(),title:g.getString("DocumentViewer.ShareButtonTitle"),onPress:this._onSharePress,setButtonRef:this._onRightButtonRef};return(0,i.jsx)(l.SimplePanelHeader,{panelName:this.props.route.params.fileName,leftButton:e,rightButtons:t})}_trackShare(e){const t=S.default.extractFileExtension(this.props.route.params.fileName);p.track(new h.ShareFileMessageTelemetry(this.props.route.params.message.conversationId,this.props.route.params.message,this.props.route.params.message.createdTime,h.MessageActionOrigin.DocumentViewer,h.MessageActionType.ShareFile,t,!1))}_getHeaderText(){}}t.default=M},331039:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(281878),n=s(705465),r=s(667294),a=s(709133),l=s(35566),d=s(423790),c=s(783294),h=s(619675),u=s(4736),p=s(711828),g=s(104735),m=s(853374),S=s(190631),f=s(258187),y=s(960621),v=n.StyleSheet.create({bottomControlsSingle:{justifyContent:"flex-start",position:"absolute",alignItems:"flex-start",bottom:0,right:0,paddingVertical:12,paddingHorizontal:12}});t.default=function(e){const[t,s]=(0,r.useState)({width:0,height:0}),n=(0,f.useCommonContext)();(0,r.useEffect)((()=>(a.default.hideKeyboardOnAndroidBackButton(!1),()=>a.default.hideKeyboardOnAndroidBackButton(!0))),[]);const C=e.route.params.gif,_=()=>{y.GifPreviewService.sendPes(e.route.params.gif);const t=m.default.newCauseId();g.default.goBack(t,n)},b=(0,i.jsx)(d.GifItem,{id:C.id,autoFocus:!0,info:C,src:C.asmImageProxy,isSelected:!0,isUsedForPreview:!0,renderMobileInterface:!0,onSelected:_,width:t.width,height:t.height,showPlaceholder:!0},C.id),T=c.getGifAttribution(),M=(0,i.jsx)(h.Subtitle,Object.assign({selectable:!0},{children:T})),I=(0,i.jsx)(u.default,{title:e.route.params.sendButtonTitle,onPress:_,icon:p.SkypeIcon.Send});return(0,i.jsxs)(o.Column,Object.assign({flex:1,mb:5},{children:[e.navigation?null:(0,i.jsx)(S.SimplePanelHeader,{leftButton:{closeButtonType:S.CloseButtonType.Close}}),(0,i.jsxs)(o.Box,Object.assign({flex:1,alignItems:"center",justifyContent:"center",onLayout:t=>{const i=e.route.params.gif,o=t.nativeEvent.layout,n=l.default.fitToContainer({width:i.full.width,height:i.full.height},{width:o.width-50,height:o.height-50});s({width:n.width,height:n.height})}},{children:[b,M]})),(0,i.jsx)(o.Box,Object.assign({style:v.bottomControlsSingle},{children:I}))]}))}},200235:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(996074),o=s(565752);t.default=(0,i.forNavigation)(o.default)},285320:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(823113),r=s(351444),a=s(482897),l=s(353448),d=s(516778),c=s(67930),h=s(619675),u=s(190631),p=s(581760),g=s(640392),m=s(711828),S=s(62523),f=s(915877),y=s(478262),v=s(746096),C=s(57175),_=s(746096),b=s(415963),T=s(898278),M=s(351077),I=s(497174),w=s(436237),P=s(733754),k=s(219784),A=s(803056),x=s(913944),R=s(110117),O=s(861253),L=s(546705),F=s(751176),B=s(89808),D=s(178735),E=s(18078),V=s(932226),N=s(581736),U=s(364956),j=s(785207),H=s(29130),z=s(886045),W=s(915415),G=s(680837),K=s(853374),q=s(104735),Q=6e4,X="permissionDenied",$="permissionGranted",J=(0,f.lazyProperties)({locationPicker:()=>(0,f.lazyProperties)({mapContainer:()=>d.Styles.createViewStyle({backgroundColor:p.Color.gray100})}),locationPickerPin:()=>(0,f.lazyProperties)({container:()=>d.Styles.createViewStyle({top:-g.CurrentLocationPinHeight/2,alignSelf:"stretch",alignItems:"center",justifyContent:"center"}),containerNonCurrentLocation:()=>d.Styles.createViewStyle({top:-g.NonCurrentLocationPinHeight/2}),containerSpinner:()=>d.Styles.createViewStyle({top:0}),pinContentAligment:()=>d.Styles.createViewStyle({justifyContent:"flex-end"}),currentLocationPinHeight:()=>d.Styles.createViewStyle({height:g.CurrentLocationPinHeight}),nonCurrentLocationPinHeight:()=>d.Styles.createViewStyle({height:g.NonCurrentLocationPinHeight}),goToMyLocationButton:()=>d.Styles.createButtonStyle({alignItems:"center",justifyContent:"center",position:"absolute",width:m.IconSize.default,height:m.IconSize.default,borderRadius:m.IconSize.default/2,bottom:12,right:12,backgroundColor:p.Color.gray400})}),map:()=>(0,f.lazyProperties)({mapStyle:()=>d.Styles.createViewStyle({flex:1,alignSelf:"stretch"})}),spinnerContainer:()=>d.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",backgroundColor:p.Color.transparent}),error:()=>(0,f.lazyProperties)({container:()=>d.Styles.createViewStyle({flex:1,backgroundColor:p.Color.gray100Overlay30,borderWidth:1,borderColor:p.Color.gray100Overlay30,borderStyle:"solid",alignItems:"center",justifyContent:"center"}),iconContainer:()=>d.Styles.createViewStyle({flex:1,opacity:.15,alignItems:"center",marginBottom:30,justifyContent:"flex-end"}),textStyle:()=>d.Styles.createTextStyle({flex:1,paddingHorizontal:16,textAlignVertical:"top",textAlign:"center",alignItems:"center",justifyContent:"center"})})});class Y extends c.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._mapViewRef=e=>{this._mapView=e},this._onSearchClick=()=>{if(!this.state.currentSelectedLocation)return;const{latitude:e,longitude:t}=this.state.currentSelectedLocation;q.default.navigateToNearByPlaces({latitude:e,longitude:t,locationType:this.state.locationType,onNearByPlaceSelect:this._onNearByPlaceSelect}),w.track(new L.LocationPickerSearchStart(this.state.locationType))},this._onMapPanelLayout=e=>{this.isComponentMounted()&&e.height!==this.state.mapViewHeight&&this.setState({mapViewHeight:e.height}),this.state.isPermissionUnknown&&!this.state.isChild&&N.default.requestPermission(y.PermissionType.Location,y.PermissionPromptOptions.SkipPrePrompt)},this._onNearByPlaceSelect=e=>{const t={latitude:e.latitude,longitude:e.longitude,latitudeDelta:this.state.currentSelectedLocation?this.state.currentSelectedLocation.latitudeDelta:0,longitudeDelta:this.state.currentSelectedLocation?this.state.currentSelectedLocation.longitudeDelta:0};this.setState({animatingPlace:e,animatingLocation:t,animatingLocationType:y.LocationType.Search}),w.track(new L.LocationPickerNearbyClicked(y.LocationType.Search))},this._onGoToMyLocation=()=>{this._refreshUserLocation("goToMyLocationButton",!1,Q,!0)},this._onRegionChangeComplete=e=>{if(!this.state.initialRegionChangeComplete)return void(this.isComponentMounted()&&this.setState({initialRegionChangeComplete:!0}));if(this.state.animatingLocationType)return;if(this.state.currentSelectedLocation&&Y._linearDistanceBetweenCoordinates(e.latitude,e.longitude,this.state.currentSelectedLocation.latitude,this.state.currentSelectedLocation.longitude,"km")<=.01)return;let t=-1,s=!1;this.state.currentUserLocation&&(t=Y._linearDistanceBetweenCoordinates(e.latitude,e.longitude,this.state.currentUserLocation.latitude,this.state.currentUserLocation.longitude,"km"),s=t<=.1),this.isComponentMounted()&&this.setState({locationType:s?y.LocationType.Current:y.LocationType.Custom,currentSelectedLocation:e})},this._onClose=()=>{this._goBack(K.default.newCauseId())},this._onSendPress=(e,t,s)=>{const i=K.default.newCauseId();w.log(v.LogTraceArea.LocationPicker,"LocationPicker._onSendPress causeId: "+i);let n=t;n||(n=P.getString("LocationPicker.LocationSharedFallback"));const r=this._getShownLocation(),l=new I.GeoLocationEntity(this.state.locationType===y.LocationType.Current,E.default.getSkypeMri(),r?r.latitude:void 0,r?r.longitude:void 0,void 0,(new Date).getTime(),a.default.getDefaultId(),void 0,P.getLocale(),P.getLanguageFromLocale(),n,void 0,void 0,e,s,r?[new I.LinkEntity(n,F.default.getBingMapsLocationUrl(r,e))]:void 0);j.default.postMessageFromInput(this.props.route.params.conversationId,_.PostSource.LocationPicker,[l],M.MessageTypes.Location,{name:b.ScenarioName.SendLocation}),w.track(new L.LocationPickerSend(this.state.locationType)),z.default.maybeAnnounceForAccessibility(P.getString("LocationPicker.LocationSent")),z.default.isMobileScreenReaderEnabled()?(0,o.delay)((()=>this._goBack(i)),1e3):this._goBack(i)},this._goBack=e=>(w.log(v.LogTraceArea.Navigation,"LocationPicker._goBack causeId: "+e),w.track(new L.LocationPickerNavigationClose(this.state.locationType)),super._goBack(e))}_buildState(e,t){var s;const i=null===(s=D.default.getUserPreferencesLocal().msaProfileKey)||void 0===s?void 0:s.ageGroup,o=C.MsaProfileHelper.isChild(i),r=F.default.getLocationPermissionStatus(y.PermissionType.Location),a=this._getRootViewId(),l={isPermissionUnavailable:r===n.PermissionStatus.Unavailable,isPermissionDenied:r===n.PermissionStatus.Denied,isPermissionUnknown:r===n.PermissionStatus.Unknown,isPermissionGranted:r===n.PermissionStatus.Granted,deviceOrientation:H.default.getDeviceOrientation(a),screenHeight:H.default.getHeight(a),isConnected:V.default.isConnected(),isChild:o};return t&&(l.locationType=y.LocationType.None),l}componentDidMount(){super.componentDidMount(),this.state.isConnected&&(this.state.isPermissionDenied&&(w.track(new L.LocationPickerPermissionsChanged(this.state.locationType,"none",X)),U.default.showDeniedPromptWithSettingsOption(y.PermissionType.Location,this._getRootViewId())),this._refreshUserLocation("componentDidMount",!1,Q,!0)),w.track(new L.LocationPickerNavigationOpen(this.state.locationType))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.isConnected&&(!t.isPermissionDenied&&this.state.isPermissionDenied&&(w.track(new L.LocationPickerPermissionsChanged(this.state.locationType,$,X)),U.default.showDeniedPromptWithSettingsOption(y.PermissionType.Location,this._getRootViewId())),(t.isPermissionDenied&&!this.state.isPermissionDenied&&!this.state.isPermissionUnknown||t.isPermissionUnknown&&!this.state.isPermissionUnknown&&!this.state.isPermissionDenied)&&(w.track(new L.LocationPickerPermissionsChanged(this.state.locationType,X,$)),this._refreshUserLocation("componentDidUpdate",!1,Q,!0)));const i=this.state.initialRegionChangeComplete&&!t.initialRegionChangeComplete,o=!(0,O.default)(this.state.animatingLocation,t.animatingLocation)&&this.state.initialRegionChangeComplete;if(this.state.animatingLocationType&&(o||i)){if(!this.state.animatingLocation)return;const e=this.state.initialLocationFetchComplete?750:1500;this._animateToRegion(this.state.animatingLocation,e)}}_refreshUserLocation(e,t=!0,s=6e4,i=!1){const o=!0;if(this.state.isPermissionGranted){t&&this.isComponentMounted()&&this.setState({isLoadingLocation:!0});const n=(new Date).getTime();l.default.getCurrentPosition({maximumAge:0,enableHighAccuracy:o,timeout:s}).then((t=>{const s=this.isComponentMounted(),r=(new Date).getTime();if(w.track(new L.LocationPickerGeolocationFetched(y.LocationType.Current,e,o,s,r-n)),s){const e={latitude:t.coords.latitude,longitude:t.coords.longitude,latitudeDelta:S.LatitudeDelta,longitudeDelta:S.LongitudeDelta};i?this.setState({animatingLocation:e,animatingLocationType:y.LocationType.Current}):this.setState({locationType:y.LocationType.Current,currentUserLocation:e,currentSelectedLocation:e,isLoadingLocation:!1})}})).catch((t=>{w.warn(v.LogTraceArea.LocationPicker,"Was not possible to get the location; Error:"+t.message+";Code:"+t.code);const s=this.isComponentMounted(),i=(new Date).getTime();throw w.track(new L.LocationPickerGeolocationFetchedFailed(this.state.locationType,e,o,s,i-n,t.code===t.TIMEOUT,t.code===t.PERMISSION_DENIED,t.code===t.POSITION_UNAVAILABLE)),k.default.showOKAlert(P.getString("LocationPicker.UnableToFetchLocationTitle"),P.getString("LocationPicker.UnableToFetchLocationMessage"),this._getRootViewId()),s&&this.setState({isPermissionDenied:t.code===t.PERMISSION_DENIED,isLoadingLocation:!1}),t}))}}isNavigatingAwayOnPress(){return!0}render(){if(!this.state.isConnected)return(0,i.jsx)(A.default,Object.assign({goBack:this._goBack},{children:this._getPickerErrorScreen(m.SkypeIcon.EmoticonNotPresent,P.getString("LocationPicker.NoConnection"))}));const e=this._getHeaderElement(),t=this._getMapOverlay(),s=(0,i.jsx)(r.MapView,{ref:this._mapViewRef,showsMyLocationButton:!1,region:this.state.animatingLocationType?void 0:this.state.currentSelectedLocation,rotateEnabled:!1,onRegionChangeComplete:this._onRegionChangeComplete,style:J.map.mapStyle,showsUserLocation:!this.state.isLoadingLocation});return(0,i.jsx)(A.default,Object.assign({goBack:this._goBack},{children:(0,i.jsxs)(d.View,Object.assign({style:G.default.flexOne},{children:[e,(0,i.jsxs)(d.View,Object.assign({style:[G.default.flexOne,J.locationPicker.mapContainer],onLayout:this._onMapPanelLayout},{children:[s,t]}))]}))}))}_getMapOverlay(){if(!this.state.mapViewHeight)return null;const e=this.state.isPermissionGranted?(0,i.jsx)(d.View,Object.assign({style:J.locationPickerPin.goToMyLocationButton},{children:(0,i.jsx)(x.default,{title:P.getString("AccessibilityLabel.MyLocation"),size:m.IconSize.size24,onPress:this._onGoToMyLocation,color:p.Color.white,hoverColor:p.Color.whiteOverlay70,icon:m.SkypeIcon.MyLocation,activeOpacity:.6})}),"goToMyLocationButton"):void 0;let t;const s=[G.default.absoluteFill,J.locationPickerPin.container,this._getHeightStyle(this.state.mapViewHeight)];if(this.state.isLoadingLocation)s.push(J.locationPickerPin.containerSpinner),t=(0,i.jsx)(d.View,Object.assign({style:[J.spinnerContainer,G.default.absoluteFill]},{children:(0,i.jsx)(W.default,{size:T.SXActivityIndicatorSize.Medium,tintColor:B.default.getPrimaryColorNoSubscription()})}));else if(this._getShownLocation()){const e=this.state.locationType===y.LocationType.Current;let o;e||s.push(J.locationPickerPin.containerNonCurrentLocation);const n=this._getShownPlace(),r=this._getShownLocation();n&&r&&n.latitude===r.latitude&&n.longitude===r.longitude&&(o={addressFriendlyName:n.name,address:n.address}),t=(0,i.jsx)(g.LocationPickerPin,{style:[J.locationPickerPin.pinContentAligment,e?J.locationPickerPin.currentLocationPinHeight:J.locationPickerPin.nonCurrentLocationPinHeight],location:this.state.currentSelectedLocation,userMri:E.default.getSkypeMri(),overrideAddress:o,locationType:this.state.locationType,hideLocationPin:this.state.locationType===y.LocationType.Current,showSendPopover:!0,onPressPopupOver:this._onSendPress})}return(0,i.jsxs)(d.View,Object.assign({style:G.default.absoluteFill,ignorePointerEvents:!0},{children:[(0,i.jsx)(d.View,Object.assign({style:s,ignorePointerEvents:!0},{children:t})),e]}))}_getShownLocation(){return this.state.animatingLocation||this.state.currentSelectedLocation}_getShownPlace(){return this.state.animatingPlace||this.state.selectedPlace}_animateToRegion(e,t){this._mapView?this._mapView.animateToRegion(e,t).then((()=>{this.isComponentMounted()&&(this._completeAnimation(),!this.state.initialLocationFetchComplete&&this.isComponentMounted()&&this.setState({initialLocationFetchComplete:!0}))})).catch((e=>{w.warn(v.LogTraceArea.LocationPicker,"Animation was not completed",e),this.isComponentMounted()&&this._completeAnimation()})):w.warn(v.LogTraceArea.LocationPicker,"unable to animate to selected location since map is null")}_getHeightStyle(e){let t=Y._cachedHeightStyles[e];return t||(t=d.Styles.createViewStyle({height:e}),Y._cachedHeightStyles[e]=t),t}_getHeaderElement(){return(0,i.jsx)(u.SimplePanelHeader,{panelName:P.getString("LocationPicker.SendLocation"),leftButton:this._getHeaderLeftButton(),rightButtons:this._getHeaderRightButton(),hideBottomBorder:!0})}_getHeaderLeftButton(){return{closeButtonType:u.CloseButtonType.Close,title:P.getString("Global.CloseButtonTitle"),onPress:this._onClose}}_getHeaderRightButton(){return this.state.currentSelectedLocation?{icon:m.SkypeIcon.Search,title:P.getString("LocationPicker.SearchPlacesPlaceholder"),onPress:this._onSearchClick}:void 0}static _linearDistanceBetweenCoordinates(e,t,s,i,o){const n=Math.PI*e/180,r=Math.PI*s/180,a=t-i,l=Math.PI*a/180;let d=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos(l);return d=Math.acos(d),d=180*d/Math.PI,d=60*d*1.1515,"km"===o&&(d*=1.609344),d}_completeAnimation(){switch(this.state.animatingLocationType){case y.LocationType.NearBy:case y.LocationType.Search:this.isComponentMounted()&&this.setState({selectedPlace:this.state.animatingPlace,currentSelectedLocation:this.state.animatingLocation,locationType:this.state.animatingLocationType,animatingLocation:void 0,animatingPlace:void 0,animatingLocationType:void 0});break;case y.LocationType.Current:this.isComponentMounted()&&this.setState({locationType:y.LocationType.Current,currentUserLocation:this.state.animatingLocation,currentSelectedLocation:this.state.animatingLocation,isLoadingLocation:!1,animatingLocation:void 0,animatingPlace:void 0,animatingLocationType:void 0});break;default:w.warn(v.LogTraceArea.LocationPicker,"No state change for "+this.state.locationType+"is defined")}}_getPickerErrorScreen(e,t){return(0,i.jsxs)(d.View,Object.assign({style:G.default.flexOne},{children:[this._getHeaderElement(),(0,i.jsxs)(d.View,Object.assign({style:J.error.container},{children:[(0,i.jsx)(d.View,Object.assign({style:J.error.iconContainer},{children:(0,i.jsx)(R.default,{icon:e,size:m.IconSize.size80,color:p.Color.gray300})})),(0,i.jsx)(h.BodyText,Object.assign({style:J.error.textStyle,textThemeColor:h.TextThemeColor.Secondary},{children:t}))]}))]}))}_getHeaderText(e){}}Y._cachedHeightStyles={},t.default=Y},678054:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLocationViewerNavigationHeaderTitle=void 0;const i=s(785893),o=s(823113),n=s(351444),r=s(516778),a=s(67930),l=s(952262),d=s(746096),c=s(436237),h=s(915877),u=s(733754),p=s(62523),g=s(751176),m=s(640392),S=s(546705),f=s(812056),y=s(18078),v=s(5899),C=s(190631),_=s(293194),b=s(581760),T=s(640363),M=s(734528),I=s(478262),w=s(626712),P=s(853374),k=s(400451),A=s(680837),x="OpenInMaps",R="OpenInGoogleMaps",O="Copy",L="Forward",F=(0,h.lazyProperties)({panel:()=>r.Styles.createViewStyle({alignSelf:"stretch"}),mapContainer:()=>r.Styles.createViewStyle({backgroundColor:b.Color.gray100})});class B extends a.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._onShareIconRef=e=>{this._shareIconButton=e||void 0},this._onShare=e=>{const t={anchor:()=>this._shareIconButton,message:this.props.route.params.fullAddress,buttons:[{text:u.getString("LocationPicker.Copy"),command:O},{text:u.getString("LocationPicker.ShareCommandForward"),command:L}]};_.default.showWithActionMenuConfig({options:t,callback:this._handleShareCommands,rootViewId:this._getRootViewId(),invokingEvent:e})},this._handleShareCommands=e=>{switch(e){case L:v.default.shareLocation(this.props.route.params.message,f.MessageActionOrigin.LocationViewer,this._getContext());break;case O:k.default.writeText(this.props.route.params.fullAddress),c.track(new f.MessageActionTelemetry(this.props.route.params.message.conversationId,this.props.route.params.message,this.props.route.params.message.createdTime,f.MessageActionOrigin.LocationViewer,f.MessageActionType.Copy));case _.SXActionMenuCancel:}},this._onClose=()=>{const e=P.default.newCauseId();c.log(d.LogTraceArea.Navigation,"LocationViewer._onClose causeId: "+e),this._goBack(e)},this._onPinPress=e=>{const t={anchor:()=>this._locationPickerPin,buttons:[]};T.default.getPlatformType()===d.PlatformType.iOS&&t.buttons.push({text:u.getString("LocationPicker.OpenInMaps"),command:x}),t.buttons.push({text:u.getString("LocationPicker.OpenInGoogleMaps"),command:R}),_.default.showWithActionMenuConfig({options:t,callback:this._handleGetDirectionsCommands,rootViewId:this._getRootViewId(),invokingEvent:e})},this._handleGetDirectionsCommands=e=>{switch(e){case x:let e;e=this.props.route.params.addressFriendlyName?{q:encodeURIComponent(this.props.route.params.addressFriendlyName),ll:this._getLatLongString()}:this.props.route.params.shortAddress?{q:encodeURIComponent(this.props.route.params.shortAddress),ll:this._getLatLongString()}:{q:this._getLatLongString()},r.Linking.openUrl(w.default.addUrlParameters("https://maps.apple.com",e)),c.track(new S.LocationViewerOpenMaps);break;case R:let t;t=this.props.route.params.addressFriendlyName?{q:encodeURIComponent(this.props.route.params.addressFriendlyName),center:this._getLatLongString()}:this.props.route.params.shortAddress?{q:encodeURIComponent(this.props.route.params.shortAddress),center:this._getLatLongString()}:{q:this._getLatLongString()},r.Linking.openUrl(w.default.addUrlParameters("https://maps.google.com/maps",t)),c.track(new S.LocationViewerOpenGoogleMaps);case _.SXActionMenuCancel:}},this._onLocationPickerPinRef=e=>{this._locationPickerPin=e||void 0}}_buildState(e){const t=g.default.getLocationPermissionStatus(I.PermissionType.Location),s={postedByCurrentUser:y.default.isMyMri(e.route.params.userMri),region:{latitude:e.route.params.latitude,longitude:e.route.params.longitude,latitudeDelta:p.LongitudeDelta,longitudeDelta:p.LatitudeDelta},isPermissionGranted:t===o.PermissionStatus.Granted};return s.postedByCurrentUser||(s.senderName=l.default.getDisplayableProfile(e.route.params.userMri).getShortName()),s}render(){const e=this.props.route.params.isUserLocation?m.CurrentLocationPinHeight:m.NonCurrentLocationPinHeight;return(0,i.jsxs)(r.View,Object.assign({style:[A.default.flexOne,F.panel]},{children:[this.props.navigation?void 0:this._getHeader(),(0,i.jsx)(r.View,Object.assign({style:[A.default.flexOne,F.mapContainer]},{children:(0,i.jsx)(n.MapView,Object.assign({region:this.state.region,style:[A.default.flexOne,F.panel],rotateEnabled:!1,showsUserLocation:this.state.isPermissionGranted,loadingIndicatorColor:b.Color.blue,showsMyLocationButton:!1},{children:(0,i.jsx)(n.MapMarker,Object.assign({centerOffset:{y:-e/2,x:0},coordinate:this.state.region,onPress:this._onPinPress},{children:(0,i.jsx)(m.LocationPickerPin,{ref:this._onLocationPickerPinRef,conversationId:this.props.route.params.message.conversationId,userMri:this.props.route.params.userMri,locationType:this.props.route.params.isUserLocation?I.LocationType.Current:I.LocationType.None,overrideAddress:{addressFriendlyName:this.props.route.params.addressFriendlyName||"",address:this.props.route.params.shortAddress||""},showViewerPopover:!0})}))}),"map-view")}))]}))}_getHeader(){let e="";return this.props.route.params.isUserLocation?this.state.postedByCurrentUser?e=u.getString("LocationPicker.SharedCurrentLocationYou"):this.state.senderName&&(e=u.getString("LocationPicker.SharedCurrentLocation",{userName:this.state.senderName})):this.state.postedByCurrentUser?e=u.getString("LocationPicker.SharedByYou"):this.state.senderName&&(e=u.getString("LocationPicker.SharedLocation",{userName:this.state.senderName})),(0,i.jsx)(C.SimplePanelHeader,{panelName:e,leftButton:this._getHeaderLeftButton(),rightButtons:this._getHeaderRightButton(),hideBottomBorder:!0})}_getHeaderLeftButton(){return{closeButtonType:C.CloseButtonType.Close,title:u.getString("Global.BackButtonTitle"),onPress:this._onClose}}_getHeaderRightButton(){return{icon:M.shareIcon(),title:u.getString("LocationPicker.ShareButtonTitle"),onPress:this._onShare,setButtonRef:this._onShareIconRef}}_getLatLongString(){return this.props.route.params.latitude+","+this.props.route.params.longitude}_getHeaderText(e){}}t.default=B,t.getLocationViewerNavigationHeaderTitle=function(e){let t="";return e.isUserLocation?e.postedByCurrentUser?t=u.getString("LocationPicker.SharedCurrentLocationYou"):e.senderName&&(t=u.getString("LocationPicker.SharedCurrentLocation",{userName:e.senderName})):e.postedByCurrentUser?t=u.getString("LocationPicker.SharedByYou"):e.senderName&&(t=u.getString("LocationPicker.SharedLocation",{userName:e.senderName})),t}},281984:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(667294),n=s(516778),r=s(680837),a=s(258187),l=s(104735),d=s(752754),c=s(853374),h=s(913168);t.default=e=>{const{latitude:t,longitude:s,locationType:u,onNearByPlaceSelect:p}=e.route.params,g=(0,a.useCommonContext)(),[m,S]=(0,o.useState)(),f=(0,o.useCallback)((e=>{S(e)}),[]),y=(0,o.useCallback)((()=>{l.default.goBack(c.default.newCauseId(),g)}),[g]),v=(0,o.useCallback)((e=>{l.default.goBack(c.default.newCauseId(),g),p(e)}),[g,p]);return(0,i.jsxs)(n.View,Object.assign({style:r.default.absoluteFill},{children:[(0,i.jsx)(d.default,{initialValue:0,blurOnSubmit:!0,rawSearchQuery:m,onInputTextChange:f,cancelSearch:y},"searchInputControl"),(0,i.jsx)(n.View,Object.assign({style:r.default.flexOne},{children:(0,i.jsx)(h.default,{locationType:u,style:r.default.flexOne,query:m,searchModeOn:!0,latitude:t,longitude:s,onItemSelected:v})}))]}))}},48286:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLocationViewerNavigationHeaderTitle=t.NearByPlacesNavigation=t.LocationViewerNavigation=t.LocationPickerNavigation=void 0;var i=s(285320);Object.defineProperty(t,"LocationPickerNavigation",{enumerable:!0,get:function(){return i.default}});var o=s(678054);Object.defineProperty(t,"LocationViewerNavigation",{enumerable:!0,get:function(){return o.default}});var n=s(281984);Object.defineProperty(t,"NearByPlacesNavigation",{enumerable:!0,get:function(){return n.default}});var r=s(678054);Object.defineProperty(t,"getLocationViewerNavigationHeaderTitle",{enumerable:!0,get:function(){return r.getLocationViewerNavigationHeaderTitle}})},335276:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(996074),o=s(572071);t.default=(0,i.forNavigation)(o.default)},788755:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(996074),o=s(5795);t.default=(0,i.forNavigation)(o.default)},254399:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(496486),n=s(583367),r=s(665768),a=s(516778),l=s(809206),d=s(281878),c=s(705465),h=s(1706),u=s(889391),p=s(996074),g=s(994224),m=s(480200),S=s(905531),f=s(314920),y=s(614980),v=s(671830),C=s(911009),_=s(147204),b=s(898278),T=s(400984),M=s(149748),I=s(625728),w=s(329241),P=s(539549),k=s(196060),A=s(437490),x=s(952262),R=s(746096),O=s(245381),L=s(211375),F=s(609112),B=s(805581),D=s(766649),E=s(436237),V=s(710400),N=s(915877),U=s(518460),j=s(733754),H=s(206286),z=s(757236),W=s(673319),G=s(663328),K=s(94060),q=s(748443),Q=s(323005),X=s(953189),$=s(798603),J=s(635762),Y=s(10909),Z=s(463189),ee=s(540897),te=s(130886),se=s(89808),ie=s(445026),oe=s(104735),ne=s(217093),re=s(827357),ae=s(960621),le=s(758962),de=s(29130),ce=s(914976),he=s(451070),ue=s(681115),pe=s(886045),ge=s(170919),me=s(788361),Se=s(144487),fe=s(126978),ye=s(680837),ve=s(360305),Ce=s(794050),_e=s(912770),be=s(863066),Te=s(267096),Me=s(172758),Ie=s(853374),we=s(73877),Pe=s(115340),ke=s(340395),Ae=s(879015),xe=s(846116),Re="mojiPreviewDialog",Oe=(0,N.lazyProperties)({contentPanelContents:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),container:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),contentPanelLowerContents:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"stretch"}),fillParent:()=>ye.default.absoluteFill,contentWrapper:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch"})});class Le extends p.BaseNavigationView{constructor(){super(...arguments),this._virtualStreamRefCount=0,this._miniToastKey=o.uniqueId("MobileContentPanel"),this._innerMovingContainerSelectMessagesHeader=new a.Animated.Value(0),this._innerMovingContainerSelectMessagesActions=new a.Animated.Value(0),this._searchStore=new w.default,this._coachMarkContext={coachMarkArea:C.CoachMarkAreaType.Conversation},this._onMojiPreviewClosed=()=>{this.isComponentMounted()&&this.setState({mojiPreview:void 0})},this._onMessagePanelRef=e=>{this._messagePanel=e||void 0},this._onMessageComposerOverflowRef=e=>{this._messageComposerOverflow=e||void 0},this._onShowOverflow=(e,t,s)=>{this.isComponentMounted()&&this._messageComposerOverflow&&this.setState({overflowMenuVisible:e},(()=>{this.isComponentMounted()&&(e?(E.track(new W.MessageOverflowEvent(W.MessageOverflowAction.MessageOverflowOpenButtonClicked)),this._messageComposerOverflow&&this._messageComposerOverflow.showOrHide(!0,t,s,(()=>{_e.default.setTimeout((()=>{A.dismissAll()}),20)}))):(E.track(new W.MessageOverflowEvent(W.MessageOverflowAction.MessageOverflowMinimized)),this._messageComposerOverflow&&this._messageComposerOverflow.showOrHide(!1,t,s),this._openFindPanelScenario&&this._openFindPanelScenario.hasStarted()&&!this._openFindPanelScenario.isResolved()&&(this._openFindPanelScenario.finish(),this._openFindPanelScenario=void 0)))}))},this._onMojiPreviewOpened=e=>{if(this.isComponentMounted()&&(this.setState({mojiPreview:e}),this.state.deviceOrientation===n.DeviceOrientation.Landscape)){ee.default.deactivatePicker(),A.dismissAll();const t=(0,i.jsx)(te.MojiPreview,{moji:e,onClose:this._onMojiPreviewCloseButtonPressed,onSend:this._onMojiSend,useFullScreen:!0,useTransparentDarkTheme:!0,showSendButton:!0,sendButtonTitle:j.getString("Moji.SendButtonTitle"),showReplayOnMojiAfterPlay:!0,setAccessibilityFocusOnMoji:!0});_.default.dismissModal(Re,this._getRootViewId()),_.default.showModal(t,Re,{rootViewId:this._getRootViewId()})}},this._onMojiPreviewCloseButtonPressed=()=>{ae.MojiPreviewService.closePesPreview(),this.state.deviceOrientation===n.DeviceOrientation.Landscape&&(_.default.dismissModal(Re,this._getRootViewId()),ee.default.activatePicker(le.TabType.Moji))},this._onMojiSend=()=>{this.state.mojiPreview&&ae.MojiPreviewService.sendPes(this.state.mojiPreview),ae.MojiPreviewService.closePesPreview(),this.state.deviceOrientation===n.DeviceOrientation.Landscape&&(ee.default.deactivatePicker(),_.default.dismissModal(Re,this._getRootViewId()))},this._onCloseMessageSearchPanel=()=>{this._searchStore.cancelSearch(),this._messageSearchPanel&&(this._trackSearchClosed(ge.MessageSearchToggleOrigin.CancelButton),L.setFocusWithDelay(L.FocusEvent.CloseMobileSearchInConversation,250))},this._onMessageSearchPanelRef=e=>{this._messageSearchPanel=e||void 0},this._onChatTabLayout=e=>{q.default.updateTopOffset(e.y)},this._headerOnLayout=e=>{this.state.headerHeightAndroid!==e.height&&this.setState({headerHeightAndroid:e.height})},this._onInteracted=()=>{this.state.shouldFlattenNavOnInteraction&&this.isComponentMounted()&&(this.state.onTopOfNavStack?oe.default.flattenNavStack():oe.default.reduceNavStack([ne.SearchNavigationId,ne.AlertsHubNavigationId]),this.setState({shouldFlattenNavOnInteraction:!1}))},this._launchCamera=()=>{A.dismissAll(),y.navigateToCaptureComboModalWithParams({capturedContentHandler:new f.CapturedContentHandlerForPosting(this.props.route.params.conversationId),conversationId:this.props.route.params.conversationId,allowVideo:!0,mediaPickerShouldCollapseFully:!0,showCoachmarksIfNeeded:!0,allowMultiple:this._isMediaPreviewEnabled(),allowOfficeLens:!0,onSendFlowComplete:this._onCameraSendFlowComplete},this._getContext())},this._onCallStartedAnsweredOrJoinedViaContentPanelHeader=()=>{this._blurStream()},this._onShowGestureHint=e=>{this.isComponentMounted()&&this.setState({toolTipInfo:e})},this._onDismissPopup=()=>{this.isComponentMounted()&&this.state.toolTipInfo&&this.setState({toolTipInfo:void 0})},this._onCloseSelectMessagesPanel=(e,t)=>{if(!this.isComponentMounted())return;this.setState({currentSelectMessagesUIState:k.SelectMessagesUIState.Closing});const s=[ie.default.timing(this._innerMovingContainerSelectMessagesHeader,{toValue:e,duration:r.Common.Duration.Default,easing:r.Easing.SkypeExpoIn5,useNativeDriver:!0}),ie.default.timing(this._innerMovingContainerSelectMessagesActions,{toValue:t,duration:r.Common.Duration.Default,easing:r.Easing.SkypeExpoIn5,useNativeDriver:!0})];a.Animated.parallel(s).start((e=>{e.finished&&this.isComponentMounted()&&this.setState({currentSelectMessagesUIState:k.SelectMessagesUIState.Deactive})}))},this._isMediaPreviewEnabled=()=>this.props.route.params.conversationId&&H.default.isMediaPreviewEnabled(this.props.route.params.conversationId),this._trackSearchClosed=e=>{this._messageSearchPanel&&(E.track(new J.ClosedSearch(e,this._messageSearchPanel.didUserSearch(),this._messageSearchPanel.getLastSearchResultsCount(),this._messageSearchPanel.getNumberOfRequests())),this._messageSearchPanel.resetTelemetryParams())},this._onCameraSendFlowComplete=()=>{pe.default.maybeAnnounceForAccessibility(j.getString("MessageComposer.FileSentLabel"))}}_componentId(){return"MobileContentPanel"}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.route.params.conversationId!==this.props.route.params.conversationId&&this._virtualStreamRefCount++,this._searchStore.setTimestamp(e.route.params.scrollToTimestamp)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this._messagePanel&&this.state.onTopOfNavStack&&!t.onTopOfNavStack&&this._messagePanel.onNavigateAway(),this.state.deviceOrientation!==t.deviceOrientation&&(ae.MojiPreviewService.closePesPreview(),_.default.dismissModal(Re,this._getRootViewId()))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.onTopOfNavStack!==t.onTopOfNavStack&&(this.state.onTopOfNavStack?(Y.default.addOrUpdateBottomMargin(this._miniToastKey,60),_e.default.setTimeout((()=>{this._focusStreamForAccessibility(this.state)}),100)):Y.default.removeBottomMargin(this._miniToastKey)),this.state.isKeyboardShown!==t.isKeyboardShown&&E.log(R.LogTraceArea.ContentPanel,"[MobileContentPanel] componentDidUpdate isKeyboardShown: "+this.state.isKeyboardShown)}componentDidMount(){super.componentDidMount(),this._searchStore.setTimestamp(this.props.route.params.scrollToTimestamp),this._focusMessageComposerToken=Z.default.focusMessageComposerEvent().subscribe((e=>{E.log(R.LogTraceArea.ContentPanel,"[MobileContentPanel] focusMessageComposerEvent, focus: "+e),e?this._focusStream(this.state):this._blurStream()}));const e=Ie.default.newCauseId();E.log(R.LogTraceArea.ContentPanel,"[MobileContentPanel] componentDidMount isKeyboardShown: "+this.state.isKeyboardShown+" causeId: "+e),this.props.route.params.conversationId&&(E.log(R.LogTraceArea.ContentPanel,"[MobileContentPanel] - displaying conversation, id: "+ce.mriOrId(this.props.route.params.conversationId)+" causeId: "+e),g.default.CallPreheatHelper.maybePreheatCall(this.props.route.params.conversationId,e)),this._mojiPreviewOpenToken=ae.MojiPreviewService.onPesPreviewOpened(this._onMojiPreviewOpened),this._mojiPreviewCloseToken=ae.MojiPreviewService.onPesPreviewClosed(this._onMojiPreviewClosed),this._searchStore.setTimestamp(this.props.route.params.scrollToTimestamp)}componentWillUnmount(){var e;super.componentWillUnmount();const t=[be.Scenarios.SearchToConversation,be.Scenarios.RecommendationFromRecentsToConversation,be.Scenarios.RecommendationFromContactsToConversation];Te.default.interruptScenarios(this.props.route.params.conversationId,t),this._mojiPreviewOpenToken&&this._mojiPreviewOpenToken.unsubscribe(),this._mojiPreviewCloseToken&&this._mojiPreviewCloseToken.unsubscribe(),this._gifPreviewOpenToken&&this._gifPreviewOpenToken.unsubscribe(),this._gifPreviewCloseToken&&this._gifPreviewCloseToken.unsubscribe(),this._focusMessageComposerToken&&this._focusMessageComposerToken.unsubscribe(),Y.default.removeBottomMargin(this._miniToastKey),null===(e=this._backButtonHandlerSubscriptionToken)||void 0===e||e.unsubscribe()}_blurStream(){this._messagePanel&&this._messagePanel.blur()}_focusStream(e){this._messagePanel&&e.onTopOfNavStack&&this._messagePanel.requestFocus()}_focusStreamForAccessibility(e){this._messagePanel&&e.onTopOfNavStack&&!a.Modal.isDisplayed()&&pe.default.isMobileScreenReaderEnabled()&&this._messagePanel.focusTextInputForAccessibility()}_buildState(e,t){const s=u.default.getS4LMessagingFeatures(),i=(0,P.default)(),o=i.getConversation(e.route.params.conversationId),r={showMagicBotConsentBanner:(null==s?void 0:s.enableMagicBotBanner)&&(0,xe.isMagicBotContainingConversation)(o)&&(null==o?void 0:o.isGroupConversation())},l=this.props,d=this._getRootViewId(),c=i.isConversationBlocked(o);return r.responsiveWidth=de.default.getResponsiveWidth(d),r.conversationDisplayName=x.default.getDisplayName(e.route.params.conversationId),r.isFileUploadCapable=!D.default.isUsingGogoNetwork()&&(!v.isAgent(e.route.params.conversationId)||h.default.hasCapability(e.route.params.conversationId,"file.send"))&&!c&&!(o&&o.isLogicalOneOnOneSmsConversation())&&!v.isS4BBridgeMri(e.route.params.conversationId),r.onTopOfNavStack=re.default.isConversationOnTopOfNavStack(e.route.params.conversationId),r.deviceOrientation=de.default.getDeviceOrientation(d),r.isKeyboardShown=V.default.isKeyboardSeen()&&r.onTopOfNavStack,r.userColorBackgroundStyle=se.default.getPrimaryBackgroundColorStyle(),r.leavePaddingForStatusBar=a.StatusBar.isOverlay()&&r.deviceOrientation===n.DeviceOrientation.Portrait,r.statusBarHeight=he.default.statusBarHeight(),r.isConnectedToCall=g.default.CallingStore.hasConnectedCalls(),r.otherPartyMri=o&&o.isOneOnOne()?o.getOtherPartyMri():void 0,r.isSendImCapable=!o||I.default.isSendImCapable(o),r.isIncomingContactInvitePending=o&&T.default.isIncomingContactInvitePending(o.id)||!!e.route.params.inviteToken&&(!this.state||o&&!T.default.isConversationAccepted(o.id))&&r.otherPartyMri&&!T.default.isContact(r.otherPartyMri),r.localAddressBookContact=o&&o.isOneOnOne()?U.default.getContactByCorrespondingMri(e.route.params.conversationId):void 0,r.otherPartyMri&&(r.userProfile=Me.default.getFullUserProfileByMri(r.otherPartyMri)),r.activeCallId=g.default.ActiveCallUIHelper.getActiveCallId(e.route.params.conversationId),r.activeCallStatus=r.onTopOfNavStack?g.default.ActiveCallUIHelper.activeCallStatus(e.route.params.conversationId):m.ActiveCallStatus.None,t&&(r.overflowMenuVisible=!1,r.shouldFlattenNavOnInteraction=e.route.params.shouldFlattenNavOnInteraction,r.headerHeightAndroid=0),r.isConversationBlocked=c,r.bottomSafeAreaInset=he.default.bottomSafeAreaInset(4),r.safeAreaHorizontalInsets=he.default.horizontalInsets(b.HorizontalInsetDefault),t?(Se.default.isSelectMessagesModeActive(d)&&Se.default.deactivateSelectMessagesMode(),r.isSelectMessagesModeActive=!1):r.isSelectMessagesModeActive=Se.default.isSelectMessagesModeActive(d),r.isSelectMessagesModeActive?r.currentSelectMessagesUIState=k.SelectMessagesUIState.Active:!t&&$.shouldCancelMessageSelection(l.route.params.contextConversationId,e.route.params.contextConversationId)?r.currentSelectMessagesUIState=k.SelectMessagesUIState.Deactive:r.currentSelectMessagesUIState=this.state?this.state.currentSelectMessagesUIState:k.SelectMessagesUIState.Deactive,r.hideHeader=s.hideHeaderInLandscape&&r.deviceOrientation===n.DeviceOrientation.Landscape&&r.isKeyboardShown&&!ve.default.isTablet(),r.canSeeGuestUpsell=!r.hideHeader&&S.default.identity().canSeeGuestUpsell,r.isMessageSearchPanelVisible=!!this._searchStore.getSearchQuery(),r.isTranslatedConversation=B.default.isConversationTranslated(e.route.params.conversationId),r}render(){let e;this.state.deviceOrientation!==n.DeviceOrientation.Landscape&&this.state.mojiPreview&&(e=(0,i.jsx)(te.MojiPreview,{moji:this.state.mojiPreview,onClose:this._onMojiPreviewCloseButtonPressed,onSend:this._onMojiSend,sendButtonTitle:j.getString("Moji.SendButtonTitle"),showSendButton:!0})),this._openFindPanelScenario||(this._openFindPanelScenario=new Ce.default(Ce.ScenarioName.OpenFindPanel));const t=this._getChatTabContent(this.props.route.params.contextConversationId),s=this.state.overflowMenuVisible||!this.state.onTopOfNavStack?a.Types.ImportantForAccessibility.NoHideDescendants:void 0,{contentStyle:o}=c.StyleSheet.create({contentStyle:{borderBottomWidth:1,borderBottomColor:this._getContext().themeColors.dividerPrimary}}),r=(0,i.jsxs)(a.View,Object.assign({style:Oe.fillParent,importantForAccessibility:s},{children:[(0,i.jsxs)(d.Box,Object.assign({style:o},{children:[this._renderHeader(),this._renderMessageSearchPanel(),this._renderSelectedMessagesPanelHeader(),this._renderGuestUpsellBannerIfAvailable(),this.state.showMagicBotConsentBanner?(0,i.jsx)(Ae.MagicBotConsentBanner,{}):null]})),(0,i.jsx)(a.View,Object.assign({style:Oe.contentPanelLowerContents,onLayout:this._onChatTabLayout},{children:t})),this._renderMessageSearchNavigation(),this._renderSelectedMessagesPanelActions()]})),l=(0,i.jsx)(z.default,{ref:this._onMessageComposerOverflowRef,conversationId:this.props.route.params.conversationId,otherPartyMri:this.state.otherPartyMri,findPerfScenario:this._openFindPanelScenario}),h=this.state.toolTipInfo?(0,i.jsx)(O.default,{toolTipInfo:this.state.toolTipInfo,onDismiss:this._onDismissPopup}):void 0,u=[];this.state.bottomSafeAreaInset&&u.push(ue.default.paddingBottomStyle(this.state.bottomSafeAreaInset));const p=[Oe.container,a.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1)],g=this._getContext().themeColors.surfacePrimary;return(0,i.jsxs)(d.Box,Object.assign({flex:1,style:u},{children:[(0,i.jsx)(ke.default,{statusBarKey:"MobileContentPanel",backgroundColor:g,animated:!0}),(0,i.jsx)(Pe.KeyboardAvoidingView,{children:(0,i.jsx)(a.View,Object.assign({style:p},{children:(0,i.jsxs)(C.CoachMarkContext.Provider,Object.assign({value:this._coachMarkContext},{children:[r,e,h,l,(0,i.jsx)(K.default,{})]}))}))})]}))}_renderMessageSearchPanel(){if(this._shouldRenderSearchComponents())return(0,i.jsx)(Q.MessageSearchPanelAnimatedWrapper,{conversationId:this.props.route.params.conversationId,onCancel:this._onCloseMessageSearchPanel,ref:this._onMessageSearchPanelRef,isMessageSearchPanelVisible:this.state.isMessageSearchPanelVisible,useMobileUI:!0,searchStore:this._searchStore})}_renderMessageSearchNavigation(){if(this._shouldRenderSearchComponents())return(0,i.jsx)(X.MobileSearchNavigationPanel,{useMobileUI:!0,searchStore:this._searchStore})}_shouldRenderSearchComponents(){return this.state.deviceOrientation===n.DeviceOrientation.Portrait}_getChatTabContent(e){const t=l.default.isMobile()?we.WindowDimensionUtils.measureWindow(this._getRootViewId()).width-fe.default.getWidthNoSubscription():void 0;let s=(0,i.jsx)(G.default,{ref:this._onMessagePanelRef,conversationId:this.props.route.params.conversationId,otherPartyMri:this.state.otherPartyMri,isNewConversation:this.props.route.params.isNewConversation,scrollToTimestamp:this.props.route.params.scrollToTimestamp,focusedMessageCuid:this.props.route.params.focusedMessageCuid,forceRefreshFocus:this.props.route.params.forceRefreshFocus,allowUploads:this.state.isFileUploadCapable,hasUnderlay:!!this.props.route.params.contextConversationId,hasConnectedCalls:this.state.isConnectedToCall,shouldAutoFocusInput:this.props.route.params.shouldAutoFocusInput,onMessageSent:this.state.shouldFlattenNavOnInteraction?this._onInteracted:void 0,onLaunchCamera:this._launchCamera,inviteToken:this.props.route.params.inviteToken,onShowOverflow:this._onShowOverflow,onShowGestureHint:this._onShowGestureHint,preventAccessibilityFocus:this._secondaryViewDisplayed(),showBottomDivider:!0,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets,selectedNumberForSMS:this.props.route.params.selectedNumberForSMS,isSelectMessagesModeActive:this.state.isSelectMessagesModeActive,headerHeightAndroid:this.state.headerHeightAndroid,isFromSearch:this.props.route.params.isFromGlobalSearch,isFromPeopleRecommendations:this.props.route.params.isFromPeopleRecommendations,directShareEventData:this.props.route.params.directShareEventData,isMessageSearchPanelVisible:this.state.isMessageSearchPanelVisible,isTranslatedConversation:this.state.isTranslatedConversation,searchStore:this._searchStore,availableWidth:t},this._virtualStreamRefCount);return s=(0,i.jsx)(a.View,Object.assign({style:Oe.contentPanelLowerContents},{children:s})),e?s:(0,i.jsx)(a.View,Object.assign({style:Oe.contentPanelContents},{children:s}),"conversation")}_renderHeader(){return this.state.hideHeader?void 0:(0,i.jsx)(M.ContentPanelHeader,{conversationId:this.props.route.params.conversationId,otherPartyMri:this.state.otherPartyMri,contextConversationId:this.props.route.params.contextConversationId,activeCallId:this.state.activeCallId,hasActiveCall:!!this.state.activeCallId,activeCallStatus:this.state.activeCallStatus,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets,onCallStartedAnsweredOrJoined:this._onCallStartedAnsweredOrJoinedViaContentPanelHeader,preventAccessibilityFocus:this._secondaryViewDisplayed()||this.state.isSelectMessagesModeActive||this.state.isMessageSearchPanelVisible,hideConversationSwitcher:this.state.isSelectMessagesModeActive||this.state.isMessageSearchPanelVisible,localAddressBookPhones:this.state.localAddressBookContact?this.state.localAddressBookContact.phones:void 0,onLayout:void 0,hideBackButton:this.props.route.params.hideBackButton,openMagicBotToolboxByDefault:this.props.route.params.openMagicBotToolboxByDefault})}_renderSelectedMessagesPanelHeader(){if(this.state.currentSelectMessagesUIState!==k.SelectMessagesUIState.Deactive)return(0,i.jsx)(me.default,{renderHeader:!0,conversationId:this.props.route.params.conversationId,mobileUi:!0,bottomPadding:this.state.bottomSafeAreaInset,panelAnimatedValue:this._innerMovingContainerSelectMessagesHeader,onClosePanel:this._onCloseSelectMessagesPanel})}_renderGuestUpsellBannerIfAvailable(){if(this.state.canSeeGuestUpsell)return(0,i.jsx)(F.default,{})}_renderSelectedMessagesPanelActions(){if(this.state.currentSelectMessagesUIState!==k.SelectMessagesUIState.Deactive)return(0,i.jsx)(me.default,{renderActions:!0,conversationId:this.props.route.params.conversationId,mobileUi:!0,bottomPadding:this.state.bottomSafeAreaInset,panelAnimatedValue:this._innerMovingContainerSelectMessagesActions,onClosePanel:this._onCloseSelectMessagesPanel})}_secondaryViewDisplayed(){return!!this.state.mojiPreview}}t.default=Le},472980:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(758962),n=s(32687),r=s(476359),a=s(336061);t.default=e=>{const{searchType:t,conversationId:s}=e.route.params;if(t===o.TabType.Emoticon){const{onMessageSent:o,onCloseSearch:r,clearEditInChatsComposer:a}=e.route.params;return(0,i.jsx)(n.default,{searchType:t,conversationId:s,onMessageSent:o,onCloseSearch:r,clearEditInChatsComposer:a})}return t===o.TabType.Moji?(0,i.jsx)(r.default,{searchType:t,conversationId:s}):t===o.TabType.ChatSticker?(0,i.jsx)(a.default,{searchType:t,conversationId:s}):null}},505327:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(583367),n=s(216934),r=s(516778),a=s(974634),l=s(496486),d=s(889391),c=s(67930),h=s(671830),u=s(946992),p=s(952262),g=s(746096),m=s(281020),S=s(436237),f=s(710400),y=s(915877),v=s(733754),C=s(812056),_=s(104735),b=s(330124),T=s(628433),M=s(29130),I=s(451070),w=s(694622),P=s(210541),k=s(532514),A=s(655759),x=s(724067),R=s(190631),O=s(316392),L=s(853374),F=s(897634),B=s(115340),D=(0,y.lazyProperties)({container:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch"})}),E={[g.SearchType.ZeroInput]:[{groupType:g.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:g.SearchResultsListGroup.CombinedContactsWithoutAddressBookOrAlphaHeaders}],[g.SearchType.ShortQuery]:[{groupType:g.SearchResultsListGroup.AllPeople},{groupType:g.SearchResultsListGroup.PublicDirectory}],[g.SearchType.LongQuery]:[{groupType:g.SearchResultsListGroup.AllPeople},{groupType:g.SearchResultsListGroup.PublicDirectory}]};class V extends c.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._onKeyDownEvent=new a.default,this._keyboardAnimatedHeightValue=new r.Animated.Value(0),this._keyboardAnimatedHeightStyle=r.Styles.createAnimatedViewStyle({height:this._keyboardAnimatedHeightValue}),this._hasUsedSearch=!1,this._onSearchResultsListRef=e=>{this._searchResultsListRef=e||void 0},this._onProfileRemoved=()=>{this._searchResultsListRef&&this._searchResultsListRef.focusFirst()},this._onInputChanged=e=>{this.isComponentMounted()&&(!1===this._hasUsedSearch&&e.length>0&&(this._hasUsedSearch=!0),this.setState({inputText:e}))},this._getHeader=()=>{const e={closeButtonType:this.props.route.params.navigationDirection===O.StackNavigationDirection.Push?R.CloseButtonType.Back:R.CloseButtonType.Close,onPress:this._cancelShare,title:v.getString("ShareWithPanel.CloseButtonTitle")},t=this._getHeaderText(this.state),s=this.props.route.params.accessibilityLabelTitle||(0,l.trimEnd)(t,".");return(0,i.jsx)(r.View,{children:(0,i.jsx)(R.SimplePanelHeader,{panelName:t,accessibleName:s,leftButton:e,allowTextWrap:!0})})},this._onSearchInputKeyDown=e=>{this._onKeyDownEvent.fire(e.keyCode)},this._onSelectableItemClick=(e,t)=>{const s=this._conversationSelectionController.getSelectedConversations(),i=p.default.getDisplayableProfile(t);(0,l.includes)(s,t)?(this._conversationSelectionController.removeConversation(t),r.Accessibility.announceForAccessibility(v.getString("ShareWithPanel.ShareTargetRemovedAnnouncement",{displayName:i.getDisplayName()}))):(this._conversationSelectionController.addConversation(t),r.Accessibility.announceForAccessibility(v.getString("ShareWithPanel.ShareTargetSelectedAnnouncement",{displayName:i.getDisplayName()})))},this._onSendButtonPress=()=>{if(this._sendButtonPressed)return;this._sendButtonPressed=!0;const e=L.default.newCauseId();S.log(g.LogTraceArea.Contacts,"ShareContactsToConversationPanel._onSendButtonPress,  causeId: "+e);const t=this._conversationSelectionController.getSelectedConversations();this._completeSharingProcess(t,e)},this._cancelShare=()=>{const e=L.default.newCauseId();S.log(g.LogTraceArea.Contacts,"ShareContactsToConversationPanel._cancelShare,  causeId: "+e),this._goBack(e)},this._headerHeight=()=>(this.state.deviceOrientation!==o.DeviceOrientation.Landscape?this.state.isSmallDevice?R.HeaderHeightSmall:R.HeaderHeight:this.state.isSmallDevice?R.HeaderHeightLandscapeSmall:R.HeaderHeightLandscape)+this.state.statusBarPadding}_buildState(e,t){const s=this._getRootViewId(),i={statusBarPadding:I.default.statusBarPadding(),deviceOrientation:M.default.getDeviceOrientation(s),isSmallDevice:M.default.isSmallDevice(s)};return t&&(this._conversationSelectionController=new u.default,i.inputText=""),i.isUsingStackNavigationContext=b.default.isUsingStackNavigationContext(),i.keyboardUpdateInfo=f.default.getUpdateInfo(),i.keyboardResizeMode=f.default.getResizeMode(),i.selectedMris=this._conversationSelectionController.getSelectedConversations(),i.canSubmit=this._conversationSelectionController.getSelectedConversations().length>0,i.headerConfig={getHeader:this._getHeader,getHeaderHeight:this._headerHeight,key:"header"},i}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._searchController=new k.default}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.state.keyboardUpdateInfo.height!==t.keyboardUpdateInfo.height&&this._keyboardAnimatedHeightValue.setValue(t.keyboardUpdateInfo.height)}componentWillUnmount(){super.componentWillUnmount(),this._searchController&&this._searchController.destroy();let e=0,t=0;this.state.selectedMris.forEach((s=>{h.isPhoneMri(s)?e++:t++})),S.track(new C.ShareContactsTelemetry(this.props.route.params.entryPoint,this.props.route.params.conversationId,e,t,this._hasUsedSearch))}render(){const e=this.state.keyboardResizeMode===n.KeyboardAwareResizeMode.None?(0,i.jsx)(r.Animated.View,{style:this._keyboardAnimatedHeightStyle}):void 0,{primaryBackgroundColorStyle:t}=F.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return(0,i.jsxs)(B.KeyboardAvoidingView,Object.assign({style:[D.container,t]},{children:[(0,i.jsxs)(r.View,Object.assign({style:D.container},{children:[(0,i.jsx)(T.default,{searchController:this._searchController,headerConfig:this.state.headerConfig,onCancel:this._cancelShare,peopleType:P.PeopleType.AllExcludingBots,includeGroups:!0,autoFocusOnInput:!r.UserInterface.isNavigatingWithKeyboard(),autoFocusWhenActive:!0,selectorController:this._conversationSelectionController,useCollapsableHeader:!1,onKeyDown:this._onSearchInputKeyDown,inputText:this.state.inputText,onInputChanged:this._onInputChanged,colorThemeOverride:this.props.route.params.colorThemeOverride,onProfileRemoved:this._onProfileRemoved,noFixedHeight:!1},"peopleInput"),(0,i.jsx)(w.SearchResultsList,{ref:this._onSearchResultsListRef,rawSearchQuery:this.state.inputText,origin:g.SearchResultsListOrigin.ContactsPanel,searchResultGroups:this._getSearchResultsGroup(),searchController:this._searchController,arePeopleSelectableForInvite:!0,onListItemClick:this._onSelectableItemClick,selectedMris:this.state.selectedMris,peopleType:P.PeopleType.AllExcludingBots,maxNumberOfSuggestedContacts:20,excludePstn:!1,excludeGroups:!0,userMrisToExclude:this.props.route.params.userMrisToExclude,keyDownEvent:this._onKeyDownEvent,colorThemeOverride:this.props.route.params.colorThemeOverride})]})),(0,i.jsx)(x.default,{button:this._getActionSendButton()}),e]}))}_componentId(){return"ShareContactsToConversationPanel"}_getActionSendButton(){return{onPress:this._onSendButtonPress,disabled:!this.state.canSubmit,text:v.getString("ShareWithPanel.SendButton"),accessibilityLabel:v.getString("ShareWithPanel.SendButton")}}_getSearchResultsGroup(){const e=this.state.inputText.trim();return 0===e.length?E[g.SearchType.ZeroInput]:e.length<d.default.getConfigSettingsNoSubscription().search.longQueryCharCount?E[g.SearchType.ShortQuery]:E[g.SearchType.LongQuery]}_completeSharingProcess(e,t){S.log(g.LogTraceArea.Contacts,"ShareContactsToConversationPanel._completeSharingProcess,  causeId: "+t),e.forEach((e=>{const t={skypeId:h.stripMriNamespace(e),isPstn:h.isPhoneMri(e),isS4B:h.isS4BBridgeMri(e),fullName:p.default.getDisplayName(e)||"",userMri:e};A.forwardContact(t,this.props.route.params.conversationId,g.PostSource.MessageComposer)})),this.props.route.params.entryPoint&&this.props.route.params.entryPoint===m.ShareContactOrigin.Deeplink&&b.default.isUsingStackNavigationContext()?_.default.navigateToConversation({convId:this.props.route.params.conversationId,origin:g.NavigationConversationOrigin.SharedContactCard,causeId:t}):(this._goBack(t),this.props.route.params.onShareComplete&&this.props.route.params.onShareComplete())}_getHeaderText(e){return this.props.route.params.panelTitle}}t.default=V},837867:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(996074),o=s(690574);t.default=(0,i.forNavigation)(o.default)},922389:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(583367),n=s(516778),r=s(496486),a=s(996074),l=s(190631),d=s(781511),c=s(217093),h=s(644949),u=s(898278),p=s(915877),g=s(746096),m=s(436237),S=s(733754),f=s(24148),y=s(803056),v=s(597647),C=s(607044),_=s(104735),b=s(330124),T=s(29130),M=s(451070),I=s(680837),w=s(853374),P=(0,p.lazyProperties)({galleryPanel:()=>n.Styles.combine(n.Styles.createViewStyle({alignItems:"stretch"}),I.default.flexOne)});class k extends a.BaseNavigationView{constructor(){super(...arguments),this._onTabSelected=e=>{m.track(new d.GalleryFilterSwitchedEvent(this.props.route.params.conversationId,this.state.viewMode,e)),this.isComponentMounted()&&this.state.viewMode!==e&&this.setState({viewMode:e}),m.track(new f.NavigationTab(c.GalleryViewMode[e])),this._telemetryScenario.markChangedViewMode(e)},this._onClose=()=>{const e=w.default.newCauseId();m.log(g.LogTraceArea.Navigation,"StackGalleryPanel._onClose,  causeId: "+e),_.default.closeGalleryPanel(e,this._getContext())},this._goBack=e=>(m.log(g.LogTraceArea.Navigation,"StackGalleryPanel._goBack,  causeId: "+e),(0,r.defer)((()=>{this._onClose()})),!0)}_buildState(e,t){const s=b.default.isUsingStackNavigationContext(),i=this._getRootViewId(),r=n.StatusBar.isOverlay()&&(T.default.getDeviceOrientation(i)===o.DeviceOrientation.Portrait||this._isPresentedInTabletLeftNav());return{isUsingStackNavigationContext:s,viewMode:t||!s?e.route.params.viewMode:this.state.viewMode,safeAreaHorizontalInsets:M.default.horizontalInsets(u.HorizontalInsetDefault),leavePaddingForStatusBar:r}}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._telemetryScenario=h.GalleryTelemetryScenario.getInstance(!0),m.track(new d.GalleryOpenedEvent(this.props.route.params.conversationId))}componentWillUnmount(){super.componentWillUnmount(),this._telemetryScenario.markStep(h.GalleryScenarioStep.GalleryClosed),h.GalleryTelemetryScenario.destroyInstance()}render(){return(0,i.jsx)(y.default,Object.assign({goBack:this._goBack},{children:(0,i.jsxs)(n.View,Object.assign({style:[P.galleryPanel,this._getContext().themeStyles.primaryBackgroundColorStyle]},{children:[(0,i.jsx)(l.SimplePanelHeader,{panelName:S.getString("GalleryPanel.DesktopPanelTitle"),leavePaddingForStatusBar:this.state.leavePaddingForStatusBar,leftButton:{closeButtonType:l.CloseButtonType.Close,onPress:this._onClose}}),this._renderPanelContent()]}))}))}_renderPanelContent(){let e;if(this.props.route.params.viewMode===c.GalleryViewMode.None)return;switch(this.state.viewMode){case c.GalleryViewMode.Media:e=(0,i.jsx)(C.default,{conversationId:this.props.route.params.conversationId,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,viewMode:this.state.viewMode,displayTabBar:this.state.isUsingStackNavigationContext,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets,onTabSelected:this._onTabSelected});break;case c.GalleryViewMode.Files:case c.GalleryViewMode.Links:e=(0,i.jsx)(v.default,{conversationId:this.props.route.params.conversationId,viewMode:this.state.viewMode,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,displayTabBar:this.state.isUsingStackNavigationContext,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets,onTabSelected:this._onTabSelected})}const t=[I.default.flexOne];return this.state.isUsingStackNavigationContext||t.push(I.default.overflowVisible),(0,i.jsx)(n.View,Object.assign({style:t},{children:e}))}_componentId(){return"StackGalleryPanel"}}t.default=k},947709:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StackGalleryNavigation=t.ShareWithNavigation=t.ShareContactsToConversationNavigation=t.PesSearchNavigation=t.MobileContentPanel=t.MediaViewerNavigation=t.MediaPickerNavigation=t.getLocationViewerNavigationHeaderTitle=t.NearByPlacesNavigation=t.LocationViewerNavigation=t.LocationPickerNavigation=t.LoadingNavigation=t.GifPreviewNavigation=t.DocumentViewerNavigation=t.CustomReactionsNavigation=t.CreateConversationNavigation=t.ConversationParticipantsNavigation=t.ConversationMediaViewerNavigation=t.CapturePreviewNavigation=t.CaptureMultiplePreviewNavigation=t.CaptureComboViewNavigation=t.ArchivedConversationsNavigation=void 0;var i=s(488110);Object.defineProperty(t,"ArchivedConversationsNavigation",{enumerable:!0,get:function(){return i.default}});var o=s(192076);Object.defineProperty(t,"CaptureComboViewNavigation",{enumerable:!0,get:function(){return o.default}});var n=s(887962);Object.defineProperty(t,"CaptureMultiplePreviewNavigation",{enumerable:!0,get:function(){return n.default}});var r=s(534635);Object.defineProperty(t,"CapturePreviewNavigation",{enumerable:!0,get:function(){return r.default}});var a=s(134037);Object.defineProperty(t,"ConversationMediaViewerNavigation",{enumerable:!0,get:function(){return a.default}});var l=s(760180);Object.defineProperty(t,"ConversationParticipantsNavigation",{enumerable:!0,get:function(){return l.default}});var d=s(286766);Object.defineProperty(t,"CreateConversationNavigation",{enumerable:!0,get:function(){return d.default}});var c=s(358454);Object.defineProperty(t,"CustomReactionsNavigation",{enumerable:!0,get:function(){return c.default}});var h=s(767337);Object.defineProperty(t,"DocumentViewerNavigation",{enumerable:!0,get:function(){return h.default}});var u=s(331039);Object.defineProperty(t,"GifPreviewNavigation",{enumerable:!0,get:function(){return u.default}});var p=s(200235);Object.defineProperty(t,"LoadingNavigation",{enumerable:!0,get:function(){return p.default}});var g=s(48286);Object.defineProperty(t,"LocationPickerNavigation",{enumerable:!0,get:function(){return g.LocationPickerNavigation}}),Object.defineProperty(t,"LocationViewerNavigation",{enumerable:!0,get:function(){return g.LocationViewerNavigation}}),Object.defineProperty(t,"NearByPlacesNavigation",{enumerable:!0,get:function(){return g.NearByPlacesNavigation}}),Object.defineProperty(t,"getLocationViewerNavigationHeaderTitle",{enumerable:!0,get:function(){return g.getLocationViewerNavigationHeaderTitle}});var m=s(335276);Object.defineProperty(t,"MediaPickerNavigation",{enumerable:!0,get:function(){return m.default}});var S=s(788755);Object.defineProperty(t,"MediaViewerNavigation",{enumerable:!0,get:function(){return S.default}});var f=s(254399);Object.defineProperty(t,"MobileContentPanel",{enumerable:!0,get:function(){return f.default}});var y=s(472980);Object.defineProperty(t,"PesSearchNavigation",{enumerable:!0,get:function(){return y.default}});var v=s(505327);Object.defineProperty(t,"ShareContactsToConversationNavigation",{enumerable:!0,get:function(){return v.default}});var C=s(837867);Object.defineProperty(t,"ShareWithNavigation",{enumerable:!0,get:function(){return C.default}});var _=s(922389);Object.defineProperty(t,"StackGalleryNavigation",{enumerable:!0,get:function(){return _.default}})},717135:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ASMClient=void 0;const i=s(662783),o=s(977523),n=s(746096),r=s(436237),a=s(914976),l=s(13159),d=s(640363),c=s(994214),h=s(853374),u="Authorization",p="skype_token ",g="CorrelationId",m="TransactionId",S="RequestId";class f extends l.SkypeRestClient{constructor(e,t,s){super(t),this._defaultOptions.mustHaveValidSkypeToken=!0,s&&(this._defaultOptions.timeout=s),this._defaultOptions.customErrorHandler=(t,s)=>{const l=s?s.statusCode:-1,d=t.getRequestHeaders(),c=t.getOptions(),h=f.getTracingHeaders(d);return r.warn(n.LogTraceArea.AsyncMediaClient,"Failed to perform request to "+e+" url:"+a.dev_unknownOmit(s.url)+" status code "+l+" RequestId:"+h.requestId+" CorrelationId:"+h.correlationId+" TransactionId:"+h.transactionId),r.track(new o.ASMClientFailure(e,l,c.scenario,h)),(0,i.DefaultErrorHandler)(t,s)}}performRequest(e,t){return t.correlationId||(t.correlationId=h.default.newGuid()),super.performRequest(e,t)}_getHeaders(e){const t={"X-Client-Version":d.default.getClientVersionAndPlatform()+"//"};return t[g]=e.correlationId,t[S]=h.default.newGuid(),e.transactionId&&(t[m]=e.transactionId),c.default.hasUsableSkypeToken()&&(t[u]=p+c.default.getRawSkypeToken()),t}_getSkypeTokenFromHeader(e){const t=e[u];if(!t)return;const s=t.indexOf(p);if(-1===s)return;return t.substring(s+12)}checkAuthFailure(e,t,s=!0){if(401===e){const e=t&&this._getSkypeTokenFromHeader(t);if(e)return s&&(r.warn(n.LogTraceArea.AsyncMediaClient,"Our skype token is dead. Nuking and waiting for it to refresh."),c.default.skypeTokenInvalid(e)),!0}return!1}static getTracingHeaders(e){return{requestId:e[S],correlationId:e[g],transactionId:e[m]}}}t.ASMClient=f},720603:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(889391),r=s(994214),a=s(717135),l=s(265976),d=s(478262),c=s(626712),h=s(853374),u=s(491632),p=s(516283),g=s(404057);class m extends a.ASMClient{constructor(){super("AsyncMediaClient","");const e=n.default.getAsyncMediaFeatures();this._amsSkypeTokenAuthUrl=i.replace(e.ams_skypetokenauth_url_format,"{0}",e.ams_base_url)}_getHeaders(e){const t=super._getHeaders(e);return e.rangeOffset&&e.rangeOffset>0&&(t.Range=`bytes=${e.rangeOffset}-`),t}setAuthCookie(e){return this.performRequest({method:"POST",path:this._amsSkypeTokenAuthUrl,passedData:"skypetoken="+e.rawToken},{withCredentials:!0,retries:5,scenario:"setAuthCookie"})}createDocumentAsync(e,t,s,i,o,n,r){const a=this._createCreateDocumentRequest(e,t,s,i),d={scenario:"createDocument",transactionId:o,correlationId:n,timeout:r};return this.performRequest({method:"POST",path:l.getCreateDocumentUrl(),passedData:a},d)}createDocumentGetIdAsync(e,t,s,i,n,r,a){return this.createDocumentAsync(e,t,s,i,n,r,a).then((e=>e.body&&e.body.id?e.body.id:o.Rejected("No Document ID provided")))}createDocumentBackground(e,t,s,i,o,n,r){const a=this._createCreateDocumentRequest(s,i,o,n);return this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:l.getCreateDocumentUrl(),action:"POST",postData:a,requestOptions:r})}_createCreateDocumentRequest(e,t,s,o){let n,r=!0;switch(s){case d.UploadFileType.Picture:n="pish/image";break;case d.UploadFileType.Video:n="sharing/video";break;case d.UploadFileType.VideoMessage:n="sharing/videototranscode";break;case d.UploadFileType.Audio:case d.UploadFileType.AudioMessage:r=!1,n="sharing/audio";break;case d.UploadFileType.GroupAvatar:n="avatar/group";break;default:r=!1,n="sharing/file"}const a={};i.each(e,(e=>{a[e]=s===d.UploadFileType.GroupAvatar?["read","delete"]:["read"]}));const l={permissions:a,type:n,filename:t};return r&&o&&(l.expiry_date=o.toISOString()),l}uploadDocumentAsync(e,t,s,i,o,n){const r={onProgress:i,contentType:"application",scenario:"uploadDocument",transactionId:o,correlationId:n};return this.performRequest({method:"PUT",path:l.getUploadUrl(e,t),passedData:s},r)}uploadDocumentBackground(e,t,s,i,o,n){return this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:l.getUploadUrl(s,i),action:"PUT",postData:o,requestOptions:Object.assign(Object.assign({},n),{contentType:"application"})})}forwardDocumentAsync(e,t,s){const o={permissions:{}};i.each(s,(e=>{o.permissions[e]=["read"]}));const n=h.default.newGuid();return this.getStatusAsync(e,t,n).then((t=>{const s=c.default.getURIComponents(t.view_location),i=s.protocol+"://"+s.host+"/v1/objects/"+e+"/forward";return this.performRequest({method:"POST",path:i,passedData:o},{excludeEndpointUrl:!0,transactionId:n,scenario:"forwardDocument"}).then((e=>e.body.id))}))}forwardMediaBackground(e,t,s,o,n,r){const a=c.default.getURIComponents(s),l=a.protocol+"://"+a.host+"/v1/objects/"+n+"/forward",d={permissions:{}};return i.each(o,(e=>{d.permissions[e]=["read"]})),this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:l,action:"POST",postData:d,requestOptions:r})}deleteAsync(e){return this.performRequest({method:"DELETE",path:l.getDocumentUrl(e)},{scenario:"delete"}).then(i.noop)}downloadBackground(e,t,s,o,n=!1,r=!1,a=0,l){const d=i.defaults({rangeOffset:a,acceptType:"blob",excludeEndpointUrl:!0,scenario:"download"},l);return this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:s,action:"GET",downloadGetToUri:!0,downloadToPublicFolder:n,downloadPublicFolderUseSkypeFolder:r,filename:o,requestOptions:d})}getStatusAsync(e,t,s){const i={scenario:"getStatus",transactionId:s};return this.performRequest({method:"GET",path:l.getDownloadStatusUrl(e,t)},i).then((e=>e.body&&!e.body.view_state&&c.default.isUrlValid(e.body.status_location)?this.performRequest({method:"GET",path:e.body.status_location},i).then((e=>e.body)):e.body))}getStatusBackground(e,t,s,i,o){return this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:l.getDownloadStatusUrl(s,i),action:"GET",requestOptions:o})}getUploadStatusAsync(e,t,s){const i={scenario:"getUploadStatus",transactionId:s};return this.performRequest({method:"GET",path:l.getUploadStatusUrl(e,t)},i).then((e=>e.body))}getAudioTranscriptionAsync(e){return fetch(e,{method:"GET",headers:{Authorization:"skype_token "+r.default.getRawSkypeToken()}}).then((e=>e.blob())).then((e=>new Response(e).text())).catch((e=>(u.Instrumentation.error(p.LogTraceArea.AsyncMediaClient,"get AudioTranscription failed: "+g.default.errorAsString(e)),"")))}}t.default=new m},734581:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(496486),o=s(397691),n=s(889391),r=s(746096),a=s(436237),l=s(178735),d=s(13159),c=s(994214),h=s(626712);class u extends d.SkypeRestClient{constructor(){super(u._getAPIURL())}isValidURL(e){const t=[n.default.getConfigSettingsNoSubscription().azureMediaServices.apiUrl,"https://api.azms.skypeassets.net/api/"],s=h.default.getURIComponents(e);return!(!s||"https"!==s.protocol)&&i.some(t,(e=>{const t=h.default.getURIComponents(e);if(!t||"https"!==t.protocol)return!1;let i=t.protocol===s.protocol;return i=i&&h.default.areHostsSame(t,s),i}))}static _getAPIURL(e=void 0){let t=n.default.getConfigSettingsNoSubscription().azureMediaServices.apiUrl;return e||(e=l.default.getUserPreferencesLocal().azmsEnvironment),void 0!==e&&"test"===e&&(t="https://api.azms.skypeassets.net/api/"),a.log(r.LogTraceArea.Video,"AzMS API: "+t),t}setEnvironment(e){this._endpointUrl=u._getAPIURL(e)}getAuthToken(){return c.default.performWhenValidSkypeTokenArrives().then((()=>c.default.getRawSkypeToken()))}getVideoUrl(e){return this._endpointUrl+"video/"+e}uploadDocumentAsync(e){return this._performApiCall("video","POST",e,{contentType:"application/octet-stream"}).then((e=>(a.log(r.LogTraceArea.Video,"AzMS uploadDocumentAsync statusCode="+e.statusCode),200===e.statusCode?e.body:o.Rejected())),(e=>(a.log(r.LogTraceArea.Video,"AzMS uploadDocumentAsync statusCode="+e.statusCode),o.Rejected())))}uploadDocumentBackground(e,t,s,i){return this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:"video",action:"POST",postData:s,requestOptions:Object.assign(Object.assign({},i),{contentType:"application/octet-stream"})})}_getHeaders(e){const t=super._getHeaders(e);return t["X-Skypetoken"]=c.default.getRawSkypeToken(),t}}t.default=new u},666501:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(746096),o=s(436237),n=s(13159),r=s(994214);class a extends n.SkypeRestClient{constructor(){super(""),this._defaultOptions.mustHaveValidSkypeToken=!0}_getHeaders(e){const t=super._getHeaders(e);return t.DataType="json",t}getMojiMetadata(e){return r.default.usingCdnCookie()?this.performApiGetDetailed(e,{withCredentials:!0}).then((e=>e.body),(t=>this._getMojiMetadataWithoutCookie(e).then((e=>(o.log(i.LogTraceArea.GenericUnsafe,"Error with PES CDN cookie, but retry without it succeeded. Previous error: ",t),e))))):this._getMojiMetadataWithoutCookie(e)}getStickerMetadata(e){return r.default.usingCdnCookie()?this.performApiGetDetailed(e,{withCredentials:!0}).then((e=>e.body),(t=>this._getStickerMetadataWithoutCookie(e).then((e=>(o.warn(i.LogTraceArea.GenericUnsafe,"Error with PES CDN cookie, but retry without it succeeded. Previous error: ",t),e))))):this._getStickerMetadataWithoutCookie(e)}getEmoticonMetadata(e){return this.performApiGetDetailed(e).then((e=>e.body))}_getMojiMetadataWithoutCookie(e){return r.default.performWhenCdnTokenArrives().then((()=>{const t=e+"?"+r.default.getCdnToken();return this.performApiGet(t)}))}_getStickerMetadataWithoutCookie(e){const t=e+"?"+r.default.getCdnToken();return this.performApiGet(t)}getPesConfig(e,t){const s={};return t&&(s.eTag=t),this.performApiGetDetailed(e,s).then((e=>({eTagMatched:304===e.statusCode,response:e.body,eTag:e.headers.etag})))}}t.default=new a},722543:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TestSMSClient=t.FailureReason=void 0;const i=s(496486),o=s(662783),n=s(397691),r=s(971657),a=s(889391),l=s(746096),d=s(617379),c=s(436237),h=s(914976),u=s(13159),p=s(615301),g=s(994214),m=s(640363),S=s(971657),f=s(195358);!function(e){e.InsufficientFunds="InsufficientFunds",e.Other="Other"}(t.FailureReason||(t.FailureReason={}));const y=()=>!1;class v extends u.SkypeRestClient{constructor(){super(a.default.getConfigSettingsNoSubscription().sms.host),this._throttled=y,this._customErrorHandler=(e,t)=>(c.log(l.LogTraceArea.SMSClient,`Server returned ${t.statusCode}: ${h.dev_unknownOmit(JSON.stringify(t.body))}`),400===t.statusCode||401===t.statusCode||403===t.statusCode||404===t.statusCode?o.ErrorHandlingType.DoNotRetry:o.ErrorHandlingType.RetryCountedWithBackoff),this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler,this._defaultOptions.retries=3}_performApiCall(e,t,s,i){return super._performApiCall(e,t,s,i).finally((e=>{if(i&&i.telemetryEvent){let s="NO_RESPONSE";e&&(s=e.statusCode?e.statusCode.toString():"NO_STATUS_CODE");const o={method:t?t.toString():"",acceptType:i.acceptType||"",endpointUrl:a.default.getConfigSettingsNoSubscription().sms.host,statusCode:s,stratusStatusCode:"NO_STRATUS_STATUS_CODE"};i.telemetryEvent.stopTimer().addAttributes(o),c.track(i.telemetryEvent)}return e}))}_blockRequestUntil(e){const t=super._blockRequestUntil(e),s=n.Defer();return this._throttled()?d.default.queueIdleTask("SMSClient",d.TaskTypeFlags.UsesNetworking,(()=>{s.resolve(void 0)}),d.Priority.Normal):s.resolve(void 0),n.all([t,s.promise()]).then(i.noop)}_getHeaders(e){const t=super._getHeaders(e);return t["X-Skypetoken"]=g.default.getRawSkypeToken(),t}getPrice(e,t){return this._setGateway(),c.log(l.LogTraceArea.SMSClient,"Calling SMS Rates API"),this._getPrice(e,t)}_getPrice(e,t){const s=encodeURIComponent(t),i=a.default.getConfigSettingsNoSubscription().sms.organizationId,o=p.default.getFlowId(),n=encodeURIComponent(f.removeLeadingPlus(e)),l=`users/${s}/sms-rates?platform=${m.default.getSkypePlatformId()}&number=${n}&organizationId=${i}&flowId=${o}`,d={acceptType:"application/json; ver=1.0",telemetryEvent:new r.CommerceStratusRequest(S.StratusApiTelemetry.GetSMSRates)};return this.performApiGet(l,d)}_setGateway(){this._endpointUrl=a.default.getConfigSettingsNoSubscription().sms.host}setThrottled(e){this._throttled=e}}t.TestSMSClient=v,t.default=new v},9212:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentQueryType=void 0;const i=s(496486),o=s(217003),n=s(662783),r=s(397691),a=s(889391),l=s(671830),d=s(539549),c=s(746096),h=s(897811),u=s(436237),p=s(18078),g=s(13159),m=s(404057),S=s(994214),f=s(853374);var y;!function(e){e[e.Media=0]="Media",e[e.Files=1]="Files",e[e.LinksAndSwiftCards=2]="LinksAndSwiftCards",e[e.ScheduledCallInvites=3]="ScheduledCallInvites"}(y=t.ContentQueryType||(t.ContentQueryType={}));const v=e=>(0,o.replaceNotMatching)(o.Patterns.MATCH_LETTER," ",e),C=e=>({Content:e}),_="x-ms-correlation-id";class b extends g.SkypeRestClient{constructor(){super(a.default.getConfigSettingsNoSubscription().messageSearch.host),this._customErrorHandler=(e,t)=>(0,n.DefaultErrorHandler)(e,t),this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler}_getHeaders(e){const t=super._getHeaders(e);t["Cache-Control"]="no-cache",t["X-Skypetoken"]=S.default.getRawSkypeToken();const s=f.default.newGuid().replace(new RegExp("-","g"),"");return t[_]=s,t}_getQueryPostObject(e){return{OPTION:{RESULTBASE:e.offset||0,RESULTCOUNT:e.limit},QUERYSTRING:{}}}getSearchResults(e){const t=m.default.deburrLowerCase(e.query),s={OR:i.uniq([e.query,v(e.query),t,v(t)]).filter((e=>!!e&&!!e.trim())).map(C)},o=this._getQueryPostObject(e);return e.conversationId?l.isThread(e.conversationId)?o.QUERYSTRING={AND:[s,{ThreadId:e.conversationId}]}:o.QUERYSTRING={AND:[s,{OR:[{AND:[{From:e.conversationId},{To:p.default.getSkypeMri()}]},{AND:[{To:e.conversationId},{From:p.default.getSkypeMri()}]}]}]}:o.QUERYSTRING=s,this._post(o,"getSearchResults")}getZeroTermResults(e){const t=this._getQueryPostObject(e),s={OR:[{Annotation:{TYPE:"at",VALUE:{id:p.default.getSkypeMri()}}},{Annotation:{TYPE:"quote",VALUE:{author:p.default.getSkypeId()}}}]};return e.conversationId?t.QUERYSTRING={AND:[{ThreadId:e.conversationId},s]}:t.QUERYSTRING=s,this._post(t,"getZeroTermResults")}getScheduledCalls(){const e=a.default.getS4LCMCFeaturesNoSubscription().scheduledCallSearchBatchSize;return this._recursivelyGetBatchedScheduledCalls(0,e,[])}_recursivelyGetBatchedScheduledCalls(e,t,s){const o=this._generateScheduledCallQuery(e,t);return this._endpointUrl=a.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPost("query",o).then((o=>{if(!o)return[];const n=this._filterScheduledCallResults(o);return s=i.concat(s,n),o.length<t?(u.log(c.LogTraceArea.ScheduleCall,`Retrieved a total of ${o.length} scheduled calls.`),s):(e+=t,this._recursivelyGetBatchedScheduledCalls(e,t,s))}))}_filterScheduledCallResults(e){return i.filter(e,(e=>"0"!==e.ClientMessageId))}_generateScheduledCallQuery(e,t){return{OPTION:{RESULTBASE:e,RESULTCOUNT:t},QUERYSTRING:{AND:[{ContentType:"ScheduledCallInvite"}]}}}getLinksAndCardsForConversation(e,t){const s=this._formulateContentQuery(e,y.LinksAndSwiftCards,t);return this._endpointUrl=a.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPost("query",s)}getFilesForConversation(e,t,s=""){const i=this._formulateContentQuery(e,y.Files,t,s);return this._endpointUrl=a.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPost("query",i)}getMediaForConversation(e,t){const s=this._formulateContentQuery(e,y.Media,t);return this._endpointUrl=a.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPost("query",s)}_post(e,t){return this._endpointUrl=a.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPostDetailed("query",e).then((e=>200===e.statusCode&&e.body?e.body:(e.body||u.track(new h.FundamentalsDebugEmptyBodyEvent("SkypeMessageSearch",t,e.requestHeaders[_],e.statusCode,e.statusText)),r.Rejected(e))))}_formulateContentQuery(e,t,s,o="",n=20){let r;i.isEmpty(o)||(r={Content:o});const a=(0,d.default)().getConversation(e);let l=e;if(a&&a.isOneOnOne()&&!a.isThread()){const t=p.default.getSkypeMri();l=t<e?t+":"+e:e+":"+t}const c=[{ThreadId:l}];switch(t){case y.Media:c.push({OR:[{ContentType:"image"},{ContentType:"video"}]});break;case y.Files:c.push({Annotation:{TYPE:"URIObject",VALUE:{type:"File.1"}}});break;case y.LinksAndSwiftCards:c.push({OR:[{Annotation:{TYPE:"URIObject",VALUE:{type:"SWIFT.1"}}},{Annotation:{TYPE:"a",VALUE:{domain:"*"}}}]});break;case y.ScheduledCallInvites:c.push({ContentType:"ScheduledCallInvite"})}return r&&c.push(r),{OPTION:{RESULTBASE:s,RESULTCOUNT:n},QUERYSTRING:{AND:c}}}}t.default=new b},409426:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(174958),o=s(889391),n=s(717135),r=s(746096),a=s(436237),l=s(626712),d="url/info";class c extends n.ASMClient{constructor(){const e=o.default.getConfigSettingsNoSubscription().urlPreview;super("UrlPreviewClient",e.host,e.timeout)}getUrlInfoAsync(e){a.log(r.LogTraceArea.UrlPreviewClient,"Getting URL information: "+i.pii.Omit(e));return this._endpointUrl=o.default.getConfigSettingsNoSubscription().urlPreview.host,this.performRequest({method:"GET",path:d+"?url="+encodeURIComponent(l.default.getIDNSafeUrl(e))},{retries:3,scenario:"getUrlInfo"}).then((e=>e.body))}getUrlInfoBackground(e,t,s,i){return this._endpointUrl=o.default.getConfigSettingsNoSubscription().urlPreview.host,this._performApiCallBackground({backgroundType:e,backgroundContext:t,apiPath:d+"?url="+encodeURIComponent(l.default.getIDNSafeUrl(s)),action:"GET",requestOptions:i})}getContentUrl(e){return o.default.getConfigSettingsNoSubscription().urlPreview.host+"url/content?url="+encodeURIComponent(e)}}t.default=new c}}]);